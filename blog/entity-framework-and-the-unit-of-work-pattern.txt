3:I[5613,[],""]
5:I[1778,[],""]
6:I[5250,["250","static/chunks/250-d7e0a94ebe194dac.js","79","static/chunks/79-2d03397107aae3f1.js","308","static/chunks/app/blog/%5Bslug%5D/page-6528fc8a86d3d7ed.js"],""]
4:["slug","entity-framework-and-the-unit-of-work-pattern","d"]
0:["AAsfQHKb5tIaVeXdFRWxP",[[["",{"children":["blog",{"children":[["slug","entity-framework-and-the-unit-of-work-pattern","d"],{"children":["__PAGE__?{\"slug\":\"entity-framework-and-the-unit-of-work-pattern\"}",{}]}]}]},"$undefined","$undefined",true],["",{"children":["blog",{"children":[["slug","entity-framework-and-the-unit-of-work-pattern","d"],{"children":["__PAGE__",{},["$L1","$L2",null]]},["$","$L3",null,{"parallelRouterKey":"children","segmentPath":["children","blog","children","$4","children"],"loading":"$undefined","loadingStyles":"$undefined","loadingScripts":"$undefined","hasLoading":false,"error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L5",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":"$undefined","notFoundStyles":"$undefined","styles":[["$","link","0",{"rel":"stylesheet","href":"/_next/static/css/080eae226cfe3297.css","precedence":"next","crossOrigin":""}]]}]]},["$","$L3",null,{"parallelRouterKey":"children","segmentPath":["children","blog","children"],"loading":"$undefined","loadingStyles":"$undefined","loadingScripts":"$undefined","hasLoading":false,"error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L5",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":"$undefined","notFoundStyles":"$undefined","styles":null}]]},[null,["$","html",null,{"lang":"en","children":["$","body",null,{"className":"layout_bodystyle__4ncsS","children":["$","$L3",null,{"parallelRouterKey":"children","segmentPath":["children"],"loading":"$undefined","loadingStyles":"$undefined","loadingScripts":"$undefined","hasLoading":false,"error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L5",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":["$","div",null,{"style":{"display":"flex","alignItems":"center","justifyContent":"center","height":"100vh"},"children":["$","div",null,{"style":{"width":"50%","height":"20%","backgroundColor":"#ffeded","borderRadius":12,"padding":12,"textAlign":"center"},"children":[["$","h1",null,{"children":"Not Found"}],["$","p",null,{"children":"Could not find requested resource"}],["$","$L6",null,{"href":"/","children":"Return Home"}]]}]}],"notFoundStyles":[],"styles":null}]}]}],null]],[[["$","link","0",{"rel":"stylesheet","href":"/_next/static/css/4f3d065c9e2d01e0.css","precedence":"next","crossOrigin":""}]],"$L7"]]]]
8:I[1749,["250","static/chunks/250-d7e0a94ebe194dac.js","79","static/chunks/79-2d03397107aae3f1.js","308","static/chunks/app/blog/%5Bslug%5D/page-6528fc8a86d3d7ed.js"],"Image"]
7:[["$","meta","0",{"name":"viewport","content":"width=device-width, initial-scale=1"}],["$","meta","1",{"charSet":"utf-8"}],["$","title","2",{"children":"Patrick Desjardins Blog - Entity Framework and the Unit of Work pattern"}],["$","meta","3",{"name":"description","content":"Entity Framework and the Unit of Work pattern"}],["$","meta","4",{"name":"next-size-adjust"}]]
1:null
2:["$","div",null,{"className":"__className_aaf875","children":["$","div",null,{"className":"layout_container__Tovb9","children":[["$","header",null,{"className":"layout_siteTitle__k5U8g","children":"Patrick Desjardins Blog"}],["$","nav",null,{"children":["$","ul",null,{"className":"layout_navLinks__mf70r","children":["$","li",null,{"className":"layout_navLinkItem__1L8fB","children":[["$","$L6",null,{"className":"layout_navLinkText__bt28R","href":"/","children":"Main Page"}],["$","$L6",null,{"className":"layout_navLinkText__bt28R","href":"/blog","children":"Blog"}],[["$","$L6","2024",{"className":"layout_navLinkText__bt28R","href":"/blog/for/2024","children":2024}],["$","$L6","2023",{"className":"layout_navLinkText__bt28R","href":"/blog/for/2023","children":2023}],["$","$L6","2022",{"className":"layout_navLinkText__bt28R","href":"/blog/for/2022","children":2022}],["$","$L6","2021",{"className":"layout_navLinkText__bt28R","href":"/blog/for/2021","children":2021}],["$","$L6","2020",{"className":"layout_navLinkText__bt28R","href":"/blog/for/2020","children":2020}],["$","$L6","2019",{"className":"layout_navLinkText__bt28R","href":"/blog/for/2019","children":2019}],["$","$L6","2018",{"className":"layout_navLinkText__bt28R","href":"/blog/for/2018","children":2018}],["$","$L6","2017",{"className":"layout_navLinkText__bt28R","href":"/blog/for/2017","children":2017}],["$","$L6","2016",{"className":"layout_navLinkText__bt28R","href":"/blog/for/2016","children":2016}],["$","$L6","2015",{"className":"layout_navLinkText__bt28R","href":"/blog/for/2015","children":2015}],["$","$L6","2014",{"className":"layout_navLinkText__bt28R","href":"/blog/for/2014","children":2014}],["$","$L6","2013",{"className":"layout_navLinkText__bt28R","href":"/blog/for/2013","children":2013}],["$","$L6","2012",{"className":"layout_navLinkText__bt28R","href":"/blog/for/2012","children":2012}],["$","$L6","2011",{"className":"layout_navLinkText__bt28R","href":"/blog/for/2011","children":2011}]]]}]}]}],["$","div",null,{"className":"layout_blogPictureContainer__XC7nK","children":["$","$L8",null,{"className":"layout_blogTopPicture__RJHNN","alt":"Patrick Desjardins picture from a conference","src":"/images/backgrounds/patrickdesjardins_conference_bw.jpeg","width":800,"height":260}]}],["$","main",null,{"className":"layout_main__mXTwS","children":[["$","h1",null,{"children":"Entity Framework and the Unit of Work pattern"}],["$","div",null,{"className":"layout_blogPostContainer__WYELx","children":[["$","p",null,{"className":"layout_blogPostDate__LUvx5","children":["Posted on: ","2013-12-16"]}],[["$","h1",null,{"children":"Abstract"}],"\n",["$","p",null,{"children":["This article is a summary of how to make the use of a unit of work with Entity Framework. First of all, Entity Framework is a unit of work by itself. You can do multiple insert, update and delete and it's not until a ",["$","em",null,{"children":"SaveChanges"}]," that everything is committed to the Sql Server. The problem is that you may want to have multiple repositories. This mean that if you want to be under the same transaction that you want to share the save DbContext. Here comes the unit of work, a pattern that share the DbContext. The reference of DbContext is shared across repositories, which is interesting because if we want to be domain driven we can share the DbContext between repositories of the same domain. It's also interesting for unit testing. The reason is that the unit of work has interface which can be easily mocked."]}],"\n",["$","p",null,{"children":["I have seen an article on ",["$","a",null,{"href":"http://www.asp.net/mvc/tutorials/getting-started-with-ef-5-using-mvc-4/implementing-the-repository-and-unit-of-work-patterns-in-an-asp-net-mvc-application","children":"Asp.Net website"}]," concerning Entity Framework and the unit of work pattern but I believe it's wrong. I prefer the one of ",["$","a",null,{"href":"https://twitter.com/julielerman","children":"Julie Lerman"}]," in her ",["$","a",null,{"href":"http://pluralsight.com/training/courses/TableOfContents?courseName=efarchitecture&highlight=julie-lerman_efarchitecture-m4-testing*13#efarchitecture-m4-testing","children":"Pluralsight"}]," video. The main reason is the one of Asp.Net includes the repository inside the unit of work and the DbContext. The one of Julie Lerman only contain the DbContext and the unit of work is passed through every repositories of the domain."]}],"\n",["$","p",null,{"children":"Here is the representation of every layers that we would like with the unit of work."}],"\n",["$","p",null,{"children":["$","img",null,{"src":"/images/blog/EfLayers.png","alt":""}]}],"\n",["$","p",null,{"children":"As you can see, the controller should contact the service layer where all queries are from databases, access to caching services and web services are executed. For the database part, we contact the data access layer accessor which is an abstraction for the unit of work and repositories. This allow every developers that use repositories to abstract the need to create the unit of work and to pass it through constructors. The accessor does have a reference to repositories and to the unit of work."}],"\n",["$","p",null,{"children":["This article explains how to create a layered approach that has a controller, a service layer, a data access layer accessor with repositories and unit of work with a simple set of entities. I already have wrote an article for ",["$","a",null,{"href":"./enterprise-asp-net-mvc-part-4-repository","children":"repository and entity framework"}],". This was an other simpler way to design the repository. Previously, a facade was passing the DbContext to all repository, which was created the same behavior as the unit of work pattern. However, the unit of work is more elaborate and allows to unit test easily and allow you to reuse repository in several DbContext if required. Having the possibility to create several DbContext and to share it by domain (for domain driven design) is important for big software. It increase the performance of the database context by having a limited amount of entity to handle. So, the previous way to handle repository is perfect if you have under 50 entities. This is a rule of thumb and it depends of many factors. If you have a lot of entities and that you can draw specific domains, the approach of unit of work in this post is preferable. As you will see, a lot of more classes will be needed and this is not a small detail to consider before going into this way."]}],"\n",["$","h1",null,{"children":"Creating the entities, the database context and the tables"}],"\n",["$","p",null,{"children":"First of all, let's create entities and a simple context that we will call directly from the controller. This should never been done in enterprise but it will allow us to migrate the code from a simple basic code to a more heavy layered application."}],"\n",["$","figure",null,{"data-rehype-pretty-code-figure":"","children":["$","pre",null,{"style":{"backgroundColor":"#fff","color":"#24292e"},"tabIndex":"0","data-language":"csharp","data-theme":"github-light","children":["$","code",null,{"data-language":"csharp","data-theme":"github-light","style":{"display":"grid"},"children":[["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#D73A49"},"children":"public"}],["$","span",null,{"style":{"color":"#D73A49"},"children":" class"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" Animal"}],["$","span",null,{"style":{"color":"#24292E"},"children":" { "}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#D73A49"},"children":"  public"}],["$","span",null,{"style":{"color":"#D73A49"},"children":" int"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" Id"}],["$","span",null,{"style":{"color":"#24292E"},"children":" { "}],["$","span",null,{"style":{"color":"#D73A49"},"children":"get"}],["$","span",null,{"style":{"color":"#24292E"},"children":"; "}],["$","span",null,{"style":{"color":"#D73A49"},"children":"set"}],["$","span",null,{"style":{"color":"#24292E"},"children":"; } "}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#D73A49"},"children":"  public"}],["$","span",null,{"style":{"color":"#D73A49"},"children":" string"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" Name"}],["$","span",null,{"style":{"color":"#24292E"},"children":" { "}],["$","span",null,{"style":{"color":"#D73A49"},"children":"get"}],["$","span",null,{"style":{"color":"#24292E"},"children":"; "}],["$","span",null,{"style":{"color":"#D73A49"},"children":"set"}],["$","span",null,{"style":{"color":"#24292E"},"children":"; }"}]]}],"\n",["$","span",null,{"data-line":"","children":" "}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#D73A49"},"children":"  public"}],["$","span",null,{"style":{"color":"#D73A49"},"children":" virtual"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" ICollection"}],["$","span",null,{"style":{"color":"#24292E"},"children":"<"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"Animal"}],["$","span",null,{"style":{"color":"#24292E"},"children":"> "}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"Enemies"}],["$","span",null,{"style":{"color":"#24292E"},"children":" { "}],["$","span",null,{"style":{"color":"#D73A49"},"children":"get"}],["$","span",null,{"style":{"color":"#24292E"},"children":"; "}],["$","span",null,{"style":{"color":"#D73A49"},"children":"set"}],["$","span",null,{"style":{"color":"#24292E"},"children":"; } "}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#D73A49"},"children":"  public"}],["$","span",null,{"style":{"color":"#D73A49"},"children":" virtual"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" ICollection"}],["$","span",null,{"style":{"color":"#24292E"},"children":"<"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"Animal"}],["$","span",null,{"style":{"color":"#24292E"},"children":"> "}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"EnemyOf"}],["$","span",null,{"style":{"color":"#24292E"},"children":" { "}],["$","span",null,{"style":{"color":"#D73A49"},"children":"get"}],["$","span",null,{"style":{"color":"#24292E"},"children":"; "}],["$","span",null,{"style":{"color":"#D73A49"},"children":"set"}],["$","span",null,{"style":{"color":"#24292E"},"children":"; } "}]]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#24292E"},"children":"}"}]}],"\n",["$","span",null,{"data-line":"","children":" "}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#D73A49"},"children":"public"}],["$","span",null,{"style":{"color":"#D73A49"},"children":" class"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" Cat"}],["$","span",null,{"style":{"color":"#24292E"},"children":" : "}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"Animal"}],["$","span",null,{"style":{"color":"#24292E"},"children":" {"}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#D73A49"},"children":"  public"}],["$","span",null,{"style":{"color":"#D73A49"},"children":" int"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" NumberOfMustache"}],["$","span",null,{"style":{"color":"#24292E"},"children":" { "}],["$","span",null,{"style":{"color":"#D73A49"},"children":"get"}],["$","span",null,{"style":{"color":"#24292E"},"children":"; "}],["$","span",null,{"style":{"color":"#D73A49"},"children":"set"}],["$","span",null,{"style":{"color":"#24292E"},"children":"; } "}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#D73A49"},"children":"  public"}],["$","span",null,{"style":{"color":"#D73A49"},"children":" int"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" RemainingLife"}],["$","span",null,{"style":{"color":"#24292E"},"children":"{"}],["$","span",null,{"style":{"color":"#D73A49"},"children":"get"}],["$","span",null,{"style":{"color":"#24292E"},"children":";"}],["$","span",null,{"style":{"color":"#D73A49"},"children":"set"}],["$","span",null,{"style":{"color":"#24292E"},"children":";}"}]]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#24292E"},"children":"}"}]}],"\n",["$","span",null,{"data-line":"","children":" "}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#D73A49"},"children":"public"}],["$","span",null,{"style":{"color":"#D73A49"},"children":" class"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" Dog"}],["$","span",null,{"style":{"color":"#24292E"},"children":" : "}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"Animal"}],["$","span",null,{"style":{"color":"#24292E"},"children":" { "}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#D73A49"},"children":"  public"}],["$","span",null,{"style":{"color":"#D73A49"},"children":" string"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" Type"}],["$","span",null,{"style":{"color":"#24292E"},"children":" { "}],["$","span",null,{"style":{"color":"#D73A49"},"children":"get"}],["$","span",null,{"style":{"color":"#24292E"},"children":"; "}],["$","span",null,{"style":{"color":"#D73A49"},"children":"set"}],["$","span",null,{"style":{"color":"#24292E"},"children":"; } "}]]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#24292E"},"children":"} "}]}]]}]}]}],"\n",["$","p",null,{"children":"We have two classes, one is for Cat and one is for Dog. Both inherit from Animal class. These are very simple classes because we want to focus on the unit of work and not on complex classes. The next step is to create the database context."}],"\n",["$","p",null,{"children":"The first step is to get Entity Framework. This can be done by using Nuget with the interface (\"Manage Nuget Package\") or with a command line :"}],"\n",["$","figure",null,{"data-rehype-pretty-code-figure":"","children":["$","pre",null,{"style":{"backgroundColor":"#fff","color":"#24292e"},"tabIndex":"0","data-language":"sh","data-theme":"github-light","children":["$","code",null,{"data-language":"sh","data-theme":"github-light","style":{"display":"grid"},"children":["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#6F42C1"},"children":"PM>"}],["$","span",null,{"style":{"color":"#032F62"},"children":" install-package entityframework "}]]}]}]}]}],"\n",["$","p",null,{"children":"Then, we need to inherit from DbContext and setup web.config to have a connection string for the database. The web.config looks like this:"}],"\n",["$","figure",null,{"data-rehype-pretty-code-figure":"","children":["$","pre",null,{"style":{"backgroundColor":"#fff","color":"#24292e"},"tabIndex":"0","data-language":"xml","data-theme":"github-light","children":["$","code",null,{"data-language":"xml","data-theme":"github-light","style":{"display":"grid"},"children":[["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#24292E"},"children":" <"}],["$","span",null,{"style":{"color":"#22863A"},"children":"configuration"}],["$","span",null,{"style":{"color":"#24292E"},"children":">"}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#24292E"},"children":"  <"}],["$","span",null,{"style":{"color":"#22863A"},"children":"configSections"}],["$","span",null,{"style":{"color":"#24292E"},"children":"> "}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#24292E"},"children":"    <"}],["$","span",null,{"style":{"color":"#22863A"},"children":"section"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" name"}],["$","span",null,{"style":{"color":"#24292E"},"children":"="}],["$","span",null,{"style":{"color":"#032F62"},"children":"\"entityFramework\""}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" type"}],["$","span",null,{"style":{"color":"#24292E"},"children":"="}],["$","span",null,{"style":{"color":"#032F62"},"children":"\"System.Data.Entity.Internal.ConfigFile.EntityFrameworkSection, EntityFramework, Version=6.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089\""}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" requirePermission"}],["$","span",null,{"style":{"color":"#24292E"},"children":"="}],["$","span",null,{"style":{"color":"#032F62"},"children":"\"false\""}],["$","span",null,{"style":{"color":"#24292E"},"children":" /> "}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#24292E"},"children":"  </"}],["$","span",null,{"style":{"color":"#22863A"},"children":"configSections"}],["$","span",null,{"style":{"color":"#24292E"},"children":"> "}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#24292E"},"children":" <"}],["$","span",null,{"style":{"color":"#22863A"},"children":"connectionStrings"}],["$","span",null,{"style":{"color":"#24292E"},"children":"> "}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#24292E"},"children":"  <"}],["$","span",null,{"style":{"color":"#22863A"},"children":"add"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" name"}],["$","span",null,{"style":{"color":"#24292E"},"children":"="}],["$","span",null,{"style":{"color":"#032F62"},"children":"\"EntityConnectionString\""}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" connectionString"}],["$","span",null,{"style":{"color":"#24292E"},"children":"="}],["$","span",null,{"style":{"color":"#032F62"},"children":"\"Data Source=PATRICK-I7\\\\SQLEXPRESS;Initial Catalog=UnitOfWork;Integrated Security=SSPI;\""}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" providerName"}],["$","span",null,{"style":{"color":"#24292E"},"children":"="}],["$","span",null,{"style":{"color":"#032F62"},"children":"\"System.Data.SqlClient\""}],["$","span",null,{"style":{"color":"#24292E"},"children":" /> "}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#24292E"},"children":" </"}],["$","span",null,{"style":{"color":"#22863A"},"children":"connectionStrings"}],["$","span",null,{"style":{"color":"#24292E"},"children":"> "}]]}]]}]}]}],"\n",["$","p",null,{"children":"The first is that we have a new configSection for Entity Framework. This has been added automatically. The line that is required to be added manually is the connection string."}],"\n",["$","p",null,{"children":"The last step is to configure the entity. Since we are simplify the whole application for the purpose of the unit of work, the model class will be directly the entity. Some may want in enterprise application have an additional layer to not share entity classes with the model."}],"\n",["$","figure",null,{"data-rehype-pretty-code-figure":"","children":["$","pre",null,{"style":{"backgroundColor":"#fff","color":"#24292e"},"tabIndex":"0","data-language":"csharp","data-theme":"github-light","children":["$","code",null,{"data-language":"csharp","data-theme":"github-light","style":{"display":"grid"},"children":[["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#D73A49"},"children":"public"}],["$","span",null,{"style":{"color":"#D73A49"},"children":" class"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" AllDomainContext"}],["$","span",null,{"style":{"color":"#24292E"},"children":":"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"DbContext"}],["$","span",null,{"style":{"color":"#24292E"},"children":" { "}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#D73A49"},"children":"  public"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" AllDomainContext"}],["$","span",null,{"style":{"color":"#24292E"},"children":"():"}],["$","span",null,{"style":{"color":"#005CC5"},"children":"base"}],["$","span",null,{"style":{"color":"#24292E"},"children":"("}],["$","span",null,{"style":{"color":"#032F62"},"children":"\"EntityConnectionString\""}],["$","span",null,{"style":{"color":"#24292E"},"children":") { }"}]]}],"\n",["$","span",null,{"data-line":"","children":" "}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#D73A49"},"children":"  protected"}],["$","span",null,{"style":{"color":"#D73A49"},"children":" override"}],["$","span",null,{"style":{"color":"#D73A49"},"children":" void"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" OnModelCreating"}],["$","span",null,{"style":{"color":"#24292E"},"children":"("}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"DbModelBuilder"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" modelBuilder"}],["$","span",null,{"style":{"color":"#24292E"},"children":") { "}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#005CC5"},"children":"    base"}],["$","span",null,{"style":{"color":"#24292E"},"children":"."}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"OnModelCreating"}],["$","span",null,{"style":{"color":"#24292E"},"children":"(modelBuilder);"}]]}],"\n",["$","span",null,{"data-line":"","children":" "}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#6A737D"},"children":"  //Table per type configuration "}]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#24292E"},"children":"  modelBuilder."}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"Entity"}],["$","span",null,{"style":{"color":"#24292E"},"children":"<"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"Dog"}],["$","span",null,{"style":{"color":"#24292E"},"children":">()."}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"ToTable"}],["$","span",null,{"style":{"color":"#24292E"},"children":"("}],["$","span",null,{"style":{"color":"#032F62"},"children":"\"Animals\""}],["$","span",null,{"style":{"color":"#24292E"},"children":"); "}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#24292E"},"children":"  modelBuilder."}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"Entity"}],["$","span",null,{"style":{"color":"#24292E"},"children":"<"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"Dog"}],["$","span",null,{"style":{"color":"#24292E"},"children":">()."}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"ToTable"}],["$","span",null,{"style":{"color":"#24292E"},"children":"("}],["$","span",null,{"style":{"color":"#032F62"},"children":"\"Dogs\""}],["$","span",null,{"style":{"color":"#24292E"},"children":"); "}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#24292E"},"children":"  modelBuilder."}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"Entity"}],["$","span",null,{"style":{"color":"#24292E"},"children":"<"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"Cat"}],["$","span",null,{"style":{"color":"#24292E"},"children":">()."}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"ToTable"}],["$","span",null,{"style":{"color":"#24292E"},"children":"("}],["$","span",null,{"style":{"color":"#032F62"},"children":"\"Cats\""}],["$","span",null,{"style":{"color":"#24292E"},"children":");"}]]}],"\n",["$","span",null,{"data-line":"","children":" "}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#6A737D"},"children":"  //Primary keys configuration "}]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#24292E"},"children":"  modelBuilder."}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"Entity"}],["$","span",null,{"style":{"color":"#24292E"},"children":"<"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"Animal"}],["$","span",null,{"style":{"color":"#24292E"},"children":">()."}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"HasKey"}],["$","span",null,{"style":{"color":"#24292E"},"children":"("}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"k"}],["$","span",null,{"style":{"color":"#D73A49"},"children":" =>"}],["$","span",null,{"style":{"color":"#24292E"},"children":" k.Id);"}]]}],"\n",["$","span",null,{"data-line":"","children":" "}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#24292E"},"children":"  modelBuilder."}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"Entity"}],["$","span",null,{"style":{"color":"#24292E"},"children":"<"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"Animal"}],["$","span",null,{"style":{"color":"#24292E"},"children":">() "}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#24292E"},"children":"  ."}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"HasMany"}],["$","span",null,{"style":{"color":"#24292E"},"children":"("}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"entity"}],["$","span",null,{"style":{"color":"#D73A49"},"children":" =>"}],["$","span",null,{"style":{"color":"#24292E"},"children":" entity.Enemies) "}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#24292E"},"children":"  ."}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"WithMany"}],["$","span",null,{"style":{"color":"#24292E"},"children":"("}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"d"}],["$","span",null,{"style":{"color":"#D73A49"},"children":" =>"}],["$","span",null,{"style":{"color":"#24292E"},"children":" d.EnemyOf) "}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#24292E"},"children":"  ."}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"Map"}],["$","span",null,{"style":{"color":"#24292E"},"children":"("}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"d"}],["$","span",null,{"style":{"color":"#D73A49"},"children":" =>"}],["$","span",null,{"style":{"color":"#24292E"},"children":" d."}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"ToTable"}],["$","span",null,{"style":{"color":"#24292E"},"children":"("}],["$","span",null,{"style":{"color":"#032F62"},"children":"\"Animals_Enemies_Association\""}],["$","span",null,{"style":{"color":"#24292E"},"children":")."}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"MapLeftKey"}],["$","span",null,{"style":{"color":"#24292E"},"children":"("}],["$","span",null,{"style":{"color":"#032F62"},"children":"\"AnimalId\""}],["$","span",null,{"style":{"color":"#24292E"},"children":")."}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"MapRightKey"}],["$","span",null,{"style":{"color":"#24292E"},"children":"("}],["$","span",null,{"style":{"color":"#032F62"},"children":"\"EnemyId\""}],["$","span",null,{"style":{"color":"#24292E"},"children":"));"}]]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#24292E"},"children":"  } "}]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#24292E"},"children":"} "}]}]]}]}]}],"\n",["$","p",null,{"children":"The configuration has something special for the Enemies list because I did not wanted to handle the the association table by myself. Entity Framework can handle it for us by configure a many to many relationship with the animal class. It requires to have a table name for the many-many table with a foreign keys."}],"\n",["$","h1",null,{"children":"Setup the controllers, service layer and data access layer"}],"\n",["$","p",null,{"children":"Before even having the service layer, let's use the context directly into the controller and see the database creation. Then, we will change to code every layers but not the unit of work yet. We can use scaffolding to leverage Visual Studio power to get code generation for us. First step, right click the controller and select add new controller."}],"\n",["$","p",null,{"children":["$","img",null,{"src":"/images/blog/MvcControllerWithEntityFramework-400x278.png","alt":""}]}],"\n",["$","p",null,{"children":"The second step is to select to model class, you can select the one of Animal and select the DbContext class. If you do not see your DbContext class (DatabaseContext), close the window and compile your application. The wizard bases its choice on the compiled resource of the project. Once generated, you can execute the code, IIS Express start by default and you just need to go to http://localhost:15635/Animal and the DbContext will start the creation of the database. If you open SQL Server Manager, the unit of work database should have 3 tables."}],"\n",["$","p",null,{"children":["$","img",null,{"src":"/images/blog/TabletsTPTForAnimal.png","alt":""}]}],"\n",["$","h1",null,{"children":"Transforming to have service layers"}],"\n",["$","p",null,{"children":"At this stage, the architecture of the web application is not enterprise grade. The controller has a strong reference to the database context. The next step is to have everything related to the database inside a service layer which abstract entity framework. This allow us to test easily the controller without having to care about the database."}],"\n",["$","p",null,{"children":"This is the current controller code at this moment."}],"\n",["$","figure",null,{"data-rehype-pretty-code-figure":"","children":["$","pre",null,{"style":{"backgroundColor":"#fff","color":"#24292e"},"tabIndex":"0","data-language":"csharp","data-theme":"github-light","children":["$","code",null,{"data-language":"csharp","data-theme":"github-light","style":{"display":"grid"},"children":[["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#D73A49"},"children":"public"}],["$","span",null,{"style":{"color":"#D73A49"},"children":" class"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" AnimalController"}],["$","span",null,{"style":{"color":"#24292E"},"children":" : "}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"Controller"}],["$","span",null,{"style":{"color":"#24292E"},"children":" { "}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#D73A49"},"children":"  private"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" DatabaseContext"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" db"}],["$","span",null,{"style":{"color":"#D73A49"},"children":" ="}],["$","span",null,{"style":{"color":"#D73A49"},"children":" new"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" DatabaseContext"}],["$","span",null,{"style":{"color":"#24292E"},"children":"();"}]]}],"\n",["$","span",null,{"data-line":"","children":" "}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#D73A49"},"children":"  public"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" ActionResult"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" Index"}],["$","span",null,{"style":{"color":"#24292E"},"children":"() { "}],["$","span",null,{"style":{"color":"#D73A49"},"children":"return"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" View"}],["$","span",null,{"style":{"color":"#24292E"},"children":"(db.Animals."}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"ToList"}],["$","span",null,{"style":{"color":"#24292E"},"children":"()); }"}]]}],"\n",["$","span",null,{"data-line":"","children":" "}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#D73A49"},"children":"  public"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" ActionResult"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" Details"}],["$","span",null,{"style":{"color":"#24292E"},"children":"("}],["$","span",null,{"style":{"color":"#D73A49"},"children":"int"}],["$","span",null,{"style":{"color":"#24292E"},"children":"? "}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"id"}],["$","span",null,{"style":{"color":"#24292E"},"children":") { "}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#D73A49"},"children":"    if"}],["$","span",null,{"style":{"color":"#24292E"},"children":" (id "}],["$","span",null,{"style":{"color":"#D73A49"},"children":"=="}],["$","span",null,{"style":{"color":"#005CC5"},"children":" null"}],["$","span",null,{"style":{"color":"#24292E"},"children":") { "}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#D73A49"},"children":"      return"}],["$","span",null,{"style":{"color":"#D73A49"},"children":" new"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" HttpStatusCodeResult"}],["$","span",null,{"style":{"color":"#24292E"},"children":"(HttpStatusCode.BadRequest); "}]]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#24292E"},"children":"    } "}]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#6F42C1"},"children":"    Animal"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" animal"}],["$","span",null,{"style":{"color":"#D73A49"},"children":" ="}],["$","span",null,{"style":{"color":"#24292E"},"children":" db.Animals."}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"Find"}],["$","span",null,{"style":{"color":"#24292E"},"children":"(id); "}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#D73A49"},"children":"    if"}],["$","span",null,{"style":{"color":"#24292E"},"children":" (animal "}],["$","span",null,{"style":{"color":"#D73A49"},"children":"=="}],["$","span",null,{"style":{"color":"#005CC5"},"children":" null"}],["$","span",null,{"style":{"color":"#24292E"},"children":") { "}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#D73A49"},"children":"      return"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" HttpNotFound"}],["$","span",null,{"style":{"color":"#24292E"},"children":"(); "}]]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#24292E"},"children":"    }"}]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#D73A49"},"children":"     return"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" View"}],["$","span",null,{"style":{"color":"#24292E"},"children":"(animal); "}]]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#24292E"},"children":"  }"}]}],"\n",["$","span",null,{"data-line":"","children":" "}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#D73A49"},"children":"  public"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" ActionResult"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" Create"}],["$","span",null,{"style":{"color":"#24292E"},"children":"() { "}],["$","span",null,{"style":{"color":"#D73A49"},"children":"return"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" View"}],["$","span",null,{"style":{"color":"#24292E"},"children":"(); }"}]]}],"\n",["$","span",null,{"data-line":"","children":" "}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#24292E"},"children":"  ["}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"HttpPost"}],["$","span",null,{"style":{"color":"#24292E"},"children":"] "}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#24292E"},"children":"  ["}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"ValidateAntiForgeryToken"}],["$","span",null,{"style":{"color":"#24292E"},"children":"] "}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#D73A49"},"children":"  public"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" ActionResult"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" Create"}],["$","span",null,{"style":{"color":"#24292E"},"children":"(["}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"Bind"}],["$","span",null,{"style":{"color":"#24292E"},"children":"("}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"Include"}],["$","span",null,{"style":{"color":"#D73A49"},"children":"="}],["$","span",null,{"style":{"color":"#032F62"},"children":"\"Id,Name\""}],["$","span",null,{"style":{"color":"#24292E"},"children":")] "}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"Animal"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" animal"}],["$","span",null,{"style":{"color":"#24292E"},"children":") { "}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#D73A49"},"children":"    if"}],["$","span",null,{"style":{"color":"#24292E"},"children":" (ModelState.IsValid) { "}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#24292E"},"children":"      db.Animals."}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"Add"}],["$","span",null,{"style":{"color":"#24292E"},"children":"(animal); db."}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"SaveChanges"}],["$","span",null,{"style":{"color":"#24292E"},"children":"(); "}],["$","span",null,{"style":{"color":"#D73A49"},"children":"return"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" RedirectToAction"}],["$","span",null,{"style":{"color":"#24292E"},"children":"("}],["$","span",null,{"style":{"color":"#032F62"},"children":"\"Index\""}],["$","span",null,{"style":{"color":"#24292E"},"children":"); "}]]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#24292E"},"children":"    }"}]}],"\n",["$","span",null,{"data-line":"","children":" "}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#D73A49"},"children":"    return"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" View"}],["$","span",null,{"style":{"color":"#24292E"},"children":"(animal); "}]]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#24292E"},"children":"  }"}]}],"\n",["$","span",null,{"data-line":"","children":" "}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#D73A49"},"children":"  public"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" ActionResult"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" Edit"}],["$","span",null,{"style":{"color":"#24292E"},"children":"("}],["$","span",null,{"style":{"color":"#D73A49"},"children":"int"}],["$","span",null,{"style":{"color":"#24292E"},"children":"? "}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"id"}],["$","span",null,{"style":{"color":"#24292E"},"children":") { "}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#D73A49"},"children":"    if"}],["$","span",null,{"style":{"color":"#24292E"},"children":" (id "}],["$","span",null,{"style":{"color":"#D73A49"},"children":"=="}],["$","span",null,{"style":{"color":"#005CC5"},"children":" null"}],["$","span",null,{"style":{"color":"#24292E"},"children":") { "}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#D73A49"},"children":"      return"}],["$","span",null,{"style":{"color":"#D73A49"},"children":" new"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" HttpStatusCodeResult"}],["$","span",null,{"style":{"color":"#24292E"},"children":"(HttpStatusCode.BadRequest);"}]]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#24292E"},"children":"    } "}]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#6F42C1"},"children":"    Animal"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" animal"}],["$","span",null,{"style":{"color":"#D73A49"},"children":" ="}],["$","span",null,{"style":{"color":"#24292E"},"children":" db.Animals."}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"Find"}],["$","span",null,{"style":{"color":"#24292E"},"children":"(id); "}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#D73A49"},"children":"    if"}],["$","span",null,{"style":{"color":"#24292E"},"children":" (animal "}],["$","span",null,{"style":{"color":"#D73A49"},"children":"=="}],["$","span",null,{"style":{"color":"#005CC5"},"children":" null"}],["$","span",null,{"style":{"color":"#24292E"},"children":") { "}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#D73A49"},"children":"      return"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" HttpNotFound"}],["$","span",null,{"style":{"color":"#24292E"},"children":"(); "}]]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#24292E"},"children":"    } "}]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#D73A49"},"children":"    return"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" View"}],["$","span",null,{"style":{"color":"#24292E"},"children":"(animal); "}]]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#24292E"},"children":"  }"}]}],"\n",["$","span",null,{"data-line":"","children":" "}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#24292E"},"children":"  ["}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"HttpPost"}],["$","span",null,{"style":{"color":"#24292E"},"children":"] "}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#24292E"},"children":"  ["}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"ValidateAntiForgeryToken"}],["$","span",null,{"style":{"color":"#24292E"},"children":"] "}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#D73A49"},"children":"  public"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" ActionResult"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" Edit"}],["$","span",null,{"style":{"color":"#24292E"},"children":"(["}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"Bind"}],["$","span",null,{"style":{"color":"#24292E"},"children":"("}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"Include"}],["$","span",null,{"style":{"color":"#D73A49"},"children":"="}],["$","span",null,{"style":{"color":"#032F62"},"children":"\"Id,Name\""}],["$","span",null,{"style":{"color":"#24292E"},"children":")] "}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"Animal"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" animal"}],["$","span",null,{"style":{"color":"#24292E"},"children":") { "}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#D73A49"},"children":"    if"}],["$","span",null,{"style":{"color":"#24292E"},"children":" (ModelState.IsValid) { "}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#24292E"},"children":"      db."}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"Entry"}],["$","span",null,{"style":{"color":"#24292E"},"children":"(animal).State "}],["$","span",null,{"style":{"color":"#D73A49"},"children":"="}],["$","span",null,{"style":{"color":"#24292E"},"children":" EntityState.Modified; "}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#24292E"},"children":"      db."}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"SaveChanges"}],["$","span",null,{"style":{"color":"#24292E"},"children":"(); "}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#D73A49"},"children":"      return"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" RedirectToAction"}],["$","span",null,{"style":{"color":"#24292E"},"children":"("}],["$","span",null,{"style":{"color":"#032F62"},"children":"\"Index\""}],["$","span",null,{"style":{"color":"#24292E"},"children":"); "}]]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#24292E"},"children":"    } "}]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#D73A49"},"children":"    return"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" View"}],["$","span",null,{"style":{"color":"#24292E"},"children":"(animal); "}]]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#24292E"},"children":"  }"}]}],"\n",["$","span",null,{"data-line":"","children":" "}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#D73A49"},"children":"  public"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" ActionResult"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" Delete"}],["$","span",null,{"style":{"color":"#24292E"},"children":"("}],["$","span",null,{"style":{"color":"#D73A49"},"children":"int"}],["$","span",null,{"style":{"color":"#24292E"},"children":"? "}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"id"}],["$","span",null,{"style":{"color":"#24292E"},"children":") { "}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#D73A49"},"children":"    if"}],["$","span",null,{"style":{"color":"#24292E"},"children":" (id "}],["$","span",null,{"style":{"color":"#D73A49"},"children":"=="}],["$","span",null,{"style":{"color":"#005CC5"},"children":" null"}],["$","span",null,{"style":{"color":"#24292E"},"children":") { "}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#D73A49"},"children":"      return"}],["$","span",null,{"style":{"color":"#D73A49"},"children":" new"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" HttpStatusCodeResult"}],["$","span",null,{"style":{"color":"#24292E"},"children":"(HttpStatusCode.BadRequest); "}]]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#24292E"},"children":"    } "}]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#6F42C1"},"children":"    Animal"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" animal"}],["$","span",null,{"style":{"color":"#D73A49"},"children":" ="}],["$","span",null,{"style":{"color":"#24292E"},"children":" db.Animals."}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"Find"}],["$","span",null,{"style":{"color":"#24292E"},"children":"(id); "}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#D73A49"},"children":"    if"}],["$","span",null,{"style":{"color":"#24292E"},"children":" (animal "}],["$","span",null,{"style":{"color":"#D73A49"},"children":"=="}],["$","span",null,{"style":{"color":"#005CC5"},"children":" null"}],["$","span",null,{"style":{"color":"#24292E"},"children":") { "}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#D73A49"},"children":"      return"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" HttpNotFound"}],["$","span",null,{"style":{"color":"#24292E"},"children":"();"}]]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#24292E"},"children":"    } "}]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#D73A49"},"children":"    return"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" View"}],["$","span",null,{"style":{"color":"#24292E"},"children":"(animal);"}]]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#24292E"},"children":"  }"}]}],"\n",["$","span",null,{"data-line":"","children":" "}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#24292E"},"children":"  ["}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"HttpPost"}],["$","span",null,{"style":{"color":"#24292E"},"children":", "}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"ActionName"}],["$","span",null,{"style":{"color":"#24292E"},"children":"("}],["$","span",null,{"style":{"color":"#032F62"},"children":"\"Delete\""}],["$","span",null,{"style":{"color":"#24292E"},"children":")] "}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#24292E"},"children":"  ["}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"ValidateAntiForgeryToken"}],["$","span",null,{"style":{"color":"#24292E"},"children":"] "}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#D73A49"},"children":"  public"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" ActionResult"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" DeleteConfirmed"}],["$","span",null,{"style":{"color":"#24292E"},"children":"("}],["$","span",null,{"style":{"color":"#D73A49"},"children":"int"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" id"}],["$","span",null,{"style":{"color":"#24292E"},"children":") { "}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#6F42C1"},"children":"    Animal"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" animal"}],["$","span",null,{"style":{"color":"#D73A49"},"children":" ="}],["$","span",null,{"style":{"color":"#24292E"},"children":" db.Animals."}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"Find"}],["$","span",null,{"style":{"color":"#24292E"},"children":"(id); db.Animals."}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"Remove"}],["$","span",null,{"style":{"color":"#24292E"},"children":"(animal); "}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#24292E"},"children":"    db."}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"SaveChanges"}],["$","span",null,{"style":{"color":"#24292E"},"children":"(); "}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#D73A49"},"children":"    return"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" RedirectToAction"}],["$","span",null,{"style":{"color":"#24292E"},"children":"("}],["$","span",null,{"style":{"color":"#032F62"},"children":"\"Index\""}],["$","span",null,{"style":{"color":"#24292E"},"children":"); "}]]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#24292E"},"children":"  }"}]}],"\n",["$","span",null,{"data-line":"","children":" "}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#D73A49"},"children":"  protected"}],["$","span",null,{"style":{"color":"#D73A49"},"children":" override"}],["$","span",null,{"style":{"color":"#D73A49"},"children":" void"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" Dispose"}],["$","span",null,{"style":{"color":"#24292E"},"children":"("}],["$","span",null,{"style":{"color":"#D73A49"},"children":"bool"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" disposing"}],["$","span",null,{"style":{"color":"#24292E"},"children":") { "}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#D73A49"},"children":"    if"}],["$","span",null,{"style":{"color":"#24292E"},"children":" (disposing) { "}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#24292E"},"children":"      db."}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"Dispose"}],["$","span",null,{"style":{"color":"#24292E"},"children":"(); "}]]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#24292E"},"children":"    } "}]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#005CC5"},"children":"    base"}],["$","span",null,{"style":{"color":"#24292E"},"children":"."}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"Dispose"}],["$","span",null,{"style":{"color":"#24292E"},"children":"(disposing); "}]]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#24292E"},"children":"  } "}]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#24292E"},"children":"} "}]}]]}]}]}],"\n",["$","p",null,{"children":"If you want to test rapidly the database, just add the code in the index."}],"\n",["$","figure",null,{"data-rehype-pretty-code-figure":"","children":["$","pre",null,{"style":{"backgroundColor":"#fff","color":"#24292e"},"tabIndex":"0","data-language":"csharp","data-theme":"github-light","children":["$","code",null,{"data-language":"csharp","data-theme":"github-light","style":{"display":"grid"},"children":[["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#D73A49"},"children":"public"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" ActionResult"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" Index"}],["$","span",null,{"style":{"color":"#24292E"},"children":"() {"}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#D73A49"},"children":"   var"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" animal1"}],["$","span",null,{"style":{"color":"#D73A49"},"children":" ="}],["$","span",null,{"style":{"color":"#D73A49"},"children":" new"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" Animal"}],["$","span",null,{"style":{"color":"#24292E"},"children":" { Name "}],["$","span",null,{"style":{"color":"#D73A49"},"children":"="}],["$","span",null,{"style":{"color":"#032F62"},"children":" \"Boss\""}],["$","span",null,{"style":{"color":"#24292E"},"children":" }; "}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#D73A49"},"children":"   var"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" cat1"}],["$","span",null,{"style":{"color":"#D73A49"},"children":" ="}],["$","span",null,{"style":{"color":"#D73A49"},"children":" new"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" Cat"}],["$","span",null,{"style":{"color":"#24292E"},"children":" { Name "}],["$","span",null,{"style":{"color":"#D73A49"},"children":"="}],["$","span",null,{"style":{"color":"#032F62"},"children":" \"Mi\""}],["$","span",null,{"style":{"color":"#24292E"},"children":" }; "}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#D73A49"},"children":"   var"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" cat2"}],["$","span",null,{"style":{"color":"#D73A49"},"children":" ="}],["$","span",null,{"style":{"color":"#D73A49"},"children":" new"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" Cat"}],["$","span",null,{"style":{"color":"#24292E"},"children":" { Name "}],["$","span",null,{"style":{"color":"#D73A49"},"children":"="}],["$","span",null,{"style":{"color":"#032F62"},"children":" \"Do\""}],["$","span",null,{"style":{"color":"#24292E"},"children":" }; "}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#24292E"},"children":"   animal1.Enemies "}],["$","span",null,{"style":{"color":"#D73A49"},"children":"="}],["$","span",null,{"style":{"color":"#D73A49"},"children":" new"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" List"}],["$","span",null,{"style":{"color":"#24292E"},"children":"<"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"Animal"}],["$","span",null,{"style":{"color":"#24292E"},"children":"> { cat1,cat2}; "}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#24292E"},"children":"   db.Animals."}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"Add"}],["$","span",null,{"style":{"color":"#24292E"},"children":"(animal1); "}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#24292E"},"children":"   db.Animals."}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"Add"}],["$","span",null,{"style":{"color":"#24292E"},"children":"(cat1); "}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#24292E"},"children":"   db.Animals."}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"Add"}],["$","span",null,{"style":{"color":"#24292E"},"children":"(cat2); "}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#24292E"},"children":"   db."}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"SaveChanges"}],["$","span",null,{"style":{"color":"#24292E"},"children":"(); "}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#D73A49"},"children":"   return"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" View"}],["$","span",null,{"style":{"color":"#24292E"},"children":"(db.Animals."}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"AsNoTracking"}],["$","span",null,{"style":{"color":"#24292E"},"children":"()."}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"ToList"}],["$","span",null,{"style":{"color":"#24292E"},"children":"()); "}]]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#24292E"},"children":"} "}]}]]}]}]}],"\n",["$","p",null,{"children":["$","img",null,{"src":"/images/blog/tablesDataForAssociation-400x309.png","alt":""}]}],"\n",["$","p",null,{"children":"The first step is to create a repository class for animal inside the DataAccessLayer folder. Normally, I create a folder called Repository to have all repositories."}],"\n",["$","figure",null,{"data-rehype-pretty-code-figure":"","children":["$","pre",null,{"style":{"backgroundColor":"#fff","color":"#24292e"},"tabIndex":"0","data-language":"csharp","data-theme":"github-light","children":["$","code",null,{"data-language":"csharp","data-theme":"github-light","style":{"display":"grid"},"children":[["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#D73A49"},"children":" public"}],["$","span",null,{"style":{"color":"#D73A49"},"children":" class"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" AnimalRepository"}],["$","span",null,{"style":{"color":"#24292E"},"children":" : "}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"IAnimalRepository"}],["$","span",null,{"style":{"color":"#24292E"},"children":" { "}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#D73A49"},"children":"  private"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" DatabaseContext"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" db"}],["$","span",null,{"style":{"color":"#D73A49"},"children":" ="}],["$","span",null,{"style":{"color":"#D73A49"},"children":" new"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" DatabaseContext"}],["$","span",null,{"style":{"color":"#24292E"},"children":"();"}]]}],"\n",["$","span",null,{"data-line":"","children":" "}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#D73A49"},"children":"  public"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" Models"}],["$","span",null,{"style":{"color":"#24292E"},"children":"."}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"Animal"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" Find"}],["$","span",null,{"style":{"color":"#24292E"},"children":"("}],["$","span",null,{"style":{"color":"#D73A49"},"children":"int"}],["$","span",null,{"style":{"color":"#24292E"},"children":"? "}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"id"}],["$","span",null,{"style":{"color":"#24292E"},"children":") { "}],["$","span",null,{"style":{"color":"#D73A49"},"children":"return"}],["$","span",null,{"style":{"color":"#24292E"},"children":" db.Animals."}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"Find"}],["$","span",null,{"style":{"color":"#24292E"},"children":"(id); }"}]]}],"\n",["$","span",null,{"data-line":"","children":" "}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#D73A49"},"children":"  public"}],["$","span",null,{"style":{"color":"#D73A49"},"children":" void"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" Insert"}],["$","span",null,{"style":{"color":"#24292E"},"children":"("}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"Models"}],["$","span",null,{"style":{"color":"#24292E"},"children":"."}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"Animal"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" animal"}],["$","span",null,{"style":{"color":"#24292E"},"children":") { db.Animals."}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"Add"}],["$","span",null,{"style":{"color":"#24292E"},"children":"(animal); db."}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"SaveChanges"}],["$","span",null,{"style":{"color":"#24292E"},"children":"(); }"}]]}],"\n",["$","span",null,{"data-line":"","children":" "}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#D73A49"},"children":"  public"}],["$","span",null,{"style":{"color":"#D73A49"},"children":" void"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" Update"}],["$","span",null,{"style":{"color":"#24292E"},"children":"("}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"Models"}],["$","span",null,{"style":{"color":"#24292E"},"children":"."}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"Animal"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" animal"}],["$","span",null,{"style":{"color":"#24292E"},"children":") { db."}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"Entry"}],["$","span",null,{"style":{"color":"#24292E"},"children":"(animal).State "}],["$","span",null,{"style":{"color":"#D73A49"},"children":"="}],["$","span",null,{"style":{"color":"#24292E"},"children":" EntityState.Modified; db."}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"SaveChanges"}],["$","span",null,{"style":{"color":"#24292E"},"children":"(); }"}]]}],"\n",["$","span",null,{"data-line":"","children":" "}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#D73A49"},"children":"  public"}],["$","span",null,{"style":{"color":"#D73A49"},"children":" void"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" Delete"}],["$","span",null,{"style":{"color":"#24292E"},"children":"("}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"Models"}],["$","span",null,{"style":{"color":"#24292E"},"children":"."}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"Animal"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" animal"}],["$","span",null,{"style":{"color":"#24292E"},"children":") { db.Animals."}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"Remove"}],["$","span",null,{"style":{"color":"#24292E"},"children":"(animal); db."}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"SaveChanges"}],["$","span",null,{"style":{"color":"#24292E"},"children":"(); }"}]]}],"\n",["$","span",null,{"data-line":"","children":" "}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#D73A49"},"children":"  public"}],["$","span",null,{"style":{"color":"#D73A49"},"children":" void"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" Dispose"}],["$","span",null,{"style":{"color":"#24292E"},"children":"() { db."}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"Dispose"}],["$","span",null,{"style":{"color":"#24292E"},"children":"(); }"}]]}],"\n",["$","span",null,{"data-line":"","children":" "}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#D73A49"},"children":"  public"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" IList"}],["$","span",null,{"style":{"color":"#24292E"},"children":"<"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"Animal"}],["$","span",null,{"style":{"color":"#24292E"},"children":"> "}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"GetAll"}],["$","span",null,{"style":{"color":"#24292E"},"children":"() { "}],["$","span",null,{"style":{"color":"#D73A49"},"children":"return"}],["$","span",null,{"style":{"color":"#24292E"},"children":" db.Animals."}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"AsNoTracking"}],["$","span",null,{"style":{"color":"#24292E"},"children":"()."}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"ToList"}],["$","span",null,{"style":{"color":"#24292E"},"children":"(); } "}]]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#24292E"},"children":"} "}]}]]}]}]}],"\n",["$","p",null,{"children":"This class as also an interface with the public method in it."}],"\n",["$","p",null,{"children":"The second step is to create a service layer. Normally, we would create a new project, but to keep everything simple, let's just add a new folder (namespace). Then, we move the DatabaseContext class from the controller to the service."}],"\n",["$","p",null,{"children":"The animal service class looks like the following code."}],"\n",["$","figure",null,{"data-rehype-pretty-code-figure":"","children":["$","pre",null,{"style":{"backgroundColor":"#fff","color":"#24292e"},"tabIndex":"0","data-language":"csharp","data-theme":"github-light","children":["$","code",null,{"data-language":"csharp","data-theme":"github-light","style":{"display":"grid"},"children":[["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#D73A49"},"children":"public"}],["$","span",null,{"style":{"color":"#D73A49"},"children":" class"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" AnimalService"}],["$","span",null,{"style":{"color":"#24292E"},"children":": "}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"IAnimalService"}],["$","span",null,{"style":{"color":"#24292E"},"children":" { "}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#D73A49"},"children":"  private"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" IAnimalRepository"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" animalRepository"}],["$","span",null,{"style":{"color":"#24292E"},"children":";"}]]}],"\n",["$","span",null,{"data-line":"","children":" "}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#D73A49"},"children":"  public"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" AnimalService"}],["$","span",null,{"style":{"color":"#24292E"},"children":"("}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"IAnimalRepository"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" animalRepository"}],["$","span",null,{"style":{"color":"#24292E"},"children":") { "}],["$","span",null,{"style":{"color":"#005CC5"},"children":"this"}],["$","span",null,{"style":{"color":"#24292E"},"children":".animalRepository "}],["$","span",null,{"style":{"color":"#D73A49"},"children":"="}],["$","span",null,{"style":{"color":"#24292E"},"children":" animalRepository; }"}]]}],"\n",["$","span",null,{"data-line":"","children":" "}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#D73A49"},"children":"  public"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" Models"}],["$","span",null,{"style":{"color":"#24292E"},"children":"."}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"Animal"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" Find"}],["$","span",null,{"style":{"color":"#24292E"},"children":"("}],["$","span",null,{"style":{"color":"#D73A49"},"children":"int"}],["$","span",null,{"style":{"color":"#24292E"},"children":"? "}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"id"}],["$","span",null,{"style":{"color":"#24292E"},"children":") { "}],["$","span",null,{"style":{"color":"#D73A49"},"children":"return"}],["$","span",null,{"style":{"color":"#005CC5"},"children":" this"}],["$","span",null,{"style":{"color":"#24292E"},"children":".animalRepository."}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"Find"}],["$","span",null,{"style":{"color":"#24292E"},"children":"(id); }"}]]}],"\n",["$","span",null,{"data-line":"","children":" "}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#D73A49"},"children":"  public"}],["$","span",null,{"style":{"color":"#D73A49"},"children":" void"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" Insert"}],["$","span",null,{"style":{"color":"#24292E"},"children":"("}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"Models"}],["$","span",null,{"style":{"color":"#24292E"},"children":"."}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"Animal"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" animal"}],["$","span",null,{"style":{"color":"#24292E"},"children":") { "}],["$","span",null,{"style":{"color":"#005CC5"},"children":"this"}],["$","span",null,{"style":{"color":"#24292E"},"children":".animalRepository."}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"Insert"}],["$","span",null,{"style":{"color":"#24292E"},"children":"(animal); }"}]]}],"\n",["$","span",null,{"data-line":"","children":" "}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#D73A49"},"children":"  public"}],["$","span",null,{"style":{"color":"#D73A49"},"children":" void"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" Update"}],["$","span",null,{"style":{"color":"#24292E"},"children":"("}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"Models"}],["$","span",null,{"style":{"color":"#24292E"},"children":"."}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"Animal"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" animal"}],["$","span",null,{"style":{"color":"#24292E"},"children":") { "}],["$","span",null,{"style":{"color":"#005CC5"},"children":"this"}],["$","span",null,{"style":{"color":"#24292E"},"children":".animalRepository."}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"Update"}],["$","span",null,{"style":{"color":"#24292E"},"children":"(animal); }"}]]}],"\n",["$","span",null,{"data-line":"","children":" "}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#D73A49"},"children":"  public"}],["$","span",null,{"style":{"color":"#D73A49"},"children":" void"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" Delete"}],["$","span",null,{"style":{"color":"#24292E"},"children":"("}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"Models"}],["$","span",null,{"style":{"color":"#24292E"},"children":"."}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"Animal"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" animal"}],["$","span",null,{"style":{"color":"#24292E"},"children":") { "}],["$","span",null,{"style":{"color":"#005CC5"},"children":"this"}],["$","span",null,{"style":{"color":"#24292E"},"children":".animalRepository."}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"Delete"}],["$","span",null,{"style":{"color":"#24292E"},"children":"(animal); } "}]]}],"\n",["$","span",null,{"data-line":"","children":" "}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#D73A49"},"children":"  public"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" IList"}],["$","span",null,{"style":{"color":"#24292E"},"children":"<"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"Animal"}],["$","span",null,{"style":{"color":"#24292E"},"children":"> "}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"GetAll"}],["$","span",null,{"style":{"color":"#24292E"},"children":"() { "}],["$","span",null,{"style":{"color":"#D73A49"},"children":"return"}],["$","span",null,{"style":{"color":"#005CC5"},"children":" this"}],["$","span",null,{"style":{"color":"#24292E"},"children":".animalRepository."}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"GetAll"}],["$","span",null,{"style":{"color":"#24292E"},"children":"(); } "}]]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#24292E"},"children":"} "}]}]]}]}]}],"\n",["$","p",null,{"children":"It's all the code from the controller. Later, some improvement should be done. One of this change is to move the SaveChanges because it's not interesting to save every time we add, modify or update an entity. This cause performance problem when several entities are required to be posted to the database. However, let's focus on the transformation first, later these details will be gone. The role of the service layer is to resemble every repository. In this situation we have only one repository. In fact, in more complex problem like in enterprise, a service has several repository and caching classes."}],"\n",["$","p",null,{"children":"The next class that require changes is the animal controller class. This one now has a constructor that need an IAnimalService."}],"\n",["$","figure",null,{"data-rehype-pretty-code-figure":"","children":["$","pre",null,{"style":{"backgroundColor":"#fff","color":"#24292e"},"tabIndex":"0","data-language":"csharp","data-theme":"github-light","children":["$","code",null,{"data-language":"csharp","data-theme":"github-light","style":{"display":"grid"},"children":[["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#D73A49"},"children":"public"}],["$","span",null,{"style":{"color":"#D73A49"},"children":" class"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" AnimalController"}],["$","span",null,{"style":{"color":"#24292E"},"children":" : "}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"Controller"}],["$","span",null,{"style":{"color":"#24292E"},"children":" { "}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#D73A49"},"children":"  private"}],["$","span",null,{"style":{"color":"#24292E"},"children":" IAnimalService_service;"}]]}],"\n",["$","span",null,{"data-line":"","children":" "}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#D73A49"},"children":"  public"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" AnimalController"}],["$","span",null,{"style":{"color":"#24292E"},"children":"() {_service "}],["$","span",null,{"style":{"color":"#D73A49"},"children":"="}],["$","span",null,{"style":{"color":"#D73A49"},"children":" new"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" AnimalService"}],["$","span",null,{"style":{"color":"#24292E"},"children":"("}],["$","span",null,{"style":{"color":"#D73A49"},"children":"new"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" AnimalRepository"}],["$","span",null,{"style":{"color":"#24292E"},"children":"()); }"}]]}],"\n",["$","span",null,{"data-line":"","children":" "}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#D73A49"},"children":"  public"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" AnimalController"}],["$","span",null,{"style":{"color":"#24292E"},"children":"("}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"IAnimalService"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" animalService"}],["$","span",null,{"style":{"color":"#24292E"},"children":") {_service "}],["$","span",null,{"style":{"color":"#D73A49"},"children":"="}],["$","span",null,{"style":{"color":"#24292E"},"children":" animalService; }"}]]}],"\n",["$","span",null,{"data-line":"","children":" "}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#D73A49"},"children":"  public"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" ActionResult"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" Index"}],["$","span",null,{"style":{"color":"#24292E"},"children":"() { "}],["$","span",null,{"style":{"color":"#D73A49"},"children":"return"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" View"}],["$","span",null,{"style":{"color":"#24292E"},"children":"(_service."}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"GetAll"}],["$","span",null,{"style":{"color":"#24292E"},"children":"()); }"}]]}],"\n",["$","span",null,{"data-line":"","children":" "}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#D73A49"},"children":"  public"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" ActionResult"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" Details"}],["$","span",null,{"style":{"color":"#24292E"},"children":"("}],["$","span",null,{"style":{"color":"#D73A49"},"children":"int"}],["$","span",null,{"style":{"color":"#24292E"},"children":"? "}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"id"}],["$","span",null,{"style":{"color":"#24292E"},"children":") { "}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#D73A49"},"children":"    if"}],["$","span",null,{"style":{"color":"#24292E"},"children":" (id "}],["$","span",null,{"style":{"color":"#D73A49"},"children":"=="}],["$","span",null,{"style":{"color":"#005CC5"},"children":" null"}],["$","span",null,{"style":{"color":"#24292E"},"children":") { "}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#D73A49"},"children":"      return"}],["$","span",null,{"style":{"color":"#D73A49"},"children":" new"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" HttpStatusCodeResult"}],["$","span",null,{"style":{"color":"#24292E"},"children":"(HttpStatusCode.BadRequest); "}]]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#24292E"},"children":"    } "}]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#6F42C1"},"children":"    Animal"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" animal"}],["$","span",null,{"style":{"color":"#D73A49"},"children":" ="}],["$","span",null,{"style":{"color":"#24292E"},"children":"_service."}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"Find"}],["$","span",null,{"style":{"color":"#24292E"},"children":"(id); "}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#D73A49"},"children":"    if"}],["$","span",null,{"style":{"color":"#24292E"},"children":" (animal "}],["$","span",null,{"style":{"color":"#D73A49"},"children":"=="}],["$","span",null,{"style":{"color":"#005CC5"},"children":" null"}],["$","span",null,{"style":{"color":"#24292E"},"children":") { "}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#D73A49"},"children":"      return"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" HttpNotFound"}],["$","span",null,{"style":{"color":"#24292E"},"children":"(); "}]]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#24292E"},"children":"    } "}]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#D73A49"},"children":"    return"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" View"}],["$","span",null,{"style":{"color":"#24292E"},"children":"(animal); "}]]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#24292E"},"children":"  }"}]}],"\n",["$","span",null,{"data-line":"","children":" "}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#D73A49"},"children":"  public"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" ActionResult"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" Create"}],["$","span",null,{"style":{"color":"#24292E"},"children":"() { "}],["$","span",null,{"style":{"color":"#D73A49"},"children":"return"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" View"}],["$","span",null,{"style":{"color":"#24292E"},"children":"(); }"}]]}],"\n",["$","span",null,{"data-line":"","children":" "}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#24292E"},"children":"  ["}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"HttpPost"}],["$","span",null,{"style":{"color":"#24292E"},"children":"]"}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#24292E"},"children":"  ["}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"ValidateAntiForgeryToken"}],["$","span",null,{"style":{"color":"#24292E"},"children":"] "}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#D73A49"},"children":"  public"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" ActionResult"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" Create"}],["$","span",null,{"style":{"color":"#24292E"},"children":"(["}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"Bind"}],["$","span",null,{"style":{"color":"#24292E"},"children":"("}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"Include"}],["$","span",null,{"style":{"color":"#D73A49"},"children":"="}],["$","span",null,{"style":{"color":"#032F62"},"children":"\"Id,Name\""}],["$","span",null,{"style":{"color":"#24292E"},"children":")] "}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"Animal"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" animal"}],["$","span",null,{"style":{"color":"#24292E"},"children":") { "}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#D73A49"},"children":"    if"}],["$","span",null,{"style":{"color":"#24292E"},"children":" (ModelState.IsValid) {"}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#24292E"},"children":"      _service."}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"Insert"}],["$","span",null,{"style":{"color":"#24292E"},"children":"(animal); "}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#D73A49"},"children":"      return"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" RedirectToAction"}],["$","span",null,{"style":{"color":"#24292E"},"children":"("}],["$","span",null,{"style":{"color":"#032F62"},"children":"\"Index\""}],["$","span",null,{"style":{"color":"#24292E"},"children":"); "}]]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#24292E"},"children":"    }"}]}],"\n",["$","span",null,{"data-line":"","children":" "}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#D73A49"},"children":"  return"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" View"}],["$","span",null,{"style":{"color":"#24292E"},"children":"(animal); }"}]]}],"\n",["$","span",null,{"data-line":"","children":" "}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#D73A49"},"children":"  public"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" ActionResult"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" Edit"}],["$","span",null,{"style":{"color":"#24292E"},"children":"("}],["$","span",null,{"style":{"color":"#D73A49"},"children":"int"}],["$","span",null,{"style":{"color":"#24292E"},"children":"? "}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"id"}],["$","span",null,{"style":{"color":"#24292E"},"children":") { "}],["$","span",null,{"style":{"color":"#D73A49"},"children":"if"}],["$","span",null,{"style":{"color":"#24292E"},"children":" (id "}],["$","span",null,{"style":{"color":"#D73A49"},"children":"=="}],["$","span",null,{"style":{"color":"#005CC5"},"children":" null"}],["$","span",null,{"style":{"color":"#24292E"},"children":") { "}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#D73A49"},"children":"    return"}],["$","span",null,{"style":{"color":"#D73A49"},"children":" new"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" HttpStatusCodeResult"}],["$","span",null,{"style":{"color":"#24292E"},"children":"(HttpStatusCode.BadRequest);"}]]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#24292E"},"children":"  } "}]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#24292E"},"children":"  "}]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#6F42C1"},"children":"  Animal"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" animal"}],["$","span",null,{"style":{"color":"#D73A49"},"children":" ="}],["$","span",null,{"style":{"color":"#24292E"},"children":"_service."}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"Find"}],["$","span",null,{"style":{"color":"#24292E"},"children":"(id); "}]]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#24292E"},"children":"  "}]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#D73A49"},"children":"  if"}],["$","span",null,{"style":{"color":"#24292E"},"children":" (animal "}],["$","span",null,{"style":{"color":"#D73A49"},"children":"=="}],["$","span",null,{"style":{"color":"#005CC5"},"children":" null"}],["$","span",null,{"style":{"color":"#24292E"},"children":") { "}],["$","span",null,{"style":{"color":"#D73A49"},"children":"return"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" HttpNotFound"}],["$","span",null,{"style":{"color":"#24292E"},"children":"(); } "}]]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#24292E"},"children":"  "}]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#D73A49"},"children":"  return"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" View"}],["$","span",null,{"style":{"color":"#24292E"},"children":"(animal); }"}]]}],"\n",["$","span",null,{"data-line":"","children":" "}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#24292E"},"children":"  ["}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"HttpPost"}],["$","span",null,{"style":{"color":"#24292E"},"children":"] "}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#24292E"},"children":"  ["}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"ValidateAntiForgeryToken"}],["$","span",null,{"style":{"color":"#24292E"},"children":"] "}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#D73A49"},"children":"  public"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" ActionResult"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" Edit"}],["$","span",null,{"style":{"color":"#24292E"},"children":"(["}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"Bind"}],["$","span",null,{"style":{"color":"#24292E"},"children":"("}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"Include"}],["$","span",null,{"style":{"color":"#D73A49"},"children":"="}],["$","span",null,{"style":{"color":"#032F62"},"children":"\"Id,Name\""}],["$","span",null,{"style":{"color":"#24292E"},"children":")] "}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"Animal"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" animal"}],["$","span",null,{"style":{"color":"#24292E"},"children":") { "}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#D73A49"},"children":"    if"}],["$","span",null,{"style":{"color":"#24292E"},"children":" (ModelState.IsValid) {"}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#24292E"},"children":"      _service."}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"Update"}],["$","span",null,{"style":{"color":"#24292E"},"children":"(animal); "}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#D73A49"},"children":"      return"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" RedirectToAction"}],["$","span",null,{"style":{"color":"#24292E"},"children":"("}],["$","span",null,{"style":{"color":"#032F62"},"children":"\"Index\""}],["$","span",null,{"style":{"color":"#24292E"},"children":"); "}]]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#24292E"},"children":"    } "}]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#D73A49"},"children":"    return"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" View"}],["$","span",null,{"style":{"color":"#24292E"},"children":"(animal); "}]]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#24292E"},"children":"  }"}]}],"\n",["$","span",null,{"data-line":"","children":" "}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#D73A49"},"children":"  public"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" ActionResult"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" Delete"}],["$","span",null,{"style":{"color":"#24292E"},"children":"("}],["$","span",null,{"style":{"color":"#D73A49"},"children":"int"}],["$","span",null,{"style":{"color":"#24292E"},"children":"? "}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"id"}],["$","span",null,{"style":{"color":"#24292E"},"children":") { "}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#D73A49"},"children":"    if"}],["$","span",null,{"style":{"color":"#24292E"},"children":" (id "}],["$","span",null,{"style":{"color":"#D73A49"},"children":"=="}],["$","span",null,{"style":{"color":"#005CC5"},"children":" null"}],["$","span",null,{"style":{"color":"#24292E"},"children":") { "}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#D73A49"},"children":"      return"}],["$","span",null,{"style":{"color":"#D73A49"},"children":" new"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" HttpStatusCodeResult"}],["$","span",null,{"style":{"color":"#24292E"},"children":"(HttpStatusCode.BadRequest); "}]]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#24292E"},"children":"    } "}]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#6F42C1"},"children":"    Animal"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" animal"}],["$","span",null,{"style":{"color":"#D73A49"},"children":" ="}],["$","span",null,{"style":{"color":"#24292E"},"children":"_service."}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"Find"}],["$","span",null,{"style":{"color":"#24292E"},"children":"(id); "}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#D73A49"},"children":"    if"}],["$","span",null,{"style":{"color":"#24292E"},"children":" (animal "}],["$","span",null,{"style":{"color":"#D73A49"},"children":"=="}],["$","span",null,{"style":{"color":"#005CC5"},"children":" null"}],["$","span",null,{"style":{"color":"#24292E"},"children":") { "}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#D73A49"},"children":"      return"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" HttpNotFound"}],["$","span",null,{"style":{"color":"#24292E"},"children":"(); "}]]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#24292E"},"children":"    } "}]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#24292E"},"children":"    "}]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#D73A49"},"children":"    return"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" View"}],["$","span",null,{"style":{"color":"#24292E"},"children":"(animal); "}]]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#24292E"},"children":"  }"}]}],"\n",["$","span",null,{"data-line":"","children":" "}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#24292E"},"children":"  ["}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"HttpPost"}],["$","span",null,{"style":{"color":"#24292E"},"children":", "}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"ActionName"}],["$","span",null,{"style":{"color":"#24292E"},"children":"("}],["$","span",null,{"style":{"color":"#032F62"},"children":"\"Delete\""}],["$","span",null,{"style":{"color":"#24292E"},"children":")] "}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#24292E"},"children":"  ["}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"ValidateAntiForgeryToken"}],["$","span",null,{"style":{"color":"#24292E"},"children":"] "}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#D73A49"},"children":"  public"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" ActionResult"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" DeleteConfirmed"}],["$","span",null,{"style":{"color":"#24292E"},"children":"("}],["$","span",null,{"style":{"color":"#D73A49"},"children":"int"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" id"}],["$","span",null,{"style":{"color":"#24292E"},"children":") { "}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#6F42C1"},"children":"    Animal"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" animal"}],["$","span",null,{"style":{"color":"#D73A49"},"children":" ="}],["$","span",null,{"style":{"color":"#24292E"},"children":"_service."}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"Find"}],["$","span",null,{"style":{"color":"#24292E"},"children":"(id);"}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#24292E"},"children":"    _service."}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"Delete"}],["$","span",null,{"style":{"color":"#24292E"},"children":"(animal);"}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#D73A49"},"children":"    return"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" RedirectToAction"}],["$","span",null,{"style":{"color":"#24292E"},"children":"("}],["$","span",null,{"style":{"color":"#032F62"},"children":"\"Index\""}],["$","span",null,{"style":{"color":"#24292E"},"children":"); "}]]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#24292E"},"children":"  } "}]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#24292E"},"children":"} "}]}]]}]}]}],"\n",["$","p",null,{"children":"At this stage, the controller is separated from the database by the service and the repository. Still, it's better to not having a strong reference to AnimalService inside the controller. This is why we will extract an interface from AnimalService and we will inject the concrete class by inversion of control. This allow us to have when doing test entry point to inject a fake AnimalService that won't goes to the database. You can use the refactoring tool to extract the interface easily."}],"\n",["$","p",null,{"children":["$","img",null,{"src":"/images/blog/ExtractInterface-400x281.png","alt":""}]}],"\n",["$","figure",null,{"data-rehype-pretty-code-figure":"","children":["$","pre",null,{"style":{"backgroundColor":"#fff","color":"#24292e"},"tabIndex":"0","data-language":"csharp","data-theme":"github-light","children":["$","code",null,{"data-language":"csharp","data-theme":"github-light","style":{"display":"grid"},"children":[["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#D73A49"},"children":" public"}],["$","span",null,{"style":{"color":"#D73A49"},"children":" interface"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" IAnimalService"}],["$","span",null,{"style":{"color":"#24292E"},"children":" { "}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#D73A49"},"children":"  void"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" Delete"}],["$","span",null,{"style":{"color":"#24292E"},"children":"("}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"Animal"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" animal"}],["$","span",null,{"style":{"color":"#24292E"},"children":"); "}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#6F42C1"},"children":"  Animal"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" Find"}],["$","span",null,{"style":{"color":"#24292E"},"children":"("}],["$","span",null,{"style":{"color":"#D73A49"},"children":"int"}],["$","span",null,{"style":{"color":"#24292E"},"children":"? "}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"id"}],["$","span",null,{"style":{"color":"#24292E"},"children":"); "}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#6F42C1"},"children":"  IList"}],["$","span",null,{"style":{"color":"#24292E"},"children":"<"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"Animal"}],["$","span",null,{"style":{"color":"#24292E"},"children":"> "}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"GetAll"}],["$","span",null,{"style":{"color":"#24292E"},"children":"(); "}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#D73A49"},"children":"  void"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" Insert"}],["$","span",null,{"style":{"color":"#24292E"},"children":"("}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"Animal"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" animal"}],["$","span",null,{"style":{"color":"#24292E"},"children":"); "}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#D73A49"},"children":"  void"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" Update"}],["$","span",null,{"style":{"color":"#24292E"},"children":"("}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"Animal"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" animal"}],["$","span",null,{"style":{"color":"#24292E"},"children":"); "}]]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#24292E"},"children":"} "}]}]]}]}]}],"\n",["$","p",null,{"children":"Inside the controller, we have two constructors. One to help us for this example which instantiate the service layer and the real one that takes a single parameter. This is the one that you should have in your enterprise grade software because it can inject any thing of IAnimalService into the controller."}],"\n",["$","figure",null,{"data-rehype-pretty-code-figure":"","children":["$","pre",null,{"style":{"backgroundColor":"#fff","color":"#24292e"},"tabIndex":"0","data-language":"csharp","data-theme":"github-light","children":["$","code",null,{"data-language":"csharp","data-theme":"github-light","style":{"display":"grid"},"children":[["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#D73A49"},"children":"public"}],["$","span",null,{"style":{"color":"#D73A49"},"children":" class"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" AnimalController"}],["$","span",null,{"style":{"color":"#24292E"},"children":" : "}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"Controller"}],["$","span",null,{"style":{"color":"#24292E"},"children":" { "}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#D73A49"},"children":"  private"}],["$","span",null,{"style":{"color":"#24292E"},"children":" IAnimalService_service;"}]]}],"\n",["$","span",null,{"data-line":"","children":" "}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#D73A49"},"children":"  public"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" AnimalController"}],["$","span",null,{"style":{"color":"#24292E"},"children":"("}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"IAnimalService"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" animalService"}],["$","span",null,{"style":{"color":"#24292E"},"children":") {"}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#24292E"},"children":"    _service "}],["$","span",null,{"style":{"color":"#D73A49"},"children":"="}],["$","span",null,{"style":{"color":"#24292E"},"children":" animalService; "}]]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#24292E"},"children":"  } "}]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#6A737D"},"children":"  //... "}]}]]}]}]}],"\n",["$","p",null,{"children":"Before implementing the unit of work, we will create a new repository to illustrate why the unit of work is required. We will also do a little re-factoring by changing the repository to stop having automatically a call to SaveChanges. This allow us to insert several entities in a single transaction."}],"\n",["$","p",null,{"children":"This is now the animal service class and interface."}],"\n",["$","figure",null,{"data-rehype-pretty-code-figure":"","children":["$","pre",null,{"style":{"backgroundColor":"#fff","color":"#24292e"},"tabIndex":"0","data-language":"csharp","data-theme":"github-light","children":["$","code",null,{"data-language":"csharp","data-theme":"github-light","style":{"display":"grid"},"children":[["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#D73A49"},"children":"public"}],["$","span",null,{"style":{"color":"#D73A49"},"children":" interface"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" IAnimalService"}],["$","span",null,{"style":{"color":"#24292E"},"children":" { "}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#D73A49"},"children":"  void"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" Delete"}],["$","span",null,{"style":{"color":"#24292E"},"children":"("}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"Animal"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" animal"}],["$","span",null,{"style":{"color":"#24292E"},"children":"); "}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#D73A49"},"children":"  void"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" Delete"}],["$","span",null,{"style":{"color":"#24292E"},"children":"("}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"IList"}],["$","span",null,{"style":{"color":"#24292E"},"children":"<"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"Animal"}],["$","span",null,{"style":{"color":"#24292E"},"children":"> "}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"animals"}],["$","span",null,{"style":{"color":"#24292E"},"children":"); "}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#6F42C1"},"children":"  Animal"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" Find"}],["$","span",null,{"style":{"color":"#24292E"},"children":"("}],["$","span",null,{"style":{"color":"#D73A49"},"children":"int"}],["$","span",null,{"style":{"color":"#24292E"},"children":"? "}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"id"}],["$","span",null,{"style":{"color":"#24292E"},"children":"); "}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"IList"}],["$","span",null,{"style":{"color":"#24292E"},"children":"<"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"Animal"}],["$","span",null,{"style":{"color":"#24292E"},"children":"> "}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"GetAll"}],["$","span",null,{"style":{"color":"#24292E"},"children":"(); "}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#D73A49"},"children":"  void"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" Save"}],["$","span",null,{"style":{"color":"#24292E"},"children":"("}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"Animal"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" animal"}],["$","span",null,{"style":{"color":"#24292E"},"children":"); "}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#D73A49"},"children":"  void"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" Save"}],["$","span",null,{"style":{"color":"#24292E"},"children":"("}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"IList"}],["$","span",null,{"style":{"color":"#24292E"},"children":"<"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"Animal"}],["$","span",null,{"style":{"color":"#24292E"},"children":"> "}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"animal"}],["$","span",null,{"style":{"color":"#24292E"},"children":"); "}]]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#24292E"},"children":"} "}]}],"\n",["$","span",null,{"data-line":"","children":" "}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#D73A49"},"children":"public"}],["$","span",null,{"style":{"color":"#D73A49"},"children":" class"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" AnimalService"}],["$","span",null,{"style":{"color":"#24292E"},"children":": "}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"IAnimalService"}],["$","span",null,{"style":{"color":"#24292E"},"children":" { "}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#D73A49"},"children":"  private"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" IAnimalRepository"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" animalRepository"}],["$","span",null,{"style":{"color":"#24292E"},"children":";"}]]}],"\n",["$","span",null,{"data-line":"","children":" "}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#D73A49"},"children":"  public"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" AnimalService"}],["$","span",null,{"style":{"color":"#24292E"},"children":"("}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"IAnimalRepository"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" animalRepository"}],["$","span",null,{"style":{"color":"#24292E"},"children":") { "}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#005CC5"},"children":"    this"}],["$","span",null,{"style":{"color":"#24292E"},"children":".animalRepository "}],["$","span",null,{"style":{"color":"#D73A49"},"children":"="}],["$","span",null,{"style":{"color":"#24292E"},"children":" animalRepository; "}]]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#24292E"},"children":"  }"}]}],"\n",["$","span",null,{"data-line":"","children":" "}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#D73A49"},"children":"  public"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" Models"}],["$","span",null,{"style":{"color":"#24292E"},"children":"."}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"Animal"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" Find"}],["$","span",null,{"style":{"color":"#24292E"},"children":"("}],["$","span",null,{"style":{"color":"#D73A49"},"children":"int"}],["$","span",null,{"style":{"color":"#24292E"},"children":"? "}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"id"}],["$","span",null,{"style":{"color":"#24292E"},"children":") { "}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#D73A49"},"children":"    return"}],["$","span",null,{"style":{"color":"#005CC5"},"children":" this"}],["$","span",null,{"style":{"color":"#24292E"},"children":".animalRepository."}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"Find"}],["$","span",null,{"style":{"color":"#24292E"},"children":"(id); "}]]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#24292E"},"children":"  }"}]}],"\n",["$","span",null,{"data-line":"","children":" "}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#D73A49"},"children":"  public"}],["$","span",null,{"style":{"color":"#D73A49"},"children":" void"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" Delete"}],["$","span",null,{"style":{"color":"#24292E"},"children":"("}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"IList"}],["$","span",null,{"style":{"color":"#24292E"},"children":"<"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"Animal"}],["$","span",null,{"style":{"color":"#24292E"},"children":"> "}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"animals"}],["$","span",null,{"style":{"color":"#24292E"},"children":") { "}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#D73A49"},"children":"    foreach"}],["$","span",null,{"style":{"color":"#24292E"},"children":" ("}],["$","span",null,{"style":{"color":"#D73A49"},"children":"var"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" animal"}],["$","span",null,{"style":{"color":"#D73A49"},"children":" in"}],["$","span",null,{"style":{"color":"#24292E"},"children":" animals) { "}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#005CC5"},"children":"      this"}],["$","span",null,{"style":{"color":"#24292E"},"children":".animalRepository."}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"Delete"}],["$","span",null,{"style":{"color":"#24292E"},"children":"(animal); "}]]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#24292E"},"children":"    } "}]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#24292E"},"children":"    "}]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#005CC5"},"children":"    this"}],["$","span",null,{"style":{"color":"#24292E"},"children":".animalRepository."}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"Save"}],["$","span",null,{"style":{"color":"#24292E"},"children":"(); "}]]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#24292E"},"children":"  }"}]}],"\n",["$","span",null,{"data-line":"","children":" "}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#D73A49"},"children":"  public"}],["$","span",null,{"style":{"color":"#D73A49"},"children":" void"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" Delete"}],["$","span",null,{"style":{"color":"#24292E"},"children":"("}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"Models"}],["$","span",null,{"style":{"color":"#24292E"},"children":"."}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"Animal"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" animal"}],["$","span",null,{"style":{"color":"#24292E"},"children":") { "}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#005CC5"},"children":"    this"}],["$","span",null,{"style":{"color":"#24292E"},"children":"."}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"Delete"}],["$","span",null,{"style":{"color":"#24292E"},"children":"("}],["$","span",null,{"style":{"color":"#D73A49"},"children":"new"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" List"}],["$","span",null,{"style":{"color":"#24292E"},"children":"<"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"Animal"}],["$","span",null,{"style":{"color":"#24292E"},"children":"> { animal }); "}]]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#24292E"},"children":"  }"}]}],"\n",["$","span",null,{"data-line":"","children":" "}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#D73A49"},"children":"  public"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" IList"}],["$","span",null,{"style":{"color":"#24292E"},"children":"<"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"Animal"}],["$","span",null,{"style":{"color":"#24292E"},"children":"> "}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"GetAll"}],["$","span",null,{"style":{"color":"#24292E"},"children":"() { "}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#D73A49"},"children":"    return"}],["$","span",null,{"style":{"color":"#005CC5"},"children":" this"}],["$","span",null,{"style":{"color":"#24292E"},"children":".animalRepository."}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"GetAll"}],["$","span",null,{"style":{"color":"#24292E"},"children":"(); "}]]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#24292E"},"children":"  }"}]}],"\n",["$","span",null,{"data-line":"","children":" "}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#D73A49"},"children":"  public"}],["$","span",null,{"style":{"color":"#D73A49"},"children":" void"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" Save"}],["$","span",null,{"style":{"color":"#24292E"},"children":"("}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"Animal"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" animal"}],["$","span",null,{"style":{"color":"#24292E"},"children":") { "}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#6F42C1"},"children":"    Save"}],["$","span",null,{"style":{"color":"#24292E"},"children":"("}],["$","span",null,{"style":{"color":"#D73A49"},"children":"new"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" List"}],["$","span",null,{"style":{"color":"#24292E"},"children":"<"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"Animal"}],["$","span",null,{"style":{"color":"#24292E"},"children":"> { animal }); "}]]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#24292E"},"children":"  }"}]}],"\n",["$","span",null,{"data-line":"","children":" "}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#D73A49"},"children":"  public"}],["$","span",null,{"style":{"color":"#D73A49"},"children":" void"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" Save"}],["$","span",null,{"style":{"color":"#24292E"},"children":"("}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"IList"}],["$","span",null,{"style":{"color":"#24292E"},"children":"<"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"Animal"}],["$","span",null,{"style":{"color":"#24292E"},"children":"> "}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"animals"}],["$","span",null,{"style":{"color":"#24292E"},"children":") { "}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#D73A49"},"children":"    foreach"}],["$","span",null,{"style":{"color":"#24292E"},"children":" ("}],["$","span",null,{"style":{"color":"#D73A49"},"children":"var"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" animal"}],["$","span",null,{"style":{"color":"#D73A49"},"children":" in"}],["$","span",null,{"style":{"color":"#24292E"},"children":" animals) { "}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#D73A49"},"children":"      if"}],["$","span",null,{"style":{"color":"#24292E"},"children":" (animal.Id "}],["$","span",null,{"style":{"color":"#D73A49"},"children":"=="}],["$","span",null,{"style":{"color":"#D73A49"},"children":" default"}],["$","span",null,{"style":{"color":"#24292E"},"children":"("}],["$","span",null,{"style":{"color":"#D73A49"},"children":"int"}],["$","span",null,{"style":{"color":"#24292E"},"children":")) { "}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#005CC5"},"children":"        this"}],["$","span",null,{"style":{"color":"#24292E"},"children":".animalRepository."}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"Insert"}],["$","span",null,{"style":{"color":"#24292E"},"children":"(animal); "}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#24292E"},"children":"      } "}],["$","span",null,{"style":{"color":"#D73A49"},"children":"else"}],["$","span",null,{"style":{"color":"#24292E"},"children":" { "}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#005CC5"},"children":"        this"}],["$","span",null,{"style":{"color":"#24292E"},"children":".animalRepository."}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"Update"}],["$","span",null,{"style":{"color":"#24292E"},"children":"(animal); "}]]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#24292E"},"children":"      } "}]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#24292E"},"children":"    }"}]}],"\n",["$","span",null,{"data-line":"","children":" "}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#005CC5"},"children":"    this"}],["$","span",null,{"style":{"color":"#24292E"},"children":".animalRepository."}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"Save"}],["$","span",null,{"style":{"color":"#24292E"},"children":"(); "}]]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#24292E"},"children":"  } "}]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#24292E"},"children":"}"}]}]]}]}]}],"\n",["$","p",null,{"children":"As you can see, it's better. It also hide the complexity for update and insert by having a single method \"save\". Next, we will create a new repository. We won't code its detail but we will use it inside the AnimalService to simulate a case where we need to interact on several entities."}],"\n",["$","figure",null,{"data-rehype-pretty-code-figure":"","children":["$","pre",null,{"style":{"backgroundColor":"#fff","color":"#24292e"},"tabIndex":"0","data-language":"csharp","data-theme":"github-light","children":["$","code",null,{"data-language":"csharp","data-theme":"github-light","style":{"display":"grid"},"children":[["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#D73A49"},"children":"public"}],["$","span",null,{"style":{"color":"#D73A49"},"children":" class"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" HumanRepository"}],["$","span",null,{"style":{"color":"#24292E"},"children":" : "}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"IHumanRepository"}],["$","span",null,{"style":{"color":"#24292E"},"children":" { } "}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#D73A49"},"children":"public"}],["$","span",null,{"style":{"color":"#D73A49"},"children":" interface"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" IHumanRepository"}],["$","span",null,{"style":{"color":"#24292E"},"children":" { "}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#D73A49"},"children":"  void"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" Insert"}],["$","span",null,{"style":{"color":"#24292E"},"children":"("}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"Models"}],["$","span",null,{"style":{"color":"#24292E"},"children":"."}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"Human"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" humain"}],["$","span",null,{"style":{"color":"#24292E"},"children":"); "}]]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#24292E"},"children":"} "}]}]]}]}]}],"\n",["$","p",null,{"children":"We also need to modify the service to have in its constructor the IHumanRepository."}],"\n",["$","figure",null,{"data-rehype-pretty-code-figure":"","children":["$","pre",null,{"style":{"backgroundColor":"#fff","color":"#24292e"},"tabIndex":"0","data-language":"csharp","data-theme":"github-light","children":["$","code",null,{"data-language":"csharp","data-theme":"github-light","style":{"display":"grid"},"children":[["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#D73A49"},"children":"public"}],["$","span",null,{"style":{"color":"#D73A49"},"children":" class"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" AnimalService"}],["$","span",null,{"style":{"color":"#24292E"},"children":": "}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"IAnimalService"}],["$","span",null,{"style":{"color":"#24292E"},"children":" { "}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#D73A49"},"children":"  private"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" IAnimalRepository"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" animalRepository"}],["$","span",null,{"style":{"color":"#24292E"},"children":"; "}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#D73A49"},"children":"  private"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" IHumanRepository"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" humanRepository"}],["$","span",null,{"style":{"color":"#24292E"},"children":";"}]]}],"\n",["$","span",null,{"data-line":"","children":" "}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#D73A49"},"children":"  public"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" AnimalService"}],["$","span",null,{"style":{"color":"#24292E"},"children":"("}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"IAnimalRepository"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" animalRepository"}],["$","span",null,{"style":{"color":"#24292E"},"children":", "}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"IHumanRepository"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" humanRepository"}],["$","span",null,{"style":{"color":"#24292E"},"children":") { "}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#005CC5"},"children":"    this"}],["$","span",null,{"style":{"color":"#24292E"},"children":".animalRepository "}],["$","span",null,{"style":{"color":"#D73A49"},"children":"="}],["$","span",null,{"style":{"color":"#24292E"},"children":" animalRepository; "}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#005CC5"},"children":"    this"}],["$","span",null,{"style":{"color":"#24292E"},"children":".humanRepository "}],["$","span",null,{"style":{"color":"#D73A49"},"children":"="}],["$","span",null,{"style":{"color":"#24292E"},"children":" humanRepository; "}]]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#24292E"},"children":"  } "}]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#6A737D"},"children":"  //... "}]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#24292E"},"children":"} "}]}]]}]}]}],"\n",["$","p",null,{"children":"Then we can simulate the need to have something in the same transaction between animal and human repository. This can be in the Save method of the AnimalService. Let's create a new save method in the service which take an Animal and also an Human. In IAnimalService we add."}],"\n",["$","figure",null,{"data-rehype-pretty-code-figure":"","children":["$","pre",null,{"style":{"backgroundColor":"#fff","color":"#24292e"},"tabIndex":"0","data-language":"csharp","data-theme":"github-light","children":["$","code",null,{"data-language":"csharp","data-theme":"github-light","style":{"display":"grid"},"children":["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#D73A49"},"children":"void"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" SaveAll"}],["$","span",null,{"style":{"color":"#24292E"},"children":"("}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"Animal"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" animal"}],["$","span",null,{"style":{"color":"#24292E"},"children":", "}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"Human"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" humain"}],["$","span",null,{"style":{"color":"#24292E"},"children":"); "}]]}]}]}]}],"\n",["$","p",null,{"children":"And in the concrete implementation we have :"}],"\n",["$","figure",null,{"data-rehype-pretty-code-figure":"","children":["$","pre",null,{"style":{"backgroundColor":"#fff","color":"#24292e"},"tabIndex":"0","data-language":"csharp","data-theme":"github-light","children":["$","code",null,{"data-language":"csharp","data-theme":"github-light","style":{"display":"grid"},"children":[["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#D73A49"},"children":"public"}],["$","span",null,{"style":{"color":"#D73A49"},"children":" void"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" SaveAll"}],["$","span",null,{"style":{"color":"#24292E"},"children":"("}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"Animal"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" animal"}],["$","span",null,{"style":{"color":"#24292E"},"children":", "}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"Human"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" humain"}],["$","span",null,{"style":{"color":"#24292E"},"children":") { "}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#24292E"},"children":"  his.animalRepository."}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"Insert"}],["$","span",null,{"style":{"color":"#24292E"},"children":"(animal); "}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#005CC5"},"children":"  this"}],["$","span",null,{"style":{"color":"#24292E"},"children":".humanRepository."}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"Insert"}],["$","span",null,{"style":{"color":"#24292E"},"children":"(humain); "}]]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#24292E"},"children":"} "}]}]]}]}]}],"\n",["$","p",null,{"children":"This is where the unit of work is required. The animal repository has its own DbContext and the human repository has its one two. Since both have not the same repository, they are in two different transaction. We could wrap these both lines with a TransactionScope but since Entity Framework is already a transaction scope and since in more complex scenario where we would want to use the DbContext furthermore, having to use the same DbContext is something viable."}],"\n",["$","h1",null,{"children":"Implementing Unit of Work pattern"}],"\n",["$","p",null,{"children":"As we have seen, we need to share the DbContext. This is where the unit of work shines. The first move is to create the unit of work which hold the DbContext."}],"\n",["$","figure",null,{"data-rehype-pretty-code-figure":"","children":["$","pre",null,{"style":{"backgroundColor":"#fff","color":"#24292e"},"tabIndex":"0","data-language":"csharp","data-theme":"github-light","children":["$","code",null,{"data-language":"csharp","data-theme":"github-light","style":{"display":"grid"},"children":[["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#D73A49"},"children":"public"}],["$","span",null,{"style":{"color":"#D73A49"},"children":" interface"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" IUnitOfWork"}],["$","span",null,{"style":{"color":"#24292E"},"children":" { "}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"IDbSet"}],["$","span",null,{"style":{"color":"#24292E"},"children":"<"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"T"}],["$","span",null,{"style":{"color":"#24292E"},"children":"> "}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"Set"}],["$","span",null,{"style":{"color":"#24292E"},"children":"<"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"T"}],["$","span",null,{"style":{"color":"#24292E"},"children":">() "}],["$","span",null,{"style":{"color":"#D73A49"},"children":"where"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" T"}],["$","span",null,{"style":{"color":"#24292E"},"children":":"}],["$","span",null,{"style":{"color":"#D73A49"},"children":"class"}],["$","span",null,{"style":{"color":"#24292E"},"children":";"}]]}],"\n",["$","span",null,{"data-line":"","children":" "}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#6F42C1"},"children":"DbEntityEntry"}],["$","span",null,{"style":{"color":"#24292E"},"children":"<"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"T"}],["$","span",null,{"style":{"color":"#24292E"},"children":"> "}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"Entry"}],["$","span",null,{"style":{"color":"#24292E"},"children":"<"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"T"}],["$","span",null,{"style":{"color":"#24292E"},"children":">("}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"T"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" entity"}],["$","span",null,{"style":{"color":"#24292E"},"children":") "}],["$","span",null,{"style":{"color":"#D73A49"},"children":"where"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" T"}],["$","span",null,{"style":{"color":"#24292E"},"children":":"}],["$","span",null,{"style":{"color":"#D73A49"},"children":"class"}],["$","span",null,{"style":{"color":"#24292E"},"children":";"}]]}],"\n",["$","span",null,{"data-line":"","children":" "}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#D73A49"},"children":"void"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" SaveChanges"}],["$","span",null,{"style":{"color":"#24292E"},"children":"(); } "}]]}]]}]}]}],"\n",["$","p",null,{"children":"The interface could be richer but this should be the minimal number of methods. The implementation is only having a central point for every database sets. In a more domain driven design application we could restrain entities by having a DbContext that is less general than the one created. \"AllDomainContext\" contains all entities set. This is perfect to create the whole database or when your application has a limited number of entities (under 50). But if you are domain driven design or with a big application, to have Entity Framework perform well and restrict the domains, having several DbContext is a good solution. With unit of work and its generic T class, you can pass any domain you want to have."}],"\n",["$","figure",null,{"data-rehype-pretty-code-figure":"","children":["$","pre",null,{"style":{"backgroundColor":"#fff","color":"#24292e"},"tabIndex":"0","data-language":"csharp","data-theme":"github-light","children":["$","code",null,{"data-language":"csharp","data-theme":"github-light","style":{"display":"grid"},"children":[["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#D73A49"},"children":"public"}],["$","span",null,{"style":{"color":"#D73A49"},"children":" class"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" UnitOfWork"}],["$","span",null,{"style":{"color":"#24292E"},"children":"<"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"T"}],["$","span",null,{"style":{"color":"#24292E"},"children":">:"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"IUnitOfWork"}],["$","span",null,{"style":{"color":"#D73A49"},"children":" where"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" T"}],["$","span",null,{"style":{"color":"#24292E"},"children":" : "}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"DbContext"}],["$","span",null,{"style":{"color":"#24292E"},"children":", "}],["$","span",null,{"style":{"color":"#D73A49"},"children":"new"}],["$","span",null,{"style":{"color":"#24292E"},"children":"() { "}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#D73A49"},"children":"  public"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" UnitOfWork"}],["$","span",null,{"style":{"color":"#24292E"},"children":"() { "}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#24292E"},"children":"    DatabaseContext "}],["$","span",null,{"style":{"color":"#D73A49"},"children":"="}],["$","span",null,{"style":{"color":"#D73A49"},"children":" new"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" T"}],["$","span",null,{"style":{"color":"#24292E"},"children":"();"}]]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#24292E"},"children":"  }"}]}],"\n",["$","span",null,{"data-line":"","children":" "}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#D73A49"},"children":"  private"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" T"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" DatabaseContext"}],["$","span",null,{"style":{"color":"#24292E"},"children":" { "}],["$","span",null,{"style":{"color":"#D73A49"},"children":"get"}],["$","span",null,{"style":{"color":"#24292E"},"children":"; "}],["$","span",null,{"style":{"color":"#D73A49"},"children":"set"}],["$","span",null,{"style":{"color":"#24292E"},"children":"; }"}]]}],"\n",["$","span",null,{"data-line":"","children":" "}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#D73A49"},"children":"  public"}],["$","span",null,{"style":{"color":"#D73A49"},"children":" void"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" SaveChanges"}],["$","span",null,{"style":{"color":"#24292E"},"children":"() { DatabaseContext."}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"SaveChanges"}],["$","span",null,{"style":{"color":"#24292E"},"children":"(); }"}]]}],"\n",["$","span",null,{"data-line":"","children":" "}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#D73A49"},"children":"  public"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" System"}],["$","span",null,{"style":{"color":"#24292E"},"children":"."}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"Data"}],["$","span",null,{"style":{"color":"#24292E"},"children":"."}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"Entity"}],["$","span",null,{"style":{"color":"#24292E"},"children":"."}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"IDbSet"}],["$","span",null,{"style":{"color":"#24292E"},"children":"<"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"T"}],["$","span",null,{"style":{"color":"#24292E"},"children":"> "}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"Set"}],["$","span",null,{"style":{"color":"#24292E"},"children":"<"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"T"}],["$","span",null,{"style":{"color":"#24292E"},"children":">() "}],["$","span",null,{"style":{"color":"#D73A49"},"children":"where"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" T"}],["$","span",null,{"style":{"color":"#24292E"},"children":" : "}],["$","span",null,{"style":{"color":"#D73A49"},"children":"class"}],["$","span",null,{"style":{"color":"#24292E"},"children":" { "}],["$","span",null,{"style":{"color":"#D73A49"},"children":"return"}],["$","span",null,{"style":{"color":"#24292E"},"children":" DatabaseContext."}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"Set"}],["$","span",null,{"style":{"color":"#24292E"},"children":"<"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"T"}],["$","span",null,{"style":{"color":"#24292E"},"children":">(); }"}]]}],"\n",["$","span",null,{"data-line":"","children":" "}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#D73A49"},"children":"  public"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" DbEntityEntry"}],["$","span",null,{"style":{"color":"#24292E"},"children":"<"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"T"}],["$","span",null,{"style":{"color":"#24292E"},"children":"> "}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"Entry"}],["$","span",null,{"style":{"color":"#24292E"},"children":"<"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"T"}],["$","span",null,{"style":{"color":"#24292E"},"children":">("}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"T"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" entity"}],["$","span",null,{"style":{"color":"#24292E"},"children":") "}],["$","span",null,{"style":{"color":"#D73A49"},"children":"where"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" T"}],["$","span",null,{"style":{"color":"#24292E"},"children":" : "}],["$","span",null,{"style":{"color":"#D73A49"},"children":"class"}],["$","span",null,{"style":{"color":"#24292E"},"children":" { "}],["$","span",null,{"style":{"color":"#D73A49"},"children":"return"}],["$","span",null,{"style":{"color":"#24292E"},"children":" DatabaseContext."}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"Entry"}],["$","span",null,{"style":{"color":"#24292E"},"children":"<"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"T"}],["$","span",null,{"style":{"color":"#24292E"},"children":">(entity); } "}]]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#24292E"},"children":"} "}]}]]}]}]}],"\n",["$","p",null,{"children":"This unit of work is very general since it can takes T as set. This mean that any entity defined can be used. In our example, with this modified unit of work, the controller needs to be changed too."}],"\n",["$","figure",null,{"data-rehype-pretty-code-figure":"","children":["$","pre",null,{"style":{"backgroundColor":"#fff","color":"#24292e"},"tabIndex":"0","data-language":"csharp","data-theme":"github-light","children":["$","code",null,{"data-language":"csharp","data-theme":"github-light","style":{"display":"grid"},"children":[["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#D73A49"},"children":"public"}],["$","span",null,{"style":{"color":"#D73A49"},"children":" class"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" AnimalController"}],["$","span",null,{"style":{"color":"#24292E"},"children":" : "}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"Controller"}],["$","span",null,{"style":{"color":"#24292E"},"children":" { "}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#D73A49"},"children":"  private"}],["$","span",null,{"style":{"color":"#24292E"},"children":" IAnimalService_service;"}]]}],"\n",["$","span",null,{"data-line":"","children":" "}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#D73A49"},"children":"  public"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" AnimalController"}],["$","span",null,{"style":{"color":"#24292E"},"children":"() { "}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#D73A49"},"children":"    var"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" uow"}],["$","span",null,{"style":{"color":"#D73A49"},"children":" ="}],["$","span",null,{"style":{"color":"#D73A49"},"children":" new"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" UnitOfWork"}],["$","span",null,{"style":{"color":"#24292E"},"children":"<"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"AllDomainContext"}],["$","span",null,{"style":{"color":"#24292E"},"children":">();"}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#24292E"},"children":"    _service "}],["$","span",null,{"style":{"color":"#D73A49"},"children":"="}],["$","span",null,{"style":{"color":"#D73A49"},"children":" new"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" AnimalService"}],["$","span",null,{"style":{"color":"#24292E"},"children":"(uow, "}],["$","span",null,{"style":{"color":"#D73A49"},"children":"new"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" AnimalRepository"}],["$","span",null,{"style":{"color":"#24292E"},"children":"(uow), "}],["$","span",null,{"style":{"color":"#D73A49"},"children":"new"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" HumanRepository"}],["$","span",null,{"style":{"color":"#24292E"},"children":"(uow)); "}]]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#24292E"},"children":"  } "}]}],"\n",["$","span",null,{"data-line":"","children":" "}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#D73A49"},"children":"  public"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" AnimalController"}],["$","span",null,{"style":{"color":"#24292E"},"children":"("}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"IAnimalService"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" animalService"}],["$","span",null,{"style":{"color":"#24292E"},"children":") {"}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#24292E"},"children":"    _service "}],["$","span",null,{"style":{"color":"#D73A49"},"children":"="}],["$","span",null,{"style":{"color":"#24292E"},"children":" animalService; "}]]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#24292E"},"children":"  } "}]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#6A737D"},"children":"  //... "}]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#24292E"},"children":"} "}]}]]}]}]}],"\n",["$","p",null,{"children":"So, the unit of work is instantiated with the domain we want. Here, it's everything. We still have the \"real\" constructor that takes only the IAnimalService which is the one that should be used in the real application with inversion of control to inject the controller. Since it's an article, to keep it simple, I show you what the IoC should do in the background."}],"\n",["$","p",null,{"children":"The animal service is changed too to work with the unit of work."}],"\n",["$","figure",null,{"data-rehype-pretty-code-figure":"","children":["$","pre",null,{"style":{"backgroundColor":"#fff","color":"#24292e"},"tabIndex":"0","data-language":"csharp","data-theme":"github-light","children":["$","code",null,{"data-language":"csharp","data-theme":"github-light","style":{"display":"grid"},"children":[["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#D73A49"},"children":"public"}],["$","span",null,{"style":{"color":"#D73A49"},"children":" class"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" AnimalService"}],["$","span",null,{"style":{"color":"#24292E"},"children":": "}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"IAnimalService"}],["$","span",null,{"style":{"color":"#24292E"},"children":" { "}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#D73A49"},"children":"  private"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" IAnimalRepository"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" animalRepository"}],["$","span",null,{"style":{"color":"#24292E"},"children":"; "}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#D73A49"},"children":"  private"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" IHumanRepository"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" humanRepository"}],["$","span",null,{"style":{"color":"#24292E"},"children":"; "}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#D73A49"},"children":"  private"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" IUnitOfWork"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" unitOfWork"}],["$","span",null,{"style":{"color":"#24292E"},"children":"; "}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#D73A49"},"children":"  public"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" AnimalService"}],["$","span",null,{"style":{"color":"#24292E"},"children":"("}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"IUnitOfWork"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" unitOfWork"}],["$","span",null,{"style":{"color":"#24292E"},"children":", "}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"IAnimalRepository"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" animalRepository"}],["$","span",null,{"style":{"color":"#24292E"},"children":", "}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"IHumanRepository"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" humanRepository"}],["$","span",null,{"style":{"color":"#24292E"},"children":") { "}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#005CC5"},"children":"    this"}],["$","span",null,{"style":{"color":"#24292E"},"children":".unitOfWork "}],["$","span",null,{"style":{"color":"#D73A49"},"children":"="}],["$","span",null,{"style":{"color":"#24292E"},"children":" unitOfWork; "}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#005CC5"},"children":"    this"}],["$","span",null,{"style":{"color":"#24292E"},"children":".animalRepository "}],["$","span",null,{"style":{"color":"#D73A49"},"children":"="}],["$","span",null,{"style":{"color":"#24292E"},"children":" animalRepository; "}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#005CC5"},"children":"    this"}],["$","span",null,{"style":{"color":"#24292E"},"children":".humanRepository "}],["$","span",null,{"style":{"color":"#D73A49"},"children":"="}],["$","span",null,{"style":{"color":"#24292E"},"children":" humanRepository; "}]]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#24292E"},"children":"  }"}]}],"\n",["$","span",null,{"data-line":"","children":" "}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#D73A49"},"children":"  public"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" Animal"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" Find"}],["$","span",null,{"style":{"color":"#24292E"},"children":"("}],["$","span",null,{"style":{"color":"#D73A49"},"children":"int"}],["$","span",null,{"style":{"color":"#24292E"},"children":"? "}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"id"}],["$","span",null,{"style":{"color":"#24292E"},"children":") { "}],["$","span",null,{"style":{"color":"#D73A49"},"children":"return"}],["$","span",null,{"style":{"color":"#005CC5"},"children":" this"}],["$","span",null,{"style":{"color":"#24292E"},"children":".animalRepository."}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"Find"}],["$","span",null,{"style":{"color":"#24292E"},"children":"(id); }"}]]}],"\n",["$","span",null,{"data-line":"","children":" "}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#D73A49"},"children":"  public"}],["$","span",null,{"style":{"color":"#D73A49"},"children":" void"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" Delete"}],["$","span",null,{"style":{"color":"#24292E"},"children":"("}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"IList"}],["$","span",null,{"style":{"color":"#24292E"},"children":"<"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"Animal"}],["$","span",null,{"style":{"color":"#24292E"},"children":"> "}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"animals"}],["$","span",null,{"style":{"color":"#24292E"},"children":") { "}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#D73A49"},"children":"    foreach"}],["$","span",null,{"style":{"color":"#24292E"},"children":" ("}],["$","span",null,{"style":{"color":"#D73A49"},"children":"var"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" animal"}],["$","span",null,{"style":{"color":"#D73A49"},"children":" in"}],["$","span",null,{"style":{"color":"#24292E"},"children":" animals) { "}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#005CC5"},"children":"      this"}],["$","span",null,{"style":{"color":"#24292E"},"children":".animalRepository."}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"Delete"}],["$","span",null,{"style":{"color":"#24292E"},"children":"(animal); "}]]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#24292E"},"children":"    }"}]}],"\n",["$","span",null,{"data-line":"","children":" "}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#005CC5"},"children":"    this"}],["$","span",null,{"style":{"color":"#24292E"},"children":".unitOfWork."}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"SaveChanges"}],["$","span",null,{"style":{"color":"#24292E"},"children":"(); "}]]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#24292E"},"children":"  }"}]}],"\n",["$","span",null,{"data-line":"","children":" "}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#D73A49"},"children":"  public"}],["$","span",null,{"style":{"color":"#D73A49"},"children":" void"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" Delete"}],["$","span",null,{"style":{"color":"#24292E"},"children":"("}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"Models"}],["$","span",null,{"style":{"color":"#24292E"},"children":"."}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"Animal"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" animal"}],["$","span",null,{"style":{"color":"#24292E"},"children":") { "}],["$","span",null,{"style":{"color":"#005CC5"},"children":"this"}],["$","span",null,{"style":{"color":"#24292E"},"children":"."}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"Delete"}],["$","span",null,{"style":{"color":"#24292E"},"children":"("}],["$","span",null,{"style":{"color":"#D73A49"},"children":"new"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" List"}],["$","span",null,{"style":{"color":"#24292E"},"children":"<"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"Animal"}],["$","span",null,{"style":{"color":"#24292E"},"children":"> { animal }); }"}]]}],"\n",["$","span",null,{"data-line":"","children":" "}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#D73A49"},"children":"  public"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" IList"}],["$","span",null,{"style":{"color":"#24292E"},"children":"<"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"Animal"}],["$","span",null,{"style":{"color":"#24292E"},"children":"> "}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"GetAll"}],["$","span",null,{"style":{"color":"#24292E"},"children":"() { "}],["$","span",null,{"style":{"color":"#D73A49"},"children":"return"}],["$","span",null,{"style":{"color":"#005CC5"},"children":" this"}],["$","span",null,{"style":{"color":"#24292E"},"children":".animalRepository."}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"GetAll"}],["$","span",null,{"style":{"color":"#24292E"},"children":"(); }"}]]}],"\n",["$","span",null,{"data-line":"","children":" "}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#D73A49"},"children":"  public"}],["$","span",null,{"style":{"color":"#D73A49"},"children":" void"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" Save"}],["$","span",null,{"style":{"color":"#24292E"},"children":"("}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"Animal"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" animal"}],["$","span",null,{"style":{"color":"#24292E"},"children":") { "}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"Save"}],["$","span",null,{"style":{"color":"#24292E"},"children":"("}],["$","span",null,{"style":{"color":"#D73A49"},"children":"new"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" List"}],["$","span",null,{"style":{"color":"#24292E"},"children":"<"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"Animal"}],["$","span",null,{"style":{"color":"#24292E"},"children":"> { animal }); }"}]]}],"\n",["$","span",null,{"data-line":"","children":" "}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#D73A49"},"children":"  public"}],["$","span",null,{"style":{"color":"#D73A49"},"children":" void"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" Save"}],["$","span",null,{"style":{"color":"#24292E"},"children":"("}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"IList"}],["$","span",null,{"style":{"color":"#24292E"},"children":"<"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"Animal"}],["$","span",null,{"style":{"color":"#24292E"},"children":"> "}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"animals"}],["$","span",null,{"style":{"color":"#24292E"},"children":") { "}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#D73A49"},"children":"    foreach"}],["$","span",null,{"style":{"color":"#24292E"},"children":" ("}],["$","span",null,{"style":{"color":"#D73A49"},"children":"var"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" animal"}],["$","span",null,{"style":{"color":"#D73A49"},"children":" in"}],["$","span",null,{"style":{"color":"#24292E"},"children":" animals) { "}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#D73A49"},"children":"      if"}],["$","span",null,{"style":{"color":"#24292E"},"children":" (animal.Id "}],["$","span",null,{"style":{"color":"#D73A49"},"children":"=="}],["$","span",null,{"style":{"color":"#D73A49"},"children":" default"}],["$","span",null,{"style":{"color":"#24292E"},"children":"("}],["$","span",null,{"style":{"color":"#D73A49"},"children":"int"}],["$","span",null,{"style":{"color":"#24292E"},"children":")) { "}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#005CC5"},"children":"        this"}],["$","span",null,{"style":{"color":"#24292E"},"children":".animalRepository."}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"Insert"}],["$","span",null,{"style":{"color":"#24292E"},"children":"(animal); "}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#24292E"},"children":"      } "}],["$","span",null,{"style":{"color":"#D73A49"},"children":"else"}],["$","span",null,{"style":{"color":"#24292E"},"children":" { "}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#005CC5"},"children":"        this"}],["$","span",null,{"style":{"color":"#24292E"},"children":".animalRepository."}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"Update"}],["$","span",null,{"style":{"color":"#24292E"},"children":"(animal); "}]]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#24292E"},"children":"      } "}]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#24292E"},"children":"    }"}]}],"\n",["$","span",null,{"data-line":"","children":" "}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#005CC5"},"children":"    this"}],["$","span",null,{"style":{"color":"#24292E"},"children":".unitOfWork."}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"SaveChanges"}],["$","span",null,{"style":{"color":"#24292E"},"children":"(); "}]]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#24292E"},"children":"  }"}]}],"\n",["$","span",null,{"data-line":"","children":" "}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#D73A49"},"children":"  public"}],["$","span",null,{"style":{"color":"#D73A49"},"children":" void"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" SaveAll"}],["$","span",null,{"style":{"color":"#24292E"},"children":"("}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"Animal"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" animal"}],["$","span",null,{"style":{"color":"#24292E"},"children":", "}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"Human"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" humain"}],["$","span",null,{"style":{"color":"#24292E"},"children":") { "}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#005CC5"},"children":"    this"}],["$","span",null,{"style":{"color":"#24292E"},"children":".animalRepository."}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"Insert"}],["$","span",null,{"style":{"color":"#24292E"},"children":"(animal); "}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#005CC5"},"children":"    this"}],["$","span",null,{"style":{"color":"#24292E"},"children":".humanRepository."}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"Insert"}],["$","span",null,{"style":{"color":"#24292E"},"children":"(humain); "}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#005CC5"},"children":"    this"}],["$","span",null,{"style":{"color":"#24292E"},"children":".unitOfWork."}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"SaveChanges"}],["$","span",null,{"style":{"color":"#24292E"},"children":"(); "}]]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#24292E"},"children":"  } "}]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#24292E"},"children":"} "}]}]]}]}]}],"\n",["$","p",null,{"children":"The repository now accepts the unit of work. It can works with set defined in the domain without problem."}],"\n",["$","figure",null,{"data-rehype-pretty-code-figure":"","children":["$","pre",null,{"style":{"backgroundColor":"#fff","color":"#24292e"},"tabIndex":"0","data-language":"csharp","data-theme":"github-light","children":["$","code",null,{"data-language":"csharp","data-theme":"github-light","style":{"display":"grid"},"children":[["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#D73A49"},"children":"public"}],["$","span",null,{"style":{"color":"#D73A49"},"children":" class"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" AnimalRepository"}],["$","span",null,{"style":{"color":"#24292E"},"children":" : "}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"WebsiteForUnitOfWork"}],["$","span",null,{"style":{"color":"#24292E"},"children":"."}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"DataAccessLayer"}],["$","span",null,{"style":{"color":"#24292E"},"children":"."}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"Repositories"}],["$","span",null,{"style":{"color":"#24292E"},"children":"."}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"IAnimalRepository"}],["$","span",null,{"style":{"color":"#24292E"},"children":" { "}]]}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#D73A49"},"children":"  private"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" IUnitOfWork"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" UnitOfWork"}],["$","span",null,{"style":{"color":"#24292E"},"children":" { "}],["$","span",null,{"style":{"color":"#D73A49"},"children":"get"}],["$","span",null,{"style":{"color":"#24292E"},"children":"; "}],["$","span",null,{"style":{"color":"#D73A49"},"children":"set"}],["$","span",null,{"style":{"color":"#24292E"},"children":"; }"}]]}],"\n",["$","span",null,{"data-line":"","children":" "}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#D73A49"},"children":"  public"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" AnimalRepository"}],["$","span",null,{"style":{"color":"#24292E"},"children":"("}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"IUnitOfWork"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" unitOfWork"}],["$","span",null,{"style":{"color":"#24292E"},"children":") { "}],["$","span",null,{"style":{"color":"#005CC5"},"children":"this"}],["$","span",null,{"style":{"color":"#24292E"},"children":".UnitOfWork "}],["$","span",null,{"style":{"color":"#D73A49"},"children":"="}],["$","span",null,{"style":{"color":"#24292E"},"children":" unitOfWork; }"}]]}],"\n",["$","span",null,{"data-line":"","children":" "}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#D73A49"},"children":"  public"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" Models"}],["$","span",null,{"style":{"color":"#24292E"},"children":"."}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"Animal"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" Find"}],["$","span",null,{"style":{"color":"#24292E"},"children":"("}],["$","span",null,{"style":{"color":"#D73A49"},"children":"int"}],["$","span",null,{"style":{"color":"#24292E"},"children":"? "}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"id"}],["$","span",null,{"style":{"color":"#24292E"},"children":") { "}],["$","span",null,{"style":{"color":"#D73A49"},"children":"return"}],["$","span",null,{"style":{"color":"#24292E"},"children":" UnitOfWork."}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"Set"}],["$","span",null,{"style":{"color":"#24292E"},"children":"<"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"Animal"}],["$","span",null,{"style":{"color":"#24292E"},"children":">()."}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"Find"}],["$","span",null,{"style":{"color":"#24292E"},"children":"(id); }"}]]}],"\n",["$","span",null,{"data-line":"","children":" "}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#D73A49"},"children":"  public"}],["$","span",null,{"style":{"color":"#D73A49"},"children":" void"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" Insert"}],["$","span",null,{"style":{"color":"#24292E"},"children":"("}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"Models"}],["$","span",null,{"style":{"color":"#24292E"},"children":"."}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"Animal"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" animal"}],["$","span",null,{"style":{"color":"#24292E"},"children":") { UnitOfWork."}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"Set"}],["$","span",null,{"style":{"color":"#24292E"},"children":"<"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"Animal"}],["$","span",null,{"style":{"color":"#24292E"},"children":">()."}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"Add"}],["$","span",null,{"style":{"color":"#24292E"},"children":"(animal); }"}]]}],"\n",["$","span",null,{"data-line":"","children":" "}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#D73A49"},"children":"  public"}],["$","span",null,{"style":{"color":"#D73A49"},"children":" void"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" Update"}],["$","span",null,{"style":{"color":"#24292E"},"children":"("}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"Models"}],["$","span",null,{"style":{"color":"#24292E"},"children":"."}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"Animal"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" animal"}],["$","span",null,{"style":{"color":"#24292E"},"children":") { UnitOfWork."}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"Entry"}],["$","span",null,{"style":{"color":"#24292E"},"children":"(animal).State "}],["$","span",null,{"style":{"color":"#D73A49"},"children":"="}],["$","span",null,{"style":{"color":"#24292E"},"children":" EntityState.Modified; }"}]]}],"\n",["$","span",null,{"data-line":"","children":" "}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#D73A49"},"children":"  public"}],["$","span",null,{"style":{"color":"#D73A49"},"children":" void"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" Delete"}],["$","span",null,{"style":{"color":"#24292E"},"children":"("}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"Models"}],["$","span",null,{"style":{"color":"#24292E"},"children":"."}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"Animal"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" animal"}],["$","span",null,{"style":{"color":"#24292E"},"children":") { UnitOfWork."}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"Set"}],["$","span",null,{"style":{"color":"#24292E"},"children":"<"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"Animal"}],["$","span",null,{"style":{"color":"#24292E"},"children":">()."}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"Remove"}],["$","span",null,{"style":{"color":"#24292E"},"children":"(animal); }"}]]}],"\n",["$","span",null,{"data-line":"","children":" "}],"\n",["$","span",null,{"data-line":"","children":[["$","span",null,{"style":{"color":"#D73A49"},"children":"  public"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":" IList"}],["$","span",null,{"style":{"color":"#24292E"},"children":"<"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"Animal"}],["$","span",null,{"style":{"color":"#24292E"},"children":"> "}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"GetAll"}],["$","span",null,{"style":{"color":"#24292E"},"children":"() { "}],["$","span",null,{"style":{"color":"#D73A49"},"children":"return"}],["$","span",null,{"style":{"color":"#24292E"},"children":" UnitOfWork."}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"Set"}],["$","span",null,{"style":{"color":"#24292E"},"children":"<"}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"Animal"}],["$","span",null,{"style":{"color":"#24292E"},"children":">()."}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"AsNoTracking"}],["$","span",null,{"style":{"color":"#24292E"},"children":"()."}],["$","span",null,{"style":{"color":"#6F42C1"},"children":"ToList"}],["$","span",null,{"style":{"color":"#24292E"},"children":"(); } "}]]}],"\n",["$","span",null,{"data-line":"","children":["$","span",null,{"style":{"color":"#24292E"},"children":"} "}]}]]}]}]}],"\n",["$","p",null,{"children":"It's possible to continue to improve the unit of work and Entity Framework by going further in the use of the repository. But, what have been shown here is enterprise graded repository design. It allows you to divide the domain and improve the performance of Entity Framework by the same time. It allows to have an abstraction between the Asp.Net MVC front and the Entity Framework. It easily testable because we use interface which can be mocked easily. Benefits are clear but the price to pay is the overwhelm required to support this infrastructure. More classes need to be in place. Still, the version presented is light and once the setup is done, adding new entity is only a matter of editing the context in which it belongs and create into the repository what action is needed."}],"\n",["$","h1",null,{"children":"Source code"}],"\n",["$","p",null,{"children":["You can find the source code on ",["$","a",null,{"href":"https://github.com/MrDesjardins/WebsiteForUnitOfWork","children":"GitHub for this Unit of work example"}],"."]}]]]}]]}],["$","div",null,{"className":"layout_paginationBar__jnuuR","children":[["$","div",null,{"className":"layout_paginationTitle__PsOw5","children":"Chronological Blog Articles by Page"}],["$","div",null,{"className":"layout_paginationLinks__LdBaH","children":[["$","$L6","1",{"className":"","href":"/blog/page/1","children":1}],["$","$L6","2",{"className":"","href":"/blog/page/2","children":2}],["$","$L6","3",{"className":"","href":"/blog/page/3","children":3}],["$","$L6","4",{"className":"","href":"/blog/page/4","children":4}],["$","$L6","5",{"className":"","href":"/blog/page/5","children":5}],["$","$L6","6",{"className":"","href":"/blog/page/6","children":6}],["$","$L6","7",{"className":"","href":"/blog/page/7","children":7}],["$","$L6","8",{"className":"","href":"/blog/page/8","children":8}],["$","$L6","9",{"className":"","href":"/blog/page/9","children":9}],["$","$L6","10",{"className":"","href":"/blog/page/10","children":10}],["$","$L6","11",{"className":"","href":"/blog/page/11","children":11}],["$","$L6","12",{"className":"","href":"/blog/page/12","children":12}],["$","$L6","13",{"className":"","href":"/blog/page/13","children":13}],["$","$L6","14",{"className":"","href":"/blog/page/14","children":14}],["$","$L6","15",{"className":"","href":"/blog/page/15","children":15}],["$","$L6","16",{"className":"","href":"/blog/page/16","children":16}],["$","$L6","17",{"className":"","href":"/blog/page/17","children":17}],["$","$L6","18",{"className":"","href":"/blog/page/18","children":18}],["$","$L6","19",{"className":"","href":"/blog/page/19","children":19}],["$","$L6","20",{"className":"","href":"/blog/page/20","children":20}],["$","$L6","21",{"className":"","href":"/blog/page/21","children":21}],["$","$L6","22",{"className":"","href":"/blog/page/22","children":22}],["$","$L6","23",{"className":"","href":"/blog/page/23","children":23}],["$","$L6","24",{"className":"","href":"/blog/page/24","children":24}],["$","$L6","25",{"className":"","href":"/blog/page/25","children":25}],["$","$L6","26",{"className":"","href":"/blog/page/26","children":26}],["$","$L6","27",{"className":"","href":"/blog/page/27","children":27}],["$","$L6","28",{"className":"","href":"/blog/page/28","children":28}],["$","$L6","29",{"className":"","href":"/blog/page/29","children":29}],["$","$L6","30",{"className":"","href":"/blog/page/30","children":30}],["$","$L6","31",{"className":"","href":"/blog/page/31","children":31}],["$","$L6","32",{"className":"","href":"/blog/page/32","children":32}],["$","$L6","33",{"className":"","href":"/blog/page/33","children":33}],["$","$L6","34",{"className":"","href":"/blog/page/34","children":34}],["$","$L6","35",{"className":"","href":"/blog/page/35","children":35}],["$","$L6","36",{"className":"","href":"/blog/page/36","children":36}],["$","$L6","37",{"className":"","href":"/blog/page/37","children":37}],["$","$L6","38",{"className":"","href":"/blog/page/38","children":38}],["$","$L6","39",{"className":"","href":"/blog/page/39","children":39}],["$","$L6","40",{"className":"","href":"/blog/page/40","children":40}],["$","$L6","41",{"className":"","href":"/blog/page/41","children":41}],["$","$L6","42",{"className":"","href":"/blog/page/42","children":42}],["$","$L6","43",{"className":"","href":"/blog/page/43","children":43}],["$","$L6","44",{"className":"","href":"/blog/page/44","children":44}],["$","$L6","45",{"className":"","href":"/blog/page/45","children":45}],["$","$L6","46",{"className":"","href":"/blog/page/46","children":46}],["$","$L6","47",{"className":"","href":"/blog/page/47","children":47}],["$","$L6","48",{"className":"","href":"/blog/page/48","children":48}],["$","$L6","49",{"className":"","href":"/blog/page/49","children":49}],["$","$L6","50",{"className":"","href":"/blog/page/50","children":50}],["$","$L6","51",{"className":"","href":"/blog/page/51","children":51}],["$","$L6","52",{"className":"","href":"/blog/page/52","children":52}],["$","$L6","53",{"className":"","href":"/blog/page/53","children":53}],["$","$L6","54",{"className":"","href":"/blog/page/54","children":54}],["$","$L6","55",{"className":"","href":"/blog/page/55","children":55}],["$","$L6","56",{"className":"","href":"/blog/page/56","children":56}],["$","$L6","57",{"className":"","href":"/blog/page/57","children":57}],["$","$L6","58",{"className":"","href":"/blog/page/58","children":58}],["$","$L6","59",{"className":"","href":"/blog/page/59","children":59}],["$","$L6","60",{"className":"","href":"/blog/page/60","children":60}],["$","$L6","61",{"className":"","href":"/blog/page/61","children":61}],["$","$L6","62",{"className":"","href":"/blog/page/62","children":62}],["$","$L6","63",{"className":"","href":"/blog/page/63","children":63}],["$","$L6","64",{"className":"","href":"/blog/page/64","children":64}],["$","$L6","65",{"className":"","href":"/blog/page/65","children":65}],["$","$L6","66",{"className":"","href":"/blog/page/66","children":66}],["$","$L6","67",{"className":"","href":"/blog/page/67","children":67}],["$","$L6","68",{"className":"","href":"/blog/page/68","children":68}],["$","$L6","69",{"className":"","href":"/blog/page/69","children":69}],["$","$L6","70",{"className":"","href":"/blog/page/70","children":70}],["$","$L6","71",{"className":"","href":"/blog/page/71","children":71}],["$","$L6","72",{"className":"","href":"/blog/page/72","children":72}],["$","$L6","73",{"className":"","href":"/blog/page/73","children":73}],["$","$L6","74",{"className":"","href":"/blog/page/74","children":74}],["$","$L6","75",{"className":"","href":"/blog/page/75","children":75}],["$","$L6","76",{"className":"","href":"/blog/page/76","children":76}],["$","$L6","77",{"className":"","href":"/blog/page/77","children":77}]]}]]}]]}]}]
