<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="preload" href="/_next/static/media/c9a5bc6a7c948fb0-s.p.woff2" as="font" crossorigin="" type="font/woff2"/><link rel="preload" as="image" href="/images/blog/OpenFromSourceControl.png"/><link rel="preload" as="image" href="/images/blog/ConnectToTFS.png"/><link rel="preload" as="image" href="/images/blog/TFS_SprintPeriode.png"/><link rel="preload" as="image" href="/images/blog/TFS_BackLogItem.png"/><link rel="preload" as="image" href="/images/blog/TFS_NewBackLogItemFromVS-1024x260.png"/><link rel="preload" as="image" href="/images/blog/TFS_BackLogItemList.png"/><link rel="preload" as="image" href="/images/blog/TFS_AssignSprint.png"/><link rel="preload" as="image" href="/images/blog/TFS_VS_WebPortalSprint1-1024x345.png"/><link rel="preload" as="image" href="/images/blog/TFS_Capacity.png"/><link rel="preload" as="image" href="/images/blog/TFS_WorkDetail.png"/><link rel="stylesheet" href="/_next/static/css/4f3d065c9e2d01e0.css" crossorigin="" data-precedence="next"/><link rel="stylesheet" href="/_next/static/css/67b0a31e2d30ff16.css" crossorigin="" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/_next/static/chunks/webpack-c95d176287d2fe2d.js" crossorigin=""/><script src="/_next/static/chunks/fd9d1056-cc48c28d170fddc2.js" async="" crossorigin=""></script><script src="/_next/static/chunks/69-c7efea4b65083e7f.js" async="" crossorigin=""></script><script src="/_next/static/chunks/main-app-f550f103b66f998a.js" async="" crossorigin=""></script><script src="/_next/static/chunks/250-d7e0a94ebe194dac.js" async=""></script><script src="/_next/static/chunks/79-2d03397107aae3f1.js" async=""></script><script src="/_next/static/chunks/app/blog/%5Bslug%5D/page-0cf4a8a9432ed6ce.js" async=""></script><link rel="preload" as="image" href="/images/blog/TFS_ComplexType.png"/><link rel="preload" as="image" href="/images/blog/Classes_Users-1024x388.png"/><link rel="preload" as="image" href="/images/blog/Classes_Contest-1-1024x573.png"/><link rel="preload" as="image" href="/images/blog/Classes_Trading-1024x520.png"/><link rel="preload" as="image" href="/images/blog/Classes_RealTime.png"/><link rel="preload" as="image" href="/images/blog/ArchitectureBourseVirtuelle-1024x546.png"/><link rel="preload" as="image" href="/images/blog/LayersBourseVirtuelle.png"/><link rel="preload" as="image" href="/images/blog/DetailledArchitecture.png"/><link rel="preload" as="image" href="/images/blog/Part1Project.png"/><link rel="preload" as="image" href="/images/blog/Part2Project-1.png"/><link rel="preload" as="image" href="/images/blog/DataAccessBourseVirtuelle-1024x590.png"/><link rel="preload" as="image" href="/images/blog/WebSiteBourseVirtuelle.png"/><link rel="preload" as="image" href="/images/blog/ModelUserBourseVirtuelle.png"/><link rel="preload" as="image" href="/images/blog/EmailProviderBourseVirtuelle.png"/><link rel="preload" as="image" href="/images/blog/Sprint2ModelViewModel.png"/><link rel="preload" as="image" href="/images/blog/Sprint2SequenceDiagramCreateUser.png"/><link rel="preload" as="image" href="/images/blog/Classes_Contest-1024x573.png"/><link rel="preload" as="image" href="/images/blog/Part2Project.png"/><link rel="preload" as="image" href="/images/blog/Builders.png"/><link rel="preload" as="image" href="/images/blog/ModelState-1024x436.png"/><link rel="preload" as="image" href="/images/blog/Sprint3BuilderCrossLayer-1024x504.png"/><link rel="preload" as="image" href="/images/blog/FirstCommit.png"/><link rel="preload" as="image" href="/images/blog/AspNetRoleUserTables.png"/><link rel="preload" as="image" href="/images/blog/DataValuesUserRoles.png"/><link rel="preload" as="image" href="/images/blog/GridFullSize-1024x311.png"/><link rel="preload" as="image" href="/images/blog/GridTabletSize.png"/><link rel="preload" as="image" href="/images/blog/GridMobile.png"/><link rel="preload" as="image" href="/images/blog/EnterContest.png"/><link rel="preload" as="image" href="/images/blog/JoinButton-1024x678.png"/><link rel="preload" as="image" href="/images/blog/BusinessLayerClassesSegregation.png"/><link rel="preload" as="image" href="/images/blog/TradingAndOrderClasses.png"/><link rel="preload" as="image" href="/images/blog/ApplicationPoolIdentity.png"/><link rel="preload" as="image" href="/images/blog/LoginProperties-1024x581.png"/><link rel="preload" as="image" href="/images/blog/UserMapping.png"/><title>Patrick Desjardins Blog - Asp.Net MVC Project, SQL Server, Redis and managed with VSTS</title><meta name="description" content="Asp.Net MVC Project, SQL Server, Redis and managed with VSTS"/><meta name="next-size-adjust"/><script src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js" crossorigin="" noModule=""></script></head><body class="layout_bodystyle__4ncsS"><div class="__className_aaf875"><div class="layout_container__Tovb9"><header class="layout_siteTitle__k5U8g">Patrick Desjardins Blog</header><nav><ul class="layout_navLinks__mf70r"><li class="layout_navLinkItem__1L8fB"><a class="layout_navLinkText__bt28R" href="/">Main Page</a><a class="layout_navLinkText__bt28R" href="/blog">Blog</a><a class="layout_navLinkText__bt28R" href="/blog/for/2024">2024</a><a class="layout_navLinkText__bt28R" href="/blog/for/2023">2023</a><a class="layout_navLinkText__bt28R" href="/blog/for/2022">2022</a><a class="layout_navLinkText__bt28R" href="/blog/for/2021">2021</a><a class="layout_navLinkText__bt28R" href="/blog/for/2020">2020</a><a class="layout_navLinkText__bt28R" href="/blog/for/2019">2019</a><a class="layout_navLinkText__bt28R" href="/blog/for/2018">2018</a><a class="layout_navLinkText__bt28R" href="/blog/for/2017">2017</a><a class="layout_navLinkText__bt28R" href="/blog/for/2016">2016</a><a class="layout_navLinkText__bt28R" href="/blog/for/2015">2015</a><a class="layout_navLinkText__bt28R" href="/blog/for/2014">2014</a><a class="layout_navLinkText__bt28R" href="/blog/for/2013">2013</a><a class="layout_navLinkText__bt28R" href="/blog/for/2012">2012</a><a class="layout_navLinkText__bt28R" href="/blog/for/2011">2011</a></li></ul></nav><div class="layout_blogPictureContainer__XC7nK"><img alt="Patrick Desjardins picture from a conference" loading="lazy" width="800" height="260" decoding="async" data-nimg="1" class="layout_blogTopPicture__RJHNN" style="color:transparent" src="/images/backgrounds/patrickdesjardins_conference_bw.jpeg"/></div><main class="layout_main__mXTwS"><h1>Asp.Net MVC Project, SQL Server, Redis and managed with VSTS</h1><div class="layout_blogPostContainer__WYELx"><p class="layout_blogPostDate__LUvx5">Posted on: <!-- -->2016-04-04</p><p>In the winter of 2014 I decided to re-code my virtual stock exchange <a href="http://www.boursevirtuelle.com">boursevirtuelle.com</a>. The initial project started in 2004 and got released in 2005. From there, features got added, some removed. Technologies changed from not having Jquery to a transition with mostly only using it. The backend was done in MySql and MemCached on a Linux VPS. I have learned a lot and while the website is still running, around 2008 I was less interested into it. Mostly because with Asp.Net MVC I was able to have more control hover the Html than the traditional Asp.Net Webform, I loved Microsoft&#x27;s tool and I was working in the Microsoft ecosystem professionally. This side project always was a playground to try new things, experiment on technologies and patterns and I wanted to try more stuff on my own with the .Net environment. The PHP project started to feel older, adding feature was more and more problematic due to the lack of automation. Unit tests were introduced in the last month of 2008, new features added around 2010 got some but never had anything automated. While I am glad to got that experience, I was ready to work on something else without killing the whole project.</p>
<p>This is when I thought that I can redo the virtual stock exchange instead of a new complete idea. I had a strong view about what is the business logic and could just jump on the code. I started a blog where I was describing every sprints (1 month). This one ran from January 2014 to August 2014 where I got approached by Microsoft to come work for them, at Redmond USA. I have been continue to develop the new simulator but stopped blogging about it. This post contains the information that I posed in the old blog that is now not anymore online. I will post further detail about what I have learn during the project directly on this blog in the future.</p>
<h1>Setuping Team Foundation Server (TFS) January 26, 2014 By: pdesjardins</h1>
<p>Posted in Application Life Cycle The project is just starting and before even thinking about how to create the code, we need to do some application life cycle management. Team Foundation Server offers an online edition since few months and I believe it is the perfect software for this open source online application. You can get an account at VisualStudio.com. Once logged, you can create you own repository. I have created one named “BourseVirtuelle.com” which is the name of the website.</p>
<p>TFS online provides many tools. First, it has the TFS source control. All code will be located online with TFS. TFS and Visual Studio is tightly coupled with TFS which confirm the use of TFS. TFS also gives a good platform for activities. This is essential if we want to track the work to be done, bug tracking and future features to add. It has also a build server and testing capability. Since we are creating a enterprise website and not only a simple Asp.Net MVC tutorial, we will create unit test and we will execute automatized unit tests. Finally, TFS online offer the possibilities for deployment. Since this website is about how to create an Asp.Net MVC from the beginning to the end, we want to deploy everything in a later stage.</p>
<p>The TFS account used for this project is mine : https://patrickdesjardins.visualstudio.com and the project name is BourseVirtuelle.com (which will have its English version at StockVirtual.com).</p>
<p>Once created, it is the time to synchronize Visual Studio with TFS. Open Visual Studio and click Open from Source Control …</p>
<p><img src="/images/blog/OpenFromSourceControl.png" alt=""/></p>
<p>A window popup opens with the possibility to select a Team Foundation Server. I enter the URL that I have previously specified in this blog post and hit enter. From here, I can see all Team Projects available. I choose the BourseVirtuelle.com project and hit Connect.</p>
<p><img src="/images/blog/ConnectToTFS.png" alt=""/></p>
<p>This step synchronize TFS and Visual Studio. It is possible to control TFS from Visual Studio with the Team Explorer tab.</p>
<p>I will end this post here and continue later. The next step is to create some Work Items. Work Items are element for managing the work to be done on the project. Since it is a big project that will be built part-time on spare time, it is a good idea to keep track of what needs to be done.</p>
<h1>Creating task with Team Foundation Server February 3, 2014 By: pdesjardins</h1>
<p>We have now Visual Studio and TFS connected. It is the time to plan what we will do for the next sprint. Since we are not full time on this project, I plan to have monthly sprint. Maybe 10 hours per week will be set on this project, so a month is about 40 hours for 1 person. The first month will be mostly on configuring the project. But before planning anything, let’s setup TFS.</p>
<p>Visual Studio cannot change the backlog time frame. This is why, we will jump into the web portal. Once in the web portal, select WORK at the top of the screen. From there, you can choose Backlogs. When you select a sprint, you can then click at the top right the “No iteration dates” to setup and assign a range. At anytime it is possible to click the date and change the starting and ending date. It is also possible to rename the sprint.</p>
<p><img src="/images/blog/TFS_SprintPeriode.png" alt=""/></p>
<p>We are now ready to enter few back log items. Back log items are a use case. This one will be defined later in smaller task. A group of back log can be a feature. It is possible to work with TFS from big to small or small to big. I am note sure that I will go as much deep with Work Item for this project and will start just by defining Work Item as back log item.</p>
<p>The first step is to click BackLog items in the Work-&gt;Backlogs menu.</p>
<p><img src="/images/blog/TFS_BackLogItem.png" alt=""/></p>
<p>The type can be “Product Backlog Item” or “Bug”. Every time title are entered and the Add button is hit, then the grid below the form is filled up. But this is not the only way to create Backlog items. We can do it directly into Visual Studio 2013. First, open the Team Explorer. Second, on the home screen, click Work Items. Third, click New Work Item at the top of this panel.</p>
<p><img src="/images/blog/TFS_NewBackLogItemFromVS-1024x260.png" alt=""/></p>
<p>In both case system, the web portal and Visual Studio, it is possible to create a list of Work Item. Visual Studio may looks to have more field but in fact, the web portal does have them too. Once it is created from the team portal, right clicking Work Item in the grid and selecting Open, opens the Work Item with all fields.</p>
<p>At any time, from Visual Studio or the web portal, it is possible to see the list of backlog item. In Visual Studio, the list if under the Team Explorer, Work Items. A sub panel labelled Queries has a Shared Queries folder. Under this one, a pre-defined query “Product Backlog” exist. Double clicking this query execute this one.</p>
<p><img src="/images/blog/TFS_BackLogItemList.png" alt=""/></p>
<p>From here, it is possible to assign to double click any of the Work Item and to assign the effort and to who the Work Item is assigned. For the moment, I am sure that the four first Work Item can fit in the first sprint. So, I can with Visual Studio opens the Work Item and change the Iteration for the first sprint.</p>
<p><img src="/images/blog/TFS_AssignSprint.png" alt=""/></p>
<p>But, it is not efficient because it is slow. A faster way is to use the web portal because you can drag and drop Work Item.</p>
<p>![](/images/blog/TFS_Drag_Drop_WorkItemToSprint.mp4&quot; controls/&gt;</p>
<p>This have move everything into the Sprint 1. Visual Studio has a Shared Query called “Sprint Backlog” and the web portal has the Sprint 1. Both display not only Work Items but also Task. Here is the two side by side that show the difference. I personally prefer the web portal.</p>
<p><img src="/images/blog/TFS_VS_WebPortalSprint1-1024x345.png" alt=""/></p>
<p>The next step is to assign capability for the team. For the sprint 1 (and for all other sprint) I will be alone. Nevertheless, let’s configure everything correctly. Inside the web portal, click the Sprint 1 and select the Capacity sub menu. From here, it is possible to select the capacity per day. We have defined that I will work about 10 hours per week, so it is 2 hours per day (5 workings day on 7 days).</p>
<p><img src="/images/blog/TFS_Capacity.png" alt=""/></p>
<p>What is most interesting is to assign time into each task. I have say TASK because time cannot be assigned to Work Item directly. Work Item remaining time is the sum of every task times. It is possible to set the remaining time directly inside each Work Item but the fastest way is to open the web portal and to go inside the sprint ans select “Board”. This give a view where each Work Item has its row and each task has its square. It is possible from here to click an assign the time and to who the task is assigned.</p>
<video src="/videos/blog/TFS_Board_AssignTime.mp4" controls=""></video>
<p>Once all setup, if you go back to the Capacity window, the work for the team, for every user and for task should be all green if you do not overcharge.</p>
<p><img src="/images/blog/TFS_WorkDetail.png" alt=""/></p>
<p>It is also possible to change the Board view by people instead of by Work Item. This option is inside the Board screen, at the top right.</p>
<h1>Sprint 2 : Planning model classes, creating the projects and starting authentification February 10, 2014 By: pdesjardins</h1>
<p>Since I am working alone in this project and I do not have a lot of time, sprint was defined to be for a complete month. This give about 40 hours per sprint which is not that big. So far, the sprint 1 has been great because I have identified what we will do and what I will not do. I have filled up all the back log and started to organize what will happen in the next sprints.</p>
<p>Here is the summary of the needs:</p>
<p>Existing needs</p>
<ul>
<li>Create new accounts</li>
<li>Display TOS</li>
<li>Login for existing user</li>
<li>Forget password mechanism</li>
<li>Show old contest</li>
<li>Show the name of the contest with the number of participants</li>
<li>Give the possibility to show the rating</li>
<li>Discussion forum</li>
<li>Help for the user</li>
<li>Have a way to communicate with the administration (contact page)</li>
<li>Premium account</li>
<li>Allow to enter contest that needs to have reputation point even if the user</li>
<li>Show more detail in the portfolio</li>
<li>Having more time for order</li>
<li>Having action directly into the portfolio</li>
<li>Having more decimal precision</li>
<li>Search users</li>
<li>Having an indicator that specify if a sell has been a success or not</li>
<li>One screen that show all portfolio</li>
<li>A list of all contest available to register.</li>
<li>A list of all contest that we participate</li>
<li>Create new contest and be able to edit them if we are an administrator</li>
<li>Private contest can be created with a password</li>
<li>Buy and sell action</li>
<li>Limit and Stop order</li>
<li>Buy and sell option</li>
<li>Limit and Stop order</li>
<li>See a graphic of the progression of the portfolio</li>
<li>See historic of all transactions (success and fail)</li>
<li>See all waiting order and their state</li>
<li>Display statistic about the number of buy/sell that has been a success or not.</li>
<li>List of all participants of a contest</li>
<li>Displaying the rank of the logged user.</li>
<li>Having moderator for the whole website or for just a contest</li>
<li>Having badge and reputations system</li>
<li>Badge for rank position, activity, beat the market, time registered</li>
<li>Moderation tools for split and for symbol change</li>
<li>Having script that automatically execute split and symbol change</li>
<li>Voting system for split and symbol.</li>
<li>Being able to see last registered user and to manually enable account</li>
<li>Being able to see last transactions for a contest</li>
<li>User Paypal to get premium account</li>
<li>French and English website</li>
<li>Having good URL (French and English)</li>
<li>Short option</li>
<li>Option Lookup (Ask and Bid Price)</li>
<li>Show when market is open or close</li>
<li>Be able to select which Market is available for a contest</li>
<li>Keep tracks of every portefolios gain</li>
<li>Something that remove limit order and option expiration automatically</li>
<li>Send email if the user have the preference to receive email when new contest arrives</li>
<li>Statistic for the contest. Daily, weekly, monthly best performer.</li>
<li>It is too slow and not essential.</li>
<li>Showing the forum last post in the website.</li>
<li>This slow down the website. Possible to add it later.</li>
<li>Having followers and being able to follow people portfolio.</li>
<li>This feature is not used by 575 peoples at this moment. Can be added at any time later.</li>
<li>Dashboard with widget.</li>
<li>This is so slow that is not usable. I do not see a real use case for this feature.</li>
<li>Wiki for help</li>
<li>This has been targeted by hacker a lot. People do not participate.</li>
<li>Winning by getting to a specific amount</li>
<li>Never been implemented correctly. Too risky to end contest prematurely.</li>
<li>Team contest (multiple people having the same portfolio) with the mechanism of creating team.</li>
<li>The problem is that contest is spanned on multiple month. People forget to play and the team is with dead bodies. This need to be rethinking. The team building system is great.</li>
<li>Having currency</li>
<li>Currencies would be more realistic and could have impact. This would require to have a daily script to get conversion. Maybe we can limit to USD, CND, EURO.</li>
<li>Mobile version of the website</li>
<li>I think this is normal now and won’t be a problem to implement.</li>
<li>Watch List</li>
<li>This is not a priority but having a watch list of stocks seem to be naturally something interesting to have</li>
<li>Showing historical price for stock</li>
<li>This is frustrating at the moment because we have no clue about the past price of the stock. We only have the present time. We must have a list of pas price and being able to display the price on a graph.</li>
<li>Create account with social website</li>
<li>Simple as possible to create account</li>
<li>Be able to create account from FaceBook or Twitter</li>
</ul>
<p>Old needs that won’t be migrate</p>
<ul>
<li>Statistic for the contest. Daily, weekly, monthly best performer.</li>
<li>It is too slow and not essential.</li>
<li>Showing the forum last post in the website.</li>
<li>This slow down the website. Possible to add it later.</li>
<li>Having followers and being able to follow people portfolio.</li>
<li>This feature is not used by 575 peoples at this moment. Can be added at any time later.</li>
<li>Dashboard with widget.</li>
<li>This is so slow that is not usable. I do not see a real use case for this feature.</li>
<li>Wiki for help</li>
<li>This has been targeted by hacker a lot. People do not participate.</li>
<li>Winning by getting to a specific amount</li>
<li>Never been implemented correctly. Too risky to end contest prematurely.</li>
<li>Team contest (multiple people having the same portfolio) with the mechanism of creating team.</li>
<li>The problem is that contest is spanned on multiple month. People forget to play and the team is with dead bodies. This need to be rethinking. The team building system is great.</li>
<li>Having currency</li>
<li>Currencies would be more realistic and could have impact. This would require to have a daily script to get conversion. Maybe we can limit to USD, CND, EURO.</li>
<li>Mobile version of the website</li>
<li>I think this is normal now and won’t be a problem to implement.</li>
<li>Watch List</li>
<li>This is not a priority but having a watch list of stocks seem to be naturally something interesting to have</li>
<li>Showing historical price for stock</li>
<li>This is frustrating at the moment because we have no clue about the past price of the stock. We only have the present time. We must have a list of pas price and being able to display the price on a graph.</li>
<li>Create account with social website</li>
<li>Simple as possible to create account</li>
<li>Be able to create account from FaceBook or Twitter</li>
</ul>
<p>New needs</p>
<ul>
<li>Having currency</li>
<li>Currencies would be more realistic and could have impact. This would require to have a daily script to get conversion. Maybe we can limit to USD, CND, EURO.</li>
<li>Mobile version of the website</li>
<li>I think this is normal now and won’t be a problem to implement.</li>
<li>Watch List</li>
<li>This is not a priority but having a watch list of stocks seem to be naturally something interesting to have</li>
<li>Showing historical price for stock</li>
<li>This is frustrating at the moment because we have no clue about the past price of the stock. We only have the present time. We must have a list of pas price and being able to display the price on a graph.</li>
<li>Create account with social website</li>
<li>Simple as possible to create account</li>
<li>Be able to create account from FaceBook or Twitter</li>
</ul>
<p>For this sprint, the classes diagram has been done for the model. It was very easy to do because the system already exist. Nevertheless, improvement was required. The old system was done in PHP and did not had a lot of inheritance and a lot of dirty PHP trick was done. Also, nothing was injectable. This made unit testing harder.</p>
<p>Few class will be complex and will be directly added into all tables when used. This is the case for the Money and for the LocalizedString.</p>
<p><img src="/images/blog/TFS_ComplexType.png" alt=""/></p>
<p>Then, we have classes that concern the user. In the current system user can win badges and reputations points. These will be in the User namespace. Every model namespace will be translated into schemas in the database. We will configure Entity Framework in a later post. User will be have role. So far, role will be Administrator, Moderator, Contest Moderator or simply a Registered User. The privileges table is linked to the User table. User will have the possibility to have privileges which are special account.</p>
<p><img src="/images/blog/Classes_Users-1024x388.png" alt=""/></p>
<p>The Contest namespace is a huge one that contain a critical classes.</p>
<p><img src="/images/blog/Classes_Contest-1-1024x573.png" alt=""/></p>
<p>At its heart, this namespace has the Contest class. The registration rule has been set to an one to one relation. This has been not put inside the Contest class because it is only used in specific place. It does not need to be loaded 80% of the time. This class can be and must be inherited into a specific implementation like to have a simple stock market contest or have one that allows shorting or options. Nevertheless, I am not happy with the current class diagram because it is not possible to have a contest with Short and Option. Having the Option inherit from the Short will also cause problem because having option contest force to have short too. This need some work but since all options and short are planned in few sprints (months), I will leave this like that.</p>
<p><img src="/images/blog/Classes_Trading-1024x520.png" alt=""/></p>
<p>This is also a huge namespace, the Trading namespace. It contains all orders, transactions, stocks and options of every portfolio. Finally, some classes for Stock and Option are required to have real time value.</p>
<p><img src="/images/blog/Classes_RealTime.png" alt=""/></p>
<p>These classes will offer the information from external source. Like Yahoo or Google to get the real time price (or 15 minutes delayed).</p>
<p><img src="/images/blog/ArchitectureBourseVirtuelle-1024x546.png" alt=""/></p>
<p>We want something efficient and with low maintainability. This require having high cohesive classes but also low coupling. Nevertheless, to be efficient we need to limit the number of classes which will increase the coupling. A good in the middle solution is to have View Model and Model classes. This project will have these two types of classes for entity classes. Otherwise, three majors layers are there. One for the presentation, one for the business logic and one for data access.</p>
<p><img src="/images/blog/LayersBourseVirtuelle.png" alt=""/></p>
<p>Exceptions are also limited to two levels. One that can goes up to the presentation and one that is only back end. During the process, if we have something to cut for shorter the development time, we may cut the exception to have this one go from the back end to the front end. However, this increase the coupling. Let’s go a little more in detail before going further in the code.</p>
<p><img src="/images/blog/DetailledArchitecture.png" alt=""/></p>
<p>This is a more detailed view of how the system will be developed. On the left side and on the right side you can see what we just saw in the more abstracted view of the architecture. The in between are all Asp.Net technologies for the front end, the ASP.Net MVC controller for the business logic which share classes with a service layer. These one access any persistence storage by an accessor layer that do the proxy between multiple data access technologies.</p>
<p>Creating a new solutions and projects</p>
<p>So, from all information that we have gathered so far, it is possible to create the solution for this new software.</p>
<p>When creating the solution, we want to push all the code to TFS Online. It is important to select “Add to source control”. If you have not, do not worry, you can add it later.</p>
<p>CreateNewSolutionThen, we select MVC application and the authentication to be Individual User Accounts. This is because we want users to create account or to use their Facebook and Twitter account to link to a new account. We do not add unit test because we will create them later and in several projects.</p>
<p>I’ll stop here for now. Another post will be there soon concerning all the authentication process.</p>
<p>Sprint 2 : TFS Online Configuration and solution setup February 17, 2014 By: pdesjardins</p>
<p>Posted in Analysis and Architecture In the last post, we have created the new solution “BourseVirtuelle”. I have renamed the default project, which is the Asp.Net MVC project to “WebSite”. Now that the solution exist and is plain with the default folders and classes, it is the time to create the projects and folders that represent the software architecture.</p>
<p>I have put back the detailed architectural graph because you will see that Visual Studio solution will be pretty much the same. What I have not yet discussed and that is visually apparent here is the fact that we will have multiple unit testing project. Every projects contains at least a unit testing project. Some, contains two. One for unit testing and one for integration. The purpose of splitting this in several projects is because when we will setup the build server that we won’t let it build test that are slower, like integration tests.</p>
<p><img src="/images/blog/Part1Project.png" alt=""/></p>
<p>This is the first part of projects created. As you can see, they are grouped into folders. This allows us to easily find every layers with their test. Every project has their unit testing project inside their folder. The CrossLayer projet is a project that is referenced by almost all projects. Not a lot of classes will be set there, but some classes are cross layers. The BusinessLayer has the folder Service. One exception is all controllers that will be kept in the WebSite project. The reason is because Asp.Net MVC setup by default all controllers in the website project or within the Are folder of the website project. DataAccess folder contains the DataAccess project. This one contains Accessors, Contexts, Repositories, UnitOfWork and later everything related to others elements defined in the architectural graphic.</p>
<p><img src="/images/blog/Part2Project-1.png" alt=""/></p>
<p>The second part contains the model folder. This one also contains a unit testing project. The model project is divided with some folders like the DataAnnotation, Entities and ValueObjects. DataAnnotation contains validation that can be shared across model classes. Entities are every classes used in the business. This has been defined in a previous post. However, the previous post contained some Value Object. Value Object are classes that could have been defined at enumeration but to have them in the database, they are defined as classes. They are not creatable or editable like entities. For example, an example of value object is the type of Option (Ask, Bid).</p>
<p>From there, it is the time to commit everything and end this post.</p>
<p>On a final note, this is a project that I am doing on my free time and I am commenting my commit. This should be a reflex for everybody. Later one, this can become very handy to know what is going on in the source control and to be able to come back on a specific commit.</p>
<h1>Sprint 2 : Identity and Architecture Part 1 of 2 February 24, 2014 By: pdesjardins</h1>
<p>Posted in Analysis and Architecture, Asp.Net MVC, Back-End This is the first post that contains more code. But first, let me show the architectural diagram. This diagram as been created with the Architecture Tool from Visual Studio 2013 Ultimate. It is not available for other edition. What is interesting compared to other UML tool is that the layer diagram will validate later if the design is respected.</p>
<p><img src="/images/blog/DetailledArchitecture.png" alt=""/></p>
<p>The image might be a little small but if you click on it you will see more details. As we can see, the presentation layer contains Html Helper and Views. Html Helpers will be defined later on its own name space to not disturb the Asp.Net MVC Html helpers. The diagram also show that presentation layer can only access View Model and not Model directly. Business Layer contains the controller, some algorithms and the service layers. I have put the controller in the Business Logic and not in the presentation layer because some basic logic and errors manipulation are done here. I concentrate the presentation layer for all visual aspect like Javascript, Css, Html.</p>
<p>The service layer inside the business layer contains the path to classes that has access to the data access layer. It can compute information from different sources. On the other side, the accessor layer. This is the first layer to reach once the data access layer is used. It chooses which technology to use. For example, this is where the cache will be checked, if not available than it will use the repository. This logic is in the accessor. Unit of work is used but not like Asp.Net MVC tutorial explains it. It is more like Julie Lerman explains it in her tutorial on PluralSight. I found it more logical. As you can see, the Unit of Work contains the Database Context (Entity Framework) but not repositories. I think it is better because you can adjust easily which repository to combine by having them in the accessor and this one give the Unit Of Work to each repository. The main goal is to have multiple repositories to share the same context.</p>
<p>Finally, this layer has model classes. This one can be used by the data access layer and the business layer. It would be interesting to have the data acess layer have its own entity classes but to limit mapping and tests to do, having only View Model and Model is enough.</p>
<p>Identity Preface</p>
<p>The website has for requirement to log with minimal information. I think the more minimal information to get is the email. I think it helps to have a lot of player if the form is very small. This is why what is built will have only one unique input that will ask for an email. This email address will be stored in the database and an emailed to send a validation link. Since we are using Identity, a password and a user name is required. To bypass this default behavior, a username is generated from the email address and a temporary password is set. This password is send in the email. Of course, the user must change this one.</p>
<p>When creating this behavior which can be found in this blog post I have notice that Asp.Net Identity framework has some difficulty to update custom field of your user. The Email is a custom field, so is the Creation date time and the Validation date time. These custom field must be updated. The first date when the account is created and the second when it is validated. This will be interesting to send back email after 24 hours if the account has not been validated and also to have some statistic about how many account has been created for real.</p>
<p>So the first step is to modify the Identity to have custom fields. The second step is to use the Identity User Manager to create and handle the user . The third step is to use Entity Framework to update the user for custom field.</p>
<p>Modifying Identity into Data Access Layer</p>
<p>We need to fit the Identity User Manager somewhere logical. By default, it is inside the WebSite project. This is wrong. The UserManager class use a DbContext. Of course, it is clear that it should be moved into the Data Access Layer. Its place is in in parallel of repositories. We will create our first repository to modify the user but the Identity User Manager should not be in the repository. It is a mechanism by itself and this why I have separated both. <img src="/images/blog/DataAccessBourseVirtuelle-1024x590.png" alt=""/></p>
<p>The website project must have the view model, the views and the controllers. That’s it. All model classes and user manager classes are moved.</p>
<p><img src="/images/blog/WebSiteBourseVirtuelle.png" alt=""/></p>
<p>The model project has the custom class.</p>
<p><img src="/images/blog/ModelUserBourseVirtuelle.png" alt=""/></p>
<p>I have named mine ApplicationUser.cs. Asp.Net MVC Identity allows to inherit the IdentityUser class. This is where we add additional properties like the Email.</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#fff;color:#24292e" tabindex="0" data-language="csharp" data-theme="github-light"><code data-language="csharp" data-theme="github-light" style="display:grid"><span data-line=""><span style="color:#D73A49"> public</span><span style="color:#D73A49"> class</span><span style="color:#6F42C1"> ApplicationUser</span><span style="color:#24292E"> : </span><span style="color:#6F42C1">IdentityUser</span><span style="color:#24292E"> { </span><span style="color:#D73A49">public</span><span style="color:#D73A49"> string</span><span style="color:#6F42C1"> Email</span><span style="color:#24292E"> { </span><span style="color:#D73A49">get</span><span style="color:#24292E">; </span><span style="color:#D73A49">set</span><span style="color:#24292E">; } </span><span style="color:#D73A49">public</span><span style="color:#D73A49"> string</span><span style="color:#6F42C1"> GravatarEmail</span><span style="color:#24292E"> { </span><span style="color:#D73A49">get</span><span style="color:#24292E">; </span><span style="color:#D73A49">set</span><span style="color:#24292E">; } </span><span style="color:#D73A49">public</span><span style="color:#D73A49"> string</span><span style="color:#6F42C1"> DisplayName</span><span style="color:#24292E"> { </span><span style="color:#D73A49">get</span><span style="color:#24292E">; </span><span style="color:#D73A49">set</span><span style="color:#24292E">; } </span><span style="color:#D73A49">public</span><span style="color:#D73A49"> string</span><span style="color:#6F42C1"> FirstName</span><span style="color:#24292E"> { </span><span style="color:#D73A49">get</span><span style="color:#24292E">; </span><span style="color:#D73A49">set</span><span style="color:#24292E">; } </span><span style="color:#D73A49">public</span><span style="color:#D73A49"> string</span><span style="color:#6F42C1"> LastName</span><span style="color:#24292E"> { </span><span style="color:#D73A49">get</span><span style="color:#24292E">; </span><span style="color:#D73A49">set</span><span style="color:#24292E">; } </span><span style="color:#D73A49">public</span><span style="color:#6F42C1"> DateTime</span><span style="color:#24292E">? </span><span style="color:#6F42C1">LastLogin</span><span style="color:#24292E"> { </span><span style="color:#D73A49">get</span><span style="color:#24292E">; </span><span style="color:#D73A49">set</span><span style="color:#24292E">; } </span><span style="color:#D73A49">public</span><span style="color:#6F42C1"> DateTime</span><span style="color:#6F42C1"> CreationDateTime</span><span style="color:#24292E"> { </span><span style="color:#D73A49">get</span><span style="color:#24292E">; </span><span style="color:#D73A49">set</span><span style="color:#24292E">; } </span><span style="color:#D73A49">public</span><span style="color:#6F42C1"> DateTime</span><span style="color:#24292E">? </span><span style="color:#6F42C1">ValidationDateTime</span><span style="color:#24292E"> { </span><span style="color:#D73A49">get</span><span style="color:#24292E">; </span><span style="color:#D73A49">set</span><span style="color:#24292E">; } } </span></span></code></pre></figure>
<p>I added more than just the email because in back log of the project, one coming work item is to be able to change the profile. I want the user to be able to have an icon. I will use gravatar since it is the system used in the current PHP system. I have a DisplayName which is the nick name that we will use. I cannot reuse the UserName of IdentityUser becaues it has been generated by the email and must remain a system property because every time the user will login with its email, the system transforms the email to the username to use the User Manager to login.</p>
<p>As we have seen in the layer, we need to have something in the service, then in the accessor and finally use the repository for updating the user and using the Identity User Manager.</p>
<p>Let’s start with the service layer. You may jump of your chair because I am in the process of developing the software. So far, the code is simple and will be improved. The service class is a pass through for the moment and it is normal for the User because it does not have any logic. Here is the class at this time of the project.</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#fff;color:#24292e" tabindex="0" data-language="csharp" data-theme="github-light"><code data-language="csharp" data-theme="github-light" style="display:grid"><span data-line=""><span style="color:#D73A49"> public</span><span style="color:#D73A49"> class</span><span style="color:#6F42C1"> UserService</span><span style="color:#24292E">:</span><span style="color:#6F42C1">IUserService</span><span style="color:#24292E"> { </span><span style="color:#D73A49">private</span><span style="color:#D73A49"> readonly</span><span style="color:#6F42C1"> IUserAccessor</span><span style="color:#6F42C1"> userAccessor</span><span style="color:#24292E">; </span><span style="color:#D73A49">private</span><span style="color:#D73A49"> readonly</span><span style="color:#6F42C1"> IEmailCreationFacade</span><span style="color:#6F42C1"> emailFacade</span><span style="color:#24292E">; </span><span style="color:#D73A49">private</span><span style="color:#D73A49"> readonly</span><span style="color:#6F42C1"> IRunningContext</span><span style="color:#6F42C1"> runningContext</span><span style="color:#24292E">; </span><span style="color:#D73A49">public</span><span style="color:#6F42C1"> UserService</span><span style="color:#24292E">(</span><span style="color:#6F42C1">IRunningContext</span><span style="color:#6F42C1"> runningContext</span><span style="color:#24292E">, </span><span style="color:#6F42C1">IUserAccessor</span><span style="color:#6F42C1"> userAccessor</span><span style="color:#24292E">, </span><span style="color:#6F42C1">IEmailCreationFacade</span><span style="color:#6F42C1"> emailFacade</span><span style="color:#24292E">) { </span><span style="color:#005CC5">this</span><span style="color:#24292E">.runningContext </span><span style="color:#D73A49">=</span><span style="color:#24292E"> runningContext; </span><span style="color:#005CC5">this</span><span style="color:#24292E">.userAccessor </span><span style="color:#D73A49">=</span><span style="color:#24292E"> userAccessor; </span><span style="color:#005CC5">this</span><span style="color:#24292E">.emailFacade </span><span style="color:#D73A49">=</span><span style="color:#24292E"> emailFacade; } </span><span style="color:#D73A49">public</span><span style="color:#D73A49"> async</span><span style="color:#6F42C1"> Task</span><span style="color:#24292E">&lt;</span><span style="color:#6F42C1">IdentityResult</span><span style="color:#24292E">&gt; </span><span style="color:#6F42C1">CreateAsync</span><span style="color:#24292E">(</span><span style="color:#6F42C1">ApplicationUser</span><span style="color:#6F42C1"> user</span><span style="color:#24292E">, </span><span style="color:#D73A49">string</span><span style="color:#6F42C1"> password</span><span style="color:#24292E">) { </span><span style="color:#D73A49">var</span><span style="color:#6F42C1"> result</span><span style="color:#D73A49"> =</span><span style="color:#D73A49"> await</span><span style="color:#005CC5"> this</span><span style="color:#24292E">.userAccessor.</span><span style="color:#6F42C1">CreateASync</span><span style="color:#24292E">(user, password); </span><span style="color:#D73A49">if</span><span style="color:#24292E"> (result.Succeeded) { </span><span style="color:#D73A49">var</span><span style="color:#6F42C1"> email</span><span style="color:#D73A49"> =</span><span style="color:#005CC5"> this</span><span style="color:#24292E">.emailFacade.</span><span style="color:#6F42C1">GetCreationEmail</span><span style="color:#24292E">(user.Email, password); </span><span style="color:#005CC5">this</span><span style="color:#24292E">.userAccessor.</span><span style="color:#6F42C1">SendEmailCreateAccountAsync</span><span style="color:#24292E">(email); } </span><span style="color:#D73A49">return</span><span style="color:#24292E"> result; } </span><span style="color:#D73A49">public</span><span style="color:#D73A49"> async</span><span style="color:#6F42C1"> Task</span><span style="color:#24292E">&lt;</span><span style="color:#6F42C1">ClaimsIdentity</span><span style="color:#24292E">&gt; </span><span style="color:#6F42C1">CreateIdentityAsync</span><span style="color:#24292E">(</span><span style="color:#6F42C1">ApplicationUser</span><span style="color:#6F42C1"> user</span><span style="color:#24292E">, </span><span style="color:#D73A49">string</span><span style="color:#6F42C1"> applicationCookie</span><span style="color:#24292E">) { </span><span style="color:#D73A49">return</span><span style="color:#D73A49"> await</span><span style="color:#005CC5"> this</span><span style="color:#24292E">.userAccessor.</span><span style="color:#6F42C1">CreateIdentityAsync</span><span style="color:#24292E">(user, applicationCookie); } </span><span style="color:#D73A49">public</span><span style="color:#D73A49"> async</span><span style="color:#6F42C1"> Task</span><span style="color:#24292E">&lt;</span><span style="color:#6F42C1">IdentityResult</span><span style="color:#24292E">&gt; </span><span style="color:#6F42C1">CreateAsync</span><span style="color:#24292E">(</span><span style="color:#6F42C1">ApplicationUser</span><span style="color:#6F42C1"> user</span><span style="color:#24292E">) { </span><span style="color:#D73A49">return</span><span style="color:#D73A49"> await</span><span style="color:#005CC5"> this</span><span style="color:#24292E">.userAccessor.</span><span style="color:#6F42C1">CreateASync</span><span style="color:#24292E">(user); } </span><span style="color:#D73A49">public</span><span style="color:#D73A49"> async</span><span style="color:#6F42C1"> Task</span><span style="color:#24292E">&lt;</span><span style="color:#6F42C1">ClaimsIdentity</span><span style="color:#24292E">&gt; </span><span style="color:#6F42C1">SignInAsync</span><span style="color:#24292E">(</span><span style="color:#6F42C1">ApplicationUser</span><span style="color:#6F42C1"> user</span><span style="color:#24292E">, </span><span style="color:#D73A49">bool</span><span style="color:#6F42C1"> isPersistent</span><span style="color:#24292E">) { </span><span style="color:#D73A49">return</span><span style="color:#D73A49"> await</span><span style="color:#005CC5"> this</span><span style="color:#24292E">.userAccessor.</span><span style="color:#6F42C1">SignInAsync</span><span style="color:#24292E">(user, isPersistent); } </span><span style="color:#D73A49">public</span><span style="color:#D73A49"> async</span><span style="color:#6F42C1"> Task</span><span style="color:#24292E">&lt;</span><span style="color:#6F42C1">IdentityResult</span><span style="color:#24292E">&gt; </span><span style="color:#6F42C1">RemoveLoginAsync</span><span style="color:#24292E">(</span><span style="color:#D73A49">string</span><span style="color:#6F42C1"> userId</span><span style="color:#24292E">, </span><span style="color:#6F42C1">UserLoginInfo</span><span style="color:#6F42C1"> userLoginInfo</span><span style="color:#24292E">) { </span><span style="color:#D73A49">return</span><span style="color:#D73A49"> await</span><span style="color:#005CC5"> this</span><span style="color:#24292E">.userAccessor.</span><span style="color:#6F42C1">RemoveLoginAsync</span><span style="color:#24292E">(userId, userLoginInfo); } </span><span style="color:#D73A49">public</span><span style="color:#D73A49"> async</span><span style="color:#6F42C1"> Task</span><span style="color:#24292E">&lt;</span><span style="color:#6F42C1">ApplicationUser</span><span style="color:#24292E">&gt; </span><span style="color:#6F42C1">FindAsync</span><span style="color:#24292E">(</span><span style="color:#D73A49">string</span><span style="color:#6F42C1"> userName</span><span style="color:#24292E">, </span><span style="color:#D73A49">string</span><span style="color:#6F42C1"> password</span><span style="color:#24292E">) { </span><span style="color:#D73A49">return</span><span style="color:#D73A49"> await</span><span style="color:#005CC5"> this</span><span style="color:#24292E">.userAccessor.</span><span style="color:#6F42C1">FindAsync</span><span style="color:#24292E">(userName, password); } </span><span style="color:#D73A49">public</span><span style="color:#D73A49"> async</span><span style="color:#6F42C1"> Task</span><span style="color:#24292E">&lt;</span><span style="color:#6F42C1">IdentityResult</span><span style="color:#24292E">&gt; </span><span style="color:#6F42C1">ChangePasswordAsync</span><span style="color:#24292E">(</span><span style="color:#D73A49">string</span><span style="color:#6F42C1"> userId</span><span style="color:#24292E">, </span><span style="color:#D73A49">string</span><span style="color:#6F42C1"> oldPassword</span><span style="color:#24292E">, </span><span style="color:#D73A49">string</span><span style="color:#6F42C1"> newPassword</span><span style="color:#24292E">) { </span><span style="color:#D73A49">return</span><span style="color:#D73A49"> await</span><span style="color:#005CC5"> this</span><span style="color:#24292E">.userAccessor.</span><span style="color:#6F42C1">ChangePasswordAsync</span><span style="color:#24292E">(userId, oldPassword, newPassword); } </span><span style="color:#D73A49">public</span><span style="color:#D73A49"> async</span><span style="color:#6F42C1"> Task</span><span style="color:#24292E">&lt;</span><span style="color:#6F42C1">IdentityResult</span><span style="color:#24292E">&gt; </span><span style="color:#6F42C1">AddPasswordAsync</span><span style="color:#24292E">(</span><span style="color:#D73A49">string</span><span style="color:#6F42C1"> userId</span><span style="color:#24292E">, </span><span style="color:#D73A49">string</span><span style="color:#6F42C1"> newPassword</span><span style="color:#24292E">) { </span><span style="color:#D73A49">return</span><span style="color:#D73A49"> await</span><span style="color:#005CC5"> this</span><span style="color:#24292E">.userAccessor.</span><span style="color:#6F42C1">AddPasswordAsync</span><span style="color:#24292E">(userId, newPassword); } </span><span style="color:#D73A49">public</span><span style="color:#D73A49"> async</span><span style="color:#6F42C1"> Task</span><span style="color:#24292E">&lt;</span><span style="color:#6F42C1">ApplicationUser</span><span style="color:#24292E">&gt; </span><span style="color:#6F42C1">FindAsync</span><span style="color:#24292E">(</span><span style="color:#6F42C1">UserLoginInfo</span><span style="color:#6F42C1"> userName</span><span style="color:#24292E">) { </span><span style="color:#D73A49">return</span><span style="color:#D73A49"> await</span><span style="color:#005CC5"> this</span><span style="color:#24292E">.userAccessor.</span><span style="color:#6F42C1">FindAsync</span><span style="color:#24292E">(userName); } </span><span style="color:#D73A49">public</span><span style="color:#D73A49"> async</span><span style="color:#6F42C1"> Task</span><span style="color:#24292E">&lt;</span><span style="color:#6F42C1">IdentityResult</span><span style="color:#24292E">&gt; </span><span style="color:#6F42C1">AddLoginAsync</span><span style="color:#24292E">(</span><span style="color:#D73A49">string</span><span style="color:#6F42C1"> userId</span><span style="color:#24292E">, </span><span style="color:#6F42C1">UserLoginInfo</span><span style="color:#6F42C1"> login</span><span style="color:#24292E">) { </span><span style="color:#D73A49">return</span><span style="color:#D73A49"> await</span><span style="color:#005CC5"> this</span><span style="color:#24292E">.userAccessor.</span><span style="color:#6F42C1">AddLoginAsync</span><span style="color:#24292E">(userId, login); } </span><span style="color:#D73A49">public</span><span style="color:#6F42C1"> ICollection</span><span style="color:#24292E">&lt;</span><span style="color:#6F42C1">UserLoginInfo</span><span style="color:#24292E">&gt; </span><span style="color:#6F42C1">GetLogins</span><span style="color:#24292E">(</span><span style="color:#D73A49">string</span><span style="color:#6F42C1"> userId</span><span style="color:#24292E">) { </span><span style="color:#D73A49">return</span><span style="color:#005CC5"> this</span><span style="color:#24292E">.userAccessor.</span><span style="color:#6F42C1">GetLogins</span><span style="color:#24292E">(userId); } </span><span style="color:#D73A49">public</span><span style="color:#6F42C1"> ApplicationUser</span><span style="color:#6F42C1"> FindById</span><span style="color:#24292E">(</span><span style="color:#D73A49">string</span><span style="color:#6F42C1"> userId</span><span style="color:#24292E">) { </span><span style="color:#D73A49">return</span><span style="color:#005CC5"> this</span><span style="color:#24292E">.userAccessor.</span><span style="color:#6F42C1">FindById</span><span style="color:#24292E">(userId); } </span><span style="color:#D73A49">public</span><span style="color:#D73A49"> void</span><span style="color:#6F42C1"> ActivateAccount</span><span style="color:#24292E">(</span><span style="color:#D73A49">string</span><span style="color:#6F42C1"> guid</span><span style="color:#24292E">) { </span><span style="color:#D73A49">try</span><span style="color:#24292E"> { </span><span style="color:#D73A49">var</span><span style="color:#6F42C1"> userAccount</span><span style="color:#D73A49"> =</span><span style="color:#005CC5"> this</span><span style="color:#24292E">.userAccessor.</span><span style="color:#6F42C1">FindById</span><span style="color:#24292E">(guid); </span><span style="color:#D73A49">if</span><span style="color:#24292E"> (userAccount </span><span style="color:#D73A49">==</span><span style="color:#005CC5"> null</span><span style="color:#24292E">) { </span><span style="color:#D73A49">throw</span><span style="color:#D73A49"> new</span><span style="color:#6F42C1"> GuidKeyNotFound</span><span style="color:#24292E">(guid); } userAccount.ValidationDateTime </span><span style="color:#D73A49">=</span><span style="color:#005CC5"> this</span><span style="color:#24292E">.runningContext.</span><span style="color:#6F42C1">GetCurrentTime</span><span style="color:#24292E">(); userAccessor.</span><span style="color:#6F42C1">Update</span><span style="color:#24292E">(userAccount); } </span><span style="color:#D73A49">catch</span><span style="color:#24292E"> (</span><span style="color:#6F42C1">ArgumentNullException</span><span style="color:#24292E">) { </span><span style="color:#D73A49">throw</span><span style="color:#D73A49"> new</span><span style="color:#6F42C1"> GuidKeyNotFound</span><span style="color:#24292E">(guid); } } } </span></span></code></pre></figure>
<p>This class is injected by Microsoft Unity. It could have been any inversion of control (IoC) but I try to keep it simple and Unity do the job well. It has three parameters. IRunningContext, IUserAccessor and IEmailCreationFacade. I will not talk about the first one yet more than it has the current date time and it has the user that is loggued. The user accessor is the accessor that the user service uses. The email facade is all the logic about creating emails. This is required to be able to send a verification email. Later, it will be also used when the user do not remember his password. Let’s focus on the creation of an account for now.</p>
<p>The CreateAsync method is the cone that concern us. We want to create an account into the database by using the default membership framework, called Identity. Here is an extraction of the method that is important for the moment.</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#fff;color:#24292e" tabindex="0" data-language="csharp" data-theme="github-light"><code data-language="csharp" data-theme="github-light" style="display:grid"><span data-line=""><span style="color:#D73A49"> public</span><span style="color:#D73A49"> async</span><span style="color:#6F42C1"> Task</span><span style="color:#24292E">&lt;</span><span style="color:#6F42C1">IdentityResult</span><span style="color:#24292E">&gt; </span><span style="color:#6F42C1">CreateAsync</span><span style="color:#24292E">(</span><span style="color:#6F42C1">ApplicationUser</span><span style="color:#6F42C1"> user</span><span style="color:#24292E">, </span><span style="color:#D73A49">string</span><span style="color:#6F42C1"> password</span><span style="color:#24292E">) { </span><span style="color:#D73A49">var</span><span style="color:#6F42C1"> result</span><span style="color:#D73A49"> =</span><span style="color:#D73A49"> await</span><span style="color:#005CC5"> this</span><span style="color:#24292E">.userAccessor.</span><span style="color:#6F42C1">CreateASync</span><span style="color:#24292E">(user, password); </span><span style="color:#D73A49">if</span><span style="color:#24292E"> (result.Succeeded) { </span><span style="color:#D73A49">var</span><span style="color:#6F42C1"> email</span><span style="color:#D73A49"> =</span><span style="color:#005CC5"> this</span><span style="color:#24292E">.emailFacade.</span><span style="color:#6F42C1">GetCreationEmail</span><span style="color:#24292E">(user.Email, password); </span><span style="color:#005CC5">this</span><span style="color:#24292E">.userAccessor.</span><span style="color:#6F42C1">SendEmailCreateAccountAsync</span><span style="color:#24292E">(email); } </span><span style="color:#D73A49">return</span><span style="color:#24292E"> result; } </span></span></code></pre></figure>
<p>First of all, it access the accessor. This is the entry door for the Data Access Layer. If everything is saved, than we send an email. It is the place of the service to trigger the email and not the accessor because it is a business logic to send an email after the creation of an account, not a Data Access Layer code. On the accessor side, it uses the unit of work because the accessor has the role to say if everything must be commited. I takes the user manager, the email provider and the user repository too.</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#fff;color:#24292e" tabindex="0" data-language="csharp" data-theme="github-light"><code data-language="csharp" data-theme="github-light" style="display:grid"><span data-line=""><span style="color:#D73A49"> public</span><span style="color:#D73A49"> class</span><span style="color:#6F42C1"> UserAccessor</span><span style="color:#24292E">:</span><span style="color:#6F42C1">IUserAccessor</span><span style="color:#24292E"> { </span><span style="color:#D73A49">private</span><span style="color:#D73A49"> readonly</span><span style="color:#6F42C1"> IUserRepository</span><span style="color:#6F42C1"> userRepository</span><span style="color:#24292E">; </span><span style="color:#D73A49">private</span><span style="color:#D73A49"> readonly</span><span style="color:#6F42C1"> IRunningContext</span><span style="color:#6F42C1"> runningContext</span><span style="color:#24292E">; </span><span style="color:#D73A49">private</span><span style="color:#D73A49"> readonly</span><span style="color:#6F42C1"> IUnitOfWork</span><span style="color:#6F42C1"> unitOfWork</span><span style="color:#24292E"> ; </span><span style="color:#D73A49">private</span><span style="color:#D73A49"> readonly</span><span style="color:#6F42C1"> IUserManager</span><span style="color:#6F42C1"> userManager</span><span style="color:#24292E">; </span><span style="color:#D73A49">private</span><span style="color:#D73A49"> readonly</span><span style="color:#6F42C1"> IEmailProvider</span><span style="color:#6F42C1"> emailProvider</span><span style="color:#24292E">; </span><span style="color:#D73A49">public</span><span style="color:#6F42C1"> UserAccessor</span><span style="color:#24292E">(</span><span style="color:#6F42C1">IRunningContext</span><span style="color:#6F42C1"> runningContext</span><span style="color:#24292E">,</span><span style="color:#6F42C1">IUnitOfWork</span><span style="color:#6F42C1"> unitOfWork</span><span style="color:#24292E">, </span><span style="color:#6F42C1">IUserRepository</span><span style="color:#6F42C1"> repository</span><span style="color:#24292E">, </span><span style="color:#6F42C1">IUserManager</span><span style="color:#6F42C1"> userManager</span><span style="color:#24292E">, </span><span style="color:#6F42C1">IEmailProvider</span><span style="color:#6F42C1"> emailProvider</span><span style="color:#24292E">) { </span><span style="color:#005CC5">this</span><span style="color:#24292E">.runningContext </span><span style="color:#D73A49">=</span><span style="color:#24292E"> runningContext; </span><span style="color:#005CC5">this</span><span style="color:#24292E">.unitOfWork </span><span style="color:#D73A49">=</span><span style="color:#24292E"> unitOfWork; </span><span style="color:#005CC5">this</span><span style="color:#24292E">.userRepository </span><span style="color:#D73A49">=</span><span style="color:#24292E"> repository; </span><span style="color:#005CC5">this</span><span style="color:#24292E">.userManager </span><span style="color:#D73A49">=</span><span style="color:#24292E"> userManager; </span><span style="color:#005CC5">this</span><span style="color:#24292E">.emailProvider </span><span style="color:#D73A49">=</span><span style="color:#24292E"> emailProvider; } </span></span></code></pre></figure>
<p>The create method that is called by the service layer is very straightforward. It simply call the user manager.</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#fff;color:#24292e" tabindex="0" data-language="csharp" data-theme="github-light"><code data-language="csharp" data-theme="github-light" style="display:grid"><span data-line=""><span style="color:#D73A49"> public</span><span style="color:#6F42C1"> Task</span><span style="color:#24292E">&lt;</span><span style="color:#6F42C1">IdentityResult</span><span style="color:#24292E">&gt; </span><span style="color:#6F42C1">CreateASync</span><span style="color:#24292E">(</span><span style="color:#6F42C1">ApplicationUser</span><span style="color:#6F42C1"> user</span><span style="color:#24292E">, </span><span style="color:#D73A49">string</span><span style="color:#6F42C1"> password</span><span style="color:#24292E">) { </span><span style="color:#D73A49">return</span><span style="color:#005CC5"> this</span><span style="color:#24292E">.userManager.</span><span style="color:#6F42C1">CreateASync</span><span style="color:#24292E">(user, password); } </span></span></code></pre></figure>
<p>If we go a little lower in the class, two other methods is different in the accessor.</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#fff;color:#24292e" tabindex="0" data-language="csharp" data-theme="github-light"><code data-language="csharp" data-theme="github-light" style="display:grid"><span data-line=""><span style="color:#D73A49"> public</span><span style="color:#D73A49"> void</span><span style="color:#6F42C1"> Update</span><span style="color:#24292E">(</span><span style="color:#6F42C1">ApplicationUser</span><span style="color:#6F42C1"> userAccount</span><span style="color:#24292E">) { </span><span style="color:#005CC5">this</span><span style="color:#24292E">.userRepository.</span><span style="color:#6F42C1">Update</span><span style="color:#24292E">(userAccount); </span><span style="color:#005CC5">this</span><span style="color:#24292E">.unitOfWork.</span><span style="color:#6F42C1">Commit</span><span style="color:#24292E">(); } </span><span style="color:#D73A49">public</span><span style="color:#D73A49"> async</span><span style="color:#D73A49"> void</span><span style="color:#6F42C1"> SendEmailCreateAccountAsync</span><span style="color:#24292E">(</span><span style="color:#6F42C1">Email</span><span style="color:#24292E">.</span><span style="color:#6F42C1">Implementations</span><span style="color:#24292E">.</span><span style="color:#6F42C1">Email</span><span style="color:#6F42C1"> email</span><span style="color:#24292E">) { </span><span style="color:#D73A49">await</span><span style="color:#005CC5"> this</span><span style="color:#24292E">.emailProvider.</span><span style="color:#6F42C1">SendEmailAsync</span><span style="color:#24292E">(email); } </span></span></code></pre></figure>
<p>The update does not use the UserManager because it does not work well with custom fields. It uses the repository that simply use Entity Framework to update the entity. The other method is for sending thee email. This one is async since we do not want to wait the email to be sent. It will call the command to send the email and return immediately.</p>
<p>Here is the repository code so far for the user.</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#fff;color:#24292e" tabindex="0" data-language="csharp" data-theme="github-light"><code data-language="csharp" data-theme="github-light" style="display:grid"><span data-line=""><span style="color:#D73A49"> public</span><span style="color:#D73A49"> class</span><span style="color:#6F42C1"> UserRepository</span><span style="color:#24292E"> : </span><span style="color:#6F42C1">RepositoryForUser</span><span style="color:#24292E">&lt;</span><span style="color:#6F42C1">ApplicationUser</span><span style="color:#24292E">&gt;, </span><span style="color:#6F42C1">IUserRepository</span><span style="color:#24292E"> { </span><span style="color:#D73A49">private</span><span style="color:#6F42C1"> IUnitOfWork</span><span style="color:#6F42C1"> unitOfWork</span><span style="color:#24292E">; </span><span style="color:#D73A49">public</span><span style="color:#6F42C1"> UserRepository</span><span style="color:#24292E">(</span><span style="color:#6F42C1">IUnitOfWork</span><span style="color:#6F42C1"> unitOfWork</span><span style="color:#24292E">):</span><span style="color:#005CC5">base</span><span style="color:#24292E">(unitOfWork) { </span><span style="color:#005CC5">this</span><span style="color:#24292E">.unitOfWork </span><span style="color:#D73A49">=</span><span style="color:#24292E"> unitOfWork; } </span><span style="color:#D73A49">public</span><span style="color:#D73A49"> void</span><span style="color:#6F42C1"> Update</span><span style="color:#24292E">(</span><span style="color:#6F42C1">ApplicationUser</span><span style="color:#6F42C1"> userAccount</span><span style="color:#24292E">) { </span><span style="color:#005CC5">base</span><span style="color:#24292E">.</span><span style="color:#6F42C1">Update</span><span style="color:#24292E">(userAccount); } } </span></span></code></pre></figure>
<p>What is very interesting with Entity Framework is that you do not have to change anything in the repository if an additional custom field must be added and modified. Later, when the profile page will be done, this repository should not change.</p>
<p>Concerning the email, because it uses an interface, the injection can push a real implementation but also a fake one.</p>
<p><img src="/images/blog/EmailProviderBourseVirtuelle.png" alt=""/></p>
<p>Instead of having email sent with SMTP, a fake one writes file is coded. This make it faster and easier during development to not have an intermediary protocol between the process of sending and receiving.</p>
<h1>SPRINT 2 : IDENTITY AND ARCHITECTURE PART 2 OF 2 March 3, 2014 By: pdesjardins</h1>
<p>This second part is shorter than the first one. The sprint 2 has two others thing that must change with Identity. First of all it is the possibility to fake a user. This will be interesting for testing purpose. The second work item is to be able to log with third party, like Facebook or Twitter.</p>
<p>This part was not a piece of cake. It was working fine with an empty project but for unknown reasons, thing has gone wrong in few places. First of all, the use of external login was not working fine in the project but was fine in a new project solution. Second, the use of AccountManager of Identity cause some problem with Async.</p>
<p>I have modified the identity to have Model inside the Model project and ViewModel in the ViewModel project. The Model is very simple since we are using Identity. Most of the classes are ViewModel. <img src="/images/blog/Sprint2ModelViewModel.png" alt=""/></p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#fff;color:#24292e" tabindex="0" data-language="csharp" data-theme="github-light"><code data-language="csharp" data-theme="github-light" style="display:grid"><span data-line=""><span style="color:#D73A49"> public</span><span style="color:#D73A49"> class</span><span style="color:#6F42C1"> ApplicationUserViewModel</span><span style="color:#24292E"> { </span><span style="color:#D73A49">public</span><span style="color:#D73A49"> string</span><span style="color:#6F42C1"> Email</span><span style="color:#24292E"> { </span><span style="color:#D73A49">get</span><span style="color:#24292E">; </span><span style="color:#D73A49">set</span><span style="color:#24292E">; } </span><span style="color:#D73A49">public</span><span style="color:#D73A49"> string</span><span style="color:#6F42C1"> GravatarEmail</span><span style="color:#24292E"> { </span><span style="color:#D73A49">get</span><span style="color:#24292E">; </span><span style="color:#D73A49">set</span><span style="color:#24292E">; } </span><span style="color:#D73A49">public</span><span style="color:#D73A49"> string</span><span style="color:#6F42C1"> DisplayName</span><span style="color:#24292E"> { </span><span style="color:#D73A49">get</span><span style="color:#24292E">; </span><span style="color:#D73A49">set</span><span style="color:#24292E">; } </span><span style="color:#D73A49">public</span><span style="color:#D73A49"> string</span><span style="color:#6F42C1"> FirstName</span><span style="color:#24292E"> { </span><span style="color:#D73A49">get</span><span style="color:#24292E">; </span><span style="color:#D73A49">set</span><span style="color:#24292E">; } </span><span style="color:#D73A49">public</span><span style="color:#D73A49"> string</span><span style="color:#6F42C1"> LastName</span><span style="color:#24292E"> { </span><span style="color:#D73A49">get</span><span style="color:#24292E">; </span><span style="color:#D73A49">set</span><span style="color:#24292E">; } } </span></span></code></pre></figure>
<p>The view model is used to allow the user to add custom data. It is mapped to the model class.</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#fff;color:#24292e" tabindex="0" data-language="csharp" data-theme="github-light"><code data-language="csharp" data-theme="github-light" style="display:grid"><span data-line=""><span style="color:#D73A49"> public</span><span style="color:#D73A49"> class</span><span style="color:#6F42C1"> ApplicationUser</span><span style="color:#24292E"> : </span><span style="color:#6F42C1">IdentityUser</span><span style="color:#24292E">, </span><span style="color:#6F42C1">IValidatableModel</span><span style="color:#24292E"> { </span><span style="color:#D73A49">public</span><span style="color:#D73A49"> string</span><span style="color:#6F42C1"> Email</span><span style="color:#24292E"> { </span><span style="color:#D73A49">get</span><span style="color:#24292E">; </span><span style="color:#D73A49">set</span><span style="color:#24292E">; } </span><span style="color:#D73A49">public</span><span style="color:#D73A49"> string</span><span style="color:#6F42C1"> GravatarEmail</span><span style="color:#24292E"> { </span><span style="color:#D73A49">get</span><span style="color:#24292E">; </span><span style="color:#D73A49">set</span><span style="color:#24292E">; } </span><span style="color:#D73A49">public</span><span style="color:#D73A49"> string</span><span style="color:#6F42C1"> DisplayName</span><span style="color:#24292E"> { </span><span style="color:#D73A49">get</span><span style="color:#24292E">; </span><span style="color:#D73A49">set</span><span style="color:#24292E">; } </span><span style="color:#D73A49">public</span><span style="color:#D73A49"> string</span><span style="color:#6F42C1"> FirstName</span><span style="color:#24292E"> { </span><span style="color:#D73A49">get</span><span style="color:#24292E">; </span><span style="color:#D73A49">set</span><span style="color:#24292E">; } </span><span style="color:#D73A49">public</span><span style="color:#D73A49"> string</span><span style="color:#6F42C1"> LastName</span><span style="color:#24292E"> { </span><span style="color:#D73A49">get</span><span style="color:#24292E">; </span><span style="color:#D73A49">set</span><span style="color:#24292E">; } </span><span style="color:#D73A49">public</span><span style="color:#6F42C1"> DateTime</span><span style="color:#24292E">? </span><span style="color:#6F42C1">LastLogin</span><span style="color:#24292E"> { </span><span style="color:#D73A49">get</span><span style="color:#24292E">; </span><span style="color:#D73A49">set</span><span style="color:#24292E">; } </span><span style="color:#D73A49">public</span><span style="color:#6F42C1"> DateTime</span><span style="color:#6F42C1"> CreationDateTime</span><span style="color:#24292E"> { </span><span style="color:#D73A49">get</span><span style="color:#24292E">; </span><span style="color:#D73A49">set</span><span style="color:#24292E">; } </span><span style="color:#D73A49">public</span><span style="color:#6F42C1"> DateTime</span><span style="color:#24292E">? </span><span style="color:#6F42C1">ValidationDateTime</span><span style="color:#24292E"> { </span><span style="color:#D73A49">get</span><span style="color:#24292E">; </span><span style="color:#D73A49">set</span><span style="color:#24292E">; } </span><span style="color:#D73A49">public</span><span style="color:#6F42C1"> IEnumerable</span><span style="color:#24292E">&lt;</span><span style="color:#6F42C1">ValidationResult</span><span style="color:#24292E">&gt; </span><span style="color:#6F42C1">Validate</span><span style="color:#24292E">() { </span><span style="color:#D73A49">return</span><span style="color:#005CC5"> null</span><span style="color:#24292E">; } </span><span style="color:#D73A49">public</span><span style="color:#D73A49"> bool</span><span style="color:#6F42C1"> IsValid</span><span style="color:#24292E">() { </span><span style="color:#D73A49">return</span><span style="color:#D73A49"> !</span><span style="color:#6F42C1">Validate</span><span style="color:#24292E">().</span><span style="color:#6F42C1">Any</span><span style="color:#24292E">(); } } </span></span></code></pre></figure>
<p>The model class is not yet done but has most of the properties that is required by the service to save it with Entity Framework. The Identity Framework does not work fine or easy with custom fields without the use of Entity Framework. This is why, the Service Layer will use Entity Framework for some operations and use the Identity Manager for others. Here is a sequence diagram from the AccountController to the Service layer. From here, the path change depending of the task.</p>
<p><img src="/images/blog/Sprint2SequenceDiagramCreateUser.png" alt=""/></p>
<p>As you can see, the controller call some injected classes like a IUserValuesGenerator. This is the class that as the algorithm to generate the password to the user. Why? Because we want a minimalist sign up form. In fact, just the email is required.</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#fff;color:#24292e" tabindex="0" data-language="csharp" data-theme="github-light"><code data-language="csharp" data-theme="github-light" style="display:grid"><span data-line=""><span style="color:#D73A49"> public</span><span style="color:#D73A49"> async</span><span style="color:#6F42C1"> Task</span><span style="color:#24292E">&lt;</span><span style="color:#6F42C1">IdentityResult</span><span style="color:#24292E">&gt; </span><span style="color:#6F42C1">CreateAsync</span><span style="color:#24292E">(</span><span style="color:#6F42C1">ApplicationUser</span><span style="color:#6F42C1"> user</span><span style="color:#24292E">, </span><span style="color:#D73A49">string</span><span style="color:#6F42C1"> password</span><span style="color:#24292E">) { </span><span style="color:#D73A49">var</span><span style="color:#6F42C1"> result</span><span style="color:#D73A49"> =</span><span style="color:#D73A49"> await</span><span style="color:#005CC5"> this</span><span style="color:#24292E">.userAccessor.</span><span style="color:#6F42C1">CreateASync</span><span style="color:#24292E">(user, password); </span><span style="color:#D73A49">if</span><span style="color:#24292E"> (result.Succeeded) { </span><span style="color:#D73A49">var</span><span style="color:#6F42C1"> email</span><span style="color:#D73A49"> =</span><span style="color:#005CC5"> this</span><span style="color:#24292E">.emailFacade.</span><span style="color:#6F42C1">GetCreationEmail</span><span style="color:#24292E">(user.Email, password); </span><span style="color:#005CC5">this</span><span style="color:#24292E">.userAccessor.</span><span style="color:#6F42C1">SendEmailCreateAccountAsync</span><span style="color:#24292E">(email); } </span><span style="color:#D73A49">return</span><span style="color:#24292E"> result; } </span></span></code></pre></figure>
<p>The code above, create the user, if it succeed, it send an email to the user with his temporary password. The accessor layer is where the technology switch is done. Depending of the task, it uses Entity Framework or the User Manager.</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#fff;color:#24292e" tabindex="0" data-language="csharp" data-theme="github-light"><code data-language="csharp" data-theme="github-light" style="display:grid"><span data-line=""><span style="color:#D73A49"> public</span><span style="color:#D73A49"> class</span><span style="color:#6F42C1"> UserAccessor</span><span style="color:#24292E">:</span><span style="color:#6F42C1">IUserAccessor</span><span style="color:#24292E"> { </span><span style="color:#D73A49">private</span><span style="color:#D73A49"> readonly</span><span style="color:#6F42C1"> IUserRepository</span><span style="color:#6F42C1"> userRepository</span><span style="color:#24292E">; </span><span style="color:#D73A49">private</span><span style="color:#D73A49"> readonly</span><span style="color:#6F42C1"> IRunningContext</span><span style="color:#6F42C1"> runningContext</span><span style="color:#24292E">; </span><span style="color:#D73A49">private</span><span style="color:#D73A49"> readonly</span><span style="color:#6F42C1"> IUnitOfWork</span><span style="color:#6F42C1"> unitOfWork</span><span style="color:#24292E"> ; </span><span style="color:#D73A49">private</span><span style="color:#D73A49"> readonly</span><span style="color:#6F42C1"> IUserManager</span><span style="color:#6F42C1"> userManager</span><span style="color:#24292E">; </span><span style="color:#D73A49">private</span><span style="color:#D73A49"> readonly</span><span style="color:#6F42C1"> IEmailProvider</span><span style="color:#6F42C1"> emailProvider</span><span style="color:#24292E">; </span><span style="color:#D73A49">public</span><span style="color:#6F42C1"> UserAccessor</span><span style="color:#24292E">(</span><span style="color:#6F42C1">IRunningContext</span><span style="color:#6F42C1"> runningContext</span><span style="color:#24292E">,</span><span style="color:#6F42C1">IUnitOfWork</span><span style="color:#6F42C1"> unitOfWork</span><span style="color:#24292E">, </span><span style="color:#6F42C1">IUserRepository</span><span style="color:#6F42C1"> repository</span><span style="color:#24292E">, </span><span style="color:#6F42C1">IUserManager</span><span style="color:#6F42C1"> userManager</span><span style="color:#24292E">, </span><span style="color:#6F42C1">IEmailProvider</span><span style="color:#6F42C1"> emailProvider</span><span style="color:#24292E">) { </span><span style="color:#005CC5">this</span><span style="color:#24292E">.runningContext </span><span style="color:#D73A49">=</span><span style="color:#24292E"> runningContext; </span><span style="color:#005CC5">this</span><span style="color:#24292E">.unitOfWork </span><span style="color:#D73A49">=</span><span style="color:#24292E"> unitOfWork; </span><span style="color:#005CC5">this</span><span style="color:#24292E">.userRepository </span><span style="color:#D73A49">=</span><span style="color:#24292E"> repository; </span><span style="color:#005CC5">this</span><span style="color:#24292E">.userManager </span><span style="color:#D73A49">=</span><span style="color:#24292E"> userManager; </span><span style="color:#005CC5">this</span><span style="color:#24292E">.emailProvider </span><span style="color:#D73A49">=</span><span style="color:#24292E"> emailProvider; } </span><span style="color:#D73A49">public</span><span style="color:#D73A49"> async</span><span style="color:#6F42C1"> Task</span><span style="color:#24292E">&lt;</span><span style="color:#6F42C1">IdentityResult</span><span style="color:#24292E">&gt; </span><span style="color:#6F42C1">CreateASync</span><span style="color:#24292E">(</span><span style="color:#6F42C1">ApplicationUser</span><span style="color:#6F42C1"> user</span><span style="color:#24292E">) { </span><span style="color:#D73A49">return</span><span style="color:#D73A49"> await</span><span style="color:#005CC5"> this</span><span style="color:#24292E">.userManager.</span><span style="color:#6F42C1">CreateASync</span><span style="color:#24292E">(user); } </span><span style="color:#6A737D">//... public void Update(ApplicationUser userAccount) { this.userRepository.Update(userAccount); this.unitOfWork.Commit(); } } </span></span></code></pre></figure>
<p>Here is a code that show the difference between the creation of a user and an update.</p>
<p>This is it for the user. I will write later with external login when everything will be working correctly. So far, I had to do some weird thing to make it works.</p>
<h1>SPRINT 2: CREATING THE FIRST ENTITY March 10, 2014 By: pdesjardins</h1>
<p>Creating the first entity has always something different from others entities. The reason is that a lot of the infrastructure is not yet in place. The first entity chose is the Contest entity. It is a very complex class that use others entities. Before going any deeper, let’s see the class diagram for the Contest that was planned to use.</p>
<p><img src="/images/blog/Classes_Contest-1024x573.png" alt=""/></p>
<p>As we can see, we firstly wanted to use inheritance for different type of contest. However, this is what will be done.</p>
<p><img src="/images/blog/LayersBourseVirtuelle.png" alt=""/></p>
<p>In fact, we have a contest class that use other classes. This simplify by a lot the use of contest with Entity Framework but also because we want to have contest with Option and Short and Stock or maybe a combination of some of them but not all. Having inheritance would require to have ContestWithStock having inheritance with ContestWithOption or vice versa but also all others different scenario. The concrete implementation of this architecture is mostly all in the Model project, inside the Entities folder.</p>
<p><img src="/images/blog/Part2Project.png" alt=""/></p>
<p><img src="/images/blog/Classes_Contest-1024x573.png" alt=""/></p>
<p>As the diagram shows, Contest, ContestTransactionRules, ContestRegistrationRules and models classes like ContestWithOption, ContestWithStock and ContestWithShort inherit from ValidatableModel which has the Validate method and ValidateChildren. This mean that Contest will have inside its ValidateChildren a call to ContestWithStock, ContestWithShort and ContestWithOption but only if these one are required to be validated. This mean that if the contest does not allows options, than we will not validate options.</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#fff;color:#24292e" tabindex="0" data-language="csharp" data-theme="github-light"><code data-language="csharp" data-theme="github-light" style="display:grid"><span data-line=""><span style="color:#D73A49"> public</span><span style="color:#D73A49"> override</span><span style="color:#6F42C1"> IEnumerable</span><span style="color:#6F42C1"> ValidateChildren</span><span style="color:#24292E">() { </span><span style="color:#D73A49">var</span><span style="color:#6F42C1"> r</span><span style="color:#D73A49"> =</span><span style="color:#D73A49"> new</span><span style="color:#6F42C1"> List</span><span style="color:#24292E">(); </span><span style="color:#D73A49">if</span><span style="color:#24292E">(StockRules </span><span style="color:#D73A49">!=</span><span style="color:#005CC5"> null</span><span style="color:#24292E">) r.</span><span style="color:#6F42C1">AddRange</span><span style="color:#24292E">(StockRules.</span><span style="color:#6F42C1">Validate</span><span style="color:#24292E">()); </span><span style="color:#D73A49">if</span><span style="color:#24292E">(OptionRules </span><span style="color:#D73A49">!=</span><span style="color:#005CC5"> null</span><span style="color:#24292E">) r.</span><span style="color:#6F42C1">AddRange</span><span style="color:#24292E">(OptionRules.</span><span style="color:#6F42C1">Validate</span><span style="color:#24292E">()); </span><span style="color:#D73A49">if</span><span style="color:#24292E">(ShortRules </span><span style="color:#D73A49">!=</span><span style="color:#005CC5"> null</span><span style="color:#24292E">) r.</span><span style="color:#6F42C1">AddRange</span><span style="color:#24292E">(ShortRules.</span><span style="color:#6F42C1">Validate</span><span style="color:#24292E">()); </span><span style="color:#D73A49">if</span><span style="color:#24292E">(RegistrationRules </span><span style="color:#D73A49">!=</span><span style="color:#005CC5"> null</span><span style="color:#24292E">) r.</span><span style="color:#6F42C1">AddRange</span><span style="color:#24292E">(RegistrationRules.</span><span style="color:#6F42C1">Validate</span><span style="color:#24292E">()); </span><span style="color:#D73A49">if</span><span style="color:#24292E">(TransactionsRules </span><span style="color:#D73A49">!=</span><span style="color:#005CC5"> null</span><span style="color:#24292E">) r.</span><span style="color:#6F42C1">AddRange</span><span style="color:#24292E">(TransactionsRules.</span><span style="color:#6F42C1">Validate</span><span style="color:#24292E">()); </span><span style="color:#D73A49">return</span><span style="color:#24292E"> r; } </span></span></code></pre></figure>
<p>This is the ValidateChildren of the Contest. What is interesting is that it is easy to unit test since every different parts can be tested independently. Still, the Contest has its own validation in its Validate method.</p>
<p>Complex Type Another challenge of this sprint was the use of complex type. We have two complex types that is used by the Contest. The first one is a concept that I had already used and it concerns localized string. The LocalizedString is a class that has a property for each language supported. In this case, we have a French and English property. The system know which one to use because it has a Current property that select the good one depending of the current thread culture. What is interesting is since it is a complex type we have both property inside the entity that use this one. For example, the Contest table will have two fields like the following screenshot.</p>
<p>ContestTableWithLocalizedString</p>
<p>The challenge was more for the new complex type which is Money. The money type was harder because it has to use currency that come from Value Object. The problem is that complex object cannot use navigation property. It also need to have a reference to Value Object that is in the Model namespace. The problem is that Model reference the namespace ComplexTypes. Circular reference appears! To solve this problem, a new namespace has been created : “ComplexTypeWithValueObjects”. The second problem is solved by having the Money with a property to the ValueObject but it will not be mapped by Entity Framework with this property but with a Integer field that will not be associated to anything. Without the limitation of Entity Framework with Complex type and navigation property it would have been a Foreign Key, but this time we will save the entity id without navigation property. This is why you can see in the previous screenshot that the table has a field at the end without a foreign key for the currency.</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#fff;color:#24292e" tabindex="0" data-language="csharp" data-theme="github-light"><code data-language="csharp" data-theme="github-light" style="display:grid"><span data-line=""><span style="color:#D73A49"> public</span><span style="color:#D73A49"> class</span><span style="color:#6F42C1"> Money</span><span style="color:#24292E"> { </span><span style="color:#D73A49">public</span><span style="color:#D73A49"> decimal</span><span style="color:#6F42C1"> Value</span><span style="color:#24292E"> { </span><span style="color:#D73A49">get</span><span style="color:#24292E">; </span><span style="color:#D73A49">set</span><span style="color:#24292E">; } </span><span style="color:#D73A49">public</span><span style="color:#D73A49"> int</span><span style="color:#6F42C1"> CurrencyTypeId</span><span style="color:#24292E"> { </span><span style="color:#D73A49">get</span><span style="color:#24292E"> { </span><span style="color:#D73A49">return</span><span style="color:#005CC5"> this</span><span style="color:#24292E">.Currency.Id; } </span><span style="color:#D73A49">set</span><span style="color:#24292E"> { </span><span style="color:#005CC5">this</span><span style="color:#24292E">.Currency </span><span style="color:#D73A49">=</span><span style="color:#24292E"> CurrencyType.</span><span style="color:#6F42C1">GetCurrencyFromId</span><span style="color:#24292E">(value); } } </span><span style="color:#6A737D">/// &lt;</span><span style="color:#22863A">summary</span><span style="color:#6A737D">&gt; /// This is ignored by EntityFramework /// &lt;/</span><span style="color:#22863A">summary</span><span style="color:#6A737D">&gt; public CurrencyType Currency { get; set; } } </span></span></code></pre></figure>
<p>The setter use a method that convert a integer to the value object. This way, we do not need to have the foreign key to have the full object loaded. We can do this only because we use Value Object and that we do have everything in the code.</p>
<p>For the rest of the sprint, we still work on the Contest entity but more visually. The view is also new with this sprint and this first entity because we have to play for the first time with BootStrap but also to create shared editor templates for all complex types. This sprint will not be the fastest one but it is totally acceptable since we are setuping the project core for a lot of features that will be reused by code or by concept.</p>
<h1>SPRINT 2 : A FIRST EXPERIENCE WITH THE UI March 17, 2014 By: pdesjardins</h1>
<p>During the Sprint 2 we had to develop the creation of a contest. In the last post, we had to create the Contest entity. This was harder than planned and it was the same for the UI. The reason is the same as for the entity : the first entity, backend or frontend, takes more time.</p>
<p>This project is built with BootStrap. This library is very awesome for having a fast development of an application that works on multiple browsers and multiple platforms (like tablet, phone, computer). The problem with BootStrap is that if you want something a little bit different form the base, it requires some work. This is the first project that I have to use BootStrap 3. BootStrap 3 is oriented for smaller device first (mobile). During the creation of the contest screen, I had something that I wanted. I wanted something that work file with some of our entities like the LocalizedString which has 2 fields for a single property. Here is what I wanted for the mobile and what I wanted for tablet and desktop.</p>
<p>Mobile: BootStrapContestMobile Desktop: BootStrapContestDesktop</p>
<p>As you can see, the name as something different. This was a huge matter with BootStrap that would have be easier to do in plain CSS. However, the goal is to have the mobile version to work with the label at the top of inputs. This is where BootStrap shines. Without having to have two layouts, html elements change position.</p>
<p>How To Work With BootStrap The easier way to create a design that you have in you head into Visual Studio is to first create this one outside Visual Studio! Yes. It easier to not have in your arms to manage editor templates, html helpers and the binding. Simple create a .html file, add BootStrap styles sheet and JavaScript.</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#fff;color:#24292e" tabindex="0" data-language="html" data-theme="github-light"><code data-language="html" data-theme="github-light" style="display:grid"><span data-line=""><span style="color:#24292E">&lt;</span><span style="color:#22863A">html</span><span style="color:#24292E">&gt; &lt;</span><span style="color:#22863A">head</span><span style="color:#24292E">&gt; &lt;</span><span style="color:#22863A">link</span><span style="color:#6F42C1"> href</span><span style="color:#24292E">=</span><span style="color:#032F62">&quot;bootstrap.css&quot;</span><span style="color:#6F42C1"> rel</span><span style="color:#24292E">=</span><span style="color:#032F62">&quot;stylesheet&quot;</span><span style="color:#24292E">&gt; &lt;</span><span style="color:#22863A">style</span><span style="color:#6F42C1"> type</span><span style="color:#24292E">=</span><span style="color:#032F62">&quot;text/css&quot;</span><span style="color:#24292E">&gt; </span><span style="color:#22863A">body</span><span style="color:#24292E"> { </span><span style="color:#005CC5">padding</span><span style="color:#24292E">:</span><span style="color:#005CC5">30</span><span style="color:#D73A49">px</span><span style="color:#24292E">; } &lt;/</span><span style="color:#22863A">style</span><span style="color:#24292E">&gt; &lt;/</span><span style="color:#22863A">head</span><span style="color:#24292E">&gt; &lt;</span><span style="color:#22863A">body</span><span style="color:#24292E">&gt; </span><span style="color:#6A737D">&lt;!-- HERE YOUR CODE --&gt;</span><span style="color:#24292E"> &lt;/</span><span style="color:#22863A">body</span><span style="color:#24292E">&gt; &lt;</span><span style="color:#22863A">script</span><span style="color:#6F42C1"> src</span><span style="color:#24292E">=</span><span style="color:#032F62">&quot;bootstrap.js&quot;</span><span style="color:#24292E">&gt;&lt;/</span><span style="color:#22863A">script</span><span style="color:#24292E">&gt; &lt;/</span><span style="color:#22863A">html</span><span style="color:#24292E">&gt; </span></span></code></pre></figure>
<p>This is the same template you can use for all your pages. I added in the header a style element. I would never do this in a real project, but to have fun with BootStrap, it’s faster. Now, it is the time to remove the “Here Your Code” comment with BootStrap.</p>
<p>The first component used is the panel. This create a division with a border and a title. That’s it. This is perfect because since the contest entity does have several sub object, a panel by object will be perfect.</p>
<p>Before doing anything you must do your BootStrap into a division that has the “container”. This will place your form in the middle of the page. Then, you must create some division for the panel. Details can be found on BootStrap but to be short you have one contain and one for the header and one for the body.</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#fff;color:#24292e" tabindex="0" data-language="html" data-theme="github-light"><code data-language="html" data-theme="github-light" style="display:grid"><span data-line=""><span style="color:#24292E">&lt;</span><span style="color:#22863A">div</span><span style="color:#6F42C1"> class</span><span style="color:#24292E">=</span><span style="color:#032F62">&quot;panel panel-default&quot;</span><span style="color:#24292E">&gt; &lt;</span><span style="color:#22863A">div</span><span style="color:#6F42C1"> class</span><span style="color:#24292E">=</span><span style="color:#032F62">&quot;panel-heading&quot;</span><span style="color:#24292E">&gt;General Information&lt;/</span><span style="color:#22863A">div</span><span style="color:#24292E">&gt; &lt;</span><span style="color:#22863A">div</span><span style="color:#6F42C1"> class</span><span style="color:#24292E">=</span><span style="color:#032F62">&quot;panel-body&quot;</span><span style="color:#24292E">&gt; </span><span style="color:#6A737D">&lt;!-- HERE YOUR CODE --&gt;</span><span style="color:#24292E"> &lt;/</span><span style="color:#22863A">div</span><span style="color:#24292E">&gt; &lt;/</span><span style="color:#22863A">div</span><span style="color:#24292E">&gt; </span></span></code></pre></figure>
<p>LocalizedString Control The first control for the contest entity is the name. This one is for the LocalizedString complex type. Since we want to have this control in a single line, we start with a division that has the “row” class. We will not use form-group class directly because we have something particular with this control. We have a label that is for the control and then 2 labels and inputs.</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#fff;color:#24292e" tabindex="0" data-language="html" data-theme="github-light"><code data-language="html" data-theme="github-light" style="display:grid"><span data-line=""> </span></code></pre></figure>
<p>At first, I started with the col-xs-12 without doing anything for bigger resolution (sm). I wanted to have the name label that takes the whole line. The same for the labels for all languages and inputs. This is why col-xs-12 is used. It takes the whole 12 columns that a grid has. This is not the same behavior for the small resolution and higher. In that case, we want to take only 2 columns for the main label and then the rest of the 10 columns for the label-input. What is important is to have columns into row every times.</p>
<p>From there, if everything is rendered correctly, than you can create a Html Helper that will help you to create this kind of behavior with property with dual-label and another one for a single label-input type.</p>
<p>Creating Asp.Net MVC Html Helpers for BootStraper You will repeat a lot of times this layout with a single layout and a single output. You may also repeat this LocalizedString that has more than one input for a single property. This is where Asp.Net MVC can make your life easier by creating Asp.Net Html Helper.</p>
<p>This way, the contest view can be clean and easy to change later on by modifying only a single place (the html placeholder) and affecting every pages. Here is a snippet of the contest view.</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#fff;color:#24292e" tabindex="0" data-language="html" data-theme="github-light"><code data-language="html" data-theme="github-light" style="display:grid"><span data-line=""> </span></code></pre></figure>
<p>As you can see, the property Name is of type LocalizedString, and InitialCapital and OrderType are both from a single value type. We do use two different Html Helpers to generate the BootStrap layout. If in the future we change the layout, all pages that use these Html Helpers will be affected easily without having to modify several pages. It has also the advantage to have a good separation of concern where the Html Helper handle the creation of Html controls while the page has the page layout goal. Nevertheless, the big disadvantage is the the Html Helper code is a mess to understand. It is a lot easier to read html tag not inside C# code. Here is the Html Helper Code.</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#fff;color:#24292e" tabindex="0" data-language="csharp" data-theme="github-light"><code data-language="csharp" data-theme="github-light" style="display:grid"><span data-line=""><span style="color:#D73A49"> public</span><span style="color:#6F42C1"> MvcHtmlString</span><span style="color:#6F42C1"> FormGroupWithSeveralSubProperties</span><span style="color:#24292E">&lt;</span><span style="color:#6F42C1">TProperty</span><span style="color:#24292E">, </span><span style="color:#6F42C1">TPropertyExpression</span><span style="color:#24292E">&gt;(</span><span style="color:#6F42C1">Expression</span><span style="color:#24292E">&lt;</span><span style="color:#6F42C1">Func</span><span style="color:#24292E">&lt;</span><span style="color:#6F42C1">TModel</span><span style="color:#24292E">, </span><span style="color:#6F42C1">TProperty</span><span style="color:#24292E">&gt;&gt; </span><span style="color:#6F42C1">mainPropertyExpression</span><span style="color:#24292E">, </span><span style="color:#D73A49">params</span><span style="color:#6F42C1"> Expression</span><span style="color:#24292E">&lt;</span><span style="color:#6F42C1">Func</span><span style="color:#24292E">&lt;</span><span style="color:#6F42C1">TModel</span><span style="color:#24292E">, </span><span style="color:#6F42C1">TPropertyExpression</span><span style="color:#24292E">&gt;&gt;[] </span><span style="color:#6F42C1">expressions</span><span style="color:#24292E">) { </span><span style="color:#D73A49">var</span><span style="color:#6F42C1"> mainPropertyMetaData</span><span style="color:#D73A49"> =</span><span style="color:#24292E"> ModelMetadata.</span><span style="color:#6F42C1">FromLambdaExpression</span><span style="color:#24292E">(mainPropertyExpression, htmlHelper.ViewData); </span><span style="color:#6A737D">//Division of the row var mainRow = new TagBuilder(Constants.DIV); mainRow.AddCssClass(Constants.Css.ROW); #region Main Label //The main column that divide the first property label from the other contains that will have label+input var mainLabelContainer = new TagBuilder(Constants.DIV); mainLabelContainer.AddCssClass(Constants.Css.COL_XS12); mainLabelContainer.AddCssClass(Constants.Css.COL_SM2); //Mark the required field on the first label var mainLabelAttributes = new Dictionary&lt;string, object&gt; { { Constants.CLASS, string.Concat(Constants.Css.CONTROL_LABEL, Constants.DELIMITER_CLASS, Constants.Css.COL_SM12) } }; if (mainPropertyMetaData.IsRequired) { mainLabelAttributes[Constants.CLASS] += string.Concat(Constants.DELIMITER_CLASS, Constants.Css.REQUIRED); } var mainLabel = htmlHelper.LabelFor(mainPropertyExpression, mainLabelAttributes); //Main Label Group. Required to have the same spacing of other FormGroup helper var mainLabelGroup = new TagBuilder(Constants.DIV); mainLabelGroup.AddCssClass(Constants.Css.FORM_GROUP); mainLabelGroup.InnerHtml = mainLabel.ToString(); mainLabelContainer.InnerHtml = mainLabelGroup.ToString(); mainRow.InnerHtml = mainLabelContainer.ToString(); #endregion #region SubProperties //Division for the sub properties var secondaryContainer = new TagBuilder(Constants.DIV); secondaryContainer.AddCssClass(Constants.Css.COL_XS12); secondaryContainer.AddCssClass(Constants.Css.COL_SM10); foreach (var expression in expressions) { //For each sub property specified in the PARAMS we set a group that has a label + input var secondaryFormGroup = new TagBuilder(Constants.DIV); //The label secondaryFormGroup.AddCssClass(Constants.Css.FORM_GROUP); var secondaryLabelAttributes = new Dictionary&lt;string, object&gt; { { Constants.CLASS, string.Concat(Constants.Css.CONTROL_LABEL, Constants.DELIMITER_CLASS, Constants.Css.COL_SM2) } }; var labelSecondaryContainer = htmlHelper.LabelFor(expression,secondaryLabelAttributes); //The input var containerForSecondaryContainer = new TagBuilder(Constants.DIV); containerForSecondaryContainer.AddCssClass(Constants.Css.COL_SM10); var controlForSecondaryContainer = htmlHelper.EditorFor(expression, new { htmlAttributes = new { @class = Constants.Css.FORM_CONTROL } }); containerForSecondaryContainer.InnerHtml = controlForSecondaryContainer.ToString(); var validationMessageForSecondaryControl = htmlHelper.ValidationMessageFor(expression); containerForSecondaryContainer.InnerHtml += validationMessageForSecondaryControl.ToString(); secondaryFormGroup.InnerHtml = labelSecondaryContainer + containerForSecondaryContainer.ToString(); secondaryContainer.InnerHtml += secondaryFormGroup.ToString(); } #endregion mainRow.InnerHtml += secondaryContainer.ToString(); return new MvcHtmlString(mainRow.ToString()); } public MvcHtmlString FormGroupFor&lt;TProperty&gt;(Expression&lt;Func&lt;TModel, TProperty&gt;&gt; mainPropertyExpression) { var mainPropertyMetaData = ModelMetadata.FromLambdaExpression(mainPropertyExpression, htmlHelper.ViewData); //Division for the row var mainRow = new TagBuilder(Constants.DIV); mainRow.AddCssClass(Constants.Css.ROW); //Division for the column inside the row var mainContainer = new TagBuilder(Constants.DIV); mainContainer.AddCssClass(Constants.Css.COL_XS12); //Division that contains the Label + control var formContainer = new TagBuilder(Constants.DIV); formContainer.AddCssClass(Constants.Css.FORM_GROUP); //The Label with required class if the field is required from the [Required] attribute var mainLabelAttributes = new Dictionary&lt;string, object&gt; { { Constants.CLASS, string.Concat(Constants.Css.CONTROL_LABEL, Constants.DELIMITER_CLASS, Constants.Css.COL_SM2) } }; if (mainPropertyMetaData.IsRequired) { mainLabelAttributes[Constants.CLASS] += string.Concat(Constants.DELIMITER_CLASS, Constants.Css.REQUIRED); } var mainLabel = htmlHelper.LabelFor(mainPropertyExpression, mainLabelAttributes); //The control is inside a Division to allow the label to be at the left when the screen is &gt;= small var controlContainer = new TagBuilder(Constants.DIV); controlContainer.AddCssClass(Constants.Css.COL_SM10); //Row inside the control var rowInside = new TagBuilder(Constants.DIV); rowInside.AddCssClass(Constants.Css.ROW); //Column inside the control var columnInsideRowInside = new TagBuilder(Constants.DIV); columnInsideRowInside.AddCssClass(Constants.Css.COL_XS12); columnInsideRowInside.AddCssClass(Constants.Css.OFFSET_XS2); //Main Control var mainControl = htmlHelper.EditorFor(mainPropertyExpression); //Add everything columnInsideRowInside.InnerHtml = mainControl.ToString(); rowInside.InnerHtml = columnInsideRowInside.ToString(); controlContainer.InnerHtml = rowInside.ToString(); formContainer.InnerHtml = mainLabel.ToString() + controlContainer; mainContainer.InnerHtml = formContainer.ToString(); mainRow.InnerHtml = mainContainer.ToString(); return new MvcHtmlString(mainRow.ToString()); } </span></span></code></pre></figure>
<p>What is very important is that the HtmlHelper still use the EditorFor template that use Shared Editor Template. This way, we can define by type or with UIHint attribute what to display within the BootStrap structure. This is important to not directly use TextBoxFor or any other HtmlHelpers because we want to be able to reuse this BootStrap Html Helper without having to create one for every possible type.</p>
<h1>SPRINT 2 : USING THE BUILDER IN SERVICE LAYER March 24, 2014 By: pdesjardins</h1>
<p>When developing unit testing you have to reuse a lot of time the same configuration for your entities. This is why multiple patterns exist to create your entities. A simple one is to have a Builder for your Models and one for your View Models.</p>
<p><img src="/images/blog/Builders.png" alt=""/></p>
<p>In this solution, I decided to create two projects. One for the Model and one for the ViewModel. I divide the project per entities. To keep it simple, I create static method that return for different scenario. Here are some signatures that I currently have for the Contest entity.</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#fff;color:#24292e" tabindex="0" data-language="csharp" data-theme="github-light"><code data-language="csharp" data-theme="github-light" style="display:grid"><span data-line=""><span style="color:#D73A49"> public</span><span style="color:#D73A49"> static</span><span style="color:#6F42C1"> Model</span><span style="color:#24292E">.</span><span style="color:#6F42C1">Entities</span><span style="color:#24292E">.</span><span style="color:#6F42C1">Contest</span><span style="color:#24292E">.</span><span style="color:#6F42C1">Contest</span><span style="color:#6F42C1"> GetAStockContest</span><span style="color:#24292E">() public static Model.Entities.Contest.Contest GetAStockShortOptionContest() public static Model.Entities.Contest.Contest GetANewContest() public static Model.Entities.Contest.Contest GetDefaultNewContest() public static ContestWithOption GetAnOptionRules() public static ContestWithShort GetAShortRules() public static ContestTransactionRules GetACorrectTransactionRules() public static ContestRegistrationRules GetACorrectRegistrationRules() public static ContestWithStock GetACorrectStockRules() </span></span></code></pre></figure>
<p>As you can notice, the first 4 methods return a contest while the rest of the method does not. In fact, the four first methods use these other methods to get property filled up. For example, all these contests has transaction rule so they can use this builder. In a case that you do not want transaction, you can set to NULL the property or create a new GetContestWithoutTransaction() method.</p>
<p>It is up to you. What is it important is that you do not repeat yourself in all your tests. What is new in this sprint is that I used the builder into the service layer to return a new contest with default values. This way, the builder can be unit tested to be sure what are the expected default value returned but also to do tests.</p>
<p>This is the code in the service code.</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#fff;color:#24292e" tabindex="0" data-language="csharp" data-theme="github-light"><code data-language="csharp" data-theme="github-light" style="display:grid"><span data-line=""><span style="color:#D73A49"> public</span><span style="color:#6F42C1"> Contest</span><span style="color:#6F42C1"> New</span><span style="color:#24292E">() { </span><span style="color:#D73A49">var</span><span style="color:#6F42C1"> newContest</span><span style="color:#D73A49"> =</span><span style="color:#24292E"> ModelBuilders.Contest.ContestModelBuilder.</span><span style="color:#6F42C1">GetDefaultNewContest</span><span style="color:#24292E">(); </span><span style="color:#D73A49">return</span><span style="color:#24292E"> newContest; } </span></span></code></pre></figure>
<p>This change required to modify the architecture layer to allow the service layer to access the Model Builder project. This is all fine with me since it already have access to the model layer that the builder uses.</p>
<h1>SPRINT 2 : IMPROVING DATA ANNOTATION, UNIT TESTING AND VIEW MODEL March 31, 2014 By: pdesjardins</h1>
<p>This week I have improved a lot of different thing that was all related to the Contest entity. This is one of the last sprint we have for the creation and edition of the contest. It was the first entity that we had to create everything from the view to the database. This is always a lot more time consuming for the first entity. Not only we have to work on the UI and setup everything for the future to have a consistent layout but we also have to do this for unit testing, model, view model and Entity Framework.</p>
<p>Data Annotation Improvement One thing that was problematic was the validation that specify that a Contest starting date must be after the current date. This is always the case for new contest. However, if we edit a contest few time later, the starting date should not change and will be after the current date. The initial validation of the starting date was done by a custom Data Validation attribute.</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#fff;color:#24292e" tabindex="0" data-language="csharp" data-theme="github-light"><code data-language="csharp" data-theme="github-light" style="display:grid"><span data-line=""><span style="color:#24292E"> [</span><span style="color:#6F42C1">DateAfterOrCurrentDate</span><span style="color:#24292E">] </span><span style="color:#D73A49">public</span><span style="color:#24292E"> DateTime StartingTime { get; set; } </span></span></code></pre></figure>
<p>To modify this we need to know if we are editing or not for the first time the entity. The ContestRegistrationRules, that has the StartingTime property to validate, does not have any ID or date because it is saved inside the Contest table. It is divided only in the code. We had something for any model class to know if they are new because they inherit from IModel that has a IsNew method. However, this was problematic to implement for ContestRegistrationRules because this one inherit from IEntity that has a ID property that we do not want for the ContestRegistrationRules.</p>
<p>This is where we had to modify the classes. First of all, it was a mistake to think that IModel that has the IsNew method must inherit from IEntity. It does not mean that every time we want to check the IsNew from the ID.</p>
<p><img src="/images/blog/ModelState-1024x436.png" alt=""/></p>
<p>The modification add a new Interface and mode the IsNew from IModel into IModelState. This way, it is possible for a class, like the ContestRegistrationRules to inherit from IModelState without inheriting from IEntity or IModel. From there, we can pass the information from the Contest into the ContestRegistrationRules or during unit testing simply mock this value. Here is the code of the Contest now.</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#fff;color:#24292e" tabindex="0" data-language="csharp" data-theme="github-light"><code data-language="csharp" data-theme="github-light" style="display:grid"><span data-line=""><span style="color:#D73A49"> public</span><span style="color:#D73A49"> class</span><span style="color:#6F42C1"> Contest</span><span style="color:#24292E"> : </span><span style="color:#6F42C1">Implementations</span><span style="color:#24292E">.</span><span style="color:#6F42C1">Model</span><span style="color:#24292E">, </span><span style="color:#6F42C1">IValidatableObject</span><span style="color:#24292E"> { </span><span style="color:#D73A49">private</span><span style="color:#6F42C1"> ContestRegistrationRules</span><span style="color:#6F42C1"> registrationRules</span><span style="color:#24292E">; </span><span style="color:#D73A49">public</span><span style="color:#6F42C1"> Contest</span><span style="color:#24292E">() { RegistrationRules </span><span style="color:#D73A49">=</span><span style="color:#D73A49"> new</span><span style="color:#6F42C1"> ContestRegistrationRules</span><span style="color:#24292E">(</span><span style="color:#005CC5">this</span><span style="color:#24292E">); </span><span style="color:#6A737D">//... } //... [Required] public ContestRegistrationRules RegistrationRules { get { return registrationRules; } set { registrationRules = value; registrationRules.ContestState = this; } } } </span></span></code></pre></figure>
<p>The property is internal, which limit the case that you can set the state from the external. The constructor of the Contest allow Entity Framework to instantiate this one and send the information to the children without a problem.</p>
<p>For the unit test, it is now possible to test for new and existing ContestRegistrationRules the same rule. Here is the two tests that validate the same rule.</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#fff;color:#24292e" tabindex="0" data-language="csharp" data-theme="github-light"><code data-language="csharp" data-theme="github-light" style="display:grid"><span data-line=""><span style="color:#24292E"> [</span><span style="color:#6F42C1">TestMethod</span><span style="color:#24292E">] </span><span style="color:#D73A49">public</span><span style="color:#D73A49"> void</span><span style="color:#6F42C1"> GivenANewContestWithRegistration_WhenContestRegistrationStartingTimeIsBeforeNow_ThenReturnValidationResult</span><span style="color:#24292E">() { </span><span style="color:#6A737D">// Arrange var contest = new ContestRegistrationRules { StartingTime = new DateTime(2021, 01, 01) ,EndingTime = new DateTime(2023, 01, 01) ,RegistrationStartingTime = new DateTime(1950, 01, 01) ,RegistrationEndingTime = new DateTime(2021, 01, 01) ,MaximumReputationForRegistration = 0 }; // Act var validationResults = contest.Validate(); var validationResult = validationResults.SelectMany(d =&gt; d.MemberNames); // Assert Assert.AreEqual(1, validationResults.Count()); Assert.IsTrue(validationResult.Contains(LambdaHelper.GetPropertyName(d =&gt; d.RegistrationStartingTime))); } [TestMethod] public void GivenAnExistingContestWithRegistration_WhenContestRegistrationStartingTimeIsBeforeNow_ThenReturnNoValidationResult() { // Arrange var state = new Mock(); state.Setup(d =&gt; d.IsNew()).Returns(false); var contest = new ContestRegistrationRules(state.Object) { StartingTime = new DateTime(2021, 01, 01) ,EndingTime = new DateTime(2023, 01, 01) ,RegistrationStartingTime = new DateTime(1950, 01, 01) ,RegistrationEndingTime = new DateTime(2021, 01, 01) ,MaximumReputationForRegistration = 0 }; // Act var validationResults = contest.Validate(); // Assert Assert.AreEqual(0, validationResults.Count()); } </span></span></code></pre></figure>
<p>As you can see, not a lot change. In fact, just the constructor that take if it is a new or not.</p>
<p>Of course, the attribute has changed too. Now, it verifies the state before doing any validation.</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#fff;color:#24292e" tabindex="0" data-language="csharp" data-theme="github-light"><code data-language="csharp" data-theme="github-light" style="display:grid"><span data-line=""><span style="color:#6A737D"> /// /// Validate the the date with the attribute is after the current date or the current date /// [AttributeUsage(AttributeTargets.Property, AllowMultiple = true)] public class DateAfterOrCurrentDate : BaseDataAnnotation { protected override ValidationResult IsValid(object value, ValidationContext validationContext) { var model = validationContext.ObjectInstance as IModelState; if (model == null || !model.IsNew()) { return ValidationResult.Success; } if (value != null) { DateTime valueConverted; if (DateTime.TryParse(value.ToString(), out valueConverted)) { if (IsAfterCurrent(valueConverted)) { return ValidationResult.Success; } } } return base.ReturnDefaultErrorMessage(string.Format(Resources.DataAnnotationErrorMessage.DateAfterOrCurrentDate, validationContext.DisplayName) , new[] { validationContext.MemberName }); } /// /// This method is virtual for the purpose of unit testing. It it possible to override to mock a true or false without /// having to play with date /// /// /// protected virtual bool IsAfterCurrent(DateTime dateTime) { return dateTime.Date &gt;= DateTime.UtcNow.Date; } /// /// To have multiple attributes of the same type to be validated /// private readonly object typeId = new object(); public override object TypeId { get { return this.typeId; } } } </span></span></code></pre></figure>
<p>The new code is at the top where it check if the class that has the property to validate has the interface. If not, we validate. If it does have it, we verify if it is a new instance. In that case, we do all validation. In the case of being not a new instance, we skip the validation. This way, when editing something that was valid during the creation like the time that the contest start will not fail if you edit something like the name of the contest few months later.</p>
<p>Controller that help common Value Object Something else changed concerning the Controller and how it can help to fill up information for view model. We are using view model for many reasons and one of the reason is to be able to give list of choice. For example, I want to give a list of possible stock exchange market and allow the use to create a contest with a set of market that can be used. The model has the markets for the contest but does not hold all possibles market. The list of possible market are only required for choosing in the interface. This is why it is the role of the controller to provide the list to the view. This is done by filling the view model. This is the case for creating but also when editing a Contest.</p>
<p>This is the case for a lot of value object. This is why instead of inheriting of ModelViewModelMappingController I create a new controller that has some methods that can be used to set lists.</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#fff;color:#24292e" tabindex="0" data-language="csharp" data-theme="github-light"><code data-language="csharp" data-theme="github-light" style="display:grid"><span data-line=""><span style="color:#D73A49"> public</span><span style="color:#D73A49"> class</span><span style="color:#6F42C1"> ModelViewModelMappingWithValueObjectsController</span><span style="color:#24292E">&lt;</span><span style="color:#6F42C1">TModel</span><span style="color:#24292E">, </span><span style="color:#6F42C1">TViewModel</span><span style="color:#24292E">&gt; : </span><span style="color:#6F42C1">ModelViewModelMappingController</span><span style="color:#24292E">&lt;</span><span style="color:#6F42C1">TModel</span><span style="color:#24292E">,</span><span style="color:#6F42C1">TViewModel</span><span style="color:#24292E">&gt; </span><span style="color:#D73A49">where</span><span style="color:#6F42C1"> TModel</span><span style="color:#24292E"> : </span><span style="color:#6F42C1">IValidatableModel</span><span style="color:#24292E"> { </span><span style="color:#D73A49">public</span><span style="color:#6F42C1"> ModelViewModelMappingWithValueObjectsController</span><span style="color:#24292E">(</span><span style="color:#6F42C1">IMapperFacade</span><span style="color:#6F42C1"> mapperFacade</span><span style="color:#24292E">, </span><span style="color:#6F42C1">IRunningContext</span><span style="color:#6F42C1"> runningContext</span><span style="color:#24292E">) : </span><span style="color:#005CC5">base</span><span style="color:#24292E">(mapperFacade, runningContext) { } </span><span style="color:#D73A49">protected</span><span style="color:#D73A49"> void</span><span style="color:#6F42C1"> FillUpMarkets</span><span style="color:#24292E">(</span><span style="color:#6F42C1">List</span><span style="color:#6F42C1"> availableItems</span><span style="color:#24292E">) { availableItems.</span><span style="color:#6F42C1">Add</span><span style="color:#24292E">(</span><span style="color:#D73A49">new</span><span style="color:#6F42C1"> SelectorItem</span><span style="color:#24292E">(Mapper.</span><span style="color:#6F42C1">Map</span><span style="color:#24292E">&lt;</span><span style="color:#6F42C1">MarketType</span><span style="color:#24292E">, </span><span style="color:#6F42C1">MarketTypeViewModel</span><span style="color:#24292E">&gt;(MarketType.UsMarketType))); availableItems.</span><span style="color:#6F42C1">Add</span><span style="color:#24292E">(</span><span style="color:#D73A49">new</span><span style="color:#6F42C1"> SelectorItem</span><span style="color:#24292E">(Mapper.</span><span style="color:#6F42C1">Map</span><span style="color:#24292E">&lt;</span><span style="color:#6F42C1">MarketType</span><span style="color:#24292E">, </span><span style="color:#6F42C1">MarketTypeViewModel</span><span style="color:#24292E">&gt;(MarketType.Toronto))); availableItems.</span><span style="color:#6F42C1">Add</span><span style="color:#24292E">(</span><span style="color:#D73A49">new</span><span style="color:#6F42C1"> SelectorItem</span><span style="color:#24292E">(Mapper.</span><span style="color:#6F42C1">Map</span><span style="color:#24292E">&lt;</span><span style="color:#6F42C1">MarketType</span><span style="color:#24292E">, </span><span style="color:#6F42C1">MarketTypeViewModel</span><span style="color:#24292E">&gt;(MarketType.Vancouver))); availableItems.</span><span style="color:#6F42C1">Add</span><span style="color:#24292E">(</span><span style="color:#D73A49">new</span><span style="color:#6F42C1"> SelectorItem</span><span style="color:#24292E">(Mapper.</span><span style="color:#6F42C1">Map</span><span style="color:#24292E">&lt;</span><span style="color:#6F42C1">MarketType</span><span style="color:#24292E">, </span><span style="color:#6F42C1">MarketTypeViewModel</span><span style="color:#24292E">&gt;(MarketType.OTCBB))); availableItems.</span><span style="color:#6F42C1">Add</span><span style="color:#24292E">(</span><span style="color:#D73A49">new</span><span style="color:#6F42C1"> SelectorItem</span><span style="color:#24292E">(Mapper.</span><span style="color:#6F42C1">Map</span><span style="color:#24292E">&lt;</span><span style="color:#6F42C1">MarketType</span><span style="color:#24292E">, </span><span style="color:#6F42C1">MarketTypeViewModel</span><span style="color:#24292E">&gt;(MarketType.PinkSheet))); } </span><span style="color:#D73A49">protected</span><span style="color:#D73A49"> void</span><span style="color:#6F42C1"> FillUpOrderTypes</span><span style="color:#24292E">(</span><span style="color:#6F42C1">List</span><span style="color:#6F42C1"> availableItems</span><span style="color:#24292E">) { availableItems.</span><span style="color:#6F42C1">Add</span><span style="color:#24292E">(</span><span style="color:#D73A49">new</span><span style="color:#6F42C1"> SelectorItem</span><span style="color:#24292E">(Mapper.</span><span style="color:#6F42C1">Map</span><span style="color:#24292E">&lt;</span><span style="color:#6F42C1">OrderType</span><span style="color:#24292E">, </span><span style="color:#6F42C1">OrderTypeViewModel</span><span style="color:#24292E">&gt;(OrderType.LimitOrderOnly))); availableItems.</span><span style="color:#6F42C1">Add</span><span style="color:#24292E">(</span><span style="color:#D73A49">new</span><span style="color:#6F42C1"> SelectorItem</span><span style="color:#24292E">(Mapper.</span><span style="color:#6F42C1">Map</span><span style="color:#24292E">&lt;</span><span style="color:#6F42C1">OrderType</span><span style="color:#24292E">, </span><span style="color:#6F42C1">OrderTypeViewModel</span><span style="color:#24292E">&gt;(OrderType.MarketLimitOrderOnly))); availableItems.</span><span style="color:#6F42C1">Add</span><span style="color:#24292E">(</span><span style="color:#D73A49">new</span><span style="color:#6F42C1"> SelectorItem</span><span style="color:#24292E">(Mapper.</span><span style="color:#6F42C1">Map</span><span style="color:#24292E">&lt;</span><span style="color:#6F42C1">OrderType</span><span style="color:#24292E">, </span><span style="color:#6F42C1">OrderTypeViewModel</span><span style="color:#24292E">&gt;(OrderType.MarketOrderOnly))); } </span><span style="color:#D73A49">protected</span><span style="color:#D73A49"> void</span><span style="color:#6F42C1"> FillUpCurrencies</span><span style="color:#24292E">(</span><span style="color:#6F42C1">List</span><span style="color:#6F42C1"> availableItems</span><span style="color:#24292E">) { availableItems.</span><span style="color:#6F42C1">Add</span><span style="color:#24292E">(</span><span style="color:#D73A49">new</span><span style="color:#6F42C1"> SelectorItem</span><span style="color:#24292E">(Mapper.</span><span style="color:#6F42C1">Map</span><span style="color:#24292E">&lt;</span><span style="color:#6F42C1">CurrencyType</span><span style="color:#24292E">, </span><span style="color:#6F42C1">CurrencyTypeViewModel</span><span style="color:#24292E">&gt;(CurrencyType.Canada))); availableItems.</span><span style="color:#6F42C1">Add</span><span style="color:#24292E">(</span><span style="color:#D73A49">new</span><span style="color:#6F42C1"> SelectorItem</span><span style="color:#24292E">(Mapper.</span><span style="color:#6F42C1">Map</span><span style="color:#24292E">&lt;</span><span style="color:#6F42C1">CurrencyType</span><span style="color:#24292E">, </span><span style="color:#6F42C1">CurrencyTypeViewModel</span><span style="color:#24292E">&gt;(CurrencyType.UnitedStatesOfAmerica))); } } </span></span></code></pre></figure>
<p>It is now a lot cleaner in controller. Here is the Create and Edit action method of the Contest controller.</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#fff;color:#24292e" tabindex="0" data-language="csharp" data-theme="github-light"><code data-language="csharp" data-theme="github-light" style="display:grid"><span data-line=""><span style="color:#24292E"> [</span><span style="color:#6F42C1">HttpGet</span><span style="color:#24292E">] </span><span style="color:#D73A49">public</span><span style="color:#6F42C1"> ActionResult</span><span style="color:#6F42C1"> Create</span><span style="color:#24292E">() { </span><span style="color:#D73A49">var</span><span style="color:#6F42C1"> defaultContest</span><span style="color:#D73A49"> =</span><span style="color:#005CC5"> this</span><span style="color:#24292E">.contestService.</span><span style="color:#6F42C1">New</span><span style="color:#24292E">(); </span><span style="color:#D73A49">var</span><span style="color:#6F42C1"> defaultContestViewModel</span><span style="color:#D73A49"> =</span><span style="color:#005CC5"> this</span><span style="color:#24292E">.MapperFacade.</span><span style="color:#6F42C1">GetViewModel</span><span style="color:#24292E">&lt;</span><span style="color:#6F42C1">Contest</span><span style="color:#24292E">, </span><span style="color:#6F42C1">ContestEditableViewModel</span><span style="color:#24292E">&gt;(defaultContest); </span><span style="color:#005CC5">this</span><span style="color:#24292E">.</span><span style="color:#6F42C1">FillUpWithAllList</span><span style="color:#24292E">(defaultContestViewModel); </span><span style="color:#D73A49">return</span><span style="color:#6F42C1"> View</span><span style="color:#24292E">(defaultContestViewModel); } [</span><span style="color:#6F42C1">HttpGet</span><span style="color:#24292E">] </span><span style="color:#D73A49">public</span><span style="color:#6F42C1"> ActionResult</span><span style="color:#6F42C1"> Edit</span><span style="color:#24292E">(</span><span style="color:#D73A49">int</span><span style="color:#6F42C1"> id</span><span style="color:#24292E">) { </span><span style="color:#D73A49">var</span><span style="color:#6F42C1"> contestToEdit</span><span style="color:#D73A49"> =</span><span style="color:#005CC5"> this</span><span style="color:#24292E">.contestService.</span><span style="color:#6F42C1">GetContestById</span><span style="color:#24292E">(id); </span><span style="color:#D73A49">var</span><span style="color:#6F42C1"> viewModel</span><span style="color:#D73A49"> =</span><span style="color:#005CC5"> this</span><span style="color:#24292E">.MapperFacade.</span><span style="color:#6F42C1">GetViewModel</span><span style="color:#24292E">&lt;</span><span style="color:#6F42C1">Contest</span><span style="color:#24292E">,</span><span style="color:#6F42C1">ContestEditableViewModel</span><span style="color:#24292E">&gt;(contestToEdit); </span><span style="color:#6F42C1">FillUpWithAllList</span><span style="color:#24292E">(viewModel); </span><span style="color:#D73A49">return</span><span style="color:#6F42C1"> View</span><span style="color:#24292E">(viewModel); } </span></span></code></pre></figure>
<p>View Model and Titles Another issue I had was that I do not want the view, neither to use ViewBag to specify the title of the view. I also wanted to have page title and sub title that may be different from the title set to the browser. This is why it is now possible to inherit from a viewmodel named WebPageViewModel. It has three properties that is used by the layout and others views.</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#fff;color:#24292e" tabindex="0" data-language="csharp" data-theme="github-light"><code data-language="csharp" data-theme="github-light" style="display:grid"><span data-line=""><span style="color:#6A737D"> /// &lt;</span><span style="color:#22863A">summary</span><span style="color:#6A737D">&gt; /// Contains information that is passed from the controller to the view that should be only uni-directionnal. The purpose of this class /// is to have common information that is required for most pages to be displayed into views or main layout. /// &lt;/</span><span style="color:#22863A">summary</span><span style="color:#6A737D">&gt; public class WebPageViewModel:ViewModel { /// &lt;</span><span style="color:#22863A">summary</span><span style="color:#6A737D">&gt; /// This is the title that is displayed in the browser title /// &lt;/</span><span style="color:#22863A">summary</span><span style="color:#6A737D">&gt; public string PageTitle { get; set; } /// &lt;</span><span style="color:#22863A">summary</span><span style="color:#6A737D">&gt; /// This is the main h1 of the page /// &lt;/</span><span style="color:#22863A">summary</span><span style="color:#6A737D">&gt; public string PageHeader { get; set; } /// &lt;</span><span style="color:#22863A">summary</span><span style="color:#6A737D">&gt; /// This is the specification for the title. It is not required. /// &lt;/</span><span style="color:#22863A">summary</span><span style="color:#6A737D">&gt; public string PageSubHeader { get; set; } } </span></span></code></pre></figure>
<p>In the layout, and header partial class, it is now possible to use this information.</p>
<p>First of all, I have in the Contest view:</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#fff;color:#24292e" tabindex="0" data-language="html" data-theme="github-light"><code data-language="html" data-theme="github-light" style="display:grid"><span data-line=""><span style="color:#24292E">@{ Html.Custom().SetHeader(Model); } </span></span></code></pre></figure>
<p>This allow to have for any view model passed into a view to set the information into a generic way : view bag. This could be improved later on. It has also the disadvantage to have to call this html extension for all your view. The problem is that the layout.cshtml cannot use the view model of the content.</p>
<p>The partial class for the header verify if the header is set and if the sub header is set. Depending of the value, it is displayed or not.</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#fff;color:#24292e" tabindex="0" data-language="html" data-theme="github-light"><code data-language="html" data-theme="github-light" style="display:grid"><span data-line=""><span style="color:#24292E">&lt;</span><span style="color:#22863A">header</span><span style="color:#24292E">&gt; &lt;</span><span style="color:#22863A">div</span><span style="color:#6F42C1"> class</span><span style="color:#24292E">=</span><span style="color:#032F62">&quot;container&quot;</span><span style="color:#24292E">&gt; &lt;</span><span style="color:#22863A">img</span><span style="color:#6F42C1"> id</span><span style="color:#24292E">=</span><span style="color:#032F62">&quot;titre_img&quot;</span><span style="color:#6F42C1"> src</span><span style="color:#24292E">=</span><span style="color:#032F62">&quot;@Url.Content(&quot;</span><span style="color:#6F42C1">~</span><span style="color:#B31D28;font-style:italic">/Content/Images/Logo/BourseVirtuelle.png&quot;)&quot;</span><span style="color:#6F42C1"> alt</span><span style="color:#24292E">=</span><span style="color:#032F62">&quot;Logo&quot;</span><span style="color:#24292E"> /&gt; @{ Html.RenderPartial(&quot;_Menu&quot;); } @{ var headerTitle = ViewBag.HeaderTitle; var headerSubTitle = ViewBag.HeaderSubTitle; if (!string.IsNullOrWhiteSpace(headerTitle)) { &lt;</span><span style="color:#22863A">div</span><span style="color:#6F42C1"> id</span><span style="color:#24292E">=</span><span style="color:#032F62">&quot;header-title&quot;</span><span style="color:#24292E">&gt; &lt;</span><span style="color:#22863A">h1</span><span style="color:#24292E">&gt; @headerTitle @if (!string.IsNullOrWhiteSpace(headerSubTitle)) { &lt;</span><span style="color:#22863A">small</span><span style="color:#24292E">&gt;@headerSubTitle&lt;/</span><span style="color:#22863A">small</span><span style="color:#24292E">&gt; } &lt;/</span><span style="color:#22863A">h1</span><span style="color:#24292E">&gt; &lt;/</span><span style="color:#22863A">div</span><span style="color:#24292E">&gt; &lt;</span><span style="color:#22863A">hr</span><span style="color:#24292E">/&gt; } } &lt;/</span><span style="color:#22863A">div</span><span style="color:#24292E">&gt; &lt;/</span><span style="color:#22863A">header</span><span style="color:#24292E">&gt; </span></span></code></pre></figure>
<p>Conclusion This sprint is about to conclude. Some work is still required to make the edition work but it is only small detail since all Unit Test has been done. Even code for Entity Framework has been unit tested.</p>
<h1>SPRINT 3 : IMPROVE THE TESTABILITY OF YOUR REPOSITORIES April 7, 2014 By: pdesjardins</h1>
<p>This first week of the sprint 3 aimed the contests entity. More precisely how to get from the database active contests and inactive one. This required to modify a little bit the Model Builder, the RunningContext, and TestBase.</p>
<p>Why all these modifications in the sprint 3? Mostly because to test the repository with the contest that we need to have more than only one contest in the database and depending of the test we want to have different contests. For example, we may want to have contest with a starting and ending date before the testing date. I have say “testing time” and not “current time”. This is important and this is why in this sprint the Model Builder has changed. Now, the builder have access to the running contest. This is why Model Builder is not anymore static and it takes in its constructor the IRunningContext.</p>
<p><img src="/images/blog/Sprint3BuilderCrossLayer-1024x504.png" alt=""/></p>
<p>The ContestBuilder looks like this:</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#fff;color:#24292e" tabindex="0" data-language="csharp" data-theme="github-light"><code data-language="csharp" data-theme="github-light" style="display:grid"><span data-line=""><span style="color:#D73A49"> public</span><span style="color:#D73A49"> class</span><span style="color:#6F42C1"> ContestModelBuilder</span><span style="color:#24292E"> { </span><span style="color:#D73A49">private</span><span style="color:#6F42C1"> IRunningContext</span><span style="color:#6F42C1"> runningContext</span><span style="color:#24292E">; </span><span style="color:#D73A49">public</span><span style="color:#6F42C1"> IRunningContext</span><span style="color:#6F42C1"> RunningContext</span><span style="color:#24292E"> { </span><span style="color:#D73A49">get</span><span style="color:#24292E"> { </span><span style="color:#D73A49">return</span><span style="color:#24292E"> runningContext; } </span><span style="color:#D73A49">set</span><span style="color:#24292E"> { </span><span style="color:#D73A49">if</span><span style="color:#24292E"> (value </span><span style="color:#D73A49">==</span><span style="color:#005CC5"> null</span><span style="color:#24292E">) { </span><span style="color:#D73A49">throw</span><span style="color:#D73A49"> new</span><span style="color:#6F42C1"> NullReferenceException</span><span style="color:#24292E">(</span><span style="color:#032F62">&quot;Running Contest must be set before using this method&quot;</span><span style="color:#24292E">); } runningContext </span><span style="color:#D73A49">=</span><span style="color:#24292E"> value; } } </span><span style="color:#D73A49">public</span><span style="color:#6F42C1"> ContestModelBuilder</span><span style="color:#24292E">(</span><span style="color:#6F42C1">IRunningContext</span><span style="color:#6F42C1"> runningContest</span><span style="color:#24292E">) { </span><span style="color:#005CC5">this</span><span style="color:#24292E">.RunningContext </span><span style="color:#D73A49">=</span><span style="color:#24292E"> runningContest; } </span><span style="color:#6A737D">//... } </span></span></code></pre></figure>
<p>This would be te case for all builders. In fact, it will end that all ModelBuilder will inherit from ModelBuilder that will have the IRunningContext instead of having the IRunningContext in each builder.</p>
<p>The other modification to be able to test easily was to create automatic rollback to every unit test for the repository. This can be done by creating a TestWithDatabase class. This class allows to have unit of works, repositories, running context and builders.</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#fff;color:#24292e" tabindex="0" data-language="csharp" data-theme="github-light"><code data-language="csharp" data-theme="github-light" style="display:grid"><span data-line=""><span style="color:#D73A49"> public</span><span style="color:#D73A49"> class</span><span style="color:#6F42C1"> TestWithDatabase</span><span style="color:#24292E"> { </span><span style="color:#D73A49">public</span><span style="color:#D73A49"> const</span><span style="color:#D73A49"> string</span><span style="color:#6F42C1"> CONNECTION_STRING_NAME</span><span style="color:#D73A49"> =</span><span style="color:#032F62"> &quot;DefaultConnection&quot;</span><span style="color:#24292E">; </span><span style="color:#6A737D">//It uses the same name of the web.config but from the app.config of the IntegrationTest protected IUnitOfWork unitOfWorkForInsertion; protected IUnitOfWork unitOfWorkForUpdate; protected IUnitOfWork unitOfWorkForReading; private IMainDbContext dbInsertDbContext; private IMainDbContext dbUpdateDbContext; private IMainDbContext dbReadingDbContext; protected Mock&lt;IRunningContext&gt; runningContext; private TransactionScope transaction; protected ContestModelBuilder contestModelBuilder; [TestInitialize] public void InitializeBetweenTest() { this.transaction = new TransactionScope(); runningContext = new Mock&lt;IRunningContext&gt;(); runningContext.Setup(d =&gt; d.GetCurrentTime()).Returns(new DateTime(2014, 03, 02)); runningContext.Setup(d =&gt; d.GetUserId()).Returns(ApplicationUser.SYSTEM_TEST_USER_ID); contestModelBuilder = new ContestModelBuilder(runningContext.Object); dbReadingDbContext = new MainDbContext(runningContext.Object, CONNECTION_STRING_NAME); dbInsertDbContext = new MainDbContext(runningContext.Object, CONNECTION_STRING_NAME); dbUpdateDbContext = new MainDbContext(runningContext.Object, CONNECTION_STRING_NAME); unitOfWorkForReading = new UnitOfWork(dbReadingDbContext); unitOfWorkForInsertion = new UnitOfWork(dbInsertDbContext); unitOfWorkForUpdate = new UnitOfWork(dbUpdateDbContext); } [TestCleanup] public void CleanUpBetweenTest() { this.transaction.Dispose(); } } </span></span></code></pre></figure>
<p>The trick about rollbacking is to be in a transaction from the start of the unit test and to not complete at the end. In the code above, we have set a TestInitialize and TestCleanup to start and stop the transaction scope. This way, we are sure that everything tested is never persisted in the database.</p>
<p>Having this setup, it is now possible to modify some of the existing test to remove the transaction scope and let the base class to execute the one we just set.</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#fff;color:#24292e" tabindex="0" data-language="csharp" data-theme="github-light"><code data-language="csharp" data-theme="github-light" style="display:grid"><span data-line=""><span style="color:#24292E"> [</span><span style="color:#6F42C1">TestMethod</span><span style="color:#24292E">] </span><span style="color:#D73A49">public</span><span style="color:#D73A49"> void</span><span style="color:#6F42C1"> GivenANewContest_WhenContestIsLegitToSave_ThenTheDatabaseHasANewContest</span><span style="color:#24292E">() { </span><span style="color:#6A737D">// Arrange var repositoryExecuting = new ContestRepository(unitOfWorkForInsertion, base.runningContext.Object); var repositoryReading = new ContestRepository(unitOfWorkForReading, base.runningContext.Object); var contest = contestModelBuilder.GetAStockContest(); int idSaved=-1; // Act try { repositoryExecuting.Save(contest); unitOfWorkForInsertion.Commit(); idSaved = contest.Id; } catch (Exception e) { Assert.Fail(e.Message); } var contestFromRepository = repositoryReading.GetById(idSaved); var countContest = repositoryReading.GetCount(); // Assert Assert.IsNotNull(contestFromRepository); Assert.AreEqual(1, countContest); } </span></span></code></pre></figure>
<p>This unit test will not store anything in the database and do the job automatically to remove everything. It is not possible for a developer to store anything in the database which is a huge advantage to keep the testing database clean.</p>
<p>The next modification is that we need to have some contests in the database for some of our tests. The problem is that we need to save contest that might not be valid to save. For example, one of the business logic is that we cannot insert a new contest that has a starting and ending date before the current date. This is required to have contest with a starting and ending date before the current date because this is considerate an inactive contest. We want to test method that return only the active contest but to do the test, we want to insert inactive too. This is why we have changed the <img src="/images/blog/FirstCommit.png" alt=""/></p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#fff;color:#24292e" tabindex="0" data-language="csharp" data-theme="github-light"><code data-language="csharp" data-theme="github-light" style="display:grid"><span data-line=""><span style="color:#D73A49"> public</span><span style="color:#D73A49"> void</span><span style="color:#6F42C1"> Commit</span><span style="color:#24292E">(</span><span style="color:#D73A49">bool</span><span style="color:#6F42C1"> isValidatingBeforeSave</span><span style="color:#D73A49">=</span><span style="color:#005CC5">true</span><span style="color:#24292E">) { </span><span style="color:#D73A49">if</span><span style="color:#24292E"> (isValidatingBeforeSave) { context.</span><span style="color:#6F42C1">SaveChanges</span><span style="color:#24292E">(); } </span><span style="color:#D73A49">else</span><span style="color:#24292E"> { context.</span><span style="color:#6F42C1">SaveChangesWithoutValidation</span><span style="color:#24292E">(); } } </span></span></code></pre></figure>
<p>The contest has two save methods. One is SaveChanges that we had previously and the new SaveChangesWithoutValidation. Here is a part of the MainDbContext:</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#fff;color:#24292e" tabindex="0" data-language="csharp" data-theme="github-light"><code data-language="csharp" data-theme="github-light" style="display:grid"><span data-line=""><span style="color:#D73A49"> public</span><span style="color:#D73A49"> int</span><span style="color:#6F42C1"> SaveChangesWithoutValidation</span><span style="color:#24292E">() { </span><span style="color:#D73A49">var</span><span style="color:#6F42C1"> result</span><span style="color:#D73A49"> =</span><span style="color:#D73A49"> -</span><span style="color:#005CC5">1</span><span style="color:#24292E">; </span><span style="color:#005CC5">this</span><span style="color:#24292E">.Configuration.ValidateOnSaveEnabled </span><span style="color:#D73A49">=</span><span style="color:#005CC5"> false</span><span style="color:#24292E">; </span><span style="color:#D73A49">try</span><span style="color:#24292E"> { result </span><span style="color:#D73A49">=</span><span style="color:#005CC5"> this</span><span style="color:#24292E">.</span><span style="color:#6F42C1">SaveChanges</span><span style="color:#24292E">(); } </span><span style="color:#D73A49">catch</span><span style="color:#24292E"> { </span><span style="color:#D73A49">throw</span><span style="color:#24292E">; } </span><span style="color:#D73A49">finally</span><span style="color:#24292E"> { </span><span style="color:#005CC5">this</span><span style="color:#24292E">.Configuration.ValidateOnSaveEnabled </span><span style="color:#D73A49">=</span><span style="color:#005CC5"> true</span><span style="color:#24292E">; } </span><span style="color:#D73A49">return</span><span style="color:#24292E"> result; } </span><span style="color:#D73A49">int</span><span style="color:#24292E"> IMainDbContext.</span><span style="color:#6F42C1">SaveChanges</span><span style="color:#24292E">() { </span><span style="color:#D73A49">return</span><span style="color:#005CC5"> this</span><span style="color:#24292E">.</span><span style="color:#6F42C1">SaveChanges</span><span style="color:#24292E">(); } </span><span style="color:#D73A49">public</span><span style="color:#D73A49"> override</span><span style="color:#D73A49"> int</span><span style="color:#6F42C1"> SaveChanges</span><span style="color:#24292E">() { </span><span style="color:#6F42C1">IEnumerable</span><span style="color:#24292E">&lt;</span><span style="color:#6F42C1">DbEntityValidationResult</span><span style="color:#24292E">&gt; </span><span style="color:#6F42C1">errors</span><span style="color:#D73A49"> =</span><span style="color:#D73A49"> new</span><span style="color:#6F42C1"> List</span><span style="color:#24292E">&lt;</span><span style="color:#6F42C1">DbEntityValidationResult</span><span style="color:#24292E">&gt;(); </span><span style="color:#D73A49">if</span><span style="color:#24292E"> (</span><span style="color:#005CC5">this</span><span style="color:#24292E">.Configuration.ValidateOnSaveEnabled) { errors </span><span style="color:#D73A49">=</span><span style="color:#005CC5"> this</span><span style="color:#24292E">.</span><span style="color:#6F42C1">GetValidationErrors</span><span style="color:#24292E">(); } </span><span style="color:#D73A49">if</span><span style="color:#24292E"> (</span><span style="color:#D73A49">!</span><span style="color:#24292E">errors.</span><span style="color:#6F42C1">Any</span><span style="color:#24292E">()) { </span><span style="color:#D73A49">try</span><span style="color:#24292E"> { </span><span style="color:#6A737D">//base.ChangeTracker.DetectChanges(); return base.SaveChanges(); } catch (OptimisticConcurrencyException concurrencyException) { throw new DatabaseConcurrencyException(&quot;Someone else has edited the entity in the same time of you. Please refresh and save again.&quot;, concurrencyException); } catch (DBConcurrencyException concurrencyException) { throw new DatabaseConcurrencyException(&quot;Someone else has edited the entity in the same time of you. Please refresh and save again.&quot;, concurrencyException); } catch (DbUpdateConcurrencyException e) { throw new DatabaseConcurrencyException(&quot;Someone else has edited the entity in the same time of you. Please refresh and save again.&quot;, e); } catch (Exception) { throw; } } else { throw new DatabaseValidationErrors(errors); } } </span></span></code></pre></figure>
<p>As you can see, the SaveChangesWithoutValidation call the same SaveChanges but set the Entity Framework Configuration value to indicate if we must validate or not during the save. The trick is to set the code to rollback the property ValidateOnSaveEnabled to true in the finally. This way, even if something wrong appears that the system will validate for the next save.</p>
<p>The last modification require was to be able to create contest easily into the database. This is why some helper method has been created in the ContestRepositoryIntegrationTest.cs. This way, we can have a test like the following one:</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#fff;color:#24292e" tabindex="0" data-language="csharp" data-theme="github-light"><code data-language="csharp" data-theme="github-light" style="display:grid"><span data-line=""><span style="color:#24292E"> [</span><span style="color:#6F42C1">TestMethod</span><span style="color:#24292E">] </span><span style="color:#D73A49">public</span><span style="color:#D73A49"> void</span><span style="color:#6F42C1"> GivenARequestForActiveContest_WhenDatabaseAsActiveAndInactiveContest_ThenReturnListOfOnlyActiveContests</span><span style="color:#24292E">() { </span><span style="color:#6A737D">// Arrange const int ACTIVE_CONTEST = 5; const int INACTIVE_CONTEST = 10; InsertActiveContestInDatabase(ACTIVE_CONTEST); InsertInactiveContestInDatabase(INACTIVE_CONTEST); unitOfWorkForInsertion.Commit(false);//Because we have stuff under the correct date // Act var readRepository = new ContestRepository(unitOfWorkForReading, base.runningContext.Object); var contests = readRepository.GetAllActiveContests(); // Assert Assert.AreEqual(ACTIVE_CONTEST,contests.Count()); } </span></span></code></pre></figure>
<p>ou can see that we are using two helpers. One that Insert active contest and one that insert inactive contest. In both case, they are using the ModelBuilder and the insert repository.</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#fff;color:#24292e" tabindex="0" data-language="csharp" data-theme="github-light"><code data-language="csharp" data-theme="github-light" style="display:grid"><span data-line=""><span style="color:#24292E"> #</span><span style="color:#D73A49">region</span><span style="color:#032F62"> Database Helpers private void InsertInactiveContestInDatabase(int amountOfContestToInsert) { var contestsToInsert = contestModelBuilder.GetBatchInActiveContest(amountOfContestToInsert); var insertRepository = new ContestRepository(unitOfWorkForInsertion, base.runningContext.Object); foreach (var contest in contestsToInsert) { insertRepository.Save(contest); } } private void InsertActiveContestInDatabase(int amountOfContestToInsert) { var contestsToInsert = contestModelBuilder.GetBatchActiveContest(amountOfContestToInsert); var insertRepository = new ContestRepository(unitOfWorkForInsertion, base.runningContext.Object); foreach (var contest in contestsToInsert) { insertRepository.Save(contest); } } #endregion </span></span></code></pre></figure>
<p>The code create contests in batch and save them all. They are built to be unique. Here is the model builder for the GetBatchInActiveContest method.</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#fff;color:#24292e" tabindex="0" data-language="csharp" data-theme="github-light"><code data-language="csharp" data-theme="github-light" style="display:grid"><span data-line=""><span style="color:#D73A49"> public</span><span style="color:#6F42C1"> IEnumerable</span><span style="color:#24292E">&lt;</span><span style="color:#6F42C1">Model</span><span style="color:#24292E">.</span><span style="color:#6F42C1">Entities</span><span style="color:#24292E">.</span><span style="color:#6F42C1">Contest</span><span style="color:#24292E">.</span><span style="color:#6F42C1">Contest</span><span style="color:#24292E">&gt; </span><span style="color:#6F42C1">GetBatchInActiveContest</span><span style="color:#24292E">(</span><span style="color:#D73A49">int</span><span style="color:#6F42C1"> amountOfContestToInsert</span><span style="color:#24292E">) { </span><span style="color:#D73A49">for</span><span style="color:#24292E"> (</span><span style="color:#D73A49">int</span><span style="color:#6F42C1"> i</span><span style="color:#D73A49"> =</span><span style="color:#005CC5"> 0</span><span style="color:#24292E">; i </span><span style="color:#D73A49">&lt;</span><span style="color:#24292E"> amountOfContestToInsert; i</span><span style="color:#D73A49">++</span><span style="color:#24292E">) { </span><span style="color:#D73A49">var</span><span style="color:#6F42C1"> contest</span><span style="color:#D73A49"> =</span><span style="color:#6F42C1"> GetDefaultNewContest</span><span style="color:#24292E">(); contest.Name.English </span><span style="color:#D73A49">=</span><span style="color:#032F62"> &quot;Inactive Contest #&quot;</span><span style="color:#D73A49"> +</span><span style="color:#24292E"> (i </span><span style="color:#D73A49">+</span><span style="color:#005CC5"> 1</span><span style="color:#24292E">); contest.Name.French </span><span style="color:#D73A49">=</span><span style="color:#032F62"> &quot;Concours inactif #&quot;</span><span style="color:#D73A49"> +</span><span style="color:#24292E"> (i </span><span style="color:#D73A49">+</span><span style="color:#005CC5"> 1</span><span style="color:#24292E">); contest.RegistrationRules.StartingTime </span><span style="color:#D73A49">=</span><span style="color:#24292E"> RunningContext.</span><span style="color:#6F42C1">GetCurrentTime</span><span style="color:#24292E">().</span><span style="color:#6F42C1">AddMonths</span><span style="color:#24292E">(</span><span style="color:#D73A49">-</span><span style="color:#24292E">amountOfContestToInsert </span><span style="color:#D73A49">*</span><span style="color:#24292E"> (i </span><span style="color:#D73A49">+</span><span style="color:#005CC5"> 1</span><span style="color:#24292E">) </span><span style="color:#D73A49">-</span><span style="color:#005CC5"> 1</span><span style="color:#24292E">); contest.RegistrationRules.EndingTime </span><span style="color:#D73A49">=</span><span style="color:#24292E"> RunningContext.</span><span style="color:#6F42C1">GetCurrentTime</span><span style="color:#24292E">().</span><span style="color:#6F42C1">AddMonths</span><span style="color:#24292E">(</span><span style="color:#D73A49">-</span><span style="color:#24292E">amountOfContestToInsert); </span><span style="color:#D73A49">yield</span><span style="color:#D73A49"> return</span><span style="color:#24292E"> contest; } } </span></span></code></pre></figure>
<p>As you can see, this create a batch of contest with different name and different starting time and ending time. Since we are creating active contest than we are creating everything before the current time. As you can notice, we are using the RunningContext date time and not the current time. This is simpler because we control the time of the context. It is also using other builder method like the GetDefaultNewContest() method. This way we are reusing existing builder and only change method that we want to have for the test. In this example, the time.</p>
<p>Another modification has been in the contest repository. To get all active contest, two methods has been created.</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#fff;color:#24292e" tabindex="0" data-language="csharp" data-theme="github-light"><code data-language="csharp" data-theme="github-light" style="display:grid"><span data-line=""><span style="color:#D73A49"> public</span><span style="color:#6F42C1"> IEnumerable</span><span style="color:#24292E">&lt;</span><span style="color:#6F42C1">Contest</span><span style="color:#24292E">&gt; </span><span style="color:#6F42C1">GetAllActiveContests</span><span style="color:#24292E">() { </span><span style="color:#D73A49">return</span><span style="color:#6F42C1"> GetAllActiveContestsQueryable</span><span style="color:#24292E">() .</span><span style="color:#6F42C1">ToArray</span><span style="color:#24292E">(); } </span><span style="color:#D73A49">private</span><span style="color:#6F42C1"> IQueryable</span><span style="color:#24292E">&lt;</span><span style="color:#6F42C1">Contest</span><span style="color:#24292E">&gt; </span><span style="color:#6F42C1">GetAllActiveContestsQueryable</span><span style="color:#24292E">() { </span><span style="color:#D73A49">var</span><span style="color:#6F42C1"> dateToBeBefore</span><span style="color:#D73A49"> =</span><span style="color:#005CC5"> base</span><span style="color:#24292E">.RunningContext.</span><span style="color:#6F42C1">GetCurrentTime</span><span style="color:#24292E">(); </span><span style="color:#D73A49">return</span><span style="color:#005CC5"> this</span><span style="color:#24292E">.</span><span style="color:#6F42C1">GetModelSet</span><span style="color:#24292E">() .</span><span style="color:#6F42C1">Where</span><span style="color:#24292E">(</span><span style="color:#6F42C1">d</span><span style="color:#D73A49"> =&gt;</span><span style="color:#24292E"> d.RegistrationRules.EndingTime </span><span style="color:#D73A49">&gt;=</span><span style="color:#24292E"> dateToBeBefore); } </span></span></code></pre></figure>
<p>The public method is available through the interface. It call the private IQueryable method that is used here to get all active contest but also in a second method to get all active contest for a specific user.</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#fff;color:#24292e" tabindex="0" data-language="csharp" data-theme="github-light"><code data-language="csharp" data-theme="github-light" style="display:grid"><span data-line=""><span style="color:#D73A49"> public</span><span style="color:#6F42C1"> IEnumerable</span><span style="color:#24292E">&lt;</span><span style="color:#6F42C1">Contest</span><span style="color:#24292E">&gt; </span><span style="color:#6F42C1">GetAllActiveUnSubscribedContests</span><span style="color:#24292E">(</span><span style="color:#6F42C1">Guid</span><span style="color:#6F42C1"> userId</span><span style="color:#24292E">) { </span><span style="color:#D73A49">var</span><span style="color:#6F42C1"> allActiveContest</span><span style="color:#D73A49"> =</span><span style="color:#6F42C1"> GetAllActiveContestsQueryable</span><span style="color:#24292E">(); </span><span style="color:#D73A49">var</span><span style="color:#6F42C1"> allActiveContestForUser</span><span style="color:#D73A49"> =</span><span style="color:#6F42C1"> GetAllActiveContestForUserQueryable</span><span style="color:#24292E">(userId); </span><span style="color:#D73A49">var</span><span style="color:#6F42C1"> difference</span><span style="color:#D73A49"> =</span><span style="color:#24292E"> allActiveContest.</span><span style="color:#6F42C1">Where</span><span style="color:#24292E">(</span><span style="color:#6F42C1">d</span><span style="color:#D73A49"> =&gt;</span><span style="color:#D73A49"> !</span><span style="color:#24292E">allActiveContestForUser.</span><span style="color:#6F42C1">Contains</span><span style="color:#24292E">(d)); </span><span style="color:#D73A49">return</span><span style="color:#24292E"> difference; } </span></span></code></pre></figure>
<p>Since we are using in the private method IQueryable we are building the query when we are adding statement in public methods. Something important to notice is that we are not using directly the RunningContext.getCurrentTime() method in where clause because Entity Framework does not understand this method. It only understand primitive comparison like comparing a date.</p>
<h1>SPRINT 3 : IMPROVING THE ERROR MANIPULATION WITH AUTOMAPPER April 14, 2014 By: pdesjardins</h1>
<p>This week, we are still in Sprint 3 and few things has been done in the administration page. The page shows all contests. It is the first time we have a page with a grid. It has paging, sorting and multiples others features like filtering. I were using the WebMatrix Html Helper for grid but got some issues like that JQuery must be imported in the header. This is a big no for me. The reason is that it injects JavaScript into the page that execute some JavaScript that is executed without having the whole document ready. This kind of behavior is not fine. JavaScript should not be injected in the document and should not be executed until the whole page is loaded.</p>
<p>This reduced issue with the grid reduced the whole last week development and not yet done. However, some code has been improved in parallel with Auto Mapper. This project must take the error on the model to the ModelState with the name of the view model.</p>
<p>Previously, I posted some code but this code was not working correctly in the some scenarios.</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#fff;color:#24292e" tabindex="0" data-language="csharp" data-theme="github-light"><code data-language="csharp" data-theme="github-light" style="display:grid"><span data-line=""><span style="color:#D73A49"> namespace</span><span style="color:#6F42C1"> MappingUnitTest</span><span style="color:#24292E">.</span><span style="color:#6F42C1">Extensions</span><span style="color:#24292E"> { [</span><span style="color:#6F42C1">TestClass</span><span style="color:#24292E">] </span><span style="color:#D73A49">public</span><span style="color:#D73A49"> class</span><span style="color:#6F42C1"> AutoMapperExtensionsGetMapperPropertyNameMultipleLevelTest</span><span style="color:#24292E"> { [</span><span style="color:#6F42C1">TestInitialize</span><span style="color:#24292E">] </span><span style="color:#D73A49">public</span><span style="color:#D73A49"> void</span><span style="color:#6F42C1"> TestInitialize</span><span style="color:#24292E">() { Mapper.</span><span style="color:#6F42C1">Reset</span><span style="color:#24292E">(); Mapper.</span><span style="color:#6F42C1">CreateMap</span><span style="color:#24292E">&lt;</span><span style="color:#6F42C1">Source</span><span style="color:#24292E">, </span><span style="color:#6F42C1">Target</span><span style="color:#24292E">&gt;() .</span><span style="color:#6F42C1">ForMember</span><span style="color:#24292E">(</span><span style="color:#6F42C1">m</span><span style="color:#D73A49"> =&gt;</span><span style="color:#24292E"> m.TargetSourceSubClassFrancais, </span><span style="color:#6F42C1">a</span><span style="color:#D73A49"> =&gt;</span><span style="color:#24292E"> a.</span><span style="color:#6F42C1">MapFrom</span><span style="color:#24292E">(</span><span style="color:#6F42C1">s</span><span style="color:#D73A49"> =&gt;</span><span style="color:#24292E"> s.SourceSubClass.SubDescription.Francais)) .</span><span style="color:#6F42C1">ForMember</span><span style="color:#24292E">(</span><span style="color:#6F42C1">m</span><span style="color:#D73A49"> =&gt;</span><span style="color:#24292E"> m.TargetSourceSubClassAnglais, </span><span style="color:#6F42C1">a</span><span style="color:#D73A49"> =&gt;</span><span style="color:#24292E"> a.</span><span style="color:#6F42C1">MapFrom</span><span style="color:#24292E">(</span><span style="color:#6F42C1">s</span><span style="color:#D73A49"> =&gt;</span><span style="color:#24292E"> s.SourceSubClass.SubDescription.Anglais)); Mapper.</span><span style="color:#6F42C1">CreateMap</span><span style="color:#24292E">&lt;</span><span style="color:#6F42C1">Source</span><span style="color:#24292E">, </span><span style="color:#6F42C1">TargetWithSub</span><span style="color:#24292E">&gt;() .</span><span style="color:#6F42C1">ForMember</span><span style="color:#24292E">(</span><span style="color:#6F42C1">d</span><span style="color:#D73A49"> =&gt;</span><span style="color:#24292E"> d.Title, </span><span style="color:#6F42C1">a</span><span style="color:#D73A49"> =&gt;</span><span style="color:#24292E"> a.</span><span style="color:#6F42C1">MapFrom</span><span style="color:#24292E">(</span><span style="color:#6F42C1">f</span><span style="color:#D73A49"> =&gt;</span><span style="color:#24292E"> f.Title)) .</span><span style="color:#6F42C1">ForMember</span><span style="color:#24292E">(</span><span style="color:#6F42C1">d</span><span style="color:#D73A49"> =&gt;</span><span style="color:#24292E"> d.Description, </span><span style="color:#6F42C1">a</span><span style="color:#D73A49"> =&gt;</span><span style="color:#24292E"> a.</span><span style="color:#6F42C1">MapFrom</span><span style="color:#24292E">(</span><span style="color:#6F42C1">f</span><span style="color:#D73A49"> =&gt;</span><span style="color:#24292E"> f.Description)); Mapper.</span><span style="color:#6F42C1">CreateMap</span><span style="color:#24292E">&lt;</span><span style="color:#6F42C1">LocalizedString</span><span style="color:#24292E">, </span><span style="color:#6F42C1">LocalizedStringViewModel</span><span style="color:#24292E">&gt;() .</span><span style="color:#6F42C1">ForMember</span><span style="color:#24292E">(</span><span style="color:#6F42C1">d</span><span style="color:#D73A49">=&gt;</span><span style="color:#24292E">d.AnglaisVM, </span><span style="color:#6F42C1">o</span><span style="color:#D73A49">=&gt;</span><span style="color:#24292E">o.</span><span style="color:#6F42C1">MapFrom</span><span style="color:#24292E">(</span><span style="color:#6F42C1">d</span><span style="color:#D73A49">=&gt;</span><span style="color:#24292E">d.Anglais)) .</span><span style="color:#6F42C1">ForMember</span><span style="color:#24292E">(</span><span style="color:#6F42C1">d</span><span style="color:#D73A49">=&gt;</span><span style="color:#24292E">d.FrancaisVM, </span><span style="color:#6F42C1">o</span><span style="color:#D73A49">=&gt;</span><span style="color:#24292E">o.</span><span style="color:#6F42C1">MapFrom</span><span style="color:#24292E">(</span><span style="color:#6F42C1">d</span><span style="color:#D73A49">=&gt;</span><span style="color:#24292E">d.Francais)) ; Mapper.</span><span style="color:#6F42C1">AssertConfigurationIsValid</span><span style="color:#24292E">(); } [</span><span style="color:#6F42C1">TestMethod</span><span style="color:#24292E">] </span><span style="color:#D73A49">public</span><span style="color:#D73A49"> void</span><span style="color:#6F42C1"> GivenAnObjectWithPropertyForMultipleLevel_WhenGettingPropertyName_ThenCorrespondingPropertyNameIsGiven</span><span style="color:#24292E">() { </span><span style="color:#6A737D">//Assert Assert.AreEqual(&quot;DescriptionFrancais&quot;, Mapper.Engine.ConfigurationProvider.GetMappedPropertyName&lt;Source, Target&gt;(&quot;Description.Francais&quot;)); Assert.AreEqual(&quot;DescriptionAnglais&quot;, Mapper.Engine.ConfigurationProvider.GetMappedPropertyName&lt;Source, Target&gt;(&quot;Description.Anglais&quot;)); Assert.AreEqual(&quot;TitleFrancais&quot;, Mapper.Engine.ConfigurationProvider.GetMappedPropertyName&lt;Source, Target&gt;(&quot;Title.Francais&quot;)); Assert.AreEqual(&quot;TitleAnglais&quot;, Mapper.Engine.ConfigurationProvider.GetMappedPropertyName&lt;Source, Target&gt;(&quot;Title.Anglais&quot;)); Assert.AreEqual(&quot;TargetSourceSubClassFrancais&quot;, Mapper.Engine.ConfigurationProvider.GetMappedPropertyName&lt;Source, Target&gt;(&quot;SourceSubClass.SubDescription.Francais&quot;)); Assert.AreEqual(&quot;TargetSourceSubClassAnglais&quot;, Mapper.Engine.ConfigurationProvider.GetMappedPropertyName&lt;Source, Target&gt;(&quot;SourceSubClass.SubDescription.Anglais&quot;)); Assert.AreEqual(&quot;Description.FrancaisVM&quot;, Mapper.Engine.ConfigurationProvider.GetMappedPropertyName&lt;Source, TargetWithSub&gt;(&quot;Description.Francais&quot;)); //CRASH HERE } internal class Source { public LocalizedString Description { get; set; } public LocalizedString Title { get; set; } public SourceSubClass SourceSubClass { get; set; } } internal class SourceSubClass { public LocalizedString SubDescription { get; set; } } internal class LocalizedString { public string Francais { get; set; } public string Anglais { get; set; } } internal class Target { public string DescriptionFrancais { get; set; } public string DescriptionAnglais { get; set; } public string TitleFrancais { get; set; } public string TitleAnglais { get; set; } public string TargetSourceSubClassFrancais { get; set; } public string TargetSourceSubClassAnglais { get; set; } } internal class LocalizedStringViewModel { public string FrancaisVM { get; set; } public string AnglaisVM { get; set; } } internal class TargetWithSub { public LocalizedStringViewModel Description { get; set; } public LocalizedStringViewModel Title { get; set; } } } } </span></span></code></pre></figure>
<p>I noted by the comment “Cash HERE” where the code was not working previously. The problem is that it has a cascade of mapping configured by AutoMapper. This one was not working correctly because we were not looping through all possible sub properties type mapping but only from the first class to be mapped.</p>
<p>The correction is here:</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#fff;color:#24292e" tabindex="0" data-language="csharp" data-theme="github-light"><code data-language="csharp" data-theme="github-light" style="display:grid"><span data-line=""><span style="color:#D73A49"> public</span><span style="color:#D73A49"> static</span><span style="color:#D73A49"> string</span><span style="color:#6F42C1"> GetMappedPropertyName</span><span style="color:#24292E">&lt;</span><span style="color:#6F42C1">TSource</span><span style="color:#24292E">, </span><span style="color:#6F42C1">TDestination</span><span style="color:#24292E">&gt;(</span><span style="color:#D73A49">this</span><span style="color:#6F42C1"> IConfigurationProvider</span><span style="color:#6F42C1"> mapper</span><span style="color:#24292E">, </span><span style="color:#D73A49">string</span><span style="color:#6F42C1"> sourcePropertyName</span><span style="color:#24292E">) { </span><span style="color:#D73A49">if</span><span style="color:#24292E">(sourcePropertyName </span><span style="color:#D73A49">==</span><span style="color:#005CC5"> null</span><span style="color:#24292E">) </span><span style="color:#D73A49">throw</span><span style="color:#D73A49"> new</span><span style="color:#6F42C1"> ArgumentNullException</span><span style="color:#24292E">(</span><span style="color:#032F62">&quot;sourcePropertyName&quot;</span><span style="color:#24292E">); </span><span style="color:#D73A49">return</span><span style="color:#6F42C1"> GetMappedPropertyName</span><span style="color:#24292E">(mapper, </span><span style="color:#D73A49">typeof</span><span style="color:#24292E"> (</span><span style="color:#6F42C1">TSource</span><span style="color:#24292E">), </span><span style="color:#D73A49">typeof</span><span style="color:#24292E"> (</span><span style="color:#6F42C1">TDestination</span><span style="color:#24292E">), </span><span style="color:#D73A49">new</span><span style="color:#6F42C1"> List</span><span style="color:#24292E">&lt;</span><span style="color:#D73A49">string</span><span style="color:#24292E">&gt;{sourcePropertyName}); } </span><span style="color:#D73A49">private</span><span style="color:#D73A49"> static</span><span style="color:#D73A49"> string</span><span style="color:#6F42C1"> GetMappedPropertyName</span><span style="color:#24292E">(</span><span style="color:#6F42C1">IConfigurationProvider</span><span style="color:#6F42C1"> mapper</span><span style="color:#24292E">, </span><span style="color:#6F42C1">Type</span><span style="color:#6F42C1"> sourceType</span><span style="color:#24292E">, </span><span style="color:#6F42C1">Type</span><span style="color:#6F42C1"> destinationType</span><span style="color:#24292E">, </span><span style="color:#6F42C1">List</span><span style="color:#24292E">&lt;</span><span style="color:#D73A49">string</span><span style="color:#24292E">&gt; </span><span style="color:#6F42C1">sourcePropertyNames</span><span style="color:#24292E">) { </span><span style="color:#6A737D">//Analyse the first property name of the list. The list can have only one property if this one is at the end of a complex mapping or if it is a direct property var sourcePropertyName = sourcePropertyNames.First(); //Get all mappings that has the source and destination of the desired type. var typeMap = mapper.GetAllTypeMaps().FirstOrDefault(tm =&gt; tm.SourceType == sourceType &amp;&amp; tm.DestinationType == destinationType); if (typeMap == null) return null; //Loop through all mappings for the source-destination members to find the destination value. var propertyMaps = typeMap.GetPropertyMaps().Where(pm =&gt; !pm.IsIgnored() &amp;&amp; pm.SourceMember != null); foreach (var propertyMap in propertyMaps) { var sourceValueResolverPath = string.Empty; if (propertyMap.CustomExpression != null)//If it is a custom expression, then get directly the property text. { sourceValueResolverPath = LambdaHelper.GetPropertyText(propertyMap.CustomExpression); } else { var valueResolvers = propertyMap.GetSourceValueResolvers(); sourceValueResolverPath = valueResolvers.OfType&lt;IMemberGetter&gt;() .Aggregate(sourceValueResolverPath, (current, memberGetter) =&gt; current + (memberGetter.Name + PROPERTY_DELIMITER)) .RemoveLastChar(); } //Check if we have a source that match the source property if (sourceValueResolverPath == sourcePropertyName) { //If we have move than one property in the source, then we must loop and analyze sub property if (sourcePropertyNames.Count &gt; 1) { sourcePropertyNames.RemoveAt(0); //Recursive call without the first element because we will concatenate the destination result of the first since we have a source match return string.Concat(propertyMap.DestinationProperty.Name, PROPERTY_DELIMITER, GetMappedPropertyName(mapper, ((PropertyInfo)(propertyMap.SourceMember)).PropertyType, propertyMap.DestinationProperty.MemberType, sourcePropertyNames)); } //They are no properties and the source matched the resolving path. We return the destination return propertyMap.DestinationProperty.Name; } } //If we are this far it is because we have not found the source property. But, we can split the name by dot and check for individual property mapping var splitProperties = sourcePropertyName.Split(PROPERTY_DELIMITER); if (splitProperties.Length &gt; 1) { return GetMappedPropertyName(mapper, sourceType, destinationType, splitProperties.ToList()); } return null; } </span></span></code></pre></figure>
<p>As you can see, if nothing is found, we split the string by the delimiter (dot) and we call again the property method. It uses recursive call to work on the property.</p>
<h1>SPRINT 3: SETUP USER ROLE April 28, 2014 By: pdesjardins</h1>
<p>The last week of sprint 3 was consecrated to user role. The application has a default role that is named “normal user”. This is the default role. Even if everybody are in this role, we have this one defined. The reason is that I want to be able to differ a user that is registered to play contest from those who are not. For example, we will be able to assign to some controller’s action the role of normal user. It gives us some latitude about this role too. We may want to assign the role only when the user has validated its account. This would be interesting to limit the access without blocking the whole website to someone that has not activate its account.</p>
<p>We are still using the Microsoft Identity Framework for authentification and for roles. This mean that our roles are located in AspNetRoles. The association between users and roles are inside the table AspNetUserRoles.</p>
<p><img src="/images/blog/AspNetRoleUserTables.png" alt=""/></p>
<p>As you can see, the association table AspNetRoleUserTables contains both primary key to link AspNetUsers and AspNetRoles. This give us the possibility to have multiples roles for a single user.</p>
<p>Inside the code, I have created a model class that has all roles hardcoded. The reason is that I want to use these constant inside security attribute.</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#fff;color:#24292e" tabindex="0" data-language="csharp" data-theme="github-light"><code data-language="csharp" data-theme="github-light" style="display:grid"><span data-line=""><span style="color:#D73A49"> namespace</span><span style="color:#6F42C1"> Model</span><span style="color:#24292E">.</span><span style="color:#6F42C1">Entities</span><span style="color:#24292E">.</span><span style="color:#6F42C1">Users</span><span style="color:#24292E"> { </span><span style="color:#D73A49">public</span><span style="color:#D73A49"> class</span><span style="color:#6F42C1"> ApplicatioRole</span><span style="color:#24292E"> : </span><span style="color:#6F42C1">IdentityRole</span><span style="color:#24292E"> { </span><span style="color:#D73A49">public</span><span style="color:#D73A49"> const</span><span style="color:#D73A49"> string</span><span style="color:#6F42C1"> ADMINISTRATOR</span><span style="color:#D73A49"> =</span><span style="color:#032F62"> &quot;Administrator&quot;</span><span style="color:#24292E">; </span><span style="color:#D73A49">public</span><span style="color:#D73A49"> const</span><span style="color:#D73A49"> string</span><span style="color:#6F42C1"> MODERATOR</span><span style="color:#D73A49"> =</span><span style="color:#032F62"> &quot;Moderator&quot;</span><span style="color:#24292E">; </span><span style="color:#D73A49">public</span><span style="color:#D73A49"> const</span><span style="color:#D73A49"> string</span><span style="color:#6F42C1"> NORMAL_USER</span><span style="color:#D73A49"> =</span><span style="color:#032F62"> &quot;NormalUser&quot;</span><span style="color:#24292E">; </span><span style="color:#D73A49">public</span><span style="color:#D73A49"> const</span><span style="color:#D73A49"> string</span><span style="color:#6F42C1"> ADMINISTRATOR_MODERATOR</span><span style="color:#D73A49"> =</span><span style="color:#24292E"> ADMINISTRATOR </span><span style="color:#D73A49">+</span><span style="color:#032F62"> &quot;,&quot;</span><span style="color:#D73A49"> +</span><span style="color:#24292E"> MODERATOR; } } </span></span></code></pre></figure>
<p>I have also concatenate two constants that will be used in several screens. This is the case for screen shared by administrator and moderator. Since a user can have multiple roles, I do not do combination of normal user and administrator because an administrator should be a normal user and a normal user too.</p>
<p>Another steps during this week was to allow Entity Framework migration tool to seeds. Five account is required for some tests. One as a “system” user that will be used for system task. One for “test” for unit test. And three others user for the three possibles roles.</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#fff;color:#24292e" tabindex="0" data-language="csharp" data-theme="github-light"><code data-language="csharp" data-theme="github-light" style="display:grid"><span data-line=""><span style="color:#D73A49"> internal</span><span style="color:#D73A49"> sealed</span><span style="color:#D73A49"> class</span><span style="color:#6F42C1"> Configuration</span><span style="color:#24292E"> : </span><span style="color:#6F42C1">DbMigrationsConfiguration</span><span style="color:#24292E">&lt;</span><span style="color:#6F42C1">MainDbContext</span><span style="color:#24292E">&gt; { </span><span style="color:#D73A49">private</span><span style="color:#D73A49"> readonly</span><span style="color:#6F42C1"> IRunningContext</span><span style="color:#6F42C1"> runningContext</span><span style="color:#24292E">; </span><span style="color:#D73A49">const</span><span style="color:#D73A49"> string</span><span style="color:#6F42C1"> EMAIL_ADMIN</span><span style="color:#D73A49"> =</span><span style="color:#032F62"> &quot;123@123.com&quot;</span><span style="color:#24292E">; </span><span style="color:#D73A49">const</span><span style="color:#D73A49"> string</span><span style="color:#6F42C1"> EMAIL_NORMAL_USER</span><span style="color:#D73A49"> =</span><span style="color:#032F62"> &quot;qwe@qwe.com&quot;</span><span style="color:#24292E">; </span><span style="color:#D73A49">const</span><span style="color:#D73A49"> string</span><span style="color:#6F42C1"> EMAIL_MOD</span><span style="color:#D73A49"> =</span><span style="color:#032F62"> &quot;asd@asd.com&quot;</span><span style="color:#24292E">; </span><span style="color:#D73A49">const</span><span style="color:#D73A49"> string</span><span style="color:#6F42C1"> EMAIL_SYSTEM</span><span style="color:#D73A49"> =</span><span style="color:#032F62"> &quot;system@system.com&quot;</span><span style="color:#24292E">; </span><span style="color:#D73A49">const</span><span style="color:#D73A49"> string</span><span style="color:#6F42C1"> EMAIL_TEST</span><span style="color:#D73A49"> =</span><span style="color:#032F62"> &quot;test@test.com&quot;</span><span style="color:#24292E">; </span><span style="color:#6A737D">//... </span></span></code></pre></figure>
<p>This is why in the DataAccessMigration Configuration class, we setup five constants with for theses account. This allow us later to search these user by email.</p>
<p>The seeding method has four sub methods.</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#fff;color:#24292e" tabindex="0" data-language="csharp" data-theme="github-light"><code data-language="csharp" data-theme="github-light" style="display:grid"><span data-line=""><span style="color:#D73A49"> protected</span><span style="color:#D73A49"> override</span><span style="color:#D73A49"> void</span><span style="color:#6F42C1"> Seed</span><span style="color:#24292E">(</span><span style="color:#6F42C1">MainDbContext</span><span style="color:#6F42C1"> context</span><span style="color:#24292E">) { </span><span style="color:#6F42C1">SeedValuesObjects</span><span style="color:#24292E">(context); </span><span style="color:#6F42C1">SeedValuesForSystemUsers</span><span style="color:#24292E">(context); </span><span style="color:#6F42C1">SeedValuesForRole</span><span style="color:#24292E">(context); </span><span style="color:#6F42C1">SeedDemoValues</span><span style="color:#24292E">(context); } </span></span></code></pre></figure>
<p>The first one seed value for Value Object. The second one is for system user. These are the one that should be constant because they are used by the system. The last two methods are for roles and a seed to fill up the system with values. This is interesting to be able to test the system directly by the website without having to fill up manually data every time.</p>
<p>Roles are added into the system by using RoleManager.</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#fff;color:#24292e" tabindex="0" data-language="csharp" data-theme="github-light"><code data-language="csharp" data-theme="github-light" style="display:grid"><span data-line=""><span style="color:#D73A49"> private</span><span style="color:#D73A49"> void</span><span style="color:#6F42C1"> SeedValuesForRole</span><span style="color:#24292E">(</span><span style="color:#6F42C1">MainDbContext</span><span style="color:#6F42C1"> context</span><span style="color:#24292E">) { </span><span style="color:#D73A49">var</span><span style="color:#6F42C1"> roleManager</span><span style="color:#D73A49"> =</span><span style="color:#D73A49"> new</span><span style="color:#6F42C1"> RoleManager</span><span style="color:#24292E">&lt;</span><span style="color:#6F42C1">IdentityRole</span><span style="color:#24292E">&gt;(</span><span style="color:#D73A49">new</span><span style="color:#6F42C1"> RoleStore</span><span style="color:#24292E">&lt;</span><span style="color:#6F42C1">IdentityRole</span><span style="color:#24292E">&gt;(context)); </span><span style="color:#D73A49">var</span><span style="color:#6F42C1"> roleAdmin</span><span style="color:#D73A49"> =</span><span style="color:#D73A49"> new</span><span style="color:#6F42C1"> IdentityRole</span><span style="color:#24292E">(ApplicatioRole.ADMINISTRATOR); </span><span style="color:#D73A49">var</span><span style="color:#6F42C1"> roleUser</span><span style="color:#D73A49"> =</span><span style="color:#D73A49"> new</span><span style="color:#6F42C1"> IdentityRole</span><span style="color:#24292E">(ApplicatioRole.NORMAL_USER); </span><span style="color:#D73A49">var</span><span style="color:#6F42C1"> roleModerator</span><span style="color:#D73A49"> =</span><span style="color:#D73A49"> new</span><span style="color:#6F42C1"> IdentityRole</span><span style="color:#24292E">(ApplicatioRole.MODERATOR); roleManager.</span><span style="color:#6F42C1">Create</span><span style="color:#24292E">(roleAdmin); roleManager.</span><span style="color:#6F42C1">Create</span><span style="color:#24292E">(roleUser); roleManager.</span><span style="color:#6F42C1">Create</span><span style="color:#24292E">(roleModerator); context.</span><span style="color:#6F42C1">SaveChanges</span><span style="color:#24292E">(); } </span></span>
<span data-line=""><span style="color:#24292E">``` On the </span><span style="color:#6F42C1">other</span><span style="color:#6F42C1"> side</span><span style="color:#24292E">, </span><span style="color:#6F42C1">demo</span><span style="color:#6F42C1"> values</span><span style="color:#6F42C1"> are</span><span style="color:#6F42C1"> divided</span><span style="color:#6F42C1"> in</span><span style="color:#6F42C1"> three</span><span style="color:#6F42C1"> sub</span><span style="color:#6F42C1"> methods</span><span style="color:#6F42C1"> that</span><span style="color:#6F42C1"> all</span><span style="color:#6F42C1"> uses</span><span style="color:#6F42C1"> directly</span><span style="color:#6F42C1"> Entity</span><span style="color:#6F42C1"> Framework</span><span style="color:#6F42C1"> to</span><span style="color:#6F42C1"> insert</span><span style="color:#6F42C1"> Contests</span><span style="color:#24292E">, </span><span style="color:#6F42C1">User</span><span style="color:#6F42C1"> and</span><span style="color:#6F42C1"> User</span><span style="color:#6F42C1"> Role</span><span style="color:#24292E">.</span></span>
<span data-line=""> </span>
<span data-line=""> </span>
<span data-line=""><span style="color:#24292E">```</span><span style="color:#6F42C1">csharp</span></span>
<span data-line=""><span style="color:#6F42C1"> private</span><span style="color:#6F42C1"> void</span><span style="color:#6F42C1"> SeedDemoValues</span><span style="color:#24292E">(</span><span style="color:#6F42C1">MainDbContext</span><span style="color:#6F42C1"> context</span><span style="color:#24292E">) { </span><span style="color:#6F42C1">SeedDemoContests</span><span style="color:#24292E">(context); </span><span style="color:#6F42C1">SeedDemoUser</span><span style="color:#24292E">(context); </span><span style="color:#6F42C1">SeedDemoUsersRoles</span><span style="color:#24292E">(context); } </span></span></code></pre></figure>
<p>Demo value for user are using Entity Framework:</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#fff;color:#24292e" tabindex="0" data-language="csharp" data-theme="github-light"><code data-language="csharp" data-theme="github-light" style="display:grid"><span data-line=""><span style="color:#D73A49"> private</span><span style="color:#D73A49"> void</span><span style="color:#6F42C1"> SeedDemoUser</span><span style="color:#24292E">(</span><span style="color:#6F42C1">MainDbContext</span><span style="color:#6F42C1"> context</span><span style="color:#24292E">) { </span><span style="color:#D73A49">var</span><span style="color:#6F42C1"> userValueGenerator</span><span style="color:#D73A49"> =</span><span style="color:#D73A49"> new</span><span style="color:#6F42C1"> UserValuesGenerator</span><span style="color:#24292E">(); </span><span style="color:#D73A49">var</span><span style="color:#6F42C1"> adminUser</span><span style="color:#D73A49"> =</span><span style="color:#D73A49"> new</span><span style="color:#6F42C1"> ApplicationUser</span><span style="color:#24292E"> { Id </span><span style="color:#D73A49">=</span><span style="color:#24292E"> Guid.</span><span style="color:#6F42C1">NewGuid</span><span style="color:#24292E">().</span><span style="color:#6F42C1">ToString</span><span style="color:#24292E">() , FirstName </span><span style="color:#D73A49">=</span><span style="color:#032F62"> &quot;Patrick&quot;</span><span style="color:#24292E"> , LastName </span><span style="color:#D73A49">=</span><span style="color:#032F62"> &quot;Desjardins&quot;</span><span style="color:#24292E"> , DisplayName </span><span style="color:#D73A49">=</span><span style="color:#032F62"> &quot;pdesjardins&quot;</span><span style="color:#24292E"> , Email </span><span style="color:#D73A49">=</span><span style="color:#24292E"> EMAIL_ADMIN , CreationDateTime </span><span style="color:#D73A49">=</span><span style="color:#24292E"> runningContext.</span><span style="color:#6F42C1">GetCurrentTime</span><span style="color:#24292E">() , UserName </span><span style="color:#D73A49">=</span><span style="color:#24292E"> userValueGenerator.</span><span style="color:#6F42C1">GenerateUserName</span><span style="color:#24292E">(EMAIL_ADMIN), PasswordHash </span><span style="color:#D73A49">=</span><span style="color:#24292E"> ApplicationUser.</span><span style="color:#6F42C1">HashPassword</span><span style="color:#24292E">(</span><span style="color:#032F62">&quot;123123&quot;</span><span style="color:#24292E">) , ValidationDateTime </span><span style="color:#D73A49">=</span><span style="color:#24292E"> runningContext.</span><span style="color:#6F42C1">GetCurrentTime</span><span style="color:#24292E">() }; </span><span style="color:#D73A49">var</span><span style="color:#6F42C1"> modUser</span><span style="color:#D73A49"> =</span><span style="color:#D73A49"> new</span><span style="color:#6F42C1"> ApplicationUser</span><span style="color:#24292E"> { Id </span><span style="color:#D73A49">=</span><span style="color:#24292E"> Guid.</span><span style="color:#6F42C1">NewGuid</span><span style="color:#24292E">().</span><span style="color:#6F42C1">ToString</span><span style="color:#24292E">() ,FirstName </span><span style="color:#D73A49">=</span><span style="color:#032F62"> &quot;Jim&quot;</span><span style="color:#24292E"> ,LastName </span><span style="color:#D73A49">=</span><span style="color:#032F62"> &quot;Doe&quot;</span><span style="color:#24292E"> ,DisplayName </span><span style="color:#D73A49">=</span><span style="color:#032F62"> &quot;jdoe&quot;</span><span style="color:#24292E"> ,Email </span><span style="color:#D73A49">=</span><span style="color:#24292E"> EMAIL_MOD ,CreationDateTime </span><span style="color:#D73A49">=</span><span style="color:#24292E"> runningContext.</span><span style="color:#6F42C1">GetCurrentTime</span><span style="color:#24292E">() ,UserName </span><span style="color:#D73A49">=</span><span style="color:#24292E"> userValueGenerator.</span><span style="color:#6F42C1">GenerateUserName</span><span style="color:#24292E">(EMAIL_MOD) ,PasswordHash </span><span style="color:#D73A49">=</span><span style="color:#24292E"> ApplicationUser.</span><span style="color:#6F42C1">HashPassword</span><span style="color:#24292E">(</span><span style="color:#032F62">&quot;asdasd&quot;</span><span style="color:#24292E">) ,ValidationDateTime </span><span style="color:#D73A49">=</span><span style="color:#24292E"> runningContext.</span><span style="color:#6F42C1">GetCurrentTime</span><span style="color:#24292E">() }; </span><span style="color:#D73A49">var</span><span style="color:#6F42C1"> normalUser</span><span style="color:#D73A49"> =</span><span style="color:#D73A49"> new</span><span style="color:#6F42C1"> ApplicationUser</span><span style="color:#24292E"> { Id </span><span style="color:#D73A49">=</span><span style="color:#24292E"> Guid.</span><span style="color:#6F42C1">NewGuid</span><span style="color:#24292E">().</span><span style="color:#6F42C1">ToString</span><span style="color:#24292E">() , FirstName </span><span style="color:#D73A49">=</span><span style="color:#032F62"> &quot;Melodie&quot;</span><span style="color:#24292E"> , LastName </span><span style="color:#D73A49">=</span><span style="color:#032F62"> &quot;Savaria&quot;</span><span style="color:#24292E"> , DisplayName </span><span style="color:#D73A49">=</span><span style="color:#032F62"> &quot;msavaria&quot;</span><span style="color:#24292E"> , Email </span><span style="color:#D73A49">=</span><span style="color:#24292E"> EMAIL_NORMAL_USER , CreationDateTime </span><span style="color:#D73A49">=</span><span style="color:#24292E"> runningContext.</span><span style="color:#6F42C1">GetCurrentTime</span><span style="color:#24292E">() , UserName </span><span style="color:#D73A49">=</span><span style="color:#24292E"> userValueGenerator.</span><span style="color:#6F42C1">GenerateUserName</span><span style="color:#24292E">(EMAIL_NORMAL_USER), PasswordHash </span><span style="color:#D73A49">=</span><span style="color:#24292E"> ApplicationUser.</span><span style="color:#6F42C1">HashPassword</span><span style="color:#24292E">(</span><span style="color:#032F62">&quot;qweqwe&quot;</span><span style="color:#24292E">) , ValidationDateTime </span><span style="color:#D73A49">=</span><span style="color:#24292E"> runningContext.</span><span style="color:#6F42C1">GetCurrentTime</span><span style="color:#24292E">() }; context.</span><span style="color:#6F42C1">Set</span><span style="color:#24292E">&lt;</span><span style="color:#6F42C1">ApplicationUser</span><span style="color:#24292E">&gt;().</span><span style="color:#6F42C1">AddOrUpdate</span><span style="color:#24292E">(adminUser); context.</span><span style="color:#6F42C1">Set</span><span style="color:#24292E">&lt;</span><span style="color:#6F42C1">ApplicationUser</span><span style="color:#24292E">&gt;().</span><span style="color:#6F42C1">AddOrUpdate</span><span style="color:#24292E">(normalUser); context.</span><span style="color:#6F42C1">Set</span><span style="color:#24292E">&lt;</span><span style="color:#6F42C1">ApplicationUser</span><span style="color:#24292E">&gt;().</span><span style="color:#6F42C1">AddOrUpdate</span><span style="color:#24292E">(modUser); context.</span><span style="color:#6F42C1">SaveChanges</span><span style="color:#24292E">(); } </span></span></code></pre></figure>
<p>Finally, for roles, we need to associate them users. To have the good ID, we need to get from the email the entity and assign it to a new IdentityUserRole.</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#fff;color:#24292e" tabindex="0" data-language="csharp" data-theme="github-light"><code data-language="csharp" data-theme="github-light" style="display:grid"><span data-line=""><span style="color:#D73A49"> private</span><span style="color:#D73A49"> void</span><span style="color:#6F42C1"> SeedDemoUsersRoles</span><span style="color:#24292E">(</span><span style="color:#6F42C1">MainDbContext</span><span style="color:#6F42C1"> context</span><span style="color:#24292E">) { </span><span style="color:#D73A49">var</span><span style="color:#6F42C1"> administratorRole</span><span style="color:#D73A49"> =</span><span style="color:#24292E"> context.</span><span style="color:#6F42C1">GetDbContext</span><span style="color:#24292E">().</span><span style="color:#6F42C1">Set</span><span style="color:#24292E">&lt;</span><span style="color:#6F42C1">IdentityRole</span><span style="color:#24292E">&gt;().</span><span style="color:#6F42C1">Single</span><span style="color:#24292E">(</span><span style="color:#6F42C1">d</span><span style="color:#D73A49"> =&gt;</span><span style="color:#24292E"> d.Name </span><span style="color:#D73A49">==</span><span style="color:#24292E"> ApplicatioRole.ADMINISTRATOR); </span><span style="color:#D73A49">var</span><span style="color:#6F42C1"> normalRole</span><span style="color:#D73A49"> =</span><span style="color:#24292E"> context.</span><span style="color:#6F42C1">GetDbContext</span><span style="color:#24292E">().</span><span style="color:#6F42C1">Set</span><span style="color:#24292E">&lt;</span><span style="color:#6F42C1">IdentityRole</span><span style="color:#24292E">&gt;().</span><span style="color:#6F42C1">Single</span><span style="color:#24292E">(</span><span style="color:#6F42C1">d</span><span style="color:#D73A49"> =&gt;</span><span style="color:#24292E"> d.Name </span><span style="color:#D73A49">==</span><span style="color:#24292E"> ApplicatioRole.NORMAL_USER); </span><span style="color:#D73A49">var</span><span style="color:#6F42C1"> moderatorRole</span><span style="color:#D73A49"> =</span><span style="color:#24292E"> context.</span><span style="color:#6F42C1">GetDbContext</span><span style="color:#24292E">().</span><span style="color:#6F42C1">Set</span><span style="color:#24292E">&lt;</span><span style="color:#6F42C1">IdentityRole</span><span style="color:#24292E">&gt;().</span><span style="color:#6F42C1">Single</span><span style="color:#24292E">(</span><span style="color:#6F42C1">d</span><span style="color:#D73A49"> =&gt;</span><span style="color:#24292E"> d.Name </span><span style="color:#D73A49">==</span><span style="color:#24292E"> ApplicatioRole.MODERATOR); </span><span style="color:#D73A49">var</span><span style="color:#6F42C1"> administratorUser</span><span style="color:#D73A49"> =</span><span style="color:#24292E"> context.</span><span style="color:#6F42C1">GetDbContext</span><span style="color:#24292E">().</span><span style="color:#6F42C1">Set</span><span style="color:#24292E">&lt;</span><span style="color:#6F42C1">ApplicationUser</span><span style="color:#24292E">&gt;().</span><span style="color:#6F42C1">Single</span><span style="color:#24292E">(</span><span style="color:#6F42C1">d</span><span style="color:#D73A49"> =&gt;</span><span style="color:#24292E"> d.Email </span><span style="color:#D73A49">==</span><span style="color:#24292E"> EMAIL_ADMIN); </span><span style="color:#D73A49">var</span><span style="color:#6F42C1"> normalUser</span><span style="color:#D73A49"> =</span><span style="color:#24292E"> context.</span><span style="color:#6F42C1">GetDbContext</span><span style="color:#24292E">().</span><span style="color:#6F42C1">Set</span><span style="color:#24292E">&lt;</span><span style="color:#6F42C1">ApplicationUser</span><span style="color:#24292E">&gt;().</span><span style="color:#6F42C1">Single</span><span style="color:#24292E">(</span><span style="color:#6F42C1">d</span><span style="color:#D73A49"> =&gt;</span><span style="color:#24292E"> d.Email </span><span style="color:#D73A49">==</span><span style="color:#24292E"> EMAIL_NORMAL_USER); </span><span style="color:#D73A49">var</span><span style="color:#6F42C1"> modUser</span><span style="color:#D73A49"> =</span><span style="color:#24292E"> context.</span><span style="color:#6F42C1">GetDbContext</span><span style="color:#24292E">().</span><span style="color:#6F42C1">Set</span><span style="color:#24292E">&lt;</span><span style="color:#6F42C1">ApplicationUser</span><span style="color:#24292E">&gt;().</span><span style="color:#6F42C1">Single</span><span style="color:#24292E">(</span><span style="color:#6F42C1">d</span><span style="color:#D73A49"> =&gt;</span><span style="color:#24292E"> d.Email </span><span style="color:#D73A49">==</span><span style="color:#24292E"> EMAIL_MOD); </span><span style="color:#D73A49">var</span><span style="color:#6F42C1"> userRole1</span><span style="color:#D73A49"> =</span><span style="color:#D73A49"> new</span><span style="color:#6F42C1"> IdentityUserRole</span><span style="color:#24292E"> { UserId </span><span style="color:#D73A49">=</span><span style="color:#24292E"> administratorUser.Id, RoleId </span><span style="color:#D73A49">=</span><span style="color:#24292E"> administratorRole.Id }; </span><span style="color:#D73A49">var</span><span style="color:#6F42C1"> userRole11</span><span style="color:#D73A49"> =</span><span style="color:#D73A49"> new</span><span style="color:#6F42C1"> IdentityUserRole</span><span style="color:#24292E"> { UserId </span><span style="color:#D73A49">=</span><span style="color:#24292E"> normalUser.Id, RoleId </span><span style="color:#D73A49">=</span><span style="color:#24292E"> administratorRole.Id }; </span><span style="color:#D73A49">var</span><span style="color:#6F42C1"> userRole2</span><span style="color:#D73A49"> =</span><span style="color:#D73A49"> new</span><span style="color:#6F42C1"> IdentityUserRole</span><span style="color:#24292E"> { UserId </span><span style="color:#D73A49">=</span><span style="color:#24292E"> normalUser.Id, RoleId </span><span style="color:#D73A49">=</span><span style="color:#24292E"> moderatorRole.Id }; </span><span style="color:#D73A49">var</span><span style="color:#6F42C1"> userRole3</span><span style="color:#D73A49"> =</span><span style="color:#D73A49"> new</span><span style="color:#6F42C1"> IdentityUserRole</span><span style="color:#24292E"> { UserId </span><span style="color:#D73A49">=</span><span style="color:#24292E"> modUser.Id, RoleId </span><span style="color:#D73A49">=</span><span style="color:#24292E"> normalRole.Id }; context.</span><span style="color:#6F42C1">Set</span><span style="color:#24292E">&lt;</span><span style="color:#6F42C1">IdentityUserRole</span><span style="color:#24292E">&gt;().</span><span style="color:#6F42C1">AddOrUpdate</span><span style="color:#24292E">(userRole1); context.</span><span style="color:#6F42C1">Set</span><span style="color:#24292E">&lt;</span><span style="color:#6F42C1">IdentityUserRole</span><span style="color:#24292E">&gt;().</span><span style="color:#6F42C1">AddOrUpdate</span><span style="color:#24292E">(userRole11); context.</span><span style="color:#6F42C1">Set</span><span style="color:#24292E">&lt;</span><span style="color:#6F42C1">IdentityUserRole</span><span style="color:#24292E">&gt;().</span><span style="color:#6F42C1">AddOrUpdate</span><span style="color:#24292E">(userRole2); context.</span><span style="color:#6F42C1">Set</span><span style="color:#24292E">&lt;</span><span style="color:#6F42C1">IdentityUserRole</span><span style="color:#24292E">&gt;().</span><span style="color:#6F42C1">AddOrUpdate</span><span style="color:#24292E">(userRole3); context.</span><span style="color:#6F42C1">SaveChanges</span><span style="color:#24292E">(); } </span></span></code></pre></figure>
<p>The database is now having everything related.</p>
<p><img src="/images/blog/DataValuesUserRoles.png" alt=""/></p>
<p>Contests are also inserted by Entity Framework but use the ModelBuilder to get a batch of contest.</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#fff;color:#24292e" tabindex="0" data-language="csharp" data-theme="github-light"><code data-language="csharp" data-theme="github-light" style="display:grid"><span data-line=""><span style="color:#D73A49"> private</span><span style="color:#D73A49"> void</span><span style="color:#6F42C1"> SeedDemoContests</span><span style="color:#24292E">(</span><span style="color:#6F42C1">MainDbContext</span><span style="color:#6F42C1"> context</span><span style="color:#24292E">) { </span><span style="color:#D73A49">var</span><span style="color:#6F42C1"> unitOfWork</span><span style="color:#D73A49"> =</span><span style="color:#D73A49"> new</span><span style="color:#6F42C1"> UnitOfWork</span><span style="color:#24292E">(</span><span style="color:#D73A49">new</span><span style="color:#6F42C1"> MainDbContext</span><span style="color:#24292E">(</span><span style="color:#005CC5">this</span><span style="color:#24292E">.runningContext)); </span><span style="color:#D73A49">var</span><span style="color:#6F42C1"> contestRepository</span><span style="color:#D73A49"> =</span><span style="color:#D73A49"> new</span><span style="color:#6F42C1"> ContestRepository</span><span style="color:#24292E">(unitOfWork, </span><span style="color:#005CC5">this</span><span style="color:#24292E">.runningContext); </span><span style="color:#D73A49">var</span><span style="color:#6F42C1"> contestModelBuilder</span><span style="color:#D73A49"> =</span><span style="color:#D73A49"> new</span><span style="color:#6F42C1"> ModelBuilders</span><span style="color:#24292E">.</span><span style="color:#6F42C1">Contest</span><span style="color:#24292E">.</span><span style="color:#6F42C1">ContestModelBuilder</span><span style="color:#24292E">(</span><span style="color:#005CC5">this</span><span style="color:#24292E">.runningContext); </span><span style="color:#D73A49">var</span><span style="color:#6F42C1"> contests</span><span style="color:#D73A49"> =</span><span style="color:#24292E"> contestModelBuilder.</span><span style="color:#6F42C1">GetBatchActiveContest</span><span style="color:#24292E">(</span><span style="color:#005CC5">20</span><span style="color:#24292E">); contestRepository.</span><span style="color:#6F42C1">DeleteAll</span><span style="color:#24292E">&lt;</span><span style="color:#6F42C1">Contest</span><span style="color:#24292E">&gt;(Constants.SchemaNames.Contest); </span><span style="color:#D73A49">foreach</span><span style="color:#24292E"> (</span><span style="color:#D73A49">var</span><span style="color:#6F42C1"> contest</span><span style="color:#D73A49"> in</span><span style="color:#24292E"> contests) { contestRepository.</span><span style="color:#6F42C1">Save</span><span style="color:#24292E">(contest); } unitOfWork.</span><span style="color:#6F42C1">Commit</span><span style="color:#24292E">(); } </span></span></code></pre></figure>
<p>This is interesting because we are using this builder for some unit tests too. We reuse code!</p>
<h1>SPRINT 3 : GETTING VIEW THAT CHANGE DEPENDING OF USER ROLE May 5, 2014 By: pdesjardins</h1>
<p>The menu of the website display moderation links and administration links only to user with these respective roles. Validation on the server is also done but this article aims particularly how to handle role for specific portion of the view.</p>
<p>First of all, you could use like most tutorial and use the User.IsInRole(“YourRoleHere”). The problem is that your role will be defined in the model. In the application we are building, roles are in ApplicationRole.</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#fff;color:#24292e" tabindex="0" data-language="csharp" data-theme="github-light"><code data-language="csharp" data-theme="github-light" style="display:grid"><span data-line=""><span style="color:#D73A49"> public</span><span style="color:#D73A49"> class</span><span style="color:#6F42C1"> ApplicationRole</span><span style="color:#24292E"> : </span><span style="color:#6F42C1">IdentityRole</span><span style="color:#24292E"> { </span><span style="color:#D73A49">public</span><span style="color:#D73A49"> const</span><span style="color:#D73A49"> string</span><span style="color:#6F42C1"> ADMINISTRATOR</span><span style="color:#D73A49"> =</span><span style="color:#032F62"> &quot;Administrator&quot;</span><span style="color:#24292E">; </span><span style="color:#D73A49">public</span><span style="color:#D73A49"> const</span><span style="color:#D73A49"> string</span><span style="color:#6F42C1"> MODERATOR</span><span style="color:#D73A49"> =</span><span style="color:#032F62"> &quot;Moderator&quot;</span><span style="color:#24292E">; </span><span style="color:#D73A49">public</span><span style="color:#D73A49"> const</span><span style="color:#D73A49"> string</span><span style="color:#6F42C1"> NORMAL_USER</span><span style="color:#D73A49"> =</span><span style="color:#032F62"> &quot;NormalUser&quot;</span><span style="color:#24292E">; </span><span style="color:#D73A49">public</span><span style="color:#D73A49"> const</span><span style="color:#D73A49"> string</span><span style="color:#6F42C1"> ADMINISTRATOR_MODERATOR</span><span style="color:#D73A49"> =</span><span style="color:#24292E"> ADMINISTRATOR </span><span style="color:#D73A49">+</span><span style="color:#032F62"> &quot;,&quot;</span><span style="color:#D73A49"> +</span><span style="color:#24292E"> MODERATOR; } </span></span></code></pre></figure>
<p>This is used later in every actions.</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#fff;color:#24292e" tabindex="0" data-language="csharp" data-theme="github-light"><code data-language="csharp" data-theme="github-light" style="display:grid"><span data-line=""><span style="color:#24292E"> [</span><span style="color:#6F42C1">HttpGet</span><span style="color:#24292E">] [</span><span style="color:#6F42C1">Authorize</span><span style="color:#24292E">(</span><span style="color:#6F42C1">Roles</span><span style="color:#D73A49"> =</span><span style="color:#24292E"> ApplicationRole.ADMINISTRATOR_MODERATOR)] </span><span style="color:#D73A49">public</span><span style="color:#6F42C1"> ActionResult</span><span style="color:#6F42C1"> Edit</span><span style="color:#24292E">(</span><span style="color:#D73A49">int</span><span style="color:#6F42C1"> id</span><span style="color:#24292E">) { </span><span style="color:#6A737D">//... } </span></span></code></pre></figure>
<p>But the model is not accessible by the view. The view use the View Model classes. And, in fact, the View should not do any conditional clauses by executing any method to validate if a user is in a role or not. This is a back-end operation. The front end should only use something that say if it is in the role or not. This is why the best way to proceed is to have property method that indicate with a boolean if the user can display something or not.</p>
<p>The first class to create is an interface that has all visual constraints. For the sake of simplicity, we will do two properties. One for Administration and one for Moderation. It could be better to have IsMenuDisplay or IsYourActionDisplay and to hide the role. Nevertheless, the point is to remove from the view everything related to User.IsInRole().</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#fff;color:#24292e" tabindex="0" data-language="csharp" data-theme="github-light"><code data-language="csharp" data-theme="github-light" style="display:grid"><span data-line=""><span style="color:#D73A49"> public</span><span style="color:#D73A49"> interface</span><span style="color:#6F42C1"> IUIPermission</span><span style="color:#24292E"> { </span><span style="color:#D73A49">bool</span><span style="color:#6F42C1"> IsAdministrator</span><span style="color:#24292E"> { </span><span style="color:#D73A49">get</span><span style="color:#24292E">; </span><span style="color:#D73A49">set</span><span style="color:#24292E">; } </span><span style="color:#D73A49">bool</span><span style="color:#6F42C1"> IsModerator</span><span style="color:#24292E"> { </span><span style="color:#D73A49">get</span><span style="color:#24292E">; </span><span style="color:#D73A49">set</span><span style="color:#24292E">; } } </span></span></code></pre></figure>
<p>I have also created a new concrete class that implement the interface.</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#fff;color:#24292e" tabindex="0" data-language="csharp" data-theme="github-light"><code data-language="csharp" data-theme="github-light" style="display:grid"><span data-line=""><span style="color:#D73A49"> public</span><span style="color:#D73A49"> class</span><span style="color:#6F42C1"> UIPermission</span><span style="color:#24292E">:</span><span style="color:#6F42C1">IUIPermission</span><span style="color:#24292E"> { </span><span style="color:#D73A49">public</span><span style="color:#D73A49"> bool</span><span style="color:#6F42C1"> IsAdministrator</span><span style="color:#24292E"> { </span><span style="color:#D73A49">get</span><span style="color:#24292E">; </span><span style="color:#D73A49">set</span><span style="color:#24292E">; } </span><span style="color:#D73A49">public</span><span style="color:#D73A49"> bool</span><span style="color:#6F42C1"> IsModerator</span><span style="color:#24292E"> { </span><span style="color:#D73A49">get</span><span style="color:#24292E">; </span><span style="color:#D73A49">set</span><span style="color:#24292E">; } } </span></span></code></pre></figure>
<p>This class will be used in the situation that the action does not return any view model. In that case, we will use a default UIPermission that denied everything. Otherwise, we will use the one of the view model. The second place to use the interface is into the base class WebPageViewModel.</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#fff;color:#24292e" tabindex="0" data-language="csharp" data-theme="github-light"><code data-language="csharp" data-theme="github-light" style="display:grid"><span data-line=""><span style="color:#D73A49"> public</span><span style="color:#D73A49"> class</span><span style="color:#6F42C1"> WebPageViewModel</span><span style="color:#24292E">:</span><span style="color:#6F42C1">ViewModel</span><span style="color:#24292E">, </span><span style="color:#6F42C1">IUIPermission</span><span style="color:#24292E"> { </span><span style="color:#6A737D">/// &lt;</span><span style="color:#22863A">summary</span><span style="color:#6A737D">&gt; /// This is the title that is displayed in the browser title /// &lt;/</span><span style="color:#22863A">summary</span><span style="color:#6A737D">&gt; public string PageTitle { get; set; } /// &lt;</span><span style="color:#22863A">summary</span><span style="color:#6A737D">&gt; /// This is the main h1 of the page /// &lt;/</span><span style="color:#22863A">summary</span><span style="color:#6A737D">&gt; public string PageHeader { get; set; } /// &lt;</span><span style="color:#22863A">summary</span><span style="color:#6A737D">&gt; /// This is the specification for the title. It is not required. /// &lt;/</span><span style="color:#22863A">summary</span><span style="color:#6A737D">&gt; public string PageSubHeader { get; set; } public bool IsAdministrator { get; set; } public bool IsModerator { get; set; } } </span></span></code></pre></figure>
<p>This is the class that is inherited by every view model that is bound to a view. It is the place to use this interface. The next step is to find a place to set the user role to all view model without having to add some code every time we are using a view model for a view. This can be done in BaseController.</p>
<p>This can be done by overriding the OnActionExecuted method. We need to get the result model object, verify if this one inherit from IUIPermission to set permission. This still work fine with our other base class ModelViewModelMappingController that inherit BaseController.</p>
<p>The last step is to do the conditions in views. One of the challenge is that we wanted to display links or not depending of the view model UIPermission. The problem is that Layout.cshtml that has the partial class for the menu does not has a Model set. Also, this one change depending of which controllers and which action is used. To be able to make it works with every situations, the trick is to use a model of object type.</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#fff;color:#24292e" tabindex="0" data-language="html" data-theme="github-light"><code data-language="html" data-theme="github-light" style="display:grid"><span data-line=""><span style="color:#24292E">@model object &lt;!</span><span style="color:#22863A">DOCTYPE</span><span style="color:#6F42C1"> html</span><span style="color:#24292E">&gt; &lt;</span><span style="color:#22863A">html</span><span style="color:#24292E">&gt; ... ... @Html.Partial(&quot;_Header&quot;, Model as IUIPermission ?? new UIPermission()) </span></span></code></pre></figure>
<p>The partial must not be NULL, otherwise an exception is throw. The exception looks like “The model item passed into the dictionary is of type X but this dictionary requires a model item of type Y”. From there, the menu partial class get a model IUIPermission and use the required properties for the task. Here is an example of the menu.</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#fff;color:#24292e" tabindex="0" data-language="html" data-theme="github-light"><code data-language="html" data-theme="github-light" style="display:grid"><span data-line=""><span style="color:#24292E">&lt;</span><span style="color:#22863A">div</span><span style="color:#6F42C1"> class</span><span style="color:#24292E">=</span><span style="color:#032F62">&quot;navbar-collapse collapse&quot;</span><span style="color:#24292E">&gt; &lt;</span><span style="color:#22863A">ul</span><span style="color:#6F42C1"> class</span><span style="color:#24292E">=</span><span style="color:#032F62">&quot;nav navbar-nav&quot;</span><span style="color:#24292E">&gt; &lt;</span><span style="color:#22863A">li</span><span style="color:#24292E">&gt;@Html.ActionLink(&quot;Home&quot;, &quot;Index&quot;, &quot;Home&quot;)&lt;/</span><span style="color:#22863A">li</span><span style="color:#24292E">&gt; &lt;</span><span style="color:#22863A">li</span><span style="color:#24292E">&gt;@Html.ActionLink(&quot;Contests&quot;, &quot;List&quot;, &quot;UserContest&quot;, new { Area = Constants.Areas.CONTEST }, new { })&lt;/</span><span style="color:#22863A">li</span><span style="color:#24292E">&gt; @if (Model.IsAdministrator || Model.IsModerator) { &lt;</span><span style="color:#22863A">li</span><span style="color:#24292E">&gt; &lt;</span><span style="color:#22863A">a</span><span style="color:#6F42C1"> href</span><span style="color:#24292E">=</span><span style="color:#032F62">&quot;#&quot;</span><span style="color:#24292E">&gt;Moderation&lt;/</span><span style="color:#22863A">a</span><span style="color:#24292E">&gt; &lt;</span><span style="color:#22863A">ul</span><span style="color:#6F42C1"> class</span><span style="color:#24292E">=</span><span style="color:#032F62">&quot;dropdown-menu&quot;</span><span style="color:#24292E">&gt; &lt;</span><span style="color:#22863A">li</span><span style="color:#24292E">&gt;&lt;</span><span style="color:#22863A">a</span><span style="color:#6F42C1"> href</span><span style="color:#24292E">=</span><span style="color:#032F62">&quot;#&quot;</span><span style="color:#24292E">&gt;Split&lt;/</span><span style="color:#22863A">a</span><span style="color:#24292E">&gt;&lt;/</span><span style="color:#22863A">li</span><span style="color:#24292E">&gt; &lt;</span><span style="color:#22863A">li</span><span style="color:#24292E">&gt;&lt;</span><span style="color:#22863A">a</span><span style="color:#6F42C1"> href</span><span style="color:#24292E">=</span><span style="color:#032F62">&quot;#&quot;</span><span style="color:#24292E">&gt;Symbol Change&lt;/</span><span style="color:#22863A">a</span><span style="color:#24292E">&gt;&lt;/</span><span style="color:#22863A">li</span><span style="color:#24292E">&gt; &lt;</span><span style="color:#22863A">li</span><span style="color:#6F42C1"> class</span><span style="color:#24292E">=</span><span style="color:#032F62">&quot;divider&quot;</span><span style="color:#24292E">&gt;&lt;/</span><span style="color:#22863A">li</span><span style="color:#24292E">&gt; @if (Model.IsAdministrator || Model.IsModerator) { &lt;</span><span style="color:#22863A">li</span><span style="color:#6F42C1"> class</span><span style="color:#24292E">=</span><span style="color:#032F62">&quot;dropdown-header&quot;</span><span style="color:#24292E">&gt;Administrator&lt;/</span><span style="color:#22863A">li</span><span style="color:#24292E">&gt; &lt;</span><span style="color:#22863A">li</span><span style="color:#24292E">&gt;&lt;</span><span style="color:#22863A">a</span><span style="color:#6F42C1"> href</span><span style="color:#24292E">=</span><span style="color:#032F62">&quot;#&quot;</span><span style="color:#24292E">&gt;DashBoard&lt;/</span><span style="color:#22863A">a</span><span style="color:#24292E">&gt;&lt;/</span><span style="color:#22863A">li</span><span style="color:#24292E">&gt; &lt;</span><span style="color:#22863A">li</span><span style="color:#24292E">&gt;&lt;</span><span style="color:#22863A">a</span><span style="color:#6F42C1"> href</span><span style="color:#24292E">=</span><span style="color:#032F62">&quot;#&quot;</span><span style="color:#24292E">&gt;News&lt;/</span><span style="color:#22863A">a</span><span style="color:#24292E">&gt;&lt;/</span><span style="color:#22863A">li</span><span style="color:#24292E">&gt; &lt;</span><span style="color:#22863A">li</span><span style="color:#24292E">&gt;&lt;</span><span style="color:#22863A">a</span><span style="color:#6F42C1"> href</span><span style="color:#24292E">=</span><span style="color:#032F62">&quot;#&quot;</span><span style="color:#24292E">&gt;User&lt;/</span><span style="color:#22863A">a</span><span style="color:#24292E">&gt;&lt;/</span><span style="color:#22863A">li</span><span style="color:#24292E">&gt; &lt;</span><span style="color:#22863A">li</span><span style="color:#24292E">&gt; &lt;</span><span style="color:#22863A">a</span><span style="color:#6F42C1"> href</span><span style="color:#24292E">=</span><span style="color:#032F62">&quot;#&quot;</span><span style="color:#24292E">&gt;Contest&lt;/</span><span style="color:#22863A">a</span><span style="color:#24292E">&gt; &lt;</span><span style="color:#22863A">ul</span><span style="color:#6F42C1"> class</span><span style="color:#24292E">=</span><span style="color:#032F62">&quot;dropdown-menu&quot;</span><span style="color:#24292E">&gt; &lt;</span><span style="color:#22863A">li</span><span style="color:#24292E">&gt;@Html.ActionLink(&quot;List&quot;, &quot;List&quot;, &quot;Contest&quot;, new {Area = Constants.Areas.ADMINISTRATOR}, new {})&lt;/</span><span style="color:#22863A">li</span><span style="color:#24292E">&gt; &lt;</span><span style="color:#22863A">li</span><span style="color:#24292E">&gt;@Html.ActionLink(&quot;Create&quot;, &quot;Create&quot;, &quot;Contest&quot;, new {Area = Constants.Areas.ADMINISTRATOR}, new {})&lt;/</span><span style="color:#22863A">li</span><span style="color:#24292E">&gt; &lt;/</span><span style="color:#22863A">ul</span><span style="color:#24292E">&gt; &lt;/</span><span style="color:#22863A">li</span><span style="color:#24292E">&gt; &lt;</span><span style="color:#22863A">li</span><span style="color:#6F42C1"> class</span><span style="color:#24292E">=</span><span style="color:#032F62">&quot;divider&quot;</span><span style="color:#24292E">&gt;&lt;/</span><span style="color:#22863A">li</span><span style="color:#24292E">&gt; } &lt;</span><span style="color:#22863A">li</span><span style="color:#6F42C1"> class</span><span style="color:#24292E">=</span><span style="color:#032F62">&quot;dropdown-header&quot;</span><span style="color:#24292E">&gt;Statistics&lt;/</span><span style="color:#22863A">li</span><span style="color:#24292E">&gt; &lt;</span><span style="color:#22863A">li</span><span style="color:#24292E">&gt;&lt;</span><span style="color:#22863A">a</span><span style="color:#6F42C1"> href</span><span style="color:#24292E">=</span><span style="color:#032F62">&quot;#&quot;</span><span style="color:#24292E">&gt;Server&lt;/</span><span style="color:#22863A">a</span><span style="color:#24292E">&gt;&lt;/</span><span style="color:#22863A">li</span><span style="color:#24292E">&gt; &lt;</span><span style="color:#22863A">li</span><span style="color:#24292E">&gt;&lt;</span><span style="color:#22863A">a</span><span style="color:#6F42C1"> href</span><span style="color:#24292E">=</span><span style="color:#032F62">&quot;#&quot;</span><span style="color:#24292E">&gt;Users&lt;/</span><span style="color:#22863A">a</span><span style="color:#24292E">&gt;&lt;/</span><span style="color:#22863A">li</span><span style="color:#24292E">&gt; &lt;/</span><span style="color:#22863A">ul</span><span style="color:#24292E">&gt; &lt;/</span><span style="color:#22863A">li</span><span style="color:#24292E">&gt; } &lt;/</span><span style="color:#22863A">ul</span><span style="color:#24292E">&gt; @Html.Partial(&quot;_LoginPartial&quot;) &lt;/</span><span style="color:#22863A">div</span><span style="color:#24292E">&gt; </span></span></code></pre></figure>
<h1>ADJUSTING GRID COLUMN WITH RESOLUTION WITH PAGING AND SORTING May 12, 2014 By: pdesjardins</h1>
<p>We have to show information inside a grid. I first used the WebMatrix Web Grid that allow to have sorting, paging, ajax call back etc. The problem is that it does not work very well if you want something flexible. I also had problem with paging and with sorting. At the end, I figured it out that it was less problem to just create an Html grid and using some custom Html Helper to create something very clean. I also wanted to integrate the FootTable.js JavaScript library to have dynamic column display. It was very hard with the WebMatrix and a breeze with custom html helper. An example is that I wanted to sort on a property that when clicked and sent to the controller was the name of the view model. The problem was that the WebMatrix must have the same name between view model and model otherwise the mapping cannot be done. This article explains how to create a grid that can be sortable with paging and that when resizeable continue to be usable.</p>
<p>Here is images of the final result. The first image is when the resolution full screen (desktop).</p>
<p><img src="/images/blog/GridFullSize-1024x311.png" alt=""/></p>
<p>This one is for tablet resolution: <img src="/images/blog/GridTabletSize.png" alt=""/></p>
<p>This one is for phone. The second row is open to show you that the FooTable.js library allows you to have some interesting features.</p>
<p><img src="/images/blog/GridMobile.png" alt=""/></p>
<p>I will not discuss here about the filter capability because it is a subject that does not touche the grid. This allow to have some condition on the data set that is bound to the grid but does not affect the creation of the grid.</p>
<p>View Model</p>
<p>The first thing is that I was using WebMatrix which required to have some field like “sort”, “sortdir” and “page” defined in lowercase. This is why you will see in few that I have still used this nomenclature. Now, it could be renamed but I have not do it yet. Nevertheless, the principle is the same. You need to have your view model, that has the list of element you want to bind to the grid, to inherit from a base class that has these three properties. These one are used to know the sort property, the sort direction and which page to load information.</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#fff;color:#24292e" tabindex="0" data-language="csharp" data-theme="github-light"><code data-language="csharp" data-theme="github-light" style="display:grid"><span data-line=""><span style="color:#D73A49"> public</span><span style="color:#D73A49"> interface</span><span style="color:#6F42C1"> IWebGridPagingInformation</span><span style="color:#24292E"> { </span><span style="color:#D73A49">string</span><span style="color:#6F42C1"> sort</span><span style="color:#24292E"> { </span><span style="color:#D73A49">get</span><span style="color:#24292E">; </span><span style="color:#D73A49">set</span><span style="color:#24292E">; } </span><span style="color:#D73A49">string</span><span style="color:#6F42C1"> sortdir</span><span style="color:#24292E"> { </span><span style="color:#D73A49">get</span><span style="color:#24292E">; </span><span style="color:#D73A49">set</span><span style="color:#24292E">; } </span><span style="color:#D73A49">int</span><span style="color:#6F42C1"> page</span><span style="color:#24292E"> { </span><span style="color:#D73A49">get</span><span style="color:#24292E">; </span><span style="color:#D73A49">set</span><span style="color:#24292E">; } } </span><span style="color:#D73A49">public</span><span style="color:#D73A49"> class</span><span style="color:#6F42C1"> GridFilterSortableViewModel</span><span style="color:#24292E">:</span><span style="color:#6F42C1">WebPageViewModel</span><span style="color:#24292E">, </span><span style="color:#6F42C1">IWebGridPagingInformation</span><span style="color:#24292E"> { </span><span style="color:#D73A49">public</span><span style="color:#D73A49"> string</span><span style="color:#6F42C1"> sort</span><span style="color:#24292E"> { </span><span style="color:#D73A49">get</span><span style="color:#24292E">; </span><span style="color:#D73A49">set</span><span style="color:#24292E">; } </span><span style="color:#D73A49">public</span><span style="color:#D73A49"> string</span><span style="color:#6F42C1"> sortdir</span><span style="color:#24292E"> { </span><span style="color:#D73A49">get</span><span style="color:#24292E">; </span><span style="color:#D73A49">set</span><span style="color:#24292E">; } </span><span style="color:#D73A49">public</span><span style="color:#D73A49"> int</span><span style="color:#6F42C1"> page</span><span style="color:#24292E"> { </span><span style="color:#D73A49">get</span><span style="color:#24292E">; </span><span style="color:#D73A49">set</span><span style="color:#24292E">; } </span><span style="color:#D73A49">public</span><span style="color:#D73A49"> bool</span><span style="color:#6F42C1"> HasSortAndPagingFilter</span><span style="color:#24292E"> { </span><span style="color:#D73A49">get</span><span style="color:#24292E"> { </span><span style="color:#D73A49">return</span><span style="color:#D73A49"> !</span><span style="color:#24292E">(sort </span><span style="color:#D73A49">==</span><span style="color:#005CC5"> null</span><span style="color:#D73A49"> &amp;&amp;</span><span style="color:#24292E"> sortdir </span><span style="color:#D73A49">==</span><span style="color:#005CC5"> null</span><span style="color:#D73A49"> &amp;&amp;</span><span style="color:#24292E"> page </span><span style="color:#D73A49">==</span><span style="color:#D73A49"> default</span><span style="color:#24292E">(</span><span style="color:#D73A49">int</span><span style="color:#24292E">)); } } } </span></span>
<span data-line=""><span style="color:#24292E">``` The Interface </span><span style="color:#D73A49">is</span><span style="color:#6F42C1"> used</span><span style="color:#6F42C1"> for</span><span style="color:#6F42C1"> information</span><span style="color:#6F42C1"> about</span><span style="color:#6F42C1"> the</span><span style="color:#6F42C1"> sort</span><span style="color:#D73A49"> and</span><span style="color:#6F42C1"> paging</span><span style="color:#24292E">. </span><span style="color:#6F42C1">It</span><span style="color:#6F42C1"> will</span><span style="color:#6F42C1"> be</span><span style="color:#6F42C1"> mapped</span><span style="color:#6F42C1"> later</span><span style="color:#6F42C1"> to</span><span style="color:#6F42C1"> a</span><span style="color:#6F42C1"> interface</span><span style="color:#6F42C1"> that</span><span style="color:#6F42C1"> the</span><span style="color:#6F42C1"> model</span><span style="color:#6F42C1"> known</span><span style="color:#6F42C1"> to</span><span style="color:#6F42C1"> execute</span><span style="color:#6F42C1"> its</span><span style="color:#6F42C1"> query</span><span style="color:#6F42C1"> with</span><span style="color:#6F42C1"> Entity</span><span style="color:#6F42C1"> Framework</span><span style="color:#24292E">.</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#6F42C1">This</span><span style="color:#6F42C1"> last</span><span style="color:#6F42C1"> class</span><span style="color:#24292E">, GridFilterSortableViewModel, can be used </span><span style="color:#D73A49">for</span><span style="color:#24292E"> your concrete implementation for your entity. For example, I have a list of Contest entity. This class has the list of contest to display and a property that is all filters that you want to apply to the entity. This allow to offer more filter or less than what it is displayed.</span></span>
<span data-line=""> </span>
<span data-line=""> </span>
<span data-line=""><span style="color:#24292E">```csharp</span></span>
<span data-line=""><span style="color:#24292E"> public class ContestListViewModel : Infrastructures.GridFilterSortableViewModel { public ContestListViewModel() { Filters </span><span style="color:#D73A49">=</span><span style="color:#D73A49"> new</span><span style="color:#6F42C1"> ContestListFilterFieldsViewModel</span><span style="color:#24292E">(); } </span><span style="color:#D73A49">public</span><span style="color:#24292E"> IEnumerable</span><span style="color:#D73A49">&lt;</span><span style="color:#24292E">ContestListItemViewModel</span><span style="color:#D73A49">&gt;</span><span style="color:#24292E"> Contests { get; set; } </span><span style="color:#D73A49">public</span><span style="color:#24292E"> ContestListFilterFieldsViewModel Filters { get; set; } } </span></span>
<span data-line=""><span style="color:#24292E">``` On the </span><span style="color:#6F42C1">controller</span><span style="color:#6F42C1"> side</span><span style="color:#24292E">, </span><span style="color:#6F42C1">one</span><span style="color:#6F42C1"> action</span><span style="color:#6F42C1"> is</span><span style="color:#6F42C1"> available</span><span style="color:#24292E">. </span><span style="color:#6F42C1">Everything</span><span style="color:#6F42C1"> is</span><span style="color:#6F42C1"> within</span><span style="color:#6F42C1"> GET</span><span style="color:#6F42C1"> which</span><span style="color:#6F42C1"> allow</span><span style="color:#6F42C1"> to</span><span style="color:#6F42C1"> use</span><span style="color:#6F42C1"> filtering</span><span style="color:#6F42C1"> and</span><span style="color:#6F42C1"> paging</span><span style="color:#6F42C1"> from</span><span style="color:#6F42C1"> an</span><span style="color:#6F42C1"> URL</span><span style="color:#24292E">. </span><span style="color:#6F42C1">This</span><span style="color:#6F42C1"> is</span><span style="color:#6F42C1"> very</span><span style="color:#6F42C1"> interesting</span><span style="color:#6F42C1"> to</span><span style="color:#6F42C1"> communicate</span><span style="color:#6F42C1"> a</span><span style="color:#6F42C1"> grid</span><span style="color:#6F42C1"> preference</span><span style="color:#6F42C1"> by</span><span style="color:#6F42C1"> URL</span><span style="color:#24292E">.</span></span>
<span data-line=""> </span>
<span data-line=""> </span>
<span data-line=""><span style="color:#24292E">```</span><span style="color:#6F42C1">csharp</span></span>
<span data-line=""><span style="color:#24292E"> [</span><span style="color:#6F42C1">HttpGet</span><span style="color:#24292E">] [</span><span style="color:#6F42C1">Authorize</span><span style="color:#24292E">(</span><span style="color:#6F42C1">Roles</span><span style="color:#D73A49"> =</span><span style="color:#24292E"> ApplicationRole.ADMINISTRATOR_MODERATOR)] </span><span style="color:#D73A49">public</span><span style="color:#6F42C1"> ActionResult</span><span style="color:#6F42C1"> List</span><span style="color:#24292E">(</span><span style="color:#6F42C1">ContestListViewModel</span><span style="color:#6F42C1"> contestListViewModel</span><span style="color:#24292E">) { </span><span style="color:#6A737D">//Get filter contests var contestsListModel = this.MapperFacade.GetModel&lt;ContestList, ContestListViewModel&gt;(contestListViewModel); var contests = this.contestService.GetContestsByFilter(contestsListModel.Filters);//This one load the filter with good value (COUNT of contest) + return contest for filter contestsListModel.Contests = contests; //Transform back everything for the page var viewModelWithContestsAndFilter = this.MapperFacade.GetViewModel&lt;ContestList, ContestListViewModel&gt;(contestsListModel); //View Model viewModelWithContestsAndFilter.InitializeTitles(); ModelState.Clear(); //Return only a partial if the grid has called the controller with Ajax call return View(viewModelWithContestsAndFilter); } </span></span></code></pre></figure>
<p>The first step in the action is to convert the contest list view model into the model. The model is simple and allows to have columns in the sort and filters to be translated into the model property name and not anymore the view model property name.</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#fff;color:#24292e" tabindex="0" data-language="csharp" data-theme="github-light"><code data-language="csharp" data-theme="github-light" style="display:grid"><span data-line=""><span style="color:#D73A49"> public</span><span style="color:#D73A49"> class</span><span style="color:#6F42C1"> ContestList</span><span style="color:#24292E"> { </span><span style="color:#D73A49">public</span><span style="color:#6F42C1"> IEnumerable</span><span style="color:#24292E">&lt;</span><span style="color:#6F42C1">Contest</span><span style="color:#24292E">&gt; </span><span style="color:#6F42C1">Contests</span><span style="color:#24292E"> { </span><span style="color:#D73A49">get</span><span style="color:#24292E">; </span><span style="color:#D73A49">set</span><span style="color:#24292E">; } </span><span style="color:#D73A49">public</span><span style="color:#6F42C1"> ContestListFilterFields</span><span style="color:#6F42C1"> Filters</span><span style="color:#24292E"> { </span><span style="color:#D73A49">get</span><span style="color:#24292E">; </span><span style="color:#D73A49">set</span><span style="color:#24292E">; } } </span></span></code></pre></figure>
<p>The ContestListFilterFields has all Contest Filter fields that we allow to filter but also inherit from FilterEntity.</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#fff;color:#24292e" tabindex="0" data-language="csharp" data-theme="github-light"><code data-language="csharp" data-theme="github-light" style="display:grid"><span data-line=""><span style="color:#D73A49"> public</span><span style="color:#D73A49"> class</span><span style="color:#6F42C1"> ContestListFilterFields</span><span style="color:#24292E"> : </span><span style="color:#6F42C1">FilterEntity</span><span style="color:#24292E"> { </span><span style="color:#D73A49">public</span><span style="color:#6F42C1"> LocalizedString</span><span style="color:#6F42C1"> Name</span><span style="color:#24292E"> { </span><span style="color:#D73A49">get</span><span style="color:#24292E">; </span><span style="color:#D73A49">set</span><span style="color:#24292E">; } </span><span style="color:#D73A49">public</span><span style="color:#6F42C1"> DateTime</span><span style="color:#24292E">? </span><span style="color:#6F42C1">StartingTime</span><span style="color:#24292E"> { </span><span style="color:#D73A49">get</span><span style="color:#24292E">; </span><span style="color:#D73A49">set</span><span style="color:#24292E">; } </span><span style="color:#D73A49">public</span><span style="color:#6F42C1"> DateTime</span><span style="color:#24292E">? </span><span style="color:#6F42C1">EndingTime</span><span style="color:#24292E"> { </span><span style="color:#D73A49">get</span><span style="color:#24292E">; </span><span style="color:#D73A49">set</span><span style="color:#24292E">; } [</span><span style="color:#6F42C1">Display</span><span style="color:#24292E">(</span><span style="color:#6F42C1">ResourceType</span><span style="color:#D73A49"> =</span><span style="color:#D73A49"> typeof</span><span style="color:#24292E">(</span><span style="color:#6F42C1">ModelPropertyDisplayName</span><span style="color:#24292E">), </span><span style="color:#6F42C1">Name</span><span style="color:#D73A49"> =</span><span style="color:#032F62"> &quot;IsUsingStockRules&quot;</span><span style="color:#24292E">)] </span><span style="color:#D73A49">public</span><span style="color:#D73A49"> bool</span><span style="color:#6F42C1"> IsUsingStockRules</span><span style="color:#24292E"> { </span><span style="color:#D73A49">get</span><span style="color:#24292E">; </span><span style="color:#D73A49">set</span><span style="color:#24292E">; } [</span><span style="color:#6F42C1">Display</span><span style="color:#24292E">(</span><span style="color:#6F42C1">ResourceType</span><span style="color:#D73A49"> =</span><span style="color:#D73A49"> typeof</span><span style="color:#24292E">(</span><span style="color:#6F42C1">ModelPropertyDisplayName</span><span style="color:#24292E">), </span><span style="color:#6F42C1">Name</span><span style="color:#D73A49"> =</span><span style="color:#032F62"> &quot;IsUsingShortRules&quot;</span><span style="color:#24292E">)] </span><span style="color:#D73A49">public</span><span style="color:#D73A49"> bool</span><span style="color:#6F42C1"> IsUsingShortRules</span><span style="color:#24292E"> { </span><span style="color:#D73A49">get</span><span style="color:#24292E">; </span><span style="color:#D73A49">set</span><span style="color:#24292E">; } [</span><span style="color:#6F42C1">Display</span><span style="color:#24292E">(</span><span style="color:#6F42C1">ResourceType</span><span style="color:#D73A49"> =</span><span style="color:#D73A49"> typeof</span><span style="color:#24292E">(</span><span style="color:#6F42C1">ModelPropertyDisplayName</span><span style="color:#24292E">), </span><span style="color:#6F42C1">Name</span><span style="color:#D73A49"> =</span><span style="color:#032F62"> &quot;IsUsingOptionRules&quot;</span><span style="color:#24292E">)] </span><span style="color:#D73A49">public</span><span style="color:#D73A49"> bool</span><span style="color:#6F42C1"> IsUsingOptionRules</span><span style="color:#24292E"> { </span><span style="color:#D73A49">get</span><span style="color:#24292E">; </span><span style="color:#D73A49">set</span><span style="color:#24292E">; } </span><span style="color:#D73A49">public</span><span style="color:#6F42C1"> Money</span><span style="color:#6F42C1"> InitialCapital</span><span style="color:#24292E"> { </span><span style="color:#D73A49">get</span><span style="color:#24292E">; </span><span style="color:#D73A49">set</span><span style="color:#24292E">; } </span><span style="color:#D73A49">public</span><span style="color:#D73A49"> bool</span><span style="color:#6F42C1"> IsFilteringOnInitialCapital</span><span style="color:#24292E"> { </span><span style="color:#D73A49">get</span><span style="color:#24292E"> { </span><span style="color:#D73A49">return</span><span style="color:#24292E"> InitialCapital </span><span style="color:#D73A49">!=</span><span style="color:#005CC5"> null</span><span style="color:#24292E">; } } </span><span style="color:#D73A49">public</span><span style="color:#6F42C1"> ContestListFilterFields</span><span style="color:#24292E">() { Sort </span><span style="color:#D73A49">=</span><span style="color:#24292E"> CrossLayer.Reflections.LambdaHelper.</span><span style="color:#6F42C1">GetPropertyName</span><span style="color:#24292E">&lt;</span><span style="color:#6F42C1">ContestListFilterFields</span><span style="color:#24292E">&gt;(</span><span style="color:#6F42C1">d</span><span style="color:#D73A49"> =&gt;</span><span style="color:#24292E"> d.StartingTime); SortDirection </span><span style="color:#D73A49">=</span><span style="color:#24292E"> SortDirection.Desc; } } </span></span></code></pre></figure>
<p>The constructor define the default behavior of the grid. As you can see, it is possible to use the sort property to set the default to be the starting time in descending order. The mapping will set these default properties to model.</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#fff;color:#24292e" tabindex="0" data-language="csharp" data-theme="github-light"><code data-language="csharp" data-theme="github-light" style="display:grid"><span data-line=""><span style="color:#24292E"> Mapper.</span><span style="color:#6F42C1">CreateMap</span><span style="color:#24292E">&lt;</span><span style="color:#6F42C1">ContestListFilterFields</span><span style="color:#24292E">, </span><span style="color:#6F42C1">ContestListFilterFieldsViewModel</span><span style="color:#24292E">&gt;() .</span><span style="color:#6F42C1">ForMember</span><span style="color:#24292E">(</span><span style="color:#6F42C1">d</span><span style="color:#D73A49">=&gt;</span><span style="color:#24292E">d.EndingTime, </span><span style="color:#6F42C1">option</span><span style="color:#D73A49">=&gt;</span><span style="color:#24292E">option.</span><span style="color:#6F42C1">MapFrom</span><span style="color:#24292E">(</span><span style="color:#6F42C1">d</span><span style="color:#D73A49">=&gt;</span><span style="color:#24292E">d.EndingTime)) .</span><span style="color:#6F42C1">ForMember</span><span style="color:#24292E">(</span><span style="color:#6F42C1">d</span><span style="color:#D73A49"> =&gt;</span><span style="color:#24292E"> d.InitialCapital, </span><span style="color:#6F42C1">option</span><span style="color:#D73A49"> =&gt;</span><span style="color:#24292E"> option.</span><span style="color:#6F42C1">MapFrom</span><span style="color:#24292E">(</span><span style="color:#6F42C1">d</span><span style="color:#D73A49"> =&gt;</span><span style="color:#24292E"> d.InitialCapital </span><span style="color:#D73A49">??</span><span style="color:#D73A49"> new</span><span style="color:#6F42C1"> Money</span><span style="color:#24292E">())) .</span><span style="color:#6F42C1">ForMember</span><span style="color:#24292E">(</span><span style="color:#6F42C1">d</span><span style="color:#D73A49">=&gt;</span><span style="color:#24292E">d.IsUsingOptionRules, </span><span style="color:#6F42C1">option</span><span style="color:#D73A49">=&gt;</span><span style="color:#24292E">option.</span><span style="color:#6F42C1">MapFrom</span><span style="color:#24292E">(</span><span style="color:#6F42C1">d</span><span style="color:#D73A49">=&gt;</span><span style="color:#24292E">d.IsUsingOptionRules)) .</span><span style="color:#6F42C1">ForMember</span><span style="color:#24292E">(</span><span style="color:#6F42C1">d</span><span style="color:#D73A49">=&gt;</span><span style="color:#24292E">d.IsUsingShortRules, </span><span style="color:#6F42C1">option</span><span style="color:#D73A49">=&gt;</span><span style="color:#24292E">option.</span><span style="color:#6F42C1">MapFrom</span><span style="color:#24292E">(</span><span style="color:#6F42C1">d</span><span style="color:#D73A49">=&gt;</span><span style="color:#24292E">d.IsUsingShortRules)) .</span><span style="color:#6F42C1">ForMember</span><span style="color:#24292E">(</span><span style="color:#6F42C1">d</span><span style="color:#D73A49">=&gt;</span><span style="color:#24292E">d.IsUsingStockRules, </span><span style="color:#6F42C1">option</span><span style="color:#D73A49">=&gt;</span><span style="color:#24292E">option.</span><span style="color:#6F42C1">MapFrom</span><span style="color:#24292E">(</span><span style="color:#6F42C1">d</span><span style="color:#D73A49">=&gt;</span><span style="color:#24292E">d.IsUsingStockRules)) .</span><span style="color:#6F42C1">ForMember</span><span style="color:#24292E">(</span><span style="color:#6F42C1">d</span><span style="color:#D73A49">=&gt;</span><span style="color:#24292E">d.Name, </span><span style="color:#6F42C1">option</span><span style="color:#D73A49">=&gt;</span><span style="color:#24292E">option.</span><span style="color:#6F42C1">MapFrom</span><span style="color:#24292E">(</span><span style="color:#6F42C1">d</span><span style="color:#D73A49">=&gt;</span><span style="color:#24292E">d.Name)) .</span><span style="color:#6F42C1">ForMember</span><span style="color:#24292E">(</span><span style="color:#6F42C1">d</span><span style="color:#D73A49">=&gt;</span><span style="color:#24292E">d.RowsPerPage, </span><span style="color:#6F42C1">option</span><span style="color:#D73A49">=&gt;</span><span style="color:#24292E">option.</span><span style="color:#6F42C1">MapFrom</span><span style="color:#24292E">(</span><span style="color:#6F42C1">d</span><span style="color:#D73A49">=&gt;</span><span style="color:#24292E">d.NumberOfEntitiesPerRequest)) .</span><span style="color:#6F42C1">ForMember</span><span style="color:#24292E">(</span><span style="color:#6F42C1">d</span><span style="color:#D73A49"> =&gt;</span><span style="color:#24292E"> d.StartingTime, </span><span style="color:#6F42C1">option</span><span style="color:#D73A49"> =&gt;</span><span style="color:#24292E"> option.</span><span style="color:#6F42C1">MapFrom</span><span style="color:#24292E">(</span><span style="color:#6F42C1">d</span><span style="color:#D73A49"> =&gt;</span><span style="color:#24292E"> d.StartingTime)) .</span><span style="color:#6F42C1">ForMember</span><span style="color:#24292E">(</span><span style="color:#6F42C1">d</span><span style="color:#D73A49"> =&gt;</span><span style="color:#24292E"> d.TotalRecords, </span><span style="color:#6F42C1">option</span><span style="color:#D73A49"> =&gt;</span><span style="color:#24292E"> option.</span><span style="color:#6F42C1">MapFrom</span><span style="color:#24292E">(</span><span style="color:#6F42C1">d</span><span style="color:#D73A49"> =&gt;</span><span style="color:#24292E"> d.EntityTotalCount)) ; Mapper.</span><span style="color:#6F42C1">CreateMap</span><span style="color:#24292E">&lt;</span><span style="color:#6F42C1">ContestListFilterFieldsViewModel</span><span style="color:#24292E">, </span><span style="color:#6F42C1">ContestListFilterFields</span><span style="color:#24292E">&gt;() .</span><span style="color:#6F42C1">ForMember</span><span style="color:#24292E">(</span><span style="color:#6F42C1">d</span><span style="color:#D73A49"> =&gt;</span><span style="color:#24292E"> d.EndingTime, </span><span style="color:#6F42C1">option</span><span style="color:#D73A49"> =&gt;</span><span style="color:#24292E"> option.</span><span style="color:#6F42C1">MapFrom</span><span style="color:#24292E">(</span><span style="color:#6F42C1">d</span><span style="color:#D73A49"> =&gt;</span><span style="color:#24292E"> d.EndingTime)) .</span><span style="color:#6F42C1">ForMember</span><span style="color:#24292E">(</span><span style="color:#6F42C1">d</span><span style="color:#D73A49"> =&gt;</span><span style="color:#24292E"> d.InitialCapital, </span><span style="color:#6F42C1">option</span><span style="color:#D73A49"> =&gt;</span><span style="color:#24292E"> option.</span><span style="color:#6F42C1">MapFrom</span><span style="color:#24292E">(</span><span style="color:#6F42C1">d</span><span style="color:#D73A49"> =&gt;</span><span style="color:#24292E"> d.InitialCapital.Value</span><span style="color:#D73A49">!=</span><span style="color:#005CC5">0</span><span style="color:#D73A49">?</span><span style="color:#24292E">d.InitialCapital</span><span style="color:#D73A49">:</span><span style="color:#005CC5">null</span><span style="color:#24292E">)) .</span><span style="color:#6F42C1">ForMember</span><span style="color:#24292E">(</span><span style="color:#6F42C1">d</span><span style="color:#D73A49"> =&gt;</span><span style="color:#24292E"> d.IsUsingOptionRules, </span><span style="color:#6F42C1">option</span><span style="color:#D73A49"> =&gt;</span><span style="color:#24292E"> option.</span><span style="color:#6F42C1">MapFrom</span><span style="color:#24292E">(</span><span style="color:#6F42C1">d</span><span style="color:#D73A49"> =&gt;</span><span style="color:#24292E"> d.IsUsingOptionRules)) .</span><span style="color:#6F42C1">ForMember</span><span style="color:#24292E">(</span><span style="color:#6F42C1">d</span><span style="color:#D73A49"> =&gt;</span><span style="color:#24292E"> d.IsUsingShortRules, </span><span style="color:#6F42C1">option</span><span style="color:#D73A49"> =&gt;</span><span style="color:#24292E"> option.</span><span style="color:#6F42C1">MapFrom</span><span style="color:#24292E">(</span><span style="color:#6F42C1">d</span><span style="color:#D73A49"> =&gt;</span><span style="color:#24292E"> d.IsUsingShortRules)) .</span><span style="color:#6F42C1">ForMember</span><span style="color:#24292E">(</span><span style="color:#6F42C1">d</span><span style="color:#D73A49"> =&gt;</span><span style="color:#24292E"> d.IsUsingStockRules, </span><span style="color:#6F42C1">option</span><span style="color:#D73A49"> =&gt;</span><span style="color:#24292E"> option.</span><span style="color:#6F42C1">MapFrom</span><span style="color:#24292E">(</span><span style="color:#6F42C1">d</span><span style="color:#D73A49"> =&gt;</span><span style="color:#24292E"> d.IsUsingStockRules)) .</span><span style="color:#6F42C1">ForMember</span><span style="color:#24292E">(</span><span style="color:#6F42C1">d</span><span style="color:#D73A49"> =&gt;</span><span style="color:#24292E"> d.Name, </span><span style="color:#6F42C1">option</span><span style="color:#D73A49"> =&gt;</span><span style="color:#24292E"> option.</span><span style="color:#6F42C1">MapFrom</span><span style="color:#24292E">(</span><span style="color:#6F42C1">d</span><span style="color:#D73A49"> =&gt;</span><span style="color:#24292E"> d.Name)) .</span><span style="color:#6F42C1">ForMember</span><span style="color:#24292E">(</span><span style="color:#6F42C1">d</span><span style="color:#D73A49"> =&gt;</span><span style="color:#24292E"> d.StartingTime, </span><span style="color:#6F42C1">option</span><span style="color:#D73A49"> =&gt;</span><span style="color:#24292E"> option.</span><span style="color:#6F42C1">MapFrom</span><span style="color:#24292E">(</span><span style="color:#6F42C1">d</span><span style="color:#D73A49"> =&gt;</span><span style="color:#24292E"> d.StartingTime)) ; </span></span></code></pre></figure>
<p>The FilterEntity class that inherit your concrete ContestListFilterFields is very generic which mean that you have all what you have for all future entities. It has the current page property, the property name for the sort, the sort direction, total count of entities and the number of entity to display per page.</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#fff;color:#24292e" tabindex="0" data-language="csharp" data-theme="github-light"><code data-language="csharp" data-theme="github-light" style="display:grid"><span data-line=""><span style="color:#D73A49"> public</span><span style="color:#D73A49"> class</span><span style="color:#6F42C1"> FilterEntity</span><span style="color:#24292E">:</span><span style="color:#6F42C1">IPagingInformation</span><span style="color:#24292E"> { </span><span style="color:#D73A49">public</span><span style="color:#D73A49"> const</span><span style="color:#D73A49"> int</span><span style="color:#6F42C1"> DEFAULT_CURRENT_PAGE</span><span style="color:#D73A49"> =</span><span style="color:#005CC5"> 0</span><span style="color:#24292E">; </span><span style="color:#D73A49">public</span><span style="color:#D73A49"> const</span><span style="color:#D73A49"> int</span><span style="color:#6F42C1"> NUMBER_OF_ENTITIES_PER_PAGE</span><span style="color:#D73A49"> =</span><span style="color:#005CC5"> 3</span><span style="color:#24292E">; </span><span style="color:#D73A49">public</span><span style="color:#6F42C1"> FilterEntity</span><span style="color:#24292E">() { </span><span style="color:#6F42C1">SetDefaultValues</span><span style="color:#24292E">(); } </span><span style="color:#D73A49">public</span><span style="color:#D73A49"> int</span><span style="color:#6F42C1"> NumberOfEntitiesPerRequest</span><span style="color:#24292E"> { </span><span style="color:#D73A49">get</span><span style="color:#24292E">; </span><span style="color:#D73A49">set</span><span style="color:#24292E">; } </span><span style="color:#D73A49">public</span><span style="color:#D73A49"> int</span><span style="color:#6F42C1"> CurrentPage</span><span style="color:#24292E"> { </span><span style="color:#D73A49">get</span><span style="color:#24292E">; </span><span style="color:#D73A49">set</span><span style="color:#24292E">; } </span><span style="color:#D73A49">public</span><span style="color:#D73A49"> string</span><span style="color:#6F42C1"> Sort</span><span style="color:#24292E"> { </span><span style="color:#D73A49">get</span><span style="color:#24292E">; </span><span style="color:#D73A49">set</span><span style="color:#24292E">; } </span><span style="color:#D73A49">public</span><span style="color:#6F42C1"> SortDirection</span><span style="color:#6F42C1"> SortDirection</span><span style="color:#24292E"> { </span><span style="color:#D73A49">get</span><span style="color:#24292E">; </span><span style="color:#D73A49">set</span><span style="color:#24292E">; } </span><span style="color:#D73A49">public</span><span style="color:#D73A49"> int</span><span style="color:#6F42C1"> EntityTotalCount</span><span style="color:#24292E"> { </span><span style="color:#D73A49">get</span><span style="color:#24292E">; </span><span style="color:#D73A49">set</span><span style="color:#24292E">; } </span><span style="color:#D73A49">public</span><span style="color:#D73A49"> void</span><span style="color:#6F42C1"> SetDefaultValues</span><span style="color:#24292E">() { </span><span style="color:#005CC5">this</span><span style="color:#24292E">.CurrentPage </span><span style="color:#D73A49">=</span><span style="color:#24292E"> DEFAULT_CURRENT_PAGE; </span><span style="color:#005CC5">this</span><span style="color:#24292E">.NumberOfEntitiesPerRequest </span><span style="color:#D73A49">=</span><span style="color:#24292E"> NUMBER_OF_ENTITIES_PER_PAGE; </span><span style="color:#005CC5">this</span><span style="color:#24292E">.SortDirection </span><span style="color:#D73A49">=</span><span style="color:#24292E"> SortDirection.Asc; } } </span></span>
<span data-line=""><span style="color:#24292E">``` The last thing to </span><span style="color:#D73A49">do</span><span style="color:#D73A49"> is</span><span style="color:#6F42C1"> to</span><span style="color:#6F42C1"> mark</span><span style="color:#6F42C1"> the</span><span style="color:#6F42C1"> table</span><span style="color:#6F42C1"> with</span><span style="color:#6F42C1"> the</span><span style="color:#6F42C1"> sort</span><span style="color:#6F42C1"> direction</span><span style="color:#24292E">. </span><span style="color:#6F42C1">It</span><span style="color:#6F42C1"> does</span><span style="color:#6F42C1"> two</span><span style="color:#6F42C1"> things</span><span style="color:#24292E">. </span><span style="color:#6F42C1">The</span><span style="color:#6F42C1"> first</span><span style="color:#6F42C1"> is</span><span style="color:#6F42C1"> to</span><span style="color:#6F42C1"> set</span><span style="color:#6F42C1"> the</span><span style="color:#6F42C1"> arrow</span><span style="color:#6F42C1"> for</span><span style="color:#6F42C1"> the</span><span style="color:#6F42C1"> current</span><span style="color:#6F42C1"> view</span><span style="color:#24292E"> (</span><span style="color:#6F42C1">with</span><span style="color:#6F42C1"> the</span><span style="color:#6F42C1"> current</span><span style="color:#6F42C1"> field</span><span style="color:#6F42C1"> that</span><span style="color:#6F42C1"> could</span><span style="color:#6F42C1"> have</span><span style="color:#6F42C1"> been</span><span style="color:#6F42C1"> set</span><span style="color:#6F42C1"> by</span><span style="color:#6F42C1"> URL</span><span style="color:#D73A49"> or</span><span style="color:#6F42C1"> by</span><span style="color:#6F42C1"> form</span><span style="color:#24292E">). </span><span style="color:#6F42C1">The</span><span style="color:#6F42C1"> second</span><span style="color:#6F42C1"> thing</span><span style="color:#6F42C1"> is</span><span style="color:#6F42C1"> to</span><span style="color:#6F42C1"> apply</span><span style="color:#6F42C1"> the</span><span style="color:#6F42C1"> FootTable</span><span style="color:#6F42C1"> plugin</span><span style="color:#6F42C1"> to</span><span style="color:#6F42C1"> the</span><span style="color:#6F42C1"> table</span><span style="color:#24292E">.</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#24292E">```</span><span style="color:#6F42C1">typescript</span></span>
<span data-line=""><span style="color:#24292E">$(</span><span style="color:#6F42C1">document</span><span style="color:#24292E">).</span><span style="color:#6F42C1">ready</span><span style="color:#24292E">(</span><span style="color:#6F42C1">function</span><span style="color:#24292E"> () { </span><span style="color:#6F42C1">setArrows</span><span style="color:#24292E">(</span><span style="color:#032F62">&#x27;contests-list&#x27;</span><span style="color:#24292E">); $(</span><span style="color:#032F62">&#x27;#contests-list table&#x27;</span><span style="color:#24292E">).</span><span style="color:#6F42C1">footable</span><span style="color:#24292E">(); }); </span><span style="color:#6A737D">/* * @description: Set the arrows to the column header that is active for sorting */</span><span style="color:#6F42C1"> function</span><span style="color:#6F42C1"> setArrows</span><span style="color:#24292E">(idDivisionThatContainTable) { </span><span style="color:#D73A49">var</span><span style="color:#6F42C1"> dir</span><span style="color:#D73A49"> =</span><span style="color:#24292E"> $(</span><span style="color:#032F62">&#x27;#&#x27;</span><span style="color:#D73A49"> +</span><span style="color:#24292E"> Application.ControldsId.SortId).</span><span style="color:#6F42C1">val</span><span style="color:#24292E">().</span><span style="color:#6F42C1">toUpperCase</span><span style="color:#24292E">(); </span><span style="color:#D73A49">var</span><span style="color:#6F42C1"> col</span><span style="color:#D73A49"> =</span><span style="color:#24292E"> $(</span><span style="color:#032F62">&#x27;#&#x27;</span><span style="color:#D73A49"> +</span><span style="color:#24292E"> Application.ControldsId.ColumnId).</span><span style="color:#6F42C1">val</span><span style="color:#24292E">(); </span><span style="color:#D73A49">var</span><span style="color:#6F42C1"> header</span><span style="color:#D73A49"> =</span><span style="color:#24292E"> $(</span><span style="color:#032F62">&#x27;#&#x27;</span><span style="color:#D73A49">+</span><span style="color:#24292E">idDivisionThatContainTable</span><span style="color:#D73A49">+</span><span style="color:#032F62">&#x27; th a[href*=&#x27;</span><span style="color:#D73A49"> +</span><span style="color:#24292E"> col </span><span style="color:#D73A49">+</span><span style="color:#032F62"> &#x27;]&#x27;</span><span style="color:#24292E">); </span><span style="color:#D73A49">if</span><span style="color:#24292E"> (dir </span><span style="color:#D73A49">===</span><span style="color:#032F62"> &#x27;ASC&#x27;</span><span style="color:#24292E">) { header.</span><span style="color:#6F42C1">text</span><span style="color:#24292E">(header.</span><span style="color:#6F42C1">text</span><span style="color:#24292E">() </span><span style="color:#D73A49">+</span><span style="color:#032F62"> &#x27; ▲&#x27;</span><span style="color:#24292E">); } </span><span style="color:#D73A49">if</span><span style="color:#24292E"> (dir </span><span style="color:#D73A49">===</span><span style="color:#032F62"> &#x27;DESC&#x27;</span><span style="color:#24292E">) { header.</span><span style="color:#6F42C1">text</span><span style="color:#24292E">(header.</span><span style="color:#6F42C1">text</span><span style="color:#24292E">() </span><span style="color:#D73A49">+</span><span style="color:#032F62"> &#x27; ▼&#x27;</span><span style="color:#24292E">); } }; </span></span></code></pre></figure>
<p>As you can see, the method use a Aplication.ControldsId.SortID and ColumnId that is set inside a script tag of the view.</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#fff;color:#24292e" tabindex="0" data-language="html" data-theme="github-light"><code data-language="html" data-theme="github-light" style="display:grid"><span data-line=""><span style="color:#24292E">@section scripts { &lt;</span><span style="color:#22863A">script</span><span style="color:#24292E">&gt; Application.ControldsId.SortId </span><span style="color:#D73A49">=</span><span style="color:#032F62"> &quot;@Html.IdFor(d=&gt;d.sortdir)&quot;</span><span style="color:#24292E">; Application.ControldsId.ColumnId </span><span style="color:#D73A49">=</span><span style="color:#032F62"> &quot;@Html.IdFor(d=&gt;d.sort)&quot;</span><span style="color:#24292E">; &lt;/</span><span style="color:#22863A">script</span><span style="color:#24292E">&gt; &lt;</span><span style="color:#22863A">script</span><span style="color:#6F42C1"> src</span><span style="color:#24292E">=</span><span style="color:#032F62">&quot;~/Scripts/Customs/Views/ContestList.js&quot;</span><span style="color:#24292E">&gt;&lt;/</span><span style="color:#22863A">script</span><span style="color:#24292E">&gt; } </span></span></code></pre></figure>
<p>This could be improved because in a situation of two tables in a page it will not work. However, it would not be the only thing that would not work. The URL parameter is only designed for one grid per page. Nevertheless, this is almost always the case.</p>
<h1>SPRINT 4 : MENU WITH SECURITY AND JOINING CONTEST June 16, 2014 By: pdesjardins</h1>
<p>The Sprint 4 was shorter due to some time restriction. However some good development have been done. The first one concern the menu where it is now possible to display depending of the user role. The first thing to do is to modify the_layout.cshtml file. First, we need to add the @model to specify what we want to get from the controller the entity. This is required because the controller will pass the role of the user logged in the system. Depending of his role, we will adjust the menu. The second thing in the layout partial is that we will pass this model to the partial of the menu.</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#fff;color:#24292e" tabindex="0" data-language="html" data-theme="github-light"><code data-language="html" data-theme="github-light" style="display:grid"><span data-line=""><span style="color:#24292E">@using WebSite.Resources @model object /*This is required to work with the model passed by the controller*/ &lt;!</span><span style="color:#22863A">DOCTYPE</span><span style="color:#6F42C1"> html</span><span style="color:#24292E">&gt; &lt;</span><span style="color:#22863A">html</span><span style="color:#24292E">&gt; &lt;</span><span style="color:#22863A">body</span><span style="color:#24292E">&gt; @Html.Partial(&quot;_Header&quot;, Model) &lt;</span><span style="color:#22863A">div</span><span style="color:#6F42C1"> class</span><span style="color:#24292E">=</span><span style="color:#032F62">&quot;container body-content&quot;</span><span style="color:#24292E">&gt; @RenderBody() &lt;/</span><span style="color:#22863A">div</span><span style="color:#24292E">&gt; &lt;/</span><span style="color:#22863A">body</span><span style="color:#24292E">&gt; &lt;/</span><span style="color:#22863A">html</span><span style="color:#24292E">&gt; </span></span></code></pre></figure>
<p>Having the model set to object allow us to work with every model/view model possible. In the header partial it is possible to compare to an interface. If the view model that we pass from the controller inherit from the interface than we can check the role and proceed. Otherwise, we display nothing. The header partial do several thing and one of them is to parse to IUIPermission and pass this parsed object to the Menu partial.</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#fff;color:#24292e" tabindex="0" data-language="csharp" data-theme="github-light"><code data-language="csharp" data-theme="github-light" style="display:grid"><span data-line=""><span style="color:#D73A49"> var</span><span style="color:#6F42C1"> permission</span><span style="color:#D73A49"> =</span><span style="color:#24292E"> Model </span><span style="color:#D73A49">as</span><span style="color:#6F42C1"> IUIPermission</span><span style="color:#D73A49"> ??</span><span style="color:#D73A49"> new</span><span style="color:#6F42C1"> UIPermission</span><span style="color:#24292E">(); Html.</span><span style="color:#6F42C1">RenderPartial</span><span style="color:#24292E">(</span><span style="color:#032F62">&quot;_Menu&quot;</span><span style="color:#24292E">, permission); </span></span></code></pre></figure>
<p>The IUIPermission allows us to specify roles and check them to display or not elements of the menu.</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#fff;color:#24292e" tabindex="0" data-language="csharp" data-theme="github-light"><code data-language="csharp" data-theme="github-light" style="display:grid"><span data-line=""><span style="color:#D73A49"> public</span><span style="color:#D73A49"> interface</span><span style="color:#6F42C1"> IUIPermission</span><span style="color:#24292E"> { </span><span style="color:#D73A49">bool</span><span style="color:#6F42C1"> IsAdministrator</span><span style="color:#24292E"> { </span><span style="color:#D73A49">get</span><span style="color:#24292E">; </span><span style="color:#D73A49">set</span><span style="color:#24292E">; } </span><span style="color:#D73A49">bool</span><span style="color:#6F42C1"> IsModerator</span><span style="color:#24292E"> { </span><span style="color:#D73A49">get</span><span style="color:#24292E">; </span><span style="color:#D73A49">set</span><span style="color:#24292E">; } } </span></span></code></pre></figure>
<p>Here is an example of the menu:</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#fff;color:#24292e" tabindex="0" data-language="html" data-theme="github-light"><code data-language="html" data-theme="github-light" style="display:grid"><span data-line=""><span style="color:#24292E">&lt;</span><span style="color:#22863A">div</span><span style="color:#6F42C1"> class</span><span style="color:#24292E">=</span><span style="color:#032F62">&quot;navbar-collapse collapse&quot;</span><span style="color:#24292E">&gt; &lt;</span><span style="color:#22863A">ul</span><span style="color:#6F42C1"> class</span><span style="color:#24292E">=</span><span style="color:#032F62">&quot;nav navbar-nav&quot;</span><span style="color:#24292E">&gt; &lt;</span><span style="color:#22863A">li</span><span style="color:#24292E">&gt;@Html.ActionLink(&quot;Home&quot;, &quot;Index&quot;, &quot;Home&quot;)&lt;/</span><span style="color:#22863A">li</span><span style="color:#24292E">&gt; &lt;</span><span style="color:#22863A">li</span><span style="color:#24292E">&gt;@Html.ActionLink(&quot;Contests&quot;, &quot;List&quot;, &quot;UserContest&quot;, new { Area = Constants.Areas.CONTEST }, new { })&lt;/</span><span style="color:#22863A">li</span><span style="color:#24292E">&gt; @if(Model.IsAdministrator || Model.IsModerator) { &lt;</span><span style="color:#22863A">li</span><span style="color:#24292E">&gt; &lt;</span><span style="color:#22863A">a</span><span style="color:#6F42C1"> href</span><span style="color:#24292E">=</span><span style="color:#032F62">&quot;#&quot;</span><span style="color:#24292E">&gt;Moderation&lt;/</span><span style="color:#22863A">a</span><span style="color:#24292E">&gt; &lt;</span><span style="color:#22863A">ul</span><span style="color:#6F42C1"> class</span><span style="color:#24292E">=</span><span style="color:#032F62">&quot;dropdown-menu&quot;</span><span style="color:#24292E">&gt; &lt;</span><span style="color:#22863A">li</span><span style="color:#24292E">&gt;&lt;</span><span style="color:#22863A">a</span><span style="color:#6F42C1"> href</span><span style="color:#24292E">=</span><span style="color:#032F62">&quot;#&quot;</span><span style="color:#24292E">&gt;Split&lt;/</span><span style="color:#22863A">a</span><span style="color:#24292E">&gt;&lt;/</span><span style="color:#22863A">li</span><span style="color:#24292E">&gt; @if (Model.IsAdministrator || Model.IsModerator) { &lt;</span><span style="color:#22863A">li</span><span style="color:#6F42C1"> class</span><span style="color:#24292E">=</span><span style="color:#032F62">&quot;dropdown-header&quot;</span><span style="color:#24292E">&gt;Administrator&lt;/</span><span style="color:#22863A">li</span><span style="color:#24292E">&gt; &lt;</span><span style="color:#22863A">li</span><span style="color:#24292E">&gt;&lt;</span><span style="color:#22863A">a</span><span style="color:#6F42C1"> href</span><span style="color:#24292E">=</span><span style="color:#032F62">&quot;#&quot;</span><span style="color:#24292E">&gt;DashBoard&lt;/</span><span style="color:#22863A">a</span><span style="color:#24292E">&gt;&lt;/</span><span style="color:#22863A">li</span><span style="color:#24292E">&gt; &lt;</span><span style="color:#22863A">li</span><span style="color:#24292E">&gt;&lt;</span><span style="color:#22863A">a</span><span style="color:#6F42C1"> href</span><span style="color:#24292E">=</span><span style="color:#032F62">&quot;#&quot;</span><span style="color:#24292E">&gt;News&lt;/</span><span style="color:#22863A">a</span><span style="color:#24292E">&gt;&lt;/</span><span style="color:#22863A">li</span><span style="color:#24292E">&gt; } &lt;</span><span style="color:#22863A">li</span><span style="color:#24292E">&gt;&lt;</span><span style="color:#22863A">a</span><span style="color:#6F42C1"> href</span><span style="color:#24292E">=</span><span style="color:#032F62">&quot;#&quot;</span><span style="color:#24292E">&gt;Users&lt;/</span><span style="color:#22863A">a</span><span style="color:#24292E">&gt;&lt;/</span><span style="color:#22863A">li</span><span style="color:#24292E">&gt; &lt;/</span><span style="color:#22863A">ul</span><span style="color:#24292E">&gt; &lt;/</span><span style="color:#22863A">li</span><span style="color:#24292E">&gt; } &lt;/</span><span style="color:#22863A">ul</span><span style="color:#24292E">&gt; &lt;/</span><span style="color:#22863A">div</span><span style="color:#24292E">&gt; </span></span></code></pre></figure>
<p>The second big thing that has been done is concerning joining a contest for a user. A page with the description of the contest has been created. Under the description, a button is displayed to join the contest if the user logged is not already subscribed.</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#fff;color:#24292e" tabindex="0" data-language="csharp" data-theme="github-light"><code data-language="csharp" data-theme="github-light" style="display:grid"><span data-line=""><span style="color:#24292E"> [</span><span style="color:#6F42C1">HttpGet</span><span style="color:#24292E">] [</span><span style="color:#6F42C1">Authorize</span><span style="color:#24292E">(</span><span style="color:#6F42C1">Roles</span><span style="color:#D73A49"> =</span><span style="color:#24292E"> ApplicationRole.NORMAL_USER)] </span><span style="color:#D73A49">public</span><span style="color:#6F42C1"> ActionResult</span><span style="color:#6F42C1"> Detail</span><span style="color:#24292E">(</span><span style="color:#D73A49">int</span><span style="color:#6F42C1"> id</span><span style="color:#24292E">) { </span><span style="color:#6A737D">//Get the contest to show it information but also to know if the current user is subscribed to the contest var contestForUser = this.contestService.GetContestByIdWithContesters(id); //Transform back everything for the page var viewContestsForUser = this.MapperFacade.GetViewModel&lt;Model.Entities.Contest.Contest, ContestDetailViewModel&gt;(contestForUser); //View Model viewContestsForUser.IsCurrentUserRegisteredToThisContest = contestForUser.IsUserInContest(new ApplicationUser {Id = this.runningContext.GetUserId().ToString()}); return ViewModel(viewContestsForUser); } </span></span></code></pre></figure>
<p>The line before the return is the one that tell the view model if the user is in the contest or not. As you can see, we get the contest with all contesters. From here, we check if the user is in the list or not. The view change depending of if the user is already in the contest or not.</p>
<p><img src="/images/blog/EnterContest.png" alt=""/></p>
<p>And the view if the user is already in the contest:</p>
<p><img src="/images/blog/JoinButton-1024x678.png" alt=""/></p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#fff;color:#24292e" tabindex="0" data-language="csharp" data-theme="github-light"><code data-language="csharp" data-theme="github-light" style="display:grid"><span data-line=""><span style="color:#24292E"> [</span><span style="color:#6F42C1">HttpPost</span><span style="color:#24292E">] [</span><span style="color:#6F42C1">Authorize</span><span style="color:#24292E">(</span><span style="color:#6F42C1">Roles</span><span style="color:#D73A49"> =</span><span style="color:#24292E"> ApplicationRole.NORMAL_USER)] [</span><span style="color:#6F42C1">ValidateAntiForgeryToken</span><span style="color:#24292E">] </span><span style="color:#D73A49">public</span><span style="color:#6F42C1"> ActionResult</span><span style="color:#6F42C1"> Join</span><span style="color:#24292E">(</span><span style="color:#D73A49">int</span><span style="color:#6F42C1"> id</span><span style="color:#24292E">) { </span><span style="color:#6A737D">//Get the contest information but also the confirmation that the user is not already registered for the contest IEnumerable&lt;ValidationResult&gt; validationsMessage; try { validationsMessage = this.contestService.SaveUserToContest(id, this.runningContext.GetUserId()); } catch (Exception e) { Log.Error(string.Format(&quot;Error during the UserPortefolio Join for contest id {0}&quot;, id), e); return View(&quot;JoinFail&quot;); } if (validationsMessage != null &amp;&amp; validationsMessage.Any()) { Log.Warning(string.Format(&quot;The user {0} is trying to join contest id {1} but has the error &#x27;{2}.&#x27;&quot;, this.runningContext.GetUserId(),id,string.Join(&quot;,&quot;,validationsMessage))); var viewModel = Mapper.Map&lt;IEnumerable&lt;ValidationResult&gt;, GeneralValidationsMessageViewModel&gt;(validationsMessage); return View(&quot;JoinFail&quot;, viewModel); } var contestForUser = this.contestService.GetContestById(id); //Transform back everything for the page var viewContestsForUser = this.MapperFacade.GetViewModel&lt;Model.Entities.Contest.Contest, ContestDetailViewModel&gt;(contestForUser); return ViewModel(viewContestsForUser); } </span></span></code></pre></figure>
<p>Joining a contest require to verify if the user is already subscribed to the contest, if not we join. The controller call the service, which call the accessor.</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#fff;color:#24292e" tabindex="0" data-language="csharp" data-theme="github-light"><code data-language="csharp" data-theme="github-light" style="display:grid"><span data-line=""><span style="color:#D73A49"> public</span><span style="color:#6F42C1"> IEnumerable</span><span style="color:#24292E">&lt;</span><span style="color:#6F42C1">ValidationResult</span><span style="color:#24292E">&gt; </span><span style="color:#6F42C1">SaveUserToContest</span><span style="color:#24292E">(</span><span style="color:#D73A49">int</span><span style="color:#6F42C1"> contestId</span><span style="color:#24292E">, </span><span style="color:#6F42C1">Guid</span><span style="color:#6F42C1"> userId</span><span style="color:#24292E">) { </span><span style="color:#D73A49">var</span><span style="color:#6F42C1"> contest</span><span style="color:#D73A49"> =</span><span style="color:#005CC5"> this</span><span style="color:#24292E">.contestRepository.</span><span style="color:#6F42C1">GetById</span><span style="color:#24292E">(contestId); </span><span style="color:#6A737D">//This is in the accessor because later we could search in Cache if(contest.RegistrationRules.IsDateValidToSubscribeUser) { this.contestRepository.SaveUserToContest(contest, userId); this.unitOfWork.Commit(); } else { return new List&lt;ValidationResult&gt;() {new ValidationResult(Resources.ContestValidationMessage.InvalidDateToSubscribe)}; } return new List&lt;ValidationResult&gt;(); } </span></span></code></pre></figure>
<p>We do a quick validation about if the date is still okay to subscribe. Then, we go in the repository to save everything in the database. The repository verify some other thing like if the user already has a portefolio in this contest.</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#fff;color:#24292e" tabindex="0" data-language="csharp" data-theme="github-light"><code data-language="csharp" data-theme="github-light" style="display:grid"><span data-line=""><span style="color:#D73A49"> public</span><span style="color:#D73A49"> void</span><span style="color:#6F42C1"> SaveUserToContest</span><span style="color:#24292E">(</span><span style="color:#6F42C1">Contest</span><span style="color:#6F42C1"> contest</span><span style="color:#24292E">, </span><span style="color:#6F42C1">Guid</span><span style="color:#6F42C1"> userId</span><span style="color:#24292E">) { </span><span style="color:#D73A49">var</span><span style="color:#6F42C1"> portefolioExist</span><span style="color:#D73A49"> =</span><span style="color:#005CC5"> this</span><span style="color:#24292E">.UnitOfWork.</span><span style="color:#6F42C1">Set</span><span style="color:#24292E">&lt;</span><span style="color:#6F42C1">Portefolio</span><span style="color:#24292E">&gt;() .</span><span style="color:#6F42C1">Include</span><span style="color:#24292E">(</span><span style="color:#6F42C1">d</span><span style="color:#D73A49">=&gt;</span><span style="color:#24292E">d.Owners) .</span><span style="color:#6F42C1">Any</span><span style="color:#24292E">(</span><span style="color:#6F42C1">p</span><span style="color:#D73A49"> =&gt;</span><span style="color:#24292E"> p.ContestId </span><span style="color:#D73A49">==</span><span style="color:#24292E"> contest.Id </span><span style="color:#D73A49">&amp;&amp;</span><span style="color:#24292E"> p.Owners.</span><span style="color:#6F42C1">Any</span><span style="color:#24292E">(</span><span style="color:#6F42C1">d</span><span style="color:#D73A49"> =&gt;</span><span style="color:#24292E"> d.UserId </span><span style="color:#D73A49">==</span><span style="color:#24292E"> userId.</span><span style="color:#6F42C1">ToString</span><span style="color:#24292E">())); </span><span style="color:#D73A49">if</span><span style="color:#24292E"> (portefolioExist) { </span><span style="color:#D73A49">throw</span><span style="color:#D73A49"> new</span><span style="color:#6F42C1"> UserAlreadyInContestException</span><span style="color:#24292E">(</span><span style="color:#D73A49">string</span><span style="color:#24292E">.</span><span style="color:#6F42C1">Format</span><span style="color:#24292E">(Resources.ContestValidationMessage.PortefolioAlreadyCreatedForUserAndContest, contest.Id, userId)); } </span><span style="color:#D73A49">var</span><span style="color:#6F42C1"> portefolio</span><span style="color:#D73A49"> =</span><span style="color:#005CC5"> this</span><span style="color:#24292E">.UnitOfWork.</span><span style="color:#6F42C1">Set</span><span style="color:#24292E">&lt;</span><span style="color:#6F42C1">Portefolio</span><span style="color:#24292E">&gt;().</span><span style="color:#6F42C1">Create</span><span style="color:#24292E">(); </span><span style="color:#005CC5">this</span><span style="color:#24292E">.UnitOfWork.</span><span style="color:#6F42C1">Entry</span><span style="color:#24292E">(portefolio).State </span><span style="color:#D73A49">=</span><span style="color:#24292E"> EntityState.Added; portefolio.</span><span style="color:#6F42C1">ResetFromContest</span><span style="color:#24292E">(contest); </span><span style="color:#6A737D">//Required to set the default values like the initial capital var userPortefolio = new UserPortefolio() {Portefolio = portefolio, PortefolioId = portefolio.Id, UserId = userId.ToString(), DateJoin = this.RunningContext.GetCurrentTime()}; this.Save(userPortefolio); } </span></span></code></pre></figure>
<p>It is also the time where we set to the portefolio the default values from the contest registration rules. This is the case of the initial money for a portefolio.</p>
<p>}</p>
<h1>SPRINT 5 : MODIFYING THE CLASSES ARCHITECTURE July 2, 2014 By: pdesjardins</h1>
<p>To end the month of June, some modification has been made on the classes and layers. Once again, it is to simplify the maintenance. The biggest change is in the business layer. Previously, some classes were present but should not be. It is the same in the Data Access Layer which had some classes about Email. Yes, it is the place to send email but not to store those classes. Now, the Business Layer has all entities and non-entities classes like Email.</p>
<p><img src="/images/blog/BusinessLayerClassesSegregation.png" alt=""/></p>
<p>The second big change in the Sprint 5 was about the introduction of Trading business logic entities like Order, Portefolio, Stock and Transaction.</p>
<p><img src="/images/blog/TradingAndOrderClasses.png" alt=""/></p>
<p>The Order class is abstract and has several class the inherit it like the StockOrder. The StockOrder class is very simple and add only the StockSymbol. It inherits from all other properties.</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#fff;color:#24292e" tabindex="0" data-language="csharp" data-theme="github-light"><code data-language="csharp" data-theme="github-light" style="display:grid"><span data-line=""><span style="color:#D73A49"> public</span><span style="color:#D73A49"> class</span><span style="color:#6F42C1"> StockOrder</span><span style="color:#24292E"> : </span><span style="color:#6F42C1">Order</span><span style="color:#24292E"> { [</span><span style="color:#6F42C1">Required</span><span style="color:#24292E">] </span><span style="color:#D73A49">public</span><span style="color:#D73A49"> string</span><span style="color:#6F42C1"> StockSymbol</span><span style="color:#24292E"> { </span><span style="color:#D73A49">get</span><span style="color:#24292E">; </span><span style="color:#D73A49">set</span><span style="color:#24292E">; } </span><span style="color:#D73A49">public</span><span style="color:#D73A49"> override</span><span style="color:#6F42C1"> IEnumerable</span><span style="color:#24292E">&lt;</span><span style="color:#6F42C1">ValidationResult</span><span style="color:#24292E">&gt; </span><span style="color:#6F42C1">ValidateChildren</span><span style="color:#24292E">() { </span><span style="color:#D73A49">return</span><span style="color:#005CC5"> base</span><span style="color:#24292E">.</span><span style="color:#6F42C1">ValidateChildren</span><span style="color:#24292E">(); } } </span></span></code></pre></figure>
<p>The Order class is interesting for several reasons. First, it uses Value Object design pattern with the collaboration of Entity Framework. Not only it use Value Object but it does use it in three different ways. The first one is with TransactionType. It uses the pattern of having the TransactionTypeId directly into the classes to let Entity Framework save this one without having to attach the whole value object. This also has a performance gain by having the value object class without requiring to include. This is possible with the GetFromId method defined in the base class of the value object (this can be found in my Blog PatrickDesjardins.com/blog). The second way is with the OrderType. This time, it does not require to save anything in the database since it is calculated on the fly by the property getter. The last way value object is used is hidden inside the complex type Money. This one use value object for the currency type but cannot be set with a foreign key since Complex Type cannot have foreign key to any table. The integrity is only done on the code side.</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#fff;color:#24292e" tabindex="0" data-language="csharp" data-theme="github-light"><code data-language="csharp" data-theme="github-light" style="display:grid"><span data-line=""><span style="color:#D73A49"> public</span><span style="color:#D73A49"> abstract</span><span style="color:#D73A49"> class</span><span style="color:#6F42C1"> Order</span><span style="color:#24292E"> : </span><span style="color:#6F42C1">Implementations</span><span style="color:#24292E">.</span><span style="color:#6F42C1">Model</span><span style="color:#24292E"> { </span><span style="color:#D73A49">protected</span><span style="color:#6F42C1"> Order</span><span style="color:#24292E">() { </span><span style="color:#005CC5">this</span><span style="color:#24292E">.Status </span><span style="color:#D73A49">=</span><span style="color:#24292E"> OrderStatusType.Waiting; } [</span><span style="color:#6F42C1">Required</span><span style="color:#24292E">] </span><span style="color:#D73A49">public</span><span style="color:#D73A49"> int</span><span style="color:#6F42C1"> Quantity</span><span style="color:#24292E"> { </span><span style="color:#D73A49">get</span><span style="color:#24292E">; </span><span style="color:#D73A49">set</span><span style="color:#24292E">; } </span><span style="color:#D73A49">public</span><span style="color:#D73A49"> int</span><span style="color:#6F42C1"> TransactionTypeId</span><span style="color:#24292E"> { </span><span style="color:#D73A49">get</span><span style="color:#24292E"> { </span><span style="color:#D73A49">return</span><span style="color:#24292E"> TransactionType.Id; } </span><span style="color:#D73A49">set</span><span style="color:#24292E"> { </span><span style="color:#005CC5">this</span><span style="color:#24292E">.TransactionType </span><span style="color:#D73A49">=</span><span style="color:#24292E"> TransactionType.</span><span style="color:#6F42C1">GetFromId</span><span style="color:#24292E">(value); } } [</span><span style="color:#6F42C1">Required</span><span style="color:#24292E">] </span><span style="color:#D73A49">public</span><span style="color:#6F42C1"> TransactionType</span><span style="color:#6F42C1"> TransactionType</span><span style="color:#24292E"> { </span><span style="color:#D73A49">get</span><span style="color:#24292E">; </span><span style="color:#D73A49">set</span><span style="color:#24292E">; } </span><span style="color:#D73A49">public</span><span style="color:#6F42C1"> OrderType</span><span style="color:#6F42C1"> OrderType</span><span style="color:#24292E"> { </span><span style="color:#D73A49">get</span><span style="color:#24292E"> { </span><span style="color:#D73A49">if</span><span style="color:#24292E"> (PriceStop </span><span style="color:#D73A49">!=</span><span style="color:#005CC5"> null</span><span style="color:#D73A49"> &amp;&amp;</span><span style="color:#24292E"> PriceLimit </span><span style="color:#D73A49">!=</span><span style="color:#005CC5"> null</span><span style="color:#24292E">) </span><span style="color:#D73A49">return</span><span style="color:#24292E"> OrderType.StopLimit; </span><span style="color:#D73A49">if</span><span style="color:#24292E"> (PriceStop </span><span style="color:#D73A49">==</span><span style="color:#005CC5"> null</span><span style="color:#D73A49"> &amp;&amp;</span><span style="color:#24292E"> PriceLimit </span><span style="color:#D73A49">!=</span><span style="color:#005CC5"> null</span><span style="color:#24292E">) </span><span style="color:#D73A49">return</span><span style="color:#24292E"> OrderType.Limit; </span><span style="color:#D73A49">return</span><span style="color:#24292E"> OrderType.Market; } </span><span style="color:#D73A49">set</span><span style="color:#24292E"> { }</span><span style="color:#6A737D">/*This is required for Entity Framework*/</span><span style="color:#24292E"> } </span><span style="color:#D73A49">public</span><span style="color:#6F42C1"> Money</span><span style="color:#6F42C1"> PriceLimit</span><span style="color:#24292E"> { </span><span style="color:#D73A49">get</span><span style="color:#24292E">; </span><span style="color:#D73A49">set</span><span style="color:#24292E">; } </span><span style="color:#D73A49">public</span><span style="color:#6F42C1"> Money</span><span style="color:#6F42C1"> PriceStop</span><span style="color:#24292E"> { </span><span style="color:#D73A49">get</span><span style="color:#24292E">; </span><span style="color:#D73A49">set</span><span style="color:#24292E">; } [</span><span style="color:#6F42C1">Required</span><span style="color:#24292E">] </span><span style="color:#D73A49">public</span><span style="color:#6F42C1"> DateTime</span><span style="color:#6F42C1"> PlacedOrderTime</span><span style="color:#24292E"> { </span><span style="color:#D73A49">get</span><span style="color:#24292E">; </span><span style="color:#D73A49">set</span><span style="color:#24292E">; } [</span><span style="color:#6F42C1">Required</span><span style="color:#24292E">] </span><span style="color:#D73A49">public</span><span style="color:#6F42C1"> DateTime</span><span style="color:#6F42C1"> ExpirationOrderTime</span><span style="color:#24292E"> { </span><span style="color:#D73A49">get</span><span style="color:#24292E">; </span><span style="color:#D73A49">set</span><span style="color:#24292E">; } </span><span style="color:#D73A49">public</span><span style="color:#D73A49"> bool</span><span style="color:#6F42C1"> IsMarketPriceOrder</span><span style="color:#24292E"> { </span><span style="color:#D73A49">get</span><span style="color:#24292E"> { </span><span style="color:#D73A49">return</span><span style="color:#24292E"> PriceLimit </span><span style="color:#D73A49">==</span><span style="color:#005CC5"> null</span><span style="color:#D73A49"> &amp;&amp;</span><span style="color:#24292E"> PriceStop </span><span style="color:#D73A49">==</span><span style="color:#005CC5"> null</span><span style="color:#24292E">; } } </span><span style="color:#D73A49">public</span><span style="color:#6F42C1"> Portefolio</span><span style="color:#6F42C1"> Portefolio</span><span style="color:#24292E"> { </span><span style="color:#D73A49">get</span><span style="color:#24292E">; </span><span style="color:#D73A49">set</span><span style="color:#24292E">; } </span><span style="color:#D73A49">public</span><span style="color:#D73A49"> int</span><span style="color:#6F42C1"> PortefolioId</span><span style="color:#24292E"> { </span><span style="color:#D73A49">get</span><span style="color:#24292E">; </span><span style="color:#D73A49">set</span><span style="color:#24292E">; } </span><span style="color:#D73A49">public</span><span style="color:#6F42C1"> ApplicationUser</span><span style="color:#6F42C1"> UserWhoPlacedTheOrder</span><span style="color:#24292E"> { </span><span style="color:#D73A49">get</span><span style="color:#24292E">; </span><span style="color:#D73A49">set</span><span style="color:#24292E">; } </span><span style="color:#D73A49">public</span><span style="color:#D73A49"> string</span><span style="color:#6F42C1"> UserWhoPlacedTheOrderId</span><span style="color:#24292E"> { </span><span style="color:#D73A49">get</span><span style="color:#24292E">; </span><span style="color:#D73A49">set</span><span style="color:#24292E">; } </span><span style="color:#D73A49">public</span><span style="color:#D73A49"> int</span><span style="color:#6F42C1"> StatusId</span><span style="color:#24292E"> { </span><span style="color:#D73A49">get</span><span style="color:#24292E"> { </span><span style="color:#D73A49">return</span><span style="color:#24292E"> Status.Id; } </span><span style="color:#D73A49">set</span><span style="color:#24292E"> { </span><span style="color:#005CC5">this</span><span style="color:#24292E">.Status </span><span style="color:#D73A49">=</span><span style="color:#24292E"> OrderStatusType.</span><span style="color:#6F42C1">GetFromId</span><span style="color:#24292E">(value); } } </span><span style="color:#D73A49">public</span><span style="color:#6F42C1"> OrderStatusType</span><span style="color:#6F42C1"> Status</span><span style="color:#24292E"> { </span><span style="color:#D73A49">get</span><span style="color:#24292E">; </span><span style="color:#D73A49">set</span><span style="color:#24292E">; } </span><span style="color:#D73A49">public</span><span style="color:#D73A49"> override</span><span style="color:#6F42C1"> IEnumerable</span><span style="color:#24292E">&lt;</span><span style="color:#6F42C1">ValidationResult</span><span style="color:#24292E">&gt; </span><span style="color:#6F42C1">ValidateChildren</span><span style="color:#24292E">() { </span><span style="color:#D73A49">if</span><span style="color:#24292E"> (</span><span style="color:#D73A49">!</span><span style="color:#005CC5">this</span><span style="color:#24292E">.IsMarketPriceOrder) { </span><span style="color:#D73A49">if</span><span style="color:#24292E"> (</span><span style="color:#005CC5">this</span><span style="color:#24292E">.PriceStop </span><span style="color:#D73A49">!=</span><span style="color:#005CC5"> null</span><span style="color:#24292E">) { </span><span style="color:#D73A49">if</span><span style="color:#24292E"> (TransactionType </span><span style="color:#D73A49">==</span><span style="color:#24292E"> TransactionType.Buy) { </span><span style="color:#D73A49">if</span><span style="color:#24292E"> (PriceLimit </span><span style="color:#D73A49">&lt;</span><span style="color:#24292E"> PriceStop) { </span><span style="color:#D73A49">yield</span><span style="color:#D73A49"> return</span><span style="color:#D73A49"> new</span><span style="color:#6F42C1"> ValidationResult</span><span style="color:#24292E">(</span><span style="color:#032F62">&quot;Price Limit must be higher or equal to the price stop&quot;</span><span style="color:#24292E"> , </span><span style="color:#D73A49">new</span><span style="color:#24292E">[] { LambdaHelper.</span><span style="color:#6F42C1">GetPropertyName</span><span style="color:#24292E">&lt;</span><span style="color:#6F42C1">Order</span><span style="color:#24292E">&gt;(</span><span style="color:#6F42C1">d</span><span style="color:#D73A49"> =&gt;</span><span style="color:#24292E"> d.PriceLimit), LambdaHelper.</span><span style="color:#6F42C1">GetPropertyName</span><span style="color:#24292E">&lt;</span><span style="color:#6F42C1">Order</span><span style="color:#24292E">&gt;(</span><span style="color:#6F42C1">d</span><span style="color:#D73A49"> =&gt;</span><span style="color:#24292E"> d.PriceStop)} ); } } </span><span style="color:#D73A49">else</span><span style="color:#D73A49"> if</span><span style="color:#24292E"> (TransactionType </span><span style="color:#D73A49">==</span><span style="color:#24292E"> TransactionType.Sell) { </span><span style="color:#D73A49">if</span><span style="color:#24292E"> (PriceLimit </span><span style="color:#D73A49">&gt;</span><span style="color:#24292E"> PriceStop) { </span><span style="color:#D73A49">yield</span><span style="color:#D73A49"> return</span><span style="color:#D73A49"> new</span><span style="color:#6F42C1"> ValidationResult</span><span style="color:#24292E">(</span><span style="color:#032F62">&quot;Price Limit must be lower or equal to the price stop&quot;</span><span style="color:#24292E"> , </span><span style="color:#D73A49">new</span><span style="color:#24292E">[] { LambdaHelper.</span><span style="color:#6F42C1">GetPropertyName</span><span style="color:#24292E">&lt;</span><span style="color:#6F42C1">Order</span><span style="color:#24292E">&gt;(</span><span style="color:#6F42C1">d</span><span style="color:#D73A49"> =&gt;</span><span style="color:#24292E"> d.PriceLimit), LambdaHelper.</span><span style="color:#6F42C1">GetPropertyName</span><span style="color:#24292E">&lt;</span><span style="color:#6F42C1">Order</span><span style="color:#24292E">&gt;(</span><span style="color:#6F42C1">d</span><span style="color:#D73A49"> =&gt;</span><span style="color:#24292E"> d.PriceStop) }); } } } } } </span><span style="color:#D73A49">public</span><span style="color:#6F42C1"> IEnumerable</span><span style="color:#24292E">&lt;</span><span style="color:#6F42C1">ValidationResult</span><span style="color:#24292E">&gt; </span><span style="color:#6F42C1">ValidateNewOrder</span><span style="color:#24292E">(</span><span style="color:#6F42C1">IRunningContext</span><span style="color:#6F42C1"> runningContext</span><span style="color:#24292E">, </span><span style="color:#D73A49">int</span><span style="color:#6F42C1"> numberDayMaximumForExpirationOrder</span><span style="color:#24292E">) { </span><span style="color:#D73A49">if</span><span style="color:#24292E"> (</span><span style="color:#005CC5">this</span><span style="color:#24292E">.ExpirationOrderTime.</span><span style="color:#6F42C1">Subtract</span><span style="color:#24292E">(runningContext.</span><span style="color:#6F42C1">GetCurrentTime</span><span style="color:#24292E">()).TotalDays </span><span style="color:#D73A49">&gt;</span><span style="color:#24292E"> numberDayMaximumForExpirationOrder) </span><span style="color:#D73A49">yield</span><span style="color:#D73A49"> return</span><span style="color:#D73A49"> new</span><span style="color:#6F42C1"> ValidationResult</span><span style="color:#24292E">(</span><span style="color:#D73A49">string</span><span style="color:#24292E">.</span><span style="color:#6F42C1">Format</span><span style="color:#24292E">(</span><span style="color:#032F62">&quot;You cannot set an order with a ending time above {0}&quot;</span><span style="color:#24292E">, numberDayMaximumForExpirationOrder) , </span><span style="color:#D73A49">new</span><span style="color:#24292E">[] { LambdaHelper.</span><span style="color:#6F42C1">GetPropertyName</span><span style="color:#24292E">&lt;</span><span style="color:#6F42C1">Order</span><span style="color:#24292E">&gt;(</span><span style="color:#6F42C1">d</span><span style="color:#D73A49"> =&gt;</span><span style="color:#24292E"> d.ExpirationOrderTime) }); } } </span></span></code></pre></figure>
<p>The Order class is also interesting because it add some business logic like the validation of a new order that can be called when the order is created. This is used by the new class Portefolio. The Portefolio class is used in the OrderService class when we record a new order into a portefolio. The order is pass to the portefolio to be added, and this one validate if it is possible to add. A lot of business logic is done here to know if the order is fine or not. The Order Service looks so far like that for the validation:</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#fff;color:#24292e" tabindex="0" data-language="csharp" data-theme="github-light"><code data-language="csharp" data-theme="github-light" style="display:grid"><span data-line=""><span style="color:#D73A49"> public</span><span style="color:#6F42C1"> IEnumerable</span><span style="color:#24292E">&lt;</span><span style="color:#6F42C1">ValidationResult</span><span style="color:#24292E">&gt; </span><span style="color:#6F42C1">RecordOrder</span><span style="color:#24292E">(</span><span style="color:#6F42C1">StockOrder</span><span style="color:#6F42C1"> order</span><span style="color:#24292E">) { </span><span style="color:#D73A49">var</span><span style="color:#6F42C1"> validationsToReturn</span><span style="color:#D73A49"> =</span><span style="color:#D73A49"> new</span><span style="color:#6F42C1"> List</span><span style="color:#24292E">&lt;</span><span style="color:#6F42C1">ValidationResult</span><span style="color:#24292E">&gt;(); </span><span style="color:#6A737D">//1- Current contest from the portefolio //2- Verify that the contest can execute this order (validations for contest/order) var portefolio = this.portefolioAccessor.GetById(order.PortefolioId); IEnumerable&lt;ValidationResult&gt; validationContests = portefolio.ValidateOrder(order, this.runningContext, this.quoteProvider); if (validationContests.Any()) { return validationContests; } //3- Validate the order var validations = order.Validate(); if (validations.Any()) { return validationsToReturn; } //4- Record the order in the order queue to be executed at the proper time var validationsOnSave = this.orderAccessor.RecordOrder(order); validationsToReturn = validationsToReturn.Concat(validationsOnSave).ToList(); //5- Display any feedback from the RecordOrder operation return validationsToReturn; } </span></span></code></pre></figure>
<p>The interesting part is the one the validate the order from the portefolio. The code below is not yet done but it shows that some validation are done. At some point, the validation does not concern the portefolio rules but the order. This is why this method call the Order.ValidateNewOrder.</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#fff;color:#24292e" tabindex="0" data-language="csharp" data-theme="github-light"><code data-language="csharp" data-theme="github-light" style="display:grid"><span data-line=""><span style="color:#D73A49"> public</span><span style="color:#6F42C1"> IEnumerable</span><span style="color:#24292E">&lt;</span><span style="color:#6F42C1">ValidationResult</span><span style="color:#24292E">&gt; </span><span style="color:#6F42C1">ValidateOrder</span><span style="color:#24292E">(</span><span style="color:#6F42C1">StockOrder</span><span style="color:#6F42C1"> order</span><span style="color:#24292E">, </span><span style="color:#6F42C1">IRunningContext</span><span style="color:#6F42C1"> runningContext</span><span style="color:#24292E">, </span><span style="color:#6F42C1">IQuoteProvider</span><span style="color:#6F42C1"> quoteProvider</span><span style="color:#24292E">) { </span><span style="color:#D73A49">if</span><span style="color:#24292E"> (</span><span style="color:#D73A49">!</span><span style="color:#005CC5">this</span><span style="color:#24292E">.Contest.ContestOrderType.</span><span style="color:#6F42C1">Accept</span><span style="color:#24292E">(order.OrderType)) </span><span style="color:#D73A49">yield</span><span style="color:#D73A49"> return</span><span style="color:#D73A49"> new</span><span style="color:#6F42C1"> ValidationResult</span><span style="color:#24292E">(</span><span style="color:#032F62">&quot;Order is not valid for the current contest&quot;</span><span style="color:#24292E">, </span><span style="color:#D73A49">new</span><span style="color:#24292E">[]{LambdaHelper.</span><span style="color:#6F42C1">GetPropertyName</span><span style="color:#24292E">&lt;</span><span style="color:#6F42C1">StockOrder</span><span style="color:#24292E">&gt;(</span><span style="color:#6F42C1">d</span><span style="color:#D73A49">=&gt;</span><span style="color:#24292E">d.OrderType)}); </span><span style="color:#D73A49">if</span><span style="color:#24292E">((order.OrderType </span><span style="color:#D73A49">==</span><span style="color:#24292E"> OrderType.Limit </span><span style="color:#D73A49">||</span><span style="color:#24292E"> order.OrderType </span><span style="color:#D73A49">==</span><span style="color:#24292E"> OrderType.StopLimit) </span><span style="color:#D73A49">&amp;&amp;</span><span style="color:#005CC5"> this</span><span style="color:#24292E">.NumberOfActiveOrder</span><span style="color:#D73A49">&gt;=</span><span style="color:#005CC5">this</span><span style="color:#24292E">.Contest.TransactionRules.MaximumLimitOrderSameTime) </span><span style="color:#D73A49">yield</span><span style="color:#D73A49"> return</span><span style="color:#D73A49"> new</span><span style="color:#6F42C1"> ValidationResult</span><span style="color:#24292E">(</span><span style="color:#032F62">&quot;The maximum number of order has been reached.&quot;</span><span style="color:#24292E">, </span><span style="color:#D73A49">new</span><span style="color:#24292E">[] { LambdaHelper.</span><span style="color:#6F42C1">GetPropertyName</span><span style="color:#24292E">&lt;</span><span style="color:#6F42C1">Portefolio</span><span style="color:#24292E">&gt;(</span><span style="color:#6F42C1">d</span><span style="color:#D73A49"> =&gt;</span><span style="color:#24292E"> d.NumberOfActiveOrder) }); </span><span style="color:#D73A49">var</span><span style="color:#6F42C1"> numberDayMaximumForExpirationOrder</span><span style="color:#D73A49"> =</span><span style="color:#005CC5"> 7</span><span style="color:#24292E">;</span><span style="color:#6A737D">//ToDo var orderValidations = order.ValidateNewOrder(runningContext, numberDayMaximumForExpirationOrder); foreach (var validationResult in orderValidations) { yield return validationResult; } if (!this.Contest.TransactionRules.IsInOrderTimeFrame(runningContext.GetCurrentTime())) { yield return new ValidationResult(string.Format(&quot;Order must be set between {0} and {1}&quot; , this.Contest.TransactionRules.OrderStartingTime , this.Contest.TransactionRules.OrderEndingTime) , new[] {LambdaHelper.GetPropertyName&lt;Portefolio&gt;(d =&gt; d.Contest.TransactionRules)}); } var stockValidations = quoteProvider.GetValidation().Validate(order.StockSymbol); foreach (var validationResult in stockValidations) { var newValidationWithMembers = new ValidationResult(validationResult.ErrorMessage, new[] {LambdaHelper.GetPropertyName&lt;StockOrder&gt;(d =&gt; d.StockSymbol)}); yield return newValidationWithMembers; } } </span></span></code></pre></figure>
<p>Not only it calls the Order validation but it also validate the Stock Symbol. This is interesting because it use the QuoteProvider. This allow us to change the stock provider from any provider like Yahoo to Google without having to change a lot of logic. It implements the strategy pattern.</p>
<p>Additional information about the Strategy Pattern and the Quote Provider will be provided in a later article.</p>
<h1>MOVING FROM IIS EXPRESS TO IIS AND SQL SERVER August 18, 2014 By: pdesjardins</h1>
<p>Moving from IIS Express to IIS was a natural decision for many reasons like not having to launch IIS Express for the Web Service every time we wanted to run the web site. This way, the Web API Service can always run until modification is required. It has not been as a simple switch to IIS by creation new website under IIS. This require to have some change. First, we were using localdb. We could continue to use localdb but it would have require us to change the credential of the running Application Pool to use my credential. The reason is that localdb is under the user profile. The best solution at this point is to run the database inside a real Sql Server.</p>
<p>Cannot get a local application data path. Most probably a user profile is not loaded. If LocalDB is executed under IIS, make sure that profile loading is enabled for the current user. Next warning that you will get is that the Application Pool does not have access to the database.</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#fff;color:#24292e" tabindex="0" data-language="plaintext" data-theme="github-light"><code data-language="plaintext" data-theme="github-light" style="display:grid"><span data-line=""><span> Process information: Process ID: 7732 Process name: w3wp.exe Account name: IIS APPPOOL\\BourseVirtuelle Exception information: Exception type: SqlException Exception message: The SELECT permission was denied on the object ‘AspNetUserLogins’, database ‘BourseVirtuelle’, schema ‘dbo’. at System.Data.SqlClient.SqlCommand.b__24(Task`1 result) at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke() at System.Threading.Tasks.Task.Execute() This can be done by going into Microsoft Sql Server Manager, under Security, Logins and add entries for all your Application Pool. For example, here is the application pool that I created. </span></span></code></pre></figure>
<p><img src="/images/blog/ApplicationPoolIdentity.png" alt=""/></p>
<p>You need to have the user name with the IIS APPPOOl\ in front of your Application Pool name. You have also to keep Windows Authentification checked.</p>
<p><img src="/images/blog/LoginProperties-1024x581.png" alt=""/></p>
<p>The last step is to give the user access to the Database. You have give the account enough role to be able to run you application.</p>
<p><img src="/images/blog/UserMapping.png" alt=""/></p>
<p>The last error that you can have is something about the creation of table. I had this error when migrating this website with the Identity framework when trying to get the user in the authentication window.</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#fff;color:#24292e" tabindex="0" data-language="plaintext" data-theme="github-light"><code data-language="plaintext" data-theme="github-light" style="display:grid"><span data-line=""><span> Exception information: Exception type: SqlException Exception message: CREATE TABLE permission denied in database ‘BourseVirtuelle’. at System.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction) at System.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose) </span></span></code></pre></figure>
<p>The solution was to set the default initializer to null</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#fff;color:#24292e" tabindex="0" data-language="csharp" data-theme="github-light"><code data-language="csharp" data-theme="github-light" style="display:grid"><span data-line=""><span style="color:#D73A49"> public</span><span style="color:#6F42C1"> MainDbContext</span><span style="color:#24292E">(IRunningContext runningContext) </span><span style="color:#D73A49">:</span><span style="color:#005CC5"> this</span><span style="color:#24292E">() { Database.</span><span style="color:#6F42C1">SetInitializer</span><span style="color:#24292E">&lt;</span><span style="color:#6F42C1">MainDbContext</span><span style="color:#24292E">&gt;(</span><span style="color:#005CC5">null</span><span style="color:#24292E">); </span><span style="color:#6A737D">//No initialization ConfigurationContext(runningContext); } </span></span></code></pre></figure></div></main><div class="layout_paginationBar__jnuuR"><div class="layout_paginationTitle__PsOw5">Chronological Blog Articles by Page</div><div class="layout_paginationLinks__LdBaH"><a class="" href="/blog/page/1">1</a><a class="" href="/blog/page/2">2</a><a class="" href="/blog/page/3">3</a><a class="" href="/blog/page/4">4</a><a class="" href="/blog/page/5">5</a><a class="" href="/blog/page/6">6</a><a class="" href="/blog/page/7">7</a><a class="" href="/blog/page/8">8</a><a class="" href="/blog/page/9">9</a><a class="" href="/blog/page/10">10</a><a class="" href="/blog/page/11">11</a><a class="" href="/blog/page/12">12</a><a class="" href="/blog/page/13">13</a><a class="" href="/blog/page/14">14</a><a class="" href="/blog/page/15">15</a><a class="" href="/blog/page/16">16</a><a class="" href="/blog/page/17">17</a><a class="" href="/blog/page/18">18</a><a class="" href="/blog/page/19">19</a><a class="" href="/blog/page/20">20</a><a class="" href="/blog/page/21">21</a><a class="" href="/blog/page/22">22</a><a class="" href="/blog/page/23">23</a><a class="" href="/blog/page/24">24</a><a class="" href="/blog/page/25">25</a><a class="" href="/blog/page/26">26</a><a class="" href="/blog/page/27">27</a><a class="" href="/blog/page/28">28</a><a class="" href="/blog/page/29">29</a><a class="" href="/blog/page/30">30</a><a class="" href="/blog/page/31">31</a><a class="" href="/blog/page/32">32</a><a class="" href="/blog/page/33">33</a><a class="" href="/blog/page/34">34</a><a class="" href="/blog/page/35">35</a><a class="" href="/blog/page/36">36</a><a class="" href="/blog/page/37">37</a><a class="" href="/blog/page/38">38</a><a class="" href="/blog/page/39">39</a><a class="" href="/blog/page/40">40</a><a class="" href="/blog/page/41">41</a><a class="" href="/blog/page/42">42</a><a class="" href="/blog/page/43">43</a><a class="" href="/blog/page/44">44</a><a class="" href="/blog/page/45">45</a><a class="" href="/blog/page/46">46</a><a class="" href="/blog/page/47">47</a><a class="" href="/blog/page/48">48</a><a class="" href="/blog/page/49">49</a><a class="" href="/blog/page/50">50</a><a class="" href="/blog/page/51">51</a><a class="" href="/blog/page/52">52</a><a class="" href="/blog/page/53">53</a><a class="" href="/blog/page/54">54</a><a class="" href="/blog/page/55">55</a><a class="" href="/blog/page/56">56</a><a class="" href="/blog/page/57">57</a><a class="" href="/blog/page/58">58</a><a class="" href="/blog/page/59">59</a><a class="" href="/blog/page/60">60</a><a class="" href="/blog/page/61">61</a><a class="" href="/blog/page/62">62</a><a class="" href="/blog/page/63">63</a><a class="" href="/blog/page/64">64</a><a class="" href="/blog/page/65">65</a><a class="" href="/blog/page/66">66</a><a class="" href="/blog/page/67">67</a><a class="" href="/blog/page/68">68</a><a class="" href="/blog/page/69">69</a><a class="" href="/blog/page/70">70</a><a class="" href="/blog/page/71">71</a><a class="" href="/blog/page/72">72</a><a class="" href="/blog/page/73">73</a><a class="" href="/blog/page/74">74</a><a class="" href="/blog/page/75">75</a><a class="" href="/blog/page/76">76</a><a class="" href="/blog/page/77">77</a></div></div></div></div><script src="/_next/static/chunks/webpack-c95d176287d2fe2d.js" crossorigin="" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0]);self.__next_f.push([2,null])</script><script>self.__next_f.push([1,"1:HL[\"/_next/static/css/4f3d065c9e2d01e0.css\",\"style\",{\"crossOrigin\":\"\"}]\n0:\"$L2\"\n"])</script><script>self.__next_f.push([1,"3:HL[\"/_next/static/media/c9a5bc6a7c948fb0-s.p.woff2\",\"font\",{\"crossOrigin\":\"\",\"type\":\"font/woff2\"}]\n4:HL[\"/_next/static/css/67b0a31e2d30ff16.css\",\"style\",{\"crossOrigin\":\"\"}]\n"])</script><script>self.__next_f.push([1,"5:I[7690,[],\"\"]\n8:I[5613,[],\"\"]\na:I[1778,[],\"\"]\nb:I[5250,[\"250\",\"static/chunks/250-d7e0a94ebe194dac.js\",\"79\",\"static/chunks/79-2d03397107aae3f1.js\",\"308\",\"static/chunks/app/blog/%5Bslug%5D/page-0cf4a8a9432ed6ce.js\"],\"\"]\nd:I[8955,[],\"\"]\n9:[\"slug\",\"asp-net-mvc-project-sql-server-redis-and-managed-with-vsts\",\"d\"]\ne:[]\n"])</script><script>self.__next_f.push([1,"2:[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/4f3d065c9e2d01e0.css\",\"precedence\":\"next\",\"crossOrigin\":\"\"}]],[\"$\",\"$L5\",null,{\"buildId\":\"ElOrBJ_xhnYIVNTz4dgO9\",\"assetPrefix\":\"\",\"initialCanonicalUrl\":\"/blog/asp-net-mvc-project-sql-server-redis-and-managed-with-vsts\",\"initialTree\":[\"\",{\"children\":[\"blog\",{\"children\":[[\"slug\",\"asp-net-mvc-project-sql-server-redis-and-managed-with-vsts\",\"d\"],{\"children\":[\"__PAGE__?{\\\"slug\\\":\\\"asp-net-mvc-project-sql-server-redis-and-managed-with-vsts\\\"}\",{}]}]}]},\"$undefined\",\"$undefined\",true],\"initialSeedData\":[\"\",{\"children\":[\"blog\",{\"children\":[[\"slug\",\"asp-net-mvc-project-sql-server-redis-and-managed-with-vsts\",\"d\"],{\"children\":[\"__PAGE__\",{},[\"$L6\",\"$L7\",null]]},[\"$\",\"$L8\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"blog\",\"children\",\"$9\",\"children\"],\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"loadingScripts\":\"$undefined\",\"hasLoading\":false,\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$La\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\",\"styles\":[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/67b0a31e2d30ff16.css\",\"precedence\":\"next\",\"crossOrigin\":\"\"}]]}]]},[\"$\",\"$L8\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"blog\",\"children\"],\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"loadingScripts\":\"$undefined\",\"hasLoading\":false,\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$La\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\",\"styles\":null}]]},[null,[\"$\",\"html\",null,{\"lang\":\"en\",\"children\":[\"$\",\"body\",null,{\"className\":\"layout_bodystyle__4ncsS\",\"children\":[\"$\",\"$L8\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\"],\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"loadingScripts\":\"$undefined\",\"hasLoading\":false,\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$La\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[\"$\",\"div\",null,{\"style\":{\"display\":\"flex\",\"alignItems\":\"center\",\"justifyContent\":\"center\",\"height\":\"100vh\"},\"children\":[\"$\",\"div\",null,{\"style\":{\"width\":\"50%\",\"height\":\"20%\",\"backgroundColor\":\"#ffeded\",\"borderRadius\":12,\"padding\":12,\"textAlign\":\"center\"},\"children\":[[\"$\",\"h1\",null,{\"children\":\"Not Found\"}],[\"$\",\"p\",null,{\"children\":\"Could not find requested resource\"}],[\"$\",\"$Lb\",null,{\"href\":\"/\",\"children\":\"Return Home\"}]]}]}],\"notFoundStyles\":[],\"styles\":null}]}]}],null]],\"initialHead\":[false,\"$Lc\"],\"globalErrorComponent\":\"$d\",\"missingSlots\":\"$We\"}]]\n"])</script><script>self.__next_f.push([1,"f:I[1749,[\"250\",\"static/chunks/250-d7e0a94ebe194dac.js\",\"79\",\"static/chunks/79-2d03397107aae3f1.js\",\"308\",\"static/chunks/app/blog/%5Bslug%5D/page-0cf4a8a9432ed6ce.js\"],\"Image\"]\nc:[[\"$\",\"meta\",\"0\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}],[\"$\",\"meta\",\"1\",{\"charSet\":\"utf-8\"}],[\"$\",\"title\",\"2\",{\"children\":\"Patrick Desjardins Blog - Asp.Net MVC Project, SQL Server, Redis and managed with VSTS\"}],[\"$\",\"meta\",\"3\",{\"name\":\"description\",\"content\":\"Asp.Net MVC Project, SQL Server, Redis an"])</script><script>self.__next_f.push([1,"d managed with VSTS\"}],[\"$\",\"meta\",\"4\",{\"name\":\"next-size-adjust\"}]]\n6:null\n10:T440,"])</script><script>self.__next_f.push([1,". The initial project started in 2004 and got released in 2005. From there, features got added, some removed. Technologies changed from not having Jquery to a transition with mostly only using it. The backend was done in MySql and MemCached on a Linux VPS. I have learned a lot and while the website is still running, around 2008 I was less interested into it. Mostly because with Asp.Net MVC I was able to have more control hover the Html than the traditional Asp.Net Webform, I loved Microsoft's tool and I was working in the Microsoft ecosystem professionally. This side project always was a playground to try new things, experiment on technologies and patterns and I wanted to try more stuff on my own with the .Net environment. The PHP project started to feel older, adding feature was more and more problematic due to the lack of automation. Unit tests were introduced in the last month of 2008, new features added around 2010 got some but never had anything automated. While I am glad to got that experience, I was ready to work on something else without killing the whole project."])</script><script>self.__next_f.push([1,"11:T131c,"])</script><script>self.__next_f.push([1,"//Division of the row var mainRow = new TagBuilder(Constants.DIV); mainRow.AddCssClass(Constants.Css.ROW); #region Main Label //The main column that divide the first property label from the other contains that will have label+input var mainLabelContainer = new TagBuilder(Constants.DIV); mainLabelContainer.AddCssClass(Constants.Css.COL_XS12); mainLabelContainer.AddCssClass(Constants.Css.COL_SM2); //Mark the required field on the first label var mainLabelAttributes = new Dictionary\u003cstring, object\u003e { { Constants.CLASS, string.Concat(Constants.Css.CONTROL_LABEL, Constants.DELIMITER_CLASS, Constants.Css.COL_SM12) } }; if (mainPropertyMetaData.IsRequired) { mainLabelAttributes[Constants.CLASS] += string.Concat(Constants.DELIMITER_CLASS, Constants.Css.REQUIRED); } var mainLabel = htmlHelper.LabelFor(mainPropertyExpression, mainLabelAttributes); //Main Label Group. Required to have the same spacing of other FormGroup helper var mainLabelGroup = new TagBuilder(Constants.DIV); mainLabelGroup.AddCssClass(Constants.Css.FORM_GROUP); mainLabelGroup.InnerHtml = mainLabel.ToString(); mainLabelContainer.InnerHtml = mainLabelGroup.ToString(); mainRow.InnerHtml = mainLabelContainer.ToString(); #endregion #region SubProperties //Division for the sub properties var secondaryContainer = new TagBuilder(Constants.DIV); secondaryContainer.AddCssClass(Constants.Css.COL_XS12); secondaryContainer.AddCssClass(Constants.Css.COL_SM10); foreach (var expression in expressions) { //For each sub property specified in the PARAMS we set a group that has a label + input var secondaryFormGroup = new TagBuilder(Constants.DIV); //The label secondaryFormGroup.AddCssClass(Constants.Css.FORM_GROUP); var secondaryLabelAttributes = new Dictionary\u003cstring, object\u003e { { Constants.CLASS, string.Concat(Constants.Css.CONTROL_LABEL, Constants.DELIMITER_CLASS, Constants.Css.COL_SM2) } }; var labelSecondaryContainer = htmlHelper.LabelFor(expression,secondaryLabelAttributes); //The input var containerForSecondaryContainer = new TagBuilder(Constants.DIV); containerForSecondaryContainer.AddCssClass(Constants.Css.COL_SM10); var controlForSecondaryContainer = htmlHelper.EditorFor(expression, new { htmlAttributes = new { @class = Constants.Css.FORM_CONTROL } }); containerForSecondaryContainer.InnerHtml = controlForSecondaryContainer.ToString(); var validationMessageForSecondaryControl = htmlHelper.ValidationMessageFor(expression); containerForSecondaryContainer.InnerHtml += validationMessageForSecondaryControl.ToString(); secondaryFormGroup.InnerHtml = labelSecondaryContainer + containerForSecondaryContainer.ToString(); secondaryContainer.InnerHtml += secondaryFormGroup.ToString(); } #endregion mainRow.InnerHtml += secondaryContainer.ToString(); return new MvcHtmlString(mainRow.ToString()); } public MvcHtmlString FormGroupFor\u003cTProperty\u003e(Expression\u003cFunc\u003cTModel, TProperty\u003e\u003e mainPropertyExpression) { var mainPropertyMetaData = ModelMetadata.FromLambdaExpression(mainPropertyExpression, htmlHelper.ViewData); //Division for the row var mainRow = new TagBuilder(Constants.DIV); mainRow.AddCssClass(Constants.Css.ROW); //Division for the column inside the row var mainContainer = new TagBuilder(Constants.DIV); mainContainer.AddCssClass(Constants.Css.COL_XS12); //Division that contains the Label + control var formContainer = new TagBuilder(Constants.DIV); formContainer.AddCssClass(Constants.Css.FORM_GROUP); //The Label with required class if the field is required from the [Required] attribute var mainLabelAttributes = new Dictionary\u003cstring, object\u003e { { Constants.CLASS, string.Concat(Constants.Css.CONTROL_LABEL, Constants.DELIMITER_CLASS, Constants.Css.COL_SM2) } }; if (mainPropertyMetaData.IsRequired) { mainLabelAttributes[Constants.CLASS] += string.Concat(Constants.DELIMITER_CLASS, Constants.Css.REQUIRED); } var mainLabel = htmlHelper.LabelFor(mainPropertyExpression, mainLabelAttributes); //The control is inside a Division to allow the label to be at the left when the screen is \u003e= small var controlContainer = new TagBuilder(Constants.DIV); controlContainer.AddCssClass(Constants.Css.COL_SM10); //Row inside the control var rowInside = new TagBuilder(Constants.DIV); rowInside.AddCssClass(Constants.Css.ROW); //Column inside the control var columnInsideRowInside = new TagBuilder(Constants.DIV); columnInsideRowInside.AddCssClass(Constants.Css.COL_XS12); columnInsideRowInside.AddCssClass(Constants.Css.OFFSET_XS2); //Main Control var mainControl = htmlHelper.EditorFor(mainPropertyExpression); //Add everything columnInsideRowInside.InnerHtml = mainControl.ToString(); rowInside.InnerHtml = columnInsideRowInside.ToString(); controlContainer.InnerHtml = rowInside.ToString(); formContainer.InnerHtml = mainLabel.ToString() + controlContainer; mainContainer.InnerHtml = formContainer.ToString(); mainRow.InnerHtml = mainContainer.ToString(); return new MvcHtmlString(mainRow.ToString()); } "])</script><script>self.__next_f.push([1,"12:T4b0,"])</script><script>self.__next_f.push([1,"// Arrange var contest = new ContestRegistrationRules { StartingTime = new DateTime(2021, 01, 01) ,EndingTime = new DateTime(2023, 01, 01) ,RegistrationStartingTime = new DateTime(1950, 01, 01) ,RegistrationEndingTime = new DateTime(2021, 01, 01) ,MaximumReputationForRegistration = 0 }; // Act var validationResults = contest.Validate(); var validationResult = validationResults.SelectMany(d =\u003e d.MemberNames); // Assert Assert.AreEqual(1, validationResults.Count()); Assert.IsTrue(validationResult.Contains(LambdaHelper.GetPropertyName(d =\u003e d.RegistrationStartingTime))); } [TestMethod] public void GivenAnExistingContestWithRegistration_WhenContestRegistrationStartingTimeIsBeforeNow_ThenReturnNoValidationResult() { // Arrange var state = new Mock(); state.Setup(d =\u003e d.IsNew()).Returns(false); var contest = new ContestRegistrationRules(state.Object) { StartingTime = new DateTime(2021, 01, 01) ,EndingTime = new DateTime(2023, 01, 01) ,RegistrationStartingTime = new DateTime(1950, 01, 01) ,RegistrationEndingTime = new DateTime(2021, 01, 01) ,MaximumReputationForRegistration = 0 }; // Act var validationResults = contest.Validate(); // Assert Assert.AreEqual(0, validationResults.Count()); } "])</script><script>self.__next_f.push([1,"13:T507,"])</script><script>self.__next_f.push([1," /// /// Validate the the date with the attribute is after the current date or the current date /// [AttributeUsage(AttributeTargets.Property, AllowMultiple = true)] public class DateAfterOrCurrentDate : BaseDataAnnotation { protected override ValidationResult IsValid(object value, ValidationContext validationContext) { var model = validationContext.ObjectInstance as IModelState; if (model == null || !model.IsNew()) { return ValidationResult.Success; } if (value != null) { DateTime valueConverted; if (DateTime.TryParse(value.ToString(), out valueConverted)) { if (IsAfterCurrent(valueConverted)) { return ValidationResult.Success; } } } return base.ReturnDefaultErrorMessage(string.Format(Resources.DataAnnotationErrorMessage.DateAfterOrCurrentDate, validationContext.DisplayName) , new[] { validationContext.MemberName }); } /// /// This method is virtual for the purpose of unit testing. It it possible to override to mock a true or false without /// having to play with date /// /// /// protected virtual bool IsAfterCurrent(DateTime dateTime) { return dateTime.Date \u003e= DateTime.UtcNow.Date; } /// /// To have multiple attributes of the same type to be validated /// private readonly object typeId = new object(); public override object TypeId { get { return this.typeId; } } } "])</script><script>self.__next_f.push([1,"14:T56c,"])</script><script>self.__next_f.push([1,"//It uses the same name of the web.config but from the app.config of the IntegrationTest protected IUnitOfWork unitOfWorkForInsertion; protected IUnitOfWork unitOfWorkForUpdate; protected IUnitOfWork unitOfWorkForReading; private IMainDbContext dbInsertDbContext; private IMainDbContext dbUpdateDbContext; private IMainDbContext dbReadingDbContext; protected Mock\u003cIRunningContext\u003e runningContext; private TransactionScope transaction; protected ContestModelBuilder contestModelBuilder; [TestInitialize] public void InitializeBetweenTest() { this.transaction = new TransactionScope(); runningContext = new Mock\u003cIRunningContext\u003e(); runningContext.Setup(d =\u003e d.GetCurrentTime()).Returns(new DateTime(2014, 03, 02)); runningContext.Setup(d =\u003e d.GetUserId()).Returns(ApplicationUser.SYSTEM_TEST_USER_ID); contestModelBuilder = new ContestModelBuilder(runningContext.Object); dbReadingDbContext = new MainDbContext(runningContext.Object, CONNECTION_STRING_NAME); dbInsertDbContext = new MainDbContext(runningContext.Object, CONNECTION_STRING_NAME); dbUpdateDbContext = new MainDbContext(runningContext.Object, CONNECTION_STRING_NAME); unitOfWorkForReading = new UnitOfWork(dbReadingDbContext); unitOfWorkForInsertion = new UnitOfWork(dbInsertDbContext); unitOfWorkForUpdate = new UnitOfWork(dbUpdateDbContext); } [TestCleanup] public void CleanUpBetweenTest() { this.transaction.Dispose(); } } "])</script><script>self.__next_f.push([1,"15:T7bb,"])</script><script>self.__next_f.push([1,"//Assert Assert.AreEqual(\"DescriptionFrancais\", Mapper.Engine.ConfigurationProvider.GetMappedPropertyName\u003cSource, Target\u003e(\"Description.Francais\")); Assert.AreEqual(\"DescriptionAnglais\", Mapper.Engine.ConfigurationProvider.GetMappedPropertyName\u003cSource, Target\u003e(\"Description.Anglais\")); Assert.AreEqual(\"TitleFrancais\", Mapper.Engine.ConfigurationProvider.GetMappedPropertyName\u003cSource, Target\u003e(\"Title.Francais\")); Assert.AreEqual(\"TitleAnglais\", Mapper.Engine.ConfigurationProvider.GetMappedPropertyName\u003cSource, Target\u003e(\"Title.Anglais\")); Assert.AreEqual(\"TargetSourceSubClassFrancais\", Mapper.Engine.ConfigurationProvider.GetMappedPropertyName\u003cSource, Target\u003e(\"SourceSubClass.SubDescription.Francais\")); Assert.AreEqual(\"TargetSourceSubClassAnglais\", Mapper.Engine.ConfigurationProvider.GetMappedPropertyName\u003cSource, Target\u003e(\"SourceSubClass.SubDescription.Anglais\")); Assert.AreEqual(\"Description.FrancaisVM\", Mapper.Engine.ConfigurationProvider.GetMappedPropertyName\u003cSource, TargetWithSub\u003e(\"Description.Francais\")); //CRASH HERE } internal class Source { public LocalizedString Description { get; set; } public LocalizedString Title { get; set; } public SourceSubClass SourceSubClass { get; set; } } internal class SourceSubClass { public LocalizedString SubDescription { get; set; } } internal class LocalizedString { public string Francais { get; set; } public string Anglais { get; set; } } internal class Target { public string DescriptionFrancais { get; set; } public string DescriptionAnglais { get; set; } public string TitleFrancais { get; set; } public string TitleAnglais { get; set; } public string TargetSourceSubClassFrancais { get; set; } public string TargetSourceSubClassAnglais { get; set; } } internal class LocalizedStringViewModel { public string FrancaisVM { get; set; } public string AnglaisVM { get; set; } } internal class TargetWithSub { public LocalizedStringViewModel Description { get; set; } public LocalizedStringViewModel Title { get; set; } } } } "])</script><script>self.__next_f.push([1,"16:T936,"])</script><script>self.__next_f.push([1,"//Analyse the first property name of the list. The list can have only one property if this one is at the end of a complex mapping or if it is a direct property var sourcePropertyName = sourcePropertyNames.First(); //Get all mappings that has the source and destination of the desired type. var typeMap = mapper.GetAllTypeMaps().FirstOrDefault(tm =\u003e tm.SourceType == sourceType \u0026\u0026 tm.DestinationType == destinationType); if (typeMap == null) return null; //Loop through all mappings for the source-destination members to find the destination value. var propertyMaps = typeMap.GetPropertyMaps().Where(pm =\u003e !pm.IsIgnored() \u0026\u0026 pm.SourceMember != null); foreach (var propertyMap in propertyMaps) { var sourceValueResolverPath = string.Empty; if (propertyMap.CustomExpression != null)//If it is a custom expression, then get directly the property text. { sourceValueResolverPath = LambdaHelper.GetPropertyText(propertyMap.CustomExpression); } else { var valueResolvers = propertyMap.GetSourceValueResolvers(); sourceValueResolverPath = valueResolvers.OfType\u003cIMemberGetter\u003e() .Aggregate(sourceValueResolverPath, (current, memberGetter) =\u003e current + (memberGetter.Name + PROPERTY_DELIMITER)) .RemoveLastChar(); } //Check if we have a source that match the source property if (sourceValueResolverPath == sourcePropertyName) { //If we have move than one property in the source, then we must loop and analyze sub property if (sourcePropertyNames.Count \u003e 1) { sourcePropertyNames.RemoveAt(0); //Recursive call without the first element because we will concatenate the destination result of the first since we have a source match return string.Concat(propertyMap.DestinationProperty.Name, PROPERTY_DELIMITER, GetMappedPropertyName(mapper, ((PropertyInfo)(propertyMap.SourceMember)).PropertyType, propertyMap.DestinationProperty.MemberType, sourcePropertyNames)); } //They are no properties and the source matched the resolving path. We return the destination return propertyMap.DestinationProperty.Name; } } //If we are this far it is because we have not found the source property. But, we can split the name by dot and check for individual property mapping var splitProperties = sourcePropertyName.Split(PROPERTY_DELIMITER); if (splitProperties.Length \u003e 1) { return GetMappedPropertyName(mapper, sourceType, destinationType, splitProperties.ToList()); } return null; } "])</script><script>self.__next_f.push([1,"17:T42e,"])</script><script>self.__next_f.push([1,"//Get the contest information but also the confirmation that the user is not already registered for the contest IEnumerable\u003cValidationResult\u003e validationsMessage; try { validationsMessage = this.contestService.SaveUserToContest(id, this.runningContext.GetUserId()); } catch (Exception e) { Log.Error(string.Format(\"Error during the UserPortefolio Join for contest id {0}\", id), e); return View(\"JoinFail\"); } if (validationsMessage != null \u0026\u0026 validationsMessage.Any()) { Log.Warning(string.Format(\"The user {0} is trying to join contest id {1} but has the error '{2}.'\", this.runningContext.GetUserId(),id,string.Join(\",\",validationsMessage))); var viewModel = Mapper.Map\u003cIEnumerable\u003cValidationResult\u003e, GeneralValidationsMessageViewModel\u003e(validationsMessage); return View(\"JoinFail\", viewModel); } var contestForUser = this.contestService.GetContestById(id); //Transform back everything for the page var viewContestsForUser = this.MapperFacade.GetViewModel\u003cModel.Entities.Contest.Contest, ContestDetailViewModel\u003e(contestForUser); return ViewModel(viewContestsForUser); } "])</script><script>self.__next_f.push([1,"18:T439,"])</script><script>self.__next_f.push([1,"The Order class is interesting for several reasons. First, it uses Value Object design pattern with the collaboration of Entity Framework. Not only it use Value Object but it does use it in three different ways. The first one is with TransactionType. It uses the pattern of having the TransactionTypeId directly into the classes to let Entity Framework save this one without having to attach the whole value object. This also has a performance gain by having the value object class without requiring to include. This is possible with the GetFromId method defined in the base class of the value object (this can be found in my Blog PatrickDesjardins.com/blog). The second way is with the OrderType. This time, it does not require to save anything in the database since it is calculated on the fly by the property getter. The last way value object is used is hidden inside the complex type Money. This one use value object for the currency type but cannot be set with a foreign key since Complex Type cannot have foreign key to any table. The integrity is only done on the code side."])</script><script>self.__next_f.push([1,"7:[\"$\",\"div\",null,{\"className\":\"__className_aaf875\",\"children\":[\"$\",\"div\",null,{\"className\":\"layout_container__Tovb9\",\"children\":[[\"$\",\"header\",null,{\"className\":\"layout_siteTitle__k5U8g\",\"children\":\"Patrick Desjardins Blog\"}],[\"$\",\"nav\",null,{\"children\":[\"$\",\"ul\",null,{\"className\":\"layout_navLinks__mf70r\",\"children\":[\"$\",\"li\",null,{\"className\":\"layout_navLinkItem__1L8fB\",\"children\":[[\"$\",\"$Lb\",null,{\"className\":\"layout_navLinkText__bt28R\",\"href\":\"/\",\"children\":\"Main Page\"}],[\"$\",\"$Lb\",null,{\"className\":\"layout_navLinkText__bt28R\",\"href\":\"/blog\",\"children\":\"Blog\"}],[[\"$\",\"$Lb\",\"2024\",{\"className\":\"layout_navLinkText__bt28R\",\"href\":\"/blog/for/2024\",\"children\":2024}],[\"$\",\"$Lb\",\"2023\",{\"className\":\"layout_navLinkText__bt28R\",\"href\":\"/blog/for/2023\",\"children\":2023}],[\"$\",\"$Lb\",\"2022\",{\"className\":\"layout_navLinkText__bt28R\",\"href\":\"/blog/for/2022\",\"children\":2022}],[\"$\",\"$Lb\",\"2021\",{\"className\":\"layout_navLinkText__bt28R\",\"href\":\"/blog/for/2021\",\"children\":2021}],[\"$\",\"$Lb\",\"2020\",{\"className\":\"layout_navLinkText__bt28R\",\"href\":\"/blog/for/2020\",\"children\":2020}],[\"$\",\"$Lb\",\"2019\",{\"className\":\"layout_navLinkText__bt28R\",\"href\":\"/blog/for/2019\",\"children\":2019}],[\"$\",\"$Lb\",\"2018\",{\"className\":\"layout_navLinkText__bt28R\",\"href\":\"/blog/for/2018\",\"children\":2018}],[\"$\",\"$Lb\",\"2017\",{\"className\":\"layout_navLinkText__bt28R\",\"href\":\"/blog/for/2017\",\"children\":2017}],[\"$\",\"$Lb\",\"2016\",{\"className\":\"layout_navLinkText__bt28R\",\"href\":\"/blog/for/2016\",\"children\":2016}],[\"$\",\"$Lb\",\"2015\",{\"className\":\"layout_navLinkText__bt28R\",\"href\":\"/blog/for/2015\",\"children\":2015}],[\"$\",\"$Lb\",\"2014\",{\"className\":\"layout_navLinkText__bt28R\",\"href\":\"/blog/for/2014\",\"children\":2014}],[\"$\",\"$Lb\",\"2013\",{\"className\":\"layout_navLinkText__bt28R\",\"href\":\"/blog/for/2013\",\"children\":2013}],[\"$\",\"$Lb\",\"2012\",{\"className\":\"layout_navLinkText__bt28R\",\"href\":\"/blog/for/2012\",\"children\":2012}],[\"$\",\"$Lb\",\"2011\",{\"className\":\"layout_navLinkText__bt28R\",\"href\":\"/blog/for/2011\",\"children\":2011}]]]}]}]}],[\"$\",\"div\",null,{\"className\":\"layout_blogPictureContainer__XC7nK\",\"children\":[\"$\",\"$Lf\",null,{\"className\":\"layout_blogTopPicture__RJHNN\",\"alt\":\"Patrick Desjardins picture from a conference\",\"src\":\"/images/backgrounds/patrickdesjardins_conference_bw.jpeg\",\"width\":800,\"height\":260}]}],[\"$\",\"main\",null,{\"className\":\"layout_main__mXTwS\",\"children\":[[\"$\",\"h1\",null,{\"children\":\"Asp.Net MVC Project, SQL Server, Redis and managed with VSTS\"}],[\"$\",\"div\",null,{\"className\":\"layout_blogPostContainer__WYELx\",\"children\":[[\"$\",\"p\",null,{\"className\":\"layout_blogPostDate__LUvx5\",\"children\":[\"Posted on: \",\"2016-04-04\"]}],[[\"$\",\"p\",null,{\"children\":[\"In the winter of 2014 I decided to re-code my virtual stock exchange \",[\"$\",\"a\",null,{\"href\":\"http://www.boursevirtuelle.com\",\"children\":\"boursevirtuelle.com\"}],\"$10\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"This is when I thought that I can redo the virtual stock exchange instead of a new complete idea. I had a strong view about what is the business logic and could just jump on the code. I started a blog where I was describing every sprints (1 month). This one ran from January 2014 to August 2014 where I got approached by Microsoft to come work for them, at Redmond USA. I have been continue to develop the new simulator but stopped blogging about it. This post contains the information that I posed in the old blog that is now not anymore online. I will post further detail about what I have learn during the project directly on this blog in the future.\"}],\"\\n\",[\"$\",\"h1\",null,{\"children\":\"Setuping Team Foundation Server (TFS) January 26, 2014 By: pdesjardins\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Posted in Application Life Cycle The project is just starting and before even thinking about how to create the code, we need to do some application life cycle management. Team Foundation Server offers an online edition since few months and I believe it is the perfect software for this open source online application. You can get an account at VisualStudio.com. Once logged, you can create you own repository. I have created one named “BourseVirtuelle.com” which is the name of the website.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"TFS online provides many tools. First, it has the TFS source control. All code will be located online with TFS. TFS and Visual Studio is tightly coupled with TFS which confirm the use of TFS. TFS also gives a good platform for activities. This is essential if we want to track the work to be done, bug tracking and future features to add. It has also a build server and testing capability. Since we are creating a enterprise website and not only a simple Asp.Net MVC tutorial, we will create unit test and we will execute automatized unit tests. Finally, TFS online offer the possibilities for deployment. Since this website is about how to create an Asp.Net MVC from the beginning to the end, we want to deploy everything in a later stage.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"The TFS account used for this project is mine : https://patrickdesjardins.visualstudio.com and the project name is BourseVirtuelle.com (which will have its English version at StockVirtual.com).\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Once created, it is the time to synchronize Visual Studio with TFS. Open Visual Studio and click Open from Source Control …\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"img\",null,{\"src\":\"/images/blog/OpenFromSourceControl.png\",\"alt\":\"\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"A window popup opens with the possibility to select a Team Foundation Server. I enter the URL that I have previously specified in this blog post and hit enter. From here, I can see all Team Projects available. I choose the BourseVirtuelle.com project and hit Connect.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"img\",null,{\"src\":\"/images/blog/ConnectToTFS.png\",\"alt\":\"\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"This step synchronize TFS and Visual Studio. It is possible to control TFS from Visual Studio with the Team Explorer tab.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"I will end this post here and continue later. The next step is to create some Work Items. Work Items are element for managing the work to be done on the project. Since it is a big project that will be built part-time on spare time, it is a good idea to keep track of what needs to be done.\"}],\"\\n\",[\"$\",\"h1\",null,{\"children\":\"Creating task with Team Foundation Server February 3, 2014 By: pdesjardins\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"We have now Visual Studio and TFS connected. It is the time to plan what we will do for the next sprint. Since we are not full time on this project, I plan to have monthly sprint. Maybe 10 hours per week will be set on this project, so a month is about 40 hours for 1 person. The first month will be mostly on configuring the project. But before planning anything, let’s setup TFS.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Visual Studio cannot change the backlog time frame. This is why, we will jump into the web portal. Once in the web portal, select WORK at the top of the screen. From there, you can choose Backlogs. When you select a sprint, you can then click at the top right the “No iteration dates” to setup and assign a range. At anytime it is possible to click the date and change the starting and ending date. It is also possible to rename the sprint.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"img\",null,{\"src\":\"/images/blog/TFS_SprintPeriode.png\",\"alt\":\"\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"We are now ready to enter few back log items. Back log items are a use case. This one will be defined later in smaller task. A group of back log can be a feature. It is possible to work with TFS from big to small or small to big. I am note sure that I will go as much deep with Work Item for this project and will start just by defining Work Item as back log item.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"The first step is to click BackLog items in the Work-\u003eBacklogs menu.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"img\",null,{\"src\":\"/images/blog/TFS_BackLogItem.png\",\"alt\":\"\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"The type can be “Product Backlog Item” or “Bug”. Every time title are entered and the Add button is hit, then the grid below the form is filled up. But this is not the only way to create Backlog items. We can do it directly into Visual Studio 2013. First, open the Team Explorer. Second, on the home screen, click Work Items. Third, click New Work Item at the top of this panel.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"img\",null,{\"src\":\"/images/blog/TFS_NewBackLogItemFromVS-1024x260.png\",\"alt\":\"\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"In both case system, the web portal and Visual Studio, it is possible to create a list of Work Item. Visual Studio may looks to have more field but in fact, the web portal does have them too. Once it is created from the team portal, right clicking Work Item in the grid and selecting Open, opens the Work Item with all fields.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"At any time, from Visual Studio or the web portal, it is possible to see the list of backlog item. In Visual Studio, the list if under the Team Explorer, Work Items. A sub panel labelled Queries has a Shared Queries folder. Under this one, a pre-defined query “Product Backlog” exist. Double clicking this query execute this one.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"img\",null,{\"src\":\"/images/blog/TFS_BackLogItemList.png\",\"alt\":\"\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"From here, it is possible to assign to double click any of the Work Item and to assign the effort and to who the Work Item is assigned. For the moment, I am sure that the four first Work Item can fit in the first sprint. So, I can with Visual Studio opens the Work Item and change the Iteration for the first sprint.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"img\",null,{\"src\":\"/images/blog/TFS_AssignSprint.png\",\"alt\":\"\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"But, it is not efficient because it is slow. A faster way is to use the web portal because you can drag and drop Work Item.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"![](/images/blog/TFS_Drag_Drop_WorkItemToSprint.mp4\\\" controls/\u003e\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"This have move everything into the Sprint 1. Visual Studio has a Shared Query called “Sprint Backlog” and the web portal has the Sprint 1. Both display not only Work Items but also Task. Here is the two side by side that show the difference. I personally prefer the web portal.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"img\",null,{\"src\":\"/images/blog/TFS_VS_WebPortalSprint1-1024x345.png\",\"alt\":\"\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"The next step is to assign capability for the team. For the sprint 1 (and for all other sprint) I will be alone. Nevertheless, let’s configure everything correctly. Inside the web portal, click the Sprint 1 and select the Capacity sub menu. From here, it is possible to select the capacity per day. We have defined that I will work about 10 hours per week, so it is 2 hours per day (5 workings day on 7 days).\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"img\",null,{\"src\":\"/images/blog/TFS_Capacity.png\",\"alt\":\"\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"What is most interesting is to assign time into each task. I have say TASK because time cannot be assigned to Work Item directly. Work Item remaining time is the sum of every task times. It is possible to set the remaining time directly inside each Work Item but the fastest way is to open the web portal and to go inside the sprint ans select “Board”. This give a view where each Work Item has its row and each task has its square. It is possible from here to click an assign the time and to who the task is assigned.\"}],\"\\n\",[\"$\",\"video\",null,{\"src\":\"/videos/blog/TFS_Board_AssignTime.mp4\",\"controls\":true}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Once all setup, if you go back to the Capacity window, the work for the team, for every user and for task should be all green if you do not overcharge.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"img\",null,{\"src\":\"/images/blog/TFS_WorkDetail.png\",\"alt\":\"\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"It is also possible to change the Board view by people instead of by Work Item. This option is inside the Board screen, at the top right.\"}],\"\\n\",[\"$\",\"h1\",null,{\"children\":\"Sprint 2 : Planning model classes, creating the projects and starting authentification February 10, 2014 By: pdesjardins\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Since I am working alone in this project and I do not have a lot of time, sprint was defined to be for a complete month. This give about 40 hours per sprint which is not that big. So far, the sprint 1 has been great because I have identified what we will do and what I will not do. I have filled up all the back log and started to organize what will happen in the next sprints.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Here is the summary of the needs:\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Existing needs\"}],\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":\"Create new accounts\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"Display TOS\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"Login for existing user\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"Forget password mechanism\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"Show old contest\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"Show the name of the contest with the number of participants\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"Give the possibility to show the rating\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"Discussion forum\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"Help for the user\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"Have a way to communicate with the administration (contact page)\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"Premium account\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"Allow to enter contest that needs to have reputation point even if the user\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"Show more detail in the portfolio\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"Having more time for order\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"Having action directly into the portfolio\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"Having more decimal precision\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"Search users\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"Having an indicator that specify if a sell has been a success or not\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"One screen that show all portfolio\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"A list of all contest available to register.\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"A list of all contest that we participate\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"Create new contest and be able to edit them if we are an administrator\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"Private contest can be created with a password\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"Buy and sell action\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"Limit and Stop order\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"Buy and sell option\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"Limit and Stop order\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"See a graphic of the progression of the portfolio\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"See historic of all transactions (success and fail)\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"See all waiting order and their state\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"Display statistic about the number of buy/sell that has been a success or not.\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"List of all participants of a contest\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"Displaying the rank of the logged user.\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"Having moderator for the whole website or for just a contest\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"Having badge and reputations system\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"Badge for rank position, activity, beat the market, time registered\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"Moderation tools for split and for symbol change\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"Having script that automatically execute split and symbol change\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"Voting system for split and symbol.\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"Being able to see last registered user and to manually enable account\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"Being able to see last transactions for a contest\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"User Paypal to get premium account\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"French and English website\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"Having good URL (French and English)\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"Short option\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"Option Lookup (Ask and Bid Price)\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"Show when market is open or close\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"Be able to select which Market is available for a contest\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"Keep tracks of every portefolios gain\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"Something that remove limit order and option expiration automatically\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"Send email if the user have the preference to receive email when new contest arrives\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"Statistic for the contest. Daily, weekly, monthly best performer.\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"It is too slow and not essential.\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"Showing the forum last post in the website.\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"This slow down the website. Possible to add it later.\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"Having followers and being able to follow people portfolio.\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"This feature is not used by 575 peoples at this moment. Can be added at any time later.\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"Dashboard with widget.\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"This is so slow that is not usable. I do not see a real use case for this feature.\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"Wiki for help\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"This has been targeted by hacker a lot. People do not participate.\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"Winning by getting to a specific amount\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"Never been implemented correctly. Too risky to end contest prematurely.\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"Team contest (multiple people having the same portfolio) with the mechanism of creating team.\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"The problem is that contest is spanned on multiple month. People forget to play and the team is with dead bodies. This need to be rethinking. The team building system is great.\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"Having currency\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"Currencies would be more realistic and could have impact. This would require to have a daily script to get conversion. Maybe we can limit to USD, CND, EURO.\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"Mobile version of the website\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"I think this is normal now and won’t be a problem to implement.\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"Watch List\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"This is not a priority but having a watch list of stocks seem to be naturally something interesting to have\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"Showing historical price for stock\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"This is frustrating at the moment because we have no clue about the past price of the stock. We only have the present time. We must have a list of pas price and being able to display the price on a graph.\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"Create account with social website\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"Simple as possible to create account\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"Be able to create account from FaceBook or Twitter\"}],\"\\n\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Old needs that won’t be migrate\"}],\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":\"Statistic for the contest. Daily, weekly, monthly best performer.\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"It is too slow and not essential.\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"Showing the forum last post in the website.\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"This slow down the website. Possible to add it later.\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"Having followers and being able to follow people portfolio.\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"This feature is not used by 575 peoples at this moment. Can be added at any time later.\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"Dashboard with widget.\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"This is so slow that is not usable. I do not see a real use case for this feature.\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"Wiki for help\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"This has been targeted by hacker a lot. People do not participate.\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"Winning by getting to a specific amount\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"Never been implemented correctly. Too risky to end contest prematurely.\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"Team contest (multiple people having the same portfolio) with the mechanism of creating team.\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"The problem is that contest is spanned on multiple month. People forget to play and the team is with dead bodies. This need to be rethinking. The team building system is great.\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"Having currency\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"Currencies would be more realistic and could have impact. This would require to have a daily script to get conversion. Maybe we can limit to USD, CND, EURO.\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"Mobile version of the website\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"I think this is normal now and won’t be a problem to implement.\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"Watch List\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"This is not a priority but having a watch list of stocks seem to be naturally something interesting to have\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"Showing historical price for stock\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"This is frustrating at the moment because we have no clue about the past price of the stock. We only have the present time. We must have a list of pas price and being able to display the price on a graph.\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"Create account with social website\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"Simple as possible to create account\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"Be able to create account from FaceBook or Twitter\"}],\"\\n\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"New needs\"}],\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":\"Having currency\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"Currencies would be more realistic and could have impact. This would require to have a daily script to get conversion. Maybe we can limit to USD, CND, EURO.\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"Mobile version of the website\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"I think this is normal now and won’t be a problem to implement.\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"Watch List\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"This is not a priority but having a watch list of stocks seem to be naturally something interesting to have\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"Showing historical price for stock\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"This is frustrating at the moment because we have no clue about the past price of the stock. We only have the present time. We must have a list of pas price and being able to display the price on a graph.\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"Create account with social website\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"Simple as possible to create account\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"Be able to create account from FaceBook or Twitter\"}],\"\\n\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"For this sprint, the classes diagram has been done for the model. It was very easy to do because the system already exist. Nevertheless, improvement was required. The old system was done in PHP and did not had a lot of inheritance and a lot of dirty PHP trick was done. Also, nothing was injectable. This made unit testing harder.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Few class will be complex and will be directly added into all tables when used. This is the case for the Money and for the LocalizedString.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"img\",null,{\"src\":\"/images/blog/TFS_ComplexType.png\",\"alt\":\"\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Then, we have classes that concern the user. In the current system user can win badges and reputations points. These will be in the User namespace. Every model namespace will be translated into schemas in the database. We will configure Entity Framework in a later post. User will be have role. So far, role will be Administrator, Moderator, Contest Moderator or simply a Registered User. The privileges table is linked to the User table. User will have the possibility to have privileges which are special account.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"img\",null,{\"src\":\"/images/blog/Classes_Users-1024x388.png\",\"alt\":\"\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"The Contest namespace is a huge one that contain a critical classes.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"img\",null,{\"src\":\"/images/blog/Classes_Contest-1-1024x573.png\",\"alt\":\"\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"At its heart, this namespace has the Contest class. The registration rule has been set to an one to one relation. This has been not put inside the Contest class because it is only used in specific place. It does not need to be loaded 80% of the time. This class can be and must be inherited into a specific implementation like to have a simple stock market contest or have one that allows shorting or options. Nevertheless, I am not happy with the current class diagram because it is not possible to have a contest with Short and Option. Having the Option inherit from the Short will also cause problem because having option contest force to have short too. This need some work but since all options and short are planned in few sprints (months), I will leave this like that.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"img\",null,{\"src\":\"/images/blog/Classes_Trading-1024x520.png\",\"alt\":\"\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"This is also a huge namespace, the Trading namespace. It contains all orders, transactions, stocks and options of every portfolio. Finally, some classes for Stock and Option are required to have real time value.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"img\",null,{\"src\":\"/images/blog/Classes_RealTime.png\",\"alt\":\"\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"These classes will offer the information from external source. Like Yahoo or Google to get the real time price (or 15 minutes delayed).\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"img\",null,{\"src\":\"/images/blog/ArchitectureBourseVirtuelle-1024x546.png\",\"alt\":\"\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"We want something efficient and with low maintainability. This require having high cohesive classes but also low coupling. Nevertheless, to be efficient we need to limit the number of classes which will increase the coupling. A good in the middle solution is to have View Model and Model classes. This project will have these two types of classes for entity classes. Otherwise, three majors layers are there. One for the presentation, one for the business logic and one for data access.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"img\",null,{\"src\":\"/images/blog/LayersBourseVirtuelle.png\",\"alt\":\"\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Exceptions are also limited to two levels. One that can goes up to the presentation and one that is only back end. During the process, if we have something to cut for shorter the development time, we may cut the exception to have this one go from the back end to the front end. However, this increase the coupling. Let’s go a little more in detail before going further in the code.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"img\",null,{\"src\":\"/images/blog/DetailledArchitecture.png\",\"alt\":\"\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"This is a more detailed view of how the system will be developed. On the left side and on the right side you can see what we just saw in the more abstracted view of the architecture. The in between are all Asp.Net technologies for the front end, the ASP.Net MVC controller for the business logic which share classes with a service layer. These one access any persistence storage by an accessor layer that do the proxy between multiple data access technologies.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Creating a new solutions and projects\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"So, from all information that we have gathered so far, it is possible to create the solution for this new software.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"When creating the solution, we want to push all the code to TFS Online. It is important to select “Add to source control”. If you have not, do not worry, you can add it later.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"CreateNewSolutionThen, we select MVC application and the authentication to be Individual User Accounts. This is because we want users to create account or to use their Facebook and Twitter account to link to a new account. We do not add unit test because we will create them later and in several projects.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"I’ll stop here for now. Another post will be there soon concerning all the authentication process.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Sprint 2 : TFS Online Configuration and solution setup February 17, 2014 By: pdesjardins\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Posted in Analysis and Architecture In the last post, we have created the new solution “BourseVirtuelle”. I have renamed the default project, which is the Asp.Net MVC project to “WebSite”. Now that the solution exist and is plain with the default folders and classes, it is the time to create the projects and folders that represent the software architecture.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"I have put back the detailed architectural graph because you will see that Visual Studio solution will be pretty much the same. What I have not yet discussed and that is visually apparent here is the fact that we will have multiple unit testing project. Every projects contains at least a unit testing project. Some, contains two. One for unit testing and one for integration. The purpose of splitting this in several projects is because when we will setup the build server that we won’t let it build test that are slower, like integration tests.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"img\",null,{\"src\":\"/images/blog/Part1Project.png\",\"alt\":\"\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"This is the first part of projects created. As you can see, they are grouped into folders. This allows us to easily find every layers with their test. Every project has their unit testing project inside their folder. The CrossLayer projet is a project that is referenced by almost all projects. Not a lot of classes will be set there, but some classes are cross layers. The BusinessLayer has the folder Service. One exception is all controllers that will be kept in the WebSite project. The reason is because Asp.Net MVC setup by default all controllers in the website project or within the Are folder of the website project. DataAccess folder contains the DataAccess project. This one contains Accessors, Contexts, Repositories, UnitOfWork and later everything related to others elements defined in the architectural graphic.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"img\",null,{\"src\":\"/images/blog/Part2Project-1.png\",\"alt\":\"\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"The second part contains the model folder. This one also contains a unit testing project. The model project is divided with some folders like the DataAnnotation, Entities and ValueObjects. DataAnnotation contains validation that can be shared across model classes. Entities are every classes used in the business. This has been defined in a previous post. However, the previous post contained some Value Object. Value Object are classes that could have been defined at enumeration but to have them in the database, they are defined as classes. They are not creatable or editable like entities. For example, an example of value object is the type of Option (Ask, Bid).\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"From there, it is the time to commit everything and end this post.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"On a final note, this is a project that I am doing on my free time and I am commenting my commit. This should be a reflex for everybody. Later one, this can become very handy to know what is going on in the source control and to be able to come back on a specific commit.\"}],\"\\n\",[\"$\",\"h1\",null,{\"children\":\"Sprint 2 : Identity and Architecture Part 1 of 2 February 24, 2014 By: pdesjardins\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Posted in Analysis and Architecture, Asp.Net MVC, Back-End This is the first post that contains more code. But first, let me show the architectural diagram. This diagram as been created with the Architecture Tool from Visual Studio 2013 Ultimate. It is not available for other edition. What is interesting compared to other UML tool is that the layer diagram will validate later if the design is respected.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"img\",null,{\"src\":\"/images/blog/DetailledArchitecture.png\",\"alt\":\"\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"The image might be a little small but if you click on it you will see more details. As we can see, the presentation layer contains Html Helper and Views. Html Helpers will be defined later on its own name space to not disturb the Asp.Net MVC Html helpers. The diagram also show that presentation layer can only access View Model and not Model directly. Business Layer contains the controller, some algorithms and the service layers. I have put the controller in the Business Logic and not in the presentation layer because some basic logic and errors manipulation are done here. I concentrate the presentation layer for all visual aspect like Javascript, Css, Html.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"The service layer inside the business layer contains the path to classes that has access to the data access layer. It can compute information from different sources. On the other side, the accessor layer. This is the first layer to reach once the data access layer is used. It chooses which technology to use. For example, this is where the cache will be checked, if not available than it will use the repository. This logic is in the accessor. Unit of work is used but not like Asp.Net MVC tutorial explains it. It is more like Julie Lerman explains it in her tutorial on PluralSight. I found it more logical. As you can see, the Unit of Work contains the Database Context (Entity Framework) but not repositories. I think it is better because you can adjust easily which repository to combine by having them in the accessor and this one give the Unit Of Work to each repository. The main goal is to have multiple repositories to share the same context.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Finally, this layer has model classes. This one can be used by the data access layer and the business layer. It would be interesting to have the data acess layer have its own entity classes but to limit mapping and tests to do, having only View Model and Model is enough.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Identity Preface\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"The website has for requirement to log with minimal information. I think the more minimal information to get is the email. I think it helps to have a lot of player if the form is very small. This is why what is built will have only one unique input that will ask for an email. This email address will be stored in the database and an emailed to send a validation link. Since we are using Identity, a password and a user name is required. To bypass this default behavior, a username is generated from the email address and a temporary password is set. This password is send in the email. Of course, the user must change this one.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"When creating this behavior which can be found in this blog post I have notice that Asp.Net Identity framework has some difficulty to update custom field of your user. The Email is a custom field, so is the Creation date time and the Validation date time. These custom field must be updated. The first date when the account is created and the second when it is validated. This will be interesting to send back email after 24 hours if the account has not been validated and also to have some statistic about how many account has been created for real.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"So the first step is to modify the Identity to have custom fields. The second step is to use the Identity User Manager to create and handle the user . The third step is to use Entity Framework to update the user for custom field.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Modifying Identity into Data Access Layer\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"We need to fit the Identity User Manager somewhere logical. By default, it is inside the WebSite project. This is wrong. The UserManager class use a DbContext. Of course, it is clear that it should be moved into the Data Access Layer. Its place is in in parallel of repositories. We will create our first repository to modify the user but the Identity User Manager should not be in the repository. It is a mechanism by itself and this why I have separated both. \",[\"$\",\"img\",null,{\"src\":\"/images/blog/DataAccessBourseVirtuelle-1024x590.png\",\"alt\":\"\"}]]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"The website project must have the view model, the views and the controllers. That’s it. All model classes and user manager classes are moved.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"img\",null,{\"src\":\"/images/blog/WebSiteBourseVirtuelle.png\",\"alt\":\"\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"The model project has the custom class.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"img\",null,{\"src\":\"/images/blog/ModelUserBourseVirtuelle.png\",\"alt\":\"\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"I have named mine ApplicationUser.cs. Asp.Net MVC Identity allows to inherit the IdentityUser class. This is where we add additional properties like the Email.\"}],\"\\n\",[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"backgroundColor\":\"#fff\",\"color\":\"#24292e\"},\"tabIndex\":\"0\",\"data-language\":\"csharp\",\"data-theme\":\"github-light\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"csharp\",\"data-theme\":\"github-light\",\"style\":{\"display\":\"grid\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" class\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" ApplicationUser\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" : \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"IdentityUser\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" string\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" Email\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"get\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"set\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; } \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" string\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" GravatarEmail\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"get\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"set\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; } \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" string\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" DisplayName\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"get\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"set\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; } \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" string\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" FirstName\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"get\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"set\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; } \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" string\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" LastName\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"get\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"set\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; } \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" DateTime\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"? \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"LastLogin\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"get\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"set\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; } \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" DateTime\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" CreationDateTime\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"get\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"set\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; } \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" DateTime\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"? \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"ValidationDateTime\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"get\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"set\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; } } \"}]]}]}]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"I added more than just the email because in back log of the project, one coming work item is to be able to change the profile. I want the user to be able to have an icon. I will use gravatar since it is the system used in the current PHP system. I have a DisplayName which is the nick name that we will use. I cannot reuse the UserName of IdentityUser becaues it has been generated by the email and must remain a system property because every time the user will login with its email, the system transforms the email to the username to use the User Manager to login.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"As we have seen in the layer, we need to have something in the service, then in the accessor and finally use the repository for updating the user and using the Identity User Manager.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Let’s start with the service layer. You may jump of your chair because I am in the process of developing the software. So far, the code is simple and will be improved. The service class is a pass through for the moment and it is normal for the User because it does not have any logic. Here is the class at this time of the project.\"}],\"\\n\",[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"backgroundColor\":\"#fff\",\"color\":\"#24292e\"},\"tabIndex\":\"0\",\"data-language\":\"csharp\",\"data-theme\":\"github-light\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"csharp\",\"data-theme\":\"github-light\",\"style\":{\"display\":\"grid\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" class\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" UserService\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\":\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"IUserService\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"private\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" readonly\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" IUserAccessor\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" userAccessor\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"private\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" readonly\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" IEmailCreationFacade\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" emailFacade\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"private\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" readonly\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" IRunningContext\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" runningContext\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" UserService\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"IRunningContext\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" runningContext\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\", \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"IUserAccessor\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" userAccessor\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\", \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"IEmailCreationFacade\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" emailFacade\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\") { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005CC5\"},\"children\":\"this\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\".runningContext \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" runningContext; \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005CC5\"},\"children\":\"this\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\".userAccessor \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" userAccessor; \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005CC5\"},\"children\":\"this\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\".emailFacade \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" emailFacade; } \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" async\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" Task\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"IdentityResult\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"CreateAsync\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"ApplicationUser\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" user\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\", \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"string\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" password\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\") { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"var\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" result\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" await\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005CC5\"},\"children\":\" this\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\".userAccessor.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"CreateASync\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(user, password); \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"if\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" (result.Succeeded) { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"var\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" email\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005CC5\"},\"children\":\" this\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\".emailFacade.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"GetCreationEmail\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(user.Email, password); \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005CC5\"},\"children\":\"this\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\".userAccessor.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"SendEmailCreateAccountAsync\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(email); } \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"return\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" result; } \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" async\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" Task\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"ClaimsIdentity\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"CreateIdentityAsync\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"ApplicationUser\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" user\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\", \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"string\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" applicationCookie\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\") { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"return\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" await\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005CC5\"},\"children\":\" this\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\".userAccessor.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"CreateIdentityAsync\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(user, applicationCookie); } \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" async\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" Task\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"IdentityResult\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"CreateAsync\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"ApplicationUser\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" user\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\") { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"return\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" await\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005CC5\"},\"children\":\" this\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\".userAccessor.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"CreateASync\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(user); } \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" async\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" Task\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"ClaimsIdentity\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"SignInAsync\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"ApplicationUser\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" user\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\", \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"bool\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" isPersistent\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\") { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"return\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" await\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005CC5\"},\"children\":\" this\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\".userAccessor.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"SignInAsync\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(user, isPersistent); } \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" async\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" Task\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"IdentityResult\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"RemoveLoginAsync\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"string\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" userId\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\", \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"UserLoginInfo\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" userLoginInfo\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\") { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"return\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" await\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005CC5\"},\"children\":\" this\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\".userAccessor.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"RemoveLoginAsync\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(userId, userLoginInfo); } \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" async\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" Task\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"ApplicationUser\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"FindAsync\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"string\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" userName\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\", \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"string\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" password\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\") { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"return\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" await\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005CC5\"},\"children\":\" this\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\".userAccessor.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"FindAsync\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(userName, password); } \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" async\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" Task\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"IdentityResult\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"ChangePasswordAsync\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"string\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" userId\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\", \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"string\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" oldPassword\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\", \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"string\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" newPassword\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\") { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"return\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" await\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005CC5\"},\"children\":\" this\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\".userAccessor.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"ChangePasswordAsync\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(userId, oldPassword, newPassword); } \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" async\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" Task\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"IdentityResult\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"AddPasswordAsync\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"string\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" userId\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\", \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"string\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" newPassword\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\") { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"return\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" await\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005CC5\"},\"children\":\" this\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\".userAccessor.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"AddPasswordAsync\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(userId, newPassword); } \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" async\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" Task\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"ApplicationUser\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"FindAsync\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"UserLoginInfo\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" userName\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\") { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"return\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" await\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005CC5\"},\"children\":\" this\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\".userAccessor.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"FindAsync\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(userName); } \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" async\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" Task\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"IdentityResult\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"AddLoginAsync\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"string\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" userId\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\", \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"UserLoginInfo\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" login\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\") { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"return\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" await\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005CC5\"},\"children\":\" this\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\".userAccessor.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"AddLoginAsync\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(userId, login); } \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" ICollection\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"UserLoginInfo\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"GetLogins\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"string\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" userId\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\") { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"return\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005CC5\"},\"children\":\" this\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\".userAccessor.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"GetLogins\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(userId); } \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" ApplicationUser\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" FindById\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"string\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" userId\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\") { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"return\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005CC5\"},\"children\":\" this\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\".userAccessor.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"FindById\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(userId); } \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" void\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" ActivateAccount\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"string\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" guid\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\") { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"try\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"var\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" userAccount\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005CC5\"},\"children\":\" this\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\".userAccessor.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"FindById\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(guid); \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"if\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" (userAccount \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"==\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005CC5\"},\"children\":\" null\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\") { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"throw\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" new\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" GuidKeyNotFound\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(guid); } userAccount.ValidationDateTime \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005CC5\"},\"children\":\" this\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\".runningContext.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"GetCurrentTime\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(); userAccessor.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Update\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(userAccount); } \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"catch\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" (\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"ArgumentNullException\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\") { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"throw\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" new\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" GuidKeyNotFound\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(guid); } } } \"}]]}]}]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"This class is injected by Microsoft Unity. It could have been any inversion of control (IoC) but I try to keep it simple and Unity do the job well. It has three parameters. IRunningContext, IUserAccessor and IEmailCreationFacade. I will not talk about the first one yet more than it has the current date time and it has the user that is loggued. The user accessor is the accessor that the user service uses. The email facade is all the logic about creating emails. This is required to be able to send a verification email. Later, it will be also used when the user do not remember his password. Let’s focus on the creation of an account for now.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"The CreateAsync method is the cone that concern us. We want to create an account into the database by using the default membership framework, called Identity. Here is an extraction of the method that is important for the moment.\"}],\"\\n\",[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"backgroundColor\":\"#fff\",\"color\":\"#24292e\"},\"tabIndex\":\"0\",\"data-language\":\"csharp\",\"data-theme\":\"github-light\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"csharp\",\"data-theme\":\"github-light\",\"style\":{\"display\":\"grid\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" async\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" Task\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"IdentityResult\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"CreateAsync\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"ApplicationUser\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" user\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\", \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"string\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" password\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\") { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"var\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" result\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" await\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005CC5\"},\"children\":\" this\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\".userAccessor.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"CreateASync\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(user, password); \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"if\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" (result.Succeeded) { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"var\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" email\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005CC5\"},\"children\":\" this\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\".emailFacade.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"GetCreationEmail\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(user.Email, password); \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005CC5\"},\"children\":\"this\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\".userAccessor.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"SendEmailCreateAccountAsync\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(email); } \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"return\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" result; } \"}]]}]}]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"First of all, it access the accessor. This is the entry door for the Data Access Layer. If everything is saved, than we send an email. It is the place of the service to trigger the email and not the accessor because it is a business logic to send an email after the creation of an account, not a Data Access Layer code. On the accessor side, it uses the unit of work because the accessor has the role to say if everything must be commited. I takes the user manager, the email provider and the user repository too.\"}],\"\\n\",[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"backgroundColor\":\"#fff\",\"color\":\"#24292e\"},\"tabIndex\":\"0\",\"data-language\":\"csharp\",\"data-theme\":\"github-light\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"csharp\",\"data-theme\":\"github-light\",\"style\":{\"display\":\"grid\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" class\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" UserAccessor\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\":\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"IUserAccessor\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"private\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" readonly\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" IUserRepository\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" userRepository\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"private\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" readonly\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" IRunningContext\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" runningContext\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"private\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" readonly\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" IUnitOfWork\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" unitOfWork\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" ; \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"private\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" readonly\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" IUserManager\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" userManager\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"private\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" readonly\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" IEmailProvider\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" emailProvider\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" UserAccessor\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"IRunningContext\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" runningContext\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\",\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"IUnitOfWork\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" unitOfWork\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\", \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"IUserRepository\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" repository\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\", \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"IUserManager\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" userManager\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\", \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"IEmailProvider\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" emailProvider\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\") { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005CC5\"},\"children\":\"this\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\".runningContext \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" runningContext; \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005CC5\"},\"children\":\"this\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\".unitOfWork \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" unitOfWork; \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005CC5\"},\"children\":\"this\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\".userRepository \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" repository; \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005CC5\"},\"children\":\"this\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\".userManager \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" userManager; \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005CC5\"},\"children\":\"this\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\".emailProvider \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" emailProvider; } \"}]]}]}]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"The create method that is called by the service layer is very straightforward. It simply call the user manager.\"}],\"\\n\",[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"backgroundColor\":\"#fff\",\"color\":\"#24292e\"},\"tabIndex\":\"0\",\"data-language\":\"csharp\",\"data-theme\":\"github-light\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"csharp\",\"data-theme\":\"github-light\",\"style\":{\"display\":\"grid\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" Task\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"IdentityResult\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"CreateASync\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"ApplicationUser\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" user\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\", \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"string\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" password\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\") { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"return\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005CC5\"},\"children\":\" this\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\".userManager.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"CreateASync\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(user, password); } \"}]]}]}]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"If we go a little lower in the class, two other methods is different in the accessor.\"}],\"\\n\",[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"backgroundColor\":\"#fff\",\"color\":\"#24292e\"},\"tabIndex\":\"0\",\"data-language\":\"csharp\",\"data-theme\":\"github-light\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"csharp\",\"data-theme\":\"github-light\",\"style\":{\"display\":\"grid\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" void\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" Update\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"ApplicationUser\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" userAccount\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\") { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005CC5\"},\"children\":\"this\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\".userRepository.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Update\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(userAccount); \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005CC5\"},\"children\":\"this\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\".unitOfWork.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Commit\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(); } \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" async\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" void\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" SendEmailCreateAccountAsync\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Email\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Implementations\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Email\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" email\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\") { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"await\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005CC5\"},\"children\":\" this\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\".emailProvider.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"SendEmailAsync\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(email); } \"}]]}]}]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"The update does not use the UserManager because it does not work well with custom fields. It uses the repository that simply use Entity Framework to update the entity. The other method is for sending thee email. This one is async since we do not want to wait the email to be sent. It will call the command to send the email and return immediately.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Here is the repository code so far for the user.\"}],\"\\n\",[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"backgroundColor\":\"#fff\",\"color\":\"#24292e\"},\"tabIndex\":\"0\",\"data-language\":\"csharp\",\"data-theme\":\"github-light\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"csharp\",\"data-theme\":\"github-light\",\"style\":{\"display\":\"grid\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" class\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" UserRepository\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" : \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"RepositoryForUser\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"ApplicationUser\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e, \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"IUserRepository\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"private\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" IUnitOfWork\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" unitOfWork\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" UserRepository\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"IUnitOfWork\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" unitOfWork\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"):\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005CC5\"},\"children\":\"base\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(unitOfWork) { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005CC5\"},\"children\":\"this\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\".unitOfWork \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" unitOfWork; } \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" void\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" Update\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"ApplicationUser\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" userAccount\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\") { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005CC5\"},\"children\":\"base\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Update\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(userAccount); } } \"}]]}]}]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"What is very interesting with Entity Framework is that you do not have to change anything in the repository if an additional custom field must be added and modified. Later, when the profile page will be done, this repository should not change.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Concerning the email, because it uses an interface, the injection can push a real implementation but also a fake one.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"img\",null,{\"src\":\"/images/blog/EmailProviderBourseVirtuelle.png\",\"alt\":\"\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Instead of having email sent with SMTP, a fake one writes file is coded. This make it faster and easier during development to not have an intermediary protocol between the process of sending and receiving.\"}],\"\\n\",[\"$\",\"h1\",null,{\"children\":\"SPRINT 2 : IDENTITY AND ARCHITECTURE PART 2 OF 2 March 3, 2014 By: pdesjardins\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"This second part is shorter than the first one. The sprint 2 has two others thing that must change with Identity. First of all it is the possibility to fake a user. This will be interesting for testing purpose. The second work item is to be able to log with third party, like Facebook or Twitter.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"This part was not a piece of cake. It was working fine with an empty project but for unknown reasons, thing has gone wrong in few places. First of all, the use of external login was not working fine in the project but was fine in a new project solution. Second, the use of AccountManager of Identity cause some problem with Async.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"I have modified the identity to have Model inside the Model project and ViewModel in the ViewModel project. The Model is very simple since we are using Identity. Most of the classes are ViewModel. \",[\"$\",\"img\",null,{\"src\":\"/images/blog/Sprint2ModelViewModel.png\",\"alt\":\"\"}]]}],\"\\n\",[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"backgroundColor\":\"#fff\",\"color\":\"#24292e\"},\"tabIndex\":\"0\",\"data-language\":\"csharp\",\"data-theme\":\"github-light\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"csharp\",\"data-theme\":\"github-light\",\"style\":{\"display\":\"grid\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" class\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" ApplicationUserViewModel\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" string\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" Email\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"get\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"set\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; } \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" string\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" GravatarEmail\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"get\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"set\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; } \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" string\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" DisplayName\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"get\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"set\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; } \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" string\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" FirstName\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"get\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"set\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; } \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" string\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" LastName\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"get\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"set\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; } } \"}]]}]}]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"The view model is used to allow the user to add custom data. It is mapped to the model class.\"}],\"\\n\",[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"backgroundColor\":\"#fff\",\"color\":\"#24292e\"},\"tabIndex\":\"0\",\"data-language\":\"csharp\",\"data-theme\":\"github-light\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"csharp\",\"data-theme\":\"github-light\",\"style\":{\"display\":\"grid\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" class\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" ApplicationUser\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" : \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"IdentityUser\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\", \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"IValidatableModel\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" string\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" Email\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"get\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"set\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; } \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" string\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" GravatarEmail\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"get\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"set\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; } \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" string\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" DisplayName\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"get\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"set\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; } \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" string\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" FirstName\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"get\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"set\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; } \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" string\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" LastName\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"get\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"set\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; } \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" DateTime\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"? \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"LastLogin\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"get\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"set\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; } \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" DateTime\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" CreationDateTime\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"get\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"set\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; } \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" DateTime\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"? \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"ValidationDateTime\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"get\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"set\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; } \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" IEnumerable\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"ValidationResult\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Validate\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"() { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"return\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005CC5\"},\"children\":\" null\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; } \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" bool\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" IsValid\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"() { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"return\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" !\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Validate\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"().\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Any\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(); } } \"}]]}]}]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"The model class is not yet done but has most of the properties that is required by the service to save it with Entity Framework. The Identity Framework does not work fine or easy with custom fields without the use of Entity Framework. This is why, the Service Layer will use Entity Framework for some operations and use the Identity Manager for others. Here is a sequence diagram from the AccountController to the Service layer. From here, the path change depending of the task.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"img\",null,{\"src\":\"/images/blog/Sprint2SequenceDiagramCreateUser.png\",\"alt\":\"\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"As you can see, the controller call some injected classes like a IUserValuesGenerator. This is the class that as the algorithm to generate the password to the user. Why? Because we want a minimalist sign up form. In fact, just the email is required.\"}],\"\\n\",[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"backgroundColor\":\"#fff\",\"color\":\"#24292e\"},\"tabIndex\":\"0\",\"data-language\":\"csharp\",\"data-theme\":\"github-light\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"csharp\",\"data-theme\":\"github-light\",\"style\":{\"display\":\"grid\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" async\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" Task\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"IdentityResult\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"CreateAsync\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"ApplicationUser\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" user\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\", \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"string\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" password\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\") { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"var\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" result\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" await\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005CC5\"},\"children\":\" this\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\".userAccessor.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"CreateASync\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(user, password); \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"if\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" (result.Succeeded) { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"var\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" email\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005CC5\"},\"children\":\" this\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\".emailFacade.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"GetCreationEmail\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(user.Email, password); \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005CC5\"},\"children\":\"this\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\".userAccessor.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"SendEmailCreateAccountAsync\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(email); } \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"return\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" result; } \"}]]}]}]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"The code above, create the user, if it succeed, it send an email to the user with his temporary password. The accessor layer is where the technology switch is done. Depending of the task, it uses Entity Framework or the User Manager.\"}],\"\\n\",[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"backgroundColor\":\"#fff\",\"color\":\"#24292e\"},\"tabIndex\":\"0\",\"data-language\":\"csharp\",\"data-theme\":\"github-light\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"csharp\",\"data-theme\":\"github-light\",\"style\":{\"display\":\"grid\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" class\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" UserAccessor\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\":\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"IUserAccessor\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"private\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" readonly\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" IUserRepository\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" userRepository\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"private\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" readonly\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" IRunningContext\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" runningContext\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"private\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" readonly\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" IUnitOfWork\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" unitOfWork\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" ; \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"private\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" readonly\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" IUserManager\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" userManager\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"private\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" readonly\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" IEmailProvider\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" emailProvider\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" UserAccessor\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"IRunningContext\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" runningContext\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\",\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"IUnitOfWork\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" unitOfWork\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\", \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"IUserRepository\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" repository\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\", \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"IUserManager\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" userManager\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\", \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"IEmailProvider\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" emailProvider\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\") { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005CC5\"},\"children\":\"this\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\".runningContext \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" runningContext; \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005CC5\"},\"children\":\"this\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\".unitOfWork \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" unitOfWork; \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005CC5\"},\"children\":\"this\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\".userRepository \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" repository; \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005CC5\"},\"children\":\"this\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\".userManager \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" userManager; \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005CC5\"},\"children\":\"this\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\".emailProvider \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" emailProvider; } \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" async\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" Task\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"IdentityResult\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"CreateASync\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"ApplicationUser\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" user\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\") { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"return\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" await\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005CC5\"},\"children\":\" this\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\".userManager.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"CreateASync\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(user); } \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6A737D\"},\"children\":\"//... public void Update(ApplicationUser userAccount) { this.userRepository.Update(userAccount); this.unitOfWork.Commit(); } } \"}]]}]}]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Here is a code that show the difference between the creation of a user and an update.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"This is it for the user. I will write later with external login when everything will be working correctly. So far, I had to do some weird thing to make it works.\"}],\"\\n\",[\"$\",\"h1\",null,{\"children\":\"SPRINT 2: CREATING THE FIRST ENTITY March 10, 2014 By: pdesjardins\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Creating the first entity has always something different from others entities. The reason is that a lot of the infrastructure is not yet in place. The first entity chose is the Contest entity. It is a very complex class that use others entities. Before going any deeper, let’s see the class diagram for the Contest that was planned to use.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"img\",null,{\"src\":\"/images/blog/Classes_Contest-1024x573.png\",\"alt\":\"\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"As we can see, we firstly wanted to use inheritance for different type of contest. However, this is what will be done.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"img\",null,{\"src\":\"/images/blog/LayersBourseVirtuelle.png\",\"alt\":\"\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"In fact, we have a contest class that use other classes. This simplify by a lot the use of contest with Entity Framework but also because we want to have contest with Option and Short and Stock or maybe a combination of some of them but not all. Having inheritance would require to have ContestWithStock having inheritance with ContestWithOption or vice versa but also all others different scenario. The concrete implementation of this architecture is mostly all in the Model project, inside the Entities folder.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"img\",null,{\"src\":\"/images/blog/Part2Project.png\",\"alt\":\"\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"img\",null,{\"src\":\"/images/blog/Classes_Contest-1024x573.png\",\"alt\":\"\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"As the diagram shows, Contest, ContestTransactionRules, ContestRegistrationRules and models classes like ContestWithOption, ContestWithStock and ContestWithShort inherit from ValidatableModel which has the Validate method and ValidateChildren. This mean that Contest will have inside its ValidateChildren a call to ContestWithStock, ContestWithShort and ContestWithOption but only if these one are required to be validated. This mean that if the contest does not allows options, than we will not validate options.\"}],\"\\n\",[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"backgroundColor\":\"#fff\",\"color\":\"#24292e\"},\"tabIndex\":\"0\",\"data-language\":\"csharp\",\"data-theme\":\"github-light\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"csharp\",\"data-theme\":\"github-light\",\"style\":{\"display\":\"grid\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" override\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" IEnumerable\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" ValidateChildren\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"() { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"var\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" r\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" new\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" List\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(); \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"if\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(StockRules \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"!=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005CC5\"},\"children\":\" null\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\") r.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"AddRange\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(StockRules.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Validate\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"()); \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"if\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(OptionRules \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"!=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005CC5\"},\"children\":\" null\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\") r.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"AddRange\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(OptionRules.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Validate\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"()); \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"if\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(ShortRules \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"!=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005CC5\"},\"children\":\" null\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\") r.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"AddRange\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(ShortRules.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Validate\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"()); \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"if\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(RegistrationRules \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"!=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005CC5\"},\"children\":\" null\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\") r.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"AddRange\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(RegistrationRules.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Validate\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"()); \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"if\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(TransactionsRules \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"!=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005CC5\"},\"children\":\" null\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\") r.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"AddRange\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(TransactionsRules.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Validate\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"()); \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"return\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" r; } \"}]]}]}]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"This is the ValidateChildren of the Contest. What is interesting is that it is easy to unit test since every different parts can be tested independently. Still, the Contest has its own validation in its Validate method.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Complex Type Another challenge of this sprint was the use of complex type. We have two complex types that is used by the Contest. The first one is a concept that I had already used and it concerns localized string. The LocalizedString is a class that has a property for each language supported. In this case, we have a French and English property. The system know which one to use because it has a Current property that select the good one depending of the current thread culture. What is interesting is since it is a complex type we have both property inside the entity that use this one. For example, the Contest table will have two fields like the following screenshot.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"ContestTableWithLocalizedString\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"The challenge was more for the new complex type which is Money. The money type was harder because it has to use currency that come from Value Object. The problem is that complex object cannot use navigation property. It also need to have a reference to Value Object that is in the Model namespace. The problem is that Model reference the namespace ComplexTypes. Circular reference appears! To solve this problem, a new namespace has been created : “ComplexTypeWithValueObjects”. The second problem is solved by having the Money with a property to the ValueObject but it will not be mapped by Entity Framework with this property but with a Integer field that will not be associated to anything. Without the limitation of Entity Framework with Complex type and navigation property it would have been a Foreign Key, but this time we will save the entity id without navigation property. This is why you can see in the previous screenshot that the table has a field at the end without a foreign key for the currency.\"}],\"\\n\",[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"backgroundColor\":\"#fff\",\"color\":\"#24292e\"},\"tabIndex\":\"0\",\"data-language\":\"csharp\",\"data-theme\":\"github-light\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"csharp\",\"data-theme\":\"github-light\",\"style\":{\"display\":\"grid\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" class\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" Money\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" decimal\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" Value\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"get\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"set\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; } \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" int\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" CurrencyTypeId\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"get\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"return\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005CC5\"},\"children\":\" this\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\".Currency.Id; } \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"set\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005CC5\"},\"children\":\"this\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\".Currency \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" CurrencyType.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"GetCurrencyFromId\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(value); } } \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6A737D\"},\"children\":\"/// \u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#22863A\"},\"children\":\"summary\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6A737D\"},\"children\":\"\u003e /// This is ignored by EntityFramework /// \u003c/\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#22863A\"},\"children\":\"summary\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6A737D\"},\"children\":\"\u003e public CurrencyType Currency { get; set; } } \"}]]}]}]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"The setter use a method that convert a integer to the value object. This way, we do not need to have the foreign key to have the full object loaded. We can do this only because we use Value Object and that we do have everything in the code.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"For the rest of the sprint, we still work on the Contest entity but more visually. The view is also new with this sprint and this first entity because we have to play for the first time with BootStrap but also to create shared editor templates for all complex types. This sprint will not be the fastest one but it is totally acceptable since we are setuping the project core for a lot of features that will be reused by code or by concept.\"}],\"\\n\",[\"$\",\"h1\",null,{\"children\":\"SPRINT 2 : A FIRST EXPERIENCE WITH THE UI March 17, 2014 By: pdesjardins\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"During the Sprint 2 we had to develop the creation of a contest. In the last post, we had to create the Contest entity. This was harder than planned and it was the same for the UI. The reason is the same as for the entity : the first entity, backend or frontend, takes more time.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"This project is built with BootStrap. This library is very awesome for having a fast development of an application that works on multiple browsers and multiple platforms (like tablet, phone, computer). The problem with BootStrap is that if you want something a little bit different form the base, it requires some work. This is the first project that I have to use BootStrap 3. BootStrap 3 is oriented for smaller device first (mobile). During the creation of the contest screen, I had something that I wanted. I wanted something that work file with some of our entities like the LocalizedString which has 2 fields for a single property. Here is what I wanted for the mobile and what I wanted for tablet and desktop.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Mobile: BootStrapContestMobile Desktop: BootStrapContestDesktop\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"As you can see, the name as something different. This was a huge matter with BootStrap that would have be easier to do in plain CSS. However, the goal is to have the mobile version to work with the label at the top of inputs. This is where BootStrap shines. Without having to have two layouts, html elements change position.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"How To Work With BootStrap The easier way to create a design that you have in you head into Visual Studio is to first create this one outside Visual Studio! Yes. It easier to not have in your arms to manage editor templates, html helpers and the binding. Simple create a .html file, add BootStrap styles sheet and JavaScript.\"}],\"\\n\",[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"backgroundColor\":\"#fff\",\"color\":\"#24292e\"},\"tabIndex\":\"0\",\"data-language\":\"html\",\"data-theme\":\"github-light\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"html\",\"data-theme\":\"github-light\",\"style\":{\"display\":\"grid\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#22863A\"},\"children\":\"html\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e \u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#22863A\"},\"children\":\"head\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e \u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#22863A\"},\"children\":\"link\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" href\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032F62\"},\"children\":\"\\\"bootstrap.css\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" rel\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032F62\"},\"children\":\"\\\"stylesheet\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e \u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#22863A\"},\"children\":\"style\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" type\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032F62\"},\"children\":\"\\\"text/css\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#22863A\"},\"children\":\"body\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005CC5\"},\"children\":\"padding\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\":\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005CC5\"},\"children\":\"30\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"px\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; } \u003c/\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#22863A\"},\"children\":\"style\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e \u003c/\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#22863A\"},\"children\":\"head\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e \u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#22863A\"},\"children\":\"body\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6A737D\"},\"children\":\"\u003c!-- HERE YOUR CODE --\u003e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" \u003c/\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#22863A\"},\"children\":\"body\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e \u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#22863A\"},\"children\":\"script\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" src\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032F62\"},\"children\":\"\\\"bootstrap.js\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e\u003c/\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#22863A\"},\"children\":\"script\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e \u003c/\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#22863A\"},\"children\":\"html\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e \"}]]}]}]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"This is the same template you can use for all your pages. I added in the header a style element. I would never do this in a real project, but to have fun with BootStrap, it’s faster. Now, it is the time to remove the “Here Your Code” comment with BootStrap.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"The first component used is the panel. This create a division with a border and a title. That’s it. This is perfect because since the contest entity does have several sub object, a panel by object will be perfect.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Before doing anything you must do your BootStrap into a division that has the “container”. This will place your form in the middle of the page. Then, you must create some division for the panel. Details can be found on BootStrap but to be short you have one contain and one for the header and one for the body.\"}],\"\\n\",[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"backgroundColor\":\"#fff\",\"color\":\"#24292e\"},\"tabIndex\":\"0\",\"data-language\":\"html\",\"data-theme\":\"github-light\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"html\",\"data-theme\":\"github-light\",\"style\":{\"display\":\"grid\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#22863A\"},\"children\":\"div\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" class\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032F62\"},\"children\":\"\\\"panel panel-default\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e \u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#22863A\"},\"children\":\"div\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" class\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032F62\"},\"children\":\"\\\"panel-heading\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003eGeneral Information\u003c/\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#22863A\"},\"children\":\"div\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e \u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#22863A\"},\"children\":\"div\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" class\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032F62\"},\"children\":\"\\\"panel-body\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6A737D\"},\"children\":\"\u003c!-- HERE YOUR CODE --\u003e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" \u003c/\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#22863A\"},\"children\":\"div\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e \u003c/\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#22863A\"},\"children\":\"div\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e \"}]]}]}]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"LocalizedString Control The first control for the contest entity is the name. This one is for the LocalizedString complex type. Since we want to have this control in a single line, we start with a division that has the “row” class. We will not use form-group class directly because we have something particular with this control. We have a label that is for the control and then 2 labels and inputs.\"}],\"\\n\",[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"backgroundColor\":\"#fff\",\"color\":\"#24292e\"},\"tabIndex\":\"0\",\"data-language\":\"html\",\"data-theme\":\"github-light\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"html\",\"data-theme\":\"github-light\",\"style\":{\"display\":\"grid\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":\" \"}]}]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"At first, I started with the col-xs-12 without doing anything for bigger resolution (sm). I wanted to have the name label that takes the whole line. The same for the labels for all languages and inputs. This is why col-xs-12 is used. It takes the whole 12 columns that a grid has. This is not the same behavior for the small resolution and higher. In that case, we want to take only 2 columns for the main label and then the rest of the 10 columns for the label-input. What is important is to have columns into row every times.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"From there, if everything is rendered correctly, than you can create a Html Helper that will help you to create this kind of behavior with property with dual-label and another one for a single label-input type.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Creating Asp.Net MVC Html Helpers for BootStraper You will repeat a lot of times this layout with a single layout and a single output. You may also repeat this LocalizedString that has more than one input for a single property. This is where Asp.Net MVC can make your life easier by creating Asp.Net Html Helper.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"This way, the contest view can be clean and easy to change later on by modifying only a single place (the html placeholder) and affecting every pages. Here is a snippet of the contest view.\"}],\"\\n\",[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"backgroundColor\":\"#fff\",\"color\":\"#24292e\"},\"tabIndex\":\"0\",\"data-language\":\"html\",\"data-theme\":\"github-light\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"html\",\"data-theme\":\"github-light\",\"style\":{\"display\":\"grid\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":\" \"}]}]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"As you can see, the property Name is of type LocalizedString, and InitialCapital and OrderType are both from a single value type. We do use two different Html Helpers to generate the BootStrap layout. If in the future we change the layout, all pages that use these Html Helpers will be affected easily without having to modify several pages. It has also the advantage to have a good separation of concern where the Html Helper handle the creation of Html controls while the page has the page layout goal. Nevertheless, the big disadvantage is the the Html Helper code is a mess to understand. It is a lot easier to read html tag not inside C# code. Here is the Html Helper Code.\"}],\"\\n\",[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"backgroundColor\":\"#fff\",\"color\":\"#24292e\"},\"tabIndex\":\"0\",\"data-language\":\"csharp\",\"data-theme\":\"github-light\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"csharp\",\"data-theme\":\"github-light\",\"style\":{\"display\":\"grid\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" MvcHtmlString\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" FormGroupWithSeveralSubProperties\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"TProperty\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\", \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"TPropertyExpression\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Expression\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Func\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"TModel\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\", \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"TProperty\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e\u003e \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"mainPropertyExpression\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\", \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"params\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" Expression\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Func\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"TModel\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\", \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"TPropertyExpression\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e\u003e[] \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"expressions\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\") { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"var\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" mainPropertyMetaData\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" ModelMetadata.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"FromLambdaExpression\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(mainPropertyExpression, htmlHelper.ViewData); \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6A737D\"},\"children\":\"$11\"}]]}]}]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"What is very important is that the HtmlHelper still use the EditorFor template that use Shared Editor Template. This way, we can define by type or with UIHint attribute what to display within the BootStrap structure. This is important to not directly use TextBoxFor or any other HtmlHelpers because we want to be able to reuse this BootStrap Html Helper without having to create one for every possible type.\"}],\"\\n\",[\"$\",\"h1\",null,{\"children\":\"SPRINT 2 : USING THE BUILDER IN SERVICE LAYER March 24, 2014 By: pdesjardins\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"When developing unit testing you have to reuse a lot of time the same configuration for your entities. This is why multiple patterns exist to create your entities. A simple one is to have a Builder for your Models and one for your View Models.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"img\",null,{\"src\":\"/images/blog/Builders.png\",\"alt\":\"\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"In this solution, I decided to create two projects. One for the Model and one for the ViewModel. I divide the project per entities. To keep it simple, I create static method that return for different scenario. Here are some signatures that I currently have for the Contest entity.\"}],\"\\n\",[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"backgroundColor\":\"#fff\",\"color\":\"#24292e\"},\"tabIndex\":\"0\",\"data-language\":\"csharp\",\"data-theme\":\"github-light\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"csharp\",\"data-theme\":\"github-light\",\"style\":{\"display\":\"grid\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" static\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" Model\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Entities\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Contest\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Contest\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" GetAStockContest\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"() public static Model.Entities.Contest.Contest GetAStockShortOptionContest() public static Model.Entities.Contest.Contest GetANewContest() public static Model.Entities.Contest.Contest GetDefaultNewContest() public static ContestWithOption GetAnOptionRules() public static ContestWithShort GetAShortRules() public static ContestTransactionRules GetACorrectTransactionRules() public static ContestRegistrationRules GetACorrectRegistrationRules() public static ContestWithStock GetACorrectStockRules() \"}]]}]}]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"As you can notice, the first 4 methods return a contest while the rest of the method does not. In fact, the four first methods use these other methods to get property filled up. For example, all these contests has transaction rule so they can use this builder. In a case that you do not want transaction, you can set to NULL the property or create a new GetContestWithoutTransaction() method.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"It is up to you. What is it important is that you do not repeat yourself in all your tests. What is new in this sprint is that I used the builder into the service layer to return a new contest with default values. This way, the builder can be unit tested to be sure what are the expected default value returned but also to do tests.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"This is the code in the service code.\"}],\"\\n\",[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"backgroundColor\":\"#fff\",\"color\":\"#24292e\"},\"tabIndex\":\"0\",\"data-language\":\"csharp\",\"data-theme\":\"github-light\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"csharp\",\"data-theme\":\"github-light\",\"style\":{\"display\":\"grid\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" Contest\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" New\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"() { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"var\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" newContest\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" ModelBuilders.Contest.ContestModelBuilder.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"GetDefaultNewContest\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(); \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"return\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" newContest; } \"}]]}]}]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"This change required to modify the architecture layer to allow the service layer to access the Model Builder project. This is all fine with me since it already have access to the model layer that the builder uses.\"}],\"\\n\",[\"$\",\"h1\",null,{\"children\":\"SPRINT 2 : IMPROVING DATA ANNOTATION, UNIT TESTING AND VIEW MODEL March 31, 2014 By: pdesjardins\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"This week I have improved a lot of different thing that was all related to the Contest entity. This is one of the last sprint we have for the creation and edition of the contest. It was the first entity that we had to create everything from the view to the database. This is always a lot more time consuming for the first entity. Not only we have to work on the UI and setup everything for the future to have a consistent layout but we also have to do this for unit testing, model, view model and Entity Framework.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Data Annotation Improvement One thing that was problematic was the validation that specify that a Contest starting date must be after the current date. This is always the case for new contest. However, if we edit a contest few time later, the starting date should not change and will be after the current date. The initial validation of the starting date was done by a custom Data Validation attribute.\"}],\"\\n\",[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"backgroundColor\":\"#fff\",\"color\":\"#24292e\"},\"tabIndex\":\"0\",\"data-language\":\"csharp\",\"data-theme\":\"github-light\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"csharp\",\"data-theme\":\"github-light\",\"style\":{\"display\":\"grid\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" [\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"DateAfterOrCurrentDate\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"] \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" DateTime StartingTime { get; set; } \"}]]}]}]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"To modify this we need to know if we are editing or not for the first time the entity. The ContestRegistrationRules, that has the StartingTime property to validate, does not have any ID or date because it is saved inside the Contest table. It is divided only in the code. We had something for any model class to know if they are new because they inherit from IModel that has a IsNew method. However, this was problematic to implement for ContestRegistrationRules because this one inherit from IEntity that has a ID property that we do not want for the ContestRegistrationRules.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"This is where we had to modify the classes. First of all, it was a mistake to think that IModel that has the IsNew method must inherit from IEntity. It does not mean that every time we want to check the IsNew from the ID.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"img\",null,{\"src\":\"/images/blog/ModelState-1024x436.png\",\"alt\":\"\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"The modification add a new Interface and mode the IsNew from IModel into IModelState. This way, it is possible for a class, like the ContestRegistrationRules to inherit from IModelState without inheriting from IEntity or IModel. From there, we can pass the information from the Contest into the ContestRegistrationRules or during unit testing simply mock this value. Here is the code of the Contest now.\"}],\"\\n\",[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"backgroundColor\":\"#fff\",\"color\":\"#24292e\"},\"tabIndex\":\"0\",\"data-language\":\"csharp\",\"data-theme\":\"github-light\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"csharp\",\"data-theme\":\"github-light\",\"style\":{\"display\":\"grid\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" class\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" Contest\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" : \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Implementations\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Model\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\", \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"IValidatableObject\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"private\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" ContestRegistrationRules\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" registrationRules\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" Contest\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"() { RegistrationRules \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" new\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" ContestRegistrationRules\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005CC5\"},\"children\":\"this\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"); \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6A737D\"},\"children\":\"//... } //... [Required] public ContestRegistrationRules RegistrationRules { get { return registrationRules; } set { registrationRules = value; registrationRules.ContestState = this; } } } \"}]]}]}]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"The property is internal, which limit the case that you can set the state from the external. The constructor of the Contest allow Entity Framework to instantiate this one and send the information to the children without a problem.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"For the unit test, it is now possible to test for new and existing ContestRegistrationRules the same rule. Here is the two tests that validate the same rule.\"}],\"\\n\",[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"backgroundColor\":\"#fff\",\"color\":\"#24292e\"},\"tabIndex\":\"0\",\"data-language\":\"csharp\",\"data-theme\":\"github-light\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"csharp\",\"data-theme\":\"github-light\",\"style\":{\"display\":\"grid\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" [\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"TestMethod\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"] \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" void\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" GivenANewContestWithRegistration_WhenContestRegistrationStartingTimeIsBeforeNow_ThenReturnValidationResult\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"() { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6A737D\"},\"children\":\"$12\"}]]}]}]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"As you can see, not a lot change. In fact, just the constructor that take if it is a new or not.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Of course, the attribute has changed too. Now, it verifies the state before doing any validation.\"}],\"\\n\",[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"backgroundColor\":\"#fff\",\"color\":\"#24292e\"},\"tabIndex\":\"0\",\"data-language\":\"csharp\",\"data-theme\":\"github-light\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"csharp\",\"data-theme\":\"github-light\",\"style\":{\"display\":\"grid\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#6A737D\"},\"children\":\"$13\"}]}]}]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"The new code is at the top where it check if the class that has the property to validate has the interface. If not, we validate. If it does have it, we verify if it is a new instance. In that case, we do all validation. In the case of being not a new instance, we skip the validation. This way, when editing something that was valid during the creation like the time that the contest start will not fail if you edit something like the name of the contest few months later.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Controller that help common Value Object Something else changed concerning the Controller and how it can help to fill up information for view model. We are using view model for many reasons and one of the reason is to be able to give list of choice. For example, I want to give a list of possible stock exchange market and allow the use to create a contest with a set of market that can be used. The model has the markets for the contest but does not hold all possibles market. The list of possible market are only required for choosing in the interface. This is why it is the role of the controller to provide the list to the view. This is done by filling the view model. This is the case for creating but also when editing a Contest.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"This is the case for a lot of value object. This is why instead of inheriting of ModelViewModelMappingController I create a new controller that has some methods that can be used to set lists.\"}],\"\\n\",[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"backgroundColor\":\"#fff\",\"color\":\"#24292e\"},\"tabIndex\":\"0\",\"data-language\":\"csharp\",\"data-theme\":\"github-light\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"csharp\",\"data-theme\":\"github-light\",\"style\":{\"display\":\"grid\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" class\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" ModelViewModelMappingWithValueObjectsController\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"TModel\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\", \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"TViewModel\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e : \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"ModelViewModelMappingController\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"TModel\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\",\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"TViewModel\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"where\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" TModel\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" : \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"IValidatableModel\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" ModelViewModelMappingWithValueObjectsController\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"IMapperFacade\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" mapperFacade\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\", \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"IRunningContext\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" runningContext\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\") : \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005CC5\"},\"children\":\"base\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(mapperFacade, runningContext) { } \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"protected\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" void\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" FillUpMarkets\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"List\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" availableItems\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\") { availableItems.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Add\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"new\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" SelectorItem\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(Mapper.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Map\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"MarketType\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\", \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"MarketTypeViewModel\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e(MarketType.UsMarketType))); availableItems.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Add\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"new\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" SelectorItem\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(Mapper.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Map\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"MarketType\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\", \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"MarketTypeViewModel\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e(MarketType.Toronto))); availableItems.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Add\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"new\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" SelectorItem\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(Mapper.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Map\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"MarketType\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\", \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"MarketTypeViewModel\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e(MarketType.Vancouver))); availableItems.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Add\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"new\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" SelectorItem\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(Mapper.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Map\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"MarketType\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\", \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"MarketTypeViewModel\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e(MarketType.OTCBB))); availableItems.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Add\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"new\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" SelectorItem\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(Mapper.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Map\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"MarketType\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\", \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"MarketTypeViewModel\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e(MarketType.PinkSheet))); } \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"protected\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" void\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" FillUpOrderTypes\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"List\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" availableItems\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\") { availableItems.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Add\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"new\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" SelectorItem\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(Mapper.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Map\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"OrderType\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\", \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"OrderTypeViewModel\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e(OrderType.LimitOrderOnly))); availableItems.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Add\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"new\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" SelectorItem\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(Mapper.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Map\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"OrderType\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\", \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"OrderTypeViewModel\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e(OrderType.MarketLimitOrderOnly))); availableItems.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Add\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"new\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" SelectorItem\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(Mapper.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Map\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"OrderType\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\", \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"OrderTypeViewModel\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e(OrderType.MarketOrderOnly))); } \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"protected\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" void\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" FillUpCurrencies\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"List\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" availableItems\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\") { availableItems.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Add\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"new\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" SelectorItem\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(Mapper.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Map\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"CurrencyType\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\", \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"CurrencyTypeViewModel\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e(CurrencyType.Canada))); availableItems.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Add\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"new\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" SelectorItem\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(Mapper.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Map\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"CurrencyType\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\", \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"CurrencyTypeViewModel\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e(CurrencyType.UnitedStatesOfAmerica))); } } \"}]]}]}]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"It is now a lot cleaner in controller. Here is the Create and Edit action method of the Contest controller.\"}],\"\\n\",[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"backgroundColor\":\"#fff\",\"color\":\"#24292e\"},\"tabIndex\":\"0\",\"data-language\":\"csharp\",\"data-theme\":\"github-light\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"csharp\",\"data-theme\":\"github-light\",\"style\":{\"display\":\"grid\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" [\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"HttpGet\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"] \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" ActionResult\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" Create\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"() { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"var\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" defaultContest\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005CC5\"},\"children\":\" this\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\".contestService.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"New\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(); \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"var\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" defaultContestViewModel\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005CC5\"},\"children\":\" this\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\".MapperFacade.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"GetViewModel\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Contest\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\", \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"ContestEditableViewModel\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e(defaultContest); \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005CC5\"},\"children\":\"this\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"FillUpWithAllList\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(defaultContestViewModel); \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"return\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" View\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(defaultContestViewModel); } [\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"HttpGet\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"] \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" ActionResult\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" Edit\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"int\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" id\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\") { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"var\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" contestToEdit\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005CC5\"},\"children\":\" this\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\".contestService.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"GetContestById\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(id); \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"var\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" viewModel\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005CC5\"},\"children\":\" this\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\".MapperFacade.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"GetViewModel\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Contest\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\",\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"ContestEditableViewModel\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e(contestToEdit); \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"FillUpWithAllList\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(viewModel); \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"return\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" View\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(viewModel); } \"}]]}]}]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"View Model and Titles Another issue I had was that I do not want the view, neither to use ViewBag to specify the title of the view. I also wanted to have page title and sub title that may be different from the title set to the browser. This is why it is now possible to inherit from a viewmodel named WebPageViewModel. It has three properties that is used by the layout and others views.\"}],\"\\n\",[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"backgroundColor\":\"#fff\",\"color\":\"#24292e\"},\"tabIndex\":\"0\",\"data-language\":\"csharp\",\"data-theme\":\"github-light\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"csharp\",\"data-theme\":\"github-light\",\"style\":{\"display\":\"grid\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6A737D\"},\"children\":\" /// \u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#22863A\"},\"children\":\"summary\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6A737D\"},\"children\":\"\u003e /// Contains information that is passed from the controller to the view that should be only uni-directionnal. The purpose of this class /// is to have common information that is required for most pages to be displayed into views or main layout. /// \u003c/\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#22863A\"},\"children\":\"summary\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6A737D\"},\"children\":\"\u003e public class WebPageViewModel:ViewModel { /// \u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#22863A\"},\"children\":\"summary\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6A737D\"},\"children\":\"\u003e /// This is the title that is displayed in the browser title /// \u003c/\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#22863A\"},\"children\":\"summary\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6A737D\"},\"children\":\"\u003e public string PageTitle { get; set; } /// \u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#22863A\"},\"children\":\"summary\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6A737D\"},\"children\":\"\u003e /// This is the main h1 of the page /// \u003c/\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#22863A\"},\"children\":\"summary\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6A737D\"},\"children\":\"\u003e public string PageHeader { get; set; } /// \u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#22863A\"},\"children\":\"summary\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6A737D\"},\"children\":\"\u003e /// This is the specification for the title. It is not required. /// \u003c/\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#22863A\"},\"children\":\"summary\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6A737D\"},\"children\":\"\u003e public string PageSubHeader { get; set; } } \"}]]}]}]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"In the layout, and header partial class, it is now possible to use this information.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"First of all, I have in the Contest view:\"}],\"\\n\",[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"backgroundColor\":\"#fff\",\"color\":\"#24292e\"},\"tabIndex\":\"0\",\"data-language\":\"html\",\"data-theme\":\"github-light\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"html\",\"data-theme\":\"github-light\",\"style\":{\"display\":\"grid\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"@{ Html.Custom().SetHeader(Model); } \"}]}]}]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"This allow to have for any view model passed into a view to set the information into a generic way : view bag. This could be improved later on. It has also the disadvantage to have to call this html extension for all your view. The problem is that the layout.cshtml cannot use the view model of the content.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"The partial class for the header verify if the header is set and if the sub header is set. Depending of the value, it is displayed or not.\"}],\"\\n\",[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"backgroundColor\":\"#fff\",\"color\":\"#24292e\"},\"tabIndex\":\"0\",\"data-language\":\"html\",\"data-theme\":\"github-light\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"html\",\"data-theme\":\"github-light\",\"style\":{\"display\":\"grid\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#22863A\"},\"children\":\"header\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e \u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#22863A\"},\"children\":\"div\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" class\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032F62\"},\"children\":\"\\\"container\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e \u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#22863A\"},\"children\":\"img\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" id\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032F62\"},\"children\":\"\\\"titre_img\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" src\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032F62\"},\"children\":\"\\\"@Url.Content(\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"~\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#B31D28\",\"fontStyle\":\"italic\"},\"children\":\"/Content/Images/Logo/BourseVirtuelle.png\\\")\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" alt\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032F62\"},\"children\":\"\\\"Logo\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" /\u003e @{ Html.RenderPartial(\\\"_Menu\\\"); } @{ var headerTitle = ViewBag.HeaderTitle; var headerSubTitle = ViewBag.HeaderSubTitle; if (!string.IsNullOrWhiteSpace(headerTitle)) { \u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#22863A\"},\"children\":\"div\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" id\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032F62\"},\"children\":\"\\\"header-title\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e \u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#22863A\"},\"children\":\"h1\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e @headerTitle @if (!string.IsNullOrWhiteSpace(headerSubTitle)) { \u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#22863A\"},\"children\":\"small\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e@headerSubTitle\u003c/\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#22863A\"},\"children\":\"small\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e } \u003c/\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#22863A\"},\"children\":\"h1\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e \u003c/\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#22863A\"},\"children\":\"div\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e \u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#22863A\"},\"children\":\"hr\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"/\u003e } } \u003c/\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#22863A\"},\"children\":\"div\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e \u003c/\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#22863A\"},\"children\":\"header\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e \"}]]}]}]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Conclusion This sprint is about to conclude. Some work is still required to make the edition work but it is only small detail since all Unit Test has been done. Even code for Entity Framework has been unit tested.\"}],\"\\n\",[\"$\",\"h1\",null,{\"children\":\"SPRINT 3 : IMPROVE THE TESTABILITY OF YOUR REPOSITORIES April 7, 2014 By: pdesjardins\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"This first week of the sprint 3 aimed the contests entity. More precisely how to get from the database active contests and inactive one. This required to modify a little bit the Model Builder, the RunningContext, and TestBase.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Why all these modifications in the sprint 3? Mostly because to test the repository with the contest that we need to have more than only one contest in the database and depending of the test we want to have different contests. For example, we may want to have contest with a starting and ending date before the testing date. I have say “testing time” and not “current time”. This is important and this is why in this sprint the Model Builder has changed. Now, the builder have access to the running contest. This is why Model Builder is not anymore static and it takes in its constructor the IRunningContext.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"img\",null,{\"src\":\"/images/blog/Sprint3BuilderCrossLayer-1024x504.png\",\"alt\":\"\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"The ContestBuilder looks like this:\"}],\"\\n\",[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"backgroundColor\":\"#fff\",\"color\":\"#24292e\"},\"tabIndex\":\"0\",\"data-language\":\"csharp\",\"data-theme\":\"github-light\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"csharp\",\"data-theme\":\"github-light\",\"style\":{\"display\":\"grid\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" class\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" ContestModelBuilder\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"private\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" IRunningContext\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" runningContext\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" IRunningContext\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" RunningContext\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"get\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"return\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" runningContext; } \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"set\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"if\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" (value \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"==\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005CC5\"},\"children\":\" null\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\") { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"throw\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" new\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" NullReferenceException\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032F62\"},\"children\":\"\\\"Running Contest must be set before using this method\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"); } runningContext \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" value; } } \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" ContestModelBuilder\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"IRunningContext\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" runningContest\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\") { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005CC5\"},\"children\":\"this\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\".RunningContext \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" runningContest; } \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6A737D\"},\"children\":\"//... } \"}]]}]}]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"This would be te case for all builders. In fact, it will end that all ModelBuilder will inherit from ModelBuilder that will have the IRunningContext instead of having the IRunningContext in each builder.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"The other modification to be able to test easily was to create automatic rollback to every unit test for the repository. This can be done by creating a TestWithDatabase class. This class allows to have unit of works, repositories, running context and builders.\"}],\"\\n\",[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"backgroundColor\":\"#fff\",\"color\":\"#24292e\"},\"tabIndex\":\"0\",\"data-language\":\"csharp\",\"data-theme\":\"github-light\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"csharp\",\"data-theme\":\"github-light\",\"style\":{\"display\":\"grid\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" class\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" TestWithDatabase\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" const\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" string\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" CONNECTION_STRING_NAME\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032F62\"},\"children\":\" \\\"DefaultConnection\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6A737D\"},\"children\":\"$14\"}]]}]}]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"The trick about rollbacking is to be in a transaction from the start of the unit test and to not complete at the end. In the code above, we have set a TestInitialize and TestCleanup to start and stop the transaction scope. This way, we are sure that everything tested is never persisted in the database.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Having this setup, it is now possible to modify some of the existing test to remove the transaction scope and let the base class to execute the one we just set.\"}],\"\\n\",[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"backgroundColor\":\"#fff\",\"color\":\"#24292e\"},\"tabIndex\":\"0\",\"data-language\":\"csharp\",\"data-theme\":\"github-light\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"csharp\",\"data-theme\":\"github-light\",\"style\":{\"display\":\"grid\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" [\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"TestMethod\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"] \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" void\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" GivenANewContest_WhenContestIsLegitToSave_ThenTheDatabaseHasANewContest\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"() { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6A737D\"},\"children\":\"// Arrange var repositoryExecuting = new ContestRepository(unitOfWorkForInsertion, base.runningContext.Object); var repositoryReading = new ContestRepository(unitOfWorkForReading, base.runningContext.Object); var contest = contestModelBuilder.GetAStockContest(); int idSaved=-1; // Act try { repositoryExecuting.Save(contest); unitOfWorkForInsertion.Commit(); idSaved = contest.Id; } catch (Exception e) { Assert.Fail(e.Message); } var contestFromRepository = repositoryReading.GetById(idSaved); var countContest = repositoryReading.GetCount(); // Assert Assert.IsNotNull(contestFromRepository); Assert.AreEqual(1, countContest); } \"}]]}]}]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"This unit test will not store anything in the database and do the job automatically to remove everything. It is not possible for a developer to store anything in the database which is a huge advantage to keep the testing database clean.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"The next modification is that we need to have some contests in the database for some of our tests. The problem is that we need to save contest that might not be valid to save. For example, one of the business logic is that we cannot insert a new contest that has a starting and ending date before the current date. This is required to have contest with a starting and ending date before the current date because this is considerate an inactive contest. We want to test method that return only the active contest but to do the test, we want to insert inactive too. This is why we have changed the \",[\"$\",\"img\",null,{\"src\":\"/images/blog/FirstCommit.png\",\"alt\":\"\"}]]}],\"\\n\",[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"backgroundColor\":\"#fff\",\"color\":\"#24292e\"},\"tabIndex\":\"0\",\"data-language\":\"csharp\",\"data-theme\":\"github-light\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"csharp\",\"data-theme\":\"github-light\",\"style\":{\"display\":\"grid\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" void\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" Commit\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"bool\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" isValidatingBeforeSave\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005CC5\"},\"children\":\"true\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\") { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"if\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" (isValidatingBeforeSave) { context.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"SaveChanges\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(); } \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"else\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" { context.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"SaveChangesWithoutValidation\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(); } } \"}]]}]}]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"The contest has two save methods. One is SaveChanges that we had previously and the new SaveChangesWithoutValidation. Here is a part of the MainDbContext:\"}],\"\\n\",[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"backgroundColor\":\"#fff\",\"color\":\"#24292e\"},\"tabIndex\":\"0\",\"data-language\":\"csharp\",\"data-theme\":\"github-light\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"csharp\",\"data-theme\":\"github-light\",\"style\":{\"display\":\"grid\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" int\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" SaveChangesWithoutValidation\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"() { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"var\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" result\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" -\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005CC5\"},\"children\":\"1\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005CC5\"},\"children\":\"this\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\".Configuration.ValidateOnSaveEnabled \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005CC5\"},\"children\":\" false\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"try\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" { result \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005CC5\"},\"children\":\" this\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"SaveChanges\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(); } \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"catch\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"throw\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; } \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"finally\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005CC5\"},\"children\":\"this\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\".Configuration.ValidateOnSaveEnabled \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005CC5\"},\"children\":\" true\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; } \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"return\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" result; } \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"int\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" IMainDbContext.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"SaveChanges\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"() { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"return\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005CC5\"},\"children\":\" this\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"SaveChanges\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(); } \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" override\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" int\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" SaveChanges\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"() { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"IEnumerable\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"DbEntityValidationResult\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"errors\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" new\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" List\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"DbEntityValidationResult\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e(); \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"if\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" (\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005CC5\"},\"children\":\"this\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\".Configuration.ValidateOnSaveEnabled) { errors \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005CC5\"},\"children\":\" this\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"GetValidationErrors\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(); } \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"if\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" (\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"!\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"errors.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Any\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"()) { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"try\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6A737D\"},\"children\":\"//base.ChangeTracker.DetectChanges(); return base.SaveChanges(); } catch (OptimisticConcurrencyException concurrencyException) { throw new DatabaseConcurrencyException(\\\"Someone else has edited the entity in the same time of you. Please refresh and save again.\\\", concurrencyException); } catch (DBConcurrencyException concurrencyException) { throw new DatabaseConcurrencyException(\\\"Someone else has edited the entity in the same time of you. Please refresh and save again.\\\", concurrencyException); } catch (DbUpdateConcurrencyException e) { throw new DatabaseConcurrencyException(\\\"Someone else has edited the entity in the same time of you. Please refresh and save again.\\\", e); } catch (Exception) { throw; } } else { throw new DatabaseValidationErrors(errors); } } \"}]]}]}]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"As you can see, the SaveChangesWithoutValidation call the same SaveChanges but set the Entity Framework Configuration value to indicate if we must validate or not during the save. The trick is to set the code to rollback the property ValidateOnSaveEnabled to true in the finally. This way, even if something wrong appears that the system will validate for the next save.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"The last modification require was to be able to create contest easily into the database. This is why some helper method has been created in the ContestRepositoryIntegrationTest.cs. This way, we can have a test like the following one:\"}],\"\\n\",[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"backgroundColor\":\"#fff\",\"color\":\"#24292e\"},\"tabIndex\":\"0\",\"data-language\":\"csharp\",\"data-theme\":\"github-light\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"csharp\",\"data-theme\":\"github-light\",\"style\":{\"display\":\"grid\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" [\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"TestMethod\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"] \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" void\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" GivenARequestForActiveContest_WhenDatabaseAsActiveAndInactiveContest_ThenReturnListOfOnlyActiveContests\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"() { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6A737D\"},\"children\":\"// Arrange const int ACTIVE_CONTEST = 5; const int INACTIVE_CONTEST = 10; InsertActiveContestInDatabase(ACTIVE_CONTEST); InsertInactiveContestInDatabase(INACTIVE_CONTEST); unitOfWorkForInsertion.Commit(false);//Because we have stuff under the correct date // Act var readRepository = new ContestRepository(unitOfWorkForReading, base.runningContext.Object); var contests = readRepository.GetAllActiveContests(); // Assert Assert.AreEqual(ACTIVE_CONTEST,contests.Count()); } \"}]]}]}]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"ou can see that we are using two helpers. One that Insert active contest and one that insert inactive contest. In both case, they are using the ModelBuilder and the insert repository.\"}],\"\\n\",[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"backgroundColor\":\"#fff\",\"color\":\"#24292e\"},\"tabIndex\":\"0\",\"data-language\":\"csharp\",\"data-theme\":\"github-light\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"csharp\",\"data-theme\":\"github-light\",\"style\":{\"display\":\"grid\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" #\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"region\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032F62\"},\"children\":\" Database Helpers private void InsertInactiveContestInDatabase(int amountOfContestToInsert) { var contestsToInsert = contestModelBuilder.GetBatchInActiveContest(amountOfContestToInsert); var insertRepository = new ContestRepository(unitOfWorkForInsertion, base.runningContext.Object); foreach (var contest in contestsToInsert) { insertRepository.Save(contest); } } private void InsertActiveContestInDatabase(int amountOfContestToInsert) { var contestsToInsert = contestModelBuilder.GetBatchActiveContest(amountOfContestToInsert); var insertRepository = new ContestRepository(unitOfWorkForInsertion, base.runningContext.Object); foreach (var contest in contestsToInsert) { insertRepository.Save(contest); } } #endregion \"}]]}]}]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"The code create contests in batch and save them all. They are built to be unique. Here is the model builder for the GetBatchInActiveContest method.\"}],\"\\n\",[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"backgroundColor\":\"#fff\",\"color\":\"#24292e\"},\"tabIndex\":\"0\",\"data-language\":\"csharp\",\"data-theme\":\"github-light\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"csharp\",\"data-theme\":\"github-light\",\"style\":{\"display\":\"grid\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" IEnumerable\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Model\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Entities\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Contest\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Contest\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"GetBatchInActiveContest\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"int\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" amountOfContestToInsert\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\") { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"for\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" (\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"int\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" i\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005CC5\"},\"children\":\" 0\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; i \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" amountOfContestToInsert; i\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"++\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\") { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"var\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" contest\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" GetDefaultNewContest\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(); contest.Name.English \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032F62\"},\"children\":\" \\\"Inactive Contest #\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" +\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" (i \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"+\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005CC5\"},\"children\":\" 1\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"); contest.Name.French \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032F62\"},\"children\":\" \\\"Concours inactif #\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" +\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" (i \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"+\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005CC5\"},\"children\":\" 1\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"); contest.RegistrationRules.StartingTime \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" RunningContext.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"GetCurrentTime\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"().\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"AddMonths\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"-\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"amountOfContestToInsert \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"*\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" (i \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"+\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005CC5\"},\"children\":\" 1\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\") \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"-\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005CC5\"},\"children\":\" 1\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"); contest.RegistrationRules.EndingTime \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" RunningContext.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"GetCurrentTime\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"().\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"AddMonths\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"-\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"amountOfContestToInsert); \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"yield\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" return\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" contest; } } \"}]]}]}]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"As you can see, this create a batch of contest with different name and different starting time and ending time. Since we are creating active contest than we are creating everything before the current time. As you can notice, we are using the RunningContext date time and not the current time. This is simpler because we control the time of the context. It is also using other builder method like the GetDefaultNewContest() method. This way we are reusing existing builder and only change method that we want to have for the test. In this example, the time.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Another modification has been in the contest repository. To get all active contest, two methods has been created.\"}],\"\\n\",[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"backgroundColor\":\"#fff\",\"color\":\"#24292e\"},\"tabIndex\":\"0\",\"data-language\":\"csharp\",\"data-theme\":\"github-light\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"csharp\",\"data-theme\":\"github-light\",\"style\":{\"display\":\"grid\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" IEnumerable\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Contest\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"GetAllActiveContests\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"() { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"return\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" GetAllActiveContestsQueryable\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"() .\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"ToArray\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(); } \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"private\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" IQueryable\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Contest\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"GetAllActiveContestsQueryable\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"() { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"var\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" dateToBeBefore\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005CC5\"},\"children\":\" base\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\".RunningContext.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"GetCurrentTime\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(); \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"return\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005CC5\"},\"children\":\" this\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"GetModelSet\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"() .\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Where\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"d\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" =\u003e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" d.RegistrationRules.EndingTime \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"\u003e=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" dateToBeBefore); } \"}]]}]}]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"The public method is available through the interface. It call the private IQueryable method that is used here to get all active contest but also in a second method to get all active contest for a specific user.\"}],\"\\n\",[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"backgroundColor\":\"#fff\",\"color\":\"#24292e\"},\"tabIndex\":\"0\",\"data-language\":\"csharp\",\"data-theme\":\"github-light\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"csharp\",\"data-theme\":\"github-light\",\"style\":{\"display\":\"grid\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" IEnumerable\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Contest\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"GetAllActiveUnSubscribedContests\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Guid\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" userId\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\") { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"var\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" allActiveContest\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" GetAllActiveContestsQueryable\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(); \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"var\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" allActiveContestForUser\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" GetAllActiveContestForUserQueryable\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(userId); \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"var\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" difference\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" allActiveContest.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Where\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"d\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" =\u003e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" !\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"allActiveContestForUser.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Contains\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(d)); \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"return\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" difference; } \"}]]}]}]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Since we are using in the private method IQueryable we are building the query when we are adding statement in public methods. Something important to notice is that we are not using directly the RunningContext.getCurrentTime() method in where clause because Entity Framework does not understand this method. It only understand primitive comparison like comparing a date.\"}],\"\\n\",[\"$\",\"h1\",null,{\"children\":\"SPRINT 3 : IMPROVING THE ERROR MANIPULATION WITH AUTOMAPPER April 14, 2014 By: pdesjardins\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"This week, we are still in Sprint 3 and few things has been done in the administration page. The page shows all contests. It is the first time we have a page with a grid. It has paging, sorting and multiples others features like filtering. I were using the WebMatrix Html Helper for grid but got some issues like that JQuery must be imported in the header. This is a big no for me. The reason is that it injects JavaScript into the page that execute some JavaScript that is executed without having the whole document ready. This kind of behavior is not fine. JavaScript should not be injected in the document and should not be executed until the whole page is loaded.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"This reduced issue with the grid reduced the whole last week development and not yet done. However, some code has been improved in parallel with Auto Mapper. This project must take the error on the model to the ModelState with the name of the view model.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Previously, I posted some code but this code was not working correctly in the some scenarios.\"}],\"\\n\",[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"backgroundColor\":\"#fff\",\"color\":\"#24292e\"},\"tabIndex\":\"0\",\"data-language\":\"csharp\",\"data-theme\":\"github-light\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"csharp\",\"data-theme\":\"github-light\",\"style\":{\"display\":\"grid\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" namespace\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" MappingUnitTest\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Extensions\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" { [\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"TestClass\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"] \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" class\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" AutoMapperExtensionsGetMapperPropertyNameMultipleLevelTest\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" { [\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"TestInitialize\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"] \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" void\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" TestInitialize\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"() { Mapper.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Reset\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(); Mapper.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"CreateMap\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Source\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\", \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Target\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e() .\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"ForMember\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"m\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" =\u003e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" m.TargetSourceSubClassFrancais, \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"a\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" =\u003e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" a.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"MapFrom\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"s\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" =\u003e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" s.SourceSubClass.SubDescription.Francais)) .\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"ForMember\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"m\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" =\u003e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" m.TargetSourceSubClassAnglais, \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"a\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" =\u003e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" a.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"MapFrom\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"s\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" =\u003e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" s.SourceSubClass.SubDescription.Anglais)); Mapper.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"CreateMap\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Source\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\", \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"TargetWithSub\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e() .\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"ForMember\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"d\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" =\u003e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" d.Title, \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"a\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" =\u003e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" a.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"MapFrom\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"f\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" =\u003e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" f.Title)) .\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"ForMember\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"d\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" =\u003e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" d.Description, \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"a\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" =\u003e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" a.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"MapFrom\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"f\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" =\u003e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" f.Description)); Mapper.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"CreateMap\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"LocalizedString\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\", \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"LocalizedStringViewModel\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e() .\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"ForMember\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"d\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\u003e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"d.AnglaisVM, \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"o\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\u003e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"o.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"MapFrom\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"d\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\u003e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"d.Anglais)) .\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"ForMember\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"d\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\u003e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"d.FrancaisVM, \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"o\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\u003e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"o.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"MapFrom\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"d\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\u003e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"d.Francais)) ; Mapper.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"AssertConfigurationIsValid\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(); } [\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"TestMethod\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"] \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" void\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" GivenAnObjectWithPropertyForMultipleLevel_WhenGettingPropertyName_ThenCorrespondingPropertyNameIsGiven\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"() { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6A737D\"},\"children\":\"$15\"}]]}]}]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"I noted by the comment “Cash HERE” where the code was not working previously. The problem is that it has a cascade of mapping configured by AutoMapper. This one was not working correctly because we were not looping through all possible sub properties type mapping but only from the first class to be mapped.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"The correction is here:\"}],\"\\n\",[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"backgroundColor\":\"#fff\",\"color\":\"#24292e\"},\"tabIndex\":\"0\",\"data-language\":\"csharp\",\"data-theme\":\"github-light\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"csharp\",\"data-theme\":\"github-light\",\"style\":{\"display\":\"grid\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" static\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" string\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" GetMappedPropertyName\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"TSource\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\", \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"TDestination\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"this\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" IConfigurationProvider\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" mapper\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\", \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"string\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" sourcePropertyName\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\") { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"if\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(sourcePropertyName \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"==\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005CC5\"},\"children\":\" null\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\") \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"throw\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" new\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" ArgumentNullException\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032F62\"},\"children\":\"\\\"sourcePropertyName\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"); \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"return\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" GetMappedPropertyName\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(mapper, \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"typeof\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" (\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"TSource\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"), \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"typeof\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" (\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"TDestination\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"), \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"new\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" List\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"string\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e{sourcePropertyName}); } \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"private\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" static\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" string\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" GetMappedPropertyName\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"IConfigurationProvider\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" mapper\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\", \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Type\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" sourceType\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\", \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Type\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" destinationType\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\", \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"List\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"string\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"sourcePropertyNames\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\") { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6A737D\"},\"children\":\"$16\"}]]}]}]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"As you can see, if nothing is found, we split the string by the delimiter (dot) and we call again the property method. It uses recursive call to work on the property.\"}],\"\\n\",[\"$\",\"h1\",null,{\"children\":\"SPRINT 3: SETUP USER ROLE April 28, 2014 By: pdesjardins\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"The last week of sprint 3 was consecrated to user role. The application has a default role that is named “normal user”. This is the default role. Even if everybody are in this role, we have this one defined. The reason is that I want to be able to differ a user that is registered to play contest from those who are not. For example, we will be able to assign to some controller’s action the role of normal user. It gives us some latitude about this role too. We may want to assign the role only when the user has validated its account. This would be interesting to limit the access without blocking the whole website to someone that has not activate its account.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"We are still using the Microsoft Identity Framework for authentification and for roles. This mean that our roles are located in AspNetRoles. The association between users and roles are inside the table AspNetUserRoles.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"img\",null,{\"src\":\"/images/blog/AspNetRoleUserTables.png\",\"alt\":\"\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"As you can see, the association table AspNetRoleUserTables contains both primary key to link AspNetUsers and AspNetRoles. This give us the possibility to have multiples roles for a single user.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Inside the code, I have created a model class that has all roles hardcoded. The reason is that I want to use these constant inside security attribute.\"}],\"\\n\",[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"backgroundColor\":\"#fff\",\"color\":\"#24292e\"},\"tabIndex\":\"0\",\"data-language\":\"csharp\",\"data-theme\":\"github-light\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"csharp\",\"data-theme\":\"github-light\",\"style\":{\"display\":\"grid\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" namespace\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" Model\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Entities\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Users\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" class\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" ApplicatioRole\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" : \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"IdentityRole\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" const\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" string\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" ADMINISTRATOR\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032F62\"},\"children\":\" \\\"Administrator\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" const\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" string\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" MODERATOR\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032F62\"},\"children\":\" \\\"Moderator\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" const\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" string\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" NORMAL_USER\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032F62\"},\"children\":\" \\\"NormalUser\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" const\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" string\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" ADMINISTRATOR_MODERATOR\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" ADMINISTRATOR \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"+\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032F62\"},\"children\":\" \\\",\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" +\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" MODERATOR; } } \"}]]}]}]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"I have also concatenate two constants that will be used in several screens. This is the case for screen shared by administrator and moderator. Since a user can have multiple roles, I do not do combination of normal user and administrator because an administrator should be a normal user and a normal user too.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Another steps during this week was to allow Entity Framework migration tool to seeds. Five account is required for some tests. One as a “system” user that will be used for system task. One for “test” for unit test. And three others user for the three possibles roles.\"}],\"\\n\",[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"backgroundColor\":\"#fff\",\"color\":\"#24292e\"},\"tabIndex\":\"0\",\"data-language\":\"csharp\",\"data-theme\":\"github-light\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"csharp\",\"data-theme\":\"github-light\",\"style\":{\"display\":\"grid\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" internal\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" sealed\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" class\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" Configuration\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" : \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"DbMigrationsConfiguration\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"MainDbContext\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"private\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" readonly\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" IRunningContext\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" runningContext\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"const\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" string\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" EMAIL_ADMIN\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032F62\"},\"children\":\" \\\"123@123.com\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"const\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" string\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" EMAIL_NORMAL_USER\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032F62\"},\"children\":\" \\\"qwe@qwe.com\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"const\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" string\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" EMAIL_MOD\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032F62\"},\"children\":\" \\\"asd@asd.com\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"const\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" string\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" EMAIL_SYSTEM\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032F62\"},\"children\":\" \\\"system@system.com\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"const\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" string\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" EMAIL_TEST\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032F62\"},\"children\":\" \\\"test@test.com\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6A737D\"},\"children\":\"//... \"}]]}]}]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"This is why in the DataAccessMigration Configuration class, we setup five constants with for theses account. This allow us later to search these user by email.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"The seeding method has four sub methods.\"}],\"\\n\",[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"backgroundColor\":\"#fff\",\"color\":\"#24292e\"},\"tabIndex\":\"0\",\"data-language\":\"csharp\",\"data-theme\":\"github-light\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"csharp\",\"data-theme\":\"github-light\",\"style\":{\"display\":\"grid\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" protected\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" override\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" void\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" Seed\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"MainDbContext\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" context\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\") { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"SeedValuesObjects\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(context); \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"SeedValuesForSystemUsers\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(context); \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"SeedValuesForRole\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(context); \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"SeedDemoValues\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(context); } \"}]]}]}]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"The first one seed value for Value Object. The second one is for system user. These are the one that should be constant because they are used by the system. The last two methods are for roles and a seed to fill up the system with values. This is interesting to be able to test the system directly by the website without having to fill up manually data every time.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Roles are added into the system by using RoleManager.\"}],\"\\n\",[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"backgroundColor\":\"#fff\",\"color\":\"#24292e\"},\"tabIndex\":\"0\",\"data-language\":\"csharp\",\"data-theme\":\"github-light\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"csharp\",\"data-theme\":\"github-light\",\"style\":{\"display\":\"grid\"},\"children\":[[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" private\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" void\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" SeedValuesForRole\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"MainDbContext\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" context\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\") { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"var\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" roleManager\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" new\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" RoleManager\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"IdentityRole\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"new\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" RoleStore\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"IdentityRole\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e(context)); \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"var\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" roleAdmin\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" new\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" IdentityRole\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(ApplicatioRole.ADMINISTRATOR); \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"var\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" roleUser\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" new\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" IdentityRole\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(ApplicatioRole.NORMAL_USER); \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"var\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" roleModerator\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" new\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" IdentityRole\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(ApplicatioRole.MODERATOR); roleManager.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Create\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(roleAdmin); roleManager.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Create\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(roleUser); roleManager.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Create\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(roleModerator); context.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"SaveChanges\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(); } \"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"``` On the \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"other\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" side\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\", \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"demo\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" values\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" are\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" divided\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" in\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" three\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" sub\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" methods\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" that\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" all\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" uses\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" directly\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" Entity\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" Framework\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" to\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" insert\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" Contests\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\", \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"User\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" and\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" User\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" Role\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\".\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":\" \"}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":\" \"}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"```\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"csharp\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" private\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" void\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" SeedDemoValues\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"MainDbContext\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" context\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\") { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"SeedDemoContests\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(context); \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"SeedDemoUser\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(context); \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"SeedDemoUsersRoles\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(context); } \"}]]}]]}]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Demo value for user are using Entity Framework:\"}],\"\\n\",[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"backgroundColor\":\"#fff\",\"color\":\"#24292e\"},\"tabIndex\":\"0\",\"data-language\":\"csharp\",\"data-theme\":\"github-light\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"csharp\",\"data-theme\":\"github-light\",\"style\":{\"display\":\"grid\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" private\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" void\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" SeedDemoUser\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"MainDbContext\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" context\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\") { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"var\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" userValueGenerator\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" new\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" UserValuesGenerator\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(); \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"var\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" adminUser\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" new\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" ApplicationUser\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" { Id \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" Guid.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"NewGuid\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"().\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"ToString\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"() , FirstName \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032F62\"},\"children\":\" \\\"Patrick\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" , LastName \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032F62\"},\"children\":\" \\\"Desjardins\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" , DisplayName \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032F62\"},\"children\":\" \\\"pdesjardins\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" , Email \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" EMAIL_ADMIN , CreationDateTime \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" runningContext.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"GetCurrentTime\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"() , UserName \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" userValueGenerator.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"GenerateUserName\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(EMAIL_ADMIN), PasswordHash \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" ApplicationUser.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"HashPassword\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032F62\"},\"children\":\"\\\"123123\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\") , ValidationDateTime \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" runningContext.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"GetCurrentTime\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"() }; \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"var\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" modUser\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" new\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" ApplicationUser\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" { Id \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" Guid.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"NewGuid\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"().\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"ToString\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"() ,FirstName \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032F62\"},\"children\":\" \\\"Jim\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" ,LastName \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032F62\"},\"children\":\" \\\"Doe\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" ,DisplayName \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032F62\"},\"children\":\" \\\"jdoe\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" ,Email \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" EMAIL_MOD ,CreationDateTime \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" runningContext.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"GetCurrentTime\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"() ,UserName \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" userValueGenerator.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"GenerateUserName\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(EMAIL_MOD) ,PasswordHash \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" ApplicationUser.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"HashPassword\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032F62\"},\"children\":\"\\\"asdasd\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\") ,ValidationDateTime \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" runningContext.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"GetCurrentTime\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"() }; \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"var\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" normalUser\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" new\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" ApplicationUser\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" { Id \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" Guid.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"NewGuid\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"().\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"ToString\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"() , FirstName \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032F62\"},\"children\":\" \\\"Melodie\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" , LastName \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032F62\"},\"children\":\" \\\"Savaria\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" , DisplayName \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032F62\"},\"children\":\" \\\"msavaria\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" , Email \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" EMAIL_NORMAL_USER , CreationDateTime \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" runningContext.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"GetCurrentTime\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"() , UserName \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" userValueGenerator.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"GenerateUserName\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(EMAIL_NORMAL_USER), PasswordHash \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" ApplicationUser.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"HashPassword\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032F62\"},\"children\":\"\\\"qweqwe\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\") , ValidationDateTime \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" runningContext.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"GetCurrentTime\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"() }; context.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Set\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"ApplicationUser\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e().\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"AddOrUpdate\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(adminUser); context.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Set\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"ApplicationUser\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e().\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"AddOrUpdate\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(normalUser); context.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Set\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"ApplicationUser\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e().\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"AddOrUpdate\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(modUser); context.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"SaveChanges\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(); } \"}]]}]}]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Finally, for roles, we need to associate them users. To have the good ID, we need to get from the email the entity and assign it to a new IdentityUserRole.\"}],\"\\n\",[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"backgroundColor\":\"#fff\",\"color\":\"#24292e\"},\"tabIndex\":\"0\",\"data-language\":\"csharp\",\"data-theme\":\"github-light\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"csharp\",\"data-theme\":\"github-light\",\"style\":{\"display\":\"grid\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" private\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" void\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" SeedDemoUsersRoles\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"MainDbContext\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" context\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\") { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"var\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" administratorRole\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" context.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"GetDbContext\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"().\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Set\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"IdentityRole\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e().\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Single\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"d\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" =\u003e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" d.Name \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"==\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" ApplicatioRole.ADMINISTRATOR); \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"var\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" normalRole\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" context.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"GetDbContext\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"().\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Set\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"IdentityRole\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e().\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Single\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"d\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" =\u003e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" d.Name \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"==\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" ApplicatioRole.NORMAL_USER); \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"var\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" moderatorRole\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" context.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"GetDbContext\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"().\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Set\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"IdentityRole\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e().\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Single\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"d\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" =\u003e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" d.Name \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"==\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" ApplicatioRole.MODERATOR); \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"var\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" administratorUser\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" context.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"GetDbContext\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"().\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Set\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"ApplicationUser\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e().\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Single\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"d\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" =\u003e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" d.Email \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"==\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" EMAIL_ADMIN); \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"var\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" normalUser\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" context.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"GetDbContext\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"().\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Set\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"ApplicationUser\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e().\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Single\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"d\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" =\u003e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" d.Email \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"==\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" EMAIL_NORMAL_USER); \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"var\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" modUser\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" context.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"GetDbContext\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"().\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Set\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"ApplicationUser\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e().\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Single\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"d\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" =\u003e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" d.Email \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"==\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" EMAIL_MOD); \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"var\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" userRole1\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" new\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" IdentityUserRole\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" { UserId \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" administratorUser.Id, RoleId \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" administratorRole.Id }; \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"var\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" userRole11\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" new\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" IdentityUserRole\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" { UserId \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" normalUser.Id, RoleId \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" administratorRole.Id }; \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"var\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" userRole2\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" new\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" IdentityUserRole\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" { UserId \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" normalUser.Id, RoleId \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" moderatorRole.Id }; \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"var\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" userRole3\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" new\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" IdentityUserRole\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" { UserId \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" modUser.Id, RoleId \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" normalRole.Id }; context.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Set\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"IdentityUserRole\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e().\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"AddOrUpdate\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(userRole1); context.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Set\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"IdentityUserRole\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e().\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"AddOrUpdate\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(userRole11); context.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Set\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"IdentityUserRole\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e().\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"AddOrUpdate\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(userRole2); context.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Set\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"IdentityUserRole\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e().\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"AddOrUpdate\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(userRole3); context.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"SaveChanges\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(); } \"}]]}]}]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"The database is now having everything related.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"img\",null,{\"src\":\"/images/blog/DataValuesUserRoles.png\",\"alt\":\"\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Contests are also inserted by Entity Framework but use the ModelBuilder to get a batch of contest.\"}],\"\\n\",[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"backgroundColor\":\"#fff\",\"color\":\"#24292e\"},\"tabIndex\":\"0\",\"data-language\":\"csharp\",\"data-theme\":\"github-light\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"csharp\",\"data-theme\":\"github-light\",\"style\":{\"display\":\"grid\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" private\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" void\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" SeedDemoContests\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"MainDbContext\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" context\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\") { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"var\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" unitOfWork\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" new\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" UnitOfWork\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"new\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" MainDbContext\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005CC5\"},\"children\":\"this\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\".runningContext)); \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"var\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" contestRepository\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" new\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" ContestRepository\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(unitOfWork, \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005CC5\"},\"children\":\"this\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\".runningContext); \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"var\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" contestModelBuilder\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" new\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" ModelBuilders\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Contest\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"ContestModelBuilder\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005CC5\"},\"children\":\"this\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\".runningContext); \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"var\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" contests\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" contestModelBuilder.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"GetBatchActiveContest\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005CC5\"},\"children\":\"20\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"); contestRepository.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"DeleteAll\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Contest\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e(Constants.SchemaNames.Contest); \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"foreach\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" (\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"var\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" contest\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" in\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" contests) { contestRepository.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Save\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(contest); } unitOfWork.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Commit\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(); } \"}]]}]}]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"This is interesting because we are using this builder for some unit tests too. We reuse code!\"}],\"\\n\",[\"$\",\"h1\",null,{\"children\":\"SPRINT 3 : GETTING VIEW THAT CHANGE DEPENDING OF USER ROLE May 5, 2014 By: pdesjardins\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"The menu of the website display moderation links and administration links only to user with these respective roles. Validation on the server is also done but this article aims particularly how to handle role for specific portion of the view.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"First of all, you could use like most tutorial and use the User.IsInRole(“YourRoleHere”). The problem is that your role will be defined in the model. In the application we are building, roles are in ApplicationRole.\"}],\"\\n\",[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"backgroundColor\":\"#fff\",\"color\":\"#24292e\"},\"tabIndex\":\"0\",\"data-language\":\"csharp\",\"data-theme\":\"github-light\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"csharp\",\"data-theme\":\"github-light\",\"style\":{\"display\":\"grid\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" class\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" ApplicationRole\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" : \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"IdentityRole\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" const\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" string\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" ADMINISTRATOR\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032F62\"},\"children\":\" \\\"Administrator\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" const\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" string\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" MODERATOR\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032F62\"},\"children\":\" \\\"Moderator\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" const\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" string\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" NORMAL_USER\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032F62\"},\"children\":\" \\\"NormalUser\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" const\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" string\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" ADMINISTRATOR_MODERATOR\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" ADMINISTRATOR \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"+\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032F62\"},\"children\":\" \\\",\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" +\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" MODERATOR; } \"}]]}]}]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"This is used later in every actions.\"}],\"\\n\",[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"backgroundColor\":\"#fff\",\"color\":\"#24292e\"},\"tabIndex\":\"0\",\"data-language\":\"csharp\",\"data-theme\":\"github-light\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"csharp\",\"data-theme\":\"github-light\",\"style\":{\"display\":\"grid\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" [\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"HttpGet\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"] [\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Authorize\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Roles\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" ApplicationRole.ADMINISTRATOR_MODERATOR)] \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" ActionResult\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" Edit\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"int\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" id\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\") { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6A737D\"},\"children\":\"//... } \"}]]}]}]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"But the model is not accessible by the view. The view use the View Model classes. And, in fact, the View should not do any conditional clauses by executing any method to validate if a user is in a role or not. This is a back-end operation. The front end should only use something that say if it is in the role or not. This is why the best way to proceed is to have property method that indicate with a boolean if the user can display something or not.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"The first class to create is an interface that has all visual constraints. For the sake of simplicity, we will do two properties. One for Administration and one for Moderation. It could be better to have IsMenuDisplay or IsYourActionDisplay and to hide the role. Nevertheless, the point is to remove from the view everything related to User.IsInRole().\"}],\"\\n\",[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"backgroundColor\":\"#fff\",\"color\":\"#24292e\"},\"tabIndex\":\"0\",\"data-language\":\"csharp\",\"data-theme\":\"github-light\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"csharp\",\"data-theme\":\"github-light\",\"style\":{\"display\":\"grid\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" interface\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" IUIPermission\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"bool\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" IsAdministrator\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"get\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"set\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; } \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"bool\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" IsModerator\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"get\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"set\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; } } \"}]]}]}]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"I have also created a new concrete class that implement the interface.\"}],\"\\n\",[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"backgroundColor\":\"#fff\",\"color\":\"#24292e\"},\"tabIndex\":\"0\",\"data-language\":\"csharp\",\"data-theme\":\"github-light\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"csharp\",\"data-theme\":\"github-light\",\"style\":{\"display\":\"grid\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" class\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" UIPermission\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\":\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"IUIPermission\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" bool\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" IsAdministrator\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"get\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"set\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; } \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" bool\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" IsModerator\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"get\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"set\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; } } \"}]]}]}]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"This class will be used in the situation that the action does not return any view model. In that case, we will use a default UIPermission that denied everything. Otherwise, we will use the one of the view model. The second place to use the interface is into the base class WebPageViewModel.\"}],\"\\n\",[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"backgroundColor\":\"#fff\",\"color\":\"#24292e\"},\"tabIndex\":\"0\",\"data-language\":\"csharp\",\"data-theme\":\"github-light\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"csharp\",\"data-theme\":\"github-light\",\"style\":{\"display\":\"grid\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" class\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" WebPageViewModel\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\":\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"ViewModel\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\", \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"IUIPermission\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6A737D\"},\"children\":\"/// \u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#22863A\"},\"children\":\"summary\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6A737D\"},\"children\":\"\u003e /// This is the title that is displayed in the browser title /// \u003c/\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#22863A\"},\"children\":\"summary\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6A737D\"},\"children\":\"\u003e public string PageTitle { get; set; } /// \u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#22863A\"},\"children\":\"summary\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6A737D\"},\"children\":\"\u003e /// This is the main h1 of the page /// \u003c/\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#22863A\"},\"children\":\"summary\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6A737D\"},\"children\":\"\u003e public string PageHeader { get; set; } /// \u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#22863A\"},\"children\":\"summary\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6A737D\"},\"children\":\"\u003e /// This is the specification for the title. It is not required. /// \u003c/\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#22863A\"},\"children\":\"summary\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6A737D\"},\"children\":\"\u003e public string PageSubHeader { get; set; } public bool IsAdministrator { get; set; } public bool IsModerator { get; set; } } \"}]]}]}]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"This is the class that is inherited by every view model that is bound to a view. It is the place to use this interface. The next step is to find a place to set the user role to all view model without having to add some code every time we are using a view model for a view. This can be done in BaseController.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"This can be done by overriding the OnActionExecuted method. We need to get the result model object, verify if this one inherit from IUIPermission to set permission. This still work fine with our other base class ModelViewModelMappingController that inherit BaseController.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"The last step is to do the conditions in views. One of the challenge is that we wanted to display links or not depending of the view model UIPermission. The problem is that Layout.cshtml that has the partial class for the menu does not has a Model set. Also, this one change depending of which controllers and which action is used. To be able to make it works with every situations, the trick is to use a model of object type.\"}],\"\\n\",[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"backgroundColor\":\"#fff\",\"color\":\"#24292e\"},\"tabIndex\":\"0\",\"data-language\":\"html\",\"data-theme\":\"github-light\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"html\",\"data-theme\":\"github-light\",\"style\":{\"display\":\"grid\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"@model object \u003c!\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#22863A\"},\"children\":\"DOCTYPE\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" html\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e \u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#22863A\"},\"children\":\"html\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e ... ... @Html.Partial(\\\"_Header\\\", Model as IUIPermission ?? new UIPermission()) \"}]]}]}]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"The partial must not be NULL, otherwise an exception is throw. The exception looks like “The model item passed into the dictionary is of type X but this dictionary requires a model item of type Y”. From there, the menu partial class get a model IUIPermission and use the required properties for the task. Here is an example of the menu.\"}],\"\\n\",[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"backgroundColor\":\"#fff\",\"color\":\"#24292e\"},\"tabIndex\":\"0\",\"data-language\":\"html\",\"data-theme\":\"github-light\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"html\",\"data-theme\":\"github-light\",\"style\":{\"display\":\"grid\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#22863A\"},\"children\":\"div\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" class\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032F62\"},\"children\":\"\\\"navbar-collapse collapse\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e \u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#22863A\"},\"children\":\"ul\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" class\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032F62\"},\"children\":\"\\\"nav navbar-nav\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e \u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#22863A\"},\"children\":\"li\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e@Html.ActionLink(\\\"Home\\\", \\\"Index\\\", \\\"Home\\\")\u003c/\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#22863A\"},\"children\":\"li\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e \u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#22863A\"},\"children\":\"li\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e@Html.ActionLink(\\\"Contests\\\", \\\"List\\\", \\\"UserContest\\\", new { Area = Constants.Areas.CONTEST }, new { })\u003c/\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#22863A\"},\"children\":\"li\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e @if (Model.IsAdministrator || Model.IsModerator) { \u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#22863A\"},\"children\":\"li\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e \u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#22863A\"},\"children\":\"a\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" href\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032F62\"},\"children\":\"\\\"#\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003eModeration\u003c/\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#22863A\"},\"children\":\"a\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e \u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#22863A\"},\"children\":\"ul\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" class\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032F62\"},\"children\":\"\\\"dropdown-menu\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e \u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#22863A\"},\"children\":\"li\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#22863A\"},\"children\":\"a\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" href\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032F62\"},\"children\":\"\\\"#\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003eSplit\u003c/\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#22863A\"},\"children\":\"a\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e\u003c/\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#22863A\"},\"children\":\"li\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e \u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#22863A\"},\"children\":\"li\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#22863A\"},\"children\":\"a\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" href\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032F62\"},\"children\":\"\\\"#\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003eSymbol Change\u003c/\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#22863A\"},\"children\":\"a\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e\u003c/\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#22863A\"},\"children\":\"li\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e \u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#22863A\"},\"children\":\"li\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" class\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032F62\"},\"children\":\"\\\"divider\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e\u003c/\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#22863A\"},\"children\":\"li\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e @if (Model.IsAdministrator || Model.IsModerator) { \u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#22863A\"},\"children\":\"li\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" class\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032F62\"},\"children\":\"\\\"dropdown-header\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003eAdministrator\u003c/\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#22863A\"},\"children\":\"li\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e \u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#22863A\"},\"children\":\"li\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#22863A\"},\"children\":\"a\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" href\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032F62\"},\"children\":\"\\\"#\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003eDashBoard\u003c/\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#22863A\"},\"children\":\"a\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e\u003c/\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#22863A\"},\"children\":\"li\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e \u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#22863A\"},\"children\":\"li\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#22863A\"},\"children\":\"a\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" href\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032F62\"},\"children\":\"\\\"#\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003eNews\u003c/\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#22863A\"},\"children\":\"a\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e\u003c/\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#22863A\"},\"children\":\"li\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e \u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#22863A\"},\"children\":\"li\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#22863A\"},\"children\":\"a\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" href\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032F62\"},\"children\":\"\\\"#\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003eUser\u003c/\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#22863A\"},\"children\":\"a\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e\u003c/\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#22863A\"},\"children\":\"li\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e \u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#22863A\"},\"children\":\"li\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e \u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#22863A\"},\"children\":\"a\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" href\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032F62\"},\"children\":\"\\\"#\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003eContest\u003c/\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#22863A\"},\"children\":\"a\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e \u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#22863A\"},\"children\":\"ul\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" class\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032F62\"},\"children\":\"\\\"dropdown-menu\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e \u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#22863A\"},\"children\":\"li\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e@Html.ActionLink(\\\"List\\\", \\\"List\\\", \\\"Contest\\\", new {Area = Constants.Areas.ADMINISTRATOR}, new {})\u003c/\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#22863A\"},\"children\":\"li\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e \u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#22863A\"},\"children\":\"li\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e@Html.ActionLink(\\\"Create\\\", \\\"Create\\\", \\\"Contest\\\", new {Area = Constants.Areas.ADMINISTRATOR}, new {})\u003c/\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#22863A\"},\"children\":\"li\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e \u003c/\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#22863A\"},\"children\":\"ul\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e \u003c/\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#22863A\"},\"children\":\"li\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e \u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#22863A\"},\"children\":\"li\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" class\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032F62\"},\"children\":\"\\\"divider\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e\u003c/\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#22863A\"},\"children\":\"li\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e } \u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#22863A\"},\"children\":\"li\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" class\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032F62\"},\"children\":\"\\\"dropdown-header\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003eStatistics\u003c/\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#22863A\"},\"children\":\"li\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e \u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#22863A\"},\"children\":\"li\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#22863A\"},\"children\":\"a\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" href\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032F62\"},\"children\":\"\\\"#\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003eServer\u003c/\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#22863A\"},\"children\":\"a\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e\u003c/\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#22863A\"},\"children\":\"li\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e \u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#22863A\"},\"children\":\"li\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#22863A\"},\"children\":\"a\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" href\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032F62\"},\"children\":\"\\\"#\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003eUsers\u003c/\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#22863A\"},\"children\":\"a\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e\u003c/\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#22863A\"},\"children\":\"li\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e \u003c/\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#22863A\"},\"children\":\"ul\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e \u003c/\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#22863A\"},\"children\":\"li\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e } \u003c/\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#22863A\"},\"children\":\"ul\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e @Html.Partial(\\\"_LoginPartial\\\") \u003c/\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#22863A\"},\"children\":\"div\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e \"}]]}]}]}]}],\"\\n\",[\"$\",\"h1\",null,{\"children\":\"ADJUSTING GRID COLUMN WITH RESOLUTION WITH PAGING AND SORTING May 12, 2014 By: pdesjardins\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"We have to show information inside a grid. I first used the WebMatrix Web Grid that allow to have sorting, paging, ajax call back etc. The problem is that it does not work very well if you want something flexible. I also had problem with paging and with sorting. At the end, I figured it out that it was less problem to just create an Html grid and using some custom Html Helper to create something very clean. I also wanted to integrate the FootTable.js JavaScript library to have dynamic column display. It was very hard with the WebMatrix and a breeze with custom html helper. An example is that I wanted to sort on a property that when clicked and sent to the controller was the name of the view model. The problem was that the WebMatrix must have the same name between view model and model otherwise the mapping cannot be done. This article explains how to create a grid that can be sortable with paging and that when resizeable continue to be usable.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Here is images of the final result. The first image is when the resolution full screen (desktop).\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"img\",null,{\"src\":\"/images/blog/GridFullSize-1024x311.png\",\"alt\":\"\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"This one is for tablet resolution: \",[\"$\",\"img\",null,{\"src\":\"/images/blog/GridTabletSize.png\",\"alt\":\"\"}]]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"This one is for phone. The second row is open to show you that the FooTable.js library allows you to have some interesting features.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"img\",null,{\"src\":\"/images/blog/GridMobile.png\",\"alt\":\"\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"I will not discuss here about the filter capability because it is a subject that does not touche the grid. This allow to have some condition on the data set that is bound to the grid but does not affect the creation of the grid.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"View Model\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"The first thing is that I was using WebMatrix which required to have some field like “sort”, “sortdir” and “page” defined in lowercase. This is why you will see in few that I have still used this nomenclature. Now, it could be renamed but I have not do it yet. Nevertheless, the principle is the same. You need to have your view model, that has the list of element you want to bind to the grid, to inherit from a base class that has these three properties. These one are used to know the sort property, the sort direction and which page to load information.\"}],\"\\n\",[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"backgroundColor\":\"#fff\",\"color\":\"#24292e\"},\"tabIndex\":\"0\",\"data-language\":\"csharp\",\"data-theme\":\"github-light\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"csharp\",\"data-theme\":\"github-light\",\"style\":{\"display\":\"grid\"},\"children\":[[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" interface\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" IWebGridPagingInformation\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"string\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" sort\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"get\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"set\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; } \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"string\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" sortdir\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"get\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"set\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; } \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"int\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" page\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"get\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"set\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; } } \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" class\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" GridFilterSortableViewModel\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\":\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"WebPageViewModel\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\", \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"IWebGridPagingInformation\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" string\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" sort\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"get\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"set\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; } \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" string\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" sortdir\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"get\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"set\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; } \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" int\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" page\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"get\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"set\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; } \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" bool\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" HasSortAndPagingFilter\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"get\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"return\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" !\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(sort \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"==\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005CC5\"},\"children\":\" null\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" \u0026\u0026\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" sortdir \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"==\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005CC5\"},\"children\":\" null\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" \u0026\u0026\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" page \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"==\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" default\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"int\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\")); } } } \"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"``` The Interface \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"is\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" used\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" for\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" information\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" about\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" the\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" sort\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" and\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" paging\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\". \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"It\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" will\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" be\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" mapped\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" later\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" to\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" a\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" interface\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" that\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" the\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" model\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" known\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" to\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" execute\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" its\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" query\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" with\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" Entity\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" Framework\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\".\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":\" \"}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"This\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" last\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" class\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\", GridFilterSortableViewModel, can be used \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"for\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" your concrete implementation for your entity. For example, I have a list of Contest entity. This class has the list of contest to display and a property that is all filters that you want to apply to the entity. This allow to offer more filter or less than what it is displayed.\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":\" \"}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":\" \"}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"```csharp\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" public class ContestListViewModel : Infrastructures.GridFilterSortableViewModel { public ContestListViewModel() { Filters \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" new\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" ContestListFilterFieldsViewModel\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(); } \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" IEnumerable\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"ContestListItemViewModel\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"\u003e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" Contests { get; set; } \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" ContestListFilterFieldsViewModel Filters { get; set; } } \"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"``` On the \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"controller\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" side\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\", \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"one\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" action\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" is\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" available\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\". \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Everything\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" is\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" within\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" GET\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" which\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" allow\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" to\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" use\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" filtering\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" and\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" paging\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" from\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" an\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" URL\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\". \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"This\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" is\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" very\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" interesting\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" to\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" communicate\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" a\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" grid\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" preference\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" by\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" URL\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\".\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":\" \"}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":\" \"}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"```\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"csharp\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" [\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"HttpGet\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"] [\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Authorize\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Roles\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" ApplicationRole.ADMINISTRATOR_MODERATOR)] \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" ActionResult\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" List\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"ContestListViewModel\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" contestListViewModel\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\") { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6A737D\"},\"children\":\"//Get filter contests var contestsListModel = this.MapperFacade.GetModel\u003cContestList, ContestListViewModel\u003e(contestListViewModel); var contests = this.contestService.GetContestsByFilter(contestsListModel.Filters);//This one load the filter with good value (COUNT of contest) + return contest for filter contestsListModel.Contests = contests; //Transform back everything for the page var viewModelWithContestsAndFilter = this.MapperFacade.GetViewModel\u003cContestList, ContestListViewModel\u003e(contestsListModel); //View Model viewModelWithContestsAndFilter.InitializeTitles(); ModelState.Clear(); //Return only a partial if the grid has called the controller with Ajax call return View(viewModelWithContestsAndFilter); } \"}]]}]]}]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"The first step in the action is to convert the contest list view model into the model. The model is simple and allows to have columns in the sort and filters to be translated into the model property name and not anymore the view model property name.\"}],\"\\n\",[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"backgroundColor\":\"#fff\",\"color\":\"#24292e\"},\"tabIndex\":\"0\",\"data-language\":\"csharp\",\"data-theme\":\"github-light\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"csharp\",\"data-theme\":\"github-light\",\"style\":{\"display\":\"grid\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" class\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" ContestList\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" IEnumerable\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Contest\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Contests\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"get\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"set\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; } \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" ContestListFilterFields\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" Filters\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"get\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"set\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; } } \"}]]}]}]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"The ContestListFilterFields has all Contest Filter fields that we allow to filter but also inherit from FilterEntity.\"}],\"\\n\",[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"backgroundColor\":\"#fff\",\"color\":\"#24292e\"},\"tabIndex\":\"0\",\"data-language\":\"csharp\",\"data-theme\":\"github-light\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"csharp\",\"data-theme\":\"github-light\",\"style\":{\"display\":\"grid\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" class\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" ContestListFilterFields\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" : \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"FilterEntity\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" LocalizedString\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" Name\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"get\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"set\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; } \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" DateTime\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"? \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"StartingTime\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"get\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"set\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; } \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" DateTime\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"? \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"EndingTime\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"get\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"set\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; } [\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Display\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"ResourceType\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" typeof\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"ModelPropertyDisplayName\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"), \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Name\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032F62\"},\"children\":\" \\\"IsUsingStockRules\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\")] \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" bool\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" IsUsingStockRules\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"get\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"set\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; } [\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Display\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"ResourceType\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" typeof\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"ModelPropertyDisplayName\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"), \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Name\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032F62\"},\"children\":\" \\\"IsUsingShortRules\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\")] \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" bool\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" IsUsingShortRules\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"get\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"set\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; } [\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Display\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"ResourceType\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" typeof\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"ModelPropertyDisplayName\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"), \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Name\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032F62\"},\"children\":\" \\\"IsUsingOptionRules\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\")] \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" bool\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" IsUsingOptionRules\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"get\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"set\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; } \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" Money\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" InitialCapital\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"get\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"set\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; } \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" bool\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" IsFilteringOnInitialCapital\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"get\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"return\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" InitialCapital \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"!=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005CC5\"},\"children\":\" null\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; } } \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" ContestListFilterFields\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"() { Sort \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" CrossLayer.Reflections.LambdaHelper.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"GetPropertyName\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"ContestListFilterFields\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"d\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" =\u003e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" d.StartingTime); SortDirection \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" SortDirection.Desc; } } \"}]]}]}]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"The constructor define the default behavior of the grid. As you can see, it is possible to use the sort property to set the default to be the starting time in descending order. The mapping will set these default properties to model.\"}],\"\\n\",[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"backgroundColor\":\"#fff\",\"color\":\"#24292e\"},\"tabIndex\":\"0\",\"data-language\":\"csharp\",\"data-theme\":\"github-light\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"csharp\",\"data-theme\":\"github-light\",\"style\":{\"display\":\"grid\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" Mapper.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"CreateMap\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"ContestListFilterFields\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\", \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"ContestListFilterFieldsViewModel\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e() .\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"ForMember\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"d\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\u003e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"d.EndingTime, \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"option\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\u003e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"option.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"MapFrom\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"d\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\u003e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"d.EndingTime)) .\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"ForMember\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"d\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" =\u003e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" d.InitialCapital, \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"option\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" =\u003e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" option.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"MapFrom\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"d\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" =\u003e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" d.InitialCapital \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"??\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" new\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" Money\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"())) .\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"ForMember\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"d\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\u003e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"d.IsUsingOptionRules, \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"option\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\u003e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"option.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"MapFrom\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"d\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\u003e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"d.IsUsingOptionRules)) .\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"ForMember\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"d\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\u003e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"d.IsUsingShortRules, \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"option\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\u003e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"option.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"MapFrom\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"d\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\u003e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"d.IsUsingShortRules)) .\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"ForMember\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"d\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\u003e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"d.IsUsingStockRules, \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"option\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\u003e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"option.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"MapFrom\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"d\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\u003e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"d.IsUsingStockRules)) .\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"ForMember\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"d\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\u003e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"d.Name, \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"option\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\u003e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"option.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"MapFrom\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"d\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\u003e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"d.Name)) .\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"ForMember\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"d\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\u003e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"d.RowsPerPage, \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"option\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\u003e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"option.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"MapFrom\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"d\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\u003e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"d.NumberOfEntitiesPerRequest)) .\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"ForMember\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"d\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" =\u003e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" d.StartingTime, \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"option\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" =\u003e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" option.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"MapFrom\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"d\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" =\u003e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" d.StartingTime)) .\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"ForMember\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"d\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" =\u003e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" d.TotalRecords, \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"option\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" =\u003e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" option.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"MapFrom\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"d\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" =\u003e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" d.EntityTotalCount)) ; Mapper.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"CreateMap\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"ContestListFilterFieldsViewModel\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\", \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"ContestListFilterFields\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e() .\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"ForMember\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"d\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" =\u003e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" d.EndingTime, \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"option\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" =\u003e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" option.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"MapFrom\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"d\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" =\u003e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" d.EndingTime)) .\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"ForMember\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"d\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" =\u003e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" d.InitialCapital, \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"option\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" =\u003e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" option.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"MapFrom\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"d\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" =\u003e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" d.InitialCapital.Value\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"!=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005CC5\"},\"children\":\"0\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"?\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"d.InitialCapital\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\":\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005CC5\"},\"children\":\"null\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\")) .\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"ForMember\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"d\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" =\u003e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" d.IsUsingOptionRules, \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"option\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" =\u003e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" option.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"MapFrom\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"d\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" =\u003e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" d.IsUsingOptionRules)) .\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"ForMember\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"d\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" =\u003e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" d.IsUsingShortRules, \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"option\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" =\u003e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" option.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"MapFrom\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"d\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" =\u003e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" d.IsUsingShortRules)) .\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"ForMember\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"d\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" =\u003e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" d.IsUsingStockRules, \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"option\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" =\u003e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" option.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"MapFrom\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"d\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" =\u003e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" d.IsUsingStockRules)) .\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"ForMember\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"d\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" =\u003e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" d.Name, \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"option\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" =\u003e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" option.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"MapFrom\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"d\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" =\u003e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" d.Name)) .\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"ForMember\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"d\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" =\u003e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" d.StartingTime, \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"option\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" =\u003e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" option.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"MapFrom\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"d\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" =\u003e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" d.StartingTime)) ; \"}]]}]}]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"The FilterEntity class that inherit your concrete ContestListFilterFields is very generic which mean that you have all what you have for all future entities. It has the current page property, the property name for the sort, the sort direction, total count of entities and the number of entity to display per page.\"}],\"\\n\",[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"backgroundColor\":\"#fff\",\"color\":\"#24292e\"},\"tabIndex\":\"0\",\"data-language\":\"csharp\",\"data-theme\":\"github-light\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"csharp\",\"data-theme\":\"github-light\",\"style\":{\"display\":\"grid\"},\"children\":[[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" class\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" FilterEntity\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\":\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"IPagingInformation\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" const\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" int\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" DEFAULT_CURRENT_PAGE\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005CC5\"},\"children\":\" 0\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" const\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" int\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" NUMBER_OF_ENTITIES_PER_PAGE\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005CC5\"},\"children\":\" 3\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" FilterEntity\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"() { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"SetDefaultValues\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(); } \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" int\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" NumberOfEntitiesPerRequest\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"get\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"set\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; } \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" int\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" CurrentPage\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"get\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"set\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; } \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" string\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" Sort\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"get\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"set\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; } \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" SortDirection\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" SortDirection\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"get\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"set\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; } \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" int\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" EntityTotalCount\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"get\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"set\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; } \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" void\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" SetDefaultValues\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"() { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005CC5\"},\"children\":\"this\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\".CurrentPage \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" DEFAULT_CURRENT_PAGE; \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005CC5\"},\"children\":\"this\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\".NumberOfEntitiesPerRequest \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" NUMBER_OF_ENTITIES_PER_PAGE; \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005CC5\"},\"children\":\"this\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\".SortDirection \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" SortDirection.Asc; } } \"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"``` The last thing to \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"do\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" is\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" to\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" mark\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" the\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" table\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" with\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" the\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" sort\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" direction\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\". \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"It\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" does\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" two\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" things\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\". \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"The\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" first\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" is\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" to\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" set\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" the\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" arrow\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" for\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" the\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" current\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" view\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" (\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"with\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" the\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" current\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" field\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" that\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" could\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" have\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" been\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" set\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" by\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" URL\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" or\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" by\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" form\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"). \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"The\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" second\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" thing\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" is\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" to\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" apply\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" the\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" FootTable\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" plugin\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" to\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" the\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" table\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\".\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":\" \"}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"```\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"typescript\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"$$(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"document\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\").\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"ready\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"function\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" () { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"setArrows\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032F62\"},\"children\":\"'contests-list'\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"); $(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032F62\"},\"children\":\"'#contests-list table'\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\").\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"footable\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(); }); \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6A737D\"},\"children\":\"/* * @description: Set the arrows to the column header that is active for sorting */\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" function\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" setArrows\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(idDivisionThatContainTable) { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"var\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" dir\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" $(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032F62\"},\"children\":\"'#'\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" +\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" Application.ControldsId.SortId).\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"val\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"().\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"toUpperCase\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(); \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"var\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" col\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" $(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032F62\"},\"children\":\"'#'\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" +\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" Application.ControldsId.ColumnId).\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"val\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(); \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"var\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" header\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" $(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032F62\"},\"children\":\"'#'\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"+\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"idDivisionThatContainTable\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"+\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032F62\"},\"children\":\"' th a[href*='\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" +\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" col \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"+\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032F62\"},\"children\":\" ']'\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"); \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"if\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" (dir \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"===\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032F62\"},\"children\":\" 'ASC'\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\") { header.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"text\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(header.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"text\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"() \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"+\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032F62\"},\"children\":\" ' ▲'\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"); } \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"if\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" (dir \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"===\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032F62\"},\"children\":\" 'DESC'\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\") { header.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"text\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(header.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"text\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"() \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"+\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032F62\"},\"children\":\" ' ▼'\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"); } }; \"}]]}]]}]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"As you can see, the method use a Aplication.ControldsId.SortID and ColumnId that is set inside a script tag of the view.\"}],\"\\n\",[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"backgroundColor\":\"#fff\",\"color\":\"#24292e\"},\"tabIndex\":\"0\",\"data-language\":\"html\",\"data-theme\":\"github-light\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"html\",\"data-theme\":\"github-light\",\"style\":{\"display\":\"grid\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"@section scripts { \u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#22863A\"},\"children\":\"script\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e Application.ControldsId.SortId \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032F62\"},\"children\":\" \\\"@Html.IdFor(d=\u003ed.sortdir)\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; Application.ControldsId.ColumnId \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032F62\"},\"children\":\" \\\"@Html.IdFor(d=\u003ed.sort)\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; \u003c/\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#22863A\"},\"children\":\"script\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e \u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#22863A\"},\"children\":\"script\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" src\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032F62\"},\"children\":\"\\\"~/Scripts/Customs/Views/ContestList.js\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e\u003c/\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#22863A\"},\"children\":\"script\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e } \"}]]}]}]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"This could be improved because in a situation of two tables in a page it will not work. However, it would not be the only thing that would not work. The URL parameter is only designed for one grid per page. Nevertheless, this is almost always the case.\"}],\"\\n\",[\"$\",\"h1\",null,{\"children\":\"SPRINT 4 : MENU WITH SECURITY AND JOINING CONTEST June 16, 2014 By: pdesjardins\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"The Sprint 4 was shorter due to some time restriction. However some good development have been done. The first one concern the menu where it is now possible to display depending of the user role. The first thing to do is to modify the_layout.cshtml file. First, we need to add the @model to specify what we want to get from the controller the entity. This is required because the controller will pass the role of the user logged in the system. Depending of his role, we will adjust the menu. The second thing in the layout partial is that we will pass this model to the partial of the menu.\"}],\"\\n\",[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"backgroundColor\":\"#fff\",\"color\":\"#24292e\"},\"tabIndex\":\"0\",\"data-language\":\"html\",\"data-theme\":\"github-light\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"html\",\"data-theme\":\"github-light\",\"style\":{\"display\":\"grid\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"@using WebSite.Resources @model object /*This is required to work with the model passed by the controller*/ \u003c!\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#22863A\"},\"children\":\"DOCTYPE\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" html\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e \u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#22863A\"},\"children\":\"html\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e \u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#22863A\"},\"children\":\"body\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e @Html.Partial(\\\"_Header\\\", Model) \u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#22863A\"},\"children\":\"div\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" class\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032F62\"},\"children\":\"\\\"container body-content\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e @RenderBody() \u003c/\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#22863A\"},\"children\":\"div\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e \u003c/\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#22863A\"},\"children\":\"body\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e \u003c/\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#22863A\"},\"children\":\"html\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e \"}]]}]}]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Having the model set to object allow us to work with every model/view model possible. In the header partial it is possible to compare to an interface. If the view model that we pass from the controller inherit from the interface than we can check the role and proceed. Otherwise, we display nothing. The header partial do several thing and one of them is to parse to IUIPermission and pass this parsed object to the Menu partial.\"}],\"\\n\",[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"backgroundColor\":\"#fff\",\"color\":\"#24292e\"},\"tabIndex\":\"0\",\"data-language\":\"csharp\",\"data-theme\":\"github-light\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"csharp\",\"data-theme\":\"github-light\",\"style\":{\"display\":\"grid\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" var\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" permission\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" Model \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"as\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" IUIPermission\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" ??\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" new\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" UIPermission\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(); Html.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"RenderPartial\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032F62\"},\"children\":\"\\\"_Menu\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\", permission); \"}]]}]}]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"The IUIPermission allows us to specify roles and check them to display or not elements of the menu.\"}],\"\\n\",[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"backgroundColor\":\"#fff\",\"color\":\"#24292e\"},\"tabIndex\":\"0\",\"data-language\":\"csharp\",\"data-theme\":\"github-light\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"csharp\",\"data-theme\":\"github-light\",\"style\":{\"display\":\"grid\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" interface\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" IUIPermission\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"bool\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" IsAdministrator\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"get\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"set\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; } \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"bool\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" IsModerator\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"get\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"set\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; } } \"}]]}]}]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Here is an example of the menu:\"}],\"\\n\",[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"backgroundColor\":\"#fff\",\"color\":\"#24292e\"},\"tabIndex\":\"0\",\"data-language\":\"html\",\"data-theme\":\"github-light\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"html\",\"data-theme\":\"github-light\",\"style\":{\"display\":\"grid\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#22863A\"},\"children\":\"div\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" class\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032F62\"},\"children\":\"\\\"navbar-collapse collapse\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e \u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#22863A\"},\"children\":\"ul\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" class\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032F62\"},\"children\":\"\\\"nav navbar-nav\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e \u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#22863A\"},\"children\":\"li\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e@Html.ActionLink(\\\"Home\\\", \\\"Index\\\", \\\"Home\\\")\u003c/\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#22863A\"},\"children\":\"li\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e \u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#22863A\"},\"children\":\"li\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e@Html.ActionLink(\\\"Contests\\\", \\\"List\\\", \\\"UserContest\\\", new { Area = Constants.Areas.CONTEST }, new { })\u003c/\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#22863A\"},\"children\":\"li\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e @if(Model.IsAdministrator || Model.IsModerator) { \u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#22863A\"},\"children\":\"li\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e \u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#22863A\"},\"children\":\"a\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" href\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032F62\"},\"children\":\"\\\"#\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003eModeration\u003c/\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#22863A\"},\"children\":\"a\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e \u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#22863A\"},\"children\":\"ul\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" class\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032F62\"},\"children\":\"\\\"dropdown-menu\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e \u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#22863A\"},\"children\":\"li\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#22863A\"},\"children\":\"a\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" href\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032F62\"},\"children\":\"\\\"#\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003eSplit\u003c/\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#22863A\"},\"children\":\"a\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e\u003c/\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#22863A\"},\"children\":\"li\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e @if (Model.IsAdministrator || Model.IsModerator) { \u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#22863A\"},\"children\":\"li\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" class\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032F62\"},\"children\":\"\\\"dropdown-header\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003eAdministrator\u003c/\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#22863A\"},\"children\":\"li\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e \u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#22863A\"},\"children\":\"li\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#22863A\"},\"children\":\"a\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" href\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032F62\"},\"children\":\"\\\"#\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003eDashBoard\u003c/\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#22863A\"},\"children\":\"a\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e\u003c/\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#22863A\"},\"children\":\"li\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e \u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#22863A\"},\"children\":\"li\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#22863A\"},\"children\":\"a\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" href\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032F62\"},\"children\":\"\\\"#\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003eNews\u003c/\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#22863A\"},\"children\":\"a\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e\u003c/\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#22863A\"},\"children\":\"li\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e } \u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#22863A\"},\"children\":\"li\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#22863A\"},\"children\":\"a\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" href\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032F62\"},\"children\":\"\\\"#\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003eUsers\u003c/\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#22863A\"},\"children\":\"a\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e\u003c/\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#22863A\"},\"children\":\"li\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e \u003c/\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#22863A\"},\"children\":\"ul\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e \u003c/\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#22863A\"},\"children\":\"li\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e } \u003c/\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#22863A\"},\"children\":\"ul\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e \u003c/\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#22863A\"},\"children\":\"div\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e \"}]]}]}]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"The second big thing that has been done is concerning joining a contest for a user. A page with the description of the contest has been created. Under the description, a button is displayed to join the contest if the user logged is not already subscribed.\"}],\"\\n\",[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"backgroundColor\":\"#fff\",\"color\":\"#24292e\"},\"tabIndex\":\"0\",\"data-language\":\"csharp\",\"data-theme\":\"github-light\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"csharp\",\"data-theme\":\"github-light\",\"style\":{\"display\":\"grid\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" [\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"HttpGet\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"] [\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Authorize\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Roles\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" ApplicationRole.NORMAL_USER)] \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" ActionResult\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" Detail\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"int\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" id\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\") { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6A737D\"},\"children\":\"//Get the contest to show it information but also to know if the current user is subscribed to the contest var contestForUser = this.contestService.GetContestByIdWithContesters(id); //Transform back everything for the page var viewContestsForUser = this.MapperFacade.GetViewModel\u003cModel.Entities.Contest.Contest, ContestDetailViewModel\u003e(contestForUser); //View Model viewContestsForUser.IsCurrentUserRegisteredToThisContest = contestForUser.IsUserInContest(new ApplicationUser {Id = this.runningContext.GetUserId().ToString()}); return ViewModel(viewContestsForUser); } \"}]]}]}]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"The line before the return is the one that tell the view model if the user is in the contest or not. As you can see, we get the contest with all contesters. From here, we check if the user is in the list or not. The view change depending of if the user is already in the contest or not.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"img\",null,{\"src\":\"/images/blog/EnterContest.png\",\"alt\":\"\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"And the view if the user is already in the contest:\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"img\",null,{\"src\":\"/images/blog/JoinButton-1024x678.png\",\"alt\":\"\"}]}],\"\\n\",[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"backgroundColor\":\"#fff\",\"color\":\"#24292e\"},\"tabIndex\":\"0\",\"data-language\":\"csharp\",\"data-theme\":\"github-light\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"csharp\",\"data-theme\":\"github-light\",\"style\":{\"display\":\"grid\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" [\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"HttpPost\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"] [\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Authorize\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Roles\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" ApplicationRole.NORMAL_USER)] [\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"ValidateAntiForgeryToken\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"] \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" ActionResult\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" Join\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"int\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" id\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\") { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6A737D\"},\"children\":\"$17\"}]]}]}]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Joining a contest require to verify if the user is already subscribed to the contest, if not we join. The controller call the service, which call the accessor.\"}],\"\\n\",[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"backgroundColor\":\"#fff\",\"color\":\"#24292e\"},\"tabIndex\":\"0\",\"data-language\":\"csharp\",\"data-theme\":\"github-light\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"csharp\",\"data-theme\":\"github-light\",\"style\":{\"display\":\"grid\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" IEnumerable\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"ValidationResult\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"SaveUserToContest\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"int\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" contestId\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\", \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Guid\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" userId\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\") { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"var\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" contest\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005CC5\"},\"children\":\" this\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\".contestRepository.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"GetById\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(contestId); \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6A737D\"},\"children\":\"//This is in the accessor because later we could search in Cache if(contest.RegistrationRules.IsDateValidToSubscribeUser) { this.contestRepository.SaveUserToContest(contest, userId); this.unitOfWork.Commit(); } else { return new List\u003cValidationResult\u003e() {new ValidationResult(Resources.ContestValidationMessage.InvalidDateToSubscribe)}; } return new List\u003cValidationResult\u003e(); } \"}]]}]}]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"We do a quick validation about if the date is still okay to subscribe. Then, we go in the repository to save everything in the database. The repository verify some other thing like if the user already has a portefolio in this contest.\"}],\"\\n\",[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"backgroundColor\":\"#fff\",\"color\":\"#24292e\"},\"tabIndex\":\"0\",\"data-language\":\"csharp\",\"data-theme\":\"github-light\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"csharp\",\"data-theme\":\"github-light\",\"style\":{\"display\":\"grid\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" void\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" SaveUserToContest\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Contest\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" contest\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\", \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Guid\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" userId\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\") { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"var\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" portefolioExist\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005CC5\"},\"children\":\" this\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\".UnitOfWork.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Set\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Portefolio\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e() .\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Include\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"d\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\u003e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"d.Owners) .\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Any\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"p\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" =\u003e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" p.ContestId \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"==\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" contest.Id \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"\u0026\u0026\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" p.Owners.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Any\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"d\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" =\u003e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" d.UserId \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"==\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" userId.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"ToString\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"())); \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"if\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" (portefolioExist) { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"throw\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" new\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" UserAlreadyInContestException\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"string\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Format\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(Resources.ContestValidationMessage.PortefolioAlreadyCreatedForUserAndContest, contest.Id, userId)); } \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"var\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" portefolio\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005CC5\"},\"children\":\" this\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\".UnitOfWork.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Set\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Portefolio\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e().\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Create\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(); \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005CC5\"},\"children\":\"this\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\".UnitOfWork.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Entry\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(portefolio).State \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" EntityState.Added; portefolio.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"ResetFromContest\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(contest); \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6A737D\"},\"children\":\"//Required to set the default values like the initial capital var userPortefolio = new UserPortefolio() {Portefolio = portefolio, PortefolioId = portefolio.Id, UserId = userId.ToString(), DateJoin = this.RunningContext.GetCurrentTime()}; this.Save(userPortefolio); } \"}]]}]}]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"It is also the time where we set to the portefolio the default values from the contest registration rules. This is the case of the initial money for a portefolio.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"}\"}],\"\\n\",[\"$\",\"h1\",null,{\"children\":\"SPRINT 5 : MODIFYING THE CLASSES ARCHITECTURE July 2, 2014 By: pdesjardins\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"To end the month of June, some modification has been made on the classes and layers. Once again, it is to simplify the maintenance. The biggest change is in the business layer. Previously, some classes were present but should not be. It is the same in the Data Access Layer which had some classes about Email. Yes, it is the place to send email but not to store those classes. Now, the Business Layer has all entities and non-entities classes like Email.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"img\",null,{\"src\":\"/images/blog/BusinessLayerClassesSegregation.png\",\"alt\":\"\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"The second big change in the Sprint 5 was about the introduction of Trading business logic entities like Order, Portefolio, Stock and Transaction.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"img\",null,{\"src\":\"/images/blog/TradingAndOrderClasses.png\",\"alt\":\"\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"The Order class is abstract and has several class the inherit it like the StockOrder. The StockOrder class is very simple and add only the StockSymbol. It inherits from all other properties.\"}],\"\\n\",[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"backgroundColor\":\"#fff\",\"color\":\"#24292e\"},\"tabIndex\":\"0\",\"data-language\":\"csharp\",\"data-theme\":\"github-light\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"csharp\",\"data-theme\":\"github-light\",\"style\":{\"display\":\"grid\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" class\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" StockOrder\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" : \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Order\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" { [\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Required\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"] \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" string\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" StockSymbol\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"get\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"set\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; } \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" override\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" IEnumerable\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"ValidationResult\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"ValidateChildren\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"() { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"return\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005CC5\"},\"children\":\" base\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"ValidateChildren\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(); } } \"}]]}]}]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"$18\"}],\"\\n\",[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"backgroundColor\":\"#fff\",\"color\":\"#24292e\"},\"tabIndex\":\"0\",\"data-language\":\"csharp\",\"data-theme\":\"github-light\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"csharp\",\"data-theme\":\"github-light\",\"style\":{\"display\":\"grid\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" abstract\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" class\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" Order\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" : \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Implementations\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Model\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"protected\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" Order\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"() { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005CC5\"},\"children\":\"this\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\".Status \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" OrderStatusType.Waiting; } [\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Required\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"] \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" int\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" Quantity\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"get\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"set\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; } \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" int\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" TransactionTypeId\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"get\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"return\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" TransactionType.Id; } \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"set\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005CC5\"},\"children\":\"this\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\".TransactionType \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" TransactionType.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"GetFromId\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(value); } } [\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Required\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"] \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" TransactionType\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" TransactionType\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"get\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"set\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; } \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" OrderType\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" OrderType\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"get\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"if\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" (PriceStop \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"!=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005CC5\"},\"children\":\" null\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" \u0026\u0026\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" PriceLimit \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"!=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005CC5\"},\"children\":\" null\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\") \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"return\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" OrderType.StopLimit; \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"if\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" (PriceStop \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"==\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005CC5\"},\"children\":\" null\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" \u0026\u0026\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" PriceLimit \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"!=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005CC5\"},\"children\":\" null\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\") \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"return\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" OrderType.Limit; \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"return\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" OrderType.Market; } \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"set\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" { }\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6A737D\"},\"children\":\"/*This is required for Entity Framework*/\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" } \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" Money\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" PriceLimit\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"get\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"set\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; } \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" Money\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" PriceStop\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"get\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"set\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; } [\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Required\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"] \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" DateTime\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" PlacedOrderTime\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"get\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"set\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; } [\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Required\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"] \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" DateTime\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" ExpirationOrderTime\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"get\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"set\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; } \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" bool\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" IsMarketPriceOrder\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"get\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"return\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" PriceLimit \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"==\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005CC5\"},\"children\":\" null\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" \u0026\u0026\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" PriceStop \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"==\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005CC5\"},\"children\":\" null\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; } } \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" Portefolio\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" Portefolio\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"get\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"set\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; } \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" int\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" PortefolioId\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"get\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"set\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; } \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" ApplicationUser\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" UserWhoPlacedTheOrder\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"get\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"set\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; } \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" string\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" UserWhoPlacedTheOrderId\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"get\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"set\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; } \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" int\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" StatusId\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"get\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"return\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" Status.Id; } \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"set\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005CC5\"},\"children\":\"this\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\".Status \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" OrderStatusType.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"GetFromId\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(value); } } \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" OrderStatusType\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" Status\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"get\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"set\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; } \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" override\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" IEnumerable\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"ValidationResult\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"ValidateChildren\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"() { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"if\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" (\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"!\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005CC5\"},\"children\":\"this\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\".IsMarketPriceOrder) { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"if\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" (\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005CC5\"},\"children\":\"this\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\".PriceStop \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"!=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005CC5\"},\"children\":\" null\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\") { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"if\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" (TransactionType \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"==\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" TransactionType.Buy) { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"if\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" (PriceLimit \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" PriceStop) { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"yield\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" return\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" new\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" ValidationResult\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032F62\"},\"children\":\"\\\"Price Limit must be higher or equal to the price stop\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" , \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"new\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"[] { LambdaHelper.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"GetPropertyName\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Order\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"d\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" =\u003e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" d.PriceLimit), LambdaHelper.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"GetPropertyName\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Order\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"d\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" =\u003e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" d.PriceStop)} ); } } \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"else\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" if\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" (TransactionType \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"==\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" TransactionType.Sell) { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"if\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" (PriceLimit \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"\u003e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" PriceStop) { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"yield\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" return\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" new\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" ValidationResult\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032F62\"},\"children\":\"\\\"Price Limit must be lower or equal to the price stop\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" , \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"new\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"[] { LambdaHelper.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"GetPropertyName\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Order\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"d\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" =\u003e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" d.PriceLimit), LambdaHelper.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"GetPropertyName\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Order\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"d\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" =\u003e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" d.PriceStop) }); } } } } } \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" IEnumerable\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"ValidationResult\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"ValidateNewOrder\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"IRunningContext\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" runningContext\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\", \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"int\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" numberDayMaximumForExpirationOrder\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\") { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"if\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" (\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005CC5\"},\"children\":\"this\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\".ExpirationOrderTime.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Subtract\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(runningContext.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"GetCurrentTime\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"()).TotalDays \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"\u003e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" numberDayMaximumForExpirationOrder) \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"yield\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" return\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" new\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" ValidationResult\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"string\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Format\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032F62\"},\"children\":\"\\\"You cannot set an order with a ending time above {0}\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\", numberDayMaximumForExpirationOrder) , \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"new\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"[] { LambdaHelper.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"GetPropertyName\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Order\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"d\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" =\u003e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" d.ExpirationOrderTime) }); } } \"}]]}]}]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"The Order class is also interesting because it add some business logic like the validation of a new order that can be called when the order is created. This is used by the new class Portefolio. The Portefolio class is used in the OrderService class when we record a new order into a portefolio. The order is pass to the portefolio to be added, and this one validate if it is possible to add. A lot of business logic is done here to know if the order is fine or not. The Order Service looks so far like that for the validation:\"}],\"\\n\",[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"backgroundColor\":\"#fff\",\"color\":\"#24292e\"},\"tabIndex\":\"0\",\"data-language\":\"csharp\",\"data-theme\":\"github-light\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"csharp\",\"data-theme\":\"github-light\",\"style\":{\"display\":\"grid\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" IEnumerable\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"ValidationResult\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"RecordOrder\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"StockOrder\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" order\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\") { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"var\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" validationsToReturn\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" new\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" List\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"ValidationResult\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e(); \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6A737D\"},\"children\":\"//1- Current contest from the portefolio //2- Verify that the contest can execute this order (validations for contest/order) var portefolio = this.portefolioAccessor.GetById(order.PortefolioId); IEnumerable\u003cValidationResult\u003e validationContests = portefolio.ValidateOrder(order, this.runningContext, this.quoteProvider); if (validationContests.Any()) { return validationContests; } //3- Validate the order var validations = order.Validate(); if (validations.Any()) { return validationsToReturn; } //4- Record the order in the order queue to be executed at the proper time var validationsOnSave = this.orderAccessor.RecordOrder(order); validationsToReturn = validationsToReturn.Concat(validationsOnSave).ToList(); //5- Display any feedback from the RecordOrder operation return validationsToReturn; } \"}]]}]}]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"The interesting part is the one the validate the order from the portefolio. The code below is not yet done but it shows that some validation are done. At some point, the validation does not concern the portefolio rules but the order. This is why this method call the Order.ValidateNewOrder.\"}],\"\\n\",[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"backgroundColor\":\"#fff\",\"color\":\"#24292e\"},\"tabIndex\":\"0\",\"data-language\":\"csharp\",\"data-theme\":\"github-light\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"csharp\",\"data-theme\":\"github-light\",\"style\":{\"display\":\"grid\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" IEnumerable\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"ValidationResult\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"ValidateOrder\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"StockOrder\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" order\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\", \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"IRunningContext\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" runningContext\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\", \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"IQuoteProvider\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" quoteProvider\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\") { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"if\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" (\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"!\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005CC5\"},\"children\":\"this\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\".Contest.ContestOrderType.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Accept\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(order.OrderType)) \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"yield\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" return\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" new\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" ValidationResult\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032F62\"},\"children\":\"\\\"Order is not valid for the current contest\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\", \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"new\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"[]{LambdaHelper.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"GetPropertyName\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"StockOrder\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"d\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\u003e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"d.OrderType)}); \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"if\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"((order.OrderType \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"==\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" OrderType.Limit \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"||\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" order.OrderType \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"==\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" OrderType.StopLimit) \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"\u0026\u0026\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005CC5\"},\"children\":\" this\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\".NumberOfActiveOrder\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"\u003e=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005CC5\"},\"children\":\"this\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\".Contest.TransactionRules.MaximumLimitOrderSameTime) \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"yield\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" return\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" new\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" ValidationResult\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032F62\"},\"children\":\"\\\"The maximum number of order has been reached.\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\", \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"new\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"[] { LambdaHelper.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"GetPropertyName\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Portefolio\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"d\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" =\u003e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" d.NumberOfActiveOrder) }); \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"var\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" numberDayMaximumForExpirationOrder\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005CC5\"},\"children\":\" 7\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\";\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6A737D\"},\"children\":\"//ToDo var orderValidations = order.ValidateNewOrder(runningContext, numberDayMaximumForExpirationOrder); foreach (var validationResult in orderValidations) { yield return validationResult; } if (!this.Contest.TransactionRules.IsInOrderTimeFrame(runningContext.GetCurrentTime())) { yield return new ValidationResult(string.Format(\\\"Order must be set between {0} and {1}\\\" , this.Contest.TransactionRules.OrderStartingTime , this.Contest.TransactionRules.OrderEndingTime) , new[] {LambdaHelper.GetPropertyName\u003cPortefolio\u003e(d =\u003e d.Contest.TransactionRules)}); } var stockValidations = quoteProvider.GetValidation().Validate(order.StockSymbol); foreach (var validationResult in stockValidations) { var newValidationWithMembers = new ValidationResult(validationResult.ErrorMessage, new[] {LambdaHelper.GetPropertyName\u003cStockOrder\u003e(d =\u003e d.StockSymbol)}); yield return newValidationWithMembers; } } \"}]]}]}]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Not only it calls the Order validation but it also validate the Stock Symbol. This is interesting because it use the QuoteProvider. This allow us to change the stock provider from any provider like Yahoo to Google without having to change a lot of logic. It implements the strategy pattern.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Additional information about the Strategy Pattern and the Quote Provider will be provided in a later article.\"}],\"\\n\",[\"$\",\"h1\",null,{\"children\":\"MOVING FROM IIS EXPRESS TO IIS AND SQL SERVER August 18, 2014 By: pdesjardins\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Moving from IIS Express to IIS was a natural decision for many reasons like not having to launch IIS Express for the Web Service every time we wanted to run the web site. This way, the Web API Service can always run until modification is required. It has not been as a simple switch to IIS by creation new website under IIS. This require to have some change. First, we were using localdb. We could continue to use localdb but it would have require us to change the credential of the running Application Pool to use my credential. The reason is that localdb is under the user profile. The best solution at this point is to run the database inside a real Sql Server.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Cannot get a local application data path. Most probably a user profile is not loaded. If LocalDB is executed under IIS, make sure that profile loading is enabled for the current user. Next warning that you will get is that the Application Pool does not have access to the database.\"}],\"\\n\",[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"backgroundColor\":\"#fff\",\"color\":\"#24292e\"},\"tabIndex\":\"0\",\"data-language\":\"plaintext\",\"data-theme\":\"github-light\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"plaintext\",\"data-theme\":\"github-light\",\"style\":{\"display\":\"grid\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\" Process information: Process ID: 7732 Process name: w3wp.exe Account name: IIS APPPOOL\\\\\\\\BourseVirtuelle Exception information: Exception type: SqlException Exception message: The SELECT permission was denied on the object ‘AspNetUserLogins’, database ‘BourseVirtuelle’, schema ‘dbo’. at System.Data.SqlClient.SqlCommand.b__24(Task`1 result) at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke() at System.Threading.Tasks.Task.Execute() This can be done by going into Microsoft Sql Server Manager, under Security, Logins and add entries for all your Application Pool. For example, here is the application pool that I created. \"}]}]}]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"img\",null,{\"src\":\"/images/blog/ApplicationPoolIdentity.png\",\"alt\":\"\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"You need to have the user name with the IIS APPPOOl\\\\ in front of your Application Pool name. You have also to keep Windows Authentification checked.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"img\",null,{\"src\":\"/images/blog/LoginProperties-1024x581.png\",\"alt\":\"\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"The last step is to give the user access to the Database. You have give the account enough role to be able to run you application.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"img\",null,{\"src\":\"/images/blog/UserMapping.png\",\"alt\":\"\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"The last error that you can have is something about the creation of table. I had this error when migrating this website with the Identity framework when trying to get the user in the authentication window.\"}],\"\\n\",[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"backgroundColor\":\"#fff\",\"color\":\"#24292e\"},\"tabIndex\":\"0\",\"data-language\":\"plaintext\",\"data-theme\":\"github-light\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"plaintext\",\"data-theme\":\"github-light\",\"style\":{\"display\":\"grid\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\" Exception information: Exception type: SqlException Exception message: CREATE TABLE permission denied in database ‘BourseVirtuelle’. at System.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction) at System.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose) \"}]}]}]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"The solution was to set the default initializer to null\"}],\"\\n\",[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"backgroundColor\":\"#fff\",\"color\":\"#24292e\"},\"tabIndex\":\"0\",\"data-language\":\"csharp\",\"data-theme\":\"github-light\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"csharp\",\"data-theme\":\"github-light\",\"style\":{\"display\":\"grid\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" MainDbContext\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(IRunningContext runningContext) \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\":\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005CC5\"},\"children\":\" this\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"() { Database.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"SetInitializer\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"MainDbContext\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005CC5\"},\"children\":\"null\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"); \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6A737D\"},\"children\":\"//No initialization ConfigurationContext(runningContext); } \"}]]}]}]}]}]]]}]]}],[\"$\",\"div\",null,{\"className\":\"layout_paginationBar__jnuuR\",\"children\":[[\"$\",\"div\",null,{\"className\":\"layout_paginationTitle__PsOw5\",\"children\":\"Chronological Blog Articles by Page\"}],[\"$\",\"div\",null,{\"className\":\"layout_paginationLinks__LdBaH\",\"children\":[[\"$\",\"$Lb\",\"1\",{\"className\":\"\",\"href\":\"/blog/page/1\",\"children\":1}],[\"$\",\"$Lb\",\"2\",{\"className\":\"\",\"href\":\"/blog/page/2\",\"children\":2}],[\"$\",\"$Lb\",\"3\",{\"className\":\"\",\"href\":\"/blog/page/3\",\"children\":3}],[\"$\",\"$Lb\",\"4\",{\"className\":\"\",\"href\":\"/blog/page/4\",\"children\":4}],[\"$\",\"$Lb\",\"5\",{\"className\":\"\",\"href\":\"/blog/page/5\",\"children\":5}],[\"$\",\"$Lb\",\"6\",{\"className\":\"\",\"href\":\"/blog/page/6\",\"children\":6}],[\"$\",\"$Lb\",\"7\",{\"className\":\"\",\"href\":\"/blog/page/7\",\"children\":7}],[\"$\",\"$Lb\",\"8\",{\"className\":\"\",\"href\":\"/blog/page/8\",\"children\":8}],[\"$\",\"$Lb\",\"9\",{\"className\":\"\",\"href\":\"/blog/page/9\",\"children\":9}],[\"$\",\"$Lb\",\"10\",{\"className\":\"\",\"href\":\"/blog/page/10\",\"children\":10}],[\"$\",\"$Lb\",\"11\",{\"className\":\"\",\"href\":\"/blog/page/11\",\"children\":11}],[\"$\",\"$Lb\",\"12\",{\"className\":\"\",\"href\":\"/blog/page/12\",\"children\":12}],[\"$\",\"$Lb\",\"13\",{\"className\":\"\",\"href\":\"/blog/page/13\",\"children\":13}],[\"$\",\"$Lb\",\"14\",{\"className\":\"\",\"href\":\"/blog/page/14\",\"children\":14}],[\"$\",\"$Lb\",\"15\",{\"className\":\"\",\"href\":\"/blog/page/15\",\"children\":15}],[\"$\",\"$Lb\",\"16\",{\"className\":\"\",\"href\":\"/blog/page/16\",\"children\":16}],[\"$\",\"$Lb\",\"17\",{\"className\":\"\",\"href\":\"/blog/page/17\",\"children\":17}],[\"$\",\"$Lb\",\"18\",{\"className\":\"\",\"href\":\"/blog/page/18\",\"children\":18}],[\"$\",\"$Lb\",\"19\",{\"className\":\"\",\"href\":\"/blog/page/19\",\"children\":19}],[\"$\",\"$Lb\",\"20\",{\"className\":\"\",\"href\":\"/blog/page/20\",\"children\":20}],[\"$\",\"$Lb\",\"21\",{\"className\":\"\",\"href\":\"/blog/page/21\",\"children\":21}],[\"$\",\"$Lb\",\"22\",{\"className\":\"\",\"href\":\"/blog/page/22\",\"children\":22}],[\"$\",\"$Lb\",\"23\",{\"className\":\"\",\"href\":\"/blog/page/23\",\"children\":23}],[\"$\",\"$Lb\",\"24\",{\"className\":\"\",\"href\":\"/blog/page/24\",\"children\":24}],[\"$\",\"$Lb\",\"25\",{\"className\":\"\",\"href\":\"/blog/page/25\",\"children\":25}],[\"$\",\"$Lb\",\"26\",{\"className\":\"\",\"href\":\"/blog/page/26\",\"children\":26}],[\"$\",\"$Lb\",\"27\",{\"className\":\"\",\"href\":\"/blog/page/27\",\"children\":27}],[\"$\",\"$Lb\",\"28\",{\"className\":\"\",\"href\":\"/blog/page/28\",\"children\":28}],[\"$\",\"$Lb\",\"29\",{\"className\":\"\",\"href\":\"/blog/page/29\",\"children\":29}],[\"$\",\"$Lb\",\"30\",{\"className\":\"\",\"href\":\"/blog/page/30\",\"children\":30}],[\"$\",\"$Lb\",\"31\",{\"className\":\"\",\"href\":\"/blog/page/31\",\"children\":31}],[\"$\",\"$Lb\",\"32\",{\"className\":\"\",\"href\":\"/blog/page/32\",\"children\":32}],[\"$\",\"$Lb\",\"33\",{\"className\":\"\",\"href\":\"/blog/page/33\",\"children\":33}],[\"$\",\"$Lb\",\"34\",{\"className\":\"\",\"href\":\"/blog/page/34\",\"children\":34}],[\"$\",\"$Lb\",\"35\",{\"className\":\"\",\"href\":\"/blog/page/35\",\"children\":35}],[\"$\",\"$Lb\",\"36\",{\"className\":\"\",\"href\":\"/blog/page/36\",\"children\":36}],[\"$\",\"$Lb\",\"37\",{\"className\":\"\",\"href\":\"/blog/page/37\",\"children\":37}],[\"$\",\"$Lb\",\"38\",{\"className\":\"\",\"href\":\"/blog/page/38\",\"children\":38}],[\"$\",\"$Lb\",\"39\",{\"className\":\"\",\"href\":\"/blog/page/39\",\"children\":39}],[\"$\",\"$Lb\",\"40\",{\"className\":\"\",\"href\":\"/blog/page/40\",\"children\":40}],[\"$\",\"$Lb\",\"41\",{\"className\":\"\",\"href\":\"/blog/page/41\",\"children\":41}],[\"$\",\"$Lb\",\"42\",{\"className\":\"\",\"href\":\"/blog/page/42\",\"children\":42}],[\"$\",\"$Lb\",\"43\",{\"className\":\"\",\"href\":\"/blog/page/43\",\"children\":43}],[\"$\",\"$Lb\",\"44\",{\"className\":\"\",\"href\":\"/blog/page/44\",\"children\":44}],[\"$\",\"$Lb\",\"45\",{\"className\":\"\",\"href\":\"/blog/page/45\",\"children\":45}],[\"$\",\"$Lb\",\"46\",{\"className\":\"\",\"href\":\"/blog/page/46\",\"children\":46}],[\"$\",\"$Lb\",\"47\",{\"className\":\"\",\"href\":\"/blog/page/47\",\"children\":47}],[\"$\",\"$Lb\",\"48\",{\"className\":\"\",\"href\":\"/blog/page/48\",\"children\":48}],[\"$\",\"$Lb\",\"49\",{\"className\":\"\",\"href\":\"/blog/page/49\",\"children\":49}],[\"$\",\"$Lb\",\"50\",{\"className\":\"\",\"href\":\"/blog/page/50\",\"children\":50}],[\"$\",\"$Lb\",\"51\",{\"className\":\"\",\"href\":\"/blog/page/51\",\"children\":51}],[\"$\",\"$Lb\",\"52\",{\"className\":\"\",\"href\":\"/blog/page/52\",\"children\":52}],[\"$\",\"$Lb\",\"53\",{\"className\":\"\",\"href\":\"/blog/page/53\",\"children\":53}],[\"$\",\"$Lb\",\"54\",{\"className\":\"\",\"href\":\"/blog/page/54\",\"children\":54}],[\"$\",\"$Lb\",\"55\",{\"className\":\"\",\"href\":\"/blog/page/55\",\"children\":55}],[\"$\",\"$Lb\",\"56\",{\"className\":\"\",\"href\":\"/blog/page/56\",\"children\":56}],[\"$\",\"$Lb\",\"57\",{\"className\":\"\",\"href\":\"/blog/page/57\",\"children\":57}],[\"$\",\"$Lb\",\"58\",{\"className\":\"\",\"href\":\"/blog/page/58\",\"children\":58}],[\"$\",\"$Lb\",\"59\",{\"className\":\"\",\"href\":\"/blog/page/59\",\"children\":59}],[\"$\",\"$Lb\",\"60\",{\"className\":\"\",\"href\":\"/blog/page/60\",\"children\":60}],[\"$\",\"$Lb\",\"61\",{\"className\":\"\",\"href\":\"/blog/page/61\",\"children\":61}],[\"$\",\"$Lb\",\"62\",{\"className\":\"\",\"href\":\"/blog/page/62\",\"children\":62}],[\"$\",\"$Lb\",\"63\",{\"className\":\"\",\"href\":\"/blog/page/63\",\"children\":63}],[\"$\",\"$Lb\",\"64\",{\"className\":\"\",\"href\":\"/blog/page/64\",\"children\":64}],[\"$\",\"$Lb\",\"65\",{\"className\":\"\",\"href\":\"/blog/page/65\",\"children\":65}],[\"$\",\"$Lb\",\"66\",{\"className\":\"\",\"href\":\"/blog/page/66\",\"children\":66}],[\"$\",\"$Lb\",\"67\",{\"className\":\"\",\"href\":\"/blog/page/67\",\"children\":67}],[\"$\",\"$Lb\",\"68\",{\"className\":\"\",\"href\":\"/blog/page/68\",\"children\":68}],[\"$\",\"$Lb\",\"69\",{\"className\":\"\",\"href\":\"/blog/page/69\",\"children\":69}],[\"$\",\"$Lb\",\"70\",{\"className\":\"\",\"href\":\"/blog/page/70\",\"children\":70}],[\"$\",\"$Lb\",\"71\",{\"className\":\"\",\"href\":\"/blog/page/71\",\"children\":71}],[\"$\",\"$Lb\",\"72\",{\"className\":\"\",\"href\":\"/blog/page/72\",\"children\":72}],[\"$\",\"$Lb\",\"73\",{\"className\":\"\",\"href\":\"/blog/page/73\",\"children\":73}],[\"$\",\"$Lb\",\"74\",{\"className\":\"\",\"href\":\"/blog/page/74\",\"children\":74}],[\"$\",\"$Lb\",\"75\",{\"className\":\"\",\"href\":\"/blog/page/75\",\"children\":75}],[\"$\",\"$Lb\",\"76\",{\"className\":\"\",\"href\":\"/blog/page/76\",\"children\":76}],[\"$\",\"$Lb\",\"77\",{\"className\":\"\",\"href\":\"/blog/page/77\",\"children\":77}]]}]]}]]}]}]\n"])</script><script>self.__next_f.push([1,""])</script></body></html>