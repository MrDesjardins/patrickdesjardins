<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="preload" href="/_next/static/media/c9a5bc6a7c948fb0-s.p.woff2" as="font" crossorigin="" type="font/woff2"/><link rel="preload" as="image" href="/images/blog/DatabaseWorkout-196x400.png"/><link rel="preload" as="image" href="/images/blog/msdtc-356x400.png"/><link rel="stylesheet" href="/_next/static/css/f7004a68ac8d367c.css" crossorigin="" data-precedence="next"/><link rel="stylesheet" href="/_next/static/css/e917b4f00bcb2347.css" crossorigin="" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/_next/static/chunks/webpack-692a33e6ebc06ff4.js" crossorigin=""/><script src="/_next/static/chunks/fd9d1056-cc48c28d170fddc2.js" async="" crossorigin=""></script><script src="/_next/static/chunks/69-c7efea4b65083e7f.js" async="" crossorigin=""></script><script src="/_next/static/chunks/main-app-f550f103b66f998a.js" async="" crossorigin=""></script><script src="/_next/static/chunks/674-a46cce5ee161a346.js" async=""></script><script src="/_next/static/chunks/app/blog/%5Bslug%5D/page-e23445258eb56deb.js" async=""></script><title>Patrick Desjardins Website and Blog</title><meta name="next-size-adjust"/><script src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js" crossorigin="" noModule=""></script></head><body class="layout_bodystyle__4ncsS"><div class="__className_aaf875"><div class="layout_container__Tovb9"><header class="layout_siteTitle__k5U8g">Patrick Desjardins Blog</header><nav><ul class="layout_navLinks__mf70r"><li class="layout_navLinkItem__1L8fB"><a class="layout_navLinkText__bt28R" href="/">Main Page</a><a class="layout_navLinkText__bt28R" href="/blog">Blog</a><a class="layout_navLinkText__bt28R" href="/blog/for/2024">2024</a><a class="layout_navLinkText__bt28R" href="/blog/for/2023">2023</a><a class="layout_navLinkText__bt28R" href="/blog/for/2022">2022</a><a class="layout_navLinkText__bt28R" href="/blog/for/2021">2021</a><a class="layout_navLinkText__bt28R" href="/blog/for/2020">2020</a><a class="layout_navLinkText__bt28R" href="/blog/for/2019">2019</a><a class="layout_navLinkText__bt28R" href="/blog/for/2018">2018</a><a class="layout_navLinkText__bt28R" href="/blog/for/2017">2017</a><a class="layout_navLinkText__bt28R" href="/blog/for/2016">2016</a><a class="layout_navLinkText__bt28R" href="/blog/for/2015">2015</a><a class="layout_navLinkText__bt28R" href="/blog/for/2014">2014</a><a class="layout_navLinkText__bt28R" href="/blog/for/2013">2013</a><a class="layout_navLinkText__bt28R" href="/blog/for/2012">2012</a><a class="layout_navLinkText__bt28R" href="/blog/for/2011">2011</a></li></ul></nav><div><img alt="Patrick Desjardins picture from a conference" loading="lazy" width="1000" height="300" decoding="async" data-nimg="1" class="layout_blogTopPicture__RJHNN" style="color:transparent" src="/images/backgrounds/patrickdesjardins_conference_bw.jpeg"/></div><main class="layout_main__mXTwS"><h1>How to save multiple entities in inheritance in the same time with Entity Framework 5.0</h1><div class="layout_blogPostContainer__WYELx"><p class="layout_blogPostDate__LUvx5">Posted on: <!-- -->2013-03-06</p><p>Not every page should be CRUD. In the case of our enterprise example, a software that handle workout exercise, we had firstly created a CRUD application. So, the user had to create the workout in 1 page, then go into another one to create sessions and then another to associate ever exercises into session. In fact, for every sessions of exercise the user had to go into a page, associate it with an existing exercise and then go back to the list and do it again and again. So, if you create a new workout with 5 sessions (for every days of the week) you have to go to 7 pages then for every exercise go into a page. That mean that if we have 10 exercises per training that we had to go into 57 pages! With the proposed solution to handle all exercises into the same page we only have 1 page to go.</p>
<p>Here is the database to inform you concerning the schema before going with Entity Framework to save multiple objects in the same time.</p>
<p><img src="/images/blog/DatabaseWorkout-196x400.png" alt=""/></p>
<p>I won&#x27;t display the whole code for creating a Workout from A to Z but concentrate on the goal of this article : saving multiple entities. The entity we want to save is the one called &quot;Workout&quot;, we want to save the sessions and the exercises withing the same page. We won&#x27;t create new exercise from this page, neither muscle and a group of muscle. But, we will use them.</p>
<p>The first step is to get from the form all information. I won&#x27;t enter in detail here because they are multiple ways to do it. Let say that our Model is fully loaded. When I say Model, it&#x27;s the Workout class loaded with WorkoutSessions and WorkoutSessionExercises. It doesn&#x27;t mean that those objects have all scalar properties loaded. For example, we may have only the exercises ID and not the name of this one. In fact, you shouldn&#x27;t have everything loaded because the form shouldn&#x27;t let you edit exercise name. So, we only pass from the form to the controller information concerning unique identifier (in our case Ids) and some other information like the Order of the exercise (see the class WorkoutSessionExercises).</p>
<p>From there, the saving process start. The controller should call the service layer which call the repository. The big works start right here. The first thing to do is to setup a transaction scope. The main reason is that we need to delete exercises that the user might have remove when in a second time we want to add new exercises. We should remove all non used exercises first and then add everything. Otherwise, it won&#x27;t be able to differentiate in the data context which one is removed, and which one is added. The use of transaction scope create a protection if something goes wrong in the later stage that nothing will be deleted. The transaction scope used in the same one that was used in the past with Ado.net, in fact, Entity Framework use behind Ado.Net and it won&#x27;t be a problem to use it. Watch out! you will need to have MSDTC service running because multiple connexion to the database will be done.</p>
<p><img src="/images/blog/msdtc-356x400.png" alt=""/></p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#fff;color:#24292e" tabindex="0" data-language="csharp" data-theme="github-light"><code data-language="csharp" data-theme="github-light" style="display:grid"><span data-line=""><span style="color:#D73A49">public</span><span style="color:#D73A49"> int</span><span style="color:#6F42C1"> Update</span><span style="color:#24292E">(</span><span style="color:#6F42C1">Workout</span><span style="color:#6F42C1"> entity</span><span style="color:#24292E">) { </span></span>
<span data-line=""><span style="color:#D73A49">  using</span><span style="color:#24292E"> (</span><span style="color:#D73A49">var</span><span style="color:#6F42C1"> scope</span><span style="color:#D73A49"> =</span><span style="color:#D73A49"> new</span><span style="color:#6F42C1"> TransactionScope</span><span style="color:#24292E">()) { </span></span>
<span data-line=""><span style="color:#6A737D">    // Remove </span></span>
<span data-line=""><span style="color:#6A737D">    // Insert </span></span>
<span data-line=""><span style="color:#24292E">    scope.</span><span style="color:#6F42C1">Complete</span><span style="color:#24292E">();</span></span>
<span data-line=""><span style="color:#24292E">  } </span></span>
<span data-line=""><span style="color:#24292E">} </span></span></code></pre></figure>
<p>This is how to code should be. A transaction that is before and after remove instruction and insert intruction.</p>
<p>In our case, the code looks like this :</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#fff;color:#24292e" tabindex="0" data-language="csharp" data-theme="github-light"><code data-language="csharp" data-theme="github-light" style="display:grid"><span data-line=""><span style="color:#D73A49"> public</span><span style="color:#D73A49"> int</span><span style="color:#6F42C1"> Update</span><span style="color:#24292E">(</span><span style="color:#6F42C1">Workout</span><span style="color:#6F42C1"> entity</span><span style="color:#24292E">) { </span></span>
<span data-line=""><span style="color:#D73A49">   int</span><span style="color:#6F42C1"> count</span><span style="color:#D73A49"> =</span><span style="color:#D73A49"> -</span><span style="color:#005CC5">1</span><span style="color:#24292E">; </span></span>
<span data-line=""><span style="color:#D73A49">  using</span><span style="color:#24292E"> (</span><span style="color:#005CC5">base</span><span style="color:#24292E">.DatabaseContext.</span><span style="color:#6F42C1">RemoveValidation</span><span style="color:#24292E">()) { </span></span>
<span data-line=""><span style="color:#D73A49">    using</span><span style="color:#24292E"> (</span><span style="color:#D73A49">var</span><span style="color:#6F42C1"> scope</span><span style="color:#D73A49"> =</span><span style="color:#D73A49"> new</span><span style="color:#6F42C1"> TransactionScope</span><span style="color:#24292E">()) { </span></span>
<span data-line=""><span style="color:#6F42C1">      RemoveWorkoutSessionExercisesNotUsedAnymore</span><span style="color:#24292E">(entity); </span></span>
<span data-line=""><span style="color:#6F42C1">      SetupWorkoutForRepository</span><span style="color:#24292E">(entity); </span></span>
<span data-line=""><span style="color:#24292E">      DatabaseContext.</span><span style="color:#6F42C1">UpdateOwnable</span><span style="color:#24292E">(entity); </span></span>
<span data-line=""><span style="color:#D73A49">      var</span><span style="color:#6F42C1"> ent</span><span style="color:#D73A49"> =</span><span style="color:#24292E"> DatabaseContext.</span><span style="color:#6F42C1">SetOwnable</span><span style="color:#24292E">&lt;</span><span style="color:#6F42C1">Workout</span><span style="color:#24292E">&gt;().Local.</span><span style="color:#6F42C1">SingleOrDefault</span><span style="color:#24292E">(</span><span style="color:#6F42C1">d</span><span style="color:#D73A49"> =&gt;</span><span style="color:#24292E"> d.Id </span><span style="color:#D73A49">==</span><span style="color:#24292E"> entity.Id); </span></span>
<span data-line=""><span style="color:#24292E">      DatabaseContext.</span><span style="color:#6F42C1">Entry</span><span style="color:#24292E">(ent).CurrentValues.</span><span style="color:#6F42C1">SetValues</span><span style="color:#24292E">(entity); </span></span>
<span data-line=""><span style="color:#24292E">      count </span><span style="color:#D73A49">=</span><span style="color:#24292E"> DatabaseContext.</span><span style="color:#6F42C1">SaveChanges</span><span style="color:#24292E">(); </span></span>
<span data-line=""><span style="color:#24292E">      scope.</span><span style="color:#6F42C1">Complete</span><span style="color:#24292E">(); </span></span>
<span data-line=""><span style="color:#24292E">    } </span></span>
<span data-line=""><span style="color:#24292E">  } </span></span>
<span data-line=""><span style="color:#D73A49">  return</span><span style="color:#24292E"> count; </span></span>
<span data-line=""><span style="color:#24292E">} </span></span></code></pre></figure>
<p>Has you can see, few things are added. First, the DatabaseContext is using a <em>USING</em> with RemoveValidation method. This is a custom method that remove temporary all validations by Entity Framework. The code call ValidateOnSaveEnabled and set it to false and put it back to true once the scope of the using is over. This is ain&#x27;t a requirement for you, but I let it there for the reason that you may have to do it. The justification is quite simple. When you are saving from partial data that contain only the primary key (Id) and you attach these one you may have some error that some required field aren&#x27;t provided. If you tell Entity Framework not to check the validation, you won&#x27;t have this trouble.</p>
<p>Second, you see that we call <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-light" style="background-color:#fff;color:#24292e"><span data-line=""><span>RemoveWorkoutSessionExercisesNotUsedAnymore(...)</span></span></code></span> followed by <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-light" style="background-color:#fff;color:#24292e"><span data-line=""><span>SetupWorkoutForRepository(...)</span></span></code></span>. The Remove function do a query to the database to get the list of existing entities and compare with the one provided by the form (from the web page). All entities that were there and that is not anymore are removed.</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#fff;color:#24292e" tabindex="0" data-language="csharp" data-theme="github-light"><code data-language="csharp" data-theme="github-light" style="display:grid"><span data-line=""><span style="color:#D73A49">private</span><span style="color:#D73A49"> void</span><span style="color:#6F42C1"> RemoveWorkoutSessionExercisesNotUsedAnymore</span><span style="color:#24292E">(</span><span style="color:#6F42C1">Workout</span><span style="color:#6F42C1"> entity</span><span style="color:#24292E">) { </span></span>
<span data-line=""><span style="color:#D73A49">  var</span><span style="color:#6F42C1"> listWorkoutSessionExerciseThatStillRemain</span><span style="color:#D73A49"> =</span><span style="color:#24292E"> entity.Sessions.</span><span style="color:#6F42C1">SelectMany</span><span style="color:#24292E">(</span><span style="color:#6F42C1">d</span><span style="color:#D73A49">=&gt;</span><span style="color:#24292E">d.WorkoutSessionExercises).</span><span style="color:#6F42C1">Select</span><span style="color:#24292E">(</span><span style="color:#6F42C1">d</span><span style="color:#D73A49">=&gt;</span><span style="color:#24292E">d.Id).</span><span style="color:#6F42C1">ToArray</span><span style="color:#24292E">(); </span></span>
<span data-line=""><span style="color:#D73A49">  var</span><span style="color:#6F42C1"> workoutSessionExerciseFromDatabase</span><span style="color:#D73A49"> =</span><span style="color:#24292E"> DatabaseContext.</span><span style="color:#6F42C1">SetOwnable</span><span style="color:#24292E">&lt;</span><span style="color:#6F42C1">WorkoutSessionExercise</span><span style="color:#24292E">&gt;()</span></span>
<span data-line=""><span style="color:#24292E">  .</span><span style="color:#6F42C1">Where</span><span style="color:#24292E">(</span><span style="color:#6F42C1">d</span><span style="color:#D73A49">=&gt;!</span><span style="color:#24292E">listWorkoutSessionExerciseThatStillRemain.</span><span style="color:#6F42C1">Contains</span><span style="color:#24292E">(d.Id) </span><span style="color:#D73A49">&amp;&amp;</span><span style="color:#24292E"> d.WorkoutSession.Workout.Id </span><span style="color:#D73A49">==</span><span style="color:#24292E"> entity.Id);</span></span>
<span data-line=""><span style="color:#24292E">  </span></span>
<span data-line=""><span style="color:#D73A49">  foreach</span><span style="color:#24292E"> (</span><span style="color:#D73A49">var</span><span style="color:#6F42C1"> sessionExercise</span><span style="color:#D73A49"> in</span><span style="color:#24292E"> workoutSessionExerciseFromDatabase) { </span></span>
<span data-line=""><span style="color:#24292E">    DatabaseContext.</span><span style="color:#6F42C1">SetOwnable</span><span style="color:#24292E">&lt;</span><span style="color:#6F42C1">WorkoutSessionExercise</span><span style="color:#24292E">&gt;().</span><span style="color:#6F42C1">Remove</span><span style="color:#24292E">(sessionExercise); </span></span>
<span data-line=""><span style="color:#24292E">  } </span></span>
<span data-line=""><span style="color:#24292E">  DatabaseContext.</span><span style="color:#6F42C1">SaveChanges</span><span style="color:#24292E">(); </span></span>
<span data-line=""><span style="color:#24292E">} </span></span></code></pre></figure>
<p>The code is good for new and modified Workout entity. In the case of a new entity, the list of workout session exercise from the database will be empty and nothing will be removed. In the case of a modified Workout that contains workout session exercise, those are removed if they are not found in the list of Id that the user uses. At the end, we call <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-light" style="background-color:#fff;color:#24292e"><span data-line=""><span>SaveChange()</span></span></code></span> which commit the delete statement to the Sql Server. Of course, since we are in a transaction, nothing will be really committed yet.</p>
<p>Third, the SetupWorkoutForRepository is called. This method is the heart of the work for modifying an entity with multiple children objects. Once the setup is done, the database is saved and the transaction is completed. At this final moment, every delete and insert are commited to the Sql Server Database.</p>
<p>Let&#x27;s take a look at the setup method which prepare the model classe to be saved by Entity Framework.</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#fff;color:#24292e" tabindex="0" data-language="csharp" data-theme="github-light"><code data-language="csharp" data-theme="github-light" style="display:grid"><span data-line=""><span style="color:#D73A49"> private</span><span style="color:#D73A49"> void</span><span style="color:#6F42C1"> SetupWorkoutForRepository</span><span style="color:#24292E">(</span><span style="color:#6F42C1">Workout</span><span style="color:#6F42C1"> entity</span><span style="color:#24292E">) { </span></span>
<span data-line=""><span style="color:#D73A49">   if</span><span style="color:#24292E"> (entity.Sessions </span><span style="color:#D73A49">!=</span><span style="color:#005CC5"> null</span><span style="color:#24292E">) { </span></span>
<span data-line=""><span style="color:#D73A49">     foreach</span><span style="color:#24292E"> (</span><span style="color:#D73A49">var</span><span style="color:#6F42C1"> workoutSession</span><span style="color:#D73A49"> in</span><span style="color:#24292E"> entity.Sessions) { </span></span>
<span data-line=""><span style="color:#D73A49">       if</span><span style="color:#24292E"> (workoutSession.WorkoutSessionExercises </span><span style="color:#D73A49">!=</span><span style="color:#005CC5"> null</span><span style="color:#24292E">) { </span></span>
<span data-line=""><span style="color:#D73A49">         foreach</span><span style="color:#24292E"> (</span><span style="color:#D73A49">var</span><span style="color:#6F42C1"> workoutSessionExercise</span><span style="color:#D73A49"> in</span><span style="color:#24292E"> workoutSession.WorkoutSessionExercises) { </span></span>
<span data-line=""><span style="color:#D73A49">           if</span><span style="color:#24292E"> (workoutSessionExercise.Exercise </span><span style="color:#D73A49">!=</span><span style="color:#005CC5"> null</span><span style="color:#24292E">) { </span></span>
<span data-line=""><span style="color:#D73A49">             if</span><span style="color:#24292E"> (workoutSessionExercise.Exercise.Id </span><span style="color:#D73A49">==</span><span style="color:#24292E"> BaseModel.NOT_INITIALIZED) { </span></span>
<span data-line=""><span style="color:#24292E">               workoutSessionExercise.Exercise </span><span style="color:#D73A49">=</span><span style="color:#005CC5"> null</span><span style="color:#24292E">; </span></span>
<span data-line=""><span style="color:#6A737D">               //Should never go there </span></span>
<span data-line=""><span style="color:#24292E">               } </span><span style="color:#D73A49">else</span><span style="color:#24292E"> { </span></span>
<span data-line=""><span style="color:#D73A49">                 if</span><span style="color:#24292E"> (DatabaseContext.</span><span style="color:#6F42C1">Set</span><span style="color:#24292E">&lt;</span><span style="color:#6F42C1">Exercise</span><span style="color:#24292E">&gt;().Local.</span><span style="color:#6F42C1">All</span><span style="color:#24292E">(</span><span style="color:#6F42C1">e</span><span style="color:#D73A49"> =&gt;</span><span style="color:#24292E"> e.Id </span><span style="color:#D73A49">!=</span><span style="color:#24292E"> workoutSessionExercise.Exercise.Id)) { </span></span>
<span data-line=""><span style="color:#24292E">                   workoutSessionExercise.Exercise </span><span style="color:#D73A49">=</span><span style="color:#24292E"> DatabaseContext.</span><span style="color:#6F42C1">Set</span><span style="color:#24292E">&lt;</span><span style="color:#6F42C1">Exercise</span><span style="color:#24292E">&gt;().</span><span style="color:#6F42C1">Attach</span><span style="color:#24292E">(workoutSessionExercise.Exercise); </span></span>
<span data-line=""><span style="color:#24292E">                } </span><span style="color:#D73A49">else</span><span style="color:#24292E"> { </span></span>
<span data-line=""><span style="color:#24292E">                  workoutSessionExercise.Exercise </span><span style="color:#D73A49">=</span><span style="color:#24292E"> DatabaseContext.</span><span style="color:#6F42C1">Set</span><span style="color:#24292E">&lt;</span><span style="color:#6F42C1">Exercise</span><span style="color:#24292E">&gt;().Local.</span><span style="color:#6F42C1">Single</span><span style="color:#24292E">(</span><span style="color:#6F42C1">e</span><span style="color:#D73A49"> =&gt;</span><span style="color:#24292E"> e.Id </span><span style="color:#D73A49">==</span><span style="color:#24292E"> workoutSessionExercise.Exercise.Id); </span></span>
<span data-line=""><span style="color:#24292E">                }</span></span>
<span data-line=""><span style="color:#24292E">              } </span></span>
<span data-line=""><span style="color:#24292E">            }</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#D73A49">          if</span><span style="color:#24292E"> (workoutSessionExercise.Id </span><span style="color:#D73A49">==</span><span style="color:#24292E"> BaseModel.NOT_INITIALIZED) { </span></span>
<span data-line=""><span style="color:#6A737D">            //New workout session exercise </span></span>
<span data-line=""><span style="color:#24292E">            DatabaseContext.</span><span style="color:#6F42C1">SetOwnable</span><span style="color:#24292E">&lt;</span><span style="color:#6F42C1">WorkoutSessionExercise</span><span style="color:#24292E">&gt;().</span><span style="color:#6F42C1">Add</span><span style="color:#24292E">(workoutSessionExercise); </span></span>
<span data-line=""><span style="color:#24292E">          } </span><span style="color:#D73A49">else</span><span style="color:#24292E"> { </span></span>
<span data-line=""><span style="color:#D73A49">            if</span><span style="color:#24292E"> (DatabaseContext.</span><span style="color:#6F42C1">Set</span><span style="color:#24292E">&lt;</span><span style="color:#6F42C1">WorkoutSessionExercise</span><span style="color:#24292E">&gt;().Local.</span><span style="color:#6F42C1">All</span><span style="color:#24292E">(</span><span style="color:#6F42C1">e</span><span style="color:#D73A49"> =&gt;</span><span style="color:#24292E"> e.Id </span><span style="color:#D73A49">!=</span><span style="color:#24292E"> workoutSessionExercise.Id)) { </span></span>
<span data-line=""><span style="color:#24292E">              DatabaseContext.</span><span style="color:#6F42C1">SetOwnable</span><span style="color:#24292E">&lt;</span><span style="color:#6F42C1">WorkoutSessionExercise</span><span style="color:#24292E">&gt;().</span><span style="color:#6F42C1">Attach</span><span style="color:#24292E">(workoutSessionExercise); </span></span>
<span data-line=""><span style="color:#24292E">            } </span></span>
<span data-line=""><span style="color:#24292E">          } </span></span>
<span data-line=""><span style="color:#24292E">        } </span></span>
<span data-line=""><span style="color:#D73A49">        if</span><span style="color:#24292E"> (workoutSession.Id </span><span style="color:#D73A49">==</span><span style="color:#24292E"> BaseModel.NOT_INITIALIZED) { </span></span>
<span data-line=""><span style="color:#24292E">          DatabaseContext.</span><span style="color:#6F42C1">SetOwnable</span><span style="color:#24292E">&lt;</span><span style="color:#6F42C1">WorkoutSession</span><span style="color:#24292E">&gt;().</span><span style="color:#6F42C1">Add</span><span style="color:#24292E">(workoutSession); </span></span>
<span data-line=""><span style="color:#24292E">        } </span><span style="color:#D73A49">else</span><span style="color:#24292E"> { </span></span>
<span data-line=""><span style="color:#D73A49">          var</span><span style="color:#6F42C1"> dbEntry</span><span style="color:#D73A49"> =</span><span style="color:#24292E"> DatabaseContext.</span><span style="color:#6F42C1">SetOwnable</span><span style="color:#24292E">&lt;</span><span style="color:#6F42C1">WorkoutSession</span><span style="color:#24292E">&gt;().Local.</span><span style="color:#6F42C1">SingleOrDefault</span><span style="color:#24292E">(</span><span style="color:#6F42C1">e</span><span style="color:#D73A49"> =&gt;</span><span style="color:#24292E"> e.Id </span><span style="color:#D73A49">==</span><span style="color:#24292E"> workoutSession.Id); </span></span>
<span data-line=""><span style="color:#D73A49">          if</span><span style="color:#24292E"> (dbEntry</span><span style="color:#D73A49">==</span><span style="color:#005CC5">null</span><span style="color:#24292E">) { </span></span>
<span data-line=""><span style="color:#24292E">            dbEntry </span><span style="color:#D73A49">=</span><span style="color:#24292E"> DatabaseContext.</span><span style="color:#6F42C1">SetOwnable</span><span style="color:#24292E">&lt;</span><span style="color:#6F42C1">WorkoutSession</span><span style="color:#24292E">&gt;().</span><span style="color:#6F42C1">Attach</span><span style="color:#24292E">(workoutSession); </span></span>
<span data-line=""><span style="color:#24292E">          } </span></span>
<span data-line=""><span style="color:#24292E">        }</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#D73A49">        foreach</span><span style="color:#24292E"> (</span><span style="color:#D73A49">var</span><span style="color:#6F42C1"> workoutSessionExercise</span><span style="color:#D73A49"> in</span><span style="color:#24292E"> workoutSession.WorkoutSessionExercises) { </span></span>
<span data-line=""><span style="color:#24292E">          workoutSessionExercise.WorkoutSession </span><span style="color:#D73A49">=</span><span style="color:#24292E"> DatabaseContext.</span><span style="color:#6F42C1">SetOwnable</span><span style="color:#24292E">&lt;</span><span style="color:#6F42C1">WorkoutSession</span><span style="color:#24292E">&gt;().Local.</span><span style="color:#6F42C1">SingleOrDefault</span><span style="color:#24292E">(</span><span style="color:#6F42C1">d</span><span style="color:#D73A49">=&gt;</span><span style="color:#24292E">d.Id </span><span style="color:#D73A49">==</span><span style="color:#24292E"> workoutSession.Id); </span></span>
<span data-line=""><span style="color:#24292E">        } </span></span>
<span data-line=""><span style="color:#24292E">      } </span></span>
<span data-line=""><span style="color:#24292E">    } </span></span>
<span data-line=""><span style="color:#24292E">  } </span></span>
<span data-line=""><span style="color:#24292E">} </span></span></code></pre></figure>
<p>I&#x27;ll go through the whole method because almost all possibles care are treated. First, a Workout contains a list of session. Most of the time, this collection won&#x27;t be null and we will start looping through them. The same mechanism is executed for the WorkoutSessionExercises collection. Since, in our case, exercise aren&#x27;t deleted or modified directly into this screen, we have some case simplified. This is why we know that the exercise cannot be null. But, we know that the user can set an exercise to a session. Two scenarios occurs. The first one is that it&#x27;s the first time we use this exercise. If it&#x27;s the case, then we need to set Entity Framework an attached object that will represent the exercise. This is done with the line</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#fff;color:#24292e" tabindex="0" data-language="csharp" data-theme="github-light"><code data-language="csharp" data-theme="github-light" style="display:grid"><span data-line=""><span style="color:#24292E"> workoutSessionExercise.Exercise </span><span style="color:#D73A49">=</span><span style="color:#24292E"> DatabaseContext.</span><span style="color:#6F42C1">Set</span><span style="color:#24292E">&lt;</span><span style="color:#6F42C1">Exercise</span><span style="color:#24292E">&gt;().</span><span style="color:#6F42C1">Attach</span><span style="color:#24292E">(workoutSessionExercise.Exercise); </span></span></code></pre></figure>
<p>The second one is then the exercise has already been used. So, it has already been attached or has been added. We use the Local property to get the instance of the entity from Entity Framework this give us the certitude that we are working on the same Exercise.</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#fff;color:#24292e" tabindex="0" data-language="csharp" data-theme="github-light"><code data-language="csharp" data-theme="github-light" style="display:grid"><span data-line=""><span style="color:#24292E"> workoutSessionExercise.Exercise </span><span style="color:#D73A49">=</span><span style="color:#24292E"> DatabaseContext.</span><span style="color:#6F42C1">Set</span><span style="color:#24292E">&lt;</span><span style="color:#6F42C1">Exercise</span><span style="color:#24292E">&gt;().Local.</span><span style="color:#6F42C1">Single</span><span style="color:#24292E">(</span><span style="color:#6F42C1">e</span><span style="color:#D73A49"> =&gt;</span><span style="color:#24292E"> e.Id </span><span style="color:#D73A49">==</span><span style="color:#24292E"> workoutSessionExercise.Exercise.Id); </span></span></code></pre></figure>
<p>At the end, we do the same for the workout session exercise. Why do we do exercise first and then we do exercise session? Because attaching or adding the exercise session would result to attach their sub property which is not what we want because we want to control if we attach or not the entity. We want to control what is attached and added and this is why we need to attach stuff from the bottom to up.</p>
<p>Also, you may want to save some property and not everything. In that case you can select the property and indicate if this one has changed or not.</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#fff;color:#24292e" tabindex="0" data-language="csharp" data-theme="github-light"><code data-language="csharp" data-theme="github-light" style="display:grid"><span data-line=""><span style="color:#24292E"> DatabaseContext.</span><span style="color:#6F42C1">Entry</span><span style="color:#24292E">(dbEntry).</span><span style="color:#6F42C1">Property</span><span style="color:#24292E">(</span><span style="color:#6F42C1">d</span><span style="color:#D73A49"> =&gt;</span><span style="color:#24292E"> d.Name).IsModified </span><span style="color:#D73A49">=</span><span style="color:#005CC5"> false</span><span style="color:#24292E">; </span></span></code></pre></figure>
<p>This is an example that we could have set for the WorkoutSession if we would have like not to change the WorkoutSession name.</p>
<p>To conclude, it&#x27;s possible to save multiple objects that are composed withing a single Entity Framework data context. This approach is not without negative effect. You will soon realize that it requires some time to code every attachment correctly and depending of how your objects are composed and how you use Entity Framework (with or without ID for each foreign key, with or without loading the full graph) your configuration will change.</p></div></main><div class="layout_paginationBar__jnuuR"><div class="layout_paginationTitle__PsOw5">Chronological Blog Articles by Page</div><div class="layout_paginationLinks__LdBaH"><a class="" href="/blog/page/1">1</a><a class="" href="/blog/page/2">2</a><a class="" href="/blog/page/3">3</a><a class="" href="/blog/page/4">4</a><a class="" href="/blog/page/5">5</a><a class="" href="/blog/page/6">6</a><a class="" href="/blog/page/7">7</a><a class="" href="/blog/page/8">8</a><a class="" href="/blog/page/9">9</a><a class="" href="/blog/page/10">10</a><a class="" href="/blog/page/11">11</a><a class="" href="/blog/page/12">12</a><a class="" href="/blog/page/13">13</a><a class="" href="/blog/page/14">14</a><a class="" href="/blog/page/15">15</a><a class="" href="/blog/page/16">16</a><a class="" href="/blog/page/17">17</a><a class="" href="/blog/page/18">18</a><a class="" href="/blog/page/19">19</a><a class="" href="/blog/page/20">20</a><a class="" href="/blog/page/21">21</a><a class="" href="/blog/page/22">22</a><a class="" href="/blog/page/23">23</a><a class="" href="/blog/page/24">24</a><a class="" href="/blog/page/25">25</a><a class="" href="/blog/page/26">26</a><a class="" href="/blog/page/27">27</a><a class="" href="/blog/page/28">28</a><a class="" href="/blog/page/29">29</a><a class="" href="/blog/page/30">30</a><a class="" href="/blog/page/31">31</a><a class="" href="/blog/page/32">32</a><a class="" href="/blog/page/33">33</a><a class="" href="/blog/page/34">34</a><a class="" href="/blog/page/35">35</a><a class="" href="/blog/page/36">36</a><a class="" href="/blog/page/37">37</a><a class="" href="/blog/page/38">38</a><a class="" href="/blog/page/39">39</a><a class="" href="/blog/page/40">40</a><a class="" href="/blog/page/41">41</a><a class="" href="/blog/page/42">42</a><a class="" href="/blog/page/43">43</a><a class="" href="/blog/page/44">44</a><a class="" href="/blog/page/45">45</a><a class="" href="/blog/page/46">46</a><a class="" href="/blog/page/47">47</a><a class="" href="/blog/page/48">48</a><a class="" href="/blog/page/49">49</a><a class="" href="/blog/page/50">50</a><a class="" href="/blog/page/51">51</a><a class="" href="/blog/page/52">52</a><a class="" href="/blog/page/53">53</a><a class="" href="/blog/page/54">54</a><a class="" href="/blog/page/55">55</a><a class="" href="/blog/page/56">56</a><a class="" href="/blog/page/57">57</a><a class="" href="/blog/page/58">58</a><a class="" href="/blog/page/59">59</a><a class="" href="/blog/page/60">60</a><a class="" href="/blog/page/61">61</a><a class="" href="/blog/page/62">62</a><a class="" href="/blog/page/63">63</a><a class="" href="/blog/page/64">64</a><a class="" href="/blog/page/65">65</a><a class="" href="/blog/page/66">66</a><a class="" href="/blog/page/67">67</a><a class="" href="/blog/page/68">68</a><a class="" href="/blog/page/69">69</a><a class="" href="/blog/page/70">70</a><a class="" href="/blog/page/71">71</a><a class="" href="/blog/page/72">72</a><a class="" href="/blog/page/73">73</a><a class="" href="/blog/page/74">74</a><a class="" href="/blog/page/75">75</a><a class="" href="/blog/page/76">76</a><a class="" href="/blog/page/77">77</a></div></div></div></div><script src="/_next/static/chunks/webpack-692a33e6ebc06ff4.js" crossorigin="" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0]);self.__next_f.push([2,null])</script><script>self.__next_f.push([1,"1:HL[\"/_next/static/css/f7004a68ac8d367c.css\",\"style\",{\"crossOrigin\":\"\"}]\n0:\"$L2\"\n"])</script><script>self.__next_f.push([1,"3:HL[\"/_next/static/media/c9a5bc6a7c948fb0-s.p.woff2\",\"font\",{\"crossOrigin\":\"\",\"type\":\"font/woff2\"}]\n4:HL[\"/_next/static/css/e917b4f00bcb2347.css\",\"style\",{\"crossOrigin\":\"\"}]\n"])</script><script>self.__next_f.push([1,"5:I[7690,[],\"\"]\n8:I[5613,[],\"\"]\na:I[1778,[],\"\"]\nc:I[8955,[],\"\"]\n9:[\"slug\",\"how-to-save-multiple-entities-in-inheritance-in-the-same-time-with-entity-framework-5-0\",\"d\"]\nd:[]\n"])</script><script>self.__next_f.push([1,"2:[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/f7004a68ac8d367c.css\",\"precedence\":\"next\",\"crossOrigin\":\"\"}]],[\"$\",\"$L5\",null,{\"buildId\":\"U9WHEHP9m9dAVmOepwIU5\",\"assetPrefix\":\"\",\"initialCanonicalUrl\":\"/blog/how-to-save-multiple-entities-in-inheritance-in-the-same-time-with-entity-framework-5-0\",\"initialTree\":[\"\",{\"children\":[\"blog\",{\"children\":[[\"slug\",\"how-to-save-multiple-entities-in-inheritance-in-the-same-time-with-entity-framework-5-0\",\"d\"],{\"children\":[\"__PAGE__?{\\\"slug\\\":\\\"how-to-save-multiple-entities-in-inheritance-in-the-same-time-with-entity-framework-5-0\\\"}\",{}]}]}]},\"$undefined\",\"$undefined\",true],\"initialSeedData\":[\"\",{\"children\":[\"blog\",{\"children\":[[\"slug\",\"how-to-save-multiple-entities-in-inheritance-in-the-same-time-with-entity-framework-5-0\",\"d\"],{\"children\":[\"__PAGE__\",{},[\"$L6\",\"$L7\",null]]},[\"$\",\"$L8\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"blog\",\"children\",\"$9\",\"children\"],\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"loadingScripts\":\"$undefined\",\"hasLoading\":false,\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$La\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\",\"styles\":[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/e917b4f00bcb2347.css\",\"precedence\":\"next\",\"crossOrigin\":\"\"}]]}]]},[\"$\",\"$L8\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"blog\",\"children\"],\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"loadingScripts\":\"$undefined\",\"hasLoading\":false,\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$La\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\",\"styles\":null}]]},[null,[\"$\",\"html\",null,{\"lang\":\"en\",\"children\":[[\"$\",\"head\",null,{\"children\":[[\"$\",\"title\",null,{\"children\":\"Patrick Desjardins Website and Blog\"}],[\"$\",\"meta\",null,{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1, shrink-to-fit=no\"}]]}],[\"$\",\"body\",null,{\"className\":\"layout_bodystyle__4ncsS\",\"children\":[\"$\",\"$L8\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\"],\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"loadingScripts\":\"$undefined\",\"hasLoading\":false,\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$La\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[[\"$\",\"title\",null,{\"children\":\"404: This page could not be found.\"}],[\"$\",\"div\",null,{\"style\":{\"fontFamily\":\"system-ui,\\\"Segoe UI\\\",Roboto,Helvetica,Arial,sans-serif,\\\"Apple Color Emoji\\\",\\\"Segoe UI Emoji\\\"\",\"height\":\"100vh\",\"textAlign\":\"center\",\"display\":\"flex\",\"flexDirection\":\"column\",\"alignItems\":\"center\",\"justifyContent\":\"center\"},\"children\":[\"$\",\"div\",null,{\"children\":[[\"$\",\"style\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}\"}}],[\"$\",\"h1\",null,{\"className\":\"next-error-h1\",\"style\":{\"display\":\"inline-block\",\"margin\":\"0 20px 0 0\",\"padding\":\"0 23px 0 0\",\"fontSize\":24,\"fontWeight\":500,\"verticalAlign\":\"top\",\"lineHeight\":\"49px\"},\"children\":\"404\"}],[\"$\",\"div\",null,{\"style\":{\"display\":\"inline-block\"},\"children\":[\"$\",\"h2\",null,{\"style\":{\"fontSize\":14,\"fontWeight\":400,\"lineHeight\":\"49px\",\"margin\":0},\"children\":\"This page could not be found.\"}]}]]}]}]],\"notFoundStyles\":[],\"styles\":null}]}]]}],null]],\"initialHead\":[false,\"$Lb\"],\"globalErrorComponent\":\"$c\",\"missingSlots\":\"$Wd\"}]]\n"])</script><script>self.__next_f.push([1,"e:I[5250,[\"674\",\"static/chunks/674-a46cce5ee161a346.js\",\"308\",\"static/chunks/app/blog/%5Bslug%5D/page-e23445258eb56deb.js\"],\"\"]\nf:I[1749,[\"674\",\"static/chunks/674-a46cce5ee161a346.js\",\"308\",\"static/chunks/app/blog/%5Bslug%5D/page-e23445258eb56deb.js\"],\"Image\"]\nb:[[\"$\",\"meta\",\"0\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}],[\"$\",\"meta\",\"1\",{\"charSet\":\"utf-8\"}],[\"$\",\"meta\",\"2\",{\"name\":\"next-size-adjust\"}]]\n6:null\n"])</script><script>self.__next_f.push([1,"7:[\"$\",\"div\",null,{\"className\":\"__className_aaf875\",\"children\":[\"$\",\"div\",null,{\"className\":\"layout_container__Tovb9\",\"children\":[[\"$\",\"header\",null,{\"className\":\"layout_siteTitle__k5U8g\",\"children\":\"Patrick Desjardins Blog\"}],[\"$\",\"nav\",null,{\"children\":[\"$\",\"ul\",null,{\"className\":\"layout_navLinks__mf70r\",\"children\":[\"$\",\"li\",null,{\"className\":\"layout_navLinkItem__1L8fB\",\"children\":[[\"$\",\"$Le\",null,{\"className\":\"layout_navLinkText__bt28R\",\"href\":\"/\",\"children\":\"Main Page\"}],[\"$\",\"$Le\",null,{\"className\":\"layout_navLinkText__bt28R\",\"href\":\"/blog\",\"children\":\"Blog\"}],[[\"$\",\"$Le\",\"2024\",{\"className\":\"layout_navLinkText__bt28R\",\"href\":\"/blog/for/2024\",\"children\":2024}],[\"$\",\"$Le\",\"2023\",{\"className\":\"layout_navLinkText__bt28R\",\"href\":\"/blog/for/2023\",\"children\":2023}],[\"$\",\"$Le\",\"2022\",{\"className\":\"layout_navLinkText__bt28R\",\"href\":\"/blog/for/2022\",\"children\":2022}],[\"$\",\"$Le\",\"2021\",{\"className\":\"layout_navLinkText__bt28R\",\"href\":\"/blog/for/2021\",\"children\":2021}],[\"$\",\"$Le\",\"2020\",{\"className\":\"layout_navLinkText__bt28R\",\"href\":\"/blog/for/2020\",\"children\":2020}],[\"$\",\"$Le\",\"2019\",{\"className\":\"layout_navLinkText__bt28R\",\"href\":\"/blog/for/2019\",\"children\":2019}],[\"$\",\"$Le\",\"2018\",{\"className\":\"layout_navLinkText__bt28R\",\"href\":\"/blog/for/2018\",\"children\":2018}],[\"$\",\"$Le\",\"2017\",{\"className\":\"layout_navLinkText__bt28R\",\"href\":\"/blog/for/2017\",\"children\":2017}],[\"$\",\"$Le\",\"2016\",{\"className\":\"layout_navLinkText__bt28R\",\"href\":\"/blog/for/2016\",\"children\":2016}],[\"$\",\"$Le\",\"2015\",{\"className\":\"layout_navLinkText__bt28R\",\"href\":\"/blog/for/2015\",\"children\":2015}],[\"$\",\"$Le\",\"2014\",{\"className\":\"layout_navLinkText__bt28R\",\"href\":\"/blog/for/2014\",\"children\":2014}],[\"$\",\"$Le\",\"2013\",{\"className\":\"layout_navLinkText__bt28R\",\"href\":\"/blog/for/2013\",\"children\":2013}],[\"$\",\"$Le\",\"2012\",{\"className\":\"layout_navLinkText__bt28R\",\"href\":\"/blog/for/2012\",\"children\":2012}],[\"$\",\"$Le\",\"2011\",{\"className\":\"layout_navLinkText__bt28R\",\"href\":\"/blog/for/2011\",\"children\":2011}]]]}]}]}],[\"$\",\"div\",null,{\"children\":[\"$\",\"$Lf\",null,{\"className\":\"layout_blogTopPicture__RJHNN\",\"alt\":\"Patrick Desjardins picture from a conference\",\"src\":\"/images/backgrounds/patrickdesjardins_conference_bw.jpeg\",\"width\":1000,\"height\":300}]}],[\"$\",\"main\",null,{\"className\":\"layout_main__mXTwS\",\"children\":[[\"$\",\"h1\",null,{\"children\":\"How to save multiple entities in inheritance in the same time with Entity Framework 5.0\"}],[\"$\",\"div\",null,{\"className\":\"layout_blogPostContainer__WYELx\",\"children\":[[\"$\",\"p\",null,{\"className\":\"layout_blogPostDate__LUvx5\",\"children\":[\"Posted on: \",\"2013-03-06\"]}],[[\"$\",\"p\",null,{\"children\":\"Not every page should be CRUD. In the case of our enterprise example, a software that handle workout exercise, we had firstly created a CRUD application. So, the user had to create the workout in 1 page, then go into another one to create sessions and then another to associate ever exercises into session. In fact, for every sessions of exercise the user had to go into a page, associate it with an existing exercise and then go back to the list and do it again and again. So, if you create a new workout with 5 sessions (for every days of the week) you have to go to 7 pages then for every exercise go into a page. That mean that if we have 10 exercises per training that we had to go into 57 pages! With the proposed solution to handle all exercises into the same page we only have 1 page to go.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Here is the database to inform you concerning the schema before going with Entity Framework to save multiple objects in the same time.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"img\",null,{\"src\":\"/images/blog/DatabaseWorkout-196x400.png\",\"alt\":\"\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"I won't display the whole code for creating a Workout from A to Z but concentrate on the goal of this article : saving multiple entities. The entity we want to save is the one called \\\"Workout\\\", we want to save the sessions and the exercises withing the same page. We won't create new exercise from this page, neither muscle and a group of muscle. But, we will use them.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"The first step is to get from the form all information. I won't enter in detail here because they are multiple ways to do it. Let say that our Model is fully loaded. When I say Model, it's the Workout class loaded with WorkoutSessions and WorkoutSessionExercises. It doesn't mean that those objects have all scalar properties loaded. For example, we may have only the exercises ID and not the name of this one. In fact, you shouldn't have everything loaded because the form shouldn't let you edit exercise name. So, we only pass from the form to the controller information concerning unique identifier (in our case Ids) and some other information like the Order of the exercise (see the class WorkoutSessionExercises).\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"From there, the saving process start. The controller should call the service layer which call the repository. The big works start right here. The first thing to do is to setup a transaction scope. The main reason is that we need to delete exercises that the user might have remove when in a second time we want to add new exercises. We should remove all non used exercises first and then add everything. Otherwise, it won't be able to differentiate in the data context which one is removed, and which one is added. The use of transaction scope create a protection if something goes wrong in the later stage that nothing will be deleted. The transaction scope used in the same one that was used in the past with Ado.net, in fact, Entity Framework use behind Ado.Net and it won't be a problem to use it. Watch out! you will need to have MSDTC service running because multiple connexion to the database will be done.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"img\",null,{\"src\":\"/images/blog/msdtc-356x400.png\",\"alt\":\"\"}]}],\"\\n\",[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"backgroundColor\":\"#fff\",\"color\":\"#24292e\"},\"tabIndex\":\"0\",\"data-language\":\"csharp\",\"data-theme\":\"github-light\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"csharp\",\"data-theme\":\"github-light\",\"style\":{\"display\":\"grid\"},\"children\":[[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" int\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" Update\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Workout\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" entity\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\") { \"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"  using\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" (\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"var\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" scope\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" new\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" TransactionScope\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"()) { \"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#6A737D\"},\"children\":\"    // Remove \"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#6A737D\"},\"children\":\"    // Insert \"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"    scope.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Complete\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"();\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"  } \"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"} \"}]}]]}]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"This is how to code should be. A transaction that is before and after remove instruction and insert intruction.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"In our case, the code looks like this :\"}],\"\\n\",[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"backgroundColor\":\"#fff\",\"color\":\"#24292e\"},\"tabIndex\":\"0\",\"data-language\":\"csharp\",\"data-theme\":\"github-light\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"csharp\",\"data-theme\":\"github-light\",\"style\":{\"display\":\"grid\"},\"children\":[[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" int\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" Update\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Workout\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" entity\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\") { \"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"   int\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" count\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" -\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005CC5\"},\"children\":\"1\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; \"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"  using\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" (\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005CC5\"},\"children\":\"base\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\".DatabaseContext.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"RemoveValidation\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"()) { \"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"    using\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" (\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"var\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" scope\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" new\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" TransactionScope\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"()) { \"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"      RemoveWorkoutSessionExercisesNotUsedAnymore\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(entity); \"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"      SetupWorkoutForRepository\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(entity); \"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"      DatabaseContext.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"UpdateOwnable\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(entity); \"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"      var\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" ent\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" DatabaseContext.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"SetOwnable\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Workout\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e().Local.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"SingleOrDefault\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"d\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" =\u003e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" d.Id \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"==\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" entity.Id); \"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"      DatabaseContext.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Entry\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(ent).CurrentValues.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"SetValues\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(entity); \"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"      count \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" DatabaseContext.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"SaveChanges\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(); \"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"      scope.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Complete\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(); \"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"    } \"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"  } \"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"  return\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" count; \"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"} \"}]}]]}]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Has you can see, few things are added. First, the DatabaseContext is using a \",[\"$\",\"em\",null,{\"children\":\"USING\"}],\" with RemoveValidation method. This is a custom method that remove temporary all validations by Entity Framework. The code call ValidateOnSaveEnabled and set it to false and put it back to true once the scope of the using is over. This is ain't a requirement for you, but I let it there for the reason that you may have to do it. The justification is quite simple. When you are saving from partial data that contain only the primary key (Id) and you attach these one you may have some error that some required field aren't provided. If you tell Entity Framework not to check the validation, you won't have this trouble.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Second, you see that we call \",[\"$\",\"span\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"plaintext\",\"data-theme\":\"github-light\",\"style\":{\"backgroundColor\":\"#fff\",\"color\":\"#24292e\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"RemoveWorkoutSessionExercisesNotUsedAnymore(...)\"}]}]}]}],\" followed by \",[\"$\",\"span\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"plaintext\",\"data-theme\":\"github-light\",\"style\":{\"backgroundColor\":\"#fff\",\"color\":\"#24292e\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"SetupWorkoutForRepository(...)\"}]}]}]}],\". The Remove function do a query to the database to get the list of existing entities and compare with the one provided by the form (from the web page). All entities that were there and that is not anymore are removed.\"]}],\"\\n\",[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"backgroundColor\":\"#fff\",\"color\":\"#24292e\"},\"tabIndex\":\"0\",\"data-language\":\"csharp\",\"data-theme\":\"github-light\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"csharp\",\"data-theme\":\"github-light\",\"style\":{\"display\":\"grid\"},\"children\":[[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"private\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" void\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" RemoveWorkoutSessionExercisesNotUsedAnymore\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Workout\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" entity\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\") { \"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"  var\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" listWorkoutSessionExerciseThatStillRemain\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" entity.Sessions.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"SelectMany\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"d\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\u003e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"d.WorkoutSessionExercises).\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Select\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"d\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\u003e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"d.Id).\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"ToArray\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(); \"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"  var\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" workoutSessionExerciseFromDatabase\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" DatabaseContext.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"SetOwnable\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"WorkoutSessionExercise\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e()\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"  .\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Where\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"d\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\u003e!\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"listWorkoutSessionExerciseThatStillRemain.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Contains\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(d.Id) \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"\u0026\u0026\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" d.WorkoutSession.Workout.Id \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"==\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" entity.Id);\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"  \"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"  foreach\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" (\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"var\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" sessionExercise\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" in\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" workoutSessionExerciseFromDatabase) { \"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"    DatabaseContext.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"SetOwnable\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"WorkoutSessionExercise\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e().\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Remove\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(sessionExercise); \"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"  } \"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"  DatabaseContext.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"SaveChanges\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(); \"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"} \"}]}]]}]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"The code is good for new and modified Workout entity. In the case of a new entity, the list of workout session exercise from the database will be empty and nothing will be removed. In the case of a modified Workout that contains workout session exercise, those are removed if they are not found in the list of Id that the user uses. At the end, we call \",[\"$\",\"span\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"plaintext\",\"data-theme\":\"github-light\",\"style\":{\"backgroundColor\":\"#fff\",\"color\":\"#24292e\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"SaveChange()\"}]}]}]}],\" which commit the delete statement to the Sql Server. Of course, since we are in a transaction, nothing will be really committed yet.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Third, the SetupWorkoutForRepository is called. This method is the heart of the work for modifying an entity with multiple children objects. Once the setup is done, the database is saved and the transaction is completed. At this final moment, every delete and insert are commited to the Sql Server Database.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Let's take a look at the setup method which prepare the model classe to be saved by Entity Framework.\"}],\"\\n\",[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"backgroundColor\":\"#fff\",\"color\":\"#24292e\"},\"tabIndex\":\"0\",\"data-language\":\"csharp\",\"data-theme\":\"github-light\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"csharp\",\"data-theme\":\"github-light\",\"style\":{\"display\":\"grid\"},\"children\":[[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" private\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" void\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" SetupWorkoutForRepository\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Workout\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" entity\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\") { \"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"   if\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" (entity.Sessions \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"!=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005CC5\"},\"children\":\" null\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\") { \"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"     foreach\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" (\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"var\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" workoutSession\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" in\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" entity.Sessions) { \"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"       if\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" (workoutSession.WorkoutSessionExercises \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"!=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005CC5\"},\"children\":\" null\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\") { \"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"         foreach\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" (\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"var\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" workoutSessionExercise\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" in\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" workoutSession.WorkoutSessionExercises) { \"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"           if\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" (workoutSessionExercise.Exercise \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"!=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005CC5\"},\"children\":\" null\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\") { \"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"             if\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" (workoutSessionExercise.Exercise.Id \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"==\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" BaseModel.NOT_INITIALIZED) { \"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"               workoutSessionExercise.Exercise \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005CC5\"},\"children\":\" null\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; \"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#6A737D\"},\"children\":\"               //Should never go there \"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"               } \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"else\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" { \"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"                 if\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" (DatabaseContext.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Set\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Exercise\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e().Local.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"All\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" =\u003e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" e.Id \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"!=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" workoutSessionExercise.Exercise.Id)) { \"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"                   workoutSessionExercise.Exercise \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" DatabaseContext.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Set\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Exercise\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e().\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Attach\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(workoutSessionExercise.Exercise); \"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"                } \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"else\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" { \"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"                  workoutSessionExercise.Exercise \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" DatabaseContext.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Set\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Exercise\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e().Local.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Single\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" =\u003e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" e.Id \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"==\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" workoutSessionExercise.Exercise.Id); \"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"                }\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"              } \"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"            }\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":\" \"}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"          if\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" (workoutSessionExercise.Id \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"==\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" BaseModel.NOT_INITIALIZED) { \"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#6A737D\"},\"children\":\"            //New workout session exercise \"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"            DatabaseContext.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"SetOwnable\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"WorkoutSessionExercise\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e().\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Add\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(workoutSessionExercise); \"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"          } \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"else\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" { \"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"            if\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" (DatabaseContext.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Set\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"WorkoutSessionExercise\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e().Local.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"All\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" =\u003e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" e.Id \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"!=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" workoutSessionExercise.Id)) { \"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"              DatabaseContext.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"SetOwnable\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"WorkoutSessionExercise\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e().\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Attach\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(workoutSessionExercise); \"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"            } \"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"          } \"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"        } \"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"        if\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" (workoutSession.Id \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"==\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" BaseModel.NOT_INITIALIZED) { \"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"          DatabaseContext.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"SetOwnable\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"WorkoutSession\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e().\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Add\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(workoutSession); \"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"        } \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"else\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" { \"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"          var\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" dbEntry\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" DatabaseContext.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"SetOwnable\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"WorkoutSession\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e().Local.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"SingleOrDefault\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" =\u003e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" e.Id \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"==\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" workoutSession.Id); \"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"          if\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" (dbEntry\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"==\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005CC5\"},\"children\":\"null\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\") { \"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"            dbEntry \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" DatabaseContext.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"SetOwnable\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"WorkoutSession\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e().\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Attach\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(workoutSession); \"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"          } \"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"        }\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":\" \"}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"        foreach\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" (\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"var\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" workoutSessionExercise\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" in\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" workoutSession.WorkoutSessionExercises) { \"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"          workoutSessionExercise.WorkoutSession \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" DatabaseContext.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"SetOwnable\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"WorkoutSession\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e().Local.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"SingleOrDefault\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"d\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\u003e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"d.Id \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"==\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" workoutSession.Id); \"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"        } \"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"      } \"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"    } \"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"  } \"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"} \"}]}]]}]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"I'll go through the whole method because almost all possibles care are treated. First, a Workout contains a list of session. Most of the time, this collection won't be null and we will start looping through them. The same mechanism is executed for the WorkoutSessionExercises collection. Since, in our case, exercise aren't deleted or modified directly into this screen, we have some case simplified. This is why we know that the exercise cannot be null. But, we know that the user can set an exercise to a session. Two scenarios occurs. The first one is that it's the first time we use this exercise. If it's the case, then we need to set Entity Framework an attached object that will represent the exercise. This is done with the line\"}],\"\\n\",[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"backgroundColor\":\"#fff\",\"color\":\"#24292e\"},\"tabIndex\":\"0\",\"data-language\":\"csharp\",\"data-theme\":\"github-light\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"csharp\",\"data-theme\":\"github-light\",\"style\":{\"display\":\"grid\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" workoutSessionExercise.Exercise \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" DatabaseContext.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Set\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Exercise\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e().\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Attach\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(workoutSessionExercise.Exercise); \"}]]}]}]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"The second one is then the exercise has already been used. So, it has already been attached or has been added. We use the Local property to get the instance of the entity from Entity Framework this give us the certitude that we are working on the same Exercise.\"}],\"\\n\",[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"backgroundColor\":\"#fff\",\"color\":\"#24292e\"},\"tabIndex\":\"0\",\"data-language\":\"csharp\",\"data-theme\":\"github-light\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"csharp\",\"data-theme\":\"github-light\",\"style\":{\"display\":\"grid\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" workoutSessionExercise.Exercise \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" DatabaseContext.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Set\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Exercise\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e().Local.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Single\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" =\u003e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" e.Id \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"==\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" workoutSessionExercise.Exercise.Id); \"}]]}]}]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"At the end, we do the same for the workout session exercise. Why do we do exercise first and then we do exercise session? Because attaching or adding the exercise session would result to attach their sub property which is not what we want because we want to control if we attach or not the entity. We want to control what is attached and added and this is why we need to attach stuff from the bottom to up.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Also, you may want to save some property and not everything. In that case you can select the property and indicate if this one has changed or not.\"}],\"\\n\",[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"backgroundColor\":\"#fff\",\"color\":\"#24292e\"},\"tabIndex\":\"0\",\"data-language\":\"csharp\",\"data-theme\":\"github-light\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"csharp\",\"data-theme\":\"github-light\",\"style\":{\"display\":\"grid\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" DatabaseContext.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Entry\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(dbEntry).\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Property\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"d\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" =\u003e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" d.Name).IsModified \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005CC5\"},\"children\":\" false\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; \"}]]}]}]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"This is an example that we could have set for the WorkoutSession if we would have like not to change the WorkoutSession name.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"To conclude, it's possible to save multiple objects that are composed withing a single Entity Framework data context. This approach is not without negative effect. You will soon realize that it requires some time to code every attachment correctly and depending of how your objects are composed and how you use Entity Framework (with or without ID for each foreign key, with or without loading the full graph) your configuration will change.\"}]]]}]]}],[\"$\",\"div\",null,{\"className\":\"layout_paginationBar__jnuuR\",\"children\":[[\"$\",\"div\",null,{\"className\":\"layout_paginationTitle__PsOw5\",\"children\":\"Chronological Blog Articles by Page\"}],[\"$\",\"div\",null,{\"className\":\"layout_paginationLinks__LdBaH\",\"children\":[[\"$\",\"$Le\",\"1\",{\"className\":\"\",\"href\":\"/blog/page/1\",\"children\":1}],[\"$\",\"$Le\",\"2\",{\"className\":\"\",\"href\":\"/blog/page/2\",\"children\":2}],[\"$\",\"$Le\",\"3\",{\"className\":\"\",\"href\":\"/blog/page/3\",\"children\":3}],[\"$\",\"$Le\",\"4\",{\"className\":\"\",\"href\":\"/blog/page/4\",\"children\":4}],[\"$\",\"$Le\",\"5\",{\"className\":\"\",\"href\":\"/blog/page/5\",\"children\":5}],[\"$\",\"$Le\",\"6\",{\"className\":\"\",\"href\":\"/blog/page/6\",\"children\":6}],[\"$\",\"$Le\",\"7\",{\"className\":\"\",\"href\":\"/blog/page/7\",\"children\":7}],[\"$\",\"$Le\",\"8\",{\"className\":\"\",\"href\":\"/blog/page/8\",\"children\":8}],[\"$\",\"$Le\",\"9\",{\"className\":\"\",\"href\":\"/blog/page/9\",\"children\":9}],[\"$\",\"$Le\",\"10\",{\"className\":\"\",\"href\":\"/blog/page/10\",\"children\":10}],[\"$\",\"$Le\",\"11\",{\"className\":\"\",\"href\":\"/blog/page/11\",\"children\":11}],[\"$\",\"$Le\",\"12\",{\"className\":\"\",\"href\":\"/blog/page/12\",\"children\":12}],[\"$\",\"$Le\",\"13\",{\"className\":\"\",\"href\":\"/blog/page/13\",\"children\":13}],[\"$\",\"$Le\",\"14\",{\"className\":\"\",\"href\":\"/blog/page/14\",\"children\":14}],[\"$\",\"$Le\",\"15\",{\"className\":\"\",\"href\":\"/blog/page/15\",\"children\":15}],[\"$\",\"$Le\",\"16\",{\"className\":\"\",\"href\":\"/blog/page/16\",\"children\":16}],[\"$\",\"$Le\",\"17\",{\"className\":\"\",\"href\":\"/blog/page/17\",\"children\":17}],[\"$\",\"$Le\",\"18\",{\"className\":\"\",\"href\":\"/blog/page/18\",\"children\":18}],[\"$\",\"$Le\",\"19\",{\"className\":\"\",\"href\":\"/blog/page/19\",\"children\":19}],[\"$\",\"$Le\",\"20\",{\"className\":\"\",\"href\":\"/blog/page/20\",\"children\":20}],[\"$\",\"$Le\",\"21\",{\"className\":\"\",\"href\":\"/blog/page/21\",\"children\":21}],[\"$\",\"$Le\",\"22\",{\"className\":\"\",\"href\":\"/blog/page/22\",\"children\":22}],[\"$\",\"$Le\",\"23\",{\"className\":\"\",\"href\":\"/blog/page/23\",\"children\":23}],[\"$\",\"$Le\",\"24\",{\"className\":\"\",\"href\":\"/blog/page/24\",\"children\":24}],[\"$\",\"$Le\",\"25\",{\"className\":\"\",\"href\":\"/blog/page/25\",\"children\":25}],[\"$\",\"$Le\",\"26\",{\"className\":\"\",\"href\":\"/blog/page/26\",\"children\":26}],[\"$\",\"$Le\",\"27\",{\"className\":\"\",\"href\":\"/blog/page/27\",\"children\":27}],[\"$\",\"$Le\",\"28\",{\"className\":\"\",\"href\":\"/blog/page/28\",\"children\":28}],[\"$\",\"$Le\",\"29\",{\"className\":\"\",\"href\":\"/blog/page/29\",\"children\":29}],[\"$\",\"$Le\",\"30\",{\"className\":\"\",\"href\":\"/blog/page/30\",\"children\":30}],[\"$\",\"$Le\",\"31\",{\"className\":\"\",\"href\":\"/blog/page/31\",\"children\":31}],[\"$\",\"$Le\",\"32\",{\"className\":\"\",\"href\":\"/blog/page/32\",\"children\":32}],[\"$\",\"$Le\",\"33\",{\"className\":\"\",\"href\":\"/blog/page/33\",\"children\":33}],[\"$\",\"$Le\",\"34\",{\"className\":\"\",\"href\":\"/blog/page/34\",\"children\":34}],[\"$\",\"$Le\",\"35\",{\"className\":\"\",\"href\":\"/blog/page/35\",\"children\":35}],[\"$\",\"$Le\",\"36\",{\"className\":\"\",\"href\":\"/blog/page/36\",\"children\":36}],[\"$\",\"$Le\",\"37\",{\"className\":\"\",\"href\":\"/blog/page/37\",\"children\":37}],[\"$\",\"$Le\",\"38\",{\"className\":\"\",\"href\":\"/blog/page/38\",\"children\":38}],[\"$\",\"$Le\",\"39\",{\"className\":\"\",\"href\":\"/blog/page/39\",\"children\":39}],[\"$\",\"$Le\",\"40\",{\"className\":\"\",\"href\":\"/blog/page/40\",\"children\":40}],[\"$\",\"$Le\",\"41\",{\"className\":\"\",\"href\":\"/blog/page/41\",\"children\":41}],[\"$\",\"$Le\",\"42\",{\"className\":\"\",\"href\":\"/blog/page/42\",\"children\":42}],[\"$\",\"$Le\",\"43\",{\"className\":\"\",\"href\":\"/blog/page/43\",\"children\":43}],[\"$\",\"$Le\",\"44\",{\"className\":\"\",\"href\":\"/blog/page/44\",\"children\":44}],[\"$\",\"$Le\",\"45\",{\"className\":\"\",\"href\":\"/blog/page/45\",\"children\":45}],[\"$\",\"$Le\",\"46\",{\"className\":\"\",\"href\":\"/blog/page/46\",\"children\":46}],[\"$\",\"$Le\",\"47\",{\"className\":\"\",\"href\":\"/blog/page/47\",\"children\":47}],[\"$\",\"$Le\",\"48\",{\"className\":\"\",\"href\":\"/blog/page/48\",\"children\":48}],[\"$\",\"$Le\",\"49\",{\"className\":\"\",\"href\":\"/blog/page/49\",\"children\":49}],[\"$\",\"$Le\",\"50\",{\"className\":\"\",\"href\":\"/blog/page/50\",\"children\":50}],[\"$\",\"$Le\",\"51\",{\"className\":\"\",\"href\":\"/blog/page/51\",\"children\":51}],[\"$\",\"$Le\",\"52\",{\"className\":\"\",\"href\":\"/blog/page/52\",\"children\":52}],[\"$\",\"$Le\",\"53\",{\"className\":\"\",\"href\":\"/blog/page/53\",\"children\":53}],[\"$\",\"$Le\",\"54\",{\"className\":\"\",\"href\":\"/blog/page/54\",\"children\":54}],[\"$\",\"$Le\",\"55\",{\"className\":\"\",\"href\":\"/blog/page/55\",\"children\":55}],[\"$\",\"$Le\",\"56\",{\"className\":\"\",\"href\":\"/blog/page/56\",\"children\":56}],[\"$\",\"$Le\",\"57\",{\"className\":\"\",\"href\":\"/blog/page/57\",\"children\":57}],[\"$\",\"$Le\",\"58\",{\"className\":\"\",\"href\":\"/blog/page/58\",\"children\":58}],[\"$\",\"$Le\",\"59\",{\"className\":\"\",\"href\":\"/blog/page/59\",\"children\":59}],[\"$\",\"$Le\",\"60\",{\"className\":\"\",\"href\":\"/blog/page/60\",\"children\":60}],[\"$\",\"$Le\",\"61\",{\"className\":\"\",\"href\":\"/blog/page/61\",\"children\":61}],[\"$\",\"$Le\",\"62\",{\"className\":\"\",\"href\":\"/blog/page/62\",\"children\":62}],[\"$\",\"$Le\",\"63\",{\"className\":\"\",\"href\":\"/blog/page/63\",\"children\":63}],[\"$\",\"$Le\",\"64\",{\"className\":\"\",\"href\":\"/blog/page/64\",\"children\":64}],[\"$\",\"$Le\",\"65\",{\"className\":\"\",\"href\":\"/blog/page/65\",\"children\":65}],[\"$\",\"$Le\",\"66\",{\"className\":\"\",\"href\":\"/blog/page/66\",\"children\":66}],[\"$\",\"$Le\",\"67\",{\"className\":\"\",\"href\":\"/blog/page/67\",\"children\":67}],[\"$\",\"$Le\",\"68\",{\"className\":\"\",\"href\":\"/blog/page/68\",\"children\":68}],[\"$\",\"$Le\",\"69\",{\"className\":\"\",\"href\":\"/blog/page/69\",\"children\":69}],[\"$\",\"$Le\",\"70\",{\"className\":\"\",\"href\":\"/blog/page/70\",\"children\":70}],[\"$\",\"$Le\",\"71\",{\"className\":\"\",\"href\":\"/blog/page/71\",\"children\":71}],[\"$\",\"$Le\",\"72\",{\"className\":\"\",\"href\":\"/blog/page/72\",\"children\":72}],[\"$\",\"$Le\",\"73\",{\"className\":\"\",\"href\":\"/blog/page/73\",\"children\":73}],[\"$\",\"$Le\",\"74\",{\"className\":\"\",\"href\":\"/blog/page/74\",\"children\":74}],[\"$\",\"$Le\",\"75\",{\"className\":\"\",\"href\":\"/blog/page/75\",\"children\":75}],[\"$\",\"$Le\",\"76\",{\"className\":\"\",\"href\":\"/blog/page/76\",\"children\":76}],[\"$\",\"$Le\",\"77\",{\"className\":\"\",\"href\":\"/blog/page/77\",\"children\":77}]]}]]}]]}]}]\n"])</script><script>self.__next_f.push([1,""])</script></body></html>