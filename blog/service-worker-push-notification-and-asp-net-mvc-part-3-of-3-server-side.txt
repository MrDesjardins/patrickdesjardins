3:I[9275,[],""]
5:I[1343,[],""]
6:I[231,["231","static/chunks/231-d291986acc57095e.js","173","static/chunks/173-1ff9408fc5d1e856.js","308","static/chunks/app/blog/%5Bslug%5D/page-b7aa7f195c3b21e3.js"],""]
4:["slug","service-worker-push-notification-and-asp-net-mvc-part-3-of-3-server-side","d"]
0:["z0zqOGpC_eEdVRF3Xc9i8",[[["",{"children":["blog",{"children":[["slug","service-worker-push-notification-and-asp-net-mvc-part-3-of-3-server-side","d"],{"children":["__PAGE__?{\"slug\":\"service-worker-push-notification-and-asp-net-mvc-part-3-of-3-server-side\"}",{}]}]}]},"$undefined","$undefined",true],["",{"children":["blog",{"children":[["slug","service-worker-push-notification-and-asp-net-mvc-part-3-of-3-server-side","d"],{"children":["__PAGE__",{},[["$L1","$L2"],null],null]},["$","$L3",null,{"parallelRouterKey":"children","segmentPath":["children","blog","children","$4","children"],"error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L5",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":"$undefined","notFoundStyles":"$undefined","styles":[["$","link","0",{"rel":"stylesheet","href":"/_next/static/css/585ef9e6d39b193c.css","precedence":"next","crossOrigin":"$undefined"}]]}],null]},[["$","div",null,{"className":"layout_bodystyle__9TFhb","children":["$","$L3",null,{"parallelRouterKey":"children","segmentPath":["children","blog","children"],"error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L5",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":"$undefined","notFoundStyles":"$undefined","styles":null}]}],null],null]},[["$","html",null,{"lang":"en","children":["$","body",null,{"className":"layout_bodystyle__4ncsS","children":["$","$L3",null,{"parallelRouterKey":"children","segmentPath":["children"],"error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L5",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":["$","div",null,{"style":{"display":"flex","alignItems":"center","justifyContent":"center","height":"100vh"},"children":["$","div",null,{"style":{"width":"50%","height":"20%","backgroundColor":"#ffeded","borderRadius":12,"padding":12,"textAlign":"center"},"children":[["$","h1",null,{"children":"Not Found"}],["$","p",null,{"children":"Could not find requested resource"}],["$","$L6",null,{"href":"/","children":"Return Home"}]]}]}],"notFoundStyles":[],"styles":[["$","link","0",{"rel":"stylesheet","href":"/_next/static/css/378d2a9747ade719.css","precedence":"next","crossOrigin":"$undefined"}]]}]}]}],null],null],[[["$","link","0",{"rel":"stylesheet","href":"/_next/static/css/53d73aaa6ce0fadc.css","precedence":"next","crossOrigin":"$undefined"}]],"$L7"]]]]
8:I[8173,["231","static/chunks/231-d291986acc57095e.js","173","static/chunks/173-1ff9408fc5d1e856.js","308","static/chunks/app/blog/%5Bslug%5D/page-b7aa7f195c3b21e3.js"],"Image"]
2:["$","div",null,{"className":"BlogBody_BlogBody__600mT","children":[["$","header",null,{"className":"BlogBody_siteTitle__f7uyb","children":"Patrick Desjardins Blog"}],["$","nav",null,{"children":["$","ul",null,{"className":"BlogBody_navLinks__ZV12t","children":["$","li",null,{"className":"BlogBody_navLinkItem__Pml2e","children":[["$","$L6",null,{"className":"BlogBody_navLinkText__ZtH2y","href":"/","children":"Main Page"}],["$","$L6",null,{"className":"BlogBody_navLinkText__ZtH2y","href":"/blog","children":"Blog"}],[["$","$L6","2024",{"className":"BlogBody_navLinkText__ZtH2y","href":"/blog/for/2024","children":2024}],["$","$L6","2023",{"className":"BlogBody_navLinkText__ZtH2y","href":"/blog/for/2023","children":2023}],["$","$L6","2022",{"className":"BlogBody_navLinkText__ZtH2y","href":"/blog/for/2022","children":2022}],["$","$L6","2021",{"className":"BlogBody_navLinkText__ZtH2y","href":"/blog/for/2021","children":2021}],["$","$L6","2020",{"className":"BlogBody_navLinkText__ZtH2y","href":"/blog/for/2020","children":2020}],["$","$L6","2019",{"className":"BlogBody_navLinkText__ZtH2y","href":"/blog/for/2019","children":2019}],["$","$L6","2018",{"className":"BlogBody_navLinkText__ZtH2y","href":"/blog/for/2018","children":2018}],["$","$L6","2017",{"className":"BlogBody_navLinkText__ZtH2y","href":"/blog/for/2017","children":2017}],["$","$L6","2016",{"className":"BlogBody_navLinkText__ZtH2y","href":"/blog/for/2016","children":2016}],["$","$L6","2015",{"className":"BlogBody_navLinkText__ZtH2y","href":"/blog/for/2015","children":2015}],["$","$L6","2014",{"className":"BlogBody_navLinkText__ZtH2y","href":"/blog/for/2014","children":2014}],["$","$L6","2013",{"className":"BlogBody_navLinkText__ZtH2y","href":"/blog/for/2013","children":2013}],["$","$L6","2012",{"className":"BlogBody_navLinkText__ZtH2y","href":"/blog/for/2012","children":2012}],["$","$L6","2011",{"className":"BlogBody_navLinkText__ZtH2y","href":"/blog/for/2011","children":2011}]]]}]}]}],["$","div",null,{"className":"BlogBody_blogPictureContainer__IAbPL","children":["$","$L8",null,{"className":"BlogBody_blogTopPicture__L6lao","alt":"Patrick Desjardins picture from a conference","src":"/images/backgrounds/patrickdesjardins_conference_bw.jpeg","width":800,"height":260}]}],["$","main",null,{"className":"BlogBody_main__XrdKY","children":[["$","h1",null,{"className":"BlogBody_heading__bYRBe","children":"Service Worker, Push Notification and Asp.Net MVC â€“ Part 3 of 3 Server Side"}],["$","div",null,{"className":"Page_blogPostContainer__AUIcf","children":[["$","p",null,{"className":"Page_blogPostDate__wVWWB","children":["Posted on: ","2017-01-23"]}],[["$","p",null,{"children":["I previously discussed about how to configure a ",["$","a",null,{"href":"./service-worker-push-notification-and-asp-net-mvc-part-1-of-3-client-side","children":"web push notification from the client side perspective"}]," as well as how to send the ",["$","a",null,{"href":"./service-worker-push-notification-and-asp-net-mvc-part-2-of-3-server-side","children":"notification from an ASP.Net code"}]," which could be sent from Azure Webjobs. The remaining part is how do you send to multiple devices of one user. If you have a single browser used by a user, the initial solution is good. However, the reality is that users use multiple devices. Users can use not only different browsers on different machines but also jump from computer to phone and so on. The idea is to register subscription by device and not by user."]}],"\n",["$","p",null,{"children":["Google Firebase documentation explains briefly the \"",["$","a",null,{"href":"https://firebase.google.com/docs/cloud-messaging/js/send-multiple","children":"Device group messaging"}],"\" but the page talks more about Topic. I couldn't figure out how to use the device group messaging but could use Topic for the same matter. The idea is to use a single topic per user and send a message to this topic."]}],"\n",["$","p",null,{"children":"The first big change is to add a subscribe method and unsubscribe that work with the topic api."}],"\n",["$","pre",null,{"className":"language-csharp","children":["$","code",null,{"className":"language-csharp code-highlight","children":[["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token keyword","children":"public"}]," ",["$","span",null,{"className":"token return-type class-name","children":["$","span",null,{"className":"token keyword","children":"bool"}]}]," ",["$","span",null,{"className":"token function","children":"UnRegisterTopic"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token class-name","children":["$","span",null,{"className":"token keyword","children":"string"}]}]," userIdentifierForAllDevices",["$","span",null,{"className":"token punctuation","children":","}]," ",["$","span",null,{"className":"token class-name","children":["$","span",null,{"className":"token keyword","children":"string"}]}]," singleDeviceNoticationKey",["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}],["$","span",null,{"className":"code-line","children":["  ",["$","span",null,{"className":"token class-name","children":["$","span",null,{"className":"token keyword","children":"var"}]}]," serverApiKey ",["$","span",null,{"className":"token operator","children":"="}]," ConfigurationManager",["$","span",null,{"className":"token punctuation","children":"."}],"AppSettings",["$","span",null,{"className":"token punctuation","children":"["}],["$","span",null,{"className":"token string","children":"\"FirebaseServerKey\""}],["$","span",null,{"className":"token punctuation","children":"]"}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line","children":["  ",["$","span",null,{"className":"token class-name","children":["$","span",null,{"className":"token keyword","children":"var"}]}]," firebaseGoogleUrl ",["$","span",null,{"className":"token operator","children":"="}]," ",["$","span",null,{"className":"token interpolation-string","children":[["$","span",null,{"className":"token string","children":"$$\"https://iid.googleapis.com/iid/v1/"}],["$","span",null,{"className":"token interpolation","children":[["$","span",null,{"className":"token punctuation","children":"{"}],["$","span",null,{"className":"token expression language-csharp","children":"singleDeviceNoticationKey"}],["$","span",null,{"className":"token punctuation","children":"}"}]]}],["$","span",null,{"className":"token string","children":"/rel/topics/"}],["$","span",null,{"className":"token interpolation","children":[["$","span",null,{"className":"token punctuation","children":"{"}],["$","span",null,{"className":"token expression language-csharp","children":"userIdentifierForAllDevices"}],["$","span",null,{"className":"token punctuation","children":"}"}]]}],["$","span",null,{"className":"token string","children":"\""}]]}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line","children":"\n"}],["$","span",null,{"className":"code-line","children":["  ",["$","span",null,{"className":"token class-name","children":["$","span",null,{"className":"token keyword","children":"var"}]}]," httpClient ",["$","span",null,{"className":"token operator","children":"="}]," ",["$","span",null,{"className":"token keyword","children":"new"}]," ",["$","span",null,{"className":"token constructor-invocation class-name","children":"WebClient"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line","children":["  httpClient",["$","span",null,{"className":"token punctuation","children":"."}],"Headers",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"Add"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token string","children":"\"Content-Type\""}],["$","span",null,{"className":"token punctuation","children":","}]," ",["$","span",null,{"className":"token string","children":"\"application/json\""}],["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line","children":["  httpClient",["$","span",null,{"className":"token punctuation","children":"."}],"Headers",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"Add"}],["$","span",null,{"className":"token punctuation","children":"("}],"HttpRequestHeader",["$","span",null,{"className":"token punctuation","children":"."}],"Authorization",["$","span",null,{"className":"token punctuation","children":","}]," ",["$","span",null,{"className":"token string","children":"\"key=\""}]," ",["$","span",null,{"className":"token operator","children":"+"}]," serverApiKey",["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line","children":"\n"}],["$","span",null,{"className":"code-line","children":["  ",["$","span",null,{"className":"token class-name","children":["$","span",null,{"className":"token keyword","children":"object"}]}]," data ",["$","span",null,{"className":"token operator","children":"="}]," ",["$","span",null,{"className":"token keyword","children":"new"}]," ",["$","span",null,{"className":"token punctuation","children":"{"}]," ",["$","span",null,{"className":"token punctuation","children":"}"}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line","children":["  ",["$","span",null,{"className":"token class-name","children":["$","span",null,{"className":"token keyword","children":"var"}]}]," json ",["$","span",null,{"className":"token operator","children":"="}]," JsonConvert",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"SerializeObject"}],["$","span",null,{"className":"token punctuation","children":"("}],"data",["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line","children":["  ",["$","span",null,{"className":"token class-name","children":["Byte",["$","span",null,{"className":"token punctuation","children":"["}],["$","span",null,{"className":"token punctuation","children":"]"}]]}]," byteArray ",["$","span",null,{"className":"token operator","children":"="}]," Encoding",["$","span",null,{"className":"token punctuation","children":"."}],"UTF8",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"GetBytes"}],["$","span",null,{"className":"token punctuation","children":"("}],"json",["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line","children":["  ",["$","span",null,{"className":"token class-name","children":["$","span",null,{"className":"token keyword","children":"var"}]}]," responsebytes ",["$","span",null,{"className":"token operator","children":"="}]," httpClient",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"UploadData"}],["$","span",null,{"className":"token punctuation","children":"("}],"firebaseGoogleUrl",["$","span",null,{"className":"token punctuation","children":","}]," ",["$","span",null,{"className":"token string","children":"\"DELETE\""}],["$","span",null,{"className":"token punctuation","children":","}]," byteArray",["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line","children":["  ",["$","span",null,{"className":"token class-name","children":["$","span",null,{"className":"token keyword","children":"string"}]}]," responsebody ",["$","span",null,{"className":"token operator","children":"="}]," Encoding",["$","span",null,{"className":"token punctuation","children":"."}],"UTF8",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"GetString"}],["$","span",null,{"className":"token punctuation","children":"("}],"responsebytes",["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line","children":["  ",["$","span",null,{"className":"token class-name","children":["$","span",null,{"className":"token keyword","children":"dynamic"}]}]," responseObject ",["$","span",null,{"className":"token operator","children":"="}]," JsonConvert",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"DeserializeObject"}],["$","span",null,{"className":"token punctuation","children":"("}],"responsebody",["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line","children":"\n"}],["$","span",null,{"className":"code-line","children":["  ",["$","span",null,{"className":"token keyword","children":"return"}]," responseObject",["$","span",null,{"className":"token punctuation","children":"."}],"success ",["$","span",null,{"className":"token operator","children":"=="}]," ",["$","span",null,{"className":"token string","children":"\"1\""}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token punctuation","children":"}"}],"\n"]}],["$","span",null,{"className":"code-line","children":"\n"}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token keyword","children":"public"}]," ",["$","span",null,{"className":"token return-type class-name","children":["$","span",null,{"className":"token keyword","children":"bool"}]}]," ",["$","span",null,{"className":"token function","children":"RegisterTopic"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token class-name","children":["$","span",null,{"className":"token keyword","children":"string"}]}]," userIdentifierForAllDevices",["$","span",null,{"className":"token punctuation","children":","}]," ",["$","span",null,{"className":"token class-name","children":["$","span",null,{"className":"token keyword","children":"string"}]}]," singleDeviceNoticationKey",["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}],["$","span",null,{"className":"code-line","children":["  ",["$","span",null,{"className":"token class-name","children":["$","span",null,{"className":"token keyword","children":"var"}]}]," serverApiKey ",["$","span",null,{"className":"token operator","children":"="}]," ConfigurationManager",["$","span",null,{"className":"token punctuation","children":"."}],"AppSettings",["$","span",null,{"className":"token punctuation","children":"["}],["$","span",null,{"className":"token string","children":"\"FirebaseServerKey\""}],["$","span",null,{"className":"token punctuation","children":"]"}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line","children":["  ",["$","span",null,{"className":"token class-name","children":["$","span",null,{"className":"token keyword","children":"var"}]}]," firebaseGoogleUrl ",["$","span",null,{"className":"token operator","children":"="}]," ",["$","span",null,{"className":"token interpolation-string","children":[["$","span",null,{"className":"token string","children":"$$\"https://iid.googleapis.com/iid/v1/"}],["$","span",null,{"className":"token interpolation","children":[["$","span",null,{"className":"token punctuation","children":"{"}],["$","span",null,{"className":"token expression language-csharp","children":"singleDeviceNoticationKey"}],["$","span",null,{"className":"token punctuation","children":"}"}]]}],["$","span",null,{"className":"token string","children":"/rel/topics/"}],["$","span",null,{"className":"token interpolation","children":[["$","span",null,{"className":"token punctuation","children":"{"}],["$","span",null,{"className":"token expression language-csharp","children":"userIdentifierForAllDevices"}],["$","span",null,{"className":"token punctuation","children":"}"}]]}],["$","span",null,{"className":"token string","children":"\""}]]}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line","children":"\n"}],["$","span",null,{"className":"code-line","children":["  ",["$","span",null,{"className":"token class-name","children":["$","span",null,{"className":"token keyword","children":"var"}]}]," httpClient ",["$","span",null,{"className":"token operator","children":"="}]," ",["$","span",null,{"className":"token keyword","children":"new"}]," ",["$","span",null,{"className":"token constructor-invocation class-name","children":"WebClient"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line","children":["  httpClient",["$","span",null,{"className":"token punctuation","children":"."}],"Headers",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"Add"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token string","children":"\"Content-Type\""}],["$","span",null,{"className":"token punctuation","children":","}]," ",["$","span",null,{"className":"token string","children":"\"application/json\""}],["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line","children":["  httpClient",["$","span",null,{"className":"token punctuation","children":"."}],"Headers",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"Add"}],["$","span",null,{"className":"token punctuation","children":"("}],"HttpRequestHeader",["$","span",null,{"className":"token punctuation","children":"."}],"Authorization",["$","span",null,{"className":"token punctuation","children":","}]," ",["$","span",null,{"className":"token string","children":"\"key=\""}]," ",["$","span",null,{"className":"token operator","children":"+"}]," serverApiKey",["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line","children":"\n"}],["$","span",null,{"className":"code-line","children":["  ",["$","span",null,{"className":"token class-name","children":["$","span",null,{"className":"token keyword","children":"object"}]}]," data ",["$","span",null,{"className":"token operator","children":"="}]," ",["$","span",null,{"className":"token keyword","children":"new"}],["$","span",null,{"className":"token punctuation","children":"{"}],["$","span",null,{"className":"token punctuation","children":"}"}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line","children":["  ",["$","span",null,{"className":"token class-name","children":["$","span",null,{"className":"token keyword","children":"var"}]}]," json ",["$","span",null,{"className":"token operator","children":"="}]," JsonConvert",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"SerializeObject"}],["$","span",null,{"className":"token punctuation","children":"("}],"data",["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line","children":["  ",["$","span",null,{"className":"token class-name","children":["Byte",["$","span",null,{"className":"token punctuation","children":"["}],["$","span",null,{"className":"token punctuation","children":"]"}]]}]," byteArray ",["$","span",null,{"className":"token operator","children":"="}]," Encoding",["$","span",null,{"className":"token punctuation","children":"."}],"UTF8",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"GetBytes"}],["$","span",null,{"className":"token punctuation","children":"("}],"json",["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line","children":["  ",["$","span",null,{"className":"token class-name","children":["$","span",null,{"className":"token keyword","children":"var"}]}]," responsebytes ",["$","span",null,{"className":"token operator","children":"="}]," httpClient",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"UploadData"}],["$","span",null,{"className":"token punctuation","children":"("}],"firebaseGoogleUrl",["$","span",null,{"className":"token punctuation","children":","}]," ",["$","span",null,{"className":"token string","children":"\"POST\""}],["$","span",null,{"className":"token punctuation","children":","}]," byteArray",["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line","children":["  ",["$","span",null,{"className":"token class-name","children":["$","span",null,{"className":"token keyword","children":"string"}]}]," responsebody ",["$","span",null,{"className":"token operator","children":"="}]," Encoding",["$","span",null,{"className":"token punctuation","children":"."}],"UTF8",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"GetString"}],["$","span",null,{"className":"token punctuation","children":"("}],"responsebytes",["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line","children":["  ",["$","span",null,{"className":"token class-name","children":["$","span",null,{"className":"token keyword","children":"dynamic"}]}]," responseObject ",["$","span",null,{"className":"token operator","children":"="}]," JsonConvert",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"DeserializeObject"}],["$","span",null,{"className":"token punctuation","children":"("}],"responsebody",["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line","children":"\n"}],["$","span",null,{"className":"code-line","children":["  ",["$","span",null,{"className":"token keyword","children":"return"}]," responseObject",["$","span",null,{"className":"token punctuation","children":"."}],"success ",["$","span",null,{"className":"token operator","children":"=="}]," ",["$","span",null,{"className":"token string","children":"\"1\""}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line","children":[" ",["$","span",null,{"className":"token punctuation","children":"}"}],"\n"]}]]}]}],"\n",["$","p",null,{"children":["There is quite repetition in that code and you can improve it easily. The biggest change is the URL. Not only the URL domain is different (before ",["$","a",null,{"href":"https://fcm.googleapis.com/fcm/send","children":"https://fcm.googleapis.com/fcm/send"}]," and now ",["$","a",null,{"href":"https://iid.googleapis.com/","children":"https://iid.googleapis.com/"}],"), it has different route portions. The first part is the device notification key which is the token generated by the client side from the method \"getToken\". The second portion of the route is the user identifier which I use as topic. If you really need topic across users, you can just use a string with the category needed. In my case, it is just the unique GUID of the user. This POST HTTP call will register the device for the user by a topic which is the user ID."]}],"\n",["$","p",null,{"children":"To send a message to the user, on all devices, the code needs also to change."}],"\n",["$","pre",null,{"className":"language-csharp","children":["$","code",null,{"className":"language-csharp code-highlight","children":[["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token keyword","children":"public"}]," ",["$","span",null,{"className":"token return-type class-name","children":["$","span",null,{"className":"token keyword","children":"bool"}]}]," ",["$","span",null,{"className":"token function","children":"QueueMessage"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token class-name","children":["$","span",null,{"className":"token keyword","children":"string"}]}]," to",["$","span",null,{"className":"token punctuation","children":","}]," ",["$","span",null,{"className":"token class-name","children":["$","span",null,{"className":"token keyword","children":"string"}]}]," title",["$","span",null,{"className":"token punctuation","children":","}]," ",["$","span",null,{"className":"token class-name","children":["$","span",null,{"className":"token keyword","children":"string"}]}]," message",["$","span",null,{"className":"token punctuation","children":","}]," ",["$","span",null,{"className":"token class-name","children":["$","span",null,{"className":"token keyword","children":"string"}]}]," urlNotificationClick",["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}],["$","span",null,{"className":"code-line","children":["  ",["$","span",null,{"className":"token keyword","children":"if"}]," ",["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token keyword","children":"string"}],["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"IsNullOrEmpty"}],["$","span",null,{"className":"token punctuation","children":"("}],"to",["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}],["$","span",null,{"className":"code-line","children":["     ",["$","span",null,{"className":"token keyword","children":"return"}]," ",["$","span",null,{"className":"token boolean","children":"false"}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line","children":["  ",["$","span",null,{"className":"token punctuation","children":"}"}],"\n"]}],["$","span",null,{"className":"code-line","children":["  ",["$","span",null,{"className":"token class-name","children":["$","span",null,{"className":"token keyword","children":"var"}]}]," serverApiKey ",["$","span",null,{"className":"token operator","children":"="}]," ConfigurationManager",["$","span",null,{"className":"token punctuation","children":"."}],"AppSettings",["$","span",null,{"className":"token punctuation","children":"["}],["$","span",null,{"className":"token string","children":"\"FirebaseServerKey\""}],["$","span",null,{"className":"token punctuation","children":"]"}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line","children":["  ",["$","span",null,{"className":"token class-name","children":["$","span",null,{"className":"token keyword","children":"var"}]}]," firebaseGoogleUrl ",["$","span",null,{"className":"token operator","children":"="}]," ",["$","span",null,{"className":"token string","children":"\"https://fcm.googleapis.com/fcm/send\""}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line","children":"\n"}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token class-name","children":["$","span",null,{"className":"token keyword","children":"var"}]}]," httpClient ",["$","span",null,{"className":"token operator","children":"="}]," ",["$","span",null,{"className":"token keyword","children":"new"}]," ",["$","span",null,{"className":"token constructor-invocation class-name","children":"WebClient"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line","children":["httpClient",["$","span",null,{"className":"token punctuation","children":"."}],"Headers",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"Add"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token string","children":"\"Content-Type\""}],["$","span",null,{"className":"token punctuation","children":","}]," ",["$","span",null,{"className":"token string","children":"\"application/json\""}],["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line","children":["httpClient",["$","span",null,{"className":"token punctuation","children":"."}],"Headers",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"Add"}],["$","span",null,{"className":"token punctuation","children":"("}],"HttpRequestHeader",["$","span",null,{"className":"token punctuation","children":"."}],"Authorization",["$","span",null,{"className":"token punctuation","children":","}]," ",["$","span",null,{"className":"token string","children":"\"key=\""}]," ",["$","span",null,{"className":"token operator","children":"+"}]," serverApiKey",["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token class-name","children":["$","span",null,{"className":"token keyword","children":"var"}]}]," timeToLiveInSecond ",["$","span",null,{"className":"token operator","children":"="}]," ",["$","span",null,{"className":"token number","children":"24"}]," ",["$","span",null,{"className":"token operator","children":"*"}]," ",["$","span",null,{"className":"token number","children":"60"}],["$","span",null,{"className":"token punctuation","children":";"}]," ",["$","span",null,{"className":"token comment","children":"// 1 day"}],"\n"]}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token class-name","children":["$","span",null,{"className":"token keyword","children":"var"}]}]," data ",["$","span",null,{"className":"token operator","children":"="}]," ",["$","span",null,{"className":"token keyword","children":"new"}]," ",["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}],["$","span",null,{"className":"code-line","children":["  to ",["$","span",null,{"className":"token operator","children":"="}]," ",["$","span",null,{"className":"token string","children":"\"/topics/\""}]," ",["$","span",null,{"className":"token operator","children":"+"}]," to ",["$","span",null,{"className":"token punctuation","children":","}],"\n"]}],["$","span",null,{"className":"code-line","children":["  data ",["$","span",null,{"className":"token operator","children":"="}]," ",["$","span",null,{"className":"token keyword","children":"new"}]," ",["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}],["$","span",null,{"className":"code-line","children":["    notification ",["$","span",null,{"className":"token operator","children":"="}]," ",["$","span",null,{"className":"token keyword","children":"new"}]," ",["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}],["$","span",null,{"className":"code-line","children":["      body ",["$","span",null,{"className":"token operator","children":"="}]," message",["$","span",null,{"className":"token punctuation","children":","}],"\n"]}],["$","span",null,{"className":"code-line","children":["      title ",["$","span",null,{"className":"token operator","children":"="}]," title",["$","span",null,{"className":"token punctuation","children":","}],"\n"]}],["$","span",null,{"className":"code-line","children":["      icon ",["$","span",null,{"className":"token operator","children":"="}]," ",["$","span",null,{"className":"token string","children":"\"/Content/Images/Logos/BourseVirtuelle.png\""}],["$","span",null,{"className":"token punctuation","children":","}],"\n"]}],["$","span",null,{"className":"code-line","children":["      url ",["$","span",null,{"className":"token operator","children":"="}]," urlNotificationClick",["$","span",null,{"className":"token punctuation","children":","}],"\n"]}],["$","span",null,{"className":"code-line","children":["      sound ",["$","span",null,{"className":"token operator","children":"="}]," ",["$","span",null,{"className":"token string","children":"\"default\""}],"\n"]}],["$","span",null,{"className":"code-line","children":["    ",["$","span",null,{"className":"token punctuation","children":"}"}],"\n"]}],["$","span",null,{"className":"code-line","children":["  ",["$","span",null,{"className":"token punctuation","children":"}"}],["$","span",null,{"className":"token punctuation","children":","}],"\n"]}],["$","span",null,{"className":"code-line","children":["  time_to_live ",["$","span",null,{"className":"token operator","children":"="}]," timeToLiveInSecond ",["$","span",null,{"className":"token punctuation","children":"}"}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line","children":"\n"}],["$","span",null,{"className":"code-line","children":["  ",["$","span",null,{"className":"token class-name","children":["$","span",null,{"className":"token keyword","children":"var"}]}]," json ",["$","span",null,{"className":"token operator","children":"="}]," JsonConvert",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"SerializeObject"}],["$","span",null,{"className":"token punctuation","children":"("}],"data",["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line","children":["  ",["$","span",null,{"className":"token class-name","children":["Byte",["$","span",null,{"className":"token punctuation","children":"["}],["$","span",null,{"className":"token punctuation","children":"]"}]]}]," byteArray ",["$","span",null,{"className":"token operator","children":"="}]," Encoding",["$","span",null,{"className":"token punctuation","children":"."}],"UTF8",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"GetBytes"}],["$","span",null,{"className":"token punctuation","children":"("}],"json",["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line","children":["  ",["$","span",null,{"className":"token class-name","children":["$","span",null,{"className":"token keyword","children":"var"}]}]," responsebytes ",["$","span",null,{"className":"token operator","children":"="}]," httpClient",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"UploadData"}],["$","span",null,{"className":"token punctuation","children":"("}],"firebaseGoogleUrl",["$","span",null,{"className":"token punctuation","children":","}]," ",["$","span",null,{"className":"token string","children":"\"POST\""}],["$","span",null,{"className":"token punctuation","children":","}]," byteArray",["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line","children":["  ",["$","span",null,{"className":"token class-name","children":["$","span",null,{"className":"token keyword","children":"string"}]}]," responsebody ",["$","span",null,{"className":"token operator","children":"="}]," Encoding",["$","span",null,{"className":"token punctuation","children":"."}],"UTF8",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"GetString"}],["$","span",null,{"className":"token punctuation","children":"("}],"responsebytes",["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line","children":["  ",["$","span",null,{"className":"token class-name","children":["$","span",null,{"className":"token keyword","children":"dynamic"}]}]," responseObject ",["$","span",null,{"className":"token operator","children":"="}]," JsonConvert",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"DeserializeObject"}],["$","span",null,{"className":"token punctuation","children":"("}],"responsebody",["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line","children":"\n"}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token keyword","children":"return"}]," responseObject",["$","span",null,{"className":"token punctuation","children":"."}],"success ",["$","span",null,{"className":"token operator","children":"=="}]," ",["$","span",null,{"className":"token string","children":"\"1\""}],["$","span",null,{"className":"token punctuation","children":";"}]," ",["$","span",null,{"className":"token punctuation","children":"}"}],"\n"]}]]}]}],"\n",["$","p",null,{"children":"What has changed from sending to a single user? The field \"to\" which is sending to topics. The \"to\" in the method signature is still the user unique identifier, but instead of sending directly to it, we use it has a topic. We do not use the token generated by the front end since a new one got generated per device, we only use the user id which is the topic."}]]]}]]}],["$","div",null,{"className":"BlogBody_paginationBar__1gsMc","children":[["$","div",null,{"className":"BlogBody_paginationTitle__H_eFX","children":"Chronological Blog Articles by Page"}],["$","div",null,{"className":"BlogBody_paginationLinks__nk8zd","children":[["$","$L6","1",{"className":"","href":"/blog/page/1","children":1}],["$","$L6","2",{"className":"","href":"/blog/page/2","children":2}],["$","$L6","3",{"className":"","href":"/blog/page/3","children":3}],["$","$L6","4",{"className":"","href":"/blog/page/4","children":4}],["$","$L6","5",{"className":"","href":"/blog/page/5","children":5}],["$","$L6","6",{"className":"","href":"/blog/page/6","children":6}],["$","$L6","7",{"className":"","href":"/blog/page/7","children":7}],["$","$L6","8",{"className":"","href":"/blog/page/8","children":8}],["$","$L6","9",{"className":"","href":"/blog/page/9","children":9}],["$","$L6","10",{"className":"","href":"/blog/page/10","children":10}],["$","$L6","11",{"className":"","href":"/blog/page/11","children":11}],["$","$L6","12",{"className":"","href":"/blog/page/12","children":12}],["$","$L6","13",{"className":"","href":"/blog/page/13","children":13}],["$","$L6","14",{"className":"","href":"/blog/page/14","children":14}],["$","$L6","15",{"className":"","href":"/blog/page/15","children":15}],["$","$L6","16",{"className":"","href":"/blog/page/16","children":16}],["$","$L6","17",{"className":"","href":"/blog/page/17","children":17}],["$","$L6","18",{"className":"","href":"/blog/page/18","children":18}],["$","$L6","19",{"className":"","href":"/blog/page/19","children":19}],["$","$L6","20",{"className":"","href":"/blog/page/20","children":20}],["$","$L6","21",{"className":"","href":"/blog/page/21","children":21}],["$","$L6","22",{"className":"","href":"/blog/page/22","children":22}],["$","$L6","23",{"className":"","href":"/blog/page/23","children":23}],["$","$L6","24",{"className":"","href":"/blog/page/24","children":24}],["$","$L6","25",{"className":"","href":"/blog/page/25","children":25}],["$","$L6","26",{"className":"","href":"/blog/page/26","children":26}],["$","$L6","27",{"className":"","href":"/blog/page/27","children":27}],["$","$L6","28",{"className":"","href":"/blog/page/28","children":28}],["$","$L6","29",{"className":"","href":"/blog/page/29","children":29}],["$","$L6","30",{"className":"","href":"/blog/page/30","children":30}],["$","$L6","31",{"className":"","href":"/blog/page/31","children":31}],["$","$L6","32",{"className":"","href":"/blog/page/32","children":32}],["$","$L6","33",{"className":"","href":"/blog/page/33","children":33}],["$","$L6","34",{"className":"","href":"/blog/page/34","children":34}],["$","$L6","35",{"className":"","href":"/blog/page/35","children":35}],["$","$L6","36",{"className":"","href":"/blog/page/36","children":36}],["$","$L6","37",{"className":"","href":"/blog/page/37","children":37}],["$","$L6","38",{"className":"","href":"/blog/page/38","children":38}],["$","$L6","39",{"className":"","href":"/blog/page/39","children":39}],["$","$L6","40",{"className":"","href":"/blog/page/40","children":40}],["$","$L6","41",{"className":"","href":"/blog/page/41","children":41}],["$","$L6","42",{"className":"","href":"/blog/page/42","children":42}],["$","$L6","43",{"className":"","href":"/blog/page/43","children":43}],["$","$L6","44",{"className":"","href":"/blog/page/44","children":44}],["$","$L6","45",{"className":"","href":"/blog/page/45","children":45}],["$","$L6","46",{"className":"","href":"/blog/page/46","children":46}],["$","$L6","47",{"className":"","href":"/blog/page/47","children":47}],["$","$L6","48",{"className":"","href":"/blog/page/48","children":48}],["$","$L6","49",{"className":"","href":"/blog/page/49","children":49}],["$","$L6","50",{"className":"","href":"/blog/page/50","children":50}],["$","$L6","51",{"className":"","href":"/blog/page/51","children":51}],["$","$L6","52",{"className":"","href":"/blog/page/52","children":52}],["$","$L6","53",{"className":"","href":"/blog/page/53","children":53}],["$","$L6","54",{"className":"","href":"/blog/page/54","children":54}],["$","$L6","55",{"className":"","href":"/blog/page/55","children":55}],["$","$L6","56",{"className":"","href":"/blog/page/56","children":56}],["$","$L6","57",{"className":"","href":"/blog/page/57","children":57}],["$","$L6","58",{"className":"","href":"/blog/page/58","children":58}],["$","$L6","59",{"className":"","href":"/blog/page/59","children":59}],["$","$L6","60",{"className":"","href":"/blog/page/60","children":60}],["$","$L6","61",{"className":"","href":"/blog/page/61","children":61}],["$","$L6","62",{"className":"","href":"/blog/page/62","children":62}],["$","$L6","63",{"className":"","href":"/blog/page/63","children":63}],["$","$L6","64",{"className":"","href":"/blog/page/64","children":64}],["$","$L6","65",{"className":"","href":"/blog/page/65","children":65}],["$","$L6","66",{"className":"","href":"/blog/page/66","children":66}],["$","$L6","67",{"className":"","href":"/blog/page/67","children":67}],["$","$L6","68",{"className":"","href":"/blog/page/68","children":68}],["$","$L6","69",{"className":"","href":"/blog/page/69","children":69}],["$","$L6","70",{"className":"","href":"/blog/page/70","children":70}],["$","$L6","71",{"className":"","href":"/blog/page/71","children":71}],["$","$L6","72",{"className":"","href":"/blog/page/72","children":72}],["$","$L6","73",{"className":"","href":"/blog/page/73","children":73}],["$","$L6","74",{"className":"","href":"/blog/page/74","children":74}],["$","$L6","75",{"className":"","href":"/blog/page/75","children":75}],["$","$L6","76",{"className":"","href":"/blog/page/76","children":76}],["$","$L6","77",{"className":"","href":"/blog/page/77","children":77}],["$","$L6","78",{"className":"","href":"/blog/page/78","children":78}]]}]]}]]}]
7:[["$","meta","0",{"name":"viewport","content":"width=device-width, initial-scale=1"}],["$","meta","1",{"charSet":"utf-8"}],["$","title","2",{"children":"Patrick Desjardins Blog - Service Worker, Push Notification and Asp.Net MVC â€“ Part 3 of 3 Server Side"}],["$","meta","3",{"name":"description","content":"Service Worker, Push Notification and Asp.Net MVC â€“ Part 3 of 3 Server Side"}]]
1:null
