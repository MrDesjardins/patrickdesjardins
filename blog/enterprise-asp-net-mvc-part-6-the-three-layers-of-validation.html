<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="preload" href="/_next/static/media/c9a5bc6a7c948fb0-s.p.woff2" as="font" crossorigin="" type="font/woff2"/><link rel="preload" as="image" href="/images/blog/Validation-265x400.png"/><link rel="stylesheet" href="/_next/static/css/4f3d065c9e2d01e0.css" crossorigin="" data-precedence="next"/><link rel="stylesheet" href="/_next/static/css/67b0a31e2d30ff16.css" crossorigin="" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/_next/static/chunks/webpack-c95d176287d2fe2d.js" crossorigin=""/><script src="/_next/static/chunks/fd9d1056-cc48c28d170fddc2.js" async="" crossorigin=""></script><script src="/_next/static/chunks/69-c7efea4b65083e7f.js" async="" crossorigin=""></script><script src="/_next/static/chunks/main-app-f550f103b66f998a.js" async="" crossorigin=""></script><script src="/_next/static/chunks/250-d7e0a94ebe194dac.js" async=""></script><script src="/_next/static/chunks/79-2d03397107aae3f1.js" async=""></script><script src="/_next/static/chunks/app/blog/%5Bslug%5D/page-0cf4a8a9432ed6ce.js" async=""></script><title>Patrick Desjardins Blog - Enterprise Asp.Net MVC Part 6: The three layers of validation</title><meta name="description" content="Enterprise Asp.Net MVC Part 6: The three layers of validation"/><meta name="next-size-adjust"/><script src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js" crossorigin="" noModule=""></script></head><body class="layout_bodystyle__4ncsS"><div class="__className_aaf875"><div class="layout_container__Tovb9"><header class="layout_siteTitle__k5U8g">Patrick Desjardins Blog</header><nav><ul class="layout_navLinks__mf70r"><li class="layout_navLinkItem__1L8fB"><a class="layout_navLinkText__bt28R" href="/">Main Page</a><a class="layout_navLinkText__bt28R" href="/blog">Blog</a><a class="layout_navLinkText__bt28R" href="/blog/for/2024">2024</a><a class="layout_navLinkText__bt28R" href="/blog/for/2023">2023</a><a class="layout_navLinkText__bt28R" href="/blog/for/2022">2022</a><a class="layout_navLinkText__bt28R" href="/blog/for/2021">2021</a><a class="layout_navLinkText__bt28R" href="/blog/for/2020">2020</a><a class="layout_navLinkText__bt28R" href="/blog/for/2019">2019</a><a class="layout_navLinkText__bt28R" href="/blog/for/2018">2018</a><a class="layout_navLinkText__bt28R" href="/blog/for/2017">2017</a><a class="layout_navLinkText__bt28R" href="/blog/for/2016">2016</a><a class="layout_navLinkText__bt28R" href="/blog/for/2015">2015</a><a class="layout_navLinkText__bt28R" href="/blog/for/2014">2014</a><a class="layout_navLinkText__bt28R" href="/blog/for/2013">2013</a><a class="layout_navLinkText__bt28R" href="/blog/for/2012">2012</a><a class="layout_navLinkText__bt28R" href="/blog/for/2011">2011</a></li></ul></nav><div class="layout_blogPictureContainer__XC7nK"><img alt="Patrick Desjardins picture from a conference" loading="lazy" width="800" height="260" decoding="async" data-nimg="1" class="layout_blogTopPicture__RJHNN" style="color:transparent" src="/images/backgrounds/patrickdesjardins_conference_bw.jpeg"/></div><main class="layout_main__mXTwS"><h1>Enterprise Asp.Net MVC Part 6: The three layers of validation</h1><div class="layout_blogPostContainer__WYELx"><p class="layout_blogPostDate__LUvx5">Posted on: <!-- -->2012-11-07</p><p>Validations is definitely a serious subject. If no validation is made, then the system is compromise. Whatever the architecture, whatever the hardware setup and whatever the idea of the product, you need to implement validations to protect your system. This is why it must be taken seriously.</p>
<p>By default, Asp.Net MVC handles validation and also <a href="./model-validation-and-entity-framework-4-3">Entity Framework uses the same interface to handle validation</a> entities. So, why not use what is already in place and not try to reinvent the wheel. In fact, we follow the <a href="http://en.wikipedia.org/wiki/KISS_principle">KISS</a> principle.</p>
<p>Here is an overview of the article in a single image.</p>
<p><img src="/images/blog/Validation-265x400.png" alt=""/></p>
<p>We have 3 layers of validation. The first layer and third layer are built-in with .Net with the <a href="./how-to-validate-model-object-with-asp-net-mvc-correctly">IValidatableObject interface</a>. I have <a href="./how-to-validate-model-object-with-asp-net-mvc-correctly">already</a> discussed about this interface for validating entity but I&#x27;ll show you how to use it in a more &quot;enterprise way&quot;.</p>
<h1>Using IValidatableObject</h1>
<p>This interface lets you have a single method called <em>Validate</em> which lets you return error message linked to a property method. If you want a general error, you can also specify an empty string for the property name. Simple? Yes. Powerful? Even more! The framework know this interface and it automatically uses the validation when the model is bound from a Http request to your view model by the Model Binder. The .Net framework automatically call this method when Entity Framework try to save entities to the database. This mean that you have nothing to do, but to add your business logic validation.</p>
<p>From here, it&#x27;s interesting to force every model to have this interface and this is why a good place to inherit from <em>IValidatableObject</em> is in the BaseModel.</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#fff;color:#24292e" tabindex="0" data-language="csharp" data-theme="github-light"><code data-language="csharp" data-theme="github-light" style="display:grid"><span data-line=""><span style="color:#D73A49">public</span><span style="color:#D73A49"> abstract</span><span style="color:#D73A49"> class</span><span style="color:#6F42C1"> BaseModel</span><span style="color:#24292E"> : </span><span style="color:#6F42C1">IValidatableObject</span><span style="color:#24292E"> { </span><span style="color:#D73A49">public</span><span style="color:#D73A49"> const</span><span style="color:#D73A49"> int</span><span style="color:#6F42C1"> NOT_INITIALIZED</span><span style="color:#D73A49"> =</span><span style="color:#D73A49"> -</span><span style="color:#005CC5">1</span><span style="color:#24292E">; </span><span style="color:#D73A49">public</span><span style="color:#D73A49"> int</span><span style="color:#6F42C1"> Id</span><span style="color:#24292E"> { </span><span style="color:#D73A49">get</span><span style="color:#24292E">; </span><span style="color:#D73A49">set</span><span style="color:#24292E">; }</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#24292E">#</span><span style="color:#D73A49">region</span><span style="color:#032F62"> Implementation of IValidatableObject</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#D73A49">public</span><span style="color:#D73A49"> abstract</span><span style="color:#6F42C1"> IEnumerable</span><span style="color:#24292E">&lt;</span><span style="color:#6F42C1">ValidationResult</span><span style="color:#24292E">&gt; </span><span style="color:#6F42C1">Validate</span><span style="color:#24292E">(</span><span style="color:#6F42C1">ValidationContext</span><span style="color:#6F42C1"> validationContext</span><span style="color:#24292E">);</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#24292E">#</span><span style="color:#D73A49">endregion</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#24292E">}</span></span></code></pre></figure>
<p>Every model have to define the <em>Validate</em> method. If no validation is required, the method is simply empty. Let&#x27;s go back with the Workout entity and add some validations.</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#fff;color:#24292e" tabindex="0" data-language="csharp" data-theme="github-light"><code data-language="csharp" data-theme="github-light" style="display:grid"><span data-line=""><span style="color:#D73A49">public</span><span style="color:#D73A49"> class</span><span style="color:#6F42C1"> Workout</span><span style="color:#24292E"> : </span><span style="color:#6F42C1">BaseModel</span><span style="color:#24292E">, </span><span style="color:#6F42C1">IUserOwnable</span><span style="color:#24292E"> {</span></span>
<span data-line=""><span style="color:#D73A49">  public</span><span style="color:#6F42C1"> DateTime</span><span style="color:#6F42C1"> StartTime</span><span style="color:#24292E"> { </span><span style="color:#D73A49">get</span><span style="color:#24292E">; </span><span style="color:#D73A49">set</span><span style="color:#24292E">; }</span></span>
<span data-line=""><span style="color:#D73A49">  public</span><span style="color:#6F42C1"> DateTime</span><span style="color:#24292E">? </span><span style="color:#6F42C1">EndTime</span><span style="color:#24292E"> { </span><span style="color:#D73A49">get</span><span style="color:#24292E">; </span><span style="color:#D73A49">set</span><span style="color:#24292E">; }</span></span>
<span data-line=""><span style="color:#D73A49">  public</span><span style="color:#D73A49"> string</span><span style="color:#6F42C1"> Name</span><span style="color:#24292E"> { </span><span style="color:#D73A49">get</span><span style="color:#24292E">; </span><span style="color:#D73A49">set</span><span style="color:#24292E">; }</span></span>
<span data-line=""><span style="color:#D73A49">  public</span><span style="color:#D73A49"> string</span><span style="color:#6F42C1"> Goal</span><span style="color:#24292E"> { </span><span style="color:#D73A49">get</span><span style="color:#24292E">; </span><span style="color:#D73A49">set</span><span style="color:#24292E">; }</span></span>
<span data-line=""><span style="color:#D73A49">  public</span><span style="color:#6F42C1"> ICollection</span><span style="color:#24292E">&lt;</span><span style="color:#6F42C1">WorkoutSession</span><span style="color:#24292E">&gt; </span><span style="color:#6F42C1">Sessions</span><span style="color:#24292E"> { </span><span style="color:#D73A49">get</span><span style="color:#24292E">; </span><span style="color:#D73A49">set</span><span style="color:#24292E">; }</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#D73A49">  public</span><span style="color:#D73A49"> override</span><span style="color:#6F42C1"> IEnumerable</span><span style="color:#24292E">&lt;</span><span style="color:#6F42C1">ValidationResult</span><span style="color:#24292E">&gt; </span><span style="color:#6F42C1">Validate</span><span style="color:#24292E">(</span><span style="color:#6F42C1">ValidationContext</span><span style="color:#6F42C1"> validationContext</span><span style="color:#24292E">) {</span></span>
<span data-line=""><span style="color:#D73A49">    if</span><span style="color:#24292E"> (</span><span style="color:#D73A49">string</span><span style="color:#24292E">.</span><span style="color:#6F42C1">IsNullOrEmpty</span><span style="color:#24292E">(Name)) {</span></span>
<span data-line=""><span style="color:#D73A49">      yield</span><span style="color:#D73A49"> return</span><span style="color:#D73A49"> new</span><span style="color:#6F42C1"> ValidationResult</span><span style="color:#24292E">(</span><span style="color:#032F62">&quot;Name is mandatory&quot;</span><span style="color:#24292E">, </span><span style="color:#D73A49">new</span><span style="color:#24292E">[] {</span><span style="color:#032F62">&quot;Name&quot;</span><span style="color:#24292E">});</span></span>
<span data-line=""><span style="color:#24292E">    }</span></span>
<span data-line=""><span style="color:#D73A49">    if</span><span style="color:#24292E"> (EndTime.HasValue) {</span></span>
<span data-line=""><span style="color:#D73A49">      if</span><span style="color:#24292E"> (StartTime </span><span style="color:#D73A49">&gt;</span><span style="color:#24292E"> EndTime.Value) {</span></span>
<span data-line=""><span style="color:#D73A49">        yield</span><span style="color:#D73A49"> return</span><span style="color:#D73A49"> new</span><span style="color:#6F42C1"> ValidationResult</span><span style="color:#24292E">(</span><span style="color:#032F62">&quot;EndTime must be after the StartTime&quot;</span><span style="color:#24292E">, </span><span style="color:#D73A49">new</span><span style="color:#24292E">[] {</span><span style="color:#032F62">&quot;StartTime&quot;</span><span style="color:#24292E">, </span><span style="color:#032F62">&quot;EndTime&quot;</span><span style="color:#24292E">});</span></span>
<span data-line=""><span style="color:#24292E">      }</span></span>
<span data-line=""><span style="color:#24292E">    }</span></span>
<span data-line=""><span style="color:#24292E">  }</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#24292E">  #</span><span style="color:#D73A49">region</span><span style="color:#032F62"> Implementation of IUserOwnable</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#D73A49">  public</span><span style="color:#D73A49"> int</span><span style="color:#6F42C1"> UserId</span><span style="color:#24292E"> { </span><span style="color:#D73A49">get</span><span style="color:#24292E">; </span><span style="color:#D73A49">set</span><span style="color:#24292E">; }</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#24292E">  #</span><span style="color:#D73A49">endregion</span></span>
<span data-line=""><span style="color:#24292E">}</span></span></code></pre></figure>
<p>Every time we have an error we return a <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-light" style="background-color:#fff;color:#24292e"><span data-line=""><span>ValidationResult</span></span></code></span>. We specify a message and an array of properties that are concerned by the error. In this example, the name is validated and the EndTime property too but only when this one is specified.</p>
<h1>The first layer of validation : Model Binding inside the controller</h1>
<p>We have implemented the <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-light" style="background-color:#fff;color:#24292e"><span data-line=""><span>IValidatableObject</span></span></code></span> and when a Http request is done to the server, the controller bind the data to the model. Since we are using the ViewModel approach, this validation is not triggered! But, since we have a BaseController and already have defined the new approach of having the model to be automapped automatically it hooks the validation and apply it when the ViewModel is mapped to the Model. (You have to go read previous post of &quot;Business&quot; category to understand why it&#x27;s automatically mapped.)</p>
<p>The first modification occurs in the override method <em>OnActionExecuting</em> that should be already overrided with the modification of the mapper. We simply need to check if the model bound is really a IValidatableObject and to trig the validation mechanism.</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#fff;color:#24292e" tabindex="0" data-language="csharp" data-theme="github-light"><code data-language="csharp" data-theme="github-light" style="display:grid"><span data-line=""><span style="color:#D73A49">protected</span><span style="color:#D73A49"> override</span><span style="color:#D73A49"> void</span><span style="color:#6F42C1"> OnActionExecuting</span><span style="color:#24292E">(</span><span style="color:#6F42C1">ActionExecutingContext</span><span style="color:#6F42C1"> filterContext</span><span style="color:#24292E">) {</span></span>
<span data-line=""><span style="color:#005CC5">  base</span><span style="color:#24292E">.</span><span style="color:#6F42C1">OnActionExecuting</span><span style="color:#24292E">(filterContext); </span><span style="color:#D73A49">if</span><span style="color:#24292E">(filterContext.ActionParameters.</span><span style="color:#6F42C1">Any</span><span style="color:#24292E">()) {</span></span>
<span data-line=""><span style="color:#D73A49">    var</span><span style="color:#6F42C1"> possibleViewModel</span><span style="color:#D73A49"> =</span><span style="color:#24292E"> filterContext.ActionParameters.</span><span style="color:#6F42C1">FirstOrDefault</span><span style="color:#24292E">(</span><span style="color:#6F42C1">x</span><span style="color:#D73A49"> =&gt;</span><span style="color:#24292E"> x.Value.</span><span style="color:#6F42C1">GetType</span><span style="color:#24292E">() </span><span style="color:#D73A49">==</span><span style="color:#D73A49"> typeof</span><span style="color:#24292E">(</span><span style="color:#6F42C1">TViewModel</span><span style="color:#24292E">));</span></span>
<span data-line=""><span style="color:#D73A49">    if</span><span style="color:#24292E"> (possibleViewModel.Value</span><span style="color:#D73A49">!=</span><span style="color:#005CC5">null</span><span style="color:#24292E">) {</span></span>
<span data-line=""><span style="color:#D73A49">      var</span><span style="color:#6F42C1"> viewModel</span><span style="color:#D73A49"> =</span><span style="color:#24292E"> (</span><span style="color:#6F42C1">TViewModel</span><span style="color:#24292E">) possibleViewModel.Value;</span></span>
<span data-line=""><span style="color:#D73A49">      var</span><span style="color:#6F42C1"> model</span><span style="color:#D73A49"> =</span><span style="color:#24292E"> (</span><span style="color:#6F42C1">TModel</span><span style="color:#24292E">) Activator.</span><span style="color:#6F42C1">CreateInstance</span><span style="color:#24292E">(</span><span style="color:#D73A49">typeof</span><span style="color:#24292E"> (</span><span style="color:#6F42C1">TModel</span><span style="color:#24292E">));</span></span>
<span data-line=""><span style="color:#24292E">      Model </span><span style="color:#D73A49">=</span><span style="color:#24292E">_mapperFactory.</span><span style="color:#6F42C1">Map</span><span style="color:#24292E">(viewModel, model);</span></span>
<span data-line=""><span style="color:#6F42C1">      ApplyOwnership</span><span style="color:#24292E">();</span></span>
<span data-line=""><span style="color:#6F42C1">      ApplyErrorsToModelState</span><span style="color:#24292E">();</span></span>
<span data-line=""><span style="color:#24292E">    }</span></span>
<span data-line=""><span style="color:#24292E">  }</span></span>
<span data-line=""><span style="color:#24292E">}</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#D73A49">private</span><span style="color:#D73A49"> void</span><span style="color:#6F42C1"> ApplyErrorsToModelState</span><span style="color:#24292E">() {</span></span>
<span data-line=""><span style="color:#D73A49">  if</span><span style="color:#24292E"> (Model </span><span style="color:#D73A49">is</span><span style="color:#6F42C1"> IValidatableObject</span><span style="color:#24292E">) {</span></span>
<span data-line=""><span style="color:#D73A49">    var</span><span style="color:#6F42C1"> errors</span><span style="color:#D73A49"> =</span><span style="color:#24292E"> (Model </span><span style="color:#D73A49">as</span><span style="color:#6F42C1"> IValidatableObject</span><span style="color:#24292E">).</span><span style="color:#6F42C1">Validate</span><span style="color:#24292E">(</span><span style="color:#D73A49">new</span><span style="color:#6F42C1"> ValidationContext</span><span style="color:#24292E">(</span><span style="color:#005CC5">this</span><span style="color:#24292E">));</span></span>
<span data-line=""><span style="color:#D73A49">    foreach</span><span style="color:#24292E"> (</span><span style="color:#D73A49">var</span><span style="color:#6F42C1"> validationResult</span><span style="color:#D73A49"> in</span><span style="color:#24292E"> errors) {</span></span>
<span data-line=""><span style="color:#D73A49">      foreach</span><span style="color:#24292E"> (</span><span style="color:#D73A49">var</span><span style="color:#6F42C1"> memberName</span><span style="color:#D73A49"> in</span><span style="color:#24292E"> validationResult.MemberNames) {</span></span>
<span data-line=""><span style="color:#24292E">        ModelState.</span><span style="color:#6F42C1">AddModelError</span><span style="color:#24292E">(memberName, validationResult.ErrorMessage);</span></span>
<span data-line=""><span style="color:#24292E">      }</span></span>
<span data-line=""><span style="color:#24292E">    }</span></span>
<span data-line=""><span style="color:#24292E">  }</span></span>
<span data-line=""><span style="color:#24292E">}</span></span></code></pre></figure>
<p>What we are doing is a general method that works for any entities. We verify if the Model bound from the ViewModel is really inherited from a <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-light" style="background-color:#fff;color:#24292e"><span data-line=""><span>IValidatableObject</span></span></code></span>. From here, we do what the framework would do if we weren&#x27;t using view model : calling the Validate method of the interface. We then loop all error and assign everything to the ModelState. This will give us the possibility to act like if no view model has been used.</p>
<p>The code above about the method &quot;ApplyErrorsToModelState&quot; could be replaced with the code below to be able to validate the <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-light" style="background-color:#fff;color:#24292e"><span data-line=""><span>data annotation</span></span></code></span> AND also the <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-light" style="background-color:#fff;color:#24292e"><span data-line=""><span>IValidatableObject</span></span></code></span> interface.</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#fff;color:#24292e" tabindex="0" data-language="csharp" data-theme="github-light"><code data-language="csharp" data-theme="github-light" style="display:grid"><span data-line=""><span style="color:#D73A49"> private</span><span style="color:#D73A49"> void</span><span style="color:#6F42C1"> ApplyErrorsToModelState</span><span style="color:#24292E">() { </span><span style="color:#6F42C1">ModelMetadata</span><span style="color:#6F42C1"> metadata</span><span style="color:#D73A49"> =</span><span style="color:#24292E"> ModelMetadataProviders.Current.</span><span style="color:#6F42C1">GetMetadataForType</span><span style="color:#24292E">(() </span><span style="color:#D73A49">=&gt;</span><span style="color:#24292E"> Model, Model.</span><span style="color:#6F42C1">GetType</span><span style="color:#24292E">());</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#D73A49">foreach</span><span style="color:#24292E"> (</span><span style="color:#6F42C1">ModelValidationResult</span><span style="color:#6F42C1"> validationResult</span><span style="color:#D73A49"> in</span><span style="color:#24292E"> ModelValidator.</span><span style="color:#6F42C1">GetModelValidator</span><span style="color:#24292E">(metadata, </span><span style="color:#005CC5">this</span><span style="color:#24292E">.ControllerContext).</span><span style="color:#6F42C1">Validate</span><span style="color:#24292E">(</span><span style="color:#005CC5">null</span><span style="color:#24292E">)) { </span><span style="color:#D73A49">var</span><span style="color:#6F42C1"> propertyName</span><span style="color:#D73A49"> =</span><span style="color:#24292E"> validationResult.MemberName; ModelState.</span><span style="color:#6F42C1">AddModelError</span><span style="color:#24292E">(propertyName, validationResult.Message); } }</span></span></code></pre></figure>
<p>The code above validate the data annotation and the IValidatableObject. This can be used in a scenario where you need to have deeper validation process. For example here is the same code as above with enhanced validation on the mapping. This required to have split both validation.</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#fff;color:#24292e" tabindex="0" data-language="csharp" data-theme="github-light"><code data-language="csharp" data-theme="github-light" style="display:grid"><span data-line=""><span style="color:#D73A49">private</span><span style="color:#D73A49"> void</span><span style="color:#6F42C1"> ApplyErrorsToModelState</span><span style="color:#24292E">(</span><span style="color:#6F42C1">TModel</span><span style="color:#6F42C1"> model</span><span style="color:#24292E">, </span><span style="color:#6F42C1">TViewModel</span><span style="color:#6F42C1"> viewModel</span><span style="color:#24292E">) {</span></span>
<span data-line=""><span style="color:#6A737D">  //Data Annotation validation</span></span>
<span data-line=""><span style="color:#6F42C1">  ICollection</span><span style="color:#24292E">&lt;</span><span style="color:#6F42C1">ValidationResult</span><span style="color:#24292E">&gt; </span><span style="color:#6F42C1">result</span><span style="color:#24292E">;</span></span>
<span data-line=""><span style="color:#6F42C1">  ValidateDataAnnotation</span><span style="color:#24292E">(model, </span><span style="color:#D73A49">out</span><span style="color:#24292E"> result);</span></span>
<span data-line=""><span style="color:#D73A49">  foreach</span><span style="color:#24292E"> (</span><span style="color:#6F42C1">ValidationResult</span><span style="color:#6F42C1"> validationResult</span><span style="color:#D73A49"> in</span><span style="color:#24292E"> result) {</span></span>
<span data-line=""><span style="color:#D73A49">    foreach</span><span style="color:#24292E"> (</span><span style="color:#D73A49">string</span><span style="color:#6F42C1"> memberName</span><span style="color:#D73A49"> in</span><span style="color:#24292E"> validationResult.MemberNames) {</span></span>
<span data-line=""><span style="color:#24292E">      ModelState.</span><span style="color:#6F42C1">AddModelError</span><span style="color:#24292E">(memberName, validationResult.ErrorMessage);</span></span>
<span data-line=""><span style="color:#24292E">    }</span></span>
<span data-line=""><span style="color:#24292E">    }</span></span>
<span data-line=""><span style="color:#6A737D">  //IValidatableObject validation</span></span>
<span data-line=""><span style="color:#D73A49">  if</span><span style="color:#24292E"> (Model </span><span style="color:#D73A49">is</span><span style="color:#6F42C1"> IValidatableObject</span><span style="color:#24292E">) {</span></span>
<span data-line=""><span style="color:#6F42C1">    IEnumerable</span><span style="color:#24292E">&lt;</span><span style="color:#6F42C1">ValidationResult</span><span style="color:#24292E">&gt; </span><span style="color:#6F42C1">errors</span><span style="color:#D73A49"> =</span><span style="color:#24292E"> (Model </span><span style="color:#D73A49">as</span><span style="color:#6F42C1"> IValidatableObject</span><span style="color:#24292E">).</span><span style="color:#6F42C1">Validate</span><span style="color:#24292E">(</span><span style="color:#D73A49">new</span><span style="color:#6F42C1"> ValidationContext</span><span style="color:#24292E">(</span><span style="color:#005CC5">this</span><span style="color:#24292E">));</span></span>
<span data-line=""><span style="color:#D73A49">    foreach</span><span style="color:#24292E"> (</span><span style="color:#6F42C1">ValidationResult</span><span style="color:#6F42C1"> validationResult</span><span style="color:#D73A49"> in</span><span style="color:#24292E"> errors) {</span></span>
<span data-line=""><span style="color:#D73A49">      if</span><span style="color:#24292E"> (validationResult </span><span style="color:#D73A49">is</span><span style="color:#6F42C1"> EnhancedMappedValidationResult</span><span style="color:#24292E">&lt;</span><span style="color:#6F42C1">TModel</span><span style="color:#24292E">&gt;) {</span></span>
<span data-line=""><span style="color:#D73A49">          var</span><span style="color:#6F42C1"> enhanced</span><span style="color:#D73A49"> =</span><span style="color:#24292E"> (</span><span style="color:#6F42C1">EnhancedMappedValidationResult</span><span style="color:#24292E">&lt;</span><span style="color:#6F42C1">TModel</span><span style="color:#24292E">&gt;)validationResult;</span></span>
<span data-line=""><span style="color:#D73A49">          var</span><span style="color:#6F42C1"> viewModelPropertyName</span><span style="color:#D73A49"> =</span><span style="color:#24292E">_mapperFactory.</span><span style="color:#6F42C1">GetMapper</span><span style="color:#24292E">(model, viewModel).</span><span style="color:#6F42C1">GetErrorPropertyMappedFor</span><span style="color:#24292E">(enhanced.Property); ModelState.</span><span style="color:#6F42C1">AddModelError</span><span style="color:#24292E">(viewModelPropertyName, validationResult.ErrorMessage);</span></span>
<span data-line=""><span style="color:#24292E">      } </span><span style="color:#D73A49">else</span><span style="color:#24292E"> {</span></span>
<span data-line=""><span style="color:#D73A49">        if</span><span style="color:#24292E"> (validationResult.MemberNames.</span><span style="color:#6F42C1">Any</span><span style="color:#24292E">()) {</span></span>
<span data-line=""><span style="color:#D73A49">          foreach</span><span style="color:#24292E"> (</span><span style="color:#D73A49">string</span><span style="color:#6F42C1"> memberName</span><span style="color:#D73A49"> in</span><span style="color:#24292E"> validationResult.MemberNames) {</span></span>
<span data-line=""><span style="color:#24292E">            ModelState.</span><span style="color:#6F42C1">AddModelError</span><span style="color:#24292E">(memberName, validationResult.ErrorMessage);</span></span>
<span data-line=""><span style="color:#24292E">          }</span></span>
<span data-line=""><span style="color:#24292E">        } </span><span style="color:#D73A49">else</span><span style="color:#24292E"> {</span></span>
<span data-line=""><span style="color:#24292E">          ModelState.</span><span style="color:#6F42C1">AddModelError</span><span style="color:#24292E">(</span><span style="color:#D73A49">string</span><span style="color:#24292E">.Empty, validationResult.ErrorMessage);</span></span>
<span data-line=""><span style="color:#24292E">        }</span></span>
<span data-line=""><span style="color:#24292E">      }</span></span>
<span data-line=""><span style="color:#24292E">    }</span></span>
<span data-line=""><span style="color:#24292E">  }</span></span>
<span data-line=""><span style="color:#6A737D">  /* //This validate underlying entity which can be not fully loaded in the case of reference ModelMetadata metadata = ModelMetadataProviders.Current.GetMetadataForType(() =&gt; Model, Model.GetType());</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#6A737D">  foreach (ModelValidationResult validationResult in ModelValidator.GetModelValidator(metadata, this.ControllerContext).Validate(null)) { </span></span>
<span data-line=""><span style="color:#6A737D">    var propertyName = validationResult.MemberName; </span></span>
<span data-line=""><span style="color:#6A737D">    ModelState.AddModelViewModelToErrorsMap(propertyName, validationResult.Message); </span></span>
<span data-line=""><span style="color:#6A737D">  }</span></span>
<span data-line=""><span style="color:#6A737D">  */</span></span>
<span data-line=""><span style="color:#24292E">}</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#D73A49">  private</span><span style="color:#D73A49"> bool</span><span style="color:#6F42C1"> ValidateDataAnnotation</span><span style="color:#24292E">(</span><span style="color:#D73A49">object</span><span style="color:#6F42C1"> entity</span><span style="color:#24292E">, </span><span style="color:#D73A49">out</span><span style="color:#6F42C1"> ICollection</span><span style="color:#24292E">&lt;</span><span style="color:#6F42C1">ValidationResult</span><span style="color:#24292E">&gt; </span><span style="color:#6F42C1">results</span><span style="color:#24292E">) {</span></span>
<span data-line=""><span style="color:#D73A49">    var</span><span style="color:#6F42C1"> context</span><span style="color:#D73A49"> =</span><span style="color:#D73A49"> new</span><span style="color:#6F42C1"> ValidationContext</span><span style="color:#24292E">(entity);</span></span>
<span data-line=""><span style="color:#24292E">    results </span><span style="color:#D73A49">=</span><span style="color:#D73A49"> new</span><span style="color:#6F42C1"> List</span><span style="color:#24292E">&lt;</span><span style="color:#6F42C1">ValidationResult</span><span style="color:#24292E">&gt;();</span></span>
<span data-line=""><span style="color:#D73A49">    return</span><span style="color:#24292E"> Validator.</span><span style="color:#6F42C1">TryValidateObject</span><span style="color:#24292E">(entity, context, results, </span><span style="color:#005CC5">true</span><span style="color:#24292E">);</span></span>
<span data-line=""><span style="color:#24292E">  }</span></span></code></pre></figure>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#fff;color:#24292e" tabindex="0" data-language="csharp" data-theme="github-light"><code data-language="csharp" data-theme="github-light" style="display:grid"><span data-line=""><span style="color:#24292E"> [</span><span style="color:#6F42C1">HttpPost</span><span style="color:#24292E">] </span><span style="color:#D73A49">public</span><span style="color:#6F42C1"> ActionResult</span><span style="color:#6F42C1"> Create</span><span style="color:#24292E">(</span><span style="color:#6F42C1">WorkoutViewModel</span><span style="color:#6F42C1"> viewModel</span><span style="color:#24292E">) { </span></span>
<span data-line=""><span style="color:#D73A49">  if</span><span style="color:#24292E"> (ModelState.IsValid) </span><span style="color:#6A737D">//This is the default Asp.Net MVC way to validate entity </span></span>
<span data-line=""><span style="color:#24292E">  { </span></span>
<span data-line=""><span style="color:#6A737D">    //Save the entity</span></span></code></pre></figure>
<p>This is great because it&#x27;s the default way to validate object that has been bound in MVC. The <em>IsValid</em> doesn&#x27;t only validate our business logic but also validate all data annotation that could have been set. It&#x27;s even greater because people that are used to use the ModelState for validation won&#x27;t have to learn a new way to act with controllers because it&#x27;s the same.</p>
<h1>The second layer of validation : Service layer</h1>
<p>So far, the validation works fine but it doesn&#x27;t handle the case that you need to validate across many entities. You can have case that you need to validate an entity dependently of the value of others entities. It can also be a validation from some value that are inside the database. Since Model doesn&#x27;t have access to the repository, at this moment, we couldn&#x27;t validate. To solve this problem, the second layer of validation is required and the perfect place it&#x27;s in the Service layer. The reason is that this layer does have access to all entities and also have access to all repositories. Contrary to the first layer of validation, this one will require some manual explicit call for validation. The concrete implementation of this second layer of validation will be done with the Workout entity. What we want to implement is a validation that the active user cannot create more than 3 workouts per month without a premium account. That mean that we need to go check in the database the amount of workout for a specific user for a specific month. This couldn&#x27;t be validate in the Workout class because it doesn&#x27;t have access to the database.</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#fff;color:#24292e" tabindex="0" data-language="csharp" data-theme="github-light"><code data-language="csharp" data-theme="github-light" style="display:grid"><span data-line=""><span style="color:#D73A49">public</span><span style="color:#D73A49"> int</span><span style="color:#6F42C1"> Create</span><span style="color:#24292E">(</span><span style="color:#6F42C1">Workout</span><span style="color:#6F42C1"> model</span><span style="color:#24292E">) { </span></span>
<span data-line=""><span style="color:#D73A49">  int</span><span style="color:#6F42C1"> amountWorkout</span><span style="color:#D73A49"> =</span><span style="color:#24292E"> Repository.Workout.</span><span style="color:#6F42C1">GetAmountWorkoutForCurrentMonth</span><span style="color:#24292E">(); </span></span>
<span data-line=""><span style="color:#D73A49">  if</span><span style="color:#24292E"> (amountWorkout</span><span style="color:#D73A49">&gt;</span><span style="color:#005CC5">3</span><span style="color:#24292E">)</span><span style="color:#6A737D">//More than 3 workouts done without premium account </span></span>
<span data-line=""><span style="color:#24292E">  { </span></span>
<span data-line=""><span style="color:#D73A49">    throw</span><span style="color:#D73A49"> new</span><span style="color:#6F42C1"> ValidationErrors</span><span style="color:#24292E">(</span><span style="color:#D73A49">new</span><span style="color:#6F42C1"> GeneralError</span><span style="color:#24292E">(</span><span style="color:#032F62">&quot;You have reach the limit of 3 workouts per month, you need premium or wait the next month&quot;</span><span style="color:#24292E">)); </span></span>
<span data-line=""><span style="color:#24292E">  } </span></span>
<span data-line=""><span style="color:#D73A49">  return</span><span style="color:#24292E"> Repository.Workout.</span><span style="color:#6F42C1">Insert</span><span style="color:#24292E">(model); </span></span>
<span data-line=""><span style="color:#24292E">}</span></span></code></pre></figure>
<p>This get the amount of workout for the month and if it&#x27;s over a certain threshold will raise the error.</p>
<p>The error is handled by the controller that verify that the action executed has been completed without error. Here is the Create action of the Workout controller with the first layer validation and with the catch for the second layer.</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#fff;color:#24292e" tabindex="0" data-language="csharp" data-theme="github-light"><code data-language="csharp" data-theme="github-light" style="display:grid"><span data-line=""><span style="color:#24292E">[</span><span style="color:#6F42C1">HttpPost</span><span style="color:#24292E">] </span></span>
<span data-line=""><span style="color:#D73A49">public</span><span style="color:#6F42C1"> ActionResult</span><span style="color:#6F42C1"> Create</span><span style="color:#24292E">(</span><span style="color:#6F42C1">WorkoutViewModel</span><span style="color:#6F42C1"> viewModel</span><span style="color:#24292E">) { </span></span>
<span data-line=""><span style="color:#D73A49">  if</span><span style="color:#24292E"> (ModelState.IsValid) { </span></span>
<span data-line=""><span style="color:#D73A49">    try</span><span style="color:#24292E"> {_service.</span><span style="color:#6F42C1">Create</span><span style="color:#24292E">(Model); } </span></span>
<span data-line=""><span style="color:#D73A49">    catch</span><span style="color:#24292E"> (</span><span style="color:#6F42C1">ValidationErrors</span><span style="color:#6F42C1"> propertyErrors</span><span style="color:#24292E">) { </span></span>
<span data-line=""><span style="color:#24292E">      ModelState.</span><span style="color:#6F42C1">AddValidationErrors</span><span style="color:#24292E">(propertyErrors); </span></span>
<span data-line=""><span style="color:#24292E">    } </span></span>
<span data-line=""><span style="color:#24292E">  } </span></span>
<span data-line=""><span style="color:#D73A49">  return</span><span style="color:#6F42C1"> View</span><span style="color:#24292E">(</span><span style="color:#032F62">&quot;Create&quot;</span><span style="color:#24292E">); </span></span>
<span data-line=""><span style="color:#24292E">}</span></span></code></pre></figure>
<p>The exception type is ValidationErrors which is our custom error handler. The reason is that we do not want to use specific exception from other layers. This is why cross layers classes will be used to transport exception through all layers. This will be discussed after the third layer of validation.</p>
<h1>The third layer of validation : Persistence layer</h1>
<p>The persistence layer is where the call to the database is done. This is an automatic validation with Entity Framework that call the <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-light" style="background-color:#fff;color:#24292e"><span data-line=""><span>IValidatableObject</span></span></code></span> interface of the entity before save it to the database.</p>
<p>But, since we do not want to raise a <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-light" style="background-color:#fff;color:#24292e"><span data-line=""><span>DbEntityValidationResult</span></span></code></span> up to the controller (because it&#x27;s a class that belong to Entity Framework (System.Data.Entity.Validation), we will use our own exception classes.</p>
<p>We will create an interface that will hold the property name in error and also the error message.</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#fff;color:#24292e" tabindex="0" data-language="csharp" data-theme="github-light"><code data-language="csharp" data-theme="github-light" style="display:grid"><span data-line=""><span style="color:#D73A49">public</span><span style="color:#D73A49"> interface</span><span style="color:#6F42C1"> IBaseError</span><span style="color:#24292E"> { </span></span>
<span data-line=""><span style="color:#D73A49">  string</span><span style="color:#6F42C1"> PropertyName</span><span style="color:#24292E"> { </span><span style="color:#D73A49">get</span><span style="color:#24292E">; } </span></span>
<span data-line=""><span style="color:#D73A49">  string</span><span style="color:#6F42C1"> PropertyExceptionMessage</span><span style="color:#24292E"> { </span><span style="color:#D73A49">get</span><span style="color:#24292E">; } </span></span>
<span data-line=""><span style="color:#24292E">}</span></span></code></pre></figure>
<p>Two classes will inherit from this interface. One for a property error and one for a general error.</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#fff;color:#24292e" tabindex="0" data-language="csharp" data-theme="github-light"><code data-language="csharp" data-theme="github-light" style="display:grid"><span data-line=""><span style="color:#D73A49"> public</span><span style="color:#D73A49"> class</span><span style="color:#6F42C1"> PropertyError</span><span style="color:#24292E">:</span><span style="color:#6F42C1">IBaseError</span><span style="color:#24292E"> { </span></span>
<span data-line=""><span style="color:#D73A49">  public</span><span style="color:#D73A49"> string</span><span style="color:#6F42C1"> PropertyName</span><span style="color:#24292E"> { </span><span style="color:#D73A49">get</span><span style="color:#24292E">; </span><span style="color:#D73A49">set</span><span style="color:#24292E">; } </span></span>
<span data-line=""><span style="color:#D73A49">  public</span><span style="color:#D73A49"> string</span><span style="color:#6F42C1"> PropertyExceptionMessage</span><span style="color:#24292E"> { </span><span style="color:#D73A49">get</span><span style="color:#24292E">; </span><span style="color:#D73A49">set</span><span style="color:#24292E">; } </span></span>
<span data-line=""><span style="color:#D73A49">  public</span><span style="color:#6F42C1"> PropertyError</span><span style="color:#24292E">(</span><span style="color:#D73A49">string</span><span style="color:#6F42C1"> propertyName</span><span style="color:#24292E">, </span><span style="color:#D73A49">string</span><span style="color:#6F42C1"> errorMessage</span><span style="color:#24292E">) { </span><span style="color:#005CC5">this</span><span style="color:#24292E">.PropertyName </span><span style="color:#D73A49">=</span><span style="color:#24292E"> propertyName; </span><span style="color:#005CC5">this</span><span style="color:#24292E">.PropertyExceptionMessage </span><span style="color:#D73A49">=</span><span style="color:#24292E"> errorMessage; } </span></span>
<span data-line=""><span style="color:#24292E">}</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#D73A49">public</span><span style="color:#D73A49"> class</span><span style="color:#6F42C1"> GeneralError</span><span style="color:#24292E">:</span><span style="color:#6F42C1">IBaseError</span><span style="color:#24292E"> { </span></span>
<span data-line=""><span style="color:#24292E">  #</span><span style="color:#D73A49">region</span><span style="color:#032F62"> Implementation of IBaseError</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#D73A49">  public</span><span style="color:#D73A49"> string</span><span style="color:#6F42C1"> PropertyName</span><span style="color:#24292E"> { </span><span style="color:#D73A49">get</span><span style="color:#24292E"> {</span><span style="color:#D73A49">return</span><span style="color:#D73A49"> string</span><span style="color:#24292E">.Empty; }} </span></span>
<span data-line=""><span style="color:#D73A49">  public</span><span style="color:#D73A49"> string</span><span style="color:#6F42C1"> PropertyExceptionMessage</span><span style="color:#24292E"> { </span><span style="color:#D73A49">get</span><span style="color:#24292E">; </span><span style="color:#D73A49">set</span><span style="color:#24292E">; }</span></span>
<span data-line=""><span style="color:#D73A49">  public</span><span style="color:#6F42C1"> GeneralError</span><span style="color:#24292E">(</span><span style="color:#D73A49">string</span><span style="color:#6F42C1"> errorMessage</span><span style="color:#24292E">) { </span><span style="color:#005CC5">this</span><span style="color:#24292E">.PropertyExceptionMessage </span><span style="color:#D73A49">=</span><span style="color:#24292E"> errorMessage; }</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#24292E">  #</span><span style="color:#D73A49">endregion</span><span style="color:#24292E"> </span></span>
<span data-line=""><span style="color:#24292E">}</span></span></code></pre></figure>
<p>Then, we add the interface <em>IValidationErrors</em> which holds all <em>IBaseError</em> to be send back through all layers.</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#fff;color:#24292e" tabindex="0" data-language="csharp" data-theme="github-light"><code data-language="csharp" data-theme="github-light" style="display:grid"><span data-line=""><span style="color:#D73A49"> public</span><span style="color:#D73A49"> interface</span><span style="color:#6F42C1"> IValidationErrors</span><span style="color:#24292E"> { </span><span style="color:#6F42C1">List</span><span style="color:#24292E">&lt;</span><span style="color:#6F42C1">IBaseError</span><span style="color:#24292E">&gt; </span><span style="color:#6F42C1">Errors</span><span style="color:#24292E"> { </span><span style="color:#D73A49">get</span><span style="color:#24292E">; </span><span style="color:#D73A49">set</span><span style="color:#24292E">; } }</span></span></code></pre></figure>
<p>The first implementation can be used anywhere, like in the service layers.</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#fff;color:#24292e" tabindex="0" data-language="csharp" data-theme="github-light"><code data-language="csharp" data-theme="github-light" style="display:grid"><span data-line=""><span style="color:#D73A49">public</span><span style="color:#D73A49"> class</span><span style="color:#6F42C1"> ValidationErrors</span><span style="color:#24292E"> : </span><span style="color:#6F42C1">Exception</span><span style="color:#24292E">, </span><span style="color:#6F42C1">IValidationErrors</span><span style="color:#24292E"> { </span></span>
<span data-line=""><span style="color:#D73A49">  public</span><span style="color:#6F42C1"> List</span><span style="color:#24292E">&lt;</span><span style="color:#6F42C1">IBaseError</span><span style="color:#24292E">&gt; </span><span style="color:#6F42C1">Errors</span><span style="color:#24292E"> { </span><span style="color:#D73A49">get</span><span style="color:#24292E">; </span><span style="color:#D73A49">set</span><span style="color:#24292E">; } </span></span>
<span data-line=""><span style="color:#D73A49">  public</span><span style="color:#6F42C1"> ValidationErrors</span><span style="color:#24292E">() { Errors </span><span style="color:#D73A49">=</span><span style="color:#D73A49"> new</span><span style="color:#6F42C1"> List</span><span style="color:#24292E">&lt;</span><span style="color:#6F42C1">IBaseError</span><span style="color:#24292E">&gt;(); }</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#D73A49">  public</span><span style="color:#6F42C1"> ValidationErrors</span><span style="color:#24292E">(</span><span style="color:#6F42C1">IBaseError</span><span style="color:#6F42C1"> error</span><span style="color:#24292E">): </span><span style="color:#005CC5">this</span><span style="color:#24292E">() { </span></span>
<span data-line=""><span style="color:#24292E">    Errors.</span><span style="color:#6F42C1">Add</span><span style="color:#24292E">(error); </span></span>
<span data-line=""><span style="color:#24292E">  }</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#24292E">}</span></span></code></pre></figure>
<p>The second is more specific to database.</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#fff;color:#24292e" tabindex="0" data-language="csharp" data-theme="github-light"><code data-language="csharp" data-theme="github-light" style="display:grid"><span data-line=""><span style="color:#D73A49">public</span><span style="color:#D73A49"> class</span><span style="color:#6F42C1"> DatabaseValidationErrors</span><span style="color:#24292E"> : </span><span style="color:#6F42C1">ValidationErrors</span><span style="color:#24292E"> { </span></span>
<span data-line=""><span style="color:#D73A49">  public</span><span style="color:#6F42C1"> DatabaseValidationErrors</span><span style="color:#24292E">(</span><span style="color:#6F42C1">IEnumerable</span><span style="color:#24292E">&lt;</span><span style="color:#6F42C1">DbEntityValidationResult</span><span style="color:#24292E">&gt; </span><span style="color:#6F42C1">errors</span><span style="color:#24292E">):</span><span style="color:#005CC5">base</span><span style="color:#24292E">() { </span></span>
<span data-line=""><span style="color:#D73A49">    foreach</span><span style="color:#24292E"> (</span><span style="color:#D73A49">var</span><span style="color:#6F42C1"> err</span><span style="color:#D73A49"> in</span><span style="color:#24292E"> errors.</span><span style="color:#6F42C1">SelectMany</span><span style="color:#24292E">(</span><span style="color:#6F42C1">dbEntityValidationResult</span><span style="color:#D73A49"> =&gt;</span><span style="color:#24292E"> dbEntityValidationResult.ValidationErrors)) { </span></span>
<span data-line=""><span style="color:#24292E">      Errors.</span><span style="color:#6F42C1">Add</span><span style="color:#24292E">(</span><span style="color:#D73A49">new</span><span style="color:#6F42C1"> PropertyError</span><span style="color:#24292E">(err.PropertyName,err.ErrorMessage)); </span></span>
<span data-line=""><span style="color:#24292E">    } </span></span>
<span data-line=""><span style="color:#24292E">  } </span></span>
<span data-line=""><span style="color:#24292E">}</span></span></code></pre></figure>
<p>The last one is used by the repository. In fact, when we <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-light" style="background-color:#fff;color:#24292e"><span data-line=""><span>SaveChanges()</span></span></code></span> to the database, we need to validate before Entity Framework executes the <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-light" style="background-color:#fff;color:#24292e"><span data-line=""><span>SaveChanges</span></span></code></span>. Of course, we could let Entity Framework but we would have to catch the exception. Since they are a way without having to catch an exception, I prefer to use it.</p>
<p>If you remember correctly, our <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-light" style="background-color:#fff;color:#24292e"><span data-line=""><span>DatabaseContext</span></span></code></span> inherits from <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-light" style="background-color:#fff;color:#24292e"><span data-line=""><span>IDatabaseContext</span></span></code></span> which have <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-light" style="background-color:#fff;color:#24292e"><span data-line=""><span>SaveChanges()</span></span></code></span> method. We simply need to override this one instead of relying on the one from <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-light" style="background-color:#fff;color:#24292e"><span data-line=""><span>DbContext</span></span></code></span> and call the DbContext one if everything is fine.</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#fff;color:#24292e" tabindex="0" data-language="csharp" data-theme="github-light"><code data-language="csharp" data-theme="github-light" style="display:grid"><span data-line=""><span style="color:#D73A49"> public</span><span style="color:#D73A49"> override</span><span style="color:#D73A49"> int</span><span style="color:#6F42C1"> SaveChanges</span><span style="color:#24292E">() { </span><span style="color:#D73A49">var</span><span style="color:#6F42C1"> errors</span><span style="color:#D73A49"> =</span><span style="color:#005CC5"> this</span><span style="color:#24292E">.</span><span style="color:#6F42C1">GetValidationErrors</span><span style="color:#24292E">(); </span><span style="color:#D73A49">if</span><span style="color:#24292E"> (</span><span style="color:#D73A49">!</span><span style="color:#24292E">errors.</span><span style="color:#6F42C1">Any</span><span style="color:#24292E">()) { </span><span style="color:#D73A49">return</span><span style="color:#005CC5"> base</span><span style="color:#24292E">.</span><span style="color:#6F42C1">SaveChanges</span><span style="color:#24292E">(); } </span><span style="color:#D73A49">else</span><span style="color:#24292E"> { </span><span style="color:#D73A49">throw</span><span style="color:#D73A49"> new</span><span style="color:#6F42C1"> DatabaseValidationErrors</span><span style="color:#24292E">(errors); } }</span></span></code></pre></figure>
<p>The exception thrown will loop all errors and be trig to a higher level. In fact, this exception is raised to the service layer which doesn&#x27;t handle the exception. So, the exception will be raised to the controller layer. This is the same patch of exception than having an exception thrown from the service in the layer 2 because of business logic validation! We are reusing the same mechanism and this is possible because of the exceptions classes we have created which are abstracted with interface.</p>
<h1>Model State and custom exceptions classes</h1>
<p>If you remember, the controller does have a catch for ValidationErrors.</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#fff;color:#24292e" tabindex="0" data-language="csharp" data-theme="github-light"><code data-language="csharp" data-theme="github-light" style="display:grid"><span data-line=""><span style="color:#6A737D"> //... </span></span>
<span data-line=""><span style="color:#D73A49">catch</span><span style="color:#24292E"> (</span><span style="color:#6F42C1">ValidationErrors</span><span style="color:#6F42C1"> propertyErrors</span><span style="color:#24292E">) { </span></span>
<span data-line=""><span style="color:#24292E">  ModelState.</span><span style="color:#6F42C1">AddValidationErrors</span><span style="color:#24292E">(propertyErrors); </span></span>
<span data-line=""><span style="color:#24292E">}</span></span></code></pre></figure>
<p>By default, the model state doesn&#x27;t have this method that accept our interface IValidationErrors. This is an extension method.</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#fff;color:#24292e" tabindex="0" data-language="csharp" data-theme="github-light"><code data-language="csharp" data-theme="github-light" style="display:grid"><span data-line=""><span style="color:#D73A49">public</span><span style="color:#D73A49"> static</span><span style="color:#D73A49"> class</span><span style="color:#6F42C1"> ControllersExtensions</span><span style="color:#24292E"> { </span></span>
<span data-line=""><span style="color:#D73A49">  public</span><span style="color:#D73A49"> static</span><span style="color:#D73A49"> void</span><span style="color:#6F42C1"> AddValidationErrors</span><span style="color:#24292E">(</span><span style="color:#D73A49">this</span><span style="color:#6F42C1"> ModelStateDictionary</span><span style="color:#6F42C1"> modelState</span><span style="color:#24292E">, </span><span style="color:#6F42C1">IValidationErrors</span><span style="color:#6F42C1"> propertyErrors</span><span style="color:#24292E">) { </span></span>
<span data-line=""><span style="color:#D73A49">    foreach</span><span style="color:#24292E"> (</span><span style="color:#D73A49">var</span><span style="color:#6F42C1"> databaseValidationError</span><span style="color:#D73A49"> in</span><span style="color:#24292E"> propertyErrors.Errors) { </span></span>
<span data-line=""><span style="color:#24292E">      modelState.</span><span style="color:#6F42C1">AddModelError</span><span style="color:#24292E">(databaseValidationError.PropertyName, databaseValidationError.PropertyExceptionMessage); </span></span>
<span data-line=""><span style="color:#24292E">    } </span></span>
<span data-line=""><span style="color:#24292E">  } </span></span>
<span data-line=""><span style="color:#24292E">}</span></span></code></pre></figure>
<p>Using <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-light" style="background-color:#fff;color:#24292e"><span data-line=""><span>IValidationErrors</span></span></code></span> lets handle errors from the service layer or the database error. In fact, at this point, it doesn&#x27;t really matter because we want to loop through all exceptions and to use the model state to attach doesn&#x27;t exception to the correct property (or if general exception to the string.empty which will be a global error message).</p>
<h1>Conclusion</h1>
<p>Validation of the model could be more complex. It could have been used external classes for each validation. We could have create our own system for validation message and not using the <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-light" style="background-color:#fff;color:#24292e"><span data-line=""><span>IValidatableObject</span></span></code></span> interface. We could have completely not using the ModelState and create our own html helper with custom mechanism for validating across all layers. We could have add a layer of abstraction between Entity Framework and the service and to handle validation there. But at the end, having solution that are short and efficient seem to be better in my point of view. The current solution give a lot of flexibility concerning the validation and keep the code easy to maintain. In fact, add a validation are a two steps. First, where the validation should be coded? Second, adding the validation. I have seen patterns for validation that goes so beyond MVC and respect even more the single responsibility principle that adding a single validation take over 30 minutes. For me, this is not acceptable. Abstractions levels never should make the development of the code harder. In theory, adding levels of abstraction ain&#x27;t cost a thing, but in real enterprise code, where people have to maintain the code base, this can lead to problem.</p>
<p>The solution proposed here use layers previously defined without adding overhead to handle validation.</p>
<h1>Series Articles</h1>
<ul>
<li><a href="./enterprise-asp-net-part-1-mvc-the-planification">Article #1: Asp.Net MVC Enterprise Quality Web Application</a></li>
<li><a href="./enterprise-asp-net-mvc-part-2-building-the-model">Article #2: Asp.Net MVC Enterprise Quality Web Application Model</a></li>
<li><a href="./enterprise-asp-net-mvc-part-3-controller">Article #3: Asp.Net MVC Enterprise Quality Web Application Controller</a></li>
<li><a href="./enterprise-asp-net-mvc-part-4-repository">Article #4: Asp.Net MVC Enterprise Quality Web Repository Layer</a></li>
<li><a href="./enterprise-asp-net-mvc-part-5-database-context-and-impersonate-data">Article #5: Asp.Net MVC Enterprise Quality Web with Entity Framework</a></li>
<li><a href="./enterprise-asp-net-mvc-part-6-the-three-layers-of-validation">Article #6: Asp.Net MVC Enterprise Quality Layers</a></li>
<li><a href="./enterprise-asp-net-mvc-part-7-securing-action-with-role-authorization">Article #7: Asp.Net MVC Enterprise Quality Web Security</a></li>
</ul>
<p><a href="https://github.com/MrDesjardins/GymWorkout">Source code on GitHub</a></p></div></main><div class="layout_paginationBar__jnuuR"><div class="layout_paginationTitle__PsOw5">Chronological Blog Articles by Page</div><div class="layout_paginationLinks__LdBaH"><a class="" href="/blog/page/1">1</a><a class="" href="/blog/page/2">2</a><a class="" href="/blog/page/3">3</a><a class="" href="/blog/page/4">4</a><a class="" href="/blog/page/5">5</a><a class="" href="/blog/page/6">6</a><a class="" href="/blog/page/7">7</a><a class="" href="/blog/page/8">8</a><a class="" href="/blog/page/9">9</a><a class="" href="/blog/page/10">10</a><a class="" href="/blog/page/11">11</a><a class="" href="/blog/page/12">12</a><a class="" href="/blog/page/13">13</a><a class="" href="/blog/page/14">14</a><a class="" href="/blog/page/15">15</a><a class="" href="/blog/page/16">16</a><a class="" href="/blog/page/17">17</a><a class="" href="/blog/page/18">18</a><a class="" href="/blog/page/19">19</a><a class="" href="/blog/page/20">20</a><a class="" href="/blog/page/21">21</a><a class="" href="/blog/page/22">22</a><a class="" href="/blog/page/23">23</a><a class="" href="/blog/page/24">24</a><a class="" href="/blog/page/25">25</a><a class="" href="/blog/page/26">26</a><a class="" href="/blog/page/27">27</a><a class="" href="/blog/page/28">28</a><a class="" href="/blog/page/29">29</a><a class="" href="/blog/page/30">30</a><a class="" href="/blog/page/31">31</a><a class="" href="/blog/page/32">32</a><a class="" href="/blog/page/33">33</a><a class="" href="/blog/page/34">34</a><a class="" href="/blog/page/35">35</a><a class="" href="/blog/page/36">36</a><a class="" href="/blog/page/37">37</a><a class="" href="/blog/page/38">38</a><a class="" href="/blog/page/39">39</a><a class="" href="/blog/page/40">40</a><a class="" href="/blog/page/41">41</a><a class="" href="/blog/page/42">42</a><a class="" href="/blog/page/43">43</a><a class="" href="/blog/page/44">44</a><a class="" href="/blog/page/45">45</a><a class="" href="/blog/page/46">46</a><a class="" href="/blog/page/47">47</a><a class="" href="/blog/page/48">48</a><a class="" href="/blog/page/49">49</a><a class="" href="/blog/page/50">50</a><a class="" href="/blog/page/51">51</a><a class="" href="/blog/page/52">52</a><a class="" href="/blog/page/53">53</a><a class="" href="/blog/page/54">54</a><a class="" href="/blog/page/55">55</a><a class="" href="/blog/page/56">56</a><a class="" href="/blog/page/57">57</a><a class="" href="/blog/page/58">58</a><a class="" href="/blog/page/59">59</a><a class="" href="/blog/page/60">60</a><a class="" href="/blog/page/61">61</a><a class="" href="/blog/page/62">62</a><a class="" href="/blog/page/63">63</a><a class="" href="/blog/page/64">64</a><a class="" href="/blog/page/65">65</a><a class="" href="/blog/page/66">66</a><a class="" href="/blog/page/67">67</a><a class="" href="/blog/page/68">68</a><a class="" href="/blog/page/69">69</a><a class="" href="/blog/page/70">70</a><a class="" href="/blog/page/71">71</a><a class="" href="/blog/page/72">72</a><a class="" href="/blog/page/73">73</a><a class="" href="/blog/page/74">74</a><a class="" href="/blog/page/75">75</a><a class="" href="/blog/page/76">76</a><a class="" href="/blog/page/77">77</a></div></div></div></div><script src="/_next/static/chunks/webpack-c95d176287d2fe2d.js" crossorigin="" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0]);self.__next_f.push([2,null])</script><script>self.__next_f.push([1,"1:HL[\"/_next/static/css/4f3d065c9e2d01e0.css\",\"style\",{\"crossOrigin\":\"\"}]\n0:\"$L2\"\n"])</script><script>self.__next_f.push([1,"3:HL[\"/_next/static/media/c9a5bc6a7c948fb0-s.p.woff2\",\"font\",{\"crossOrigin\":\"\",\"type\":\"font/woff2\"}]\n4:HL[\"/_next/static/css/67b0a31e2d30ff16.css\",\"style\",{\"crossOrigin\":\"\"}]\n"])</script><script>self.__next_f.push([1,"5:I[7690,[],\"\"]\n8:I[5613,[],\"\"]\na:I[1778,[],\"\"]\nb:I[5250,[\"250\",\"static/chunks/250-d7e0a94ebe194dac.js\",\"79\",\"static/chunks/79-2d03397107aae3f1.js\",\"308\",\"static/chunks/app/blog/%5Bslug%5D/page-0cf4a8a9432ed6ce.js\"],\"\"]\nd:I[8955,[],\"\"]\n9:[\"slug\",\"enterprise-asp-net-mvc-part-6-the-three-layers-of-validation\",\"d\"]\ne:[]\n"])</script><script>self.__next_f.push([1,"2:[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/4f3d065c9e2d01e0.css\",\"precedence\":\"next\",\"crossOrigin\":\"\"}]],[\"$\",\"$L5\",null,{\"buildId\":\"ElOrBJ_xhnYIVNTz4dgO9\",\"assetPrefix\":\"\",\"initialCanonicalUrl\":\"/blog/enterprise-asp-net-mvc-part-6-the-three-layers-of-validation\",\"initialTree\":[\"\",{\"children\":[\"blog\",{\"children\":[[\"slug\",\"enterprise-asp-net-mvc-part-6-the-three-layers-of-validation\",\"d\"],{\"children\":[\"__PAGE__?{\\\"slug\\\":\\\"enterprise-asp-net-mvc-part-6-the-three-layers-of-validation\\\"}\",{}]}]}]},\"$undefined\",\"$undefined\",true],\"initialSeedData\":[\"\",{\"children\":[\"blog\",{\"children\":[[\"slug\",\"enterprise-asp-net-mvc-part-6-the-three-layers-of-validation\",\"d\"],{\"children\":[\"__PAGE__\",{},[\"$L6\",\"$L7\",null]]},[\"$\",\"$L8\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"blog\",\"children\",\"$9\",\"children\"],\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"loadingScripts\":\"$undefined\",\"hasLoading\":false,\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$La\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\",\"styles\":[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/67b0a31e2d30ff16.css\",\"precedence\":\"next\",\"crossOrigin\":\"\"}]]}]]},[\"$\",\"$L8\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"blog\",\"children\"],\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"loadingScripts\":\"$undefined\",\"hasLoading\":false,\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$La\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\",\"styles\":null}]]},[null,[\"$\",\"html\",null,{\"lang\":\"en\",\"children\":[\"$\",\"body\",null,{\"className\":\"layout_bodystyle__4ncsS\",\"children\":[\"$\",\"$L8\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\"],\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"loadingScripts\":\"$undefined\",\"hasLoading\":false,\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$La\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[\"$\",\"div\",null,{\"style\":{\"display\":\"flex\",\"alignItems\":\"center\",\"justifyContent\":\"center\",\"height\":\"100vh\"},\"children\":[\"$\",\"div\",null,{\"style\":{\"width\":\"50%\",\"height\":\"20%\",\"backgroundColor\":\"#ffeded\",\"borderRadius\":12,\"padding\":12,\"textAlign\":\"center\"},\"children\":[[\"$\",\"h1\",null,{\"children\":\"Not Found\"}],[\"$\",\"p\",null,{\"children\":\"Could not find requested resource\"}],[\"$\",\"$Lb\",null,{\"href\":\"/\",\"children\":\"Return Home\"}]]}]}],\"notFoundStyles\":[],\"styles\":null}]}]}],null]],\"initialHead\":[false,\"$Lc\"],\"globalErrorComponent\":\"$d\",\"missingSlots\":\"$We\"}]]\n"])</script><script>self.__next_f.push([1,"f:I[1749,[\"250\",\"static/chunks/250-d7e0a94ebe194dac.js\",\"79\",\"static/chunks/79-2d03397107aae3f1.js\",\"308\",\"static/chunks/app/blog/%5Bslug%5D/page-0cf4a8a9432ed6ce.js\"],\"Image\"]\nc:[[\"$\",\"meta\",\"0\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}],[\"$\",\"meta\",\"1\",{\"charSet\":\"utf-8\"}],[\"$\",\"title\",\"2\",{\"children\":\"Patrick Desjardins Blog - Enterprise Asp.Net MVC Part 6: The three layers of validation\"}],[\"$\",\"meta\",\"3\",{\"name\":\"description\",\"content\":\"Enterprise Asp.Net MVC Part 6: The three"])</script><script>self.__next_f.push([1," layers of validation\"}],[\"$\",\"meta\",\"4\",{\"name\":\"next-size-adjust\"}]]\n6:null\n10:T47b,"])</script><script>self.__next_f.push([1,"So far, the validation works fine but it doesn't handle the case that you need to validate across many entities. You can have case that you need to validate an entity dependently of the value of others entities. It can also be a validation from some value that are inside the database. Since Model doesn't have access to the repository, at this moment, we couldn't validate. To solve this problem, the second layer of validation is required and the perfect place it's in the Service layer. The reason is that this layer does have access to all entities and also have access to all repositories. Contrary to the first layer of validation, this one will require some manual explicit call for validation. The concrete implementation of this second layer of validation will be done with the Workout entity. What we want to implement is a validation that the active user cannot create more than 3 workouts per month without a premium account. That mean that we need to go check in the database the amount of workout for a specific user for a specific month. This couldn't be validate in the Workout class because it doesn't have access to the database."])</script><script>self.__next_f.push([1,"11:T404,"])</script><script>self.__next_f.push([1," interface. We could have completely not using the ModelState and create our own html helper with custom mechanism for validating across all layers. We could have add a layer of abstraction between Entity Framework and the service and to handle validation there. But at the end, having solution that are short and efficient seem to be better in my point of view. The current solution give a lot of flexibility concerning the validation and keep the code easy to maintain. In fact, add a validation are a two steps. First, where the validation should be coded? Second, adding the validation. I have seen patterns for validation that goes so beyond MVC and respect even more the single responsibility principle that adding a single validation take over 30 minutes. For me, this is not acceptable. Abstractions levels never should make the development of the code harder. In theory, adding levels of abstraction ain't cost a thing, but in real enterprise code, where people have to maintain the code base, this can lead to problem."])</script><script>self.__next_f.push([1,"7:[\"$\",\"div\",null,{\"className\":\"__className_aaf875\",\"children\":[\"$\",\"div\",null,{\"className\":\"layout_container__Tovb9\",\"children\":[[\"$\",\"header\",null,{\"className\":\"layout_siteTitle__k5U8g\",\"children\":\"Patrick Desjardins Blog\"}],[\"$\",\"nav\",null,{\"children\":[\"$\",\"ul\",null,{\"className\":\"layout_navLinks__mf70r\",\"children\":[\"$\",\"li\",null,{\"className\":\"layout_navLinkItem__1L8fB\",\"children\":[[\"$\",\"$Lb\",null,{\"className\":\"layout_navLinkText__bt28R\",\"href\":\"/\",\"children\":\"Main Page\"}],[\"$\",\"$Lb\",null,{\"className\":\"layout_navLinkText__bt28R\",\"href\":\"/blog\",\"children\":\"Blog\"}],[[\"$\",\"$Lb\",\"2024\",{\"className\":\"layout_navLinkText__bt28R\",\"href\":\"/blog/for/2024\",\"children\":2024}],[\"$\",\"$Lb\",\"2023\",{\"className\":\"layout_navLinkText__bt28R\",\"href\":\"/blog/for/2023\",\"children\":2023}],[\"$\",\"$Lb\",\"2022\",{\"className\":\"layout_navLinkText__bt28R\",\"href\":\"/blog/for/2022\",\"children\":2022}],[\"$\",\"$Lb\",\"2021\",{\"className\":\"layout_navLinkText__bt28R\",\"href\":\"/blog/for/2021\",\"children\":2021}],[\"$\",\"$Lb\",\"2020\",{\"className\":\"layout_navLinkText__bt28R\",\"href\":\"/blog/for/2020\",\"children\":2020}],[\"$\",\"$Lb\",\"2019\",{\"className\":\"layout_navLinkText__bt28R\",\"href\":\"/blog/for/2019\",\"children\":2019}],[\"$\",\"$Lb\",\"2018\",{\"className\":\"layout_navLinkText__bt28R\",\"href\":\"/blog/for/2018\",\"children\":2018}],[\"$\",\"$Lb\",\"2017\",{\"className\":\"layout_navLinkText__bt28R\",\"href\":\"/blog/for/2017\",\"children\":2017}],[\"$\",\"$Lb\",\"2016\",{\"className\":\"layout_navLinkText__bt28R\",\"href\":\"/blog/for/2016\",\"children\":2016}],[\"$\",\"$Lb\",\"2015\",{\"className\":\"layout_navLinkText__bt28R\",\"href\":\"/blog/for/2015\",\"children\":2015}],[\"$\",\"$Lb\",\"2014\",{\"className\":\"layout_navLinkText__bt28R\",\"href\":\"/blog/for/2014\",\"children\":2014}],[\"$\",\"$Lb\",\"2013\",{\"className\":\"layout_navLinkText__bt28R\",\"href\":\"/blog/for/2013\",\"children\":2013}],[\"$\",\"$Lb\",\"2012\",{\"className\":\"layout_navLinkText__bt28R\",\"href\":\"/blog/for/2012\",\"children\":2012}],[\"$\",\"$Lb\",\"2011\",{\"className\":\"layout_navLinkText__bt28R\",\"href\":\"/blog/for/2011\",\"children\":2011}]]]}]}]}],[\"$\",\"div\",null,{\"className\":\"layout_blogPictureContainer__XC7nK\",\"children\":[\"$\",\"$Lf\",null,{\"className\":\"layout_blogTopPicture__RJHNN\",\"alt\":\"Patrick Desjardins picture from a conference\",\"src\":\"/images/backgrounds/patrickdesjardins_conference_bw.jpeg\",\"width\":800,\"height\":260}]}],[\"$\",\"main\",null,{\"className\":\"layout_main__mXTwS\",\"children\":[[\"$\",\"h1\",null,{\"children\":\"Enterprise Asp.Net MVC Part 6: The three layers of validation\"}],[\"$\",\"div\",null,{\"className\":\"layout_blogPostContainer__WYELx\",\"children\":[[\"$\",\"p\",null,{\"className\":\"layout_blogPostDate__LUvx5\",\"children\":[\"Posted on: \",\"2012-11-07\"]}],[[\"$\",\"p\",null,{\"children\":\"Validations is definitely a serious subject. If no validation is made, then the system is compromise. Whatever the architecture, whatever the hardware setup and whatever the idea of the product, you need to implement validations to protect your system. This is why it must be taken seriously.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"By default, Asp.Net MVC handles validation and also \",[\"$\",\"a\",null,{\"href\":\"./model-validation-and-entity-framework-4-3\",\"children\":\"Entity Framework uses the same interface to handle validation\"}],\" entities. So, why not use what is already in place and not try to reinvent the wheel. In fact, we follow the \",[\"$\",\"a\",null,{\"href\":\"http://en.wikipedia.org/wiki/KISS_principle\",\"children\":\"KISS\"}],\" principle.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Here is an overview of the article in a single image.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"img\",null,{\"src\":\"/images/blog/Validation-265x400.png\",\"alt\":\"\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"We have 3 layers of validation. The first layer and third layer are built-in with .Net with the \",[\"$\",\"a\",null,{\"href\":\"./how-to-validate-model-object-with-asp-net-mvc-correctly\",\"children\":\"IValidatableObject interface\"}],\". I have \",[\"$\",\"a\",null,{\"href\":\"./how-to-validate-model-object-with-asp-net-mvc-correctly\",\"children\":\"already\"}],\" discussed about this interface for validating entity but I'll show you how to use it in a more \\\"enterprise way\\\".\"]}],\"\\n\",[\"$\",\"h1\",null,{\"children\":\"Using IValidatableObject\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"This interface lets you have a single method called \",[\"$\",\"em\",null,{\"children\":\"Validate\"}],\" which lets you return error message linked to a property method. If you want a general error, you can also specify an empty string for the property name. Simple? Yes. Powerful? Even more! The framework know this interface and it automatically uses the validation when the model is bound from a Http request to your view model by the Model Binder. The .Net framework automatically call this method when Entity Framework try to save entities to the database. This mean that you have nothing to do, but to add your business logic validation.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"From here, it's interesting to force every model to have this interface and this is why a good place to inherit from \",[\"$\",\"em\",null,{\"children\":\"IValidatableObject\"}],\" is in the BaseModel.\"]}],\"\\n\",[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"backgroundColor\":\"#fff\",\"color\":\"#24292e\"},\"tabIndex\":\"0\",\"data-language\":\"csharp\",\"data-theme\":\"github-light\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"csharp\",\"data-theme\":\"github-light\",\"style\":{\"display\":\"grid\"},\"children\":[[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" abstract\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" class\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" BaseModel\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" : \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"IValidatableObject\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" const\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" int\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" NOT_INITIALIZED\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" -\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005CC5\"},\"children\":\"1\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" int\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" Id\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"get\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"set\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; }\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":\" \"}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"#\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"region\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032F62\"},\"children\":\" Implementation of IValidatableObject\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":\" \"}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" abstract\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" IEnumerable\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"ValidationResult\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Validate\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"ValidationContext\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" validationContext\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\");\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":\" \"}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"#\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"endregion\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":\" \"}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"}\"}]}]]}]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Every model have to define the \",[\"$\",\"em\",null,{\"children\":\"Validate\"}],\" method. If no validation is required, the method is simply empty. Let's go back with the Workout entity and add some validations.\"]}],\"\\n\",[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"backgroundColor\":\"#fff\",\"color\":\"#24292e\"},\"tabIndex\":\"0\",\"data-language\":\"csharp\",\"data-theme\":\"github-light\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"csharp\",\"data-theme\":\"github-light\",\"style\":{\"display\":\"grid\"},\"children\":[[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" class\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" Workout\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" : \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"BaseModel\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\", \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"IUserOwnable\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" {\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"  public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" DateTime\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" StartTime\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"get\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"set\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; }\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"  public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" DateTime\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"? \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"EndTime\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"get\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"set\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; }\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"  public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" string\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" Name\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"get\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"set\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; }\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"  public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" string\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" Goal\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"get\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"set\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; }\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"  public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" ICollection\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"WorkoutSession\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Sessions\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"get\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"set\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; }\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":\" \"}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"  public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" override\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" IEnumerable\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"ValidationResult\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Validate\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"ValidationContext\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" validationContext\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\") {\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"    if\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" (\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"string\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"IsNullOrEmpty\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(Name)) {\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"      yield\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" return\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" new\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" ValidationResult\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032F62\"},\"children\":\"\\\"Name is mandatory\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\", \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"new\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"[] {\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032F62\"},\"children\":\"\\\"Name\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"});\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"    }\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"    if\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" (EndTime.HasValue) {\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"      if\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" (StartTime \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"\u003e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" EndTime.Value) {\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"        yield\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" return\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" new\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" ValidationResult\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032F62\"},\"children\":\"\\\"EndTime must be after the StartTime\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\", \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"new\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"[] {\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032F62\"},\"children\":\"\\\"StartTime\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\", \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032F62\"},\"children\":\"\\\"EndTime\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"});\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"      }\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"    }\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"  }\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":\" \"}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"  #\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"region\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032F62\"},\"children\":\" Implementation of IUserOwnable\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":\" \"}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"  public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" int\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" UserId\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"get\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"set\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; }\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":\" \"}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"  #\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"endregion\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"}\"}]}]]}]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Every time we have an error we return a \",[\"$\",\"span\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"plaintext\",\"data-theme\":\"github-light\",\"style\":{\"backgroundColor\":\"#fff\",\"color\":\"#24292e\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"ValidationResult\"}]}]}]}],\". We specify a message and an array of properties that are concerned by the error. In this example, the name is validated and the EndTime property too but only when this one is specified.\"]}],\"\\n\",[\"$\",\"h1\",null,{\"children\":\"The first layer of validation : Model Binding inside the controller\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"We have implemented the \",[\"$\",\"span\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"plaintext\",\"data-theme\":\"github-light\",\"style\":{\"backgroundColor\":\"#fff\",\"color\":\"#24292e\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"IValidatableObject\"}]}]}]}],\" and when a Http request is done to the server, the controller bind the data to the model. Since we are using the ViewModel approach, this validation is not triggered! But, since we have a BaseController and already have defined the new approach of having the model to be automapped automatically it hooks the validation and apply it when the ViewModel is mapped to the Model. (You have to go read previous post of \\\"Business\\\" category to understand why it's automatically mapped.)\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"The first modification occurs in the override method \",[\"$\",\"em\",null,{\"children\":\"OnActionExecuting\"}],\" that should be already overrided with the modification of the mapper. We simply need to check if the model bound is really a IValidatableObject and to trig the validation mechanism.\"]}],\"\\n\",[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"backgroundColor\":\"#fff\",\"color\":\"#24292e\"},\"tabIndex\":\"0\",\"data-language\":\"csharp\",\"data-theme\":\"github-light\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"csharp\",\"data-theme\":\"github-light\",\"style\":{\"display\":\"grid\"},\"children\":[[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"protected\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" override\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" void\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" OnActionExecuting\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"ActionExecutingContext\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" filterContext\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\") {\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#005CC5\"},\"children\":\"  base\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"OnActionExecuting\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(filterContext); \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"if\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(filterContext.ActionParameters.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Any\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"()) {\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"    var\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" possibleViewModel\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" filterContext.ActionParameters.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"FirstOrDefault\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"x\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" =\u003e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" x.Value.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"GetType\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"() \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"==\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" typeof\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"TViewModel\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"));\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"    if\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" (possibleViewModel.Value\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"!=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005CC5\"},\"children\":\"null\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\") {\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"      var\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" viewModel\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" (\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"TViewModel\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\") possibleViewModel.Value;\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"      var\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" model\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" (\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"TModel\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\") Activator.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"CreateInstance\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"typeof\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" (\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"TModel\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"));\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"      Model \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"_mapperFactory.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Map\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(viewModel, model);\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"      ApplyOwnership\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"();\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"      ApplyErrorsToModelState\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"();\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"    }\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"  }\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"}\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":\" \"}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"private\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" void\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" ApplyErrorsToModelState\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"() {\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"  if\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" (Model \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"is\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" IValidatableObject\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\") {\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"    var\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" errors\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" (Model \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"as\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" IValidatableObject\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\").\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Validate\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"new\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" ValidationContext\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005CC5\"},\"children\":\"this\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"));\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"    foreach\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" (\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"var\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" validationResult\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" in\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" errors) {\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"      foreach\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" (\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"var\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" memberName\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" in\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" validationResult.MemberNames) {\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"        ModelState.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"AddModelError\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(memberName, validationResult.ErrorMessage);\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"      }\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"    }\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"  }\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"}\"}]}]]}]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"What we are doing is a general method that works for any entities. We verify if the Model bound from the ViewModel is really inherited from a \",[\"$\",\"span\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"plaintext\",\"data-theme\":\"github-light\",\"style\":{\"backgroundColor\":\"#fff\",\"color\":\"#24292e\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"IValidatableObject\"}]}]}]}],\". From here, we do what the framework would do if we weren't using view model : calling the Validate method of the interface. We then loop all error and assign everything to the ModelState. This will give us the possibility to act like if no view model has been used.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"The code above about the method \\\"ApplyErrorsToModelState\\\" could be replaced with the code below to be able to validate the \",[\"$\",\"span\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"plaintext\",\"data-theme\":\"github-light\",\"style\":{\"backgroundColor\":\"#fff\",\"color\":\"#24292e\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"data annotation\"}]}]}]}],\" AND also the \",[\"$\",\"span\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"plaintext\",\"data-theme\":\"github-light\",\"style\":{\"backgroundColor\":\"#fff\",\"color\":\"#24292e\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"IValidatableObject\"}]}]}]}],\" interface.\"]}],\"\\n\",[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"backgroundColor\":\"#fff\",\"color\":\"#24292e\"},\"tabIndex\":\"0\",\"data-language\":\"csharp\",\"data-theme\":\"github-light\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"csharp\",\"data-theme\":\"github-light\",\"style\":{\"display\":\"grid\"},\"children\":[[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" private\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" void\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" ApplyErrorsToModelState\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"() { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"ModelMetadata\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" metadata\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" ModelMetadataProviders.Current.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"GetMetadataForType\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(() \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\u003e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" Model, Model.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"GetType\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"());\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":\" \"}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"foreach\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" (\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"ModelValidationResult\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" validationResult\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" in\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" ModelValidator.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"GetModelValidator\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(metadata, \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005CC5\"},\"children\":\"this\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\".ControllerContext).\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Validate\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005CC5\"},\"children\":\"null\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\")) { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"var\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" propertyName\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" validationResult.MemberName; ModelState.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"AddModelError\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(propertyName, validationResult.Message); } }\"}]]}]]}]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"The code above validate the data annotation and the IValidatableObject. This can be used in a scenario where you need to have deeper validation process. For example here is the same code as above with enhanced validation on the mapping. This required to have split both validation.\"}],\"\\n\",[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"backgroundColor\":\"#fff\",\"color\":\"#24292e\"},\"tabIndex\":\"0\",\"data-language\":\"csharp\",\"data-theme\":\"github-light\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"csharp\",\"data-theme\":\"github-light\",\"style\":{\"display\":\"grid\"},\"children\":[[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"private\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" void\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" ApplyErrorsToModelState\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"TModel\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" model\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\", \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"TViewModel\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" viewModel\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\") {\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#6A737D\"},\"children\":\"  //Data Annotation validation\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"  ICollection\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"ValidationResult\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"result\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"  ValidateDataAnnotation\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(model, \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"out\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" result);\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"  foreach\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" (\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"ValidationResult\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" validationResult\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" in\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" result) {\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"    foreach\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" (\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"string\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" memberName\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" in\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" validationResult.MemberNames) {\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"      ModelState.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"AddModelError\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(memberName, validationResult.ErrorMessage);\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"    }\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"    }\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#6A737D\"},\"children\":\"  //IValidatableObject validation\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"  if\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" (Model \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"is\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" IValidatableObject\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\") {\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"    IEnumerable\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"ValidationResult\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"errors\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" (Model \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"as\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" IValidatableObject\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\").\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Validate\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"new\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" ValidationContext\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005CC5\"},\"children\":\"this\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"));\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"    foreach\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" (\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"ValidationResult\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" validationResult\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" in\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" errors) {\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"      if\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" (validationResult \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"is\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" EnhancedMappedValidationResult\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"TModel\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e) {\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"          var\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" enhanced\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" (\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"EnhancedMappedValidationResult\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"TModel\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e)validationResult;\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"          var\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" viewModelPropertyName\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"_mapperFactory.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"GetMapper\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(model, viewModel).\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"GetErrorPropertyMappedFor\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(enhanced.Property); ModelState.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"AddModelError\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(viewModelPropertyName, validationResult.ErrorMessage);\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"      } \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"else\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" {\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"        if\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" (validationResult.MemberNames.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Any\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"()) {\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"          foreach\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" (\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"string\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" memberName\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" in\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" validationResult.MemberNames) {\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"            ModelState.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"AddModelError\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(memberName, validationResult.ErrorMessage);\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"          }\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"        } \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"else\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" {\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"          ModelState.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"AddModelError\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"string\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\".Empty, validationResult.ErrorMessage);\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"        }\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"      }\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"    }\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"  }\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#6A737D\"},\"children\":\"  /* //This validate underlying entity which can be not fully loaded in the case of reference ModelMetadata metadata = ModelMetadataProviders.Current.GetMetadataForType(() =\u003e Model, Model.GetType());\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":\" \"}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#6A737D\"},\"children\":\"  foreach (ModelValidationResult validationResult in ModelValidator.GetModelValidator(metadata, this.ControllerContext).Validate(null)) { \"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#6A737D\"},\"children\":\"    var propertyName = validationResult.MemberName; \"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#6A737D\"},\"children\":\"    ModelState.AddModelViewModelToErrorsMap(propertyName, validationResult.Message); \"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#6A737D\"},\"children\":\"  }\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#6A737D\"},\"children\":\"  */\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"}\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":\" \"}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"  private\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" bool\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" ValidateDataAnnotation\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"object\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" entity\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\", \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"out\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" ICollection\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"ValidationResult\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"results\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\") {\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"    var\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" context\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" new\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" ValidationContext\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(entity);\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"    results \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" new\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" List\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"ValidationResult\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e();\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"    return\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" Validator.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"TryValidateObject\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(entity, context, results, \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005CC5\"},\"children\":\"true\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\");\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"  }\"}]}]]}]}]}],\"\\n\",[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"backgroundColor\":\"#fff\",\"color\":\"#24292e\"},\"tabIndex\":\"0\",\"data-language\":\"csharp\",\"data-theme\":\"github-light\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"csharp\",\"data-theme\":\"github-light\",\"style\":{\"display\":\"grid\"},\"children\":[[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" [\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"HttpPost\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"] \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" ActionResult\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" Create\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"WorkoutViewModel\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" viewModel\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\") { \"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"  if\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" (ModelState.IsValid) \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6A737D\"},\"children\":\"//This is the default Asp.Net MVC way to validate entity \"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"  { \"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#6A737D\"},\"children\":\"    //Save the entity\"}]}]]}]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"This is great because it's the default way to validate object that has been bound in MVC. The \",[\"$\",\"em\",null,{\"children\":\"IsValid\"}],\" doesn't only validate our business logic but also validate all data annotation that could have been set. It's even greater because people that are used to use the ModelState for validation won't have to learn a new way to act with controllers because it's the same.\"]}],\"\\n\",[\"$\",\"h1\",null,{\"children\":\"The second layer of validation : Service layer\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"$10\"}],\"\\n\",[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"backgroundColor\":\"#fff\",\"color\":\"#24292e\"},\"tabIndex\":\"0\",\"data-language\":\"csharp\",\"data-theme\":\"github-light\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"csharp\",\"data-theme\":\"github-light\",\"style\":{\"display\":\"grid\"},\"children\":[[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" int\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" Create\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Workout\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" model\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\") { \"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"  int\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" amountWorkout\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" Repository.Workout.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"GetAmountWorkoutForCurrentMonth\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(); \"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"  if\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" (amountWorkout\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"\u003e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005CC5\"},\"children\":\"3\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\")\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6A737D\"},\"children\":\"//More than 3 workouts done without premium account \"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"  { \"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"    throw\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" new\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" ValidationErrors\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"new\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" GeneralError\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032F62\"},\"children\":\"\\\"You have reach the limit of 3 workouts per month, you need premium or wait the next month\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\")); \"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"  } \"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"  return\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" Repository.Workout.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Insert\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(model); \"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"}\"}]}]]}]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"This get the amount of workout for the month and if it's over a certain threshold will raise the error.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"The error is handled by the controller that verify that the action executed has been completed without error. Here is the Create action of the Workout controller with the first layer validation and with the catch for the second layer.\"}],\"\\n\",[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"backgroundColor\":\"#fff\",\"color\":\"#24292e\"},\"tabIndex\":\"0\",\"data-language\":\"csharp\",\"data-theme\":\"github-light\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"csharp\",\"data-theme\":\"github-light\",\"style\":{\"display\":\"grid\"},\"children\":[[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"[\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"HttpPost\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"] \"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" ActionResult\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" Create\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"WorkoutViewModel\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" viewModel\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\") { \"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"  if\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" (ModelState.IsValid) { \"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"    try\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" {_service.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Create\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(Model); } \"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"    catch\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" (\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"ValidationErrors\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" propertyErrors\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\") { \"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"      ModelState.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"AddValidationErrors\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(propertyErrors); \"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"    } \"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"  } \"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"  return\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" View\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032F62\"},\"children\":\"\\\"Create\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"); \"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"}\"}]}]]}]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"The exception type is ValidationErrors which is our custom error handler. The reason is that we do not want to use specific exception from other layers. This is why cross layers classes will be used to transport exception through all layers. This will be discussed after the third layer of validation.\"}],\"\\n\",[\"$\",\"h1\",null,{\"children\":\"The third layer of validation : Persistence layer\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"The persistence layer is where the call to the database is done. This is an automatic validation with Entity Framework that call the \",[\"$\",\"span\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"plaintext\",\"data-theme\":\"github-light\",\"style\":{\"backgroundColor\":\"#fff\",\"color\":\"#24292e\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"IValidatableObject\"}]}]}]}],\" interface of the entity before save it to the database.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"But, since we do not want to raise a \",[\"$\",\"span\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"plaintext\",\"data-theme\":\"github-light\",\"style\":{\"backgroundColor\":\"#fff\",\"color\":\"#24292e\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"DbEntityValidationResult\"}]}]}]}],\" up to the controller (because it's a class that belong to Entity Framework (System.Data.Entity.Validation), we will use our own exception classes.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"We will create an interface that will hold the property name in error and also the error message.\"}],\"\\n\",[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"backgroundColor\":\"#fff\",\"color\":\"#24292e\"},\"tabIndex\":\"0\",\"data-language\":\"csharp\",\"data-theme\":\"github-light\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"csharp\",\"data-theme\":\"github-light\",\"style\":{\"display\":\"grid\"},\"children\":[[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" interface\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" IBaseError\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" { \"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"  string\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" PropertyName\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"get\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; } \"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"  string\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" PropertyExceptionMessage\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"get\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; } \"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"}\"}]}]]}]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Two classes will inherit from this interface. One for a property error and one for a general error.\"}],\"\\n\",[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"backgroundColor\":\"#fff\",\"color\":\"#24292e\"},\"tabIndex\":\"0\",\"data-language\":\"csharp\",\"data-theme\":\"github-light\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"csharp\",\"data-theme\":\"github-light\",\"style\":{\"display\":\"grid\"},\"children\":[[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" class\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" PropertyError\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\":\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"IBaseError\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" { \"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"  public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" string\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" PropertyName\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"get\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"set\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; } \"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"  public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" string\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" PropertyExceptionMessage\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"get\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"set\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; } \"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"  public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" PropertyError\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"string\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" propertyName\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\", \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"string\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" errorMessage\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\") { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005CC5\"},\"children\":\"this\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\".PropertyName \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" propertyName; \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005CC5\"},\"children\":\"this\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\".PropertyExceptionMessage \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" errorMessage; } \"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"}\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":\" \"}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" class\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" GeneralError\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\":\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"IBaseError\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" { \"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"  #\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"region\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032F62\"},\"children\":\" Implementation of IBaseError\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":\" \"}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"  public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" string\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" PropertyName\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"get\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" {\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"return\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" string\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\".Empty; }} \"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"  public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" string\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" PropertyExceptionMessage\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"get\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"set\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; }\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"  public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" GeneralError\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"string\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" errorMessage\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\") { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005CC5\"},\"children\":\"this\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\".PropertyExceptionMessage \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" errorMessage; }\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":\" \"}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"  #\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"endregion\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" \"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"}\"}]}]]}]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Then, we add the interface \",[\"$\",\"em\",null,{\"children\":\"IValidationErrors\"}],\" which holds all \",[\"$\",\"em\",null,{\"children\":\"IBaseError\"}],\" to be send back through all layers.\"]}],\"\\n\",[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"backgroundColor\":\"#fff\",\"color\":\"#24292e\"},\"tabIndex\":\"0\",\"data-language\":\"csharp\",\"data-theme\":\"github-light\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"csharp\",\"data-theme\":\"github-light\",\"style\":{\"display\":\"grid\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" interface\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" IValidationErrors\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"List\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"IBaseError\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Errors\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"get\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"set\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; } }\"}]]}]}]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"The first implementation can be used anywhere, like in the service layers.\"}],\"\\n\",[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"backgroundColor\":\"#fff\",\"color\":\"#24292e\"},\"tabIndex\":\"0\",\"data-language\":\"csharp\",\"data-theme\":\"github-light\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"csharp\",\"data-theme\":\"github-light\",\"style\":{\"display\":\"grid\"},\"children\":[[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" class\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" ValidationErrors\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" : \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Exception\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\", \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"IValidationErrors\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" { \"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"  public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" List\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"IBaseError\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Errors\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"get\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"set\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; } \"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"  public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" ValidationErrors\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"() { Errors \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" new\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" List\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"IBaseError\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e(); }\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":\" \"}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"  public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" ValidationErrors\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"IBaseError\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" error\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"): \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005CC5\"},\"children\":\"this\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"() { \"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"    Errors.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Add\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(error); \"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"  }\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":\" \"}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"}\"}]}]]}]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"The second is more specific to database.\"}],\"\\n\",[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"backgroundColor\":\"#fff\",\"color\":\"#24292e\"},\"tabIndex\":\"0\",\"data-language\":\"csharp\",\"data-theme\":\"github-light\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"csharp\",\"data-theme\":\"github-light\",\"style\":{\"display\":\"grid\"},\"children\":[[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" class\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" DatabaseValidationErrors\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" : \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"ValidationErrors\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" { \"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"  public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" DatabaseValidationErrors\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"IEnumerable\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"DbEntityValidationResult\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"errors\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"):\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005CC5\"},\"children\":\"base\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"() { \"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"    foreach\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" (\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"var\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" err\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" in\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" errors.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"SelectMany\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"dbEntityValidationResult\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" =\u003e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" dbEntityValidationResult.ValidationErrors)) { \"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"      Errors.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Add\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"new\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" PropertyError\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(err.PropertyName,err.ErrorMessage)); \"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"    } \"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"  } \"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"}\"}]}]]}]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"The last one is used by the repository. In fact, when we \",[\"$\",\"span\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"plaintext\",\"data-theme\":\"github-light\",\"style\":{\"backgroundColor\":\"#fff\",\"color\":\"#24292e\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"SaveChanges()\"}]}]}]}],\" to the database, we need to validate before Entity Framework executes the \",[\"$\",\"span\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"plaintext\",\"data-theme\":\"github-light\",\"style\":{\"backgroundColor\":\"#fff\",\"color\":\"#24292e\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"SaveChanges\"}]}]}]}],\". Of course, we could let Entity Framework but we would have to catch the exception. Since they are a way without having to catch an exception, I prefer to use it.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"If you remember correctly, our \",[\"$\",\"span\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"plaintext\",\"data-theme\":\"github-light\",\"style\":{\"backgroundColor\":\"#fff\",\"color\":\"#24292e\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"DatabaseContext\"}]}]}]}],\" inherits from \",[\"$\",\"span\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"plaintext\",\"data-theme\":\"github-light\",\"style\":{\"backgroundColor\":\"#fff\",\"color\":\"#24292e\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"IDatabaseContext\"}]}]}]}],\" which have \",[\"$\",\"span\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"plaintext\",\"data-theme\":\"github-light\",\"style\":{\"backgroundColor\":\"#fff\",\"color\":\"#24292e\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"SaveChanges()\"}]}]}]}],\" method. We simply need to override this one instead of relying on the one from \",[\"$\",\"span\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"plaintext\",\"data-theme\":\"github-light\",\"style\":{\"backgroundColor\":\"#fff\",\"color\":\"#24292e\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"DbContext\"}]}]}]}],\" and call the DbContext one if everything is fine.\"]}],\"\\n\",[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"backgroundColor\":\"#fff\",\"color\":\"#24292e\"},\"tabIndex\":\"0\",\"data-language\":\"csharp\",\"data-theme\":\"github-light\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"csharp\",\"data-theme\":\"github-light\",\"style\":{\"display\":\"grid\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" override\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" int\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" SaveChanges\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"() { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"var\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" errors\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005CC5\"},\"children\":\" this\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"GetValidationErrors\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(); \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"if\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" (\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"!\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"errors.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Any\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"()) { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"return\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005CC5\"},\"children\":\" base\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"SaveChanges\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(); } \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"else\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"throw\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" new\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" DatabaseValidationErrors\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(errors); } }\"}]]}]}]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"The exception thrown will loop all errors and be trig to a higher level. In fact, this exception is raised to the service layer which doesn't handle the exception. So, the exception will be raised to the controller layer. This is the same patch of exception than having an exception thrown from the service in the layer 2 because of business logic validation! We are reusing the same mechanism and this is possible because of the exceptions classes we have created which are abstracted with interface.\"}],\"\\n\",[\"$\",\"h1\",null,{\"children\":\"Model State and custom exceptions classes\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"If you remember, the controller does have a catch for ValidationErrors.\"}],\"\\n\",[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"backgroundColor\":\"#fff\",\"color\":\"#24292e\"},\"tabIndex\":\"0\",\"data-language\":\"csharp\",\"data-theme\":\"github-light\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"csharp\",\"data-theme\":\"github-light\",\"style\":{\"display\":\"grid\"},\"children\":[[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#6A737D\"},\"children\":\" //... \"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"catch\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" (\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"ValidationErrors\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" propertyErrors\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\") { \"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"  ModelState.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"AddValidationErrors\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(propertyErrors); \"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"}\"}]}]]}]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"By default, the model state doesn't have this method that accept our interface IValidationErrors. This is an extension method.\"}],\"\\n\",[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"backgroundColor\":\"#fff\",\"color\":\"#24292e\"},\"tabIndex\":\"0\",\"data-language\":\"csharp\",\"data-theme\":\"github-light\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"csharp\",\"data-theme\":\"github-light\",\"style\":{\"display\":\"grid\"},\"children\":[[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" static\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" class\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" ControllersExtensions\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" { \"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"  public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" static\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" void\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" AddValidationErrors\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"this\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" ModelStateDictionary\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" modelState\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\", \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"IValidationErrors\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" propertyErrors\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\") { \"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"    foreach\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" (\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"var\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" databaseValidationError\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" in\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" propertyErrors.Errors) { \"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"      modelState.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"AddModelError\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(databaseValidationError.PropertyName, databaseValidationError.PropertyExceptionMessage); \"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"    } \"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"  } \"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"}\"}]}]]}]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Using \",[\"$\",\"span\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"plaintext\",\"data-theme\":\"github-light\",\"style\":{\"backgroundColor\":\"#fff\",\"color\":\"#24292e\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"IValidationErrors\"}]}]}]}],\" lets handle errors from the service layer or the database error. In fact, at this point, it doesn't really matter because we want to loop through all exceptions and to use the model state to attach doesn't exception to the correct property (or if general exception to the string.empty which will be a global error message).\"]}],\"\\n\",[\"$\",\"h1\",null,{\"children\":\"Conclusion\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Validation of the model could be more complex. It could have been used external classes for each validation. We could have create our own system for validation message and not using the \",[\"$\",\"span\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"plaintext\",\"data-theme\":\"github-light\",\"style\":{\"backgroundColor\":\"#fff\",\"color\":\"#24292e\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"IValidatableObject\"}]}]}]}],\"$11\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"The solution proposed here use layers previously defined without adding overhead to handle validation.\"}],\"\\n\",[\"$\",\"h1\",null,{\"children\":\"Series Articles\"}],\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[\"$\",\"a\",null,{\"href\":\"./enterprise-asp-net-part-1-mvc-the-planification\",\"children\":\"Article #1: Asp.Net MVC Enterprise Quality Web Application\"}]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"$\",\"a\",null,{\"href\":\"./enterprise-asp-net-mvc-part-2-building-the-model\",\"children\":\"Article #2: Asp.Net MVC Enterprise Quality Web Application Model\"}]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"$\",\"a\",null,{\"href\":\"./enterprise-asp-net-mvc-part-3-controller\",\"children\":\"Article #3: Asp.Net MVC Enterprise Quality Web Application Controller\"}]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"$\",\"a\",null,{\"href\":\"./enterprise-asp-net-mvc-part-4-repository\",\"children\":\"Article #4: Asp.Net MVC Enterprise Quality Web Repository Layer\"}]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"$\",\"a\",null,{\"href\":\"./enterprise-asp-net-mvc-part-5-database-context-and-impersonate-data\",\"children\":\"Article #5: Asp.Net MVC Enterprise Quality Web with Entity Framework\"}]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"$\",\"a\",null,{\"href\":\"./enterprise-asp-net-mvc-part-6-the-three-layers-of-validation\",\"children\":\"Article #6: Asp.Net MVC Enterprise Quality Layers\"}]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"$\",\"a\",null,{\"href\":\"./enterprise-asp-net-mvc-part-7-securing-action-with-role-authorization\",\"children\":\"Article #7: Asp.Net MVC Enterprise Quality Web Security\"}]}],\"\\n\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"a\",null,{\"href\":\"https://github.com/MrDesjardins/GymWorkout\",\"children\":\"Source code on GitHub\"}]}]]]}]]}],[\"$\",\"div\",null,{\"className\":\"layout_paginationBar__jnuuR\",\"children\":[[\"$\",\"div\",null,{\"className\":\"layout_paginationTitle__PsOw5\",\"children\":\"Chronological Blog Articles by Page\"}],[\"$\",\"div\",null,{\"className\":\"layout_paginationLinks__LdBaH\",\"children\":[[\"$\",\"$Lb\",\"1\",{\"className\":\"\",\"href\":\"/blog/page/1\",\"children\":1}],[\"$\",\"$Lb\",\"2\",{\"className\":\"\",\"href\":\"/blog/page/2\",\"children\":2}],[\"$\",\"$Lb\",\"3\",{\"className\":\"\",\"href\":\"/blog/page/3\",\"children\":3}],[\"$\",\"$Lb\",\"4\",{\"className\":\"\",\"href\":\"/blog/page/4\",\"children\":4}],[\"$\",\"$Lb\",\"5\",{\"className\":\"\",\"href\":\"/blog/page/5\",\"children\":5}],[\"$\",\"$Lb\",\"6\",{\"className\":\"\",\"href\":\"/blog/page/6\",\"children\":6}],[\"$\",\"$Lb\",\"7\",{\"className\":\"\",\"href\":\"/blog/page/7\",\"children\":7}],[\"$\",\"$Lb\",\"8\",{\"className\":\"\",\"href\":\"/blog/page/8\",\"children\":8}],[\"$\",\"$Lb\",\"9\",{\"className\":\"\",\"href\":\"/blog/page/9\",\"children\":9}],[\"$\",\"$Lb\",\"10\",{\"className\":\"\",\"href\":\"/blog/page/10\",\"children\":10}],[\"$\",\"$Lb\",\"11\",{\"className\":\"\",\"href\":\"/blog/page/11\",\"children\":11}],[\"$\",\"$Lb\",\"12\",{\"className\":\"\",\"href\":\"/blog/page/12\",\"children\":12}],[\"$\",\"$Lb\",\"13\",{\"className\":\"\",\"href\":\"/blog/page/13\",\"children\":13}],[\"$\",\"$Lb\",\"14\",{\"className\":\"\",\"href\":\"/blog/page/14\",\"children\":14}],[\"$\",\"$Lb\",\"15\",{\"className\":\"\",\"href\":\"/blog/page/15\",\"children\":15}],[\"$\",\"$Lb\",\"16\",{\"className\":\"\",\"href\":\"/blog/page/16\",\"children\":16}],[\"$\",\"$Lb\",\"17\",{\"className\":\"\",\"href\":\"/blog/page/17\",\"children\":17}],[\"$\",\"$Lb\",\"18\",{\"className\":\"\",\"href\":\"/blog/page/18\",\"children\":18}],[\"$\",\"$Lb\",\"19\",{\"className\":\"\",\"href\":\"/blog/page/19\",\"children\":19}],[\"$\",\"$Lb\",\"20\",{\"className\":\"\",\"href\":\"/blog/page/20\",\"children\":20}],[\"$\",\"$Lb\",\"21\",{\"className\":\"\",\"href\":\"/blog/page/21\",\"children\":21}],[\"$\",\"$Lb\",\"22\",{\"className\":\"\",\"href\":\"/blog/page/22\",\"children\":22}],[\"$\",\"$Lb\",\"23\",{\"className\":\"\",\"href\":\"/blog/page/23\",\"children\":23}],[\"$\",\"$Lb\",\"24\",{\"className\":\"\",\"href\":\"/blog/page/24\",\"children\":24}],[\"$\",\"$Lb\",\"25\",{\"className\":\"\",\"href\":\"/blog/page/25\",\"children\":25}],[\"$\",\"$Lb\",\"26\",{\"className\":\"\",\"href\":\"/blog/page/26\",\"children\":26}],[\"$\",\"$Lb\",\"27\",{\"className\":\"\",\"href\":\"/blog/page/27\",\"children\":27}],[\"$\",\"$Lb\",\"28\",{\"className\":\"\",\"href\":\"/blog/page/28\",\"children\":28}],[\"$\",\"$Lb\",\"29\",{\"className\":\"\",\"href\":\"/blog/page/29\",\"children\":29}],[\"$\",\"$Lb\",\"30\",{\"className\":\"\",\"href\":\"/blog/page/30\",\"children\":30}],[\"$\",\"$Lb\",\"31\",{\"className\":\"\",\"href\":\"/blog/page/31\",\"children\":31}],[\"$\",\"$Lb\",\"32\",{\"className\":\"\",\"href\":\"/blog/page/32\",\"children\":32}],[\"$\",\"$Lb\",\"33\",{\"className\":\"\",\"href\":\"/blog/page/33\",\"children\":33}],[\"$\",\"$Lb\",\"34\",{\"className\":\"\",\"href\":\"/blog/page/34\",\"children\":34}],[\"$\",\"$Lb\",\"35\",{\"className\":\"\",\"href\":\"/blog/page/35\",\"children\":35}],[\"$\",\"$Lb\",\"36\",{\"className\":\"\",\"href\":\"/blog/page/36\",\"children\":36}],[\"$\",\"$Lb\",\"37\",{\"className\":\"\",\"href\":\"/blog/page/37\",\"children\":37}],[\"$\",\"$Lb\",\"38\",{\"className\":\"\",\"href\":\"/blog/page/38\",\"children\":38}],[\"$\",\"$Lb\",\"39\",{\"className\":\"\",\"href\":\"/blog/page/39\",\"children\":39}],[\"$\",\"$Lb\",\"40\",{\"className\":\"\",\"href\":\"/blog/page/40\",\"children\":40}],[\"$\",\"$Lb\",\"41\",{\"className\":\"\",\"href\":\"/blog/page/41\",\"children\":41}],[\"$\",\"$Lb\",\"42\",{\"className\":\"\",\"href\":\"/blog/page/42\",\"children\":42}],[\"$\",\"$Lb\",\"43\",{\"className\":\"\",\"href\":\"/blog/page/43\",\"children\":43}],[\"$\",\"$Lb\",\"44\",{\"className\":\"\",\"href\":\"/blog/page/44\",\"children\":44}],[\"$\",\"$Lb\",\"45\",{\"className\":\"\",\"href\":\"/blog/page/45\",\"children\":45}],[\"$\",\"$Lb\",\"46\",{\"className\":\"\",\"href\":\"/blog/page/46\",\"children\":46}],[\"$\",\"$Lb\",\"47\",{\"className\":\"\",\"href\":\"/blog/page/47\",\"children\":47}],[\"$\",\"$Lb\",\"48\",{\"className\":\"\",\"href\":\"/blog/page/48\",\"children\":48}],[\"$\",\"$Lb\",\"49\",{\"className\":\"\",\"href\":\"/blog/page/49\",\"children\":49}],[\"$\",\"$Lb\",\"50\",{\"className\":\"\",\"href\":\"/blog/page/50\",\"children\":50}],[\"$\",\"$Lb\",\"51\",{\"className\":\"\",\"href\":\"/blog/page/51\",\"children\":51}],[\"$\",\"$Lb\",\"52\",{\"className\":\"\",\"href\":\"/blog/page/52\",\"children\":52}],[\"$\",\"$Lb\",\"53\",{\"className\":\"\",\"href\":\"/blog/page/53\",\"children\":53}],[\"$\",\"$Lb\",\"54\",{\"className\":\"\",\"href\":\"/blog/page/54\",\"children\":54}],[\"$\",\"$Lb\",\"55\",{\"className\":\"\",\"href\":\"/blog/page/55\",\"children\":55}],[\"$\",\"$Lb\",\"56\",{\"className\":\"\",\"href\":\"/blog/page/56\",\"children\":56}],[\"$\",\"$Lb\",\"57\",{\"className\":\"\",\"href\":\"/blog/page/57\",\"children\":57}],[\"$\",\"$Lb\",\"58\",{\"className\":\"\",\"href\":\"/blog/page/58\",\"children\":58}],[\"$\",\"$Lb\",\"59\",{\"className\":\"\",\"href\":\"/blog/page/59\",\"children\":59}],[\"$\",\"$Lb\",\"60\",{\"className\":\"\",\"href\":\"/blog/page/60\",\"children\":60}],[\"$\",\"$Lb\",\"61\",{\"className\":\"\",\"href\":\"/blog/page/61\",\"children\":61}],[\"$\",\"$Lb\",\"62\",{\"className\":\"\",\"href\":\"/blog/page/62\",\"children\":62}],[\"$\",\"$Lb\",\"63\",{\"className\":\"\",\"href\":\"/blog/page/63\",\"children\":63}],[\"$\",\"$Lb\",\"64\",{\"className\":\"\",\"href\":\"/blog/page/64\",\"children\":64}],[\"$\",\"$Lb\",\"65\",{\"className\":\"\",\"href\":\"/blog/page/65\",\"children\":65}],[\"$\",\"$Lb\",\"66\",{\"className\":\"\",\"href\":\"/blog/page/66\",\"children\":66}],[\"$\",\"$Lb\",\"67\",{\"className\":\"\",\"href\":\"/blog/page/67\",\"children\":67}],[\"$\",\"$Lb\",\"68\",{\"className\":\"\",\"href\":\"/blog/page/68\",\"children\":68}],[\"$\",\"$Lb\",\"69\",{\"className\":\"\",\"href\":\"/blog/page/69\",\"children\":69}],[\"$\",\"$Lb\",\"70\",{\"className\":\"\",\"href\":\"/blog/page/70\",\"children\":70}],[\"$\",\"$Lb\",\"71\",{\"className\":\"\",\"href\":\"/blog/page/71\",\"children\":71}],[\"$\",\"$Lb\",\"72\",{\"className\":\"\",\"href\":\"/blog/page/72\",\"children\":72}],[\"$\",\"$Lb\",\"73\",{\"className\":\"\",\"href\":\"/blog/page/73\",\"children\":73}],[\"$\",\"$Lb\",\"74\",{\"className\":\"\",\"href\":\"/blog/page/74\",\"children\":74}],[\"$\",\"$Lb\",\"75\",{\"className\":\"\",\"href\":\"/blog/page/75\",\"children\":75}],[\"$\",\"$Lb\",\"76\",{\"className\":\"\",\"href\":\"/blog/page/76\",\"children\":76}],[\"$\",\"$Lb\",\"77\",{\"className\":\"\",\"href\":\"/blog/page/77\",\"children\":77}]]}]]}]]}]}]\n"])</script><script>self.__next_f.push([1,""])</script></body></html>