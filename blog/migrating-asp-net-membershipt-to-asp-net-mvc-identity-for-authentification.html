<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="preload" href="/_next/static/media/c9a5bc6a7c948fb0-s.p.woff2" as="font" crossorigin="" type="font/woff2"/><link rel="stylesheet" href="/_next/static/css/4f3d065c9e2d01e0.css" crossorigin="" data-precedence="next"/><link rel="stylesheet" href="/_next/static/css/acb87bc93b585f76.css" crossorigin="" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/_next/static/chunks/webpack-e96054f684094174.js" crossorigin=""/><script src="/_next/static/chunks/fd9d1056-cc48c28d170fddc2.js" async="" crossorigin=""></script><script src="/_next/static/chunks/69-c7efea4b65083e7f.js" async="" crossorigin=""></script><script src="/_next/static/chunks/main-app-f550f103b66f998a.js" async="" crossorigin=""></script><script src="/_next/static/chunks/250-d7e0a94ebe194dac.js" async=""></script><script src="/_next/static/chunks/79-2d03397107aae3f1.js" async=""></script><script src="/_next/static/chunks/app/blog/%5Bslug%5D/page-1141f182299ea450.js" async=""></script><title>Patrick Desjardins Blog - Migrating Asp.Net MemberShip to Asp.Net MVC Identity for authentification</title><meta name="description" content="Migrating Asp.Net MemberShip to Asp.Net MVC Identity for authentification"/><meta name="next-size-adjust"/><script src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js" crossorigin="" noModule=""></script></head><body class="layout_bodystyle__4ncsS"><div class="__className_aaf875"><div class="layout_container__Tovb9"><header class="layout_siteTitle__k5U8g">Patrick Desjardins Blog</header><nav><ul class="layout_navLinks__mf70r"><li class="layout_navLinkItem__1L8fB"><a class="layout_navLinkText__bt28R" href="/">Main Page</a><a class="layout_navLinkText__bt28R" href="/blog">Blog</a><a class="layout_navLinkText__bt28R" href="/blog/for/2024">2024</a><a class="layout_navLinkText__bt28R" href="/blog/for/2023">2023</a><a class="layout_navLinkText__bt28R" href="/blog/for/2022">2022</a><a class="layout_navLinkText__bt28R" href="/blog/for/2021">2021</a><a class="layout_navLinkText__bt28R" href="/blog/for/2020">2020</a><a class="layout_navLinkText__bt28R" href="/blog/for/2019">2019</a><a class="layout_navLinkText__bt28R" href="/blog/for/2018">2018</a><a class="layout_navLinkText__bt28R" href="/blog/for/2017">2017</a><a class="layout_navLinkText__bt28R" href="/blog/for/2016">2016</a><a class="layout_navLinkText__bt28R" href="/blog/for/2015">2015</a><a class="layout_navLinkText__bt28R" href="/blog/for/2014">2014</a><a class="layout_navLinkText__bt28R" href="/blog/for/2013">2013</a><a class="layout_navLinkText__bt28R" href="/blog/for/2012">2012</a><a class="layout_navLinkText__bt28R" href="/blog/for/2011">2011</a></li></ul></nav><div class="layout_blogPictureContainer__XC7nK"><img alt="Patrick Desjardins picture from a conference" loading="lazy" width="800" height="260" decoding="async" data-nimg="1" class="layout_blogTopPicture__RJHNN" style="color:transparent" src="/images/backgrounds/patrickdesjardins_conference_bw.jpeg"/></div><main class="layout_main__mXTwS"><h1>Migrating Asp.Net MemberShip to Asp.Net MVC Identity for authentification</h1><div class="layout_blogPostContainer__WYELx"><p class="layout_blogPostDate__LUvx5">Posted on: <!-- -->2014-01-27</p><p>I was using WebMatrix with the <a href="https://github.com/MrDesjardins/GymWorkout">Gym Workout project</a>. But, it wasn&#x27;t a clean way to handle authentification. It was in the middle of the old membership with a new flavor. However, since Microsoft is going with the new <a href="http://www.asp.net/identity/overview/getting-started/introduction-to-aspnet-identity">One Asp.Net Owin Identity framework</a> which allow to use claims but also to be dissociate from Microsoft Sql Server make it more appealing. It&#x27;s also on the frame of OWIN, so we have almost all positive features without the negative parts. Finally, Identity does have the clean way to have custom field to extend default username/password attribute. It&#x27;s clean because it creates specific columns for each field. So, if you have an existing Asp.Net MVC, how do you upgrade to the Identity framework for authentification? This is what I will explain in this Identity tutorial.</p>
<p>First, some libraries are required.</p>
<ul>
<li>Microsoft.AspNet.Identity.EntityFramework</li>
<li>Microsoft.AspNet.Identity.Core</li>
<li>Microsoft.AspNet.Identity.OWIN</li>
</ul>
<p>This can be found by using Nuget with the following command:</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#fff;color:#24292e" tabindex="0" data-language="powershell" data-theme="github-light"><code data-language="powershell" data-theme="github-light" style="display:grid"><span data-line=""><span style="color:#24292E"> PM</span><span style="color:#D73A49">&gt;</span><span style="color:#005CC5"> Install-Package</span><span style="color:#24292E"> Microsoft.AspNet.Identity.Core </span></span>
<span data-line=""><span style="color:#24292E"> PM</span><span style="color:#D73A49">&gt;</span><span style="color:#005CC5"> Install-Package</span><span style="color:#24292E"> Microsoft.AspNet.Identity.Owin </span></span>
<span data-line=""><span style="color:#24292E"> PM</span><span style="color:#D73A49">&gt;</span><span style="color:#005CC5"> Install-Package</span><span style="color:#24292E"> Microsoft.AspNet.Identity.EntityFramework </span></span>
<span data-line=""><span style="color:#24292E"> PM</span><span style="color:#D73A49">&gt;</span><span style="color:#005CC5"> Install-Package</span><span style="color:#24292E"> Microsoft.Owin.Host.SystemWeb </span></span></code></pre></figure>
<p>The next step was to get rid of everything concerning the user which was in its own class called for the project &quot;UserProfile&quot;. Instead, I created a new class called &quot;ApplicationUser&quot; which inherit from the default one of Identity framework. I removed the WebUserProvider because now, it will use Entity Framework to get user information. Providers are not required and everything will go with the service layer, to the data access layer to the database with Entity Framework (EF). The AccountModel (is in fact the view model) still exist which allow to have our custom fields like the Role, Language and Email in the view. Everything is bound to the model class ApplicationUser.</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#fff;color:#24292e" tabindex="0" data-language="csharp" data-theme="github-light"><code data-language="csharp" data-theme="github-light" style="display:grid"><span data-line=""><span style="color:#D73A49"> public</span><span style="color:#D73A49"> class</span><span style="color:#6F42C1"> ApplicationUser</span><span style="color:#24292E"> : </span><span style="color:#6F42C1">IdentityUser</span><span style="color:#24292E">, </span><span style="color:#6F42C1">ICurrentUser</span><span style="color:#24292E"> { </span><span style="color:#D73A49">public</span><span style="color:#6F42C1"> ApplicationUser</span><span style="color:#24292E">() { Email </span><span style="color:#D73A49">=</span><span style="color:#032F62"> &quot;&quot;</span><span style="color:#24292E">; Language </span><span style="color:#D73A49">=</span><span style="color:#032F62"> &quot;&quot;</span><span style="color:#24292E">; } </span><span style="color:#D73A49">public</span><span style="color:#D73A49"> string</span><span style="color:#6F42C1"> UserId</span><span style="color:#24292E"> { </span><span style="color:#D73A49">get</span><span style="color:#24292E"> { </span><span style="color:#D73A49">return</span><span style="color:#005CC5"> base</span><span style="color:#24292E">.Id; } </span><span style="color:#D73A49">set</span><span style="color:#24292E">{} } </span><span style="color:#D73A49">public</span><span style="color:#D73A49"> string</span><span style="color:#6F42C1"> Email</span><span style="color:#24292E"> { </span><span style="color:#D73A49">get</span><span style="color:#24292E">; </span><span style="color:#D73A49">set</span><span style="color:#24292E">; } </span><span style="color:#D73A49">public</span><span style="color:#D73A49"> string</span><span style="color:#6F42C1"> Language</span><span style="color:#24292E"> { </span><span style="color:#D73A49">get</span><span style="color:#24292E">; </span><span style="color:#D73A49">set</span><span style="color:#24292E">; } } </span></span></code></pre></figure>
<p>Even if the ApplicationUser inherit from IdentityUser which as a Id property, the ICurrentUser that we had previously use the UserId property. This is why this one is defined in ApplicationUser and link to the IdentityUser one. The only thing that we will do later is to ignore this property to not have the data inside the database. We also need to create a ApplicationUserService that contact the Data Access Layer.</p>
<p>A major change concerns the ServiceFactory class which has every entities service classes. Since the Account come from the database and that we do not want to go to the database every time one of the entity require to have something related to the user logged, they need to share the same account. This require a change in the constructor that is going to take in its constructor the IUserProvider which has a property Account. This one is passed to every service constructor.</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#fff;color:#24292e" tabindex="0" data-language="csharp" data-theme="github-light"><code data-language="csharp" data-theme="github-light" style="display:grid"><span data-line=""><span style="color:#D73A49">public</span><span style="color:#D73A49"> class</span><span style="color:#6F42C1"> ServiceFactory</span><span style="color:#24292E"> : </span><span style="color:#6F42C1">IServiceFactory</span><span style="color:#24292E"> { </span><span style="color:#D73A49">private</span><span style="color:#24292E"> IUserProvider_userProvider; #region Implementation </span><span style="color:#6F42C1">of</span><span style="color:#6F42C1"> IServiceFactory</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#D73A49">public</span><span style="color:#6F42C1"> IAccountService</span><span style="color:#6F42C1"> Account</span><span style="color:#24292E"> { </span><span style="color:#D73A49">get</span><span style="color:#24292E">; </span><span style="color:#D73A49">private</span><span style="color:#D73A49"> set</span><span style="color:#24292E">; } </span><span style="color:#D73A49">public</span><span style="color:#6F42C1"> IMuscleService</span><span style="color:#6F42C1"> Muscle</span><span style="color:#24292E"> { </span><span style="color:#D73A49">get</span><span style="color:#24292E">; </span><span style="color:#D73A49">private</span><span style="color:#D73A49"> set</span><span style="color:#24292E">; } </span><span style="color:#D73A49">public</span><span style="color:#6F42C1"> IWorkoutService</span><span style="color:#6F42C1"> Workout</span><span style="color:#24292E"> { </span><span style="color:#D73A49">get</span><span style="color:#24292E">; </span><span style="color:#D73A49">private</span><span style="color:#D73A49"> set</span><span style="color:#24292E">; } </span><span style="color:#D73A49">public</span><span style="color:#6F42C1"> IWorkoutSessionService</span><span style="color:#6F42C1"> WorkoutSession</span><span style="color:#24292E"> { </span><span style="color:#D73A49">get</span><span style="color:#24292E">; </span><span style="color:#D73A49">private</span><span style="color:#D73A49"> set</span><span style="color:#24292E">; } </span><span style="color:#D73A49">public</span><span style="color:#6F42C1"> IWorkoutSessionExerciseService</span><span style="color:#6F42C1"> WorkoutSessionExercise</span><span style="color:#24292E"> { </span><span style="color:#D73A49">get</span><span style="color:#24292E">; </span><span style="color:#D73A49">private</span><span style="color:#D73A49"> set</span><span style="color:#24292E">; }</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#D73A49">public</span><span style="color:#6F42C1"> IExerciseService</span><span style="color:#6F42C1"> Exercise</span><span style="color:#24292E"> { </span><span style="color:#D73A49">get</span><span style="color:#24292E">; </span><span style="color:#D73A49">private</span><span style="color:#D73A49"> set</span><span style="color:#24292E">; }</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#24292E">#</span><span style="color:#D73A49">endregion</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#D73A49">public</span><span style="color:#6F42C1"> ServiceFactory</span><span style="color:#24292E">(</span><span style="color:#6F42C1">IRepositoryFactory</span><span style="color:#6F42C1"> repositoryFactory</span><span style="color:#24292E">, </span><span style="color:#6F42C1">IMapperFactory</span><span style="color:#6F42C1"> mapperFactory</span><span style="color:#24292E">, </span><span style="color:#6F42C1">IUserProvider</span><span style="color:#6F42C1"> userProvider</span><span style="color:#24292E">) {_userProvider </span><span style="color:#D73A49">=</span><span style="color:#24292E"> userProvider; </span><span style="color:#D73A49">var</span><span style="color:#6F42C1"> account</span><span style="color:#D73A49"> =</span><span style="color:#24292E">_userProvider.Account; Account </span><span style="color:#D73A49">=</span><span style="color:#D73A49"> new</span><span style="color:#6F42C1"> ApplicationUserService</span><span style="color:#24292E">(repositoryFactory, mapperFactory); Muscle </span><span style="color:#D73A49">=</span><span style="color:#D73A49"> new</span><span style="color:#6F42C1"> MuscleService</span><span style="color:#24292E">(repositoryFactory, mapperFactory, account); Workout </span><span style="color:#D73A49">=</span><span style="color:#D73A49"> new</span><span style="color:#6F42C1"> WorkoutService</span><span style="color:#24292E">(repositoryFactory, mapperFactory, account); WorkoutSession </span><span style="color:#D73A49">=</span><span style="color:#D73A49"> new</span><span style="color:#6F42C1"> WorkoutSessionService</span><span style="color:#24292E">(repositoryFactory, mapperFactory, account); WorkoutSessionExercise </span><span style="color:#D73A49">=</span><span style="color:#D73A49"> new</span><span style="color:#6F42C1"> WorkoutSessionExerciseService</span><span style="color:#24292E">(repositoryFactory, mapperFactory, account); Exercise </span><span style="color:#D73A49">=</span><span style="color:#D73A49"> new</span><span style="color:#6F42C1"> ExerciseService</span><span style="color:#24292E">(repositoryFactory, mapperFactory, Muscle, account); } } </span></span></code></pre></figure>
<p>Entities inherit of BaseService.</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#fff;color:#24292e" tabindex="0" data-language="csharp" data-theme="github-light"><code data-language="csharp" data-theme="github-light" style="display:grid"><span data-line=""><span style="color:#D73A49"> public</span><span style="color:#D73A49"> abstract</span><span style="color:#D73A49"> class</span><span style="color:#6F42C1"> BaseService</span><span style="color:#24292E"> { </span><span style="color:#D73A49">public</span><span style="color:#6F42C1"> BaseService</span><span style="color:#24292E">(</span><span style="color:#6F42C1">IRepositoryFactory</span><span style="color:#6F42C1"> repositoryFactory</span><span style="color:#24292E">, </span><span style="color:#6F42C1">IMapperFactory</span><span style="color:#6F42C1"> mapperFactory</span><span style="color:#24292E">, </span><span style="color:#6F42C1">ICurrentUser</span><span style="color:#6F42C1"> user</span><span style="color:#24292E">) { Repository </span><span style="color:#D73A49">=</span><span style="color:#24292E"> repositoryFactory; Mapper </span><span style="color:#D73A49">=</span><span style="color:#24292E"> mapperFactory; Repository.</span><span style="color:#6F42C1">SetUser</span><span style="color:#24292E">(user); }</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#D73A49">protected</span><span style="color:#6F42C1"> IRepositoryFactory</span><span style="color:#6F42C1"> Repository</span><span style="color:#24292E"> { </span><span style="color:#D73A49">get</span><span style="color:#24292E">; </span><span style="color:#D73A49">private</span><span style="color:#D73A49"> set</span><span style="color:#24292E">; } </span><span style="color:#D73A49">protected</span><span style="color:#6F42C1"> IMapperFactory</span><span style="color:#6F42C1"> Mapper</span><span style="color:#24292E"> { </span><span style="color:#D73A49">get</span><span style="color:#24292E">; </span><span style="color:#D73A49">private</span><span style="color:#D73A49"> set</span><span style="color:#24292E">; } } </span></span></code></pre></figure>
<p>When the service is initialized, it uses the injected Repository to set the user that is also injected. Since the ServiceFactory calls the Account once, one call is done to the database. After, it only set the object to the repository which could be used later.</p>
<p>The concept of IUserProvider remains. This is because we will use a <em>WebUserProvider</em> for the Asp.Net MVC and a <em>WebServiceUserProvider</em>.</p>
<p>The Global.asax.cs file changes because it does not use anymore the <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-light" style="background-color:#fff;color:#24292e"><span data-line=""><span>AuthConfig.RegisterAuth()</span></span></code></span> because the Identity with OWIN does have a Startup page in the App folder.</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#fff;color:#24292e" tabindex="0" data-language="csharp" data-theme="github-light"><code data-language="csharp" data-theme="github-light" style="display:grid"><span data-line=""><span style="color:#D73A49"> public</span><span style="color:#D73A49"> partial</span><span style="color:#D73A49"> class</span><span style="color:#6F42C1"> Startup</span><span style="color:#24292E"> {</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#6A737D">// For more information on configuring authentication, please visit http://go.microsoft.com/fwlink/?LinkId=301864 public void ConfigureAuth(IAppBuilder app) { // Enable the application to use a cookie to store information for the signed in user app.UseCookieAuthentication(new CookieAuthenticationOptions { AuthenticationType = DefaultAuthenticationTypes.ApplicationCookie, LoginPath = new PathString(&quot;/Account/Login&quot;) }); // Use a cookie to temporarily store information about a user logging in with a third party login provider app.UseExternalSignInCookie(DefaultAuthenticationTypes.ExternalCookie); }</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#24292E">} </span></span></code></pre></figure>
<p>This also require to register the Startup class with another Startup class that is used as a bootstrapper for the OWIN container.</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#fff;color:#24292e" tabindex="0" data-language="csharp" data-theme="github-light"><code data-language="csharp" data-theme="github-light" style="display:grid"><span data-line=""><span style="color:#D73A49"> using</span><span style="color:#6F42C1"> Owin</span><span style="color:#24292E">;</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#24292E">[</span><span style="color:#D73A49">assembly</span><span style="color:#24292E">: </span><span style="color:#6F42C1">OwinStartup</span><span style="color:#24292E">(</span><span style="color:#D73A49">typeof</span><span style="color:#24292E">(</span><span style="color:#6F42C1">WorkoutPlanner</span><span style="color:#24292E">.</span><span style="color:#6F42C1">Startup</span><span style="color:#24292E">))] </span><span style="color:#D73A49">namespace</span><span style="color:#6F42C1"> WorkoutPlanner</span><span style="color:#24292E"> { </span><span style="color:#D73A49">public</span><span style="color:#D73A49"> partial</span><span style="color:#D73A49"> class</span><span style="color:#6F42C1"> Startup</span><span style="color:#24292E"> { </span><span style="color:#D73A49">public</span><span style="color:#D73A49"> void</span><span style="color:#6F42C1"> Configuration</span><span style="color:#24292E">(</span><span style="color:#6F42C1">IAppBuilder</span><span style="color:#6F42C1"> app</span><span style="color:#24292E">) { </span><span style="color:#6F42C1">ConfigureAuth</span><span style="color:#24292E">(app); } } } </span></span></code></pre></figure>
<p>Notice the assembly instruction that tell which class is used for OwinStartup. It uses two classes but could use one. the only benefit of splitting the class in two is to have one statup entry and the code to configure somewhere else. This could later uncluttered the booting class.</p>
<p>The migration changes also. The Seed method does not use the WebSecurity to initialize default user. It uses the ApplicationUser class with the UserStore and UserManager class that use Entity Framework to work with the database.</p>
<p>To create the database with all Identity classes and all the business classes, the migration command in the package console is required. The</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#fff;color:#24292e" tabindex="0" data-language="powershell" data-theme="github-light"><code data-language="powershell" data-theme="github-light" style="display:grid"><span data-line=""><span style="color:#005CC5"> update-database</span><span style="color:#D73A49"> -</span><span style="color:#24292E">ConfigurationTypeName </span><span style="color:#032F62">&quot;Configuration&quot;</span><span style="color:#24292E"> </span></span></code></pre></figure>
<p>This works because the Configuration class inherit of <em>DbMigrationsConfigurations</em> which allow the migration tool to be executed. It takes the database context to be used. In our case, it&#x27;s the one that contains every entities of the application.</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#fff;color:#24292e" tabindex="0" data-language="csharp" data-theme="github-light"><code data-language="csharp" data-theme="github-light" style="display:grid"><span data-line=""><span style="color:#D73A49"> public</span><span style="color:#D73A49"> class</span><span style="color:#6F42C1"> Configuration</span><span style="color:#24292E"> : </span><span style="color:#6F42C1">DbMigrationsConfiguration</span><span style="color:#24292E">&lt;</span><span style="color:#6F42C1">DatabaseContext</span><span style="color:#24292E">&gt;</span><span style="color:#6A737D">//&lt;DatabaseContext&gt; { public Configuration() { base.AutomaticMigrationsEnabled = true; }</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#6F42C1">protected</span><span style="color:#6F42C1"> override</span><span style="color:#D73A49"> void</span><span style="color:#6F42C1"> Seed</span><span style="color:#24292E">(</span><span style="color:#6F42C1">DatabaseContext</span><span style="color:#6F42C1"> context</span><span style="color:#24292E">) { </span><span style="color:#6F42C1">var</span><span style="color:#6F42C1"> userStore</span><span style="color:#D73A49"> =</span><span style="color:#D73A49"> new</span><span style="color:#6F42C1"> UserStore</span><span style="color:#24292E">&lt;</span><span style="color:#6F42C1">ApplicationUser</span><span style="color:#24292E">&gt;(context); </span><span style="color:#6F42C1">var</span><span style="color:#6F42C1"> manager</span><span style="color:#D73A49"> =</span><span style="color:#D73A49"> new</span><span style="color:#6F42C1"> UserManager</span><span style="color:#24292E">&lt;</span><span style="color:#6F42C1">ApplicationUser</span><span style="color:#24292E">&gt;(userStore);</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#6F42C1">var</span><span style="color:#6F42C1"> role</span><span style="color:#D73A49"> =</span><span style="color:#D73A49"> new</span><span style="color:#6F42C1"> IdentityUserRole</span><span style="color:#24292E"> { Role </span><span style="color:#D73A49">=</span><span style="color:#D73A49"> new</span><span style="color:#6F42C1"> IdentityRole</span><span style="color:#24292E">(Model.Roles.ADMINISTRATOR) }; </span><span style="color:#6F42C1">var</span><span style="color:#6F42C1"> user</span><span style="color:#D73A49"> =</span><span style="color:#D73A49"> new</span><span style="color:#6F42C1"> ApplicationUser</span><span style="color:#24292E">() { UserName </span><span style="color:#D73A49">=</span><span style="color:#032F62"> &quot;123123&quot;</span><span style="color:#24292E">, Email </span><span style="color:#D73A49">=</span><span style="color:#032F62"> &quot;123123@123.com&quot;</span><span style="color:#24292E">, Language </span><span style="color:#D73A49">=</span><span style="color:#032F62"> &quot;en-US&quot;</span><span style="color:#24292E"> }; user.Roles.</span><span style="color:#6F42C1">Add</span><span style="color:#24292E">(role); </span><span style="color:#6F42C1">IdentityResult</span><span style="color:#6F42C1"> result</span><span style="color:#D73A49"> =</span><span style="color:#24292E"> manager.</span><span style="color:#6F42C1">Create</span><span style="color:#24292E">(user, </span><span style="color:#032F62">&quot;123123&quot;</span><span style="color:#24292E">);</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#6F42C1">var</span><span style="color:#6F42C1"> role2</span><span style="color:#D73A49"> =</span><span style="color:#D73A49"> new</span><span style="color:#6F42C1"> IdentityUserRole</span><span style="color:#24292E"> { Role </span><span style="color:#D73A49">=</span><span style="color:#D73A49"> new</span><span style="color:#6F42C1"> IdentityRole</span><span style="color:#24292E">(Model.Roles.NORMAL) }; </span><span style="color:#6F42C1">var</span><span style="color:#6F42C1"> user2</span><span style="color:#D73A49"> =</span><span style="color:#D73A49"> new</span><span style="color:#6F42C1"> ApplicationUser</span><span style="color:#24292E">() { UserName </span><span style="color:#D73A49">=</span><span style="color:#032F62"> &quot;qweqwe&quot;</span><span style="color:#24292E">, Email </span><span style="color:#D73A49">=</span><span style="color:#032F62"> &quot;qweqwe@qweqwe.com&quot;</span><span style="color:#24292E">, Language </span><span style="color:#D73A49">=</span><span style="color:#032F62"> &quot;fr-CA&quot;</span><span style="color:#24292E"> }; user.Roles.</span><span style="color:#6F42C1">Add</span><span style="color:#24292E">(role2); </span><span style="color:#6F42C1">IdentityResult</span><span style="color:#6F42C1"> result2</span><span style="color:#D73A49"> =</span><span style="color:#24292E"> manager.</span><span style="color:#6F42C1">Create</span><span style="color:#24292E">(user2, </span><span style="color:#032F62">&quot;qweqwe&quot;</span><span style="color:#24292E">);</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#6F42C1">var</span><span style="color:#6F42C1"> muscles</span><span style="color:#D73A49"> =</span><span style="color:#D73A49"> new</span><span style="color:#24292E">[]{</span><span style="color:#D73A49">new</span><span style="color:#6F42C1"> Muscle</span><span style="color:#24292E"> { Id </span><span style="color:#D73A49">=</span><span style="color:#005CC5"> 1</span><span style="color:#24292E">, Name </span><span style="color:#D73A49">=</span><span style="color:#D73A49"> new</span><span style="color:#6F42C1"> LocalizedString</span><span style="color:#24292E"> { French </span><span style="color:#D73A49">=</span><span style="color:#032F62"> &quot;Cou&quot;</span><span style="color:#24292E">, English </span><span style="color:#D73A49">=</span><span style="color:#032F62"> &quot;Neck&quot;</span><span style="color:#24292E"> } }, </span><span style="color:#D73A49">new</span><span style="color:#6F42C1"> Muscle</span><span style="color:#24292E"> { Id </span><span style="color:#D73A49">=</span><span style="color:#005CC5"> 2</span><span style="color:#24292E">, Name </span><span style="color:#D73A49">=</span><span style="color:#D73A49"> new</span><span style="color:#6F42C1"> LocalizedString</span><span style="color:#24292E"> { French </span><span style="color:#D73A49">=</span><span style="color:#032F62"> &quot;Épaule&quot;</span><span style="color:#24292E">, English </span><span style="color:#D73A49">=</span><span style="color:#032F62"> &quot;Shoulder&quot;</span><span style="color:#24292E"> } } };</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:#24292E">context.Set&lt;Muscle&gt;().</span><span style="color:#6F42C1">AddOrUpdateRange</span><span style="color:#24292E">(muscles); </span><span style="color:#6A737D">//... and so on... base.Seed(context); } } </span></span></code></pre></figure>
<p>When working with Asp.Net Identity one key is to have your database context class inherit from IdentityDbContext and not directly from DbContext. Otherwise, you will get that keys are not defined for IdentityUserLogin, IdentityUserRole, IdentityUserLogins and IdentityUserRoles.</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#fff;color:#24292e" tabindex="0" data-language="plaintext" data-theme="github-light"><code data-language="plaintext" data-theme="github-light" style="display:grid"><span data-line=""><span> DataAccessLayer.Database.IdentityUserLogin: : EntityType &#x27;IdentityUserLogin&#x27; has no key defined. Define the key for this EntityType. DataAccessLayer.Database.IdentityUserRole: : EntityType &#x27;IdentityUserRole&#x27; has no key defined. Define the key for this EntityType. IdentityUserLogins: EntityType: EntitySet &#x27;IdentityUserLogins&#x27; is based on type &#x27;IdentityUserLogin&#x27; that has no keys defined. IdentityUserRoles: EntityType: EntitySet &#x27;IdentityUserRoles&#x27; is based on type &#x27;IdentityUserRole&#x27; that has no keys defined. </span></span></code></pre></figure>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#fff;color:#24292e" tabindex="0" data-language="csharp" data-theme="github-light"><code data-language="csharp" data-theme="github-light" style="display:grid"><span data-line=""><span style="color:#D73A49"> public</span><span style="color:#D73A49"> class</span><span style="color:#6F42C1"> DatabaseContext</span><span style="color:#24292E"> :</span><span style="color:#6F42C1">IdentityDbContext</span><span style="color:#24292E">&lt;</span><span style="color:#6F42C1">ApplicationUser</span><span style="color:#24292E">&gt;, </span><span style="color:#6F42C1">IDatabaseContext</span><span style="color:#24292E"> </span></span></code></pre></figure>
<p>Migrating from Asp.Net Membership to Identity is not something that can be done for the first time under few hours. In fact, it took me around 12 hours to figure out that I had to inherit from IdentityDbContext and to solve several seeding problem. Also, having to use Entity Framework changed a little but how to use the user information. Nevertheless, the time is not exponential since it concerns only users and roles entities. I believe that it should take less than a day for someone who have all the information.</p></div></main><div class="layout_paginationBar__jnuuR"><div class="layout_paginationTitle__PsOw5">Chronological Blog Articles by Page</div><div class="layout_paginationLinks__LdBaH"><a class="" href="/blog/page/1">1</a><a class="" href="/blog/page/2">2</a><a class="" href="/blog/page/3">3</a><a class="" href="/blog/page/4">4</a><a class="" href="/blog/page/5">5</a><a class="" href="/blog/page/6">6</a><a class="" href="/blog/page/7">7</a><a class="" href="/blog/page/8">8</a><a class="" href="/blog/page/9">9</a><a class="" href="/blog/page/10">10</a><a class="" href="/blog/page/11">11</a><a class="" href="/blog/page/12">12</a><a class="" href="/blog/page/13">13</a><a class="" href="/blog/page/14">14</a><a class="" href="/blog/page/15">15</a><a class="" href="/blog/page/16">16</a><a class="" href="/blog/page/17">17</a><a class="" href="/blog/page/18">18</a><a class="" href="/blog/page/19">19</a><a class="" href="/blog/page/20">20</a><a class="" href="/blog/page/21">21</a><a class="" href="/blog/page/22">22</a><a class="" href="/blog/page/23">23</a><a class="" href="/blog/page/24">24</a><a class="" href="/blog/page/25">25</a><a class="" href="/blog/page/26">26</a><a class="" href="/blog/page/27">27</a><a class="" href="/blog/page/28">28</a><a class="" href="/blog/page/29">29</a><a class="" href="/blog/page/30">30</a><a class="" href="/blog/page/31">31</a><a class="" href="/blog/page/32">32</a><a class="" href="/blog/page/33">33</a><a class="" href="/blog/page/34">34</a><a class="" href="/blog/page/35">35</a><a class="" href="/blog/page/36">36</a><a class="" href="/blog/page/37">37</a><a class="" href="/blog/page/38">38</a><a class="" href="/blog/page/39">39</a><a class="" href="/blog/page/40">40</a><a class="" href="/blog/page/41">41</a><a class="" href="/blog/page/42">42</a><a class="" href="/blog/page/43">43</a><a class="" href="/blog/page/44">44</a><a class="" href="/blog/page/45">45</a><a class="" href="/blog/page/46">46</a><a class="" href="/blog/page/47">47</a><a class="" href="/blog/page/48">48</a><a class="" href="/blog/page/49">49</a><a class="" href="/blog/page/50">50</a><a class="" href="/blog/page/51">51</a><a class="" href="/blog/page/52">52</a><a class="" href="/blog/page/53">53</a><a class="" href="/blog/page/54">54</a><a class="" href="/blog/page/55">55</a><a class="" href="/blog/page/56">56</a><a class="" href="/blog/page/57">57</a><a class="" href="/blog/page/58">58</a><a class="" href="/blog/page/59">59</a><a class="" href="/blog/page/60">60</a><a class="" href="/blog/page/61">61</a><a class="" href="/blog/page/62">62</a><a class="" href="/blog/page/63">63</a><a class="" href="/blog/page/64">64</a><a class="" href="/blog/page/65">65</a><a class="" href="/blog/page/66">66</a><a class="" href="/blog/page/67">67</a><a class="" href="/blog/page/68">68</a><a class="" href="/blog/page/69">69</a><a class="" href="/blog/page/70">70</a><a class="" href="/blog/page/71">71</a><a class="" href="/blog/page/72">72</a><a class="" href="/blog/page/73">73</a><a class="" href="/blog/page/74">74</a><a class="" href="/blog/page/75">75</a><a class="" href="/blog/page/76">76</a><a class="" href="/blog/page/77">77</a></div></div></div></div><script src="/_next/static/chunks/webpack-e96054f684094174.js" crossorigin="" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0]);self.__next_f.push([2,null])</script><script>self.__next_f.push([1,"1:HL[\"/_next/static/css/4f3d065c9e2d01e0.css\",\"style\",{\"crossOrigin\":\"\"}]\n0:\"$L2\"\n"])</script><script>self.__next_f.push([1,"3:HL[\"/_next/static/media/c9a5bc6a7c948fb0-s.p.woff2\",\"font\",{\"crossOrigin\":\"\",\"type\":\"font/woff2\"}]\n4:HL[\"/_next/static/css/acb87bc93b585f76.css\",\"style\",{\"crossOrigin\":\"\"}]\n"])</script><script>self.__next_f.push([1,"5:I[7690,[],\"\"]\n8:I[5613,[],\"\"]\na:I[1778,[],\"\"]\nb:I[5250,[\"250\",\"static/chunks/250-d7e0a94ebe194dac.js\",\"79\",\"static/chunks/79-2d03397107aae3f1.js\",\"308\",\"static/chunks/app/blog/%5Bslug%5D/page-1141f182299ea450.js\"],\"\"]\nd:I[8955,[],\"\"]\n9:[\"slug\",\"migrating-asp-net-membershipt-to-asp-net-mvc-identity-for-authentification\",\"d\"]\ne:[]\n"])</script><script>self.__next_f.push([1,"2:[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/4f3d065c9e2d01e0.css\",\"precedence\":\"next\",\"crossOrigin\":\"\"}]],[\"$\",\"$L5\",null,{\"buildId\":\"48CaX-z0PzqA-T-8DOlhH\",\"assetPrefix\":\"\",\"initialCanonicalUrl\":\"/blog/migrating-asp-net-membershipt-to-asp-net-mvc-identity-for-authentification\",\"initialTree\":[\"\",{\"children\":[\"blog\",{\"children\":[[\"slug\",\"migrating-asp-net-membershipt-to-asp-net-mvc-identity-for-authentification\",\"d\"],{\"children\":[\"__PAGE__?{\\\"slug\\\":\\\"migrating-asp-net-membershipt-to-asp-net-mvc-identity-for-authentification\\\"}\",{}]}]}]},\"$undefined\",\"$undefined\",true],\"initialSeedData\":[\"\",{\"children\":[\"blog\",{\"children\":[[\"slug\",\"migrating-asp-net-membershipt-to-asp-net-mvc-identity-for-authentification\",\"d\"],{\"children\":[\"__PAGE__\",{},[\"$L6\",\"$L7\",null]]},[\"$\",\"$L8\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"blog\",\"children\",\"$9\",\"children\"],\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"loadingScripts\":\"$undefined\",\"hasLoading\":false,\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$La\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\",\"styles\":[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/acb87bc93b585f76.css\",\"precedence\":\"next\",\"crossOrigin\":\"\"}]]}]]},[\"$\",\"$L8\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"blog\",\"children\"],\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"loadingScripts\":\"$undefined\",\"hasLoading\":false,\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$La\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\",\"styles\":null}]]},[null,[\"$\",\"html\",null,{\"lang\":\"en\",\"children\":[\"$\",\"body\",null,{\"className\":\"layout_bodystyle__4ncsS\",\"children\":[\"$\",\"$L8\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\"],\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"loadingScripts\":\"$undefined\",\"hasLoading\":false,\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$La\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[\"$\",\"div\",null,{\"style\":{\"display\":\"flex\",\"alignItems\":\"center\",\"justifyContent\":\"center\",\"height\":\"100vh\"},\"children\":[\"$\",\"div\",null,{\"style\":{\"width\":\"50%\",\"height\":\"20%\",\"backgroundColor\":\"#ffeded\",\"borderRadius\":12,\"padding\":12,\"textAlign\":\"center\"},\"children\":[[\"$\",\"h1\",null,{\"children\":\"Not Found\"}],[\"$\",\"p\",null,{\"children\":\"Could not find requested resource\"}],[\"$\",\"$Lb\",null,{\"href\":\"/\",\"children\":\"Return Home\"}]]}]}],\"notFoundStyles\":[],\"styles\":null}]}]}],null]],\"initialHead\":[false,\"$Lc\"],\"globalErrorComponent\":\"$d\",\"missingSlots\":\"$We\"}]]\n"])</script><script>self.__next_f.push([1,"f:I[1749,[\"250\",\"static/chunks/250-d7e0a94ebe194dac.js\",\"79\",\"static/chunks/79-2d03397107aae3f1.js\",\"308\",\"static/chunks/app/blog/%5Bslug%5D/page-1141f182299ea450.js\"],\"Image\"]\nc:[[\"$\",\"meta\",\"0\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}],[\"$\",\"meta\",\"1\",{\"charSet\":\"utf-8\"}],[\"$\",\"title\",\"2\",{\"children\":\"Patrick Desjardins Blog - Migrating Asp.Net MemberShip to Asp.Net MVC Identity for authentification\"}],[\"$\",\"meta\",\"3\",{\"name\":\"description\",\"content\":\"Migrating Asp.Net MemberShip"])</script><script>self.__next_f.push([1," to Asp.Net MVC Identity for authentification\"}],[\"$\",\"meta\",\"4\",{\"name\":\"next-size-adjust\"}]]\n6:null\n"])</script><script>self.__next_f.push([1,"7:[\"$\",\"div\",null,{\"className\":\"__className_aaf875\",\"children\":[\"$\",\"div\",null,{\"className\":\"layout_container__Tovb9\",\"children\":[[\"$\",\"header\",null,{\"className\":\"layout_siteTitle__k5U8g\",\"children\":\"Patrick Desjardins Blog\"}],[\"$\",\"nav\",null,{\"children\":[\"$\",\"ul\",null,{\"className\":\"layout_navLinks__mf70r\",\"children\":[\"$\",\"li\",null,{\"className\":\"layout_navLinkItem__1L8fB\",\"children\":[[\"$\",\"$Lb\",null,{\"className\":\"layout_navLinkText__bt28R\",\"href\":\"/\",\"children\":\"Main Page\"}],[\"$\",\"$Lb\",null,{\"className\":\"layout_navLinkText__bt28R\",\"href\":\"/blog\",\"children\":\"Blog\"}],[[\"$\",\"$Lb\",\"2024\",{\"className\":\"layout_navLinkText__bt28R\",\"href\":\"/blog/for/2024\",\"children\":2024}],[\"$\",\"$Lb\",\"2023\",{\"className\":\"layout_navLinkText__bt28R\",\"href\":\"/blog/for/2023\",\"children\":2023}],[\"$\",\"$Lb\",\"2022\",{\"className\":\"layout_navLinkText__bt28R\",\"href\":\"/blog/for/2022\",\"children\":2022}],[\"$\",\"$Lb\",\"2021\",{\"className\":\"layout_navLinkText__bt28R\",\"href\":\"/blog/for/2021\",\"children\":2021}],[\"$\",\"$Lb\",\"2020\",{\"className\":\"layout_navLinkText__bt28R\",\"href\":\"/blog/for/2020\",\"children\":2020}],[\"$\",\"$Lb\",\"2019\",{\"className\":\"layout_navLinkText__bt28R\",\"href\":\"/blog/for/2019\",\"children\":2019}],[\"$\",\"$Lb\",\"2018\",{\"className\":\"layout_navLinkText__bt28R\",\"href\":\"/blog/for/2018\",\"children\":2018}],[\"$\",\"$Lb\",\"2017\",{\"className\":\"layout_navLinkText__bt28R\",\"href\":\"/blog/for/2017\",\"children\":2017}],[\"$\",\"$Lb\",\"2016\",{\"className\":\"layout_navLinkText__bt28R\",\"href\":\"/blog/for/2016\",\"children\":2016}],[\"$\",\"$Lb\",\"2015\",{\"className\":\"layout_navLinkText__bt28R\",\"href\":\"/blog/for/2015\",\"children\":2015}],[\"$\",\"$Lb\",\"2014\",{\"className\":\"layout_navLinkText__bt28R\",\"href\":\"/blog/for/2014\",\"children\":2014}],[\"$\",\"$Lb\",\"2013\",{\"className\":\"layout_navLinkText__bt28R\",\"href\":\"/blog/for/2013\",\"children\":2013}],[\"$\",\"$Lb\",\"2012\",{\"className\":\"layout_navLinkText__bt28R\",\"href\":\"/blog/for/2012\",\"children\":2012}],[\"$\",\"$Lb\",\"2011\",{\"className\":\"layout_navLinkText__bt28R\",\"href\":\"/blog/for/2011\",\"children\":2011}]]]}]}]}],[\"$\",\"div\",null,{\"className\":\"layout_blogPictureContainer__XC7nK\",\"children\":[\"$\",\"$Lf\",null,{\"className\":\"layout_blogTopPicture__RJHNN\",\"alt\":\"Patrick Desjardins picture from a conference\",\"src\":\"/images/backgrounds/patrickdesjardins_conference_bw.jpeg\",\"width\":800,\"height\":260}]}],[\"$\",\"main\",null,{\"className\":\"layout_main__mXTwS\",\"children\":[[\"$\",\"h1\",null,{\"children\":\"Migrating Asp.Net MemberShip to Asp.Net MVC Identity for authentification\"}],[\"$\",\"div\",null,{\"className\":\"layout_blogPostContainer__WYELx\",\"children\":[[\"$\",\"p\",null,{\"className\":\"layout_blogPostDate__LUvx5\",\"children\":[\"Posted on: \",\"2014-01-27\"]}],[[\"$\",\"p\",null,{\"children\":[\"I was using WebMatrix with the \",[\"$\",\"a\",null,{\"href\":\"https://github.com/MrDesjardins/GymWorkout\",\"children\":\"Gym Workout project\"}],\". But, it wasn't a clean way to handle authentification. It was in the middle of the old membership with a new flavor. However, since Microsoft is going with the new \",[\"$\",\"a\",null,{\"href\":\"http://www.asp.net/identity/overview/getting-started/introduction-to-aspnet-identity\",\"children\":\"One Asp.Net Owin Identity framework\"}],\" which allow to use claims but also to be dissociate from Microsoft Sql Server make it more appealing. It's also on the frame of OWIN, so we have almost all positive features without the negative parts. Finally, Identity does have the clean way to have custom field to extend default username/password attribute. It's clean because it creates specific columns for each field. So, if you have an existing Asp.Net MVC, how do you upgrade to the Identity framework for authentification? This is what I will explain in this Identity tutorial.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"First, some libraries are required.\"}],\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":\"Microsoft.AspNet.Identity.EntityFramework\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"Microsoft.AspNet.Identity.Core\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"Microsoft.AspNet.Identity.OWIN\"}],\"\\n\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"This can be found by using Nuget with the following command:\"}],\"\\n\",[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"backgroundColor\":\"#fff\",\"color\":\"#24292e\"},\"tabIndex\":\"0\",\"data-language\":\"powershell\",\"data-theme\":\"github-light\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"powershell\",\"data-theme\":\"github-light\",\"style\":{\"display\":\"grid\"},\"children\":[[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" PM\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"\u003e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005CC5\"},\"children\":\" Install-Package\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" Microsoft.AspNet.Identity.Core \"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" PM\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"\u003e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005CC5\"},\"children\":\" Install-Package\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" Microsoft.AspNet.Identity.Owin \"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" PM\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"\u003e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005CC5\"},\"children\":\" Install-Package\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" Microsoft.AspNet.Identity.EntityFramework \"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" PM\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"\u003e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005CC5\"},\"children\":\" Install-Package\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" Microsoft.Owin.Host.SystemWeb \"}]]}]]}]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"The next step was to get rid of everything concerning the user which was in its own class called for the project \\\"UserProfile\\\". Instead, I created a new class called \\\"ApplicationUser\\\" which inherit from the default one of Identity framework. I removed the WebUserProvider because now, it will use Entity Framework to get user information. Providers are not required and everything will go with the service layer, to the data access layer to the database with Entity Framework (EF). The AccountModel (is in fact the view model) still exist which allow to have our custom fields like the Role, Language and Email in the view. Everything is bound to the model class ApplicationUser.\"}],\"\\n\",[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"backgroundColor\":\"#fff\",\"color\":\"#24292e\"},\"tabIndex\":\"0\",\"data-language\":\"csharp\",\"data-theme\":\"github-light\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"csharp\",\"data-theme\":\"github-light\",\"style\":{\"display\":\"grid\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" class\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" ApplicationUser\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" : \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"IdentityUser\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\", \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"ICurrentUser\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" ApplicationUser\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"() { Email \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032F62\"},\"children\":\" \\\"\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; Language \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032F62\"},\"children\":\" \\\"\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; } \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" string\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" UserId\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"get\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"return\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005CC5\"},\"children\":\" base\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\".Id; } \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"set\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"{} } \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" string\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" Email\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"get\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"set\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; } \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" string\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" Language\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"get\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"set\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; } } \"}]]}]}]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Even if the ApplicationUser inherit from IdentityUser which as a Id property, the ICurrentUser that we had previously use the UserId property. This is why this one is defined in ApplicationUser and link to the IdentityUser one. The only thing that we will do later is to ignore this property to not have the data inside the database. We also need to create a ApplicationUserService that contact the Data Access Layer.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"A major change concerns the ServiceFactory class which has every entities service classes. Since the Account come from the database and that we do not want to go to the database every time one of the entity require to have something related to the user logged, they need to share the same account. This require a change in the constructor that is going to take in its constructor the IUserProvider which has a property Account. This one is passed to every service constructor.\"}],\"\\n\",[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"backgroundColor\":\"#fff\",\"color\":\"#24292e\"},\"tabIndex\":\"0\",\"data-language\":\"csharp\",\"data-theme\":\"github-light\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"csharp\",\"data-theme\":\"github-light\",\"style\":{\"display\":\"grid\"},\"children\":[[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" class\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" ServiceFactory\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" : \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"IServiceFactory\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"private\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" IUserProvider_userProvider; #region Implementation \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"of\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" IServiceFactory\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":\" \"}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" IAccountService\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" Account\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"get\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"private\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" set\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; } \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" IMuscleService\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" Muscle\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"get\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"private\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" set\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; } \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" IWorkoutService\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" Workout\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"get\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"private\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" set\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; } \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" IWorkoutSessionService\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" WorkoutSession\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"get\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"private\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" set\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; } \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" IWorkoutSessionExerciseService\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" WorkoutSessionExercise\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"get\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"private\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" set\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; }\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":\" \"}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" IExerciseService\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" Exercise\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"get\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"private\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" set\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; }\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":\" \"}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"#\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"endregion\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":\" \"}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" ServiceFactory\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"IRepositoryFactory\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" repositoryFactory\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\", \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"IMapperFactory\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" mapperFactory\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\", \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"IUserProvider\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" userProvider\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\") {_userProvider \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" userProvider; \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"var\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" account\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"_userProvider.Account; Account \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" new\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" ApplicationUserService\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(repositoryFactory, mapperFactory); Muscle \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" new\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" MuscleService\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(repositoryFactory, mapperFactory, account); Workout \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" new\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" WorkoutService\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(repositoryFactory, mapperFactory, account); WorkoutSession \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" new\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" WorkoutSessionService\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(repositoryFactory, mapperFactory, account); WorkoutSessionExercise \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" new\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" WorkoutSessionExerciseService\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(repositoryFactory, mapperFactory, account); Exercise \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" new\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" ExerciseService\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(repositoryFactory, mapperFactory, Muscle, account); } } \"}]]}]]}]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Entities inherit of BaseService.\"}],\"\\n\",[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"backgroundColor\":\"#fff\",\"color\":\"#24292e\"},\"tabIndex\":\"0\",\"data-language\":\"csharp\",\"data-theme\":\"github-light\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"csharp\",\"data-theme\":\"github-light\",\"style\":{\"display\":\"grid\"},\"children\":[[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" abstract\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" class\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" BaseService\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" BaseService\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"IRepositoryFactory\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" repositoryFactory\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\", \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"IMapperFactory\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" mapperFactory\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\", \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"ICurrentUser\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" user\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\") { Repository \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" repositoryFactory; Mapper \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" mapperFactory; Repository.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"SetUser\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(user); }\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":\" \"}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"protected\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" IRepositoryFactory\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" Repository\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"get\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"private\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" set\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; } \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"protected\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" IMapperFactory\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" Mapper\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"get\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"private\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" set\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"; } } \"}]]}]]}]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"When the service is initialized, it uses the injected Repository to set the user that is also injected. Since the ServiceFactory calls the Account once, one call is done to the database. After, it only set the object to the repository which could be used later.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"The concept of IUserProvider remains. This is because we will use a \",[\"$\",\"em\",null,{\"children\":\"WebUserProvider\"}],\" for the Asp.Net MVC and a \",[\"$\",\"em\",null,{\"children\":\"WebServiceUserProvider\"}],\".\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"The Global.asax.cs file changes because it does not use anymore the \",[\"$\",\"span\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"plaintext\",\"data-theme\":\"github-light\",\"style\":{\"backgroundColor\":\"#fff\",\"color\":\"#24292e\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"AuthConfig.RegisterAuth()\"}]}]}]}],\" because the Identity with OWIN does have a Startup page in the App folder.\"]}],\"\\n\",[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"backgroundColor\":\"#fff\",\"color\":\"#24292e\"},\"tabIndex\":\"0\",\"data-language\":\"csharp\",\"data-theme\":\"github-light\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"csharp\",\"data-theme\":\"github-light\",\"style\":{\"display\":\"grid\"},\"children\":[[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" partial\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" class\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" Startup\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" {\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":\" \"}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#6A737D\"},\"children\":\"// For more information on configuring authentication, please visit http://go.microsoft.com/fwlink/?LinkId=301864 public void ConfigureAuth(IAppBuilder app) { // Enable the application to use a cookie to store information for the signed in user app.UseCookieAuthentication(new CookieAuthenticationOptions { AuthenticationType = DefaultAuthenticationTypes.ApplicationCookie, LoginPath = new PathString(\\\"/Account/Login\\\") }); // Use a cookie to temporarily store information about a user logging in with a third party login provider app.UseExternalSignInCookie(DefaultAuthenticationTypes.ExternalCookie); }\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":\" \"}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"} \"}]}]]}]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"This also require to register the Startup class with another Startup class that is used as a bootstrapper for the OWIN container.\"}],\"\\n\",[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"backgroundColor\":\"#fff\",\"color\":\"#24292e\"},\"tabIndex\":\"0\",\"data-language\":\"csharp\",\"data-theme\":\"github-light\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"csharp\",\"data-theme\":\"github-light\",\"style\":{\"display\":\"grid\"},\"children\":[[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" using\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" Owin\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":\" \"}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"[\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"assembly\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\": \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"OwinStartup\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"typeof\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"WorkoutPlanner\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Startup\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"))] \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"namespace\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" WorkoutPlanner\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" partial\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" class\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" Startup\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" void\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" Configuration\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"IAppBuilder\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" app\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\") { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"ConfigureAuth\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(app); } } } \"}]]}]]}]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Notice the assembly instruction that tell which class is used for OwinStartup. It uses two classes but could use one. the only benefit of splitting the class in two is to have one statup entry and the code to configure somewhere else. This could later uncluttered the booting class.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"The migration changes also. The Seed method does not use the WebSecurity to initialize default user. It uses the ApplicationUser class with the UserStore and UserManager class that use Entity Framework to work with the database.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"To create the database with all Identity classes and all the business classes, the migration command in the package console is required. The\"}],\"\\n\",[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"backgroundColor\":\"#fff\",\"color\":\"#24292e\"},\"tabIndex\":\"0\",\"data-language\":\"powershell\",\"data-theme\":\"github-light\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"powershell\",\"data-theme\":\"github-light\",\"style\":{\"display\":\"grid\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#005CC5\"},\"children\":\" update-database\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" -\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"ConfigurationTypeName \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032F62\"},\"children\":\"\\\"Configuration\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" \"}]]}]}]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"This works because the Configuration class inherit of \",[\"$\",\"em\",null,{\"children\":\"DbMigrationsConfigurations\"}],\" which allow the migration tool to be executed. It takes the database context to be used. In our case, it's the one that contains every entities of the application.\"]}],\"\\n\",[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"backgroundColor\":\"#fff\",\"color\":\"#24292e\"},\"tabIndex\":\"0\",\"data-language\":\"csharp\",\"data-theme\":\"github-light\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"csharp\",\"data-theme\":\"github-light\",\"style\":{\"display\":\"grid\"},\"children\":[[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" class\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" Configuration\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" : \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"DbMigrationsConfiguration\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"DatabaseContext\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6A737D\"},\"children\":\"//\u003cDatabaseContext\u003e { public Configuration() { base.AutomaticMigrationsEnabled = true; }\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":\" \"}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"protected\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" override\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" void\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" Seed\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"DatabaseContext\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" context\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\") { \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"var\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" userStore\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" new\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" UserStore\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"ApplicationUser\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e(context); \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"var\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" manager\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" new\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" UserManager\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"ApplicationUser\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e(userStore);\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":\" \"}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"var\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" role\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" new\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" IdentityUserRole\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" { Role \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" new\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" IdentityRole\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(Model.Roles.ADMINISTRATOR) }; \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"var\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" user\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" new\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" ApplicationUser\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"() { UserName \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032F62\"},\"children\":\" \\\"123123\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\", Email \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032F62\"},\"children\":\" \\\"123123@123.com\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\", Language \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032F62\"},\"children\":\" \\\"en-US\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" }; user.Roles.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Add\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(role); \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"IdentityResult\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" result\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" manager.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Create\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(user, \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032F62\"},\"children\":\"\\\"123123\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\");\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":\" \"}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"var\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" role2\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" new\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" IdentityUserRole\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" { Role \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" new\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" IdentityRole\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(Model.Roles.NORMAL) }; \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"var\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" user2\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" new\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" ApplicationUser\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"() { UserName \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032F62\"},\"children\":\" \\\"qweqwe\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\", Email \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032F62\"},\"children\":\" \\\"qweqwe@qweqwe.com\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\", Language \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032F62\"},\"children\":\" \\\"fr-CA\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" }; user.Roles.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Add\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(role2); \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"IdentityResult\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" result2\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" manager.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"Create\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(user2, \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032F62\"},\"children\":\"\\\"qweqwe\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\");\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":\" \"}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"var\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" muscles\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" new\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"[]{\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"new\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" Muscle\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" { Id \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005CC5\"},\"children\":\" 1\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\", Name \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" new\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" LocalizedString\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" { French \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032F62\"},\"children\":\" \\\"Cou\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\", English \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032F62\"},\"children\":\" \\\"Neck\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" } }, \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"new\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" Muscle\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" { Id \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#005CC5\"},\"children\":\" 2\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\", Name \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" new\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" LocalizedString\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" { French \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032F62\"},\"children\":\" \\\"Épaule\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\", English \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#032F62\"},\"children\":\" \\\"Shoulder\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" } } };\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":\" \"}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"context.Set\u003cMuscle\u003e().\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"AddOrUpdateRange\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"(muscles); \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6A737D\"},\"children\":\"//... and so on... base.Seed(context); } } \"}]]}]]}]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"When working with Asp.Net Identity one key is to have your database context class inherit from IdentityDbContext and not directly from DbContext. Otherwise, you will get that keys are not defined for IdentityUserLogin, IdentityUserRole, IdentityUserLogins and IdentityUserRoles.\"}],\"\\n\",[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"backgroundColor\":\"#fff\",\"color\":\"#24292e\"},\"tabIndex\":\"0\",\"data-language\":\"plaintext\",\"data-theme\":\"github-light\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"plaintext\",\"data-theme\":\"github-light\",\"style\":{\"display\":\"grid\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\" DataAccessLayer.Database.IdentityUserLogin: : EntityType 'IdentityUserLogin' has no key defined. Define the key for this EntityType. DataAccessLayer.Database.IdentityUserRole: : EntityType 'IdentityUserRole' has no key defined. Define the key for this EntityType. IdentityUserLogins: EntityType: EntitySet 'IdentityUserLogins' is based on type 'IdentityUserLogin' that has no keys defined. IdentityUserRoles: EntityType: EntitySet 'IdentityUserRoles' is based on type 'IdentityUserRole' that has no keys defined. \"}]}]}]}]}],\"\\n\",[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"backgroundColor\":\"#fff\",\"color\":\"#24292e\"},\"tabIndex\":\"0\",\"data-language\":\"csharp\",\"data-theme\":\"github-light\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"csharp\",\"data-theme\":\"github-light\",\"style\":{\"display\":\"grid\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#D73A49\"},\"children\":\" class\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\" DatabaseContext\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" :\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"IdentityDbContext\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"ApplicationUser\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\"\u003e, \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6F42C1\"},\"children\":\"IDatabaseContext\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#24292E\"},\"children\":\" \"}]]}]}]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Migrating from Asp.Net Membership to Identity is not something that can be done for the first time under few hours. In fact, it took me around 12 hours to figure out that I had to inherit from IdentityDbContext and to solve several seeding problem. Also, having to use Entity Framework changed a little but how to use the user information. Nevertheless, the time is not exponential since it concerns only users and roles entities. I believe that it should take less than a day for someone who have all the information.\"}]]]}]]}],[\"$\",\"div\",null,{\"className\":\"layout_paginationBar__jnuuR\",\"children\":[[\"$\",\"div\",null,{\"className\":\"layout_paginationTitle__PsOw5\",\"children\":\"Chronological Blog Articles by Page\"}],[\"$\",\"div\",null,{\"className\":\"layout_paginationLinks__LdBaH\",\"children\":[[\"$\",\"$Lb\",\"1\",{\"className\":\"\",\"href\":\"/blog/page/1\",\"children\":1}],[\"$\",\"$Lb\",\"2\",{\"className\":\"\",\"href\":\"/blog/page/2\",\"children\":2}],[\"$\",\"$Lb\",\"3\",{\"className\":\"\",\"href\":\"/blog/page/3\",\"children\":3}],[\"$\",\"$Lb\",\"4\",{\"className\":\"\",\"href\":\"/blog/page/4\",\"children\":4}],[\"$\",\"$Lb\",\"5\",{\"className\":\"\",\"href\":\"/blog/page/5\",\"children\":5}],[\"$\",\"$Lb\",\"6\",{\"className\":\"\",\"href\":\"/blog/page/6\",\"children\":6}],[\"$\",\"$Lb\",\"7\",{\"className\":\"\",\"href\":\"/blog/page/7\",\"children\":7}],[\"$\",\"$Lb\",\"8\",{\"className\":\"\",\"href\":\"/blog/page/8\",\"children\":8}],[\"$\",\"$Lb\",\"9\",{\"className\":\"\",\"href\":\"/blog/page/9\",\"children\":9}],[\"$\",\"$Lb\",\"10\",{\"className\":\"\",\"href\":\"/blog/page/10\",\"children\":10}],[\"$\",\"$Lb\",\"11\",{\"className\":\"\",\"href\":\"/blog/page/11\",\"children\":11}],[\"$\",\"$Lb\",\"12\",{\"className\":\"\",\"href\":\"/blog/page/12\",\"children\":12}],[\"$\",\"$Lb\",\"13\",{\"className\":\"\",\"href\":\"/blog/page/13\",\"children\":13}],[\"$\",\"$Lb\",\"14\",{\"className\":\"\",\"href\":\"/blog/page/14\",\"children\":14}],[\"$\",\"$Lb\",\"15\",{\"className\":\"\",\"href\":\"/blog/page/15\",\"children\":15}],[\"$\",\"$Lb\",\"16\",{\"className\":\"\",\"href\":\"/blog/page/16\",\"children\":16}],[\"$\",\"$Lb\",\"17\",{\"className\":\"\",\"href\":\"/blog/page/17\",\"children\":17}],[\"$\",\"$Lb\",\"18\",{\"className\":\"\",\"href\":\"/blog/page/18\",\"children\":18}],[\"$\",\"$Lb\",\"19\",{\"className\":\"\",\"href\":\"/blog/page/19\",\"children\":19}],[\"$\",\"$Lb\",\"20\",{\"className\":\"\",\"href\":\"/blog/page/20\",\"children\":20}],[\"$\",\"$Lb\",\"21\",{\"className\":\"\",\"href\":\"/blog/page/21\",\"children\":21}],[\"$\",\"$Lb\",\"22\",{\"className\":\"\",\"href\":\"/blog/page/22\",\"children\":22}],[\"$\",\"$Lb\",\"23\",{\"className\":\"\",\"href\":\"/blog/page/23\",\"children\":23}],[\"$\",\"$Lb\",\"24\",{\"className\":\"\",\"href\":\"/blog/page/24\",\"children\":24}],[\"$\",\"$Lb\",\"25\",{\"className\":\"\",\"href\":\"/blog/page/25\",\"children\":25}],[\"$\",\"$Lb\",\"26\",{\"className\":\"\",\"href\":\"/blog/page/26\",\"children\":26}],[\"$\",\"$Lb\",\"27\",{\"className\":\"\",\"href\":\"/blog/page/27\",\"children\":27}],[\"$\",\"$Lb\",\"28\",{\"className\":\"\",\"href\":\"/blog/page/28\",\"children\":28}],[\"$\",\"$Lb\",\"29\",{\"className\":\"\",\"href\":\"/blog/page/29\",\"children\":29}],[\"$\",\"$Lb\",\"30\",{\"className\":\"\",\"href\":\"/blog/page/30\",\"children\":30}],[\"$\",\"$Lb\",\"31\",{\"className\":\"\",\"href\":\"/blog/page/31\",\"children\":31}],[\"$\",\"$Lb\",\"32\",{\"className\":\"\",\"href\":\"/blog/page/32\",\"children\":32}],[\"$\",\"$Lb\",\"33\",{\"className\":\"\",\"href\":\"/blog/page/33\",\"children\":33}],[\"$\",\"$Lb\",\"34\",{\"className\":\"\",\"href\":\"/blog/page/34\",\"children\":34}],[\"$\",\"$Lb\",\"35\",{\"className\":\"\",\"href\":\"/blog/page/35\",\"children\":35}],[\"$\",\"$Lb\",\"36\",{\"className\":\"\",\"href\":\"/blog/page/36\",\"children\":36}],[\"$\",\"$Lb\",\"37\",{\"className\":\"\",\"href\":\"/blog/page/37\",\"children\":37}],[\"$\",\"$Lb\",\"38\",{\"className\":\"\",\"href\":\"/blog/page/38\",\"children\":38}],[\"$\",\"$Lb\",\"39\",{\"className\":\"\",\"href\":\"/blog/page/39\",\"children\":39}],[\"$\",\"$Lb\",\"40\",{\"className\":\"\",\"href\":\"/blog/page/40\",\"children\":40}],[\"$\",\"$Lb\",\"41\",{\"className\":\"\",\"href\":\"/blog/page/41\",\"children\":41}],[\"$\",\"$Lb\",\"42\",{\"className\":\"\",\"href\":\"/blog/page/42\",\"children\":42}],[\"$\",\"$Lb\",\"43\",{\"className\":\"\",\"href\":\"/blog/page/43\",\"children\":43}],[\"$\",\"$Lb\",\"44\",{\"className\":\"\",\"href\":\"/blog/page/44\",\"children\":44}],[\"$\",\"$Lb\",\"45\",{\"className\":\"\",\"href\":\"/blog/page/45\",\"children\":45}],[\"$\",\"$Lb\",\"46\",{\"className\":\"\",\"href\":\"/blog/page/46\",\"children\":46}],[\"$\",\"$Lb\",\"47\",{\"className\":\"\",\"href\":\"/blog/page/47\",\"children\":47}],[\"$\",\"$Lb\",\"48\",{\"className\":\"\",\"href\":\"/blog/page/48\",\"children\":48}],[\"$\",\"$Lb\",\"49\",{\"className\":\"\",\"href\":\"/blog/page/49\",\"children\":49}],[\"$\",\"$Lb\",\"50\",{\"className\":\"\",\"href\":\"/blog/page/50\",\"children\":50}],[\"$\",\"$Lb\",\"51\",{\"className\":\"\",\"href\":\"/blog/page/51\",\"children\":51}],[\"$\",\"$Lb\",\"52\",{\"className\":\"\",\"href\":\"/blog/page/52\",\"children\":52}],[\"$\",\"$Lb\",\"53\",{\"className\":\"\",\"href\":\"/blog/page/53\",\"children\":53}],[\"$\",\"$Lb\",\"54\",{\"className\":\"\",\"href\":\"/blog/page/54\",\"children\":54}],[\"$\",\"$Lb\",\"55\",{\"className\":\"\",\"href\":\"/blog/page/55\",\"children\":55}],[\"$\",\"$Lb\",\"56\",{\"className\":\"\",\"href\":\"/blog/page/56\",\"children\":56}],[\"$\",\"$Lb\",\"57\",{\"className\":\"\",\"href\":\"/blog/page/57\",\"children\":57}],[\"$\",\"$Lb\",\"58\",{\"className\":\"\",\"href\":\"/blog/page/58\",\"children\":58}],[\"$\",\"$Lb\",\"59\",{\"className\":\"\",\"href\":\"/blog/page/59\",\"children\":59}],[\"$\",\"$Lb\",\"60\",{\"className\":\"\",\"href\":\"/blog/page/60\",\"children\":60}],[\"$\",\"$Lb\",\"61\",{\"className\":\"\",\"href\":\"/blog/page/61\",\"children\":61}],[\"$\",\"$Lb\",\"62\",{\"className\":\"\",\"href\":\"/blog/page/62\",\"children\":62}],[\"$\",\"$Lb\",\"63\",{\"className\":\"\",\"href\":\"/blog/page/63\",\"children\":63}],[\"$\",\"$Lb\",\"64\",{\"className\":\"\",\"href\":\"/blog/page/64\",\"children\":64}],[\"$\",\"$Lb\",\"65\",{\"className\":\"\",\"href\":\"/blog/page/65\",\"children\":65}],[\"$\",\"$Lb\",\"66\",{\"className\":\"\",\"href\":\"/blog/page/66\",\"children\":66}],[\"$\",\"$Lb\",\"67\",{\"className\":\"\",\"href\":\"/blog/page/67\",\"children\":67}],[\"$\",\"$Lb\",\"68\",{\"className\":\"\",\"href\":\"/blog/page/68\",\"children\":68}],[\"$\",\"$Lb\",\"69\",{\"className\":\"\",\"href\":\"/blog/page/69\",\"children\":69}],[\"$\",\"$Lb\",\"70\",{\"className\":\"\",\"href\":\"/blog/page/70\",\"children\":70}],[\"$\",\"$Lb\",\"71\",{\"className\":\"\",\"href\":\"/blog/page/71\",\"children\":71}],[\"$\",\"$Lb\",\"72\",{\"className\":\"\",\"href\":\"/blog/page/72\",\"children\":72}],[\"$\",\"$Lb\",\"73\",{\"className\":\"\",\"href\":\"/blog/page/73\",\"children\":73}],[\"$\",\"$Lb\",\"74\",{\"className\":\"\",\"href\":\"/blog/page/74\",\"children\":74}],[\"$\",\"$Lb\",\"75\",{\"className\":\"\",\"href\":\"/blog/page/75\",\"children\":75}],[\"$\",\"$Lb\",\"76\",{\"className\":\"\",\"href\":\"/blog/page/76\",\"children\":76}],[\"$\",\"$Lb\",\"77\",{\"className\":\"\",\"href\":\"/blog/page/77\",\"children\":77}]]}]]}]]}]}]\n"])</script><script>self.__next_f.push([1,""])</script></body></html>