<!DOCTYPE html><html lang="en" class="layout_htmlstyle__PseMz"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="/_next/static/css/4cb872a2a77e328a.css" data-precedence="next"/><link rel="stylesheet" href="/_next/static/css/dabd5e64a469b0e1.css" data-precedence="next"/><link rel="stylesheet" href="/_next/static/css/be8a59717d6d5849.css" data-precedence="next"/><link rel="stylesheet" href="/_next/static/css/97e0a79122e618e4.css" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/_next/static/chunks/webpack-188179cb5c453018.js"/><script src="/_next/static/chunks/e6fd6439-a5511cc740ad3b19.js" async=""></script><script src="/_next/static/chunks/678-bd43f018bb7bbf22.js" async=""></script><script src="/_next/static/chunks/main-app-011116b4058f6717.js" async=""></script><script src="/_next/static/chunks/534-bc4bf8794653d52f.js" async=""></script><script src="/_next/static/chunks/449-07387e3734c92aeb.js" async=""></script><script src="/_next/static/chunks/app/blog/%5Bslug%5D/page-5279e1ccd7c02190.js" async=""></script><title>Patrick Desjardins Blog - Migrating Asp.Net MemberShip to Asp.Net MVC Identity for authentification</title><meta name="description" content="Migrating Asp.Net MemberShip to Asp.Net MVC Identity for authentification"/><script src="/_next/static/chunks/polyfills-42372ed130431b0a.js" noModule=""></script></head><body class="layout_bodystyle__4ncsS"><div class="layout_blogbodystyle___Uc1w"><div class="BlogBody_BlogBody__600mT"><header class="BlogBody_siteTitle__f7uyb">Patrick Desjardins Blog</header><nav><ul class="BlogBody_navLinks__ZV12t"><li class="BlogBody_navLinkItem__Pml2e"><a class="BlogBody_navLinkText__ZtH2y" href="/">Main Page</a><a class="BlogBody_navLinkText__ZtH2y" href="/blog">Blog</a><a class="BlogBody_navLinkText__ZtH2y" href="/blog/search">Search</a><a class="BlogBody_navLinkText__ZtH2y" href="/blog/for/2025">2025</a><a class="BlogBody_navLinkText__ZtH2y" href="/blog/for/2024">2024</a><a class="BlogBody_navLinkText__ZtH2y" href="/blog/for/2023">2023</a><a class="BlogBody_navLinkText__ZtH2y" href="/blog/for/2022">2022</a><a class="BlogBody_navLinkText__ZtH2y" href="/blog/for/2021">2021</a><a class="BlogBody_navLinkText__ZtH2y" href="/blog/for/2020">2020</a><a class="BlogBody_navLinkText__ZtH2y" href="/blog/for/2019">2019</a><a class="BlogBody_navLinkText__ZtH2y" href="/blog/for/2018">2018</a><a class="BlogBody_navLinkText__ZtH2y" href="/blog/for/2017">2017</a><a class="BlogBody_navLinkText__ZtH2y" href="/blog/for/2016">2016</a><a class="BlogBody_navLinkText__ZtH2y" href="/blog/for/2015">2015</a><a class="BlogBody_navLinkText__ZtH2y" href="/blog/for/2014">2014</a><a class="BlogBody_navLinkText__ZtH2y" href="/blog/for/2013">2013</a><a class="BlogBody_navLinkText__ZtH2y" href="/blog/for/2012">2012</a><a class="BlogBody_navLinkText__ZtH2y" href="/blog/for/2011">2011</a></li></ul></nav><div class="BlogBody_blogPictureContainer__IAbPL"><img alt="Patrick Desjardins picture from a conference" loading="lazy" width="800" height="260" decoding="async" data-nimg="1" class="BlogBody_blogTopPicture__L6lao" style="color:transparent" src="/images/backgrounds/patrickdesjardins_conference_bw.webp"/></div><main class="BlogBody_main__XrdKY"><h1 class="BlogBody_heading__bYRBe">Migrating Asp.Net MemberShip to Asp.Net MVC Identity for authentification</h1><div class="Page_blogPostContainer__AUIcf"><p class="Page_blogPostDate__wVWWB">Posted on: <!-- -->2014-01-27</p><p>I was using WebMatrix with the <a href="https://github.com/MrDesjardins/GymWorkout">Gym Workout project</a>. But, it wasn&#x27;t a clean way to handle authentification. It was in the middle of the old membership with a new flavor. However, since Microsoft is going with the new <a href="http://www.asp.net/identity/overview/getting-started/introduction-to-aspnet-identity">One Asp.Net Owin Identity framework</a> which allow to use claims but also to be dissociate from Microsoft Sql Server make it more appealing. It&#x27;s also on the frame of OWIN, so we have almost all positive features without the negative parts. Finally, Identity does have the clean way to have custom field to extend default username/password attribute. It&#x27;s clean because it creates specific columns for each field. So, if you have an existing Asp.Net MVC, how do you upgrade to the Identity framework for authentification? This is what I will explain in this Identity tutorial.</p>
<p>First, some libraries are required.</p>
<ul>
<li>Microsoft.AspNet.Identity.EntityFramework</li>
<li>Microsoft.AspNet.Identity.Core</li>
<li>Microsoft.AspNet.Identity.OWIN</li>
</ul>
<p>This can be found by using Nuget with the following command:</p>
<pre class="language-powershell"><code class="language-powershell code-highlight"><span class="code-line"> PM&gt; <span class="token function">Install-Package</span> Microsoft<span class="token punctuation">.</span>AspNet<span class="token punctuation">.</span>Identity<span class="token punctuation">.</span>Core 
</span><span class="code-line"> PM&gt; <span class="token function">Install-Package</span> Microsoft<span class="token punctuation">.</span>AspNet<span class="token punctuation">.</span>Identity<span class="token punctuation">.</span>Owin 
</span><span class="code-line"> PM&gt; <span class="token function">Install-Package</span> Microsoft<span class="token punctuation">.</span>AspNet<span class="token punctuation">.</span>Identity<span class="token punctuation">.</span>EntityFramework 
</span><span class="code-line"> PM&gt; <span class="token function">Install-Package</span> Microsoft<span class="token punctuation">.</span>Owin<span class="token punctuation">.</span>Host<span class="token punctuation">.</span>SystemWeb 
</span></code></pre>
<p>The next step was to get rid of everything concerning the user which was in its own class called for the project &quot;UserProfile&quot;. Instead, I created a new class called &quot;ApplicationUser&quot; which inherit from the default one of Identity framework. I removed the WebUserProvider because now, it will use Entity Framework to get user information. Providers are not required and everything will go with the service layer, to the data access layer to the database with Entity Framework (EF). The AccountModel (is in fact the view model) still exist which allow to have our custom fields like the Role, Language and Email in the view. Everything is bound to the model class ApplicationUser.</p>
<pre class="language-csharp"><code class="language-csharp code-highlight"><span class="code-line"> <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ApplicationUser</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">IdentityUser</span><span class="token punctuation">,</span> <span class="token class-name">ICurrentUser</span></span> <span class="token punctuation">{</span> <span class="token keyword">public</span> <span class="token function">ApplicationUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> Email <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span> Language <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> UserId <span class="token punctuation">{</span> <span class="token keyword">get</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token keyword">base</span><span class="token punctuation">.</span>Id<span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token keyword">set</span><span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token punctuation">}</span> <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Email <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Language <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span> 
</span></code></pre>
<p>Even if the ApplicationUser inherit from IdentityUser which as a Id property, the ICurrentUser that we had previously use the UserId property. This is why this one is defined in ApplicationUser and link to the IdentityUser one. The only thing that we will do later is to ignore this property to not have the data inside the database. We also need to create a ApplicationUserService that contact the Data Access Layer.</p>
<p>A major change concerns the ServiceFactory class which has every entities service classes. Since the Account come from the database and that we do not want to go to the database every time one of the entity require to have something related to the user logged, they need to share the same account. This require a change in the constructor that is going to take in its constructor the IUserProvider which has a property Account. This one is passed to every service constructor.</p>
<pre class="language-csharp"><code class="language-csharp code-highlight"><span class="code-line"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ServiceFactory</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">IServiceFactory</span></span> <span class="token punctuation">{</span> <span class="token keyword">private</span> IUserProvider_userProvider<span class="token punctuation">;</span> #region Implementation of IServiceFactory
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">public</span> <span class="token return-type class-name">IAccountService</span> Account <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">private</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token keyword">public</span> <span class="token return-type class-name">IMuscleService</span> Muscle <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">private</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token keyword">public</span> <span class="token return-type class-name">IWorkoutService</span> Workout <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">private</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token keyword">public</span> <span class="token return-type class-name">IWorkoutSessionService</span> WorkoutSession <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">private</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token keyword">public</span> <span class="token return-type class-name">IWorkoutSessionExerciseService</span> WorkoutSessionExercise <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">private</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">public</span> <span class="token return-type class-name">IExerciseService</span> Exercise <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">private</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token preprocessor property">#<span class="token directive keyword">endregion</span></span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">public</span> <span class="token function">ServiceFactory</span><span class="token punctuation">(</span><span class="token class-name">IRepositoryFactory</span> repositoryFactory<span class="token punctuation">,</span> <span class="token class-name">IMapperFactory</span> mapperFactory<span class="token punctuation">,</span> <span class="token class-name">IUserProvider</span> userProvider<span class="token punctuation">)</span> <span class="token punctuation">{</span>_userProvider <span class="token operator">=</span> userProvider<span class="token punctuation">;</span> <span class="token class-name"><span class="token keyword">var</span></span> account <span class="token operator">=</span>_userProvider<span class="token punctuation">.</span>Account<span class="token punctuation">;</span> Account <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ApplicationUserService</span><span class="token punctuation">(</span>repositoryFactory<span class="token punctuation">,</span> mapperFactory<span class="token punctuation">)</span><span class="token punctuation">;</span> Muscle <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">MuscleService</span><span class="token punctuation">(</span>repositoryFactory<span class="token punctuation">,</span> mapperFactory<span class="token punctuation">,</span> account<span class="token punctuation">)</span><span class="token punctuation">;</span> Workout <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">WorkoutService</span><span class="token punctuation">(</span>repositoryFactory<span class="token punctuation">,</span> mapperFactory<span class="token punctuation">,</span> account<span class="token punctuation">)</span><span class="token punctuation">;</span> WorkoutSession <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">WorkoutSessionService</span><span class="token punctuation">(</span>repositoryFactory<span class="token punctuation">,</span> mapperFactory<span class="token punctuation">,</span> account<span class="token punctuation">)</span><span class="token punctuation">;</span> WorkoutSessionExercise <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">WorkoutSessionExerciseService</span><span class="token punctuation">(</span>repositoryFactory<span class="token punctuation">,</span> mapperFactory<span class="token punctuation">,</span> account<span class="token punctuation">)</span><span class="token punctuation">;</span> Exercise <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ExerciseService</span><span class="token punctuation">(</span>repositoryFactory<span class="token punctuation">,</span> mapperFactory<span class="token punctuation">,</span> Muscle<span class="token punctuation">,</span> account<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span> 
</span></code></pre>
<p>Entities inherit of BaseService.</p>
<pre class="language-csharp"><code class="language-csharp code-highlight"><span class="code-line"> <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">BaseService</span> <span class="token punctuation">{</span> <span class="token keyword">public</span> <span class="token function">BaseService</span><span class="token punctuation">(</span><span class="token class-name">IRepositoryFactory</span> repositoryFactory<span class="token punctuation">,</span> <span class="token class-name">IMapperFactory</span> mapperFactory<span class="token punctuation">,</span> <span class="token class-name">ICurrentUser</span> user<span class="token punctuation">)</span> <span class="token punctuation">{</span> Repository <span class="token operator">=</span> repositoryFactory<span class="token punctuation">;</span> Mapper <span class="token operator">=</span> mapperFactory<span class="token punctuation">;</span> Repository<span class="token punctuation">.</span><span class="token function">SetUser</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">protected</span> <span class="token return-type class-name">IRepositoryFactory</span> Repository <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">private</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token keyword">protected</span> <span class="token return-type class-name">IMapperFactory</span> Mapper <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">private</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span> 
</span></code></pre>
<p>When the service is initialized, it uses the injected Repository to set the user that is also injected. Since the ServiceFactory calls the Account once, one call is done to the database. After, it only set the object to the repository which could be used later.</p>
<p>The concept of IUserProvider remains. This is because we will use a <em>WebUserProvider</em> for the Asp.Net MVC and a <em>WebServiceUserProvider</em>.</p>
<p>The Global.asax.cs file changes because it does not use anymore the <code>AuthConfig.RegisterAuth()</code> because the Identity with OWIN does have a Startup page in the App folder.</p>
<pre class="language-csharp"><code class="language-csharp code-highlight"><span class="code-line"> <span class="token keyword">public</span> <span class="token keyword">partial</span> <span class="token keyword">class</span> <span class="token class-name">Startup</span> <span class="token punctuation">{</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token comment">// For more information on configuring authentication, please visit http://go.microsoft.com/fwlink/?LinkId=301864 public void ConfigureAuth(IAppBuilder app) { // Enable the application to use a cookie to store information for the signed in user app.UseCookieAuthentication(new CookieAuthenticationOptions { AuthenticationType = DefaultAuthenticationTypes.ApplicationCookie, LoginPath = new PathString(&quot;/Account/Login&quot;) }); // Use a cookie to temporarily store information about a user logging in with a third party login provider app.UseExternalSignInCookie(DefaultAuthenticationTypes.ExternalCookie); }</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token punctuation">}</span> 
</span></code></pre>
<p>This also require to register the Startup class with another Startup class that is used as a bootstrapper for the OWIN container.</p>
<pre class="language-csharp"><code class="language-csharp code-highlight"><span class="code-line"> <span class="token keyword">using</span> <span class="token namespace">Owin</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token punctuation">[</span><span class="token attribute"><span class="token target keyword">assembly</span><span class="token punctuation">:</span> <span class="token class-name">OwinStartup</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token type-expression class-name">WorkoutPlanner<span class="token punctuation">.</span>Startup</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span> <span class="token keyword">namespace</span> <span class="token namespace">WorkoutPlanner</span> <span class="token punctuation">{</span> <span class="token keyword">public</span> <span class="token keyword">partial</span> <span class="token keyword">class</span> <span class="token class-name">Startup</span> <span class="token punctuation">{</span> <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Configuration</span><span class="token punctuation">(</span><span class="token class-name">IAppBuilder</span> app<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token function">ConfigureAuth</span><span class="token punctuation">(</span>app<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span> 
</span></code></pre>
<p>Notice the assembly instruction that tell which class is used for OwinStartup. It uses two classes but could use one. the only benefit of splitting the class in two is to have one statup entry and the code to configure somewhere else. This could later uncluttered the booting class.</p>
<p>The migration changes also. The Seed method does not use the WebSecurity to initialize default user. It uses the ApplicationUser class with the UserStore and UserManager class that use Entity Framework to work with the database.</p>
<p>To create the database with all Identity classes and all the business classes, the migration command in the package console is required. The</p>
<pre class="language-powershell"><code class="language-powershell code-highlight"><span class="code-line"> <span class="token function">update-database</span> <span class="token operator">-</span>ConfigurationTypeName <span class="token string">&quot;Configuration&quot;</span> 
</span></code></pre>
<p>This works because the Configuration class inherit of <em>DbMigrationsConfigurations</em> which allow the migration tool to be executed. It takes the database context to be used. In our case, it&#x27;s the one that contains every entities of the application.</p>
<pre class="language-csharp"><code class="language-csharp code-highlight"><span class="code-line"> <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Configuration</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">DbMigrationsConfiguration<span class="token punctuation">&lt;</span>DatabaseContext<span class="token punctuation">&gt;</span></span></span><span class="token comment">//&lt;DatabaseContext&gt; { public Configuration() { base.AutomaticMigrationsEnabled = true; }</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">protected</span> <span class="token keyword">override</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Seed</span><span class="token punctuation">(</span><span class="token class-name">DatabaseContext</span> context<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token class-name"><span class="token keyword">var</span></span> userStore <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">UserStore<span class="token punctuation">&lt;</span>ApplicationUser<span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token class-name"><span class="token keyword">var</span></span> manager <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">UserManager<span class="token punctuation">&lt;</span>ApplicationUser<span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>userStore<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token class-name"><span class="token keyword">var</span></span> role <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">IdentityUserRole</span> <span class="token punctuation">{</span> Role <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">IdentityRole</span><span class="token punctuation">(</span>Model<span class="token punctuation">.</span>Roles<span class="token punctuation">.</span>ADMINISTRATOR<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token class-name"><span class="token keyword">var</span></span> user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ApplicationUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> UserName <span class="token operator">=</span> <span class="token string">&quot;123123&quot;</span><span class="token punctuation">,</span> Email <span class="token operator">=</span> <span class="token string">&quot;123123@123.com&quot;</span><span class="token punctuation">,</span> Language <span class="token operator">=</span> <span class="token string">&quot;en-US&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span> user<span class="token punctuation">.</span>Roles<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>role<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token class-name">IdentityResult</span> result <span class="token operator">=</span> manager<span class="token punctuation">.</span><span class="token function">Create</span><span class="token punctuation">(</span>user<span class="token punctuation">,</span> <span class="token string">&quot;123123&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token class-name"><span class="token keyword">var</span></span> role2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">IdentityUserRole</span> <span class="token punctuation">{</span> Role <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">IdentityRole</span><span class="token punctuation">(</span>Model<span class="token punctuation">.</span>Roles<span class="token punctuation">.</span>NORMAL<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token class-name"><span class="token keyword">var</span></span> user2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ApplicationUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> UserName <span class="token operator">=</span> <span class="token string">&quot;qweqwe&quot;</span><span class="token punctuation">,</span> Email <span class="token operator">=</span> <span class="token string">&quot;qweqwe@qweqwe.com&quot;</span><span class="token punctuation">,</span> Language <span class="token operator">=</span> <span class="token string">&quot;fr-CA&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span> user<span class="token punctuation">.</span>Roles<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>role2<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token class-name">IdentityResult</span> result2 <span class="token operator">=</span> manager<span class="token punctuation">.</span><span class="token function">Create</span><span class="token punctuation">(</span>user2<span class="token punctuation">,</span> <span class="token string">&quot;qweqwe&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token class-name"><span class="token keyword">var</span></span> muscles <span class="token operator">=</span> <span class="token keyword">new</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">Muscle</span> <span class="token punctuation">{</span> Id <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> Name <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">LocalizedString</span> <span class="token punctuation">{</span> French <span class="token operator">=</span> <span class="token string">&quot;Cou&quot;</span><span class="token punctuation">,</span> English <span class="token operator">=</span> <span class="token string">&quot;Neck&quot;</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Muscle</span> <span class="token punctuation">{</span> Id <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span> Name <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">LocalizedString</span> <span class="token punctuation">{</span> French <span class="token operator">=</span> <span class="token string">&quot;Épaule&quot;</span><span class="token punctuation">,</span> English <span class="token operator">=</span> <span class="token string">&quot;Shoulder&quot;</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">context<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Set</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Muscle<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">AddOrUpdateRange</span><span class="token punctuation">(</span>muscles<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//... and so on... base.Seed(context); } } </span>
</span></code></pre>
<p>When working with Asp.Net Identity one key is to have your database context class inherit from IdentityDbContext and not directly from DbContext. Otherwise, you will get that keys are not defined for IdentityUserLogin, IdentityUserRole, IdentityUserLogins and IdentityUserRoles.</p>
<pre class="language-plaintext"><code class="language-plaintext code-highlight"><span class="code-line"> DataAccessLayer.Database.IdentityUserLogin: : EntityType &#x27;IdentityUserLogin&#x27; has no key defined. Define the key for this EntityType. DataAccessLayer.Database.IdentityUserRole: : EntityType &#x27;IdentityUserRole&#x27; has no key defined. Define the key for this EntityType. IdentityUserLogins: EntityType: EntitySet &#x27;IdentityUserLogins&#x27; is based on type &#x27;IdentityUserLogin&#x27; that has no keys defined. IdentityUserRoles: EntityType: EntitySet &#x27;IdentityUserRoles&#x27; is based on type &#x27;IdentityUserRole&#x27; that has no keys defined. 
</span></code></pre>
<pre class="language-csharp"><code class="language-csharp code-highlight"><span class="code-line"> <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DatabaseContext</span> <span class="token punctuation">:</span><span class="token type-list"><span class="token class-name">IdentityDbContext<span class="token punctuation">&lt;</span>ApplicationUser<span class="token punctuation">&gt;</span></span><span class="token punctuation">,</span> <span class="token class-name">IDatabaseContext</span></span> 
</span></code></pre>
<p>Migrating from Asp.Net Membership to Identity is not something that can be done for the first time under few hours. In fact, it took me around 12 hours to figure out that I had to inherit from IdentityDbContext and to solve several seeding problem. Also, having to use Entity Framework changed a little but how to use the user information. Nevertheless, the time is not exponential since it concerns only users and roles entities. I believe that it should take less than a day for someone who have all the information.</p></div></main><div class="BlogBody_paginationBar__1gsMc"><div class="BlogBody_paginationTitle__H_eFX">Chronological Blog Articles by Page</div><div class="BlogBody_paginationLinks__nk8zd"><a class="" href="/blog/page/1">1</a><a class="" href="/blog/page/2">2</a><a class="" href="/blog/page/3">3</a><a class="" href="/blog/page/4">4</a><a class="" href="/blog/page/5">5</a><a class="" href="/blog/page/6">6</a><a class="" href="/blog/page/7">7</a><a class="" href="/blog/page/8">8</a><a class="" href="/blog/page/9">9</a><a class="" href="/blog/page/10">10</a><a class="" href="/blog/page/11">11</a><a class="" href="/blog/page/12">12</a><a class="" href="/blog/page/13">13</a><a class="" href="/blog/page/14">14</a><a class="" href="/blog/page/15">15</a><a class="" href="/blog/page/16">16</a><a class="" href="/blog/page/17">17</a><a class="" href="/blog/page/18">18</a><a class="" href="/blog/page/19">19</a><a class="" href="/blog/page/20">20</a><a class="" href="/blog/page/21">21</a><a class="" href="/blog/page/22">22</a><a class="" href="/blog/page/23">23</a><a class="" href="/blog/page/24">24</a><a class="" href="/blog/page/25">25</a><a class="" href="/blog/page/26">26</a><a class="" href="/blog/page/27">27</a><a class="" href="/blog/page/28">28</a><a class="" href="/blog/page/29">29</a><a class="" href="/blog/page/30">30</a><a class="" href="/blog/page/31">31</a><a class="" href="/blog/page/32">32</a><a class="" href="/blog/page/33">33</a><a class="" href="/blog/page/34">34</a><a class="" href="/blog/page/35">35</a><a class="" href="/blog/page/36">36</a><a class="" href="/blog/page/37">37</a><a class="" href="/blog/page/38">38</a><a class="" href="/blog/page/39">39</a><a class="" href="/blog/page/40">40</a><a class="" href="/blog/page/41">41</a><a class="" href="/blog/page/42">42</a><a class="" href="/blog/page/43">43</a><a class="" href="/blog/page/44">44</a><a class="" href="/blog/page/45">45</a><a class="" href="/blog/page/46">46</a><a class="" href="/blog/page/47">47</a><a class="" href="/blog/page/48">48</a><a class="" href="/blog/page/49">49</a><a class="" href="/blog/page/50">50</a><a class="" href="/blog/page/51">51</a><a class="" href="/blog/page/52">52</a><a class="" href="/blog/page/53">53</a><a class="" href="/blog/page/54">54</a><a class="" href="/blog/page/55">55</a><a class="" href="/blog/page/56">56</a><a class="" href="/blog/page/57">57</a><a class="" href="/blog/page/58">58</a><a class="" href="/blog/page/59">59</a><a class="" href="/blog/page/60">60</a><a class="" href="/blog/page/61">61</a><a class="" href="/blog/page/62">62</a><a class="" href="/blog/page/63">63</a><a class="" href="/blog/page/64">64</a><a class="" href="/blog/page/65">65</a><a class="" href="/blog/page/66">66</a><a class="" href="/blog/page/67">67</a><a class="" href="/blog/page/68">68</a><a class="" href="/blog/page/69">69</a><a class="" href="/blog/page/70">70</a><a class="" href="/blog/page/71">71</a><a class="" href="/blog/page/72">72</a><a class="" href="/blog/page/73">73</a><a class="" href="/blog/page/74">74</a><a class="" href="/blog/page/75">75</a><a class="" href="/blog/page/76">76</a><a class="" href="/blog/page/77">77</a><a class="" href="/blog/page/78">78</a><a class="" href="/blog/page/79">79</a><a class="" href="/blog/page/80">80</a></div></div></div></div><script src="/_next/static/chunks/webpack-188179cb5c453018.js" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0]);self.__next_f.push([2,null])</script><script>self.__next_f.push([1,"1:HL[\"/_next/static/css/4cb872a2a77e328a.css\",\"style\"]\n2:HL[\"/_next/static/css/dabd5e64a469b0e1.css\",\"style\"]\n3:HL[\"/_next/static/css/be8a59717d6d5849.css\",\"style\"]\n4:HL[\"/_next/static/css/97e0a79122e618e4.css\",\"style\"]\n"])</script><script>self.__next_f.push([1,"5:I[1317,[],\"\"]\n8:I[8766,[],\"\"]\na:I[5623,[],\"\"]\nb:I[1534,[\"534\",\"static/chunks/534-bc4bf8794653d52f.js\",\"449\",\"static/chunks/449-07387e3734c92aeb.js\",\"308\",\"static/chunks/app/blog/%5Bslug%5D/page-5279e1ccd7c02190.js\"],\"\"]\nd:I[4896,[],\"\"]\n9:[\"slug\",\"migrating-asp-net-membershipt-to-asp-net-mvc-identity-for-authentification\",\"d\"]\ne:[]\n"])</script><script>self.__next_f.push([1,"0:[\"$\",\"$L5\",null,{\"buildId\":\"6rzbUp9-oDv5YygBl--JM\",\"assetPrefix\":\"\",\"urlParts\":[\"\",\"blog\",\"migrating-asp-net-membershipt-to-asp-net-mvc-identity-for-authentification\"],\"initialTree\":[\"\",{\"children\":[\"blog\",{\"children\":[[\"slug\",\"migrating-asp-net-membershipt-to-asp-net-mvc-identity-for-authentification\",\"d\"],{\"children\":[\"__PAGE__?{\\\"slug\\\":\\\"migrating-asp-net-membershipt-to-asp-net-mvc-identity-for-authentification\\\"}\",{}]}]}]},\"$undefined\",\"$undefined\",true],\"initialSeedData\":[\"\",{\"children\":[\"blog\",{\"children\":[[\"slug\",\"migrating-asp-net-membershipt-to-asp-net-mvc-identity-for-authentification\",\"d\"],{\"children\":[\"__PAGE__\",{},[[\"$L6\",\"$L7\",[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/be8a59717d6d5849.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\"}],[\"$\",\"link\",\"1\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/97e0a79122e618e4.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\"}]]],null],null]},[null,[\"$\",\"$L8\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"blog\",\"children\",\"$9\",\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$La\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\"}]],null]},[[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/dabd5e64a469b0e1.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\"}]],[\"$\",\"div\",null,{\"className\":\"layout_blogbodystyle___Uc1w\",\"children\":[\"$\",\"$L8\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"blog\",\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$La\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\"}]}]],null],null]},[[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/4cb872a2a77e328a.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\"}]],[\"$\",\"html\",null,{\"lang\":\"en\",\"className\":\"layout_htmlstyle__PseMz\",\"children\":[\"$\",\"body\",null,{\"className\":\"layout_bodystyle__4ncsS\",\"children\":[\"$\",\"$L8\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$La\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[\"$\",\"div\",null,{\"style\":{\"display\":\"flex\",\"alignItems\":\"center\",\"justifyContent\":\"center\",\"height\":\"100vh\"},\"children\":[\"$\",\"div\",null,{\"style\":{\"width\":\"50%\",\"height\":\"20%\",\"backgroundColor\":\"#ffeded\",\"borderRadius\":12,\"padding\":12,\"textAlign\":\"center\"},\"children\":[[\"$\",\"h1\",null,{\"children\":\"Not Found\"}],[\"$\",\"p\",null,{\"children\":\"Could not find requested resource\"}],[\"$\",\"$Lb\",null,{\"href\":\"/\",\"children\":\"Return Home\"}]]}]}],\"notFoundStyles\":[]}]}]}]],null],null],\"couldBeIntercepted\":false,\"initialHead\":[null,\"$Lc\"],\"globalErrorComponent\":\"$d\",\"missingSlots\":\"$We\"}]\n"])</script><script>self.__next_f.push([1,"f:I[3449,[\"534\",\"static/chunks/534-bc4bf8794653d52f.js\",\"449\",\"static/chunks/449-07387e3734c92aeb.js\",\"308\",\"static/chunks/app/blog/%5Bslug%5D/page-5279e1ccd7c02190.js\"],\"Image\"]\n"])</script><script>self.__next_f.push([1,"7:[\"$\",\"div\",null,{\"className\":\"BlogBody_BlogBody__600mT\",\"children\":[[\"$\",\"header\",null,{\"className\":\"BlogBody_siteTitle__f7uyb\",\"children\":\"Patrick Desjardins Blog\"}],[\"$\",\"nav\",null,{\"children\":[\"$\",\"ul\",null,{\"className\":\"BlogBody_navLinks__ZV12t\",\"children\":[\"$\",\"li\",null,{\"className\":\"BlogBody_navLinkItem__Pml2e\",\"children\":[[\"$\",\"$Lb\",null,{\"className\":\"BlogBody_navLinkText__ZtH2y\",\"href\":\"/\",\"children\":\"Main Page\"}],[\"$\",\"$Lb\",null,{\"className\":\"BlogBody_navLinkText__ZtH2y\",\"href\":\"/blog\",\"children\":\"Blog\"}],[\"$\",\"$Lb\",null,{\"className\":\"BlogBody_navLinkText__ZtH2y\",\"href\":\"/blog/search\",\"children\":\"Search\"}],[[\"$\",\"$Lb\",\"2025\",{\"className\":\"BlogBody_navLinkText__ZtH2y\",\"href\":\"/blog/for/2025\",\"children\":2025}],[\"$\",\"$Lb\",\"2024\",{\"className\":\"BlogBody_navLinkText__ZtH2y\",\"href\":\"/blog/for/2024\",\"children\":2024}],[\"$\",\"$Lb\",\"2023\",{\"className\":\"BlogBody_navLinkText__ZtH2y\",\"href\":\"/blog/for/2023\",\"children\":2023}],[\"$\",\"$Lb\",\"2022\",{\"className\":\"BlogBody_navLinkText__ZtH2y\",\"href\":\"/blog/for/2022\",\"children\":2022}],[\"$\",\"$Lb\",\"2021\",{\"className\":\"BlogBody_navLinkText__ZtH2y\",\"href\":\"/blog/for/2021\",\"children\":2021}],[\"$\",\"$Lb\",\"2020\",{\"className\":\"BlogBody_navLinkText__ZtH2y\",\"href\":\"/blog/for/2020\",\"children\":2020}],[\"$\",\"$Lb\",\"2019\",{\"className\":\"BlogBody_navLinkText__ZtH2y\",\"href\":\"/blog/for/2019\",\"children\":2019}],[\"$\",\"$Lb\",\"2018\",{\"className\":\"BlogBody_navLinkText__ZtH2y\",\"href\":\"/blog/for/2018\",\"children\":2018}],[\"$\",\"$Lb\",\"2017\",{\"className\":\"BlogBody_navLinkText__ZtH2y\",\"href\":\"/blog/for/2017\",\"children\":2017}],[\"$\",\"$Lb\",\"2016\",{\"className\":\"BlogBody_navLinkText__ZtH2y\",\"href\":\"/blog/for/2016\",\"children\":2016}],[\"$\",\"$Lb\",\"2015\",{\"className\":\"BlogBody_navLinkText__ZtH2y\",\"href\":\"/blog/for/2015\",\"children\":2015}],[\"$\",\"$Lb\",\"2014\",{\"className\":\"BlogBody_navLinkText__ZtH2y\",\"href\":\"/blog/for/2014\",\"children\":2014}],[\"$\",\"$Lb\",\"2013\",{\"className\":\"BlogBody_navLinkText__ZtH2y\",\"href\":\"/blog/for/2013\",\"children\":2013}],[\"$\",\"$Lb\",\"2012\",{\"className\":\"BlogBody_navLinkText__ZtH2y\",\"href\":\"/blog/for/2012\",\"children\":2012}],[\"$\",\"$Lb\",\"2011\",{\"className\":\"BlogBody_navLinkText__ZtH2y\",\"href\":\"/blog/for/2011\",\"children\":2011}]]]}]}]}],[\"$\",\"div\",null,{\"className\":\"BlogBody_blogPictureContainer__IAbPL\",\"children\":[\"$\",\"$Lf\",null,{\"className\":\"BlogBody_blogTopPicture__L6lao\",\"alt\":\"Patrick Desjardins picture from a conference\",\"src\":\"/images/backgrounds/patrickdesjardins_conference_bw.webp\",\"width\":800,\"height\":260}]}],[\"$\",\"main\",null,{\"className\":\"BlogBody_main__XrdKY\",\"children\":[[\"$\",\"h1\",null,{\"className\":\"BlogBody_heading__bYRBe\",\"children\":\"Migrating Asp.Net MemberShip to Asp.Net MVC Identity for authentification\"}],[\"$\",\"div\",null,{\"className\":\"Page_blogPostContainer__AUIcf\",\"children\":[[\"$\",\"p\",null,{\"className\":\"Page_blogPostDate__wVWWB\",\"children\":[\"Posted on: \",\"2014-01-27\"]}],[[\"$\",\"p\",null,{\"children\":[\"I was using WebMatrix with the \",[\"$\",\"a\",null,{\"href\":\"https://github.com/MrDesjardins/GymWorkout\",\"children\":\"Gym Workout project\"}],\". But, it wasn't a clean way to handle authentification. It was in the middle of the old membership with a new flavor. However, since Microsoft is going with the new \",[\"$\",\"a\",null,{\"href\":\"http://www.asp.net/identity/overview/getting-started/introduction-to-aspnet-identity\",\"children\":\"One Asp.Net Owin Identity framework\"}],\" which allow to use claims but also to be dissociate from Microsoft Sql Server make it more appealing. It's also on the frame of OWIN, so we have almost all positive features without the negative parts. Finally, Identity does have the clean way to have custom field to extend default username/password attribute. It's clean because it creates specific columns for each field. So, if you have an existing Asp.Net MVC, how do you upgrade to the Identity framework for authentification? This is what I will explain in this Identity tutorial.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"First, some libraries are required.\"}],\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":\"Microsoft.AspNet.Identity.EntityFramework\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"Microsoft.AspNet.Identity.Core\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"Microsoft.AspNet.Identity.OWIN\"}],\"\\n\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"This can be found by using Nuget with the following command:\"}],\"\\n\",[\"$\",\"pre\",null,{\"className\":\"language-powershell\",\"children\":[\"$\",\"code\",null,{\"className\":\"language-powershell code-highlight\",\"children\":[[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\" PM\u003e \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"Install-Package\"}],\" Microsoft\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"AspNet\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"Identity\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"Core \\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\" PM\u003e \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"Install-Package\"}],\" Microsoft\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"AspNet\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"Identity\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"Owin \\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\" PM\u003e \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"Install-Package\"}],\" Microsoft\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"AspNet\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"Identity\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"EntityFramework \\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\" PM\u003e \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"Install-Package\"}],\" Microsoft\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"Owin\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"Host\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"SystemWeb \\n\"]}]]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"The next step was to get rid of everything concerning the user which was in its own class called for the project \\\"UserProfile\\\". Instead, I created a new class called \\\"ApplicationUser\\\" which inherit from the default one of Identity framework. I removed the WebUserProvider because now, it will use Entity Framework to get user information. Providers are not required and everything will go with the service layer, to the data access layer to the database with Entity Framework (EF). The AccountModel (is in fact the view model) still exist which allow to have our custom fields like the Role, Language and Email in the view. Everything is bound to the model class ApplicationUser.\"}],\"\\n\",[\"$\",\"pre\",null,{\"className\":\"language-csharp\",\"children\":[\"$\",\"code\",null,{\"className\":\"language-csharp code-highlight\",\"children\":[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"public\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"class\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"ApplicationUser\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token type-list\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"IdentityUser\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"ICurrentUser\"}]]}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"public\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"ApplicationUser\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\" Email \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\" Language \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"public\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token return-type class-name\",\"children\":[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"string\"}]}],\" UserId \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"get\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"return\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"base\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"Id\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"set\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"public\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token return-type class-name\",\"children\":[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"string\"}]}],\" Email \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"get\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"set\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"public\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token return-type class-name\",\"children\":[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"string\"}]}],\" Language \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"get\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"set\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\" \\n\"]}]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Even if the ApplicationUser inherit from IdentityUser which as a Id property, the ICurrentUser that we had previously use the UserId property. This is why this one is defined in ApplicationUser and link to the IdentityUser one. The only thing that we will do later is to ignore this property to not have the data inside the database. We also need to create a ApplicationUserService that contact the Data Access Layer.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"A major change concerns the ServiceFactory class which has every entities service classes. Since the Account come from the database and that we do not want to go to the database every time one of the entity require to have something related to the user logged, they need to share the same account. This require a change in the constructor that is going to take in its constructor the IUserProvider which has a property Account. This one is passed to every service constructor.\"}],\"\\n\",[\"$\",\"pre\",null,{\"className\":\"language-csharp\",\"children\":[\"$\",\"code\",null,{\"className\":\"language-csharp code-highlight\",\"children\":[[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"public\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"class\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"ServiceFactory\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token type-list\",\"children\":[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"IServiceFactory\"}]}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"private\"}],\" IUserProvider_userProvider\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\" #region Implementation of IServiceFactory\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"public\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token return-type class-name\",\"children\":\"IAccountService\"}],\" Account \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"get\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"private\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"set\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"public\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token return-type class-name\",\"children\":\"IMuscleService\"}],\" Muscle \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"get\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"private\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"set\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"public\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token return-type class-name\",\"children\":\"IWorkoutService\"}],\" Workout \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"get\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"private\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"set\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"public\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token return-type class-name\",\"children\":\"IWorkoutSessionService\"}],\" WorkoutSession \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"get\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"private\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"set\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"public\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token return-type class-name\",\"children\":\"IWorkoutSessionExerciseService\"}],\" WorkoutSessionExercise \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"get\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"private\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"set\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"public\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token return-type class-name\",\"children\":\"IExerciseService\"}],\" Exercise \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"get\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"private\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"set\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token preprocessor property\",\"children\":[\"#\",[\"$\",\"span\",null,{\"className\":\"token directive keyword\",\"children\":\"endregion\"}]]}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"public\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"ServiceFactory\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"IRepositoryFactory\"}],\" repositoryFactory\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"IMapperFactory\"}],\" mapperFactory\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"IUserProvider\"}],\" userProvider\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"_userProvider \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" userProvider\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"var\"}]}],\" account \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\"_userProvider\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"Account\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\" Account \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"new\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token constructor-invocation class-name\",\"children\":\"ApplicationUserService\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"repositoryFactory\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" mapperFactory\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\" Muscle \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"new\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token constructor-invocation class-name\",\"children\":\"MuscleService\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"repositoryFactory\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" mapperFactory\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" account\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\" Workout \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"new\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token constructor-invocation class-name\",\"children\":\"WorkoutService\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"repositoryFactory\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" mapperFactory\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" account\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\" WorkoutSession \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"new\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token constructor-invocation class-name\",\"children\":\"WorkoutSessionService\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"repositoryFactory\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" mapperFactory\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" account\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\" WorkoutSessionExercise \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"new\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token constructor-invocation class-name\",\"children\":\"WorkoutSessionExerciseService\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"repositoryFactory\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" mapperFactory\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" account\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\" Exercise \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"new\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token constructor-invocation class-name\",\"children\":\"ExerciseService\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"repositoryFactory\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" mapperFactory\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" Muscle\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" account\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\" \\n\"]}]]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Entities inherit of BaseService.\"}],\"\\n\",[\"$\",\"pre\",null,{\"className\":\"language-csharp\",\"children\":[\"$\",\"code\",null,{\"className\":\"language-csharp code-highlight\",\"children\":[[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"public\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"abstract\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"class\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"BaseService\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"public\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"BaseService\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"IRepositoryFactory\"}],\" repositoryFactory\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"IMapperFactory\"}],\" mapperFactory\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"ICurrentUser\"}],\" user\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\" Repository \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" repositoryFactory\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\" Mapper \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" mapperFactory\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\" Repository\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"SetUser\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"user\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"protected\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token return-type class-name\",\"children\":\"IRepositoryFactory\"}],\" Repository \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"get\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"private\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"set\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"protected\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token return-type class-name\",\"children\":\"IMapperFactory\"}],\" Mapper \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"get\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"private\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"set\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\" \\n\"]}]]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"When the service is initialized, it uses the injected Repository to set the user that is also injected. Since the ServiceFactory calls the Account once, one call is done to the database. After, it only set the object to the repository which could be used later.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"The concept of IUserProvider remains. This is because we will use a \",[\"$\",\"em\",null,{\"children\":\"WebUserProvider\"}],\" for the Asp.Net MVC and a \",[\"$\",\"em\",null,{\"children\":\"WebServiceUserProvider\"}],\".\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"The Global.asax.cs file changes because it does not use anymore the \",[\"$\",\"code\",null,{\"children\":\"AuthConfig.RegisterAuth()\"}],\" because the Identity with OWIN does have a Startup page in the App folder.\"]}],\"\\n\",[\"$\",\"pre\",null,{\"className\":\"language-csharp\",\"children\":[\"$\",\"code\",null,{\"className\":\"language-csharp code-highlight\",\"children\":[[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"public\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"partial\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"class\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Startup\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"// For more information on configuring authentication, please visit http://go.microsoft.com/fwlink/?LinkId=301864 public void ConfigureAuth(IAppBuilder app) { // Enable the application to use a cookie to store information for the signed in user app.UseCookieAuthentication(new CookieAuthenticationOptions { AuthenticationType = DefaultAuthenticationTypes.ApplicationCookie, LoginPath = new PathString(\\\"/Account/Login\\\") }); // Use a cookie to temporarily store information about a user logging in with a third party login provider app.UseExternalSignInCookie(DefaultAuthenticationTypes.ExternalCookie); }\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\" \\n\"]}]]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"This also require to register the Startup class with another Startup class that is used as a bootstrapper for the OWIN container.\"}],\"\\n\",[\"$\",\"pre\",null,{\"className\":\"language-csharp\",\"children\":[\"$\",\"code\",null,{\"className\":\"language-csharp code-highlight\",\"children\":[[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"using\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token namespace\",\"children\":\"Owin\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"[\"}],[\"$\",\"span\",null,{\"className\":\"token attribute\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token target keyword\",\"children\":\"assembly\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"OwinStartup\"}],[\"$\",\"span\",null,{\"className\":\"token attribute-arguments\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"typeof\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token type-expression class-name\",\"children\":[\"WorkoutPlanner\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"Startup\"]}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}]]}]]}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"]\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"namespace\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token namespace\",\"children\":\"WorkoutPlanner\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"public\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"partial\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"class\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Startup\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"public\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token return-type class-name\",\"children\":[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"void\"}]}],\" \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"Configuration\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"IAppBuilder\"}],\" app\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"ConfigureAuth\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"app\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\" \\n\"]}]]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Notice the assembly instruction that tell which class is used for OwinStartup. It uses two classes but could use one. the only benefit of splitting the class in two is to have one statup entry and the code to configure somewhere else. This could later uncluttered the booting class.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"The migration changes also. The Seed method does not use the WebSecurity to initialize default user. It uses the ApplicationUser class with the UserStore and UserManager class that use Entity Framework to work with the database.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"To create the database with all Identity classes and all the business classes, the migration command in the package console is required. The\"}],\"\\n\",[\"$\",\"pre\",null,{\"className\":\"language-powershell\",\"children\":[\"$\",\"code\",null,{\"className\":\"language-powershell code-highlight\",\"children\":[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\" \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"update-database\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"-\"}],\"ConfigurationTypeName \",[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"Configuration\\\"\"}],\" \\n\"]}]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"This works because the Configuration class inherit of \",[\"$\",\"em\",null,{\"children\":\"DbMigrationsConfigurations\"}],\" which allow the migration tool to be executed. It takes the database context to be used. In our case, it's the one that contains every entities of the application.\"]}],\"\\n\",[\"$\",\"pre\",null,{\"className\":\"language-csharp\",\"children\":[\"$\",\"code\",null,{\"className\":\"language-csharp code-highlight\",\"children\":[[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"public\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"class\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Configuration\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token type-list\",\"children\":[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":[\"DbMigrationsConfiguration\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"\u003c\"}],\"DatabaseContext\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"\u003e\"}]]}]}],[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"//\u003cDatabaseContext\u003e { public Configuration() { base.AutomaticMigrationsEnabled = true; }\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"protected\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"override\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token return-type class-name\",\"children\":[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"void\"}]}],\" \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"Seed\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"DatabaseContext\"}],\" context\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"var\"}]}],\" userStore \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"new\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token constructor-invocation class-name\",\"children\":[\"UserStore\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"\u003c\"}],\"ApplicationUser\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"\u003e\"}]]}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"context\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"var\"}]}],\" manager \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"new\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token constructor-invocation class-name\",\"children\":[\"UserManager\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"\u003c\"}],\"ApplicationUser\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"\u003e\"}]]}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"userStore\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"var\"}]}],\" role \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"new\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token constructor-invocation class-name\",\"children\":\"IdentityUserRole\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\" Role \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"new\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token constructor-invocation class-name\",\"children\":\"IdentityRole\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"Model\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"Roles\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"ADMINISTRATOR\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"var\"}]}],\" user \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"new\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token constructor-invocation class-name\",\"children\":\"ApplicationUser\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\" UserName \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"123123\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" Email \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"123123@123.com\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" Language \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"en-US\\\"\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\" user\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"Roles\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"Add\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"role\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"IdentityResult\"}],\" result \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" manager\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"Create\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"user\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"123123\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"var\"}]}],\" role2 \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"new\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token constructor-invocation class-name\",\"children\":\"IdentityUserRole\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\" Role \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"new\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token constructor-invocation class-name\",\"children\":\"IdentityRole\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"Model\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"Roles\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"NORMAL\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"var\"}]}],\" user2 \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"new\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token constructor-invocation class-name\",\"children\":\"ApplicationUser\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\" UserName \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"qweqwe\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" Email \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"qweqwe@qweqwe.com\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" Language \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"fr-CA\\\"\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\" user\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"Roles\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"Add\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"role2\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"IdentityResult\"}],\" result2 \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" manager\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"Create\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"user2\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"qweqwe\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"var\"}]}],\" muscles \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"new\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"[\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"]\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"new\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token constructor-invocation class-name\",\"children\":\"Muscle\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\" Id \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"1\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" Name \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"new\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token constructor-invocation class-name\",\"children\":\"LocalizedString\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\" French \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"Cou\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" English \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"Neck\\\"\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"new\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token constructor-invocation class-name\",\"children\":\"Muscle\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\" Id \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"2\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" Name \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"new\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token constructor-invocation class-name\",\"children\":\"LocalizedString\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\" French \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"Épaule\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" English \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"Shoulder\\\"\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"context\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token generic-method\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"Set\"}],[\"$\",\"span\",null,{\"className\":\"token generic class-name\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"\u003c\"}],\"Muscle\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"\u003e\"}]]}]]}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"AddOrUpdateRange\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"muscles\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"//... and so on... base.Seed(context); } } \"}],\"\\n\"]}]]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"When working with Asp.Net Identity one key is to have your database context class inherit from IdentityDbContext and not directly from DbContext. Otherwise, you will get that keys are not defined for IdentityUserLogin, IdentityUserRole, IdentityUserLogins and IdentityUserRoles.\"}],\"\\n\",[\"$\",\"pre\",null,{\"className\":\"language-plaintext\",\"children\":[\"$\",\"code\",null,{\"className\":\"language-plaintext code-highlight\",\"children\":[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\" DataAccessLayer.Database.IdentityUserLogin: : EntityType 'IdentityUserLogin' has no key defined. Define the key for this EntityType. DataAccessLayer.Database.IdentityUserRole: : EntityType 'IdentityUserRole' has no key defined. Define the key for this EntityType. IdentityUserLogins: EntityType: EntitySet 'IdentityUserLogins' is based on type 'IdentityUserLogin' that has no keys defined. IdentityUserRoles: EntityType: EntitySet 'IdentityUserRoles' is based on type 'IdentityUserRole' that has no keys defined. \\n\"}]}]}],\"\\n\",[\"$\",\"pre\",null,{\"className\":\"language-csharp\",\"children\":[\"$\",\"code\",null,{\"className\":\"language-csharp code-highlight\",\"children\":[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"public\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"class\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"DatabaseContext\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],[\"$\",\"span\",null,{\"className\":\"token type-list\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":[\"IdentityDbContext\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"\u003c\"}],\"ApplicationUser\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"\u003e\"}]]}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"IDatabaseContext\"}]]}],\" \\n\"]}]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Migrating from Asp.Net Membership to Identity is not something that can be done for the first time under few hours. In fact, it took me around 12 hours to figure out that I had to inherit from IdentityDbContext and to solve several seeding problem. Also, having to use Entity Framework changed a little but how to use the user information. Nevertheless, the time is not exponential since it concerns only users and roles entities. I believe that it should take less than a day for someone who have all the information.\"}]]]}]]}],[\"$\",\"div\",null,{\"className\":\"BlogBody_paginationBar__1gsMc\",\"children\":[[\"$\",\"div\",null,{\"className\":\"BlogBody_paginationTitle__H_eFX\",\"children\":\"Chronological Blog Articles by Page\"}],[\"$\",\"div\",null,{\"className\":\"BlogBody_paginationLinks__nk8zd\",\"children\":[[\"$\",\"$Lb\",\"1\",{\"className\":\"\",\"href\":\"/blog/page/1\",\"children\":1}],[\"$\",\"$Lb\",\"2\",{\"className\":\"\",\"href\":\"/blog/page/2\",\"children\":2}],[\"$\",\"$Lb\",\"3\",{\"className\":\"\",\"href\":\"/blog/page/3\",\"children\":3}],[\"$\",\"$Lb\",\"4\",{\"className\":\"\",\"href\":\"/blog/page/4\",\"children\":4}],[\"$\",\"$Lb\",\"5\",{\"className\":\"\",\"href\":\"/blog/page/5\",\"children\":5}],[\"$\",\"$Lb\",\"6\",{\"className\":\"\",\"href\":\"/blog/page/6\",\"children\":6}],[\"$\",\"$Lb\",\"7\",{\"className\":\"\",\"href\":\"/blog/page/7\",\"children\":7}],[\"$\",\"$Lb\",\"8\",{\"className\":\"\",\"href\":\"/blog/page/8\",\"children\":8}],[\"$\",\"$Lb\",\"9\",{\"className\":\"\",\"href\":\"/blog/page/9\",\"children\":9}],[\"$\",\"$Lb\",\"10\",{\"className\":\"\",\"href\":\"/blog/page/10\",\"children\":10}],[\"$\",\"$Lb\",\"11\",{\"className\":\"\",\"href\":\"/blog/page/11\",\"children\":11}],[\"$\",\"$Lb\",\"12\",{\"className\":\"\",\"href\":\"/blog/page/12\",\"children\":12}],[\"$\",\"$Lb\",\"13\",{\"className\":\"\",\"href\":\"/blog/page/13\",\"children\":13}],[\"$\",\"$Lb\",\"14\",{\"className\":\"\",\"href\":\"/blog/page/14\",\"children\":14}],[\"$\",\"$Lb\",\"15\",{\"className\":\"\",\"href\":\"/blog/page/15\",\"children\":15}],[\"$\",\"$Lb\",\"16\",{\"className\":\"\",\"href\":\"/blog/page/16\",\"children\":16}],[\"$\",\"$Lb\",\"17\",{\"className\":\"\",\"href\":\"/blog/page/17\",\"children\":17}],[\"$\",\"$Lb\",\"18\",{\"className\":\"\",\"href\":\"/blog/page/18\",\"children\":18}],[\"$\",\"$Lb\",\"19\",{\"className\":\"\",\"href\":\"/blog/page/19\",\"children\":19}],[\"$\",\"$Lb\",\"20\",{\"className\":\"\",\"href\":\"/blog/page/20\",\"children\":20}],[\"$\",\"$Lb\",\"21\",{\"className\":\"\",\"href\":\"/blog/page/21\",\"children\":21}],[\"$\",\"$Lb\",\"22\",{\"className\":\"\",\"href\":\"/blog/page/22\",\"children\":22}],[\"$\",\"$Lb\",\"23\",{\"className\":\"\",\"href\":\"/blog/page/23\",\"children\":23}],[\"$\",\"$Lb\",\"24\",{\"className\":\"\",\"href\":\"/blog/page/24\",\"children\":24}],[\"$\",\"$Lb\",\"25\",{\"className\":\"\",\"href\":\"/blog/page/25\",\"children\":25}],[\"$\",\"$Lb\",\"26\",{\"className\":\"\",\"href\":\"/blog/page/26\",\"children\":26}],[\"$\",\"$Lb\",\"27\",{\"className\":\"\",\"href\":\"/blog/page/27\",\"children\":27}],[\"$\",\"$Lb\",\"28\",{\"className\":\"\",\"href\":\"/blog/page/28\",\"children\":28}],[\"$\",\"$Lb\",\"29\",{\"className\":\"\",\"href\":\"/blog/page/29\",\"children\":29}],[\"$\",\"$Lb\",\"30\",{\"className\":\"\",\"href\":\"/blog/page/30\",\"children\":30}],[\"$\",\"$Lb\",\"31\",{\"className\":\"\",\"href\":\"/blog/page/31\",\"children\":31}],[\"$\",\"$Lb\",\"32\",{\"className\":\"\",\"href\":\"/blog/page/32\",\"children\":32}],[\"$\",\"$Lb\",\"33\",{\"className\":\"\",\"href\":\"/blog/page/33\",\"children\":33}],[\"$\",\"$Lb\",\"34\",{\"className\":\"\",\"href\":\"/blog/page/34\",\"children\":34}],[\"$\",\"$Lb\",\"35\",{\"className\":\"\",\"href\":\"/blog/page/35\",\"children\":35}],[\"$\",\"$Lb\",\"36\",{\"className\":\"\",\"href\":\"/blog/page/36\",\"children\":36}],[\"$\",\"$Lb\",\"37\",{\"className\":\"\",\"href\":\"/blog/page/37\",\"children\":37}],[\"$\",\"$Lb\",\"38\",{\"className\":\"\",\"href\":\"/blog/page/38\",\"children\":38}],[\"$\",\"$Lb\",\"39\",{\"className\":\"\",\"href\":\"/blog/page/39\",\"children\":39}],[\"$\",\"$Lb\",\"40\",{\"className\":\"\",\"href\":\"/blog/page/40\",\"children\":40}],[\"$\",\"$Lb\",\"41\",{\"className\":\"\",\"href\":\"/blog/page/41\",\"children\":41}],[\"$\",\"$Lb\",\"42\",{\"className\":\"\",\"href\":\"/blog/page/42\",\"children\":42}],[\"$\",\"$Lb\",\"43\",{\"className\":\"\",\"href\":\"/blog/page/43\",\"children\":43}],[\"$\",\"$Lb\",\"44\",{\"className\":\"\",\"href\":\"/blog/page/44\",\"children\":44}],[\"$\",\"$Lb\",\"45\",{\"className\":\"\",\"href\":\"/blog/page/45\",\"children\":45}],[\"$\",\"$Lb\",\"46\",{\"className\":\"\",\"href\":\"/blog/page/46\",\"children\":46}],[\"$\",\"$Lb\",\"47\",{\"className\":\"\",\"href\":\"/blog/page/47\",\"children\":47}],[\"$\",\"$Lb\",\"48\",{\"className\":\"\",\"href\":\"/blog/page/48\",\"children\":48}],[\"$\",\"$Lb\",\"49\",{\"className\":\"\",\"href\":\"/blog/page/49\",\"children\":49}],[\"$\",\"$Lb\",\"50\",{\"className\":\"\",\"href\":\"/blog/page/50\",\"children\":50}],[\"$\",\"$Lb\",\"51\",{\"className\":\"\",\"href\":\"/blog/page/51\",\"children\":51}],[\"$\",\"$Lb\",\"52\",{\"className\":\"\",\"href\":\"/blog/page/52\",\"children\":52}],[\"$\",\"$Lb\",\"53\",{\"className\":\"\",\"href\":\"/blog/page/53\",\"children\":53}],[\"$\",\"$Lb\",\"54\",{\"className\":\"\",\"href\":\"/blog/page/54\",\"children\":54}],[\"$\",\"$Lb\",\"55\",{\"className\":\"\",\"href\":\"/blog/page/55\",\"children\":55}],[\"$\",\"$Lb\",\"56\",{\"className\":\"\",\"href\":\"/blog/page/56\",\"children\":56}],[\"$\",\"$Lb\",\"57\",{\"className\":\"\",\"href\":\"/blog/page/57\",\"children\":57}],[\"$\",\"$Lb\",\"58\",{\"className\":\"\",\"href\":\"/blog/page/58\",\"children\":58}],[\"$\",\"$Lb\",\"59\",{\"className\":\"\",\"href\":\"/blog/page/59\",\"children\":59}],[\"$\",\"$Lb\",\"60\",{\"className\":\"\",\"href\":\"/blog/page/60\",\"children\":60}],[\"$\",\"$Lb\",\"61\",{\"className\":\"\",\"href\":\"/blog/page/61\",\"children\":61}],[\"$\",\"$Lb\",\"62\",{\"className\":\"\",\"href\":\"/blog/page/62\",\"children\":62}],[\"$\",\"$Lb\",\"63\",{\"className\":\"\",\"href\":\"/blog/page/63\",\"children\":63}],[\"$\",\"$Lb\",\"64\",{\"className\":\"\",\"href\":\"/blog/page/64\",\"children\":64}],[\"$\",\"$Lb\",\"65\",{\"className\":\"\",\"href\":\"/blog/page/65\",\"children\":65}],[\"$\",\"$Lb\",\"66\",{\"className\":\"\",\"href\":\"/blog/page/66\",\"children\":66}],[\"$\",\"$Lb\",\"67\",{\"className\":\"\",\"href\":\"/blog/page/67\",\"children\":67}],[\"$\",\"$Lb\",\"68\",{\"className\":\"\",\"href\":\"/blog/page/68\",\"children\":68}],[\"$\",\"$Lb\",\"69\",{\"className\":\"\",\"href\":\"/blog/page/69\",\"children\":69}],[\"$\",\"$Lb\",\"70\",{\"className\":\"\",\"href\":\"/blog/page/70\",\"children\":70}],[\"$\",\"$Lb\",\"71\",{\"className\":\"\",\"href\":\"/blog/page/71\",\"children\":71}],[\"$\",\"$Lb\",\"72\",{\"className\":\"\",\"href\":\"/blog/page/72\",\"children\":72}],[\"$\",\"$Lb\",\"73\",{\"className\":\"\",\"href\":\"/blog/page/73\",\"children\":73}],[\"$\",\"$Lb\",\"74\",{\"className\":\"\",\"href\":\"/blog/page/74\",\"children\":74}],[\"$\",\"$Lb\",\"75\",{\"className\":\"\",\"href\":\"/blog/page/75\",\"children\":75}],[\"$\",\"$Lb\",\"76\",{\"className\":\"\",\"href\":\"/blog/page/76\",\"children\":76}],[\"$\",\"$Lb\",\"77\",{\"className\":\"\",\"href\":\"/blog/page/77\",\"children\":77}],[\"$\",\"$Lb\",\"78\",{\"className\":\"\",\"href\":\"/blog/page/78\",\"children\":78}],[\"$\",\"$Lb\",\"79\",{\"className\":\"\",\"href\":\"/blog/page/79\",\"children\":79}],[\"$\",\"$Lb\",\"80\",{\"className\":\"\",\"href\":\"/blog/page/80\",\"children\":80}]]}]]}],null]}]\n"])</script><script>self.__next_f.push([1,"c:[[\"$\",\"meta\",\"0\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}],[\"$\",\"meta\",\"1\",{\"charSet\":\"utf-8\"}],[\"$\",\"title\",\"2\",{\"children\":\"Patrick Desjardins Blog - Migrating Asp.Net MemberShip to Asp.Net MVC Identity for authentification\"}],[\"$\",\"meta\",\"3\",{\"name\":\"description\",\"content\":\"Migrating Asp.Net MemberShip to Asp.Net MVC Identity for authentification\"}]]\n6:null\n"])</script></body></html>