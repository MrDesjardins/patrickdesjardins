<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="preload" as="image" href="/images/blog/GraphQLExtension-1.png"/><link rel="preload" as="image" href="/images/blog/SizePayload.png"/><link rel="stylesheet" href="/_next/static/css/53d73aaa6ce0fadc.css" data-precedence="next"/><link rel="stylesheet" href="/_next/static/css/378d2a9747ade719.css" data-precedence="next"/><link rel="stylesheet" href="/_next/static/css/585ef9e6d39b193c.css" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/_next/static/chunks/webpack-9af2c930232f0daf.js"/><script src="/_next/static/chunks/fd9d1056-2821b0f0cabcd8bd.js" async=""></script><script src="/_next/static/chunks/23-432f74a8b1479502.js" async=""></script><script src="/_next/static/chunks/main-app-0d54ed11e4491763.js" async=""></script><script src="/_next/static/chunks/231-d291986acc57095e.js" async=""></script><script src="/_next/static/chunks/173-1ff9408fc5d1e856.js" async=""></script><script src="/_next/static/chunks/app/blog/%5Bslug%5D/page-b7aa7f195c3b21e3.js" async=""></script><title>Patrick Desjardins Blog - GraphQL Extension to Collect HTTP and Resolvers Telemetry</title><meta name="description" content="GraphQL Extension to Collect HTTP and Resolvers Telemetry"/><script src="/_next/static/chunks/polyfills-78c92fac7aa8fdd8.js" noModule=""></script></head><body class="layout_bodystyle__4ncsS"><div class="layout_bodystyle__9TFhb"><div class="BlogBody_BlogBody__600mT"><header class="BlogBody_siteTitle__f7uyb">Patrick Desjardins Blog</header><nav><ul class="BlogBody_navLinks__ZV12t"><li class="BlogBody_navLinkItem__Pml2e"><a class="BlogBody_navLinkText__ZtH2y" href="/">Main Page</a><a class="BlogBody_navLinkText__ZtH2y" href="/blog">Blog</a><a class="BlogBody_navLinkText__ZtH2y" href="/blog/for/2024">2024</a><a class="BlogBody_navLinkText__ZtH2y" href="/blog/for/2023">2023</a><a class="BlogBody_navLinkText__ZtH2y" href="/blog/for/2022">2022</a><a class="BlogBody_navLinkText__ZtH2y" href="/blog/for/2021">2021</a><a class="BlogBody_navLinkText__ZtH2y" href="/blog/for/2020">2020</a><a class="BlogBody_navLinkText__ZtH2y" href="/blog/for/2019">2019</a><a class="BlogBody_navLinkText__ZtH2y" href="/blog/for/2018">2018</a><a class="BlogBody_navLinkText__ZtH2y" href="/blog/for/2017">2017</a><a class="BlogBody_navLinkText__ZtH2y" href="/blog/for/2016">2016</a><a class="BlogBody_navLinkText__ZtH2y" href="/blog/for/2015">2015</a><a class="BlogBody_navLinkText__ZtH2y" href="/blog/for/2014">2014</a><a class="BlogBody_navLinkText__ZtH2y" href="/blog/for/2013">2013</a><a class="BlogBody_navLinkText__ZtH2y" href="/blog/for/2012">2012</a><a class="BlogBody_navLinkText__ZtH2y" href="/blog/for/2011">2011</a></li></ul></nav><div class="BlogBody_blogPictureContainer__IAbPL"><img alt="Patrick Desjardins picture from a conference" loading="lazy" width="800" height="260" decoding="async" data-nimg="1" class="BlogBody_blogTopPicture__L6lao" style="color:transparent" src="/images/backgrounds/patrickdesjardins_conference_bw.jpeg"/></div><main class="BlogBody_main__XrdKY"><h1 class="BlogBody_heading__bYRBe">GraphQL Extension to Collect HTTP and Resolvers Telemetry</h1><div class="Page_blogPostContainer__AUIcf"><p class="Page_blogPostDate__wVWWB">Posted on: <!-- -->2019-04-09</p><p>The more my graph was increasing, the more resolvers I built. The more resolvers I had, the more data loaders I created, the more HTTP endpoints I had to call and so on. The complexity of the code was rising as well as the possibility to have a catastrophic amount of HTTP requests to be performed by GraphQL. The amount of log by using the console was not only polluting the source code by having a line in each resolver and HTTP method but also couldn&#x27;t make it easy to collect the data for future analysis or to emergency cancellation of a GraphQL query if the amount of HTTP rise beyond a reasonable threshold.</p>
<p>The idea I had was to see if there is a way to hook into GraphQL to collect the data at a higher level instead of being at each function. I am using the Apollo library and the answer is yes! There is an experimental feature named &quot;extension&quot;. The documentation is dry and does not explain much but with some breakpoint and Visual Studio Code, I was able to build a simple extension in a few hours. Here is the result.</p>
<p><img src="/images/blog/GraphQLExtension-1.png" alt=""/></p>
<p>A GraphQL Request with its HTTP requests</p>
<p>The first requirement is to create the extension. It must inherit the GraphQLExtension class which is generic. The generic type needs to be your context type. Having access to the context is primordiale because it gives access to your user information. I assume that once authenticated the user is set in the context. Also, it gives you the possibility to inject statistic into the context throughout the exploration of the graph. In my case, I am using the context to collect information at my data service layer where all the HTTP requests are performed.</p>
<pre class="language-typescript"><code class="language-typescript code-highlight"><span class="code-line"><span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">DevConsole<span class="token operator">&lt;</span>TContext <span class="token keyword">extends</span> ApolloConfigurationContext<span class="token operator">&gt;</span></span>
</span><span class="code-line">  <span class="token keyword">implements</span> <span class="token class-name">GraphQLExtension<span class="token operator">&lt;</span>TContext<span class="token operator">&gt;</span></span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</span></code></pre>
<p>There is two importants function that you can override. The first one is <code>requestDidStart</code> which is invoked when a GraphQL request is made. It means that when a context is created and it that case a &quot;request&quot; is the GraphQL request and not all HTTP request performed by GraphQL during that GraphQL&#x27;s request. The function return a function. The return function is invoked when the request is completed. It is the place to output into the console all your statistic or to send the information to your telemetry system.</p>
<pre class="language-typescript"><code class="language-typescript code-highlight"><span class="code-line"><span class="token keyword">public</span> <span class="token function">requestDidStart</span><span class="token punctuation">(</span>o<span class="token operator">:</span> <span class="token punctuation">{</span>
</span><span class="code-line">    request<span class="token operator">:</span> Pick<span class="token operator">&lt;</span>Request<span class="token punctuation">,</span> <span class="token string">&quot;url&quot;</span> <span class="token operator">|</span> <span class="token string">&quot;method&quot;</span> <span class="token operator">|</span> <span class="token string">&quot;headers&quot;</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
</span><span class="code-line">    queryString<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
</span><span class="code-line">    parsedQuery<span class="token operator">?</span><span class="token operator">:</span> DocumentNode<span class="token punctuation">;</span>
</span><span class="code-line">    operationName<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
</span><span class="code-line">    variables<span class="token operator">?</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token punctuation">[</span>key<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token builtin">any</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
</span><span class="code-line">    persistedQueryHit<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">;</span>
</span><span class="code-line">    persistedQueryRegister<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">;</span>
</span><span class="code-line">    context<span class="token operator">:</span> TContext<span class="token punctuation">;</span>
</span><span class="code-line">    requestContext<span class="token operator">:</span> GraphQLRequestContext<span class="token operator">&lt;</span>TContext<span class="token operator">&gt;</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;New GraphQL requested started&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token keyword">const</span> yourContextData <span class="token operator">=</span> o<span class="token punctuation">.</span>context
</span><span class="code-line">        <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Your data can be sent here&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre>
<p>The second function is named &quot;willResolveField&quot; and is executed at every node of your graph. You can know the parent field and your field.</p>
<pre class="language-typescript"><code class="language-typescript code-highlight"><span class="code-line"><span class="token function">willResolveField</span><span class="token punctuation">(</span>source<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">,</span> args<span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token punctuation">[</span>argName<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token builtin">any</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> context<span class="token operator">:</span> TContext<span class="token punctuation">,</span> info<span class="token operator">:</span> GraphQLResolveInfo<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token comment">// Info has the field name and parentType.name</span>
</span><span class="code-line">    <span class="token keyword">return</span> <span class="token punctuation">(</span>error<span class="token operator">:</span> Error <span class="token operator">|</span> <span class="token keyword">null</span><span class="token punctuation">,</span> result<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token comment">// ...</span>
</span><span class="code-line">    <span class="token punctuation">}</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre>
<p>The next step is to plug the extension into Apollo GraphQL. The property &quot;extensions&quot; of ApolloServerConfig takes an array of extension.</p>
<pre class="language-typescript"><code class="language-typescript code-highlight"><span class="code-line"><span class="token keyword">const</span> serverConfig<span class="token operator">:</span> ApolloServerConfig <span class="token operator">=</span> <span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token comment">// ...,</span>
</span><span class="code-line">  extensions<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">new</span> <span class="token class-name">DevConsole</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
</span><span class="code-line"><span class="token punctuation">}</span><span class="token punctuation">;</span>
</span></code></pre>
<p>I am using the RESTDataSource of Apollo as well to perform all HTTP request. The abstract class has the GraphQL&#x27;s context. If you override the function willSendRequest, you can then have a global hook into all HTTP request. In that function, I am populating a property of my context that I named &quot;stats&quot; where I am storing each URL and parameters.</p>
<pre class="language-typescript"><code class="language-typescript code-highlight"><span class="code-line"><span class="token keyword">public</span> <span class="token function">willSendRequest</span><span class="token punctuation">(</span>request<span class="token operator">:</span> RequestOptions<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token keyword">const</span> stats <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>context<span class="token punctuation">.</span>stats<span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token comment">// push data in the stats object</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre>
<p>The documentation could be better in term of defining all the possibility. Nevertheless, with some breakpoints and a little bit of time I was quite satisfied to see what can be done. You can do much more than what proposed, for instance, you can calculate the payload size and get more insight into what is not efficient. For example, I realized in the process of creating another exception that was throwing an exception when a maximum threshold of HTTP request was reached was still letting GraphQL continue its traversal causing the exception to occurs on every future node. The solution was to clean up the response of redundant error using the overload function <em>willSendResponse</em>.</p>
<p><img src="/images/blog/SizePayload.png" alt=""/></p>
<p>Bonus: Getting the size of the payload</p>
<p>There is a lot of possibility to get a clear view of what is happening behind the scene for maintainers and developers of the GraphQL service. The detail does not matter directly for the consumer who care about getting the data fast and accurately in the format requested and not about the complexity. However, the complexity if not well exposed to the team who own the service can be costly in term of resources. It is very easy to fall into the trap of assuming that everything goes as expected in a world where every GraphQL request is unique and can surface a scenario not well covered.</p>
<h2>Previous GraphQL Posts</h2>
<ul>
<li><a href="getting-started-with-graphql-for-netflix-open-connect">Getting Started with GraphQL for Netflix Open Connect</a></li>
<li><a href="install-apollo-server-to-host-a-graphql-service">Install Apollo Server to host a GraphQL service</a></li>
<li><a href="apollo-server-and-secured-playground">Apollo Server and Secured Playground</a></li>
<li><a href="graphql-context">GraphQL Context</a></li>
<li><a href="graphql-query-with-argument">GraphQL Query with Argument</a></li>
<li><a href="apollo-graphql-resolvers-and-data-source-separation">Apollo GraphQL Resolvers and Data Source separation</a></li>
<li><a href="how-to-setup-a-typescript-nodejs-express-apollo-server-to-easy-debugging-with-vscode">How to setup a TypeScript, NodeJS, Express Apollo Server to easy debugging with VsCode</a></li>
<li><a href="graphql-resolvers-with-apollo">GraphQL Resolvers with Apollo</a></li>
<li><a href="configuring-apollo-playground-and-api-on-two-different-url">Configuring Apollo Playground and API on two different URL</a></li>
<li><a href="how-to-automatically-generate-typescript-for-consumer-of-your-graphql">How to automatically generate TypeScript for consumers of your GraphQL</a></li>
<li><a href="graphql-extension-to-collect-http-and-resolvers-telemetry">GraphQL and HTTP Telemetry</a></li>
<li><a href="how-to-consume-graphql-in-typescript-and-react">GraphQL and TypeScript/React</a></li>
</ul></div></main><div class="BlogBody_paginationBar__1gsMc"><div class="BlogBody_paginationTitle__H_eFX">Chronological Blog Articles by Page</div><div class="BlogBody_paginationLinks__nk8zd"><a class="" href="/blog/page/1">1</a><a class="" href="/blog/page/2">2</a><a class="" href="/blog/page/3">3</a><a class="" href="/blog/page/4">4</a><a class="" href="/blog/page/5">5</a><a class="" href="/blog/page/6">6</a><a class="" href="/blog/page/7">7</a><a class="" href="/blog/page/8">8</a><a class="" href="/blog/page/9">9</a><a class="" href="/blog/page/10">10</a><a class="" href="/blog/page/11">11</a><a class="" href="/blog/page/12">12</a><a class="" href="/blog/page/13">13</a><a class="" href="/blog/page/14">14</a><a class="" href="/blog/page/15">15</a><a class="" href="/blog/page/16">16</a><a class="" href="/blog/page/17">17</a><a class="" href="/blog/page/18">18</a><a class="" href="/blog/page/19">19</a><a class="" href="/blog/page/20">20</a><a class="" href="/blog/page/21">21</a><a class="" href="/blog/page/22">22</a><a class="" href="/blog/page/23">23</a><a class="" href="/blog/page/24">24</a><a class="" href="/blog/page/25">25</a><a class="" href="/blog/page/26">26</a><a class="" href="/blog/page/27">27</a><a class="" href="/blog/page/28">28</a><a class="" href="/blog/page/29">29</a><a class="" href="/blog/page/30">30</a><a class="" href="/blog/page/31">31</a><a class="" href="/blog/page/32">32</a><a class="" href="/blog/page/33">33</a><a class="" href="/blog/page/34">34</a><a class="" href="/blog/page/35">35</a><a class="" href="/blog/page/36">36</a><a class="" href="/blog/page/37">37</a><a class="" href="/blog/page/38">38</a><a class="" href="/blog/page/39">39</a><a class="" href="/blog/page/40">40</a><a class="" href="/blog/page/41">41</a><a class="" href="/blog/page/42">42</a><a class="" href="/blog/page/43">43</a><a class="" href="/blog/page/44">44</a><a class="" href="/blog/page/45">45</a><a class="" href="/blog/page/46">46</a><a class="" href="/blog/page/47">47</a><a class="" href="/blog/page/48">48</a><a class="" href="/blog/page/49">49</a><a class="" href="/blog/page/50">50</a><a class="" href="/blog/page/51">51</a><a class="" href="/blog/page/52">52</a><a class="" href="/blog/page/53">53</a><a class="" href="/blog/page/54">54</a><a class="" href="/blog/page/55">55</a><a class="" href="/blog/page/56">56</a><a class="" href="/blog/page/57">57</a><a class="" href="/blog/page/58">58</a><a class="" href="/blog/page/59">59</a><a class="" href="/blog/page/60">60</a><a class="" href="/blog/page/61">61</a><a class="" href="/blog/page/62">62</a><a class="" href="/blog/page/63">63</a><a class="" href="/blog/page/64">64</a><a class="" href="/blog/page/65">65</a><a class="" href="/blog/page/66">66</a><a class="" href="/blog/page/67">67</a><a class="" href="/blog/page/68">68</a><a class="" href="/blog/page/69">69</a><a class="" href="/blog/page/70">70</a><a class="" href="/blog/page/71">71</a><a class="" href="/blog/page/72">72</a><a class="" href="/blog/page/73">73</a><a class="" href="/blog/page/74">74</a><a class="" href="/blog/page/75">75</a><a class="" href="/blog/page/76">76</a><a class="" href="/blog/page/77">77</a><a class="" href="/blog/page/78">78</a></div></div></div></div><script src="/_next/static/chunks/webpack-9af2c930232f0daf.js" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0]);self.__next_f.push([2,null])</script><script>self.__next_f.push([1,"1:HL[\"/_next/static/css/53d73aaa6ce0fadc.css\",\"style\"]\n2:HL[\"/_next/static/css/378d2a9747ade719.css\",\"style\"]\n3:HL[\"/_next/static/css/585ef9e6d39b193c.css\",\"style\"]\n"])</script><script>self.__next_f.push([1,"4:I[5751,[],\"\"]\n7:I[9275,[],\"\"]\n9:I[1343,[],\"\"]\na:I[231,[\"231\",\"static/chunks/231-d291986acc57095e.js\",\"173\",\"static/chunks/173-1ff9408fc5d1e856.js\",\"308\",\"static/chunks/app/blog/%5Bslug%5D/page-b7aa7f195c3b21e3.js\"],\"\"]\nc:I[6130,[],\"\"]\n8:[\"slug\",\"graphql-extension-to-collect-http-and-resolvers-telemetry\",\"d\"]\nd:[]\n"])</script><script>self.__next_f.push([1,"0:[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/53d73aaa6ce0fadc.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\"}]],[\"$\",\"$L4\",null,{\"buildId\":\"bgDK8pPlwvwrLj8-FpZ3q\",\"assetPrefix\":\"\",\"initialCanonicalUrl\":\"/blog/graphql-extension-to-collect-http-and-resolvers-telemetry\",\"initialTree\":[\"\",{\"children\":[\"blog\",{\"children\":[[\"slug\",\"graphql-extension-to-collect-http-and-resolvers-telemetry\",\"d\"],{\"children\":[\"__PAGE__?{\\\"slug\\\":\\\"graphql-extension-to-collect-http-and-resolvers-telemetry\\\"}\",{}]}]}]},\"$undefined\",\"$undefined\",true],\"initialSeedData\":[\"\",{\"children\":[\"blog\",{\"children\":[[\"slug\",\"graphql-extension-to-collect-http-and-resolvers-telemetry\",\"d\"],{\"children\":[\"__PAGE__\",{},[[\"$L5\",\"$L6\"],null],null]},[\"$\",\"$L7\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"blog\",\"children\",\"$8\",\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L9\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\",\"styles\":[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/585ef9e6d39b193c.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\"}]]}],null]},[[\"$\",\"div\",null,{\"className\":\"layout_bodystyle__9TFhb\",\"children\":[\"$\",\"$L7\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"blog\",\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L9\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\",\"styles\":null}]}],null],null]},[[\"$\",\"html\",null,{\"lang\":\"en\",\"children\":[\"$\",\"body\",null,{\"className\":\"layout_bodystyle__4ncsS\",\"children\":[\"$\",\"$L7\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L9\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[\"$\",\"div\",null,{\"style\":{\"display\":\"flex\",\"alignItems\":\"center\",\"justifyContent\":\"center\",\"height\":\"100vh\"},\"children\":[\"$\",\"div\",null,{\"style\":{\"width\":\"50%\",\"height\":\"20%\",\"backgroundColor\":\"#ffeded\",\"borderRadius\":12,\"padding\":12,\"textAlign\":\"center\"},\"children\":[[\"$\",\"h1\",null,{\"children\":\"Not Found\"}],[\"$\",\"p\",null,{\"children\":\"Could not find requested resource\"}],[\"$\",\"$La\",null,{\"href\":\"/\",\"children\":\"Return Home\"}]]}]}],\"notFoundStyles\":[],\"styles\":[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/378d2a9747ade719.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\"}]]}]}]}],null],null],\"couldBeIntercepted\":false,\"initialHead\":[false,\"$Lb\"],\"globalErrorComponent\":\"$c\",\"missingSlots\":\"$Wd\"}]]\n"])</script><script>self.__next_f.push([1,"e:I[8173,[\"231\",\"static/chunks/231-d291986acc57095e.js\",\"173\",\"static/chunks/173-1ff9408fc5d1e856.js\",\"308\",\"static/chunks/app/blog/%5Bslug%5D/page-b7aa7f195c3b21e3.js\"],\"Image\"]\n"])</script><script>self.__next_f.push([1,"6:[\"$\",\"div\",null,{\"className\":\"BlogBody_BlogBody__600mT\",\"children\":[[\"$\",\"header\",null,{\"className\":\"BlogBody_siteTitle__f7uyb\",\"children\":\"Patrick Desjardins Blog\"}],[\"$\",\"nav\",null,{\"children\":[\"$\",\"ul\",null,{\"className\":\"BlogBody_navLinks__ZV12t\",\"children\":[\"$\",\"li\",null,{\"className\":\"BlogBody_navLinkItem__Pml2e\",\"children\":[[\"$\",\"$La\",null,{\"className\":\"BlogBody_navLinkText__ZtH2y\",\"href\":\"/\",\"children\":\"Main Page\"}],[\"$\",\"$La\",null,{\"className\":\"BlogBody_navLinkText__ZtH2y\",\"href\":\"/blog\",\"children\":\"Blog\"}],[[\"$\",\"$La\",\"2024\",{\"className\":\"BlogBody_navLinkText__ZtH2y\",\"href\":\"/blog/for/2024\",\"children\":2024}],[\"$\",\"$La\",\"2023\",{\"className\":\"BlogBody_navLinkText__ZtH2y\",\"href\":\"/blog/for/2023\",\"children\":2023}],[\"$\",\"$La\",\"2022\",{\"className\":\"BlogBody_navLinkText__ZtH2y\",\"href\":\"/blog/for/2022\",\"children\":2022}],[\"$\",\"$La\",\"2021\",{\"className\":\"BlogBody_navLinkText__ZtH2y\",\"href\":\"/blog/for/2021\",\"children\":2021}],[\"$\",\"$La\",\"2020\",{\"className\":\"BlogBody_navLinkText__ZtH2y\",\"href\":\"/blog/for/2020\",\"children\":2020}],[\"$\",\"$La\",\"2019\",{\"className\":\"BlogBody_navLinkText__ZtH2y\",\"href\":\"/blog/for/2019\",\"children\":2019}],[\"$\",\"$La\",\"2018\",{\"className\":\"BlogBody_navLinkText__ZtH2y\",\"href\":\"/blog/for/2018\",\"children\":2018}],[\"$\",\"$La\",\"2017\",{\"className\":\"BlogBody_navLinkText__ZtH2y\",\"href\":\"/blog/for/2017\",\"children\":2017}],[\"$\",\"$La\",\"2016\",{\"className\":\"BlogBody_navLinkText__ZtH2y\",\"href\":\"/blog/for/2016\",\"children\":2016}],[\"$\",\"$La\",\"2015\",{\"className\":\"BlogBody_navLinkText__ZtH2y\",\"href\":\"/blog/for/2015\",\"children\":2015}],[\"$\",\"$La\",\"2014\",{\"className\":\"BlogBody_navLinkText__ZtH2y\",\"href\":\"/blog/for/2014\",\"children\":2014}],[\"$\",\"$La\",\"2013\",{\"className\":\"BlogBody_navLinkText__ZtH2y\",\"href\":\"/blog/for/2013\",\"children\":2013}],[\"$\",\"$La\",\"2012\",{\"className\":\"BlogBody_navLinkText__ZtH2y\",\"href\":\"/blog/for/2012\",\"children\":2012}],[\"$\",\"$La\",\"2011\",{\"className\":\"BlogBody_navLinkText__ZtH2y\",\"href\":\"/blog/for/2011\",\"children\":2011}]]]}]}]}],[\"$\",\"div\",null,{\"className\":\"BlogBody_blogPictureContainer__IAbPL\",\"children\":[\"$\",\"$Le\",null,{\"className\":\"BlogBody_blogTopPicture__L6lao\",\"alt\":\"Patrick Desjardins picture from a conference\",\"src\":\"/images/backgrounds/patrickdesjardins_conference_bw.jpeg\",\"width\":800,\"height\":260}]}],[\"$\",\"main\",null,{\"className\":\"BlogBody_main__XrdKY\",\"children\":[[\"$\",\"h1\",null,{\"className\":\"BlogBody_heading__bYRBe\",\"children\":\"GraphQL Extension to Collect HTTP and Resolvers Telemetry\"}],[\"$\",\"div\",null,{\"className\":\"Page_blogPostContainer__AUIcf\",\"children\":[[\"$\",\"p\",null,{\"className\":\"Page_blogPostDate__wVWWB\",\"children\":[\"Posted on: \",\"2019-04-09\"]}],[[\"$\",\"p\",null,{\"children\":\"The more my graph was increasing, the more resolvers I built. The more resolvers I had, the more data loaders I created, the more HTTP endpoints I had to call and so on. The complexity of the code was rising as well as the possibility to have a catastrophic amount of HTTP requests to be performed by GraphQL. The amount of log by using the console was not only polluting the source code by having a line in each resolver and HTTP method but also couldn't make it easy to collect the data for future analysis or to emergency cancellation of a GraphQL query if the amount of HTTP rise beyond a reasonable threshold.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"The idea I had was to see if there is a way to hook into GraphQL to collect the data at a higher level instead of being at each function. I am using the Apollo library and the answer is yes! There is an experimental feature named \\\"extension\\\". The documentation is dry and does not explain much but with some breakpoint and Visual Studio Code, I was able to build a simple extension in a few hours. Here is the result.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"img\",null,{\"src\":\"/images/blog/GraphQLExtension-1.png\",\"alt\":\"\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"A GraphQL Request with its HTTP requests\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"The first requirement is to create the extension. It must inherit the GraphQLExtension class which is generic. The generic type needs to be your context type. Having access to the context is primordiale because it gives access to your user information. I assume that once authenticated the user is set in the context. Also, it gives you the possibility to inject statistic into the context throughout the exploration of the graph. In my case, I am using the context to collect information at my data service layer where all the HTTP requests are performed.\"}],\"\\n\",[\"$\",\"pre\",null,{\"className\":\"language-typescript\",\"children\":[\"$\",\"code\",null,{\"className\":\"language-typescript code-highlight\",\"children\":[[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"export\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"class\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":[\"DevConsole\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],\"TContext \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"extends\"}],\" ApolloConfigurationContext\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\"}]]}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"implements\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":[\"GraphQLExtension\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],\"TContext\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\"}]]}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}]]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"There is two importants function that you can override. The first one is \",[\"$\",\"code\",null,{\"children\":\"requestDidStart\"}],\" which is invoked when a GraphQL request is made. It means that when a context is created and it that case a \\\"request\\\" is the GraphQL request and not all HTTP request performed by GraphQL during that GraphQL's request. The function return a function. The return function is invoked when the request is completed. It is the place to output into the console all your statistic or to send the information to your telemetry system.\"]}],\"\\n\",[\"$\",\"pre\",null,{\"className\":\"language-typescript\",\"children\":[\"$\",\"code\",null,{\"className\":\"language-typescript code-highlight\",\"children\":[[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"public\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"requestDidStart\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"o\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    request\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\":\"}],\" Pick\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],\"Request\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"url\\\"\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"|\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"method\\\"\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"|\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"headers\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    queryString\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"?\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token builtin\",\"children\":\"string\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    parsedQuery\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"?\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\":\"}],\" DocumentNode\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    operationName\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"?\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token builtin\",\"children\":\"string\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    variables\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"?\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"[\"}],\"key\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token builtin\",\"children\":\"string\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"]\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token builtin\",\"children\":\"any\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    persistedQueryHit\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"?\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token builtin\",\"children\":\"boolean\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    persistedQueryRegister\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"?\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token builtin\",\"children\":\"boolean\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    context\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\":\"}],\" TContext\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    requestContext\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\":\"}],\" GraphQLRequestContext\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],\"TContext\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token builtin\",\"children\":\"console\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"log\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"New GraphQL requested started\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"return\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\u003e\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"const\"}],\" yourContextData \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" o\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"context\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token builtin\",\"children\":\"console\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"log\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"Your data can be sent here\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}]]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"The second function is named \\\"willResolveField\\\" and is executed at every node of your graph. You can know the parent field and your field.\"}],\"\\n\",[\"$\",\"pre\",null,{\"className\":\"language-typescript\",\"children\":[\"$\",\"code\",null,{\"className\":\"language-typescript code-highlight\",\"children\":[[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"willResolveField\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"source\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token builtin\",\"children\":\"any\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" args\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"[\"}],\"argName\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token builtin\",\"children\":\"string\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"]\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token builtin\",\"children\":\"any\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" context\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\":\"}],\" TContext\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" info\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\":\"}],\" GraphQLResolveInfo\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"// Info has the field name and parentType.name\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"return\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"error\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\":\"}],\" Error \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"|\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"null\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" result\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token builtin\",\"children\":\"any\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\u003e\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"// ...\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}]]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"The next step is to plug the extension into Apollo GraphQL. The property \\\"extensions\\\" of ApolloServerConfig takes an array of extension.\"}],\"\\n\",[\"$\",\"pre\",null,{\"className\":\"language-typescript\",\"children\":[\"$\",\"code\",null,{\"className\":\"language-typescript code-highlight\",\"children\":[[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"const\"}],\" serverConfig\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\":\"}],\" ApolloServerConfig \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"  \",[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"// ...,\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"  extensions\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"[\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\u003e\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"new\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"DevConsole\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"]\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}]]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"I am using the RESTDataSource of Apollo as well to perform all HTTP request. The abstract class has the GraphQL's context. If you override the function willSendRequest, you can then have a global hook into all HTTP request. In that function, I am populating a property of my context that I named \\\"stats\\\" where I am storing each URL and parameters.\"}],\"\\n\",[\"$\",\"pre\",null,{\"className\":\"language-typescript\",\"children\":[\"$\",\"code\",null,{\"className\":\"language-typescript code-highlight\",\"children\":[[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"public\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"willSendRequest\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"request\",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\":\"}],\" RequestOptions\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"const\"}],\" stats \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"this\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"context\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"stats\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"// push data in the stats object\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}]]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"The documentation could be better in term of defining all the possibility. Nevertheless, with some breakpoints and a little bit of time I was quite satisfied to see what can be done. You can do much more than what proposed, for instance, you can calculate the payload size and get more insight into what is not efficient. For example, I realized in the process of creating another exception that was throwing an exception when a maximum threshold of HTTP request was reached was still letting GraphQL continue its traversal causing the exception to occurs on every future node. The solution was to clean up the response of redundant error using the overload function \",[\"$\",\"em\",null,{\"children\":\"willSendResponse\"}],\".\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"img\",null,{\"src\":\"/images/blog/SizePayload.png\",\"alt\":\"\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Bonus: Getting the size of the payload\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"There is a lot of possibility to get a clear view of what is happening behind the scene for maintainers and developers of the GraphQL service. The detail does not matter directly for the consumer who care about getting the data fast and accurately in the format requested and not about the complexity. However, the complexity if not well exposed to the team who own the service can be costly in term of resources. It is very easy to fall into the trap of assuming that everything goes as expected in a world where every GraphQL request is unique and can surface a scenario not well covered.\"}],\"\\n\",[\"$\",\"h2\",null,{\"children\":\"Previous GraphQL Posts\"}],\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[\"$\",\"a\",null,{\"href\":\"getting-started-with-graphql-for-netflix-open-connect\",\"children\":\"Getting Started with GraphQL for Netflix Open Connect\"}]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"$\",\"a\",null,{\"href\":\"install-apollo-server-to-host-a-graphql-service\",\"children\":\"Install Apollo Server to host a GraphQL service\"}]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"$\",\"a\",null,{\"href\":\"apollo-server-and-secured-playground\",\"children\":\"Apollo Server and Secured Playground\"}]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"$\",\"a\",null,{\"href\":\"graphql-context\",\"children\":\"GraphQL Context\"}]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"$\",\"a\",null,{\"href\":\"graphql-query-with-argument\",\"children\":\"GraphQL Query with Argument\"}]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"$\",\"a\",null,{\"href\":\"apollo-graphql-resolvers-and-data-source-separation\",\"children\":\"Apollo GraphQL Resolvers and Data Source separation\"}]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"$\",\"a\",null,{\"href\":\"how-to-setup-a-typescript-nodejs-express-apollo-server-to-easy-debugging-with-vscode\",\"children\":\"How to setup a TypeScript, NodeJS, Express Apollo Server to easy debugging with VsCode\"}]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"$\",\"a\",null,{\"href\":\"graphql-resolvers-with-apollo\",\"children\":\"GraphQL Resolvers with Apollo\"}]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"$\",\"a\",null,{\"href\":\"configuring-apollo-playground-and-api-on-two-different-url\",\"children\":\"Configuring Apollo Playground and API on two different URL\"}]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"$\",\"a\",null,{\"href\":\"how-to-automatically-generate-typescript-for-consumer-of-your-graphql\",\"children\":\"How to automatically generate TypeScript for consumers of your GraphQL\"}]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"$\",\"a\",null,{\"href\":\"graphql-extension-to-collect-http-and-resolvers-telemetry\",\"children\":\"GraphQL and HTTP Telemetry\"}]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"$\",\"a\",null,{\"href\":\"how-to-consume-graphql-in-typescript-and-react\",\"children\":\"GraphQL and TypeScript/React\"}]}],\"\\n\"]}]]]}]]}],[\"$\",\"div\",null,{\"className\":\"BlogBody_paginationBar__1gsMc\",\"children\":[[\"$\",\"div\",null,{\"className\":\"BlogBody_paginationTitle__H_eFX\",\"children\":\"Chronological Blog Articles by Page\"}],[\"$\",\"div\",null,{\"className\":\"BlogBody_paginationLinks__nk8zd\",\"children\":[[\"$\",\"$La\",\"1\",{\"className\":\"\",\"href\":\"/blog/page/1\",\"children\":1}],[\"$\",\"$La\",\"2\",{\"className\":\"\",\"href\":\"/blog/page/2\",\"children\":2}],[\"$\",\"$La\",\"3\",{\"className\":\"\",\"href\":\"/blog/page/3\",\"children\":3}],[\"$\",\"$La\",\"4\",{\"className\":\"\",\"href\":\"/blog/page/4\",\"children\":4}],[\"$\",\"$La\",\"5\",{\"className\":\"\",\"href\":\"/blog/page/5\",\"children\":5}],[\"$\",\"$La\",\"6\",{\"className\":\"\",\"href\":\"/blog/page/6\",\"children\":6}],[\"$\",\"$La\",\"7\",{\"className\":\"\",\"href\":\"/blog/page/7\",\"children\":7}],[\"$\",\"$La\",\"8\",{\"className\":\"\",\"href\":\"/blog/page/8\",\"children\":8}],[\"$\",\"$La\",\"9\",{\"className\":\"\",\"href\":\"/blog/page/9\",\"children\":9}],[\"$\",\"$La\",\"10\",{\"className\":\"\",\"href\":\"/blog/page/10\",\"children\":10}],[\"$\",\"$La\",\"11\",{\"className\":\"\",\"href\":\"/blog/page/11\",\"children\":11}],[\"$\",\"$La\",\"12\",{\"className\":\"\",\"href\":\"/blog/page/12\",\"children\":12}],[\"$\",\"$La\",\"13\",{\"className\":\"\",\"href\":\"/blog/page/13\",\"children\":13}],[\"$\",\"$La\",\"14\",{\"className\":\"\",\"href\":\"/blog/page/14\",\"children\":14}],[\"$\",\"$La\",\"15\",{\"className\":\"\",\"href\":\"/blog/page/15\",\"children\":15}],[\"$\",\"$La\",\"16\",{\"className\":\"\",\"href\":\"/blog/page/16\",\"children\":16}],[\"$\",\"$La\",\"17\",{\"className\":\"\",\"href\":\"/blog/page/17\",\"children\":17}],[\"$\",\"$La\",\"18\",{\"className\":\"\",\"href\":\"/blog/page/18\",\"children\":18}],[\"$\",\"$La\",\"19\",{\"className\":\"\",\"href\":\"/blog/page/19\",\"children\":19}],[\"$\",\"$La\",\"20\",{\"className\":\"\",\"href\":\"/blog/page/20\",\"children\":20}],[\"$\",\"$La\",\"21\",{\"className\":\"\",\"href\":\"/blog/page/21\",\"children\":21}],[\"$\",\"$La\",\"22\",{\"className\":\"\",\"href\":\"/blog/page/22\",\"children\":22}],[\"$\",\"$La\",\"23\",{\"className\":\"\",\"href\":\"/blog/page/23\",\"children\":23}],[\"$\",\"$La\",\"24\",{\"className\":\"\",\"href\":\"/blog/page/24\",\"children\":24}],[\"$\",\"$La\",\"25\",{\"className\":\"\",\"href\":\"/blog/page/25\",\"children\":25}],[\"$\",\"$La\",\"26\",{\"className\":\"\",\"href\":\"/blog/page/26\",\"children\":26}],[\"$\",\"$La\",\"27\",{\"className\":\"\",\"href\":\"/blog/page/27\",\"children\":27}],[\"$\",\"$La\",\"28\",{\"className\":\"\",\"href\":\"/blog/page/28\",\"children\":28}],[\"$\",\"$La\",\"29\",{\"className\":\"\",\"href\":\"/blog/page/29\",\"children\":29}],[\"$\",\"$La\",\"30\",{\"className\":\"\",\"href\":\"/blog/page/30\",\"children\":30}],[\"$\",\"$La\",\"31\",{\"className\":\"\",\"href\":\"/blog/page/31\",\"children\":31}],[\"$\",\"$La\",\"32\",{\"className\":\"\",\"href\":\"/blog/page/32\",\"children\":32}],[\"$\",\"$La\",\"33\",{\"className\":\"\",\"href\":\"/blog/page/33\",\"children\":33}],[\"$\",\"$La\",\"34\",{\"className\":\"\",\"href\":\"/blog/page/34\",\"children\":34}],[\"$\",\"$La\",\"35\",{\"className\":\"\",\"href\":\"/blog/page/35\",\"children\":35}],[\"$\",\"$La\",\"36\",{\"className\":\"\",\"href\":\"/blog/page/36\",\"children\":36}],[\"$\",\"$La\",\"37\",{\"className\":\"\",\"href\":\"/blog/page/37\",\"children\":37}],[\"$\",\"$La\",\"38\",{\"className\":\"\",\"href\":\"/blog/page/38\",\"children\":38}],[\"$\",\"$La\",\"39\",{\"className\":\"\",\"href\":\"/blog/page/39\",\"children\":39}],[\"$\",\"$La\",\"40\",{\"className\":\"\",\"href\":\"/blog/page/40\",\"children\":40}],[\"$\",\"$La\",\"41\",{\"className\":\"\",\"href\":\"/blog/page/41\",\"children\":41}],[\"$\",\"$La\",\"42\",{\"className\":\"\",\"href\":\"/blog/page/42\",\"children\":42}],[\"$\",\"$La\",\"43\",{\"className\":\"\",\"href\":\"/blog/page/43\",\"children\":43}],[\"$\",\"$La\",\"44\",{\"className\":\"\",\"href\":\"/blog/page/44\",\"children\":44}],[\"$\",\"$La\",\"45\",{\"className\":\"\",\"href\":\"/blog/page/45\",\"children\":45}],[\"$\",\"$La\",\"46\",{\"className\":\"\",\"href\":\"/blog/page/46\",\"children\":46}],[\"$\",\"$La\",\"47\",{\"className\":\"\",\"href\":\"/blog/page/47\",\"children\":47}],[\"$\",\"$La\",\"48\",{\"className\":\"\",\"href\":\"/blog/page/48\",\"children\":48}],[\"$\",\"$La\",\"49\",{\"className\":\"\",\"href\":\"/blog/page/49\",\"children\":49}],[\"$\",\"$La\",\"50\",{\"className\":\"\",\"href\":\"/blog/page/50\",\"children\":50}],[\"$\",\"$La\",\"51\",{\"className\":\"\",\"href\":\"/blog/page/51\",\"children\":51}],[\"$\",\"$La\",\"52\",{\"className\":\"\",\"href\":\"/blog/page/52\",\"children\":52}],[\"$\",\"$La\",\"53\",{\"className\":\"\",\"href\":\"/blog/page/53\",\"children\":53}],[\"$\",\"$La\",\"54\",{\"className\":\"\",\"href\":\"/blog/page/54\",\"children\":54}],[\"$\",\"$La\",\"55\",{\"className\":\"\",\"href\":\"/blog/page/55\",\"children\":55}],[\"$\",\"$La\",\"56\",{\"className\":\"\",\"href\":\"/blog/page/56\",\"children\":56}],[\"$\",\"$La\",\"57\",{\"className\":\"\",\"href\":\"/blog/page/57\",\"children\":57}],[\"$\",\"$La\",\"58\",{\"className\":\"\",\"href\":\"/blog/page/58\",\"children\":58}],[\"$\",\"$La\",\"59\",{\"className\":\"\",\"href\":\"/blog/page/59\",\"children\":59}],[\"$\",\"$La\",\"60\",{\"className\":\"\",\"href\":\"/blog/page/60\",\"children\":60}],[\"$\",\"$La\",\"61\",{\"className\":\"\",\"href\":\"/blog/page/61\",\"children\":61}],[\"$\",\"$La\",\"62\",{\"className\":\"\",\"href\":\"/blog/page/62\",\"children\":62}],[\"$\",\"$La\",\"63\",{\"className\":\"\",\"href\":\"/blog/page/63\",\"children\":63}],[\"$\",\"$La\",\"64\",{\"className\":\"\",\"href\":\"/blog/page/64\",\"children\":64}],[\"$\",\"$La\",\"65\",{\"className\":\"\",\"href\":\"/blog/page/65\",\"children\":65}],[\"$\",\"$La\",\"66\",{\"className\":\"\",\"href\":\"/blog/page/66\",\"children\":66}],[\"$\",\"$La\",\"67\",{\"className\":\"\",\"href\":\"/blog/page/67\",\"children\":67}],[\"$\",\"$La\",\"68\",{\"className\":\"\",\"href\":\"/blog/page/68\",\"children\":68}],[\"$\",\"$La\",\"69\",{\"className\":\"\",\"href\":\"/blog/page/69\",\"children\":69}],[\"$\",\"$La\",\"70\",{\"className\":\"\",\"href\":\"/blog/page/70\",\"children\":70}],[\"$\",\"$La\",\"71\",{\"className\":\"\",\"href\":\"/blog/page/71\",\"children\":71}],[\"$\",\"$La\",\"72\",{\"className\":\"\",\"href\":\"/blog/page/72\",\"children\":72}],[\"$\",\"$La\",\"73\",{\"className\":\"\",\"href\":\"/blog/page/73\",\"children\":73}],[\"$\",\"$La\",\"74\",{\"className\":\"\",\"href\":\"/blog/page/74\",\"children\":74}],[\"$\",\"$La\",\"75\",{\"className\":\"\",\"href\":\"/blog/page/75\",\"children\":75}],[\"$\",\"$La\",\"76\",{\"className\":\"\",\"href\":\"/blog/page/76\",\"children\":76}],[\"$\",\"$La\",\"77\",{\"className\":\"\",\"href\":\"/blog/page/77\",\"children\":77}],[\"$\",\"$La\",\"78\",{\"className\":\"\",\"href\":\"/blog/page/78\",\"children\":78}]]}]]}]]}]\n"])</script><script>self.__next_f.push([1,"b:[[\"$\",\"meta\",\"0\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}],[\"$\",\"meta\",\"1\",{\"charSet\":\"utf-8\"}],[\"$\",\"title\",\"2\",{\"children\":\"Patrick Desjardins Blog - GraphQL Extension to Collect HTTP and Resolvers Telemetry\"}],[\"$\",\"meta\",\"3\",{\"name\":\"description\",\"content\":\"GraphQL Extension to Collect HTTP and Resolvers Telemetry\"}]]\n5:null\n"])</script></body></html>