3:I[6102,[],""]
5:I[2609,[],""]
6:I[6196,["196","static/chunks/196-d9d7275cf071dc4b.js","986","static/chunks/986-aab1d30514616ab7.js","308","static/chunks/app/blog/%5Bslug%5D/page-1d51dd1d8a502245.js"],""]
4:["slug","unit-testing-go-functions","d"]
0:["iA6HtkYzrLgSQyCVio9MX",[[["",{"children":["blog",{"children":[["slug","unit-testing-go-functions","d"],{"children":["__PAGE__?{\"slug\":\"unit-testing-go-functions\"}",{}]}]}]},"$undefined","$undefined",true],["",{"children":["blog",{"children":[["slug","unit-testing-go-functions","d"],{"children":["__PAGE__",{},[["$L1","$L2",[["$","link","0",{"rel":"stylesheet","href":"/_next/static/css/43126ea28792c324.css","precedence":"next","crossOrigin":"$undefined"}],["$","link","1",{"rel":"stylesheet","href":"/_next/static/css/97e0a79122e618e4.css","precedence":"next","crossOrigin":"$undefined"}]]],null],null]},[null,["$","$L3",null,{"parallelRouterKey":"children","segmentPath":["children","blog","children","$4","children"],"error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L5",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":"$undefined","notFoundStyles":"$undefined"}]],null]},[[[["$","link","0",{"rel":"stylesheet","href":"/_next/static/css/dabd5e64a469b0e1.css","precedence":"next","crossOrigin":"$undefined"}]],["$","div",null,{"className":"layout_blogbodystyle___Uc1w","children":["$","$L3",null,{"parallelRouterKey":"children","segmentPath":["children","blog","children"],"error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L5",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":"$undefined","notFoundStyles":"$undefined"}]}]],null],null]},[[[["$","link","0",{"rel":"stylesheet","href":"/_next/static/css/78bcead87aa8ba1c.css","precedence":"next","crossOrigin":"$undefined"}]],["$","html",null,{"lang":"en","className":"layout_htmlstyle__PseMz","children":["$","body",null,{"className":"layout_bodystyle__4ncsS","children":["$","$L3",null,{"parallelRouterKey":"children","segmentPath":["children"],"error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L5",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":["$","div",null,{"style":{"display":"flex","alignItems":"center","justifyContent":"center","height":"100vh"},"children":["$","div",null,{"style":{"width":"50%","height":"20%","backgroundColor":"#ffeded","borderRadius":12,"padding":12,"textAlign":"center"},"children":[["$","h1",null,{"children":"Not Found"}],["$","p",null,{"children":"Could not find requested resource"}],["$","$L6",null,{"href":"/","children":"Return Home"}]]}]}],"notFoundStyles":[]}]}]}]],null],null],["$L7",null]]]]
8:I[8986,["196","static/chunks/196-d9d7275cf071dc4b.js","986","static/chunks/986-aab1d30514616ab7.js","308","static/chunks/app/blog/%5Bslug%5D/page-1d51dd1d8a502245.js"],"Image"]
2:["$","div",null,{"className":"BlogBody_BlogBody__600mT","children":[["$","header",null,{"className":"BlogBody_siteTitle__f7uyb","children":"Patrick Desjardins Blog"}],["$","nav",null,{"children":["$","ul",null,{"className":"BlogBody_navLinks__ZV12t","children":["$","li",null,{"className":"BlogBody_navLinkItem__Pml2e","children":[["$","$L6",null,{"className":"BlogBody_navLinkText__ZtH2y","href":"/","children":"Main Page"}],["$","$L6",null,{"className":"BlogBody_navLinkText__ZtH2y","href":"/blog","children":"Blog"}],[["$","$L6","2025",{"className":"BlogBody_navLinkText__ZtH2y","href":"/blog/for/2025","children":2025}],["$","$L6","2024",{"className":"BlogBody_navLinkText__ZtH2y","href":"/blog/for/2024","children":2024}],["$","$L6","2023",{"className":"BlogBody_navLinkText__ZtH2y","href":"/blog/for/2023","children":2023}],["$","$L6","2022",{"className":"BlogBody_navLinkText__ZtH2y","href":"/blog/for/2022","children":2022}],["$","$L6","2021",{"className":"BlogBody_navLinkText__ZtH2y","href":"/blog/for/2021","children":2021}],["$","$L6","2020",{"className":"BlogBody_navLinkText__ZtH2y","href":"/blog/for/2020","children":2020}],["$","$L6","2019",{"className":"BlogBody_navLinkText__ZtH2y","href":"/blog/for/2019","children":2019}],["$","$L6","2018",{"className":"BlogBody_navLinkText__ZtH2y","href":"/blog/for/2018","children":2018}],["$","$L6","2017",{"className":"BlogBody_navLinkText__ZtH2y","href":"/blog/for/2017","children":2017}],["$","$L6","2016",{"className":"BlogBody_navLinkText__ZtH2y","href":"/blog/for/2016","children":2016}],["$","$L6","2015",{"className":"BlogBody_navLinkText__ZtH2y","href":"/blog/for/2015","children":2015}],["$","$L6","2014",{"className":"BlogBody_navLinkText__ZtH2y","href":"/blog/for/2014","children":2014}],["$","$L6","2013",{"className":"BlogBody_navLinkText__ZtH2y","href":"/blog/for/2013","children":2013}],["$","$L6","2012",{"className":"BlogBody_navLinkText__ZtH2y","href":"/blog/for/2012","children":2012}],["$","$L6","2011",{"className":"BlogBody_navLinkText__ZtH2y","href":"/blog/for/2011","children":2011}]]]}]}]}],["$","div",null,{"className":"BlogBody_blogPictureContainer__IAbPL","children":["$","$L8",null,{"className":"BlogBody_blogTopPicture__L6lao","alt":"Patrick Desjardins picture from a conference","src":"/images/backgrounds/patrickdesjardins_conference_bw.webp","width":800,"height":260}]}],["$","main",null,{"className":"BlogBody_main__XrdKY","children":[["$","h1",null,{"className":"BlogBody_heading__bYRBe","children":"Unit Testing with Go Shaped How to Design my Functions"}],["$","div",null,{"className":"Page_blogPostContainer__AUIcf","children":[["$","p",null,{"className":"Page_blogPostDate__wVWWB","children":["Posted on: ","2025-04-07"]}],[["$","h1",null,{"children":"Working Code but not Testable"}],"\n",["$","p",null,{"children":"I have developed in many ways throughout the years from a very strict object-oriented approach with Java and C# to a more functional approach using JavaScript, TypeScript, and Python. In the first project, I started using Go, and I was in the mindset of creating a function that takes an object as a parameter and returns a new modified object. The application worked well until I wanted to add unit tests."}],"\n",["$","p",null,{"children":"The issue with creating new unit tests was that I wanted to know if a part of a function was executed (or not) and fake the execution of some dependent functions."}],"\n",["$","pre",null,{"className":"language-plaintext","children":["$","code",null,{"className":"language-plaintext code-highlight","children":[["$","span",null,{"className":"code-line","children":"//example that serviceA.Function2 would be mocked to return a specific mocked value\n"}],["$","span",null,{"className":"code-line","children":"┌──────────────────────────────┐\n"}],["$","span",null,{"className":"code-line","children":"│ Function1                    │\n"}],["$","span",null,{"className":"code-line","children":"│   Line 1                     │\n"}],["$","span",null,{"className":"code-line","children":"│   XYZ = serviceA.Function2   │\n"}],["$","span",null,{"className":"code-line","children":"│   Line 2 using XYZ           │\n"}],["$","span",null,{"className":"code-line","children":"└──────────────────────────────┘\n"}]]}]}],"\n",["$","p",null,{"children":"Having recently worked in Python, I would have to mock one of the imports the logic I test uses and in the test code checks if the function got called."}],"\n",["$","pre",null,{"className":"language-python","children":["$","code",null,{"className":"language-Python code-highlight","children":[["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token decorator annotation punctuation","children":"@patch"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token string","children":"\"deps.tournaments.tournament_functions.datetime\""}],["$","span",null,{"className":"token punctuation","children":")"}],"\n"]}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token decorator annotation punctuation","children":["@patch",["$","span",null,{"className":"token punctuation","children":"."}],"object"]}],["$","span",null,{"className":"token punctuation","children":"("}],"tournament_functions",["$","span",null,{"className":"token punctuation","children":","}]," tournament_functions",["$","span",null,{"className":"token punctuation","children":"."}],"register_user_for_tournament",["$","span",null,{"className":"token punctuation","children":"."}],"__name__",["$","span",null,{"className":"token punctuation","children":")"}],"\n"]}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token decorator annotation punctuation","children":["@patch",["$","span",null,{"className":"token punctuation","children":"."}],"object"]}],["$","span",null,{"className":"token punctuation","children":"("}],"tournament_functions",["$","span",null,{"className":"token punctuation","children":","}]," tournament_functions",["$","span",null,{"className":"token punctuation","children":"."}],"can_register_to_tournament",["$","span",null,{"className":"token punctuation","children":"."}],"__name__",["$","span",null,{"className":"token punctuation","children":")"}],"\n"]}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token keyword","children":"def"}]," ",["$","span",null,{"className":"token function","children":"test_register_for_tournament_only_register_when_cannot_register"}],["$","span",null,{"className":"token punctuation","children":"("}],"\n"]}],["$","span",null,{"className":"code-line","children":["    mock_can_register_to_tournament",["$","span",null,{"className":"token punctuation","children":","}]," mock_register_user_for_tournament",["$","span",null,{"className":"token punctuation","children":","}]," mock_datetime\n"]}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token operator","children":"-"}],["$","span",null,{"className":"token operator","children":">"}]," ",["$","span",null,{"className":"token boolean","children":"None"}],["$","span",null,{"className":"token punctuation","children":":"}],"\n"]}],["$","span",null,{"className":"code-line","children":["    ",["$","span",null,{"className":"token triple-quoted-string string","children":"\"\"\"Test to check if we return the reason of the can_register and dont call register\"\"\""}],"\n"]}],["$","span",null,{"className":"code-line","children":["    ",["$","span",null,{"className":"token comment","children":"# Arrange"}],"\n"]}],["$","span",null,{"className":"code-line","children":[" mock_can_register_to_tournament",["$","span",null,{"className":"token punctuation","children":"."}],"return_value ",["$","span",null,{"className":"token operator","children":"="}]," Reason",["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token boolean","children":"False"}],["$","span",null,{"className":"token punctuation","children":","}]," ",["$","span",null,{"className":"token string","children":"\"Reason from can_register\""}],["$","span",null,{"className":"token punctuation","children":")"}],"\n"]}],["$","span",null,{"className":"code-line","children":[" mock_register_user_for_tournament",["$","span",null,{"className":"token punctuation","children":"."}],"return_value ",["$","span",null,{"className":"token operator","children":"="}]," ",["$","span",null,{"className":"token boolean","children":"None"}],"\n"]}],["$","span",null,{"className":"code-line","children":[" mock_datetime",["$","span",null,{"className":"token punctuation","children":"."}],"now",["$","span",null,{"className":"token punctuation","children":"."}],"return_value ",["$","span",null,{"className":"token operator","children":"="}]," t2\n"]}],["$","span",null,{"className":"code-line","children":["    ",["$","span",null,{"className":"token comment","children":"# Act"}],"\n"]}],["$","span",null,{"className":"code-line","children":[" reason",["$","span",null,{"className":"token punctuation","children":":"}]," Reason ",["$","span",null,{"className":"token operator","children":"="}]," register_for_tournament",["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token number","children":"1"}],["$","span",null,{"className":"token punctuation","children":","}]," ",["$","span",null,{"className":"token number","children":"2"}],["$","span",null,{"className":"token punctuation","children":")"}],"\n"]}],["$","span",null,{"className":"code-line","children":["    ",["$","span",null,{"className":"token comment","children":"# Assert"}],"\n"]}],["$","span",null,{"className":"code-line","children":[" mock_register_user_for_tournament",["$","span",null,{"className":"token punctuation","children":"."}],"assert_not_called",["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token punctuation","children":")"}],"\n"]}],["$","span",null,{"className":"code-line","children":["    ",["$","span",null,{"className":"token keyword","children":"assert"}]," reason",["$","span",null,{"className":"token punctuation","children":"."}],"is_successful ",["$","span",null,{"className":"token keyword","children":"is"}]," ",["$","span",null,{"className":"token boolean","children":"False"}],"\n"]}],["$","span",null,{"className":"code-line","children":["    ",["$","span",null,{"className":"token keyword","children":"assert"}]," reason",["$","span",null,{"className":"token punctuation","children":"."}],"text ",["$","span",null,{"className":"token operator","children":"=="}]," ",["$","span",null,{"className":"token string","children":"\"Reason from can_register\""}],"\n"]}]]}]}],"\n",["$","p",null,{"children":"In Go, I could not find something similar. In JavaScript, you can push a stub dynamically on any function, even private, and verify on the stub whether the function was called. Again, this is not possible in Go."}],"\n",["$","h1",null,{"children":"Modifying the Code"}],"\n",["$","p",null,{"children":["Doing a quick research showed me that I needed to step back toward what I used to do in Java and C#. I needed to create an interface for dependency and pass it down to the function. In the Python code above, I would need the ",["$","code",null,{"children":"register_user_for_tournament"}]," and ",["$","code",null,{"children":"can_register_to_tournament"}]," to be passed as a parameter to the function as they are both dependencies and called from the function being tested. Their implementation should not be executed during the unit test of the registration for the tournament."]}],"\n",["$","p",null,{"children":"In my project, the first unit test to change was the one between the Go Rest API and the Go Data Access. There is a Go Service that acts as a bridge between the two. It offers the possibility to communicate with many data access functions, perform some business logic, perform caching, and, in all cases, abstract how the data access is done. The service class is simple and a good example of this blog post."}],"\n",["$","p",null,{"children":"The function originally looked like this:"}],"\n",["$","pre",null,{"className":"language-go","children":["$","code",null,{"className":"language-go code-highlight","children":[["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token keyword","children":"func"}]," ",["$","span",null,{"className":"token function","children":"GetRandomStockFromPersistence"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token punctuation","children":"["}],["$","span",null,{"className":"token punctuation","children":"]"}],"model",["$","span",null,{"className":"token punctuation","children":"."}],"StockPublic ",["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}],["$","span",null,{"className":"code-line","children":["  syms ",["$","span",null,{"className":"token operator","children":":="}]," stockDataAccess",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"GetUniqueStockSymbols"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token punctuation","children":")"}],"\n"]}],["$","span",null,{"className":"code-line","children":["  symbol ",["$","span",null,{"className":"token operator","children":":="}]," ",["$","span",null,{"className":"token function","children":"GetRandomStock"}],["$","span",null,{"className":"token punctuation","children":"("}],"syms",["$","span",null,{"className":"token punctuation","children":")"}],"\n"]}],["$","span",null,{"className":"code-line","children":["  stocks ",["$","span",null,{"className":"token operator","children":":="}]," stockDataAccess",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"GetPricesForStock"}],["$","span",null,{"className":"token punctuation","children":"("}],"symbol",["$","span",null,{"className":"token punctuation","children":")"}],"\n"]}],["$","span",null,{"className":"code-line","children":["  ",["$","span",null,{"className":"token keyword","children":"return"}]," stocks\n"]}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token punctuation","children":"}"}],"\n"]}]]}]}],"\n",["$","p",null,{"children":["The first line gets the data from the database using the ",["$","code",null,{"children":"stockDataAccess"}]," object. The package defines the object. The second line calls a function inside the same package. The third line calls the data access again to get the prices for the stock. The function is not testable as it is. I cannot mock the ",["$","code",null,{"children":"stockDataAccess"}]," object as it is defined in the package and not passed as a parameter. I also cannot mock the ",["$","code",null,{"children":"GetRandomStock"}]," function as it is also defined in the package."]}],"\n",["$","p",null,{"children":["The code has to inject a reference to the ",["$","code",null,{"children":"stockDataAccess"}]," object and the ",["$","code",null,{"children":"GetRandomStock"}]," function. The code now looks like this:"]}],"\n",["$","pre",null,{"className":"language-go","children":["$","code",null,{"className":"language-go code-highlight","children":[["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token keyword","children":"func"}]," ",["$","span",null,{"className":"token punctuation","children":"("}],"s ",["$","span",null,{"className":"token operator","children":"*"}],"StockServiceImpl",["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token function","children":"GetRandomStockFromPersistence"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token punctuation","children":"["}],["$","span",null,{"className":"token punctuation","children":"]"}],"model",["$","span",null,{"className":"token punctuation","children":"."}],"StockPublic ",["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}],["$","span",null,{"className":"code-line","children":["  syms ",["$","span",null,{"className":"token operator","children":":="}]," s",["$","span",null,{"className":"token punctuation","children":"."}],"StockDataAccess",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"GetUniqueStockSymbols"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token punctuation","children":")"}],"\n"]}],["$","span",null,{"className":"code-line","children":["  symbol ",["$","span",null,{"className":"token operator","children":":="}]," s",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"GetRandomStock"}],["$","span",null,{"className":"token punctuation","children":"("}],"syms",["$","span",null,{"className":"token punctuation","children":")"}],"\n"]}],["$","span",null,{"className":"code-line","children":["  stocks ",["$","span",null,{"className":"token operator","children":":="}]," s",["$","span",null,{"className":"token punctuation","children":"."}],"StockDataAccess",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"GetPricesForStock"}],["$","span",null,{"className":"token punctuation","children":"("}],"symbol",["$","span",null,{"className":"token punctuation","children":")"}],"\n"]}],["$","span",null,{"className":"code-line","children":["  ",["$","span",null,{"className":"token keyword","children":"return"}]," stocks\n"]}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token punctuation","children":"}"}],"\n"]}]]}]}],"\n",["$","p",null,{"children":["The change adds ",["$","code",null,{"children":"(s *StockServiceImpl)"}]," after the ",["$","code",null,{"children":"func"}]," keyword. It means that it will hook the function to the pointer of the ",["$","code",null,{"children":"StockServiceImpl"}]," object."]}],"\n",["$","pre",null,{"className":"language-go","children":["$","code",null,{"className":"language-go code-highlight","children":[["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token keyword","children":"type"}]," StockServiceImpl ",["$","span",null,{"className":"token keyword","children":"struct"}]," ",["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}],["$","span",null,{"className":"code-line","children":"  StockService StockService\n"}],["$","span",null,{"className":"code-line","children":["  StockDataAccess dataaccess",["$","span",null,{"className":"token punctuation","children":"."}],"StockDataAccess\n"]}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token punctuation","children":"}"}],"\n"]}]]}]}],"\n",["$","p",null,{"children":["The object is a structure with two objects, meaning we should use this new implementation in the real application and the test. We can inject different implementations of the ",["$","code",null,{"children":"StockDataAccess"}]," object during the test. The ",["$","code",null,{"children":"GetRandomStock"}]," function is now a method of the ",["$","code",null,{"children":"StockServiceImpl"}]," object. It means that we can mock it in the test. The main application and the tests use the ",["$","code",null,{"children":"StockServiceImpl"}],". The test can now passes a mock implementation of the ",["$","code",null,{"children":"StockDataAccess"}]," interface."]}],"\n",["$","p",null,{"children":"Theoretically, you must define a mocked implementation with hard-coded expected values. For example, the data access functions would return a hard-coded list of stocks without getting into the database. Using the current implementation, the test file would look like this:"}],"\n",["$","pre",null,{"className":"language-go","children":["$","code",null,{"className":"language-go code-highlight","children":[["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token keyword","children":"type"}]," StockDataAccessMock ",["$","span",null,{"className":"token keyword","children":"interface"}]," ",["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}],["$","span",null,{"className":"code-line","children":["  ",["$","span",null,{"className":"token function","children":"GetPricesForStock"}],["$","span",null,{"className":"token punctuation","children":"("}],"symbol ",["$","span",null,{"className":"token builtin","children":"string"}],["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token punctuation","children":"["}],["$","span",null,{"className":"token punctuation","children":"]"}],"model",["$","span",null,{"className":"token punctuation","children":"."}],"StockPublic\n"]}],["$","span",null,{"className":"code-line","children":["  ",["$","span",null,{"className":"token function","children":"GetUniqueStockSymbols"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token punctuation","children":"["}],["$","span",null,{"className":"token punctuation","children":"]"}],["$","span",null,{"className":"token builtin","children":"string"}],"\n"]}],["$","span",null,{"className":"code-line","children":["  ",["$","span",null,{"className":"token function","children":"GetPricesForStockInTimeRange"}],["$","span",null,{"className":"token punctuation","children":"("}],"symbol ",["$","span",null,{"className":"token builtin","children":"string"}],["$","span",null,{"className":"token punctuation","children":","}]," startDate ",["$","span",null,{"className":"token builtin","children":"string"}],["$","span",null,{"className":"token punctuation","children":","}]," endDate ",["$","span",null,{"className":"token builtin","children":"string"}],["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token punctuation","children":"["}],["$","span",null,{"className":"token punctuation","children":"]"}],"model",["$","span",null,{"className":"token punctuation","children":"."}],"Stock\n"]}],["$","span",null,{"className":"code-line","children":["  ",["$","span",null,{"className":"token function","children":"GetStocksAfterDate"}],["$","span",null,{"className":"token punctuation","children":"("}],"symbol ",["$","span",null,{"className":"token builtin","children":"string"}],["$","span",null,{"className":"token punctuation","children":","}]," afterDate ",["$","span",null,{"className":"token builtin","children":"string"}],["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token punctuation","children":"["}],["$","span",null,{"className":"token punctuation","children":"]"}],"model",["$","span",null,{"className":"token punctuation","children":"."}],"Stock\n"]}],["$","span",null,{"className":"code-line","children":["  ",["$","span",null,{"className":"token function","children":"GetStocksBeforeEqualDate"}],["$","span",null,{"className":"token punctuation","children":"("}],"symbol ",["$","span",null,{"className":"token builtin","children":"string"}],["$","span",null,{"className":"token punctuation","children":","}]," beforeDate ",["$","span",null,{"className":"token builtin","children":"string"}],["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token punctuation","children":"["}],["$","span",null,{"className":"token punctuation","children":"]"}],"model",["$","span",null,{"className":"token punctuation","children":"."}],"Stock\n"]}],["$","span",null,{"className":"code-line","children":["  ",["$","span",null,{"className":"token function","children":"GetStockInfo"}],["$","span",null,{"className":"token punctuation","children":"("}],"symbolUUID ",["$","span",null,{"className":"token builtin","children":"string"}],["$","span",null,{"className":"token punctuation","children":")"}]," model",["$","span",null,{"className":"token punctuation","children":"."}],"StockInfo\n"]}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token punctuation","children":"}"}],"\n"]}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token keyword","children":"type"}]," StockDataAccessMockImpl ",["$","span",null,{"className":"token keyword","children":"struct"}]," ",["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}],["$","span",null,{"className":"code-line","children":" StockDataAccessMock\n"}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token punctuation","children":"}"}],"\n"]}],["$","span",null,{"className":"code-line","children":"\n"}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token keyword","children":"func"}]," ",["$","span",null,{"className":"token punctuation","children":"("}],"s ",["$","span",null,{"className":"token operator","children":"*"}],"StockDataAccessMockImpl",["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token function","children":"GetUniqueStockSymbols"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token punctuation","children":"["}],["$","span",null,{"className":"token punctuation","children":"]"}],["$","span",null,{"className":"token builtin","children":"string"}]," ",["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}],["$","span",null,{"className":"code-line","children":["  ",["$","span",null,{"className":"token keyword","children":"return"}]," ",["$","span",null,{"className":"token punctuation","children":"["}],["$","span",null,{"className":"token punctuation","children":"]"}],["$","span",null,{"className":"token builtin","children":"string"}],["$","span",null,{"className":"token punctuation","children":"{"}],["$","span",null,{"className":"token string","children":"\"AAPL\""}],["$","span",null,{"className":"token punctuation","children":","}]," ",["$","span",null,{"className":"token string","children":"\"GOOGL\""}],["$","span",null,{"className":"token punctuation","children":"}"}],"\n"]}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token punctuation","children":"}"}],"\n"]}],["$","span",null,{"className":"code-line","children":"\n"}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token keyword","children":"func"}]," ",["$","span",null,{"className":"token punctuation","children":"("}],"s ",["$","span",null,{"className":"token operator","children":"*"}],"StockDataAccessMockImpl",["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token function","children":"GetPricesForStock"}],["$","span",null,{"className":"token punctuation","children":"("}],"stock ",["$","span",null,{"className":"token builtin","children":"string"}],["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token punctuation","children":"["}],["$","span",null,{"className":"token punctuation","children":"]"}],"model",["$","span",null,{"className":"token punctuation","children":"."}],"StockPublic ",["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}],["$","span",null,{"className":"code-line","children":["  ",["$","span",null,{"className":"token keyword","children":"return"}]," ",["$","span",null,{"className":"token punctuation","children":"["}],["$","span",null,{"className":"token punctuation","children":"]"}],"model",["$","span",null,{"className":"token punctuation","children":"."}],"StockPublic",["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}],["$","span",null,{"className":"code-line","children":[" ",["$","span",null,{"className":"token punctuation","children":"{"}],"SymbolUUID",["$","span",null,{"className":"token punctuation","children":":"}]," ",["$","span",null,{"className":"token string","children":"\"AAPL\""}],["$","span",null,{"className":"token punctuation","children":","}]," Volume",["$","span",null,{"className":"token punctuation","children":":"}]," ",["$","span",null,{"className":"token number","children":"1000"}],["$","span",null,{"className":"token punctuation","children":","}]," Date",["$","span",null,{"className":"token punctuation","children":":"}]," ",["$","span",null,{"className":"token string","children":"\"2023-01-01\""}],["$","span",null,{"className":"token punctuation","children":","}]," Open",["$","span",null,{"className":"token punctuation","children":":"}]," ",["$","span",null,{"className":"token number","children":"100"}],["$","span",null,{"className":"token punctuation","children":","}]," High",["$","span",null,{"className":"token punctuation","children":":"}]," ",["$","span",null,{"className":"token number","children":"110"}],["$","span",null,{"className":"token punctuation","children":","}]," Low",["$","span",null,{"className":"token punctuation","children":":"}]," ",["$","span",null,{"className":"token number","children":"90"}],["$","span",null,{"className":"token punctuation","children":","}]," Close",["$","span",null,{"className":"token punctuation","children":":"}]," ",["$","span",null,{"className":"token number","children":"105"}],["$","span",null,{"className":"token punctuation","children":","}]," AdjClose",["$","span",null,{"className":"token punctuation","children":":"}]," ",["$","span",null,{"className":"token number","children":"1233"}],["$","span",null,{"className":"token punctuation","children":"}"}],["$","span",null,{"className":"token punctuation","children":","}],"\n"]}],["$","span",null,{"className":"code-line","children":[" ",["$","span",null,{"className":"token punctuation","children":"{"}],"SymbolUUID",["$","span",null,{"className":"token punctuation","children":":"}]," ",["$","span",null,{"className":"token string","children":"\"AAPL\""}],["$","span",null,{"className":"token punctuation","children":","}]," Volume",["$","span",null,{"className":"token punctuation","children":":"}]," ",["$","span",null,{"className":"token number","children":"2000"}],["$","span",null,{"className":"token punctuation","children":","}]," Date",["$","span",null,{"className":"token punctuation","children":":"}]," ",["$","span",null,{"className":"token string","children":"\"2023-01-02\""}],["$","span",null,{"className":"token punctuation","children":","}]," Open",["$","span",null,{"className":"token punctuation","children":":"}]," ",["$","span",null,{"className":"token number","children":"101"}],["$","span",null,{"className":"token punctuation","children":","}]," High",["$","span",null,{"className":"token punctuation","children":":"}]," ",["$","span",null,{"className":"token number","children":"111"}],["$","span",null,{"className":"token punctuation","children":","}]," Low",["$","span",null,{"className":"token punctuation","children":":"}]," ",["$","span",null,{"className":"token number","children":"89"}],["$","span",null,{"className":"token punctuation","children":","}]," Close",["$","span",null,{"className":"token punctuation","children":":"}]," ",["$","span",null,{"className":"token number","children":"107"}],["$","span",null,{"className":"token punctuation","children":","}]," AdjClose",["$","span",null,{"className":"token punctuation","children":":"}]," ",["$","span",null,{"className":"token number","children":"1550"}],["$","span",null,{"className":"token punctuation","children":"}"}],["$","span",null,{"className":"token punctuation","children":","}],"\n"]}],["$","span",null,{"className":"code-line","children":[" ",["$","span",null,{"className":"token punctuation","children":"}"}],"\n"]}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token punctuation","children":"}"}],"\n"]}],["$","span",null,{"className":"code-line","children":"\n"}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token keyword","children":"func"}]," ",["$","span",null,{"className":"token function","children":"TestGetRandomStockFromPersistence"}],["$","span",null,{"className":"token punctuation","children":"("}],"t ",["$","span",null,{"className":"token operator","children":"*"}],"testing",["$","span",null,{"className":"token punctuation","children":"."}],"T",["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}],["$","span",null,{"className":"code-line","children":["  ",["$","span",null,{"className":"token comment","children":"// Create a mockDataAccess object with a function GetUniqueStockSymbols that return fake symboles"}],"\n"]}],["$","span",null,{"className":"code-line","children":["  mockDataAccess ",["$","span",null,{"className":"token operator","children":":="}]," ",["$","span",null,{"className":"token operator","children":"&"}],"StockDataAccessMockImpl",["$","span",null,{"className":"token punctuation","children":"{"}],["$","span",null,{"className":"token punctuation","children":"}"}],"\n"]}],["$","span",null,{"className":"code-line","children":["  mockService ",["$","span",null,{"className":"token operator","children":":="}]," ",["$","span",null,{"className":"token function","children":"NewStockService"}],["$","span",null,{"className":"token punctuation","children":"("}],"mockDataAccess",["$","span",null,{"className":"token punctuation","children":")"}],"\n"]}],["$","span",null,{"className":"code-line","children":["  stocks ",["$","span",null,{"className":"token operator","children":":="}]," mockService",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"GetRandomStockFromPersistence"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token punctuation","children":")"}],"\n"]}],["$","span",null,{"className":"code-line","children":["  ",["$","span",null,{"className":"token keyword","children":"if"}]," ",["$","span",null,{"className":"token function","children":"len"}],["$","span",null,{"className":"token punctuation","children":"("}],"stocks",["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token operator","children":"!="}]," ",["$","span",null,{"className":"token number","children":"2"}]," ",["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}],["$","span",null,{"className":"code-line","children":["    t",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"Errorf"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token string","children":"\"Expected the same amount of stock found in the database but found %d\""}],["$","span",null,{"className":"token punctuation","children":","}]," ",["$","span",null,{"className":"token function","children":"len"}],["$","span",null,{"className":"token punctuation","children":"("}],"stocks",["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":")"}],"\n"]}],["$","span",null,{"className":"code-line","children":[" ",["$","span",null,{"className":"token punctuation","children":"}"}],"\n"]}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token punctuation","children":"}"}],"\n"]}]]}]}],"\n",["$","p",null,{"children":"The issue is that you must create another interface for every test requiring a different set of values. Instead, you can use a MockImplementation where the body of each function is defined inside each test. Also, the benefit of only implementing the one you need to mock."}],"\n",["$","pre",null,{"className":"language-go","children":["$","code",null,{"className":"language-go code-highlight","children":[["$","span",null,{"className":"code-line","children":"\n"}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token keyword","children":"type"}]," StockDataAccessMockImpl ",["$","span",null,{"className":"token keyword","children":"struct"}]," ",["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}],["$","span",null,{"className":"code-line","children":["  GetPricesForStockFunc            ",["$","span",null,{"className":"token keyword","children":"func"}],["$","span",null,{"className":"token punctuation","children":"("}],"symbol ",["$","span",null,{"className":"token builtin","children":"string"}],["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token punctuation","children":"["}],["$","span",null,{"className":"token punctuation","children":"]"}],"model",["$","span",null,{"className":"token punctuation","children":"."}],"StockPublic\n"]}],["$","span",null,{"className":"code-line","children":["  GetUniqueStockSymbolsFunc        ",["$","span",null,{"className":"token keyword","children":"func"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token punctuation","children":"["}],["$","span",null,{"className":"token punctuation","children":"]"}],["$","span",null,{"className":"token builtin","children":"string"}],"\n"]}],["$","span",null,{"className":"code-line","children":["  GetPricesForStockInTimeRangeFunc ",["$","span",null,{"className":"token keyword","children":"func"}],["$","span",null,{"className":"token punctuation","children":"("}],"symbol",["$","span",null,{"className":"token punctuation","children":","}]," startDate",["$","span",null,{"className":"token punctuation","children":","}]," endDate ",["$","span",null,{"className":"token builtin","children":"string"}],["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token punctuation","children":"["}],["$","span",null,{"className":"token punctuation","children":"]"}],"model",["$","span",null,{"className":"token punctuation","children":"."}],"Stock\n"]}],["$","span",null,{"className":"code-line","children":["  GetStocksAfterDateFunc           ",["$","span",null,{"className":"token keyword","children":"func"}],["$","span",null,{"className":"token punctuation","children":"("}],"symbol",["$","span",null,{"className":"token punctuation","children":","}]," afterDate ",["$","span",null,{"className":"token builtin","children":"string"}],["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token punctuation","children":"["}],["$","span",null,{"className":"token punctuation","children":"]"}],"model",["$","span",null,{"className":"token punctuation","children":"."}],"Stock\n"]}],["$","span",null,{"className":"code-line","children":["  GetStocksBeforeEqualDateFunc     ",["$","span",null,{"className":"token keyword","children":"func"}],["$","span",null,{"className":"token punctuation","children":"("}],"symbol",["$","span",null,{"className":"token punctuation","children":","}]," beforeDate ",["$","span",null,{"className":"token builtin","children":"string"}],["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token punctuation","children":"["}],["$","span",null,{"className":"token punctuation","children":"]"}],"model",["$","span",null,{"className":"token punctuation","children":"."}],"Stock\n"]}],["$","span",null,{"className":"code-line","children":["  GetStockInfoFunc                 ",["$","span",null,{"className":"token keyword","children":"func"}],["$","span",null,{"className":"token punctuation","children":"("}],"symbolUUID ",["$","span",null,{"className":"token builtin","children":"string"}],["$","span",null,{"className":"token punctuation","children":")"}]," model",["$","span",null,{"className":"token punctuation","children":"."}],"StockInfo\n"]}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token punctuation","children":"}"}],"\n"]}],["$","span",null,{"className":"code-line","children":"\n"}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token keyword","children":"func"}]," ",["$","span",null,{"className":"token punctuation","children":"("}],"m ",["$","span",null,{"className":"token operator","children":"*"}],"StockDataAccessMockImpl",["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token function","children":"GetPricesForStock"}],["$","span",null,{"className":"token punctuation","children":"("}],"symbol ",["$","span",null,{"className":"token builtin","children":"string"}],["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token punctuation","children":"["}],["$","span",null,{"className":"token punctuation","children":"]"}],"model",["$","span",null,{"className":"token punctuation","children":"."}],"StockPublic ",["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}],["$","span",null,{"className":"code-line","children":["  ",["$","span",null,{"className":"token keyword","children":"if"}]," m",["$","span",null,{"className":"token punctuation","children":"."}],"GetPricesForStockFunc ",["$","span",null,{"className":"token operator","children":"!="}]," ",["$","span",null,{"className":"token boolean","children":"nil"}]," ",["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}],["$","span",null,{"className":"code-line","children":["    ",["$","span",null,{"className":"token keyword","children":"return"}]," m",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"GetPricesForStockFunc"}],["$","span",null,{"className":"token punctuation","children":"("}],"symbol",["$","span",null,{"className":"token punctuation","children":")"}],"\n"]}],["$","span",null,{"className":"code-line","children":[" ",["$","span",null,{"className":"token punctuation","children":"}"}],"\n"]}],["$","span",null,{"className":"code-line","children":["  ",["$","span",null,{"className":"token keyword","children":"return"}]," ",["$","span",null,{"className":"token boolean","children":"nil"}],"\n"]}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token punctuation","children":"}"}],"\n"]}],["$","span",null,{"className":"code-line","children":"\n"}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token keyword","children":"func"}]," ",["$","span",null,{"className":"token punctuation","children":"("}],"m ",["$","span",null,{"className":"token operator","children":"*"}],"StockDataAccessMockImpl",["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token function","children":"GetUniqueStockSymbols"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token punctuation","children":"["}],["$","span",null,{"className":"token punctuation","children":"]"}],["$","span",null,{"className":"token builtin","children":"string"}]," ",["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}],["$","span",null,{"className":"code-line","children":["  ",["$","span",null,{"className":"token keyword","children":"if"}]," m",["$","span",null,{"className":"token punctuation","children":"."}],"GetUniqueStockSymbolsFunc ",["$","span",null,{"className":"token operator","children":"!="}]," ",["$","span",null,{"className":"token boolean","children":"nil"}]," ",["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}],["$","span",null,{"className":"code-line","children":["    ",["$","span",null,{"className":"token keyword","children":"return"}]," m",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"GetUniqueStockSymbolsFunc"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token punctuation","children":")"}],"\n"]}],["$","span",null,{"className":"code-line","children":[" ",["$","span",null,{"className":"token punctuation","children":"}"}],"\n"]}],["$","span",null,{"className":"code-line","children":["  ",["$","span",null,{"className":"token keyword","children":"return"}]," ",["$","span",null,{"className":"token boolean","children":"nil"}],"\n"]}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token punctuation","children":"}"}],"\n"]}],["$","span",null,{"className":"code-line","children":"\n"}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token keyword","children":"func"}]," ",["$","span",null,{"className":"token punctuation","children":"("}],"m ",["$","span",null,{"className":"token operator","children":"*"}],"StockDataAccessMockImpl",["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token function","children":"GetPricesForStockInTimeRange"}],["$","span",null,{"className":"token punctuation","children":"("}],"symbol",["$","span",null,{"className":"token punctuation","children":","}]," startDate",["$","span",null,{"className":"token punctuation","children":","}]," endDate ",["$","span",null,{"className":"token builtin","children":"string"}],["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token punctuation","children":"["}],["$","span",null,{"className":"token punctuation","children":"]"}],"model",["$","span",null,{"className":"token punctuation","children":"."}],"Stock ",["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}],["$","span",null,{"className":"code-line","children":["  ",["$","span",null,{"className":"token keyword","children":"if"}]," m",["$","span",null,{"className":"token punctuation","children":"."}],"GetPricesForStockInTimeRangeFunc ",["$","span",null,{"className":"token operator","children":"!="}]," ",["$","span",null,{"className":"token boolean","children":"nil"}]," ",["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}],["$","span",null,{"className":"code-line","children":["    ",["$","span",null,{"className":"token keyword","children":"return"}]," m",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"GetPricesForStockInTimeRangeFunc"}],["$","span",null,{"className":"token punctuation","children":"("}],"symbol",["$","span",null,{"className":"token punctuation","children":","}]," startDate",["$","span",null,{"className":"token punctuation","children":","}]," endDate",["$","span",null,{"className":"token punctuation","children":")"}],"\n"]}],["$","span",null,{"className":"code-line","children":[" ",["$","span",null,{"className":"token punctuation","children":"}"}],"\n"]}],["$","span",null,{"className":"code-line","children":["  ",["$","span",null,{"className":"token keyword","children":"return"}]," ",["$","span",null,{"className":"token boolean","children":"nil"}],"\n"]}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token punctuation","children":"}"}],"\n"]}],["$","span",null,{"className":"code-line","children":"\n"}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token keyword","children":"func"}]," ",["$","span",null,{"className":"token punctuation","children":"("}],"m ",["$","span",null,{"className":"token operator","children":"*"}],"StockDataAccessMockImpl",["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token function","children":"GetStocksAfterDate"}],["$","span",null,{"className":"token punctuation","children":"("}],"symbol",["$","span",null,{"className":"token punctuation","children":","}]," afterDate ",["$","span",null,{"className":"token builtin","children":"string"}],["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token punctuation","children":"["}],["$","span",null,{"className":"token punctuation","children":"]"}],"model",["$","span",null,{"className":"token punctuation","children":"."}],"Stock ",["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}],["$","span",null,{"className":"code-line","children":["  ",["$","span",null,{"className":"token keyword","children":"if"}]," m",["$","span",null,{"className":"token punctuation","children":"."}],"GetStocksAfterDateFunc ",["$","span",null,{"className":"token operator","children":"!="}]," ",["$","span",null,{"className":"token boolean","children":"nil"}]," ",["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}],["$","span",null,{"className":"code-line","children":["    ",["$","span",null,{"className":"token keyword","children":"return"}]," m",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"GetStocksAfterDateFunc"}],["$","span",null,{"className":"token punctuation","children":"("}],"symbol",["$","span",null,{"className":"token punctuation","children":","}]," afterDate",["$","span",null,{"className":"token punctuation","children":")"}],"\n"]}],["$","span",null,{"className":"code-line","children":[" ",["$","span",null,{"className":"token punctuation","children":"}"}],"\n"]}],["$","span",null,{"className":"code-line","children":["  ",["$","span",null,{"className":"token keyword","children":"return"}]," ",["$","span",null,{"className":"token boolean","children":"nil"}],"\n"]}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token punctuation","children":"}"}],"\n"]}],["$","span",null,{"className":"code-line","children":"\n"}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token keyword","children":"func"}]," ",["$","span",null,{"className":"token punctuation","children":"("}],"m ",["$","span",null,{"className":"token operator","children":"*"}],"StockDataAccessMockImpl",["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token function","children":"GetStocksBeforeEqualDate"}],["$","span",null,{"className":"token punctuation","children":"("}],"symbol",["$","span",null,{"className":"token punctuation","children":","}]," beforeDate ",["$","span",null,{"className":"token builtin","children":"string"}],["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token punctuation","children":"["}],["$","span",null,{"className":"token punctuation","children":"]"}],"model",["$","span",null,{"className":"token punctuation","children":"."}],"Stock ",["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}],["$","span",null,{"className":"code-line","children":["  ",["$","span",null,{"className":"token keyword","children":"if"}]," m",["$","span",null,{"className":"token punctuation","children":"."}],"GetStocksBeforeEqualDateFunc ",["$","span",null,{"className":"token operator","children":"!="}]," ",["$","span",null,{"className":"token boolean","children":"nil"}]," ",["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}],["$","span",null,{"className":"code-line","children":["    ",["$","span",null,{"className":"token keyword","children":"return"}]," m",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"GetStocksBeforeEqualDateFunc"}],["$","span",null,{"className":"token punctuation","children":"("}],"symbol",["$","span",null,{"className":"token punctuation","children":","}]," beforeDate",["$","span",null,{"className":"token punctuation","children":")"}],"\n"]}],["$","span",null,{"className":"code-line","children":[" ",["$","span",null,{"className":"token punctuation","children":"}"}],"\n"]}],["$","span",null,{"className":"code-line","children":["  ",["$","span",null,{"className":"token keyword","children":"return"}]," ",["$","span",null,{"className":"token boolean","children":"nil"}],"\n"]}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token punctuation","children":"}"}],"\n"]}],["$","span",null,{"className":"code-line","children":"\n"}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token keyword","children":"func"}]," ",["$","span",null,{"className":"token punctuation","children":"("}],"m ",["$","span",null,{"className":"token operator","children":"*"}],"StockDataAccessMockImpl",["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token function","children":"GetStockInfo"}],["$","span",null,{"className":"token punctuation","children":"("}],"symbolUUID ",["$","span",null,{"className":"token builtin","children":"string"}],["$","span",null,{"className":"token punctuation","children":")"}]," model",["$","span",null,{"className":"token punctuation","children":"."}],"StockInfo ",["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}],["$","span",null,{"className":"code-line","children":["  ",["$","span",null,{"className":"token keyword","children":"if"}]," m",["$","span",null,{"className":"token punctuation","children":"."}],"GetStockInfoFunc ",["$","span",null,{"className":"token operator","children":"!="}]," ",["$","span",null,{"className":"token boolean","children":"nil"}]," ",["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}],["$","span",null,{"className":"code-line","children":["    ",["$","span",null,{"className":"token keyword","children":"return"}]," m",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"GetStockInfoFunc"}],["$","span",null,{"className":"token punctuation","children":"("}],"symbolUUID",["$","span",null,{"className":"token punctuation","children":")"}],"\n"]}],["$","span",null,{"className":"code-line","children":[" ",["$","span",null,{"className":"token punctuation","children":"}"}],"\n"]}],["$","span",null,{"className":"code-line","children":["  ",["$","span",null,{"className":"token keyword","children":"return"}]," model",["$","span",null,{"className":"token punctuation","children":"."}],"StockInfo",["$","span",null,{"className":"token punctuation","children":"{"}],["$","span",null,{"className":"token punctuation","children":"}"}],"\n"]}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token punctuation","children":"}"}],"\n"]}],["$","span",null,{"className":"code-line","children":"\n"}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token keyword","children":"func"}]," ",["$","span",null,{"className":"token function","children":"TestGetRandomStockFromPersistence"}],["$","span",null,{"className":"token punctuation","children":"("}],"t ",["$","span",null,{"className":"token operator","children":"*"}],"testing",["$","span",null,{"className":"token punctuation","children":"."}],"T",["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}],["$","span",null,{"className":"code-line","children":["  ",["$","span",null,{"className":"token comment","children":"// Create a mockDataAccess object with a function GetUniqueStockSymbols that return fake symbols"}],"\n"]}],["$","span",null,{"className":"code-line","children":["  mockDataAccess ",["$","span",null,{"className":"token operator","children":":="}]," ",["$","span",null,{"className":"token operator","children":"&"}],"StockDataAccessMockImpl",["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}],["$","span",null,{"className":"code-line","children":["    GetUniqueStockSymbolsFunc",["$","span",null,{"className":"token punctuation","children":":"}]," ",["$","span",null,{"className":"token keyword","children":"func"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token punctuation","children":"["}],["$","span",null,{"className":"token punctuation","children":"]"}],["$","span",null,{"className":"token builtin","children":"string"}]," ",["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}],["$","span",null,{"className":"code-line","children":["      ",["$","span",null,{"className":"token keyword","children":"return"}]," ",["$","span",null,{"className":"token punctuation","children":"["}],["$","span",null,{"className":"token punctuation","children":"]"}],["$","span",null,{"className":"token builtin","children":"string"}],["$","span",null,{"className":"token punctuation","children":"{"}],["$","span",null,{"className":"token string","children":"\"AAPL\""}],["$","span",null,{"className":"token punctuation","children":","}]," ",["$","span",null,{"className":"token string","children":"\"GOOGL\""}],["$","span",null,{"className":"token punctuation","children":"}"}],"\n"]}],["$","span",null,{"className":"code-line","children":[" ",["$","span",null,{"className":"token punctuation","children":"}"}],["$","span",null,{"className":"token punctuation","children":","}],"\n"]}],["$","span",null,{"className":"code-line","children":["    GetPricesForStockFunc",["$","span",null,{"className":"token punctuation","children":":"}]," ",["$","span",null,{"className":"token keyword","children":"func"}],["$","span",null,{"className":"token punctuation","children":"("}],"symbol ",["$","span",null,{"className":"token builtin","children":"string"}],["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token punctuation","children":"["}],["$","span",null,{"className":"token punctuation","children":"]"}],"model",["$","span",null,{"className":"token punctuation","children":"."}],"StockPublic ",["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}],["$","span",null,{"className":"code-line","children":["      ",["$","span",null,{"className":"token keyword","children":"return"}]," ",["$","span",null,{"className":"token punctuation","children":"["}],["$","span",null,{"className":"token punctuation","children":"]"}],"model",["$","span",null,{"className":"token punctuation","children":"."}],"StockPublic",["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}],["$","span",null,{"className":"code-line","children":[" ",["$","span",null,{"className":"token punctuation","children":"{"}],"SymbolUUID",["$","span",null,{"className":"token punctuation","children":":"}]," ",["$","span",null,{"className":"token string","children":"\"AAPL\""}],["$","span",null,{"className":"token punctuation","children":","}]," Volume",["$","span",null,{"className":"token punctuation","children":":"}]," ",["$","span",null,{"className":"token number","children":"1000"}],["$","span",null,{"className":"token punctuation","children":","}]," Date",["$","span",null,{"className":"token punctuation","children":":"}]," ",["$","span",null,{"className":"token string","children":"\"2023-01-01\""}],["$","span",null,{"className":"token punctuation","children":","}]," Open",["$","span",null,{"className":"token punctuation","children":":"}]," ",["$","span",null,{"className":"token number","children":"100"}],["$","span",null,{"className":"token punctuation","children":","}]," High",["$","span",null,{"className":"token punctuation","children":":"}]," ",["$","span",null,{"className":"token number","children":"110"}],["$","span",null,{"className":"token punctuation","children":","}]," Low",["$","span",null,{"className":"token punctuation","children":":"}]," ",["$","span",null,{"className":"token number","children":"90"}],["$","span",null,{"className":"token punctuation","children":","}]," Close",["$","span",null,{"className":"token punctuation","children":":"}]," ",["$","span",null,{"className":"token number","children":"105"}],["$","span",null,{"className":"token punctuation","children":","}]," AdjClose",["$","span",null,{"className":"token punctuation","children":":"}]," ",["$","span",null,{"className":"token number","children":"1233"}],["$","span",null,{"className":"token punctuation","children":"}"}],["$","span",null,{"className":"token punctuation","children":","}],"\n"]}],["$","span",null,{"className":"code-line","children":[" ",["$","span",null,{"className":"token punctuation","children":"{"}],"SymbolUUID",["$","span",null,{"className":"token punctuation","children":":"}]," ",["$","span",null,{"className":"token string","children":"\"AAPL\""}],["$","span",null,{"className":"token punctuation","children":","}]," Volume",["$","span",null,{"className":"token punctuation","children":":"}]," ",["$","span",null,{"className":"token number","children":"2000"}],["$","span",null,{"className":"token punctuation","children":","}]," Date",["$","span",null,{"className":"token punctuation","children":":"}]," ",["$","span",null,{"className":"token string","children":"\"2023-01-02\""}],["$","span",null,{"className":"token punctuation","children":","}]," Open",["$","span",null,{"className":"token punctuation","children":":"}]," ",["$","span",null,{"className":"token number","children":"101"}],["$","span",null,{"className":"token punctuation","children":","}]," High",["$","span",null,{"className":"token punctuation","children":":"}]," ",["$","span",null,{"className":"token number","children":"111"}],["$","span",null,{"className":"token punctuation","children":","}]," Low",["$","span",null,{"className":"token punctuation","children":":"}]," ",["$","span",null,{"className":"token number","children":"89"}],["$","span",null,{"className":"token punctuation","children":","}]," Close",["$","span",null,{"className":"token punctuation","children":":"}]," ",["$","span",null,{"className":"token number","children":"107"}],["$","span",null,{"className":"token punctuation","children":","}]," AdjClose",["$","span",null,{"className":"token punctuation","children":":"}]," ",["$","span",null,{"className":"token number","children":"1550"}],["$","span",null,{"className":"token punctuation","children":"}"}],["$","span",null,{"className":"token punctuation","children":","}],"\n"]}],["$","span",null,{"className":"code-line","children":[" ",["$","span",null,{"className":"token punctuation","children":"}"}],"\n"]}],["$","span",null,{"className":"code-line","children":[" ",["$","span",null,{"className":"token punctuation","children":"}"}],["$","span",null,{"className":"token punctuation","children":","}],"\n"]}],["$","span",null,{"className":"code-line","children":[" ",["$","span",null,{"className":"token punctuation","children":"}"}],"\n"]}],["$","span",null,{"className":"code-line","children":["  mockService ",["$","span",null,{"className":"token operator","children":":="}]," ",["$","span",null,{"className":"token function","children":"NewStockService"}],["$","span",null,{"className":"token punctuation","children":"("}],"mockDataAccess",["$","span",null,{"className":"token punctuation","children":")"}],"\n"]}],["$","span",null,{"className":"code-line","children":["  stocks ",["$","span",null,{"className":"token operator","children":":="}]," mockService",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"GetRandomStockFromPersistence"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token punctuation","children":")"}],"\n"]}],["$","span",null,{"className":"code-line","children":["  ",["$","span",null,{"className":"token keyword","children":"if"}]," ",["$","span",null,{"className":"token function","children":"len"}],["$","span",null,{"className":"token punctuation","children":"("}],"stocks",["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token operator","children":"!="}]," ",["$","span",null,{"className":"token number","children":"2"}]," ",["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}],["$","span",null,{"className":"code-line","children":["    t",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"Errorf"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token string","children":"\"Expected the same amount of stock found in the database but found %d\""}],["$","span",null,{"className":"token punctuation","children":","}]," ",["$","span",null,{"className":"token function","children":"len"}],["$","span",null,{"className":"token punctuation","children":"("}],"stocks",["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":")"}],"\n"]}],["$","span",null,{"className":"code-line","children":[" ",["$","span",null,{"className":"token punctuation","children":"}"}],"\n"]}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token punctuation","children":"}"}],"\n"]}]]}]}],"\n",["$","p",null,{"children":"It is quite a bit of code but it gives flexibility."}],"\n",["$","h1",null,{"children":"Internal Package Function"}],"\n",["$","p",null,{"children":["The example still has one issue: the function tested of the struct calls another function of the same struct. The function ",["$","code",null,{"children":"GetRandomStock"}]," is a function part of the ",["$","code",null,{"children":"StockServiceImpl"}]," struct. It is not possible to mock it as it is not an interface. The solution is to create a function field in the struct. The function field is a function that can be passed as a parameter to the struct. Instead of having"]}],"\n",["$","pre",null,{"className":"language-go","children":["$","code",null,{"className":"language-go code-highlight","children":[["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token keyword","children":"type"}]," StockServiceImpl ",["$","span",null,{"className":"token keyword","children":"struct"}]," ",["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}],["$","span",null,{"className":"code-line","children":"  StockService StockService\n"}],["$","span",null,{"className":"code-line","children":["  StockDataAccess dataaccess",["$","span",null,{"className":"token punctuation","children":"."}],"StockDataAccess\n"]}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token punctuation","children":"}"}],"\n"]}],["$","span",null,{"className":"code-line","children":"\n"}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token keyword","children":"func"}]," ",["$","span",null,{"className":"token punctuation","children":"("}],"s ",["$","span",null,{"className":"token operator","children":"*"}],"StockServiceImpl",["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token function","children":"GetRandomStockFromPersistence"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token punctuation","children":"["}],["$","span",null,{"className":"token punctuation","children":"]"}],"model",["$","span",null,{"className":"token punctuation","children":"."}],"StockPublic ",["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}],["$","span",null,{"className":"code-line","children":["  syms ",["$","span",null,{"className":"token operator","children":":="}]," s",["$","span",null,{"className":"token punctuation","children":"."}],"StockDataAccess",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"GetUniqueStockSymbols"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token punctuation","children":")"}],"\n"]}],["$","span",null,{"className":"code-line","children":["  symbol ",["$","span",null,{"className":"token operator","children":":="}]," s",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"GetRandomStock"}],["$","span",null,{"className":"token punctuation","children":"("}],"syms",["$","span",null,{"className":"token punctuation","children":")"}],"\n"]}],["$","span",null,{"className":"code-line","children":["  stocks ",["$","span",null,{"className":"token operator","children":":="}]," s",["$","span",null,{"className":"token punctuation","children":"."}],"StockDataAccess",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"GetPricesForStock"}],["$","span",null,{"className":"token punctuation","children":"("}],"symbol",["$","span",null,{"className":"token punctuation","children":")"}],"\n"]}],["$","span",null,{"className":"code-line","children":["  ",["$","span",null,{"className":"token keyword","children":"return"}]," stocks\n"]}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token punctuation","children":"}"}],"\n"]}]]}]}],"\n",["$","p",null,{"children":"You add a function field to the struct:"}],"\n",["$","pre",null,{"className":"language-go","children":["$","code",null,{"className":"language-go code-highlight","children":[["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token keyword","children":"type"}]," StockServiceImpl ",["$","span",null,{"className":"token keyword","children":"struct"}]," ",["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}],["$","span",null,{"className":"code-line","children":"  StockService StockService\n"}],["$","span",null,{"className":"code-line","children":["  StockDataAccess dataaccess",["$","span",null,{"className":"token punctuation","children":"."}],"StockDataAccess\n"]}],["$","span",null,{"className":"code-line","children":["  MockGetRandomStockFunc  ",["$","span",null,{"className":"token keyword","children":"func"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token punctuation","children":"["}],["$","span",null,{"className":"token punctuation","children":"]"}],["$","span",null,{"className":"token builtin","children":"string"}],["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token builtin","children":"string"}]," ",["$","span",null,{"className":"token comment","children":"// <---- Does not need to be the same name as the function"}],"\n"]}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token punctuation","children":"}"}],"\n"]}]]}]}],"\n",["$","p",null,{"children":["And the ",["$","code",null,{"children":"GetRandomStockFromPersistence"}]," function now looks like this:"]}],"\n",["$","pre",null,{"className":"language-go","children":["$","code",null,{"className":"language-go code-highlight","children":[["$","span",null,{"className":"code-line","children":"\n"}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token keyword","children":"func"}]," ",["$","span",null,{"className":"token punctuation","children":"("}],"s ",["$","span",null,{"className":"token operator","children":"*"}],"StockServiceImpl",["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token function","children":"GetRandomStockFromPersistence"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token punctuation","children":"["}],["$","span",null,{"className":"token punctuation","children":"]"}],"model",["$","span",null,{"className":"token punctuation","children":"."}],"StockPublic ",["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}],["$","span",null,{"className":"code-line","children":["  syms ",["$","span",null,{"className":"token operator","children":":="}]," s",["$","span",null,{"className":"token punctuation","children":"."}],"StockDataAccess",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"GetUniqueStockSymbols"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token punctuation","children":")"}],"\n"]}],["$","span",null,{"className":"code-line","children":"\n"}],["$","span",null,{"className":"code-line","children":["  ",["$","span",null,{"className":"token keyword","children":"var"}]," symbol ",["$","span",null,{"className":"token builtin","children":"string"}],"\n"]}],["$","span",null,{"className":"code-line","children":["  ",["$","span",null,{"className":"token keyword","children":"if"}]," s",["$","span",null,{"className":"token punctuation","children":"."}],"MockGetRandomStockFunc ",["$","span",null,{"className":"token operator","children":"!="}]," ",["$","span",null,{"className":"token boolean","children":"nil"}]," ",["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}],["$","span",null,{"className":"code-line","children":["    symbol ",["$","span",null,{"className":"token operator","children":"="}]," s",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"MockGetRandomStockFunc"}],["$","span",null,{"className":"token punctuation","children":"("}],"syms",["$","span",null,{"className":"token punctuation","children":")"}],"\n"]}],["$","span",null,{"className":"code-line","children":[" ",["$","span",null,{"className":"token punctuation","children":"}"}]," ",["$","span",null,{"className":"token keyword","children":"else"}]," ",["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}],["$","span",null,{"className":"code-line","children":["    symbol ",["$","span",null,{"className":"token operator","children":"="}]," s",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"GetRandomStock"}],["$","span",null,{"className":"token punctuation","children":"("}],"syms",["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token comment","children":"// fallback to actual implementation"}],"\n"]}],["$","span",null,{"className":"code-line","children":[" ",["$","span",null,{"className":"token punctuation","children":"}"}],"\n"]}],["$","span",null,{"className":"code-line","children":"\n"}],["$","span",null,{"className":"code-line","children":["  stocks ",["$","span",null,{"className":"token operator","children":":="}]," s",["$","span",null,{"className":"token punctuation","children":"."}],"StockDataAccess",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"GetPricesForStock"}],["$","span",null,{"className":"token punctuation","children":"("}],"symbol",["$","span",null,{"className":"token punctuation","children":")"}],"\n"]}],["$","span",null,{"className":"code-line","children":["  ",["$","span",null,{"className":"token keyword","children":"return"}]," stocks\n"]}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token punctuation","children":"}"}],"\n"]}],["$","span",null,{"className":"code-line","children":"\n"}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token keyword","children":"func"}]," ",["$","span",null,{"className":"token punctuation","children":"("}],"s ",["$","span",null,{"className":"token operator","children":"*"}],"StockServiceImpl",["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token function","children":"GetRandomStock"}],["$","span",null,{"className":"token punctuation","children":"("}],"symbol ",["$","span",null,{"className":"token punctuation","children":"["}],["$","span",null,{"className":"token punctuation","children":"]"}],["$","span",null,{"className":"token builtin","children":"string"}],["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token builtin","children":"string"}]," ",["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}],["$","span",null,{"className":"code-line","children":["  index ",["$","span",null,{"className":"token operator","children":":="}]," rand",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"IntN"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token function","children":"len"}],["$","span",null,{"className":"token punctuation","children":"("}],"symbol",["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":")"}],"\n"]}],["$","span",null,{"className":"code-line","children":["  ",["$","span",null,{"className":"token keyword","children":"return"}]," symbol",["$","span",null,{"className":"token punctuation","children":"["}],"index",["$","span",null,{"className":"token punctuation","children":"]"}],"\n"]}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token punctuation","children":"}"}],"\n"]}]]}]}],"\n",["$","p",null,{"children":"The test is modified to inject the string to this function field."}],"\n",["$","pre",null,{"className":"language-go","children":["$","code",null,{"className":"language-go code-highlight","children":[["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token keyword","children":"func"}]," ",["$","span",null,{"className":"token function","children":"TestGetRandomStockFromPersistence"}],["$","span",null,{"className":"token punctuation","children":"("}],"t ",["$","span",null,{"className":"token operator","children":"*"}],"testing",["$","span",null,{"className":"token punctuation","children":"."}],"T",["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}],["$","span",null,{"className":"code-line","children":["  ",["$","span",null,{"className":"token comment","children":"// Create a mockDataAccess object with a function GetUniqueStockSymbols that return fake symbols"}],"\n"]}],["$","span",null,{"className":"code-line","children":["  mockDataAccess ",["$","span",null,{"className":"token operator","children":":="}]," ",["$","span",null,{"className":"token operator","children":"&"}],"StockDataAccessMockImpl",["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}],["$","span",null,{"className":"code-line","children":["    GetUniqueStockSymbolsFunc",["$","span",null,{"className":"token punctuation","children":":"}]," ",["$","span",null,{"className":"token keyword","children":"func"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token punctuation","children":"["}],["$","span",null,{"className":"token punctuation","children":"]"}],["$","span",null,{"className":"token builtin","children":"string"}]," ",["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}],["$","span",null,{"className":"code-line","children":["      ",["$","span",null,{"className":"token keyword","children":"return"}]," ",["$","span",null,{"className":"token punctuation","children":"["}],["$","span",null,{"className":"token punctuation","children":"]"}],["$","span",null,{"className":"token builtin","children":"string"}],["$","span",null,{"className":"token punctuation","children":"{"}],["$","span",null,{"className":"token string","children":"\"AAPL\""}],["$","span",null,{"className":"token punctuation","children":","}]," ",["$","span",null,{"className":"token string","children":"\"GOOGL\""}],["$","span",null,{"className":"token punctuation","children":"}"}],"\n"]}],["$","span",null,{"className":"code-line","children":[" ",["$","span",null,{"className":"token punctuation","children":"}"}],["$","span",null,{"className":"token punctuation","children":","}],"\n"]}],["$","span",null,{"className":"code-line","children":["    GetPricesForStockFunc",["$","span",null,{"className":"token punctuation","children":":"}]," ",["$","span",null,{"className":"token keyword","children":"func"}],["$","span",null,{"className":"token punctuation","children":"("}],"symbol ",["$","span",null,{"className":"token builtin","children":"string"}],["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token punctuation","children":"["}],["$","span",null,{"className":"token punctuation","children":"]"}],"model",["$","span",null,{"className":"token punctuation","children":"."}],"StockPublic ",["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}],["$","span",null,{"className":"code-line","children":["      ",["$","span",null,{"className":"token keyword","children":"return"}]," ",["$","span",null,{"className":"token punctuation","children":"["}],["$","span",null,{"className":"token punctuation","children":"]"}],"model",["$","span",null,{"className":"token punctuation","children":"."}],"StockPublic",["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}],["$","span",null,{"className":"code-line","children":[" ",["$","span",null,{"className":"token punctuation","children":"{"}],"SymbolUUID",["$","span",null,{"className":"token punctuation","children":":"}]," ",["$","span",null,{"className":"token string","children":"\"AAPL\""}],["$","span",null,{"className":"token punctuation","children":","}]," Volume",["$","span",null,{"className":"token punctuation","children":":"}]," ",["$","span",null,{"className":"token number","children":"1000"}],["$","span",null,{"className":"token punctuation","children":","}]," Date",["$","span",null,{"className":"token punctuation","children":":"}]," ",["$","span",null,{"className":"token string","children":"\"2023-01-01\""}],["$","span",null,{"className":"token punctuation","children":","}]," Open",["$","span",null,{"className":"token punctuation","children":":"}]," ",["$","span",null,{"className":"token number","children":"100"}],["$","span",null,{"className":"token punctuation","children":","}]," High",["$","span",null,{"className":"token punctuation","children":":"}]," ",["$","span",null,{"className":"token number","children":"110"}],["$","span",null,{"className":"token punctuation","children":","}]," Low",["$","span",null,{"className":"token punctuation","children":":"}]," ",["$","span",null,{"className":"token number","children":"90"}],["$","span",null,{"className":"token punctuation","children":","}]," Close",["$","span",null,{"className":"token punctuation","children":":"}]," ",["$","span",null,{"className":"token number","children":"105"}],["$","span",null,{"className":"token punctuation","children":","}]," AdjClose",["$","span",null,{"className":"token punctuation","children":":"}]," ",["$","span",null,{"className":"token number","children":"1233"}],["$","span",null,{"className":"token punctuation","children":"}"}],["$","span",null,{"className":"token punctuation","children":","}],"\n"]}],["$","span",null,{"className":"code-line","children":[" ",["$","span",null,{"className":"token punctuation","children":"{"}],"SymbolUUID",["$","span",null,{"className":"token punctuation","children":":"}]," ",["$","span",null,{"className":"token string","children":"\"AAPL\""}],["$","span",null,{"className":"token punctuation","children":","}]," Volume",["$","span",null,{"className":"token punctuation","children":":"}]," ",["$","span",null,{"className":"token number","children":"2000"}],["$","span",null,{"className":"token punctuation","children":","}]," Date",["$","span",null,{"className":"token punctuation","children":":"}]," ",["$","span",null,{"className":"token string","children":"\"2023-01-02\""}],["$","span",null,{"className":"token punctuation","children":","}]," Open",["$","span",null,{"className":"token punctuation","children":":"}]," ",["$","span",null,{"className":"token number","children":"101"}],["$","span",null,{"className":"token punctuation","children":","}]," High",["$","span",null,{"className":"token punctuation","children":":"}]," ",["$","span",null,{"className":"token number","children":"111"}],["$","span",null,{"className":"token punctuation","children":","}]," Low",["$","span",null,{"className":"token punctuation","children":":"}]," ",["$","span",null,{"className":"token number","children":"89"}],["$","span",null,{"className":"token punctuation","children":","}]," Close",["$","span",null,{"className":"token punctuation","children":":"}]," ",["$","span",null,{"className":"token number","children":"107"}],["$","span",null,{"className":"token punctuation","children":","}]," AdjClose",["$","span",null,{"className":"token punctuation","children":":"}]," ",["$","span",null,{"className":"token number","children":"1550"}],["$","span",null,{"className":"token punctuation","children":"}"}],["$","span",null,{"className":"token punctuation","children":","}],"\n"]}],["$","span",null,{"className":"code-line","children":[" ",["$","span",null,{"className":"token punctuation","children":"}"}],"\n"]}],["$","span",null,{"className":"code-line","children":[" ",["$","span",null,{"className":"token punctuation","children":"}"}],["$","span",null,{"className":"token punctuation","children":","}],"\n"]}],["$","span",null,{"className":"code-line","children":[" ",["$","span",null,{"className":"token punctuation","children":"}"}],"\n"]}],["$","span",null,{"className":"code-line","children":["  mockService ",["$","span",null,{"className":"token operator","children":":="}]," ",["$","span",null,{"className":"token operator","children":"&"}],"StockServiceImpl",["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}],["$","span",null,{"className":"code-line","children":["    StockDataAccess",["$","span",null,{"className":"token punctuation","children":":"}]," mockDataAccess",["$","span",null,{"className":"token punctuation","children":","}],"\n"]}],["$","span",null,{"className":"code-line","children":["    RandomStockFunc",["$","span",null,{"className":"token punctuation","children":":"}]," ",["$","span",null,{"className":"token keyword","children":"func"}],["$","span",null,{"className":"token punctuation","children":"("}],"symbols ",["$","span",null,{"className":"token punctuation","children":"["}],["$","span",null,{"className":"token punctuation","children":"]"}],["$","span",null,{"className":"token builtin","children":"string"}],["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token builtin","children":"string"}]," ",["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}],["$","span",null,{"className":"code-line","children":["      ",["$","span",null,{"className":"token keyword","children":"return"}]," ",["$","span",null,{"className":"token string","children":"\"AAPL\""}],"\n"]}],["$","span",null,{"className":"code-line","children":[" ",["$","span",null,{"className":"token punctuation","children":"}"}],["$","span",null,{"className":"token punctuation","children":","}],"\n"]}],["$","span",null,{"className":"code-line","children":[" ",["$","span",null,{"className":"token punctuation","children":"}"}],"\n"]}],["$","span",null,{"className":"code-line","children":["  stocks ",["$","span",null,{"className":"token operator","children":":="}]," mockService",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"GetRandomStockFromPersistence"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token punctuation","children":")"}],"\n"]}],["$","span",null,{"className":"code-line","children":["  ",["$","span",null,{"className":"token keyword","children":"if"}]," ",["$","span",null,{"className":"token function","children":"len"}],["$","span",null,{"className":"token punctuation","children":"("}],"stocks",["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token operator","children":"!="}]," ",["$","span",null,{"className":"token number","children":"2"}]," ",["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}],["$","span",null,{"className":"code-line","children":["    t",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"Errorf"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token string","children":"\"Expected the same amount of stock found in the database but found %d\""}],["$","span",null,{"className":"token punctuation","children":","}]," ",["$","span",null,{"className":"token function","children":"len"}],["$","span",null,{"className":"token punctuation","children":"("}],"stocks",["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":")"}],"\n"]}],["$","span",null,{"className":"code-line","children":[" ",["$","span",null,{"className":"token punctuation","children":"}"}],"\n"]}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token punctuation","children":"}"}],"\n"]}]]}]}],"\n",["$","h1",null,{"children":"The Real Code"}],"\n",["$","p",null,{"children":"The Go Rest API that call the service continues to be very similar from the beginning but pass the data access object to the service."}],"\n",["$","pre",null,{"className":"language-go","children":["$","code",null,{"className":"language-go code-highlight","children":[["$","span",null,{"className":"code-line","children":["stockDataAccess ",["$","span",null,{"className":"token operator","children":":="}]," dataaccess",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"NewStockDataAccess"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token punctuation","children":")"}],"\n"]}],["$","span",null,{"className":"code-line","children":"\n"}],["$","span",null,{"className":"code-line","children":["stockService ",["$","span",null,{"className":"token operator","children":":="}]," ",["$","span",null,{"className":"token operator","children":"&"}],"service",["$","span",null,{"className":"token punctuation","children":"."}],"StockServiceImpl",["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}],["$","span",null,{"className":"code-line","children":["  StockDataAccess",["$","span",null,{"className":"token punctuation","children":":"}]," stockDataAccess",["$","span",null,{"className":"token punctuation","children":","}],"\n"]}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token punctuation","children":"}"}],"\n"]}]]}]}],"\n",["$","p",null,{"children":"The code does not know the intricate details of the mocking. However, it needs to build the dependency tree. For example, the REST API code must pass the service's data access."}],"\n",["$","h1",null,{"children":"Spy count"}],"\n",["$","p",null,{"children":"Another feature many testing frameworks have is the ability to count how many times a function was called. The Go code does not have this feature. However, it is possible to add a counter to the mock implementation."}],"\n",["$","pre",null,{"className":"language-go","children":["$","code",null,{"className":"language-go code-highlight","children":[["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token keyword","children":"type"}]," StockDataAccessMockImpl ",["$","span",null,{"className":"token keyword","children":"struct"}]," ",["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}],["$","span",null,{"className":"code-line","children":["  GetPricesForStockFunc            ",["$","span",null,{"className":"token keyword","children":"func"}],["$","span",null,{"className":"token punctuation","children":"("}],"symbol ",["$","span",null,{"className":"token builtin","children":"string"}],["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token punctuation","children":"["}],["$","span",null,{"className":"token punctuation","children":"]"}],"model",["$","span",null,{"className":"token punctuation","children":"."}],"StockPublic\n"]}],["$","span",null,{"className":"code-line","children":["  GetUniqueStockSymbolsFunc        ",["$","span",null,{"className":"token keyword","children":"func"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token punctuation","children":"["}],["$","span",null,{"className":"token punctuation","children":"]"}],["$","span",null,{"className":"token builtin","children":"string"}],"\n"]}],["$","span",null,{"className":"code-line","children":["  GetUniqueStockSymbolsFuncCall    ",["$","span",null,{"className":"token builtin","children":"int"}]," ",["$","span",null,{"className":"token comment","children":"// <---- counter"}],"\n"]}],["$","span",null,{"className":"code-line","children":["  GetPricesForStockInTimeRangeFunc ",["$","span",null,{"className":"token keyword","children":"func"}],["$","span",null,{"className":"token punctuation","children":"("}],"symbol",["$","span",null,{"className":"token punctuation","children":","}]," startDate",["$","span",null,{"className":"token punctuation","children":","}]," endDate ",["$","span",null,{"className":"token builtin","children":"string"}],["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token punctuation","children":"["}],["$","span",null,{"className":"token punctuation","children":"]"}],"model",["$","span",null,{"className":"token punctuation","children":"."}],"Stock\n"]}],["$","span",null,{"className":"code-line","children":["  GetStocksAfterDateFunc           ",["$","span",null,{"className":"token keyword","children":"func"}],["$","span",null,{"className":"token punctuation","children":"("}],"symbol",["$","span",null,{"className":"token punctuation","children":","}]," afterDate ",["$","span",null,{"className":"token builtin","children":"string"}],["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token punctuation","children":"["}],["$","span",null,{"className":"token punctuation","children":"]"}],"model",["$","span",null,{"className":"token punctuation","children":"."}],"Stock\n"]}],["$","span",null,{"className":"code-line","children":["  GetStocksBeforeEqualDateFunc     ",["$","span",null,{"className":"token keyword","children":"func"}],["$","span",null,{"className":"token punctuation","children":"("}],"symbol",["$","span",null,{"className":"token punctuation","children":","}]," beforeDate ",["$","span",null,{"className":"token builtin","children":"string"}],["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token punctuation","children":"["}],["$","span",null,{"className":"token punctuation","children":"]"}],"model",["$","span",null,{"className":"token punctuation","children":"."}],"Stock\n"]}],["$","span",null,{"className":"code-line","children":["  GetStockInfoFunc                 ",["$","span",null,{"className":"token keyword","children":"func"}],["$","span",null,{"className":"token punctuation","children":"("}],"symbolUUID ",["$","span",null,{"className":"token builtin","children":"string"}],["$","span",null,{"className":"token punctuation","children":")"}]," model",["$","span",null,{"className":"token punctuation","children":"."}],"StockInfo\n"]}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token punctuation","children":"}"}],"\n"]}]]}]}],"\n",["$","p",null,{"children":"Then, inside the function of the mock implementation, you can increment the counter."}],"\n",["$","pre",null,{"className":"language-go","children":["$","code",null,{"className":"language-go code-highlight","children":[["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token keyword","children":"func"}]," ",["$","span",null,{"className":"token punctuation","children":"("}],"m ",["$","span",null,{"className":"token operator","children":"*"}],"StockDataAccessMockImpl",["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token function","children":"GetUniqueStockSymbols"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token punctuation","children":"["}],["$","span",null,{"className":"token punctuation","children":"]"}],["$","span",null,{"className":"token builtin","children":"string"}]," ",["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}],["$","span",null,{"className":"code-line","children":["  ",["$","span",null,{"className":"token keyword","children":"if"}]," m",["$","span",null,{"className":"token punctuation","children":"."}],"GetUniqueStockSymbolsFunc ",["$","span",null,{"className":"token operator","children":"!="}]," ",["$","span",null,{"className":"token boolean","children":"nil"}]," ",["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}],["$","span",null,{"className":"code-line","children":["    m",["$","span",null,{"className":"token punctuation","children":"."}],"GetUniqueStockSymbolsFuncCall",["$","span",null,{"className":"token operator","children":"++"}],"\n"]}],["$","span",null,{"className":"code-line","children":["    ",["$","span",null,{"className":"token keyword","children":"return"}]," m",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"GetUniqueStockSymbolsFunc"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token punctuation","children":")"}],"\n"]}],["$","span",null,{"className":"code-line","children":[" ",["$","span",null,{"className":"token punctuation","children":"}"}],"\n"]}],["$","span",null,{"className":"code-line","children":["  ",["$","span",null,{"className":"token keyword","children":"return"}]," ",["$","span",null,{"className":"token boolean","children":"nil"}],"\n"]}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token punctuation","children":"}"}],"\n"]}]]}]}],"\n",["$","p",null,{"children":"The test can then check the counter."}],"\n",["$","pre",null,{"className":"language-go","children":["$","code",null,{"className":"language-go code-highlight","children":[["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token keyword","children":"func"}]," ",["$","span",null,{"className":"token function","children":"TestGetRandomStockFromPersistence"}],["$","span",null,{"className":"token punctuation","children":"("}],"t ",["$","span",null,{"className":"token operator","children":"*"}],"testing",["$","span",null,{"className":"token punctuation","children":"."}],"T",["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}],["$","span",null,{"className":"code-line","children":["  ",["$","span",null,{"className":"token comment","children":"// Create a mockDataAccess object with a function GetUniqueStockSymbols that return fake symbols"}],"\n"]}],["$","span",null,{"className":"code-line","children":["  mockDataAccess ",["$","span",null,{"className":"token operator","children":":="}]," ",["$","span",null,{"className":"token operator","children":"&"}],"StockDataAccessMockImpl",["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}],["$","span",null,{"className":"code-line","children":["    GetUniqueStockSymbolsFunc",["$","span",null,{"className":"token punctuation","children":":"}]," ",["$","span",null,{"className":"token keyword","children":"func"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token punctuation","children":"["}],["$","span",null,{"className":"token punctuation","children":"]"}],["$","span",null,{"className":"token builtin","children":"string"}]," ",["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}],["$","span",null,{"className":"code-line","children":["      ",["$","span",null,{"className":"token keyword","children":"return"}]," ",["$","span",null,{"className":"token punctuation","children":"["}],["$","span",null,{"className":"token punctuation","children":"]"}],["$","span",null,{"className":"token builtin","children":"string"}],["$","span",null,{"className":"token punctuation","children":"{"}],["$","span",null,{"className":"token string","children":"\"AAPL\""}],["$","span",null,{"className":"token punctuation","children":","}]," ",["$","span",null,{"className":"token string","children":"\"GOOGL\""}],["$","span",null,{"className":"token punctuation","children":"}"}],"\n"]}],["$","span",null,{"className":"code-line","children":[" ",["$","span",null,{"className":"token punctuation","children":"}"}],["$","span",null,{"className":"token punctuation","children":","}],"\n"]}],["$","span",null,{"className":"code-line","children":["    GetPricesForStockFunc",["$","span",null,{"className":"token punctuation","children":":"}]," ",["$","span",null,{"className":"token keyword","children":"func"}],["$","span",null,{"className":"token punctuation","children":"("}],"symbol ",["$","span",null,{"className":"token builtin","children":"string"}],["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token punctuation","children":"["}],["$","span",null,{"className":"token punctuation","children":"]"}],"model",["$","span",null,{"className":"token punctuation","children":"."}],"StockPublic ",["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}],["$","span",null,{"className":"code-line","children":["      ",["$","span",null,{"className":"token keyword","children":"return"}]," ",["$","span",null,{"className":"token punctuation","children":"["}],["$","span",null,{"className":"token punctuation","children":"]"}],"model",["$","span",null,{"className":"token punctuation","children":"."}],"StockPublic",["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}],["$","span",null,{"className":"code-line","children":[" ",["$","span",null,{"className":"token punctuation","children":"{"}],"SymbolUUID",["$","span",null,{"className":"token punctuation","children":":"}]," ",["$","span",null,{"className":"token string","children":"\"AAPL\""}],["$","span",null,{"className":"token punctuation","children":","}]," Volume",["$","span",null,{"className":"token punctuation","children":":"}]," ",["$","span",null,{"className":"token number","children":"1000"}],["$","span",null,{"className":"token punctuation","children":","}]," Date",["$","span",null,{"className":"token punctuation","children":":"}]," ",["$","span",null,{"className":"token string","children":"\"2023-01-01\""}],["$","span",null,{"className":"token punctuation","children":","}]," Open",["$","span",null,{"className":"token punctuation","children":":"}]," ",["$","span",null,{"className":"token number","children":"100"}],["$","span",null,{"className":"token punctuation","children":","}]," High",["$","span",null,{"className":"token punctuation","children":":"}]," ",["$","span",null,{"className":"token number","children":"110"}],["$","span",null,{"className":"token punctuation","children":","}]," Low",["$","span",null,{"className":"token punctuation","children":":"}]," ",["$","span",null,{"className":"token number","children":"90"}],["$","span",null,{"className":"token punctuation","children":","}]," Close",["$","span",null,{"className":"token punctuation","children":":"}]," ",["$","span",null,{"className":"token number","children":"105"}],["$","span",null,{"className":"token punctuation","children":","}]," AdjClose",["$","span",null,{"className":"token punctuation","children":":"}]," ",["$","span",null,{"className":"token number","children":"1233"}],["$","span",null,{"className":"token punctuation","children":"}"}],["$","span",null,{"className":"token punctuation","children":","}],"\n"]}],["$","span",null,{"className":"code-line","children":[" ",["$","span",null,{"className":"token punctuation","children":"{"}],"SymbolUUID",["$","span",null,{"className":"token punctuation","children":":"}]," ",["$","span",null,{"className":"token string","children":"\"AAPL\""}],["$","span",null,{"className":"token punctuation","children":","}]," Volume",["$","span",null,{"className":"token punctuation","children":":"}]," ",["$","span",null,{"className":"token number","children":"2000"}],["$","span",null,{"className":"token punctuation","children":","}]," Date",["$","span",null,{"className":"token punctuation","children":":"}]," ",["$","span",null,{"className":"token string","children":"\"2023-01-02\""}],["$","span",null,{"className":"token punctuation","children":","}]," Open",["$","span",null,{"className":"token punctuation","children":":"}]," ",["$","span",null,{"className":"token number","children":"101"}],["$","span",null,{"className":"token punctuation","children":","}]," High",["$","span",null,{"className":"token punctuation","children":":"}]," ",["$","span",null,{"className":"token number","children":"111"}],["$","span",null,{"className":"token punctuation","children":","}]," Low",["$","span",null,{"className":"token punctuation","children":":"}]," ",["$","span",null,{"className":"token number","children":"89"}],["$","span",null,{"className":"token punctuation","children":","}]," Close",["$","span",null,{"className":"token punctuation","children":":"}]," ",["$","span",null,{"className":"token number","children":"107"}],["$","span",null,{"className":"token punctuation","children":","}]," AdjClose",["$","span",null,{"className":"token punctuation","children":":"}]," ",["$","span",null,{"className":"token number","children":"1550"}],["$","span",null,{"className":"token punctuation","children":"}"}],["$","span",null,{"className":"token punctuation","children":","}],"\n"]}],["$","span",null,{"className":"code-line","children":[" ",["$","span",null,{"className":"token punctuation","children":"}"}],"\n"]}],["$","span",null,{"className":"code-line","children":[" ",["$","span",null,{"className":"token punctuation","children":"}"}],["$","span",null,{"className":"token punctuation","children":","}],"\n"]}],["$","span",null,{"className":"code-line","children":[" ",["$","span",null,{"className":"token punctuation","children":"}"}],"\n"]}],["$","span",null,{"className":"code-line","children":["  mockService ",["$","span",null,{"className":"token operator","children":":="}]," ",["$","span",null,{"className":"token operator","children":"&"}],"StockServiceImpl",["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}],["$","span",null,{"className":"code-line","children":["    StockDataAccess",["$","span",null,{"className":"token punctuation","children":":"}]," mockDataAccess",["$","span",null,{"className":"token punctuation","children":","}],"\n"]}],["$","span",null,{"className":"code-line","children":["    MockGetRandomStockFunc",["$","span",null,{"className":"token punctuation","children":":"}]," ",["$","span",null,{"className":"token keyword","children":"func"}],["$","span",null,{"className":"token punctuation","children":"("}],"symbols ",["$","span",null,{"className":"token punctuation","children":"["}],["$","span",null,{"className":"token punctuation","children":"]"}],["$","span",null,{"className":"token builtin","children":"string"}],["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token builtin","children":"string"}]," ",["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}],["$","span",null,{"className":"code-line","children":["      ",["$","span",null,{"className":"token keyword","children":"return"}]," ",["$","span",null,{"className":"token string","children":"\"AAPL\""}],"\n"]}],["$","span",null,{"className":"code-line","children":[" ",["$","span",null,{"className":"token punctuation","children":"}"}],["$","span",null,{"className":"token punctuation","children":","}],"\n"]}],["$","span",null,{"className":"code-line","children":[" ",["$","span",null,{"className":"token punctuation","children":"}"}],"\n"]}],["$","span",null,{"className":"code-line","children":["  stocks ",["$","span",null,{"className":"token operator","children":":="}]," mockService",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"GetRandomStockFromPersistence"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token punctuation","children":")"}],"\n"]}],["$","span",null,{"className":"code-line","children":["  ",["$","span",null,{"className":"token keyword","children":"if"}]," ",["$","span",null,{"className":"token function","children":"len"}],["$","span",null,{"className":"token punctuation","children":"("}],"stocks",["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token operator","children":"!="}]," ",["$","span",null,{"className":"token number","children":"2"}]," ",["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}],["$","span",null,{"className":"code-line","children":["    t",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"Errorf"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token string","children":"\"Expected the same amount of stock found in the database but found %d\""}],["$","span",null,{"className":"token punctuation","children":","}]," ",["$","span",null,{"className":"token function","children":"len"}],["$","span",null,{"className":"token punctuation","children":"("}],"stocks",["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":")"}],"\n"]}],["$","span",null,{"className":"code-line","children":[" ",["$","span",null,{"className":"token punctuation","children":"}"}],"\n"]}],["$","span",null,{"className":"code-line","children":["  ",["$","span",null,{"className":"token keyword","children":"if"}]," mockDataAccess",["$","span",null,{"className":"token punctuation","children":"."}],"GetUniqueStockSymbolsFuncCall ",["$","span",null,{"className":"token operator","children":"!="}]," ",["$","span",null,{"className":"token number","children":"1"}]," ",["$","span",null,{"className":"token punctuation","children":"{"}]," ",["$","span",null,{"className":"token comment","children":"// <---- Check the counter"}],"\n"]}],["$","span",null,{"className":"code-line","children":["    t",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"Errorf"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token string","children":"\"Expected to call GetUniqueStockSymbols once but called %d times\""}],["$","span",null,{"className":"token punctuation","children":","}]," mockDataAccess",["$","span",null,{"className":"token punctuation","children":"."}],"GetUniqueStockSymbolsFuncCall",["$","span",null,{"className":"token punctuation","children":")"}],"\n"]}],["$","span",null,{"className":"code-line","children":[" ",["$","span",null,{"className":"token punctuation","children":"}"}],"\n"]}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token punctuation","children":"}"}],"\n"]}]]}]}],"\n",["$","h1",null,{"children":"Conclusion"}],"\n",["$","p",null,{"children":"The design pattern is neat in terms of the dependency of injection. However, it is verbose and increases the number of codes by creating all the functions that are repeated in the test file. The code defines a unique implementation of any functions for each test. However, it also pollute the real implementation with field functions for every internal function of your struct. Lastly, the tradeoff is having into the actual struct a condition to determine if we use the real implementation (structure function) or the mock implementation (field function)."}],"\n",["$","p",null,{"children":"The final observation is in terms of code coverage. Because there is a condition inside the real implementation, the code coverage is not 100%. The test will not cover the case where the mock function is not set. It is a tradeoff between code coverage and testability. The code coverage will be lower, but the testability will be higher."}],"\n",["$","p",null,{"children":"I am still learning Go, and I have briefly touched the surface. I'll continue to write about my discovery and amend it in future posts if there is a better solution. Meanwhile, this post will help you to understand how to write testable code in Go."}]]]}]]}],["$","div",null,{"className":"BlogBody_paginationBar__1gsMc","children":[["$","div",null,{"className":"BlogBody_paginationTitle__H_eFX","children":"Chronological Blog Articles by Page"}],["$","div",null,{"className":"BlogBody_paginationLinks__nk8zd","children":[["$","$L6","1",{"className":"","href":"/blog/page/1","children":1}],["$","$L6","2",{"className":"","href":"/blog/page/2","children":2}],["$","$L6","3",{"className":"","href":"/blog/page/3","children":3}],["$","$L6","4",{"className":"","href":"/blog/page/4","children":4}],["$","$L6","5",{"className":"","href":"/blog/page/5","children":5}],["$","$L6","6",{"className":"","href":"/blog/page/6","children":6}],["$","$L6","7",{"className":"","href":"/blog/page/7","children":7}],["$","$L6","8",{"className":"","href":"/blog/page/8","children":8}],["$","$L6","9",{"className":"","href":"/blog/page/9","children":9}],["$","$L6","10",{"className":"","href":"/blog/page/10","children":10}],["$","$L6","11",{"className":"","href":"/blog/page/11","children":11}],["$","$L6","12",{"className":"","href":"/blog/page/12","children":12}],["$","$L6","13",{"className":"","href":"/blog/page/13","children":13}],["$","$L6","14",{"className":"","href":"/blog/page/14","children":14}],["$","$L6","15",{"className":"","href":"/blog/page/15","children":15}],["$","$L6","16",{"className":"","href":"/blog/page/16","children":16}],["$","$L6","17",{"className":"","href":"/blog/page/17","children":17}],["$","$L6","18",{"className":"","href":"/blog/page/18","children":18}],["$","$L6","19",{"className":"","href":"/blog/page/19","children":19}],["$","$L6","20",{"className":"","href":"/blog/page/20","children":20}],["$","$L6","21",{"className":"","href":"/blog/page/21","children":21}],["$","$L6","22",{"className":"","href":"/blog/page/22","children":22}],["$","$L6","23",{"className":"","href":"/blog/page/23","children":23}],["$","$L6","24",{"className":"","href":"/blog/page/24","children":24}],["$","$L6","25",{"className":"","href":"/blog/page/25","children":25}],["$","$L6","26",{"className":"","href":"/blog/page/26","children":26}],["$","$L6","27",{"className":"","href":"/blog/page/27","children":27}],["$","$L6","28",{"className":"","href":"/blog/page/28","children":28}],["$","$L6","29",{"className":"","href":"/blog/page/29","children":29}],["$","$L6","30",{"className":"","href":"/blog/page/30","children":30}],["$","$L6","31",{"className":"","href":"/blog/page/31","children":31}],["$","$L6","32",{"className":"","href":"/blog/page/32","children":32}],["$","$L6","33",{"className":"","href":"/blog/page/33","children":33}],["$","$L6","34",{"className":"","href":"/blog/page/34","children":34}],["$","$L6","35",{"className":"","href":"/blog/page/35","children":35}],["$","$L6","36",{"className":"","href":"/blog/page/36","children":36}],["$","$L6","37",{"className":"","href":"/blog/page/37","children":37}],["$","$L6","38",{"className":"","href":"/blog/page/38","children":38}],["$","$L6","39",{"className":"","href":"/blog/page/39","children":39}],["$","$L6","40",{"className":"","href":"/blog/page/40","children":40}],["$","$L6","41",{"className":"","href":"/blog/page/41","children":41}],["$","$L6","42",{"className":"","href":"/blog/page/42","children":42}],["$","$L6","43",{"className":"","href":"/blog/page/43","children":43}],["$","$L6","44",{"className":"","href":"/blog/page/44","children":44}],["$","$L6","45",{"className":"","href":"/blog/page/45","children":45}],["$","$L6","46",{"className":"","href":"/blog/page/46","children":46}],["$","$L6","47",{"className":"","href":"/blog/page/47","children":47}],["$","$L6","48",{"className":"","href":"/blog/page/48","children":48}],["$","$L6","49",{"className":"","href":"/blog/page/49","children":49}],["$","$L6","50",{"className":"","href":"/blog/page/50","children":50}],["$","$L6","51",{"className":"","href":"/blog/page/51","children":51}],["$","$L6","52",{"className":"","href":"/blog/page/52","children":52}],["$","$L6","53",{"className":"","href":"/blog/page/53","children":53}],["$","$L6","54",{"className":"","href":"/blog/page/54","children":54}],["$","$L6","55",{"className":"","href":"/blog/page/55","children":55}],["$","$L6","56",{"className":"","href":"/blog/page/56","children":56}],["$","$L6","57",{"className":"","href":"/blog/page/57","children":57}],["$","$L6","58",{"className":"","href":"/blog/page/58","children":58}],["$","$L6","59",{"className":"","href":"/blog/page/59","children":59}],["$","$L6","60",{"className":"","href":"/blog/page/60","children":60}],["$","$L6","61",{"className":"","href":"/blog/page/61","children":61}],["$","$L6","62",{"className":"","href":"/blog/page/62","children":62}],["$","$L6","63",{"className":"","href":"/blog/page/63","children":63}],["$","$L6","64",{"className":"","href":"/blog/page/64","children":64}],["$","$L6","65",{"className":"","href":"/blog/page/65","children":65}],["$","$L6","66",{"className":"","href":"/blog/page/66","children":66}],["$","$L6","67",{"className":"","href":"/blog/page/67","children":67}],["$","$L6","68",{"className":"","href":"/blog/page/68","children":68}],["$","$L6","69",{"className":"","href":"/blog/page/69","children":69}],["$","$L6","70",{"className":"","href":"/blog/page/70","children":70}],["$","$L6","71",{"className":"","href":"/blog/page/71","children":71}],["$","$L6","72",{"className":"","href":"/blog/page/72","children":72}],["$","$L6","73",{"className":"","href":"/blog/page/73","children":73}],["$","$L6","74",{"className":"","href":"/blog/page/74","children":74}],["$","$L6","75",{"className":"","href":"/blog/page/75","children":75}],["$","$L6","76",{"className":"","href":"/blog/page/76","children":76}],["$","$L6","77",{"className":"","href":"/blog/page/77","children":77}],["$","$L6","78",{"className":"","href":"/blog/page/78","children":78}],["$","$L6","79",{"className":"","href":"/blog/page/79","children":79}]]}]]}]]}]
7:[["$","meta","0",{"name":"viewport","content":"width=device-width, initial-scale=1"}],["$","meta","1",{"charSet":"utf-8"}],["$","title","2",{"children":"Patrick Desjardins Blog - Unit Testing with Go Shaped How to Design my Functions"}],["$","meta","3",{"name":"description","content":"Unit Testing with Go Shaped How to Design my Functions"}]]
1:null
