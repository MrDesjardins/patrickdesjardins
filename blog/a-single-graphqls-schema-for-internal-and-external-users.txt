3:I[8766,[],""]
5:I[5623,[],""]
6:I[1534,["534","static/chunks/534-bc4bf8794653d52f.js","449","static/chunks/449-07387e3734c92aeb.js","308","static/chunks/app/blog/%5Bslug%5D/page-5279e1ccd7c02190.js"],""]
4:["slug","a-single-graphqls-schema-for-internal-and-external-users","d"]
0:["6rzbUp9-oDv5YygBl--JM",[[["",{"children":["blog",{"children":[["slug","a-single-graphqls-schema-for-internal-and-external-users","d"],{"children":["__PAGE__?{\"slug\":\"a-single-graphqls-schema-for-internal-and-external-users\"}",{}]}]}]},"$undefined","$undefined",true],["",{"children":["blog",{"children":[["slug","a-single-graphqls-schema-for-internal-and-external-users","d"],{"children":["__PAGE__",{},[["$L1","$L2",[["$","link","0",{"rel":"stylesheet","href":"/_next/static/css/be8a59717d6d5849.css","precedence":"next","crossOrigin":"$undefined"}],["$","link","1",{"rel":"stylesheet","href":"/_next/static/css/97e0a79122e618e4.css","precedence":"next","crossOrigin":"$undefined"}]]],null],null]},[null,["$","$L3",null,{"parallelRouterKey":"children","segmentPath":["children","blog","children","$4","children"],"error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L5",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":"$undefined","notFoundStyles":"$undefined"}]],null]},[[[["$","link","0",{"rel":"stylesheet","href":"/_next/static/css/dabd5e64a469b0e1.css","precedence":"next","crossOrigin":"$undefined"}]],["$","div",null,{"className":"layout_blogbodystyle___Uc1w","children":["$","$L3",null,{"parallelRouterKey":"children","segmentPath":["children","blog","children"],"error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L5",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":"$undefined","notFoundStyles":"$undefined"}]}]],null],null]},[[[["$","link","0",{"rel":"stylesheet","href":"/_next/static/css/4cb872a2a77e328a.css","precedence":"next","crossOrigin":"$undefined"}]],["$","html",null,{"lang":"en","className":"layout_htmlstyle__PseMz","children":["$","body",null,{"className":"layout_bodystyle__4ncsS","children":["$","$L3",null,{"parallelRouterKey":"children","segmentPath":["children"],"error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L5",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":["$","div",null,{"style":{"display":"flex","alignItems":"center","justifyContent":"center","height":"100vh"},"children":["$","div",null,{"style":{"width":"50%","height":"20%","backgroundColor":"#ffeded","borderRadius":12,"padding":12,"textAlign":"center"},"children":[["$","h1",null,{"children":"Not Found"}],["$","p",null,{"children":"Could not find requested resource"}],["$","$L6",null,{"href":"/","children":"Return Home"}]]}]}],"notFoundStyles":[]}]}]}]],null],null],["$L7",null]]]]
8:I[3449,["534","static/chunks/534-bc4bf8794653d52f.js","449","static/chunks/449-07387e3734c92aeb.js","308","static/chunks/app/blog/%5Bslug%5D/page-5279e1ccd7c02190.js"],"Image"]
2:["$","div",null,{"className":"BlogBody_BlogBody__600mT","children":[["$","header",null,{"className":"BlogBody_siteTitle__f7uyb","children":"Patrick Desjardins Blog"}],["$","nav",null,{"children":["$","ul",null,{"className":"BlogBody_navLinks__ZV12t","children":["$","li",null,{"className":"BlogBody_navLinkItem__Pml2e","children":[["$","$L6",null,{"className":"BlogBody_navLinkText__ZtH2y","href":"/","children":"Main Page"}],["$","$L6",null,{"className":"BlogBody_navLinkText__ZtH2y","href":"/blog","children":"Blog"}],["$","$L6",null,{"className":"BlogBody_navLinkText__ZtH2y","href":"/blog/search","children":"Search"}],[["$","$L6","2025",{"className":"BlogBody_navLinkText__ZtH2y","href":"/blog/for/2025","children":2025}],["$","$L6","2024",{"className":"BlogBody_navLinkText__ZtH2y","href":"/blog/for/2024","children":2024}],["$","$L6","2023",{"className":"BlogBody_navLinkText__ZtH2y","href":"/blog/for/2023","children":2023}],["$","$L6","2022",{"className":"BlogBody_navLinkText__ZtH2y","href":"/blog/for/2022","children":2022}],["$","$L6","2021",{"className":"BlogBody_navLinkText__ZtH2y","href":"/blog/for/2021","children":2021}],["$","$L6","2020",{"className":"BlogBody_navLinkText__ZtH2y","href":"/blog/for/2020","children":2020}],["$","$L6","2019",{"className":"BlogBody_navLinkText__ZtH2y","href":"/blog/for/2019","children":2019}],["$","$L6","2018",{"className":"BlogBody_navLinkText__ZtH2y","href":"/blog/for/2018","children":2018}],["$","$L6","2017",{"className":"BlogBody_navLinkText__ZtH2y","href":"/blog/for/2017","children":2017}],["$","$L6","2016",{"className":"BlogBody_navLinkText__ZtH2y","href":"/blog/for/2016","children":2016}],["$","$L6","2015",{"className":"BlogBody_navLinkText__ZtH2y","href":"/blog/for/2015","children":2015}],["$","$L6","2014",{"className":"BlogBody_navLinkText__ZtH2y","href":"/blog/for/2014","children":2014}],["$","$L6","2013",{"className":"BlogBody_navLinkText__ZtH2y","href":"/blog/for/2013","children":2013}],["$","$L6","2012",{"className":"BlogBody_navLinkText__ZtH2y","href":"/blog/for/2012","children":2012}],["$","$L6","2011",{"className":"BlogBody_navLinkText__ZtH2y","href":"/blog/for/2011","children":2011}]]]}]}]}],["$","div",null,{"className":"BlogBody_blogPictureContainer__IAbPL","children":["$","$L8",null,{"className":"BlogBody_blogTopPicture__L6lao","alt":"Patrick Desjardins picture from a conference","src":"/images/backgrounds/patrickdesjardins_conference_bw.webp","width":800,"height":260}]}],["$","main",null,{"className":"BlogBody_main__XrdKY","children":[["$","h1",null,{"className":"BlogBody_heading__bYRBe","children":"A Single GraphQL's Schema for Internal and External Users"}],["$","div",null,{"className":"Page_blogPostContainer__AUIcf","children":[["$","p",null,{"className":"Page_blogPostDate__wVWWB","children":["Posted on: ","2019-05-14"]}],[["$","p",null,{"children":"Imagine the scenario that you have a GraphQL schema that is consumed only by engineers of your organization. However, some engineers work on external facing applications while some other works on internal applications. The difference is subtle, but some information must remain confidential. While it might be more restrictive than most GraphQL that are fully public, there is the benefit that the schema is private and we can leverage that detail."}],"\n",["$","h1",null,{"children":"Internal vs External"}],"\n",["$","p",null,{"children":["In the scenario described, the GraphQL server is deployed into an Amazon VPC -- an ",["$","a",null,{"href":"https://aws.amazon.com/vpc/","children":"Amazon Virtual Private Cloud"}],". The environment is secured and the authorization is granted to only a limited to specific security groups."]}],"\n",["$","p",null,{"children":["$","img",null,{"src":"/images/blog/GraphQLServers-Page-11.png","alt":""}]}],"\n",["$","h1",null,{"children":"Internal vs External Environment"}],"\n",["$","p",null,{"children":["The challenge is not to limit the schema definition into an internal and external, but to have the external users not able to craft a request to access unexpected information. Because the GraphQL server is behind the VPC, it is not directly accessible by the user. The external application can communicate to the GraphQL server and every front-ends request to fetch data are proxied by the web server application. The proxy is important. It means that the browser of external users is not directly connected to the GraphQL server. Instead, the browser performs an AJAX call to the respective web server and this one, on the behalf of the user will conduct the GraphQL query. The proxy is conducted with the ",["$","a",null,{"href":"https://httpd.apache.org/docs/2.4/mod/mod_proxy.html","children":"ProxyPass"}]," instruction of Apache."]}],"\n",["$","p",null,{"children":"Internal applications do not have many constraints but keeping the same pattern of proxying is a good habit. It simplifies CORS because the browser performs HTTP requests to the same server, and only underneath it communicate to other servers. It also simplifies the security by having a central point of communication (the web server) to communicate with backend secured services."}],"\n",["$","h1",null,{"children":"GraphQL Single Schema"}],"\n",["$","p",null,{"children":"An obvious solution is to have two schemas: one internal and one external. The solution is the only choice if you need to expose the GraphQL schema externally without exposing the definition of internal fields and entities. However, because I had the constraint of not exposing GraphQL outside, I could simplify the maintainability by having a single schema. The problem with many schemas is that it does not scale very well. First, when adding a field that is good externally, you need to add it twice. Then, when it is time to modify or remove, you need to keep in synchronization the different schemas. Any little boilerplate cause the engineering experience to be a burden but also is prone to errors."}],"\n",["$","p",null,{"children":"In an ideal world, a single schema exists and we flag the field or entity to be only available internally. That world can exist with the power of GraphQL directive."}],"\n",["$","h1",null,{"children":"The GraphQL Directive Idea"}],"\n",["$","p",null,{"children":"GraphQL allows enhancing the graph's schema with annotation. Let's start with the end result which should talk more than any explanation."}],"\n",["$","pre",null,{"className":"language-typescript","children":["$","code",null,{"className":"language-typescript code-highlight","children":[["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token keyword","children":"type"}]," ",["$","span",null,{"className":"token class-name","children":"MyTypeA"}]," ",["$","span",null,{"className":"token punctuation","children":"{"}],"    \n"]}],["$","span",null,{"className":"code-line","children":["    fieldA",["$","span",null,{"className":"token operator","children":":"}]," EntityTypeA\n"]}],["$","span",null,{"className":"code-line","children":["    fieldB",["$","span",null,{"className":"token operator","children":":"}]," EntityTypeA ",["$","span",null,{"className":"token decorator","children":[["$","span",null,{"className":"token at operator","children":"@"}],["$","span",null,{"className":"token function","children":"internalData"}]]}],"\n"]}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token punctuation","children":"}"}],"\n"]}]]}]}],"\n",["$","p",null,{"children":"The idea is to add \"@internalData\" to every field that must be only visible to internal usage. The annotation marks field but also can mark a whole type."}],"\n",["$","pre",null,{"className":"language-typescript","children":["$","code",null,{"className":"language-typescript code-highlight","children":[["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token keyword","children":"type"}]," ",["$","span",null,{"className":"token class-name","children":"MyTypeA"}]," ",["$","span",null,{"className":"token decorator","children":[["$","span",null,{"className":"token at operator","children":"@"}],["$","span",null,{"className":"token function","children":"internalData"}]]}]," ",["$","span",null,{"className":"token punctuation","children":"{"}],"    \n"]}],["$","span",null,{"className":"code-line","children":["    fieldA",["$","span",null,{"className":"token operator","children":":"}]," EntityTypeA\n"]}],["$","span",null,{"className":"code-line","children":["    fieldB",["$","span",null,{"className":"token operator","children":":"}]," EntityTypeA\n"]}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token punctuation","children":"}"}],"\n"]}]]}]}],"\n",["$","p",null,{"children":"The idea is to have a single schema that had an indication that the field is added into a request will have some consequence. Because it is a single graph, the field appears in the interactive Graphql Playground and is a valid field to request; even externally. However, when invoked, GraphQL at runtime will be able to read the directive and perform a logic. In our case, the logic will be to verify the source of the request and figure out if the request is internal or not. In the case of an internal request, the data will be part of the response. If the source is external, an exception will occur and the field will be undefined."}],"\n",["$","h1",null,{"children":"How to build a GraphQL Directive?"}],"\n",["$","p",null,{"children":"The directive is two parts: one is in the GraphQL language (design time) and one is the logic to perform at runtime."}],"\n",["$","p",null,{"children":["In any .graphql file, you need to specify the directive to let know GraphQL about its existence. I created a file with the name of the directive and added this single line. The directive indicates that it can be applied to a type (",["$","em",null,{"children":"OBJECT"}],") or to a field (",["$","em",null,{"children":"FIELD_DEFINITION"}],"). The directive could also have arguments. For example, we could have a more advanced need to specify which role can access which field."]}],"\n",["$","p",null,{"children":"directive @internalData on OBJECT | FIELD_DEFINITION"}],"\n",["$","p",null,{"children":"The second part if to handle the directive. When merging all the resolvers and type definitions you can also specify the collection of directives. What you need to pass is a key-value pair with the directive name and the class of the directive (not the object). It means that you do not instantiate (new) the class, but only give a reference to the class."}],"\n",["$","pre",null,{"className":"language-typescript","children":["$","code",null,{"className":"language-typescript code-highlight","children":[["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token keyword","children":"const"}]," schemas ",["$","span",null,{"className":"token operator","children":"="}]," ",["$","span",null,{"className":"token function","children":"makeExecutableSchema"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}],["$","span",null,{"className":"code-line","children":["    typeDefs",["$","span",null,{"className":"token operator","children":":"}]," allSchemas",["$","span",null,{"className":"token punctuation","children":","}],"\n"]}],["$","span",null,{"className":"code-line","children":["    resolvers",["$","span",null,{"className":"token operator","children":":"}]," allResolvers",["$","span",null,{"className":"token punctuation","children":","}],"\n"]}],["$","span",null,{"className":"code-line","children":["    schemaDirectives",["$","span",null,{"className":"token operator","children":":"}]," ",["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}],["$","span",null,{"className":"code-line","children":["        internalData",["$","span",null,{"className":"token operator","children":":"}]," InternalDataDirective",["$","span",null,{"className":"token punctuation","children":","}],"\n"]}],["$","span",null,{"className":"code-line","children":["        ",["$","span",null,{"className":"token punctuation","children":"}"}],"\n"]}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token punctuation","children":"}"}],["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}]]}]}],"\n",["$","p",null,{"children":["The class must inherit ",["$","em",null,{"children":"SchemaDirectiveVisitor"}],". Then, because we have specified that it can be applied to a field and a type, we need to override two functions: ",["$","em",null,{"children":"visitFieldDefinition"}]," and ",["$","em",null,{"children":"visitObject"}],"."]}],"\n",["$","pre",null,{"className":"language-typescript","children":["$","code",null,{"className":"language-typescript code-highlight","children":[["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token keyword","children":"export"}]," ",["$","span",null,{"className":"token keyword","children":"class"}]," ",["$","span",null,{"className":"token class-name","children":"InternalDataDirective"}]," ",["$","span",null,{"className":"token keyword","children":"extends"}]," ",["$","span",null,{"className":"token class-name","children":"SchemaDirectiveVisitor"}]," ",["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}],["$","span",null,{"className":"code-line","children":["    ",["$","span",null,{"className":"token keyword","children":"private"}]," ",["$","span",null,{"className":"token keyword","children":"static"}]," ",["$","span",null,{"className":"token keyword","children":"readonly"}]," ",["$","span",null,{"className":"token constant","children":"INTERNAL_APP"}]," ",["$","span",null,{"className":"token operator","children":"="}]," ",["$","span",null,{"className":"token punctuation","children":"["}],["$","span",null,{"className":"token string","children":"\"app1\""}],["$","span",null,{"className":"token punctuation","children":","}]," ",["$","span",null,{"className":"token string","children":"\"app2\""}],["$","span",null,{"className":"token punctuation","children":","}]," ",["$","span",null,{"className":"token string","children":"\"app3\""}],["$","span",null,{"className":"token punctuation","children":"]"}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line","children":"\n"}],["$","span",null,{"className":"code-line","children":["    ",["$","span",null,{"className":"token keyword","children":"public"}]," ",["$","span",null,{"className":"token function","children":"visitObject"}],["$","span",null,{"className":"token punctuation","children":"("}],"object",["$","span",null,{"className":"token operator","children":":"}]," GraphQLObjectType",["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token operator","children":":"}]," GraphQLObjectType ",["$","span",null,{"className":"token operator","children":"|"}]," ",["$","span",null,{"className":"token keyword","children":"void"}]," ",["$","span",null,{"className":"token operator","children":"|"}]," ",["$","span",null,{"className":"token keyword","children":"null"}]," ",["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}],["$","span",null,{"className":"code-line","children":["        ",["$","span",null,{"className":"token keyword","children":"this"}],["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"ensureFieldsWrapped"}],["$","span",null,{"className":"token punctuation","children":"("}],"object",["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line","children":["    ",["$","span",null,{"className":"token punctuation","children":"}"}],"\n"]}],["$","span",null,{"className":"code-line","children":"\n"}],["$","span",null,{"className":"code-line","children":["    ",["$","span",null,{"className":"token keyword","children":"public"}]," ",["$","span",null,{"className":"token function","children":"visitFieldDefinition"}],["$","span",null,{"className":"token punctuation","children":"("}],"\n"]}],["$","span",null,{"className":"code-line","children":["        field",["$","span",null,{"className":"token operator","children":":"}]," GraphQLField",["$","span",null,{"className":"token operator","children":"<"}],["$","span",null,{"className":"token builtin","children":"any"}],["$","span",null,{"className":"token punctuation","children":","}]," ",["$","span",null,{"className":"token builtin","children":"any"}],["$","span",null,{"className":"token operator","children":">"}],["$","span",null,{"className":"token punctuation","children":","}],"\n"]}],["$","span",null,{"className":"code-line","children":["        details",["$","span",null,{"className":"token operator","children":":"}]," ",["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}],["$","span",null,{"className":"code-line","children":["            objectType",["$","span",null,{"className":"token operator","children":":"}]," GraphQLObjectType ",["$","span",null,{"className":"token operator","children":"|"}]," GraphQLInterfaceType",["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line","children":["        ",["$","span",null,{"className":"token punctuation","children":"}"}],"\n"]}],["$","span",null,{"className":"code-line","children":["    ",["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token operator","children":":"}]," GraphQLField",["$","span",null,{"className":"token operator","children":"<"}],["$","span",null,{"className":"token builtin","children":"any"}],["$","span",null,{"className":"token punctuation","children":","}]," ",["$","span",null,{"className":"token builtin","children":"any"}],["$","span",null,{"className":"token operator","children":">"}]," ",["$","span",null,{"className":"token operator","children":"|"}]," ",["$","span",null,{"className":"token keyword","children":"void"}]," ",["$","span",null,{"className":"token operator","children":"|"}]," ",["$","span",null,{"className":"token keyword","children":"null"}]," ",["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}],["$","span",null,{"className":"code-line","children":["        ",["$","span",null,{"className":"token keyword","children":"this"}],["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"checkField"}],["$","span",null,{"className":"token punctuation","children":"("}],"field",["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line","children":["    ",["$","span",null,{"className":"token punctuation","children":"}"}],"\n"]}],["$","span",null,{"className":"code-line","children":"\n"}],["$","span",null,{"className":"code-line","children":["    ",["$","span",null,{"className":"token keyword","children":"private"}]," ",["$","span",null,{"className":"token function","children":"ensureFieldsWrapped"}],["$","span",null,{"className":"token punctuation","children":"("}],"objectType",["$","span",null,{"className":"token operator","children":":"}]," GraphQLObjectType ",["$","span",null,{"className":"token operator","children":"|"}]," GraphQLInterfaceType",["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}],["$","span",null,{"className":"code-line","children":["        ",["$","span",null,{"className":"token keyword","children":"if"}]," ",["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token punctuation","children":"("}],"objectType ",["$","span",null,{"className":"token keyword","children":"as"}]," ",["$","span",null,{"className":"token builtin","children":"any"}],["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":"."}],"__scopeWrapped",["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}],["$","span",null,{"className":"code-line","children":["            ",["$","span",null,{"className":"token keyword","children":"return"}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line","children":["        ",["$","span",null,{"className":"token punctuation","children":"}"}]," ",["$","span",null,{"className":"token keyword","children":"else"}]," ",["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}],["$","span",null,{"className":"code-line","children":["            ",["$","span",null,{"className":"token punctuation","children":"("}],"objectType ",["$","span",null,{"className":"token keyword","children":"as"}]," ",["$","span",null,{"className":"token builtin","children":"any"}],["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":"."}],"__scopeWrapped ",["$","span",null,{"className":"token operator","children":"="}]," ",["$","span",null,{"className":"token boolean","children":"true"}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line","children":["        ",["$","span",null,{"className":"token punctuation","children":"}"}],"\n"]}],["$","span",null,{"className":"code-line","children":["        ",["$","span",null,{"className":"token keyword","children":"const"}]," fields ",["$","span",null,{"className":"token operator","children":"="}]," objectType",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"getFields"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line","children":"\n"}],["$","span",null,{"className":"code-line","children":["        Object",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"keys"}],["$","span",null,{"className":"token punctuation","children":"("}],"fields",["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"forEach"}],["$","span",null,{"className":"token punctuation","children":"("}],"fieldName ",["$","span",null,{"className":"token operator","children":"=>"}]," ",["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}],["$","span",null,{"className":"code-line","children":["            ",["$","span",null,{"className":"token keyword","children":"const"}]," field ",["$","span",null,{"className":"token operator","children":"="}]," fields",["$","span",null,{"className":"token punctuation","children":"["}],"fieldName",["$","span",null,{"className":"token punctuation","children":"]"}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line","children":["            ",["$","span",null,{"className":"token keyword","children":"this"}],["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"checkField"}],["$","span",null,{"className":"token punctuation","children":"("}],"field",["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line","children":["        ",["$","span",null,{"className":"token punctuation","children":"}"}],["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line","children":["    ",["$","span",null,{"className":"token punctuation","children":"}"}],"\n"]}],["$","span",null,{"className":"code-line","children":"\n"}],["$","span",null,{"className":"code-line","children":["    ",["$","span",null,{"className":"token keyword","children":"private"}]," ",["$","span",null,{"className":"token function","children":"checkField"}],["$","span",null,{"className":"token punctuation","children":"("}],"field",["$","span",null,{"className":"token operator","children":":"}]," GraphQLField",["$","span",null,{"className":"token operator","children":"<"}],["$","span",null,{"className":"token builtin","children":"any"}],["$","span",null,{"className":"token punctuation","children":","}]," ",["$","span",null,{"className":"token builtin","children":"any"}],["$","span",null,{"className":"token operator","children":">"}],["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token operator","children":":"}]," ",["$","span",null,{"className":"token keyword","children":"void"}]," ",["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}],["$","span",null,{"className":"code-line","children":["        ",["$","span",null,{"className":"token keyword","children":"const"}]," ",["$","span",null,{"className":"token punctuation","children":"{"}]," resolve ",["$","span",null,{"className":"token operator","children":"="}]," defaultFieldResolver ",["$","span",null,{"className":"token punctuation","children":"}"}]," ",["$","span",null,{"className":"token operator","children":"="}]," field",["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line","children":["        field",["$","span",null,{"className":"token punctuation","children":"."}],"description ",["$","span",null,{"className":"token operator","children":"="}]," ",["$","span",null,{"className":"token template-string","children":[["$","span",null,{"className":"token template-punctuation string","children":"`"}],["$","span",null,{"className":"token string","children":"🔐 Internal Field. Only available for: "}],["$","span",null,{"className":"token interpolation","children":[["$","span",null,{"className":"token interpolation-punctuation punctuation","children":"$${"}],"InternalDataDirective",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token constant","children":"INTERNAL_APP"}],["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"join"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token string","children":"\", \""}],["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token interpolation-punctuation punctuation","children":"}"}]]}],["$","span",null,{"className":"token string","children":"."}],["$","span",null,{"className":"token template-punctuation string","children":"`"}]]}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line","children":["        field",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function-variable function","children":"resolve"}]," ",["$","span",null,{"className":"token operator","children":"="}]," ",["$","span",null,{"className":"token keyword","children":"async"}]," ",["$","span",null,{"className":"token keyword","children":"function"}],["$","span",null,{"className":"token punctuation","children":"("}],"\n"]}],["$","span",null,{"className":"code-line","children":["            source",["$","span",null,{"className":"token operator","children":":"}]," ",["$","span",null,{"className":"token builtin","children":"any"}],["$","span",null,{"className":"token punctuation","children":","}],"\n"]}],["$","span",null,{"className":"code-line","children":["            args",["$","span",null,{"className":"token operator","children":":"}]," ",["$","span",null,{"className":"token builtin","children":"any"}],["$","span",null,{"className":"token punctuation","children":","}],"\n"]}],["$","span",null,{"className":"code-line","children":["            context",["$","span",null,{"className":"token operator","children":":"}]," GraphQLCustomResolversContext",["$","span",null,{"className":"token punctuation","children":","}],"\n"]}],["$","span",null,{"className":"code-line","children":["            graphQLResolveInfo",["$","span",null,{"className":"token operator","children":":"}]," GraphQLResolveInfo\n"]}],["$","span",null,{"className":"code-line","children":["        ",["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}],["$","span",null,{"className":"code-line","children":["            ",["$","span",null,{"className":"token keyword","children":"if"}]," ",["$","span",null,{"className":"token punctuation","children":"("}],"\n"]}],["$","span",null,{"className":"code-line","children":["                context",["$","span",null,{"className":"token punctuation","children":"."}],"req",["$","span",null,{"className":"token punctuation","children":"."}],"appOrigin ",["$","span",null,{"className":"token operator","children":"==="}]," ",["$","span",null,{"className":"token keyword","children":"undefined"}]," ",["$","span",null,{"className":"token operator","children":"||"}],"\n"]}],["$","span",null,{"className":"code-line","children":["                ",["$","span",null,{"className":"token operator","children":"!"}],"InternalDataDirective",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token constant","children":"INTERNAL_APP"}],["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"includes"}],["$","span",null,{"className":"token punctuation","children":"("}],"context",["$","span",null,{"className":"token punctuation","children":"."}],"req",["$","span",null,{"className":"token punctuation","children":"."}],"appOrigin",["$","span",null,{"className":"token punctuation","children":")"}],"\n"]}],["$","span",null,{"className":"code-line","children":["            ",["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}],["$","span",null,{"className":"code-line","children":["                ",["$","span",null,{"className":"token keyword","children":"throw"}]," ",["$","span",null,{"className":"token keyword","children":"new"}]," ",["$","span",null,{"className":"token class-name","children":"Error"}],["$","span",null,{"className":"token punctuation","children":"("}],"\n"]}],["$","span",null,{"className":"code-line","children":["                    ",["$","span",null,{"className":"token template-string","children":[["$","span",null,{"className":"token template-punctuation string","children":"`"}],["$","span",null,{"className":"token string","children":"The field ["}],["$","span",null,{"className":"token interpolation","children":[["$","span",null,{"className":"token interpolation-punctuation punctuation","children":"$${"}],"field",["$","span",null,{"className":"token punctuation","children":"."}],"name",["$","span",null,{"className":"token interpolation-punctuation punctuation","children":"}"}]]}],["$","span",null,{"className":"token string","children":"] has an internal scope and does not allow access for the application ["}],["$","span",null,{"className":"token interpolation","children":[["$","span",null,{"className":"token interpolation-punctuation punctuation","children":"$${"}],"\n"]}]]}]]}],["$","span",null,{"className":"code-line","children":["$","span",null,{"className":"token template-string","children":["$","span",null,{"className":"token interpolation","children":["                        context",["$","span",null,{"className":"token punctuation","children":"."}],"req",["$","span",null,{"className":"token punctuation","children":"."}],"appOrigin\n"]}]}]}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token template-string","children":[["$","span",null,{"className":"token interpolation","children":["                    ",["$","span",null,{"className":"token interpolation-punctuation punctuation","children":"}"}]]}],["$","span",null,{"className":"token string","children":"]"}],["$","span",null,{"className":"token template-punctuation string","children":"`"}]]}],"\n"]}],["$","span",null,{"className":"code-line","children":["                ",["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line","children":["            ",["$","span",null,{"className":"token punctuation","children":"}"}],"\n"]}],["$","span",null,{"className":"code-line","children":"\n"}],["$","span",null,{"className":"code-line","children":["            ",["$","span",null,{"className":"token keyword","children":"const"}]," result ",["$","span",null,{"className":"token operator","children":"="}]," ",["$","span",null,{"className":"token keyword","children":"await"}]," ",["$","span",null,{"className":"token function","children":"resolve"}],["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"apply"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token keyword","children":"this"}],["$","span",null,{"className":"token punctuation","children":","}]," ",["$","span",null,{"className":"token punctuation","children":"["}],"source",["$","span",null,{"className":"token punctuation","children":","}]," args",["$","span",null,{"className":"token punctuation","children":","}]," context",["$","span",null,{"className":"token punctuation","children":","}]," graphQLResolveInfo",["$","span",null,{"className":"token punctuation","children":"]"}],["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line","children":["            ",["$","span",null,{"className":"token keyword","children":"return"}]," result",["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line","children":["        ",["$","span",null,{"className":"token punctuation","children":"}"}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line","children":["    ",["$","span",null,{"className":"token punctuation","children":"}"}],"\n"]}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token punctuation","children":"}"}],"\n"]}]]}]}],"\n",["$","p",null,{"children":"The directive converges the two entry points (field and object) into a single function. The two functions are called once when the class is instantiated by the GraphQL code at the startup of the server. It means that you cannot have custom logic in the visit functions. The dynamic aspect appends because we wrap the resolve of the field. It means that the actual resolution is executed but the code specified in \"checkField\" is also performed at runtime. In the code excerpt, we see that it checks for a list of accepted internal applications. If the field has the directive, it goes into the directive's resolver and checks if the origin if from the list of accepted internal application. If not, it throws an error."}],"\n",["$","p",null,{"children":"A little detail, it is possible to inject a description from the directive that is set on the initialization of this one. In my case, I specify that the field is private and mention which application can access it. If a software engineer needs an application to be on the list, it requires a code change. This is not something that happens often and because a code change is required it involves a pull request where many people will have a look."}],"\n",["$","p",null,{"children":["$","img",null,{"src":"/images/blog/graphqlinternalfield.png","alt":""}]}],"\n",["$","p",null,{"children":"Example of how it looks from the GraphQL Interactive Playground. The engineer who build the query knows that it is an internal field as well as under which application the response will return a value"}],"\n",["$","h1",null,{"children":"Conclusion"}],"\n",["$","p",null,{"children":"The more I work with different organizations, code bases, and technologies, the more I lean toward simplicity. There is so many changes, so many ways to get very deep into subjects and so little time. Getting into complex solution often cause the maintainability a nightmare or make some people very dependent. The solution of a directive in GraphQL took less than 150 lines of code and can scale toward the entire graph of objects without having a dependency on a system to manage many schemas. The security of the information is preserved, the engineers that consume the graph are aware when building the query (description) and while executing the query (error), and the engineers building the graph can add the tag to the fields or types which take a few seconds without having to worry about the detail of the implementation."}],"\n",["$","h1",null,{"children":"My Other GraphQL Blog Posts"}],"\n",["$","ul",null,{"children":["\n",["$","li",null,{"children":["$","a",null,{"href":"getting-started-with-graphql-for-netflix-open-connect","children":"Getting Started with GraphQL for Netflix Open Connect"}]}],"\n",["$","li",null,{"children":["$","a",null,{"href":"install-apollo-server-to-host-a-graphql-service","children":"Install Apollo Server to host a GraphQL service"}]}],"\n",["$","li",null,{"children":["$","a",null,{"href":"apollo-server-and-secured-playground","children":"Apollo Server and Secured Playground"}]}],"\n",["$","li",null,{"children":["$","a",null,{"href":"graphql-context","children":"GraphQL Context"}]}],"\n",["$","li",null,{"children":["$","a",null,{"href":"graphql-query-with-argument","children":"GraphQL Query with Argument"}]}],"\n",["$","li",null,{"children":["$","a",null,{"href":"apollo-graphql-resolvers-and-data-source-separation","children":"Apollo GraphQL Resolvers and Data Source separation"}]}],"\n",["$","li",null,{"children":["$","a",null,{"href":"how-to-setup-a-typescript-nodejs-express-apollo-server-to-easy-debugging-with-vscode","children":"How to setup a TypeScript, NodeJS, Express Apollo Server to easy debugging with VsCode"}]}],"\n",["$","li",null,{"children":["$","a",null,{"href":"graphql-resolvers-with-apollo","children":"GraphQL Resolvers with Apollo"}]}],"\n",["$","li",null,{"children":["$","a",null,{"href":"configuring-apollo-playground-and-api-on-two-different-url","children":"Configuring Apollo Playground and API on two different URL"}]}],"\n",["$","li",null,{"children":["$","a",null,{"href":"how-to-automatically-generate-typescript-for-consumer-of-your-graphql","children":"How to automatically generate TypeScript for consumers of your GraphQL"}]}],"\n",["$","li",null,{"children":["$","a",null,{"href":"graphql-extension-to-collect-http-and-resolvers-telemetry","children":"GraphQL and HTTP Telemetry"}]}],"\n",["$","li",null,{"children":["$","a",null,{"href":"how-to-consume-graphql-in-typescript-and-react","children":"GraphQL and TypeScript/React"}]}],"\n"]}]]]}]]}],["$","div",null,{"className":"BlogBody_paginationBar__1gsMc","children":[["$","div",null,{"className":"BlogBody_paginationTitle__H_eFX","children":"Chronological Blog Articles by Page"}],["$","div",null,{"className":"BlogBody_paginationLinks__nk8zd","children":[["$","$L6","1",{"className":"","href":"/blog/page/1","children":1}],["$","$L6","2",{"className":"","href":"/blog/page/2","children":2}],["$","$L6","3",{"className":"","href":"/blog/page/3","children":3}],["$","$L6","4",{"className":"","href":"/blog/page/4","children":4}],["$","$L6","5",{"className":"","href":"/blog/page/5","children":5}],["$","$L6","6",{"className":"","href":"/blog/page/6","children":6}],["$","$L6","7",{"className":"","href":"/blog/page/7","children":7}],["$","$L6","8",{"className":"","href":"/blog/page/8","children":8}],["$","$L6","9",{"className":"","href":"/blog/page/9","children":9}],["$","$L6","10",{"className":"","href":"/blog/page/10","children":10}],["$","$L6","11",{"className":"","href":"/blog/page/11","children":11}],["$","$L6","12",{"className":"","href":"/blog/page/12","children":12}],["$","$L6","13",{"className":"","href":"/blog/page/13","children":13}],["$","$L6","14",{"className":"","href":"/blog/page/14","children":14}],["$","$L6","15",{"className":"","href":"/blog/page/15","children":15}],["$","$L6","16",{"className":"","href":"/blog/page/16","children":16}],["$","$L6","17",{"className":"","href":"/blog/page/17","children":17}],["$","$L6","18",{"className":"","href":"/blog/page/18","children":18}],["$","$L6","19",{"className":"","href":"/blog/page/19","children":19}],["$","$L6","20",{"className":"","href":"/blog/page/20","children":20}],["$","$L6","21",{"className":"","href":"/blog/page/21","children":21}],["$","$L6","22",{"className":"","href":"/blog/page/22","children":22}],["$","$L6","23",{"className":"","href":"/blog/page/23","children":23}],["$","$L6","24",{"className":"","href":"/blog/page/24","children":24}],["$","$L6","25",{"className":"","href":"/blog/page/25","children":25}],["$","$L6","26",{"className":"","href":"/blog/page/26","children":26}],["$","$L6","27",{"className":"","href":"/blog/page/27","children":27}],["$","$L6","28",{"className":"","href":"/blog/page/28","children":28}],["$","$L6","29",{"className":"","href":"/blog/page/29","children":29}],["$","$L6","30",{"className":"","href":"/blog/page/30","children":30}],["$","$L6","31",{"className":"","href":"/blog/page/31","children":31}],["$","$L6","32",{"className":"","href":"/blog/page/32","children":32}],["$","$L6","33",{"className":"","href":"/blog/page/33","children":33}],["$","$L6","34",{"className":"","href":"/blog/page/34","children":34}],["$","$L6","35",{"className":"","href":"/blog/page/35","children":35}],["$","$L6","36",{"className":"","href":"/blog/page/36","children":36}],["$","$L6","37",{"className":"","href":"/blog/page/37","children":37}],["$","$L6","38",{"className":"","href":"/blog/page/38","children":38}],["$","$L6","39",{"className":"","href":"/blog/page/39","children":39}],["$","$L6","40",{"className":"","href":"/blog/page/40","children":40}],["$","$L6","41",{"className":"","href":"/blog/page/41","children":41}],["$","$L6","42",{"className":"","href":"/blog/page/42","children":42}],["$","$L6","43",{"className":"","href":"/blog/page/43","children":43}],["$","$L6","44",{"className":"","href":"/blog/page/44","children":44}],["$","$L6","45",{"className":"","href":"/blog/page/45","children":45}],["$","$L6","46",{"className":"","href":"/blog/page/46","children":46}],["$","$L6","47",{"className":"","href":"/blog/page/47","children":47}],["$","$L6","48",{"className":"","href":"/blog/page/48","children":48}],["$","$L6","49",{"className":"","href":"/blog/page/49","children":49}],["$","$L6","50",{"className":"","href":"/blog/page/50","children":50}],["$","$L6","51",{"className":"","href":"/blog/page/51","children":51}],["$","$L6","52",{"className":"","href":"/blog/page/52","children":52}],["$","$L6","53",{"className":"","href":"/blog/page/53","children":53}],["$","$L6","54",{"className":"","href":"/blog/page/54","children":54}],["$","$L6","55",{"className":"","href":"/blog/page/55","children":55}],["$","$L6","56",{"className":"","href":"/blog/page/56","children":56}],["$","$L6","57",{"className":"","href":"/blog/page/57","children":57}],["$","$L6","58",{"className":"","href":"/blog/page/58","children":58}],["$","$L6","59",{"className":"","href":"/blog/page/59","children":59}],["$","$L6","60",{"className":"","href":"/blog/page/60","children":60}],["$","$L6","61",{"className":"","href":"/blog/page/61","children":61}],["$","$L6","62",{"className":"","href":"/blog/page/62","children":62}],["$","$L6","63",{"className":"","href":"/blog/page/63","children":63}],["$","$L6","64",{"className":"","href":"/blog/page/64","children":64}],["$","$L6","65",{"className":"","href":"/blog/page/65","children":65}],["$","$L6","66",{"className":"","href":"/blog/page/66","children":66}],["$","$L6","67",{"className":"","href":"/blog/page/67","children":67}],["$","$L6","68",{"className":"","href":"/blog/page/68","children":68}],["$","$L6","69",{"className":"","href":"/blog/page/69","children":69}],["$","$L6","70",{"className":"","href":"/blog/page/70","children":70}],["$","$L6","71",{"className":"","href":"/blog/page/71","children":71}],["$","$L6","72",{"className":"","href":"/blog/page/72","children":72}],["$","$L6","73",{"className":"","href":"/blog/page/73","children":73}],["$","$L6","74",{"className":"","href":"/blog/page/74","children":74}],["$","$L6","75",{"className":"","href":"/blog/page/75","children":75}],["$","$L6","76",{"className":"","href":"/blog/page/76","children":76}],["$","$L6","77",{"className":"","href":"/blog/page/77","children":77}],["$","$L6","78",{"className":"","href":"/blog/page/78","children":78}],["$","$L6","79",{"className":"","href":"/blog/page/79","children":79}],["$","$L6","80",{"className":"","href":"/blog/page/80","children":80}]]}]]}],null]}]
7:[["$","meta","0",{"name":"viewport","content":"width=device-width, initial-scale=1"}],["$","meta","1",{"charSet":"utf-8"}],["$","title","2",{"children":"Patrick Desjardins Blog - A Single GraphQL's Schema for Internal and External Users"}],["$","meta","3",{"name":"description","content":"A Single GraphQL's Schema for Internal and External Users"}]]
1:null
