<!DOCTYPE html><html lang="en" class="layout_htmlstyle__PseMz"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="preload" as="image" href="/images/blog/hdmi_article7_pagination.png"/><link rel="preload" as="image" href="/images/blog/hdmi_article7_pagination2.png"/><link rel="preload" as="image" href="/images/blog/hdmi_article7_framenotfull.png"/><link rel="stylesheet" href="/_next/static/css/78bcead87aa8ba1c.css" data-precedence="next"/><link rel="stylesheet" href="/_next/static/css/f810ef15b2c7fffa.css" data-precedence="next"/><link rel="stylesheet" href="/_next/static/css/fcb9e03867a4ea9e.css" data-precedence="next"/><link rel="stylesheet" href="/_next/static/css/5c2c40c02c39ca14.css" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/_next/static/chunks/webpack-89afa62fa32bc2dd.js"/><script src="/_next/static/chunks/c56bfed3-0ee345b90eed2a02.js" async=""></script><script src="/_next/static/chunks/330-764ae29684a524de.js" async=""></script><script src="/_next/static/chunks/main-app-1e94f2306ea07142.js" async=""></script><script src="/_next/static/chunks/196-d9d7275cf071dc4b.js" async=""></script><script src="/_next/static/chunks/986-aab1d30514616ab7.js" async=""></script><script src="/_next/static/chunks/app/blog/%5Bslug%5D/page-1d51dd1d8a502245.js" async=""></script><title>Patrick Desjardins Blog - How to Transfer Files Between Computers Using HDMI (Part 7: Pagination)</title><meta name="description" content="How to Transfer Files Between Computers Using HDMI (Part 7: Pagination)"/><script src="/_next/static/chunks/polyfills-42372ed130431b0a.js" noModule=""></script></head><body class="layout_bodystyle__4ncsS"><div class="layout_blogbodystyle___Uc1w"><div class="BlogBody_BlogBody__600mT"><header class="BlogBody_siteTitle__f7uyb">Patrick Desjardins Blog</header><nav><ul class="BlogBody_navLinks__ZV12t"><li class="BlogBody_navLinkItem__Pml2e"><a class="BlogBody_navLinkText__ZtH2y" href="/">Main Page</a><a class="BlogBody_navLinkText__ZtH2y" href="/blog">Blog</a><a class="BlogBody_navLinkText__ZtH2y" href="/blog/for/2025">2025</a><a class="BlogBody_navLinkText__ZtH2y" href="/blog/for/2024">2024</a><a class="BlogBody_navLinkText__ZtH2y" href="/blog/for/2023">2023</a><a class="BlogBody_navLinkText__ZtH2y" href="/blog/for/2022">2022</a><a class="BlogBody_navLinkText__ZtH2y" href="/blog/for/2021">2021</a><a class="BlogBody_navLinkText__ZtH2y" href="/blog/for/2020">2020</a><a class="BlogBody_navLinkText__ZtH2y" href="/blog/for/2019">2019</a><a class="BlogBody_navLinkText__ZtH2y" href="/blog/for/2018">2018</a><a class="BlogBody_navLinkText__ZtH2y" href="/blog/for/2017">2017</a><a class="BlogBody_navLinkText__ZtH2y" href="/blog/for/2016">2016</a><a class="BlogBody_navLinkText__ZtH2y" href="/blog/for/2015">2015</a><a class="BlogBody_navLinkText__ZtH2y" href="/blog/for/2014">2014</a><a class="BlogBody_navLinkText__ZtH2y" href="/blog/for/2013">2013</a><a class="BlogBody_navLinkText__ZtH2y" href="/blog/for/2012">2012</a><a class="BlogBody_navLinkText__ZtH2y" href="/blog/for/2011">2011</a></li></ul></nav><div class="BlogBody_blogPictureContainer__IAbPL"><img alt="Patrick Desjardins picture from a conference" loading="lazy" width="800" height="260" decoding="async" data-nimg="1" class="BlogBody_blogTopPicture__L6lao" style="color:transparent" src="/images/backgrounds/patrickdesjardins_conference_bw.webp"/></div><main class="BlogBody_main__XrdKY"><h1 class="BlogBody_heading__bYRBe">How to Transfer Files Between Computers Using HDMI (Part 7: Pagination)</h1><div class="Page_blogPostContainer__AUIcf"><p class="Page_blogPostDate__wVWWB">Posted on: <!-- -->2023-07-08</p><p>Transferring data using the HDMI cable and the capture card continues to demonstrate how easily corruption can cause the file to be unusable.</p>
<p>Let&#x27;s review a few points that demonstrate that we have some inconsistancy around frames.</p>
<pre class="language-sh"><code class="language-sh code-highlight"><span class="code-line">ffmpeg <span class="token parameter variable">-f</span> dshow <span class="token parameter variable">-list_options</span> <span class="token boolean">true</span> <span class="token parameter variable">-i</span> <span class="token assign-left variable">video</span><span class="token operator">=</span><span class="token string">&quot;USB Video&quot;</span>
</span></code></pre>
<p>Shows <code>vcodec=mjpeg</code>. The codec is a compressed one, and we have tackled the issue using a less space efficient way, using black and white with more than a single pixel to hold the information.</p>
<pre class="language-sh"><code class="language-sh code-highlight"><span class="code-line">ffmpeg  <span class="token parameter variable">-r</span> <span class="token number">15</span> <span class="token parameter variable">-f</span> dshow <span class="token parameter variable">-s</span> 1920x1080 <span class="token parameter variable">-vcodec</span> mjpeg <span class="token parameter variable">-rtbufsize</span> 200M <span class="token parameter variable">-i</span> <span class="token assign-left variable">video</span><span class="token operator">=</span><span class="token string">&quot;USB Video&quot;</span> <span class="token parameter variable">-r</span> <span class="token number">15</span> out_fps15_size10px.mp4
</span></code></pre>
<p>The command above uses a lower speed of 15 frames per second (fps) to ensure we give some pace to the whole process. Encoding the file in 15 fps was also required, but it still needs to be fixed. During the command, additional information like the following gives a hint that the fps is inconsistent on reading.</p>
<pre class="language-sh"><code class="language-sh code-highlight"><span class="code-line">Input <span class="token comment">#0, dshow, from &#x27;video=USB Video&#x27;:</span>
</span><span class="code-line">  Duration: N/A, start: <span class="token number">613320.254228</span>, bitrate: N/A
</span><span class="code-line">  Stream <span class="token comment">#0:0: Video: mjpeg (Baseline) (MJPG / 0x47504A4D), yuvj422p(pc, bt470bg/bt709/unknown), 1920x1080, 15 fps, 15 tbr, 10000k tbn</span>
</span><span class="code-line">Stream mapping:
</span><span class="code-line">  Stream <span class="token comment">#0:0 -&gt; #0:0 (mjpeg (native) -&gt; h264 (libx264))</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token punctuation">[</span>libx264 @ 000001cd3023be80<span class="token punctuation">]</span> using cpu capabilities: MMX2 SSE2Fast SSSE3 SSE4.2 AVX FMA3 BMI2 AVX2 AVX512
</span><span class="code-line"><span class="token punctuation">[</span>libx264 @ 000001cd3023be80<span class="token punctuation">]</span> profile High <span class="token number">4</span>:2:2, level <span class="token number">4.0</span>, <span class="token number">4</span>:2:2, <span class="token number">8</span>-bit
</span><span class="code-line"><span class="token punctuation">[</span>libx264 @ 000001cd3023be80<span class="token punctuation">]</span> <span class="token number">264</span> - core <span class="token number">164</span> r3106 eaa68fa - H.264/MPEG-4 AVC codec - Copyleft <span class="token number">2003</span>-2023 - http://www.videolan.org/x264.html - options: <span class="token assign-left variable">cabac</span><span class="token operator">=</span><span class="token number">1</span> <span class="token assign-left variable">ref</span><span class="token operator">=</span><span class="token number">3</span> <span class="token assign-left variable">deblock</span><span class="token operator">=</span><span class="token number">1</span>:0:0 <span class="token assign-left variable">analyse</span><span class="token operator">=</span>0x3:0x113 <span class="token assign-left variable">me</span><span class="token operator">=</span>hex <span class="token assign-left variable">subme</span><span class="token operator">=</span><span class="token number">7</span> <span class="token assign-left variable">psy</span><span class="token operator">=</span><span class="token number">1</span> <span class="token assign-left variable">psy_rd</span><span class="token operator">=</span><span class="token number">1.00</span>:0.00 <span class="token assign-left variable">mixed_ref</span><span class="token operator">=</span><span class="token number">1</span> <span class="token assign-left variable">me_range</span><span class="token operator">=</span><span class="token number">16</span> <span class="token assign-left variable">chroma_me</span><span class="token operator">=</span><span class="token number">1</span> <span class="token assign-left variable">trellis</span><span class="token operator">=</span><span class="token number">1</span> <span class="token assign-left variable">8x8dct</span><span class="token operator">=</span><span class="token number">1</span> <span class="token assign-left variable">cqm</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">deadzone</span><span class="token operator">=</span><span class="token number">21,11</span> <span class="token assign-left variable">fast_pskip</span><span class="token operator">=</span><span class="token number">1</span> <span class="token assign-left variable">chroma_qp_offset</span><span class="token operator">=</span>-2 <span class="token assign-left variable">threads</span><span class="token operator">=</span><span class="token number">24</span> <span class="token assign-left variable">lookahead_threads</span><span class="token operator">=</span><span class="token number">4</span> <span class="token assign-left variable">sliced_threads</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">nr</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">decimate</span><span class="token operator">=</span><span class="token number">1</span> <span class="token assign-left variable">interlaced</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">bluray_compat</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">constrained_intra</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">bframes</span><span class="token operator">=</span><span class="token number">3</span> <span class="token assign-left variable">b_pyramid</span><span class="token operator">=</span><span class="token number">2</span> <span class="token assign-left variable">b_adapt</span><span class="token operator">=</span><span class="token number">1</span> <span class="token assign-left variable">b_bias</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">direct</span><span class="token operator">=</span><span class="token number">1</span> <span class="token assign-left variable">weightb</span><span class="token operator">=</span><span class="token number">1</span> <span class="token assign-left variable">open_gop</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">weightp</span><span class="token operator">=</span><span class="token number">2</span> <span class="token assign-left variable">keyint</span><span class="token operator">=</span><span class="token number">250</span> <span class="token assign-left variable">keyint_min</span><span class="token operator">=</span><span class="token number">15</span> <span class="token assign-left variable">scenecut</span><span class="token operator">=</span><span class="token number">40</span> <span class="token assign-left variable">intra_refresh</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">rc_lookahead</span><span class="token operator">=</span><span class="token number">40</span> <span class="token assign-left variable">rc</span><span class="token operator">=</span>crf <span class="token assign-left variable">mbtree</span><span class="token operator">=</span><span class="token number">1</span> <span class="token assign-left variable">crf</span><span class="token operator">=</span><span class="token number">23.0</span> <span class="token assign-left variable">qcomp</span><span class="token operator">=</span><span class="token number">0.60</span> <span class="token assign-left variable">qpmin</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">qpmax</span><span class="token operator">=</span><span class="token number">69</span> <span class="token assign-left variable">qpstep</span><span class="token operator">=</span><span class="token number">4</span> <span class="token assign-left variable">ip_ratio</span><span class="token operator">=</span><span class="token number">1.40</span> <span class="token assign-left variable">aq</span><span class="token operator">=</span><span class="token number">1</span>:1.00
</span><span class="code-line">Output <span class="token comment">#0, mp4, to &#x27;out_fps15_size10px.mp4&#x27;:</span>
</span><span class="code-line">  Metadata:
</span><span class="code-line">    encoder         <span class="token builtin class-name">:</span> Lavf60.3.100
</span><span class="code-line">  Stream <span class="token comment">#0:0: Video: h264 (avc1 / 0x31637661), yuvj422p(pc, bt470bg/bt709/unknown, progressive), 1920x1080, q=2-31, 15 fps, 15360 tbn</span>
</span><span class="code-line">    Metadata:
</span><span class="code-line">      encoder         <span class="token builtin class-name">:</span> Lavc60.3.100 libx264
</span><span class="code-line">    Side data:
</span><span class="code-line">      cpb: bitrate max/min/avg: <span class="token number">0</span>/0/0 buffer size: <span class="token number">0</span> vbv_delay: N/A
</span><span class="code-line"><span class="token assign-left variable">frame</span><span class="token operator">=</span>  <span class="token number">674</span> <span class="token assign-left variable">fps</span><span class="token operator">=</span> <span class="token number">15</span> <span class="token assign-left variable">q</span><span class="token operator">=</span><span class="token number">27.0</span> <span class="token assign-left variable">size</span><span class="token operator">=</span>  221952kB <span class="token assign-left variable">time</span><span class="token operator">=</span>00:00:44.80 <span class="token assign-left variable">bitrate</span><span class="token operator">=</span><span class="token number">40585</span>.5kbits/s <span class="token assign-left variable">speed</span><span class="token operator">=</span><span class="token number">0</span>.978x
</span></code></pre>
<p>Zooming toward the encoding portion, we see that there is a mix of mjpeg and h264. At the moment, I only suspect there is more compression than anticipated but we should be cover.</p>
<pre class="language-sh"><code class="language-sh code-highlight"><span class="code-line">Stream <span class="token comment">#0:0: Video: mjpeg (Baseline) (MJPG / 0x47504A4D), yuvj422p(pc, bt470bg/bt709/unknown), 1920x1080, 15 fps, 15 tbr, 10000k tbn</span>
</span><span class="code-line">Stream <span class="token comment">#0:0 -&gt; #0:0 (mjpeg (native) -&gt; h264 (libx264))</span>
</span><span class="code-line">Stream <span class="token comment">#0:0: Video: h264 (avc1 / 0x31637661), yuvj422p(pc, bt470bg/bt709/unknown, progressive), 1920x1080, q=2-31, 15 fps, 15360 tbn</span>
</span></code></pre>
<p>To this point, outside compression that might cause issue there might be another detail escaping us. One hint is the fps of the capture in ffmpg. An hypothesis might be that we are missing some frames. Even missing a single frame will cause the whole file not to be readable. We now rely on a single red frame to indicate the starting point. After the red frame, we assume the next frame is the first one with the instruction frame that gives the number of bytes for the actual content. However, what happens if the frame transfer after the red one fails to be transmitted or read? Also, there is no way to ensure we read all the frames.</p>
<h1>Adaptation: Pagination</h1>
<p>The next idea is to add a reserved 64 bits of space to every frame, similar to the instruction. Also, modifying the instruction to be the <strong>first</strong> 64 bits of the red frame. The reason is that once we figure out the structure to be the starting one (the red one) we do not need to rely on the next frame to be the instruction -- the red frame will always have the instruction. Thus, we can still know the total amount of bytes to recuperate, but now we can do it more reliably.</p>
<p><img src="/images/blog/hdmi_article7_pagination.png" alt=""/></p>
<p>The central concept remains that we generate one starting (red) frame and then the frames for the data. However, With the addition of the pagination, we can read (watch) the whole video several times and use a dictionary (hash map) to accumulate the missing frames on each pass. If we notice missing frames after capturing the footage twice, we could continue to loop the video for longer and see if we can collect all frames.</p>
<p><img src="/images/blog/hdmi_article7_pagination2.png" alt=""/></p>
<p>The illustration shows that the first time the system reads the video, it receives frame #2. It saves it into the map. Then, it captures frame #3. Because the map does not have frame #3, it adds it. Then the instruction is read, telling it needs x amount of bytes. Then, it continues to read and capture frame #1. The order does not matter. The program continues to read frames, but they are all already there, thus does not save anything until the capture is over. On completion, it knows that frame 1 is the first, and so on, until it cannot find the data. In that case, fetching frame #4 would return nothing, which signals to stop concatenating the frame&#x27;s byte. Finally, the stop is to look at the instruction to know the number of relevant bytes to build the original file.</p>
<p>This new solution should fix the current limitation of the algorithm.</p>
<h1>Testing Locally</h1>
<p>The modification worked perfectly locally. I added integration tests in Rust which is a matter of creating a folder called <code>tests</code> at the project&#x27;s root. To run only the integration test, we call <code>cargo test --test &quot;*&quot;</code>. Generating the video and reading it back using the Rust program works well. A small change visually in the video is that the frame does not use any character and thus is <code>null</code> for a frame that is not full of data. Similarly, the starting red frame now contains some white and black in the first 64 pixels (if the size is set to 1). It is the data, including the number of bytes to extract.</p>
<p><img src="/images/blog/hdmi_article7_framenotfull.png" alt=""/></p>
<h1>Testing with Remote Computer</h1>
<p>The ultimate test is to generate the video on a remote machine, play the video and extract using FFmpeg. The same steps as before are required with FFmpeg.</p>
<p>The first test was with a size of 2 using a zip file encoded at 30fps. With the new pagination mechanism, if FFmpeg cannot read at 30fps all frames (some are skipped), the whole sequence would be there within a few loops. I let the FFmpeg loops about 5 times and the result was a video of about 80 megs. However, the code that is reading the video was breaking after two frames.</p>
<pre class="language-rust"><code class="language-rust code-highlight"><span class="code-line"><span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">video_to_frames</span><span class="token punctuation">(</span>extract_options<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token class-name">ExtractOptions</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token class-name">VideoFrame</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token keyword">let</span> <span class="token keyword">mut</span> video <span class="token operator">=</span> <span class="token class-name">VideoCapture</span><span class="token punctuation">::</span><span class="token function">from_file</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>extract_options<span class="token punctuation">.</span>video_file_path<span class="token punctuation">,</span> <span class="token constant">CAP_ANY</span><span class="token punctuation">)</span>
</span><span class="code-line">        <span class="token punctuation">.</span><span class="token function">expect</span><span class="token punctuation">(</span><span class="token string">&quot;Could not open video path&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token keyword">let</span> <span class="token keyword">mut</span> all_frames <span class="token operator">=</span> <span class="token class-name">Vec</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token keyword">loop</span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token keyword">let</span> <span class="token keyword">mut</span> frame <span class="token operator">=</span> <span class="token class-name">Mat</span><span class="token punctuation">::</span><span class="token function">default</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">        video
</span><span class="code-line">            <span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> frame<span class="token punctuation">)</span>
</span><span class="code-line">            <span class="token punctuation">.</span><span class="token function">expect</span><span class="token punctuation">(</span><span class="token string">&quot;Reading frame shouldn&#x27;t crash&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">        <span class="token keyword">if</span> frame<span class="token punctuation">.</span><span class="token function">cols</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">{</span>
</span><span class="code-line highlight-line">            <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token comment">// &lt;------------------- Here</span>
</span><span class="code-line">        <span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line">        <span class="token keyword">let</span> source <span class="token operator">=</span> <span class="token class-name">VideoFrame</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span>frame<span class="token punctuation">,</span> extract_options<span class="token punctuation">.</span>size<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">        <span class="token keyword">match</span> source <span class="token punctuation">{</span>
</span><span class="code-line">            <span class="token class-name">Ok</span><span class="token punctuation">(</span>frame<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">                all_frames<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>frame<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">            <span class="token punctuation">}</span>
</span><span class="code-line">            <span class="token class-name">Err</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">                <span class="token macro property">panic!</span><span class="token punctuation">(</span><span class="token string">&quot;Reading from VideoFrame: {:?}&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">            <span class="token punctuation">}</span>
</span><span class="code-line">        <span class="token punctuation">}</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line">    all_frames
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre>
<p>After trying several differen ways to open the video like using the ffmpeg wrapper for Rust I was unsuccessful. The video produced can be open with software like VLC but the Open CV couldn&#x27;t. The ffmpeg (using the ffmpeg_next) was not compiling after 30 minutes of try so I gave up.</p>
<h1>Codec</h1>
<p>The command to read the video stream from the video card uses the <code>-vcodec mjpeg</code>. As discussed in a previous post, this is because the ffmpeg specify that this is what the device is providing.</p>
<pre class="language-sh"><code class="language-sh code-highlight"><span class="code-line">ffmpeg <span class="token parameter variable">-f</span> dshow <span class="token parameter variable">-list_options</span> <span class="token boolean">true</span> <span class="token parameter variable">-i</span> <span class="token assign-left variable">video</span><span class="token operator">=</span><span class="token string">&quot;USB Video&quot;</span>
</span><span class="code-line"><span class="token punctuation">[</span>dshow @ 0000022277b00100<span class="token punctuation">]</span>   <span class="token assign-left variable">vcodec</span><span class="token operator">=</span>mjpeg  min <span class="token assign-left variable">s</span><span class="token operator">=</span>1920x1080 <span class="token assign-left variable">fps</span><span class="token operator">=</span><span class="token number">10</span> max <span class="token assign-left variable">s</span><span class="token operator">=</span>1920x1080 <span class="token assign-left variable">fps</span><span class="token operator">=</span><span class="token number">60.0002</span>
</span><span class="code-line"><span class="token punctuation">[</span>dshow @ 0000022277b00100<span class="token punctuation">]</span>   <span class="token assign-left variable">vcodec</span><span class="token operator">=</span>mjpeg  min <span class="token assign-left variable">s</span><span class="token operator">=</span>1920x1080 <span class="token assign-left variable">fps</span><span class="token operator">=</span><span class="token number">10</span> max <span class="token assign-left variable">s</span><span class="token operator">=</span>1920x1080 <span class="token assign-left variable">fps</span><span class="token operator">=</span><span class="token number">60.0002</span> <span class="token punctuation">(</span>pc, bt470bg/bt709/unknown, center<span class="token punctuation">)</span>
</span><span class="code-line"><span class="token punctuation">[</span>dshow @ 0000022277b00100<span class="token punctuation">]</span>   <span class="token assign-left variable">pixel_format</span><span class="token operator">=</span>yuyv422  min <span class="token assign-left variable">s</span><span class="token operator">=</span>1920x1080 <span class="token assign-left variable">fps</span><span class="token operator">=</span><span class="token number">5</span> max <span class="token assign-left variable">s</span><span class="token operator">=</span>1920x1080 <span class="token assign-left variable">fps</span><span class="token operator">=</span><span class="token number">5</span>
</span><span class="code-line"><span class="token punctuation">[</span>dshow @ 0000022277b00100<span class="token punctuation">]</span>   <span class="token assign-left variable">pixel_format</span><span class="token operator">=</span>yuyv422  min <span class="token assign-left variable">s</span><span class="token operator">=</span>1920x1080 <span class="token assign-left variable">fps</span><span class="token operator">=</span><span class="token number">5</span> max <span class="token assign-left variable">s</span><span class="token operator">=</span>1920x1080 <span class="token assign-left variable">fps</span><span class="token operator">=</span><span class="token number">5</span> <span class="token punctuation">(</span>tv, bt470bg/bt709/unknown, topleft<span class="token punctuation">)</span>
</span></code></pre>
<p>However, we could convert into a different format when saving to the file which could be open by Open CV.</p>
<p>While the codev and pixel format were good values compared to the Windows ffmpeg commands below:</p>
<pre class="language-sh"><code class="language-sh code-highlight"><span class="code-line">ffmpeg <span class="token parameter variable">-codecs</span> <span class="token operator">&gt;</span> codec.txt
</span><span class="code-line">ffmpeg <span class="token parameter variable">-pix_fmts</span> <span class="token operator">&gt;</span> pix.txt
</span></code></pre>
<p>The command to read the capture card kept giving me buffer size limit issue or setting issues. I decided to avoid codec with raw data. It does create a huge file but I was able to read the file using VLC!</p>
<pre class="language-sh"><code class="language-sh code-highlight"><span class="code-line">ffmpeg <span class="token parameter variable">-f</span> dshow <span class="token parameter variable">-video_size</span> 1920x1080 <span class="token parameter variable">-i</span> <span class="token assign-left variable">video</span><span class="token operator">=</span><span class="token string">&quot;USB Video&quot;</span> <span class="token parameter variable">-rtbufsize</span> 200M <span class="token parameter variable">-framerate</span> <span class="token number">30</span> <span class="token parameter variable">-c:v</span> copy output.mp4
</span></code></pre>
<p>Using the Rust code on the raw output worked! The raw 167 megs of under 12 seconds generated a perfect 2 meg image in 3 minutes 49 seconds. The same as the source.</p>
<p>Let&#x27;s use a codec and see how we can optimize the overall transformation time.</p>
<pre class="language-sh"><code class="language-sh code-highlight"><span class="code-line">ffmpeg <span class="token parameter variable">-f</span> dshow <span class="token parameter variable">-video_size</span> 1920x1080 <span class="token parameter variable">-i</span> <span class="token assign-left variable">video</span><span class="token operator">=</span><span class="token string">&quot;USB Video&quot;</span> <span class="token parameter variable">-rtbufsize</span> 200M <span class="token parameter variable">-framerate</span> <span class="token number">30</span> <span class="token parameter variable">-c:v</span> copy input.mp4
</span><span class="code-line">ffmpeg <span class="token parameter variable">-i</span> input.mp4 <span class="token parameter variable">-c:v</span> libx264 <span class="token parameter variable">-crf</span> <span class="token number">23</span> <span class="token parameter variable">-preset</span> medium <span class="token parameter variable">-c:a</span> aac <span class="token parameter variable">-b:a</span> 128k output.mp4
</span></code></pre>
<p>The time was not better (I stopped the Rust script after 5 minutes, it wasn&#x27;t even at 25%) and actually added potential issue with the compression. Also, while running the second command, the console is flooded with the following error. Still, the file can be read by VLC and by the Rust program.</p>
<blockquote>
<p>[mjpeg @ 0000025116f78740] Found EOI before any SOF, ignoring
[mjpeg @ 0000025116f78740] No JPEG data found in image
Error while decoding stream #0:0: Invalid data found when processing input</p>
</blockquote>
<h1>No Compression, 1 size pixel zip file</h1>
<p>The ultimate test was to use a zip file with the most black and white information density of each bit using 1 pixel.</p>
<pre class="language-sh"><code class="language-sh code-highlight"><span class="code-line">ffmpeg <span class="token parameter variable">-f</span> dshow <span class="token parameter variable">-video_size</span> 1920x1080 <span class="token parameter variable">-i</span> <span class="token assign-left variable">video</span><span class="token operator">=</span><span class="token string">&quot;USB Video&quot;</span> <span class="token parameter variable">-rtbufsize</span> 200M <span class="token parameter variable">-framerate</span> <span class="token number">30</span> <span class="token parameter variable">-c:v</span> copy input_zip.mp4
</span><span class="code-line"><span class="token function">cargo</span> run <span class="token parameter variable">--release</span> -- <span class="token parameter variable">-m</span> extract <span class="token parameter variable">-i</span> outputs/input_zip.mp4 <span class="token parameter variable">-o</span> outputs/PictureFiles.zip <span class="token parameter variable">--fps</span> <span class="token number">30</span> <span class="token parameter variable">--height</span> <span class="token number">1080</span> <span class="token parameter variable">--width</span> <span class="token number">1920</span> <span class="token parameter variable">--size</span> <span class="token number">1</span> <span class="token parameter variable">-p</span> <span class="token boolean">true</span> <span class="token parameter variable">-a</span> bw
</span></code></pre>
<p>I let the recording watch the video twice. It produced a file of 328 megs (16 seconds). The Rust script ran for 1 minute and 6 seconds an failed with missing frame:</p>
<blockquote>
<p>We have not receive all frames. We received 6 frames for a total of 1555152 bytes and we expected 54347552 bytes</p>
</blockquote>
<p>I captured again, this time let about 12 iterations of the movie to be recorded. I could see my personal laptop that was running the video being not smooth and the fan running super hard. I suspect frames are skipping as visually I can see some freeze. The generated file was about 850 megs. Unfortunately, the same 6 frames were missing.</p></div></main><div class="BlogBody_paginationBar__1gsMc"><div class="BlogBody_paginationTitle__H_eFX">Chronological Blog Articles by Page</div><div class="BlogBody_paginationLinks__nk8zd"><a class="" href="/blog/page/1">1</a><a class="" href="/blog/page/2">2</a><a class="" href="/blog/page/3">3</a><a class="" href="/blog/page/4">4</a><a class="" href="/blog/page/5">5</a><a class="" href="/blog/page/6">6</a><a class="" href="/blog/page/7">7</a><a class="" href="/blog/page/8">8</a><a class="" href="/blog/page/9">9</a><a class="" href="/blog/page/10">10</a><a class="" href="/blog/page/11">11</a><a class="" href="/blog/page/12">12</a><a class="" href="/blog/page/13">13</a><a class="" href="/blog/page/14">14</a><a class="" href="/blog/page/15">15</a><a class="" href="/blog/page/16">16</a><a class="" href="/blog/page/17">17</a><a class="" href="/blog/page/18">18</a><a class="" href="/blog/page/19">19</a><a class="" href="/blog/page/20">20</a><a class="" href="/blog/page/21">21</a><a class="" href="/blog/page/22">22</a><a class="" href="/blog/page/23">23</a><a class="" href="/blog/page/24">24</a><a class="" href="/blog/page/25">25</a><a class="" href="/blog/page/26">26</a><a class="" href="/blog/page/27">27</a><a class="" href="/blog/page/28">28</a><a class="" href="/blog/page/29">29</a><a class="" href="/blog/page/30">30</a><a class="" href="/blog/page/31">31</a><a class="" href="/blog/page/32">32</a><a class="" href="/blog/page/33">33</a><a class="" href="/blog/page/34">34</a><a class="" href="/blog/page/35">35</a><a class="" href="/blog/page/36">36</a><a class="" href="/blog/page/37">37</a><a class="" href="/blog/page/38">38</a><a class="" href="/blog/page/39">39</a><a class="" href="/blog/page/40">40</a><a class="" href="/blog/page/41">41</a><a class="" href="/blog/page/42">42</a><a class="" href="/blog/page/43">43</a><a class="" href="/blog/page/44">44</a><a class="" href="/blog/page/45">45</a><a class="" href="/blog/page/46">46</a><a class="" href="/blog/page/47">47</a><a class="" href="/blog/page/48">48</a><a class="" href="/blog/page/49">49</a><a class="" href="/blog/page/50">50</a><a class="" href="/blog/page/51">51</a><a class="" href="/blog/page/52">52</a><a class="" href="/blog/page/53">53</a><a class="" href="/blog/page/54">54</a><a class="" href="/blog/page/55">55</a><a class="" href="/blog/page/56">56</a><a class="" href="/blog/page/57">57</a><a class="" href="/blog/page/58">58</a><a class="" href="/blog/page/59">59</a><a class="" href="/blog/page/60">60</a><a class="" href="/blog/page/61">61</a><a class="" href="/blog/page/62">62</a><a class="" href="/blog/page/63">63</a><a class="" href="/blog/page/64">64</a><a class="" href="/blog/page/65">65</a><a class="" href="/blog/page/66">66</a><a class="" href="/blog/page/67">67</a><a class="" href="/blog/page/68">68</a><a class="" href="/blog/page/69">69</a><a class="" href="/blog/page/70">70</a><a class="" href="/blog/page/71">71</a><a class="" href="/blog/page/72">72</a><a class="" href="/blog/page/73">73</a><a class="" href="/blog/page/74">74</a><a class="" href="/blog/page/75">75</a><a class="" href="/blog/page/76">76</a><a class="" href="/blog/page/77">77</a><a class="" href="/blog/page/78">78</a><a class="" href="/blog/page/79">79</a></div></div></div></div><script src="/_next/static/chunks/webpack-89afa62fa32bc2dd.js" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0]);self.__next_f.push([2,null])</script><script>self.__next_f.push([1,"1:HL[\"/_next/static/css/78bcead87aa8ba1c.css\",\"style\"]\n2:HL[\"/_next/static/css/f810ef15b2c7fffa.css\",\"style\"]\n3:HL[\"/_next/static/css/fcb9e03867a4ea9e.css\",\"style\"]\n4:HL[\"/_next/static/css/5c2c40c02c39ca14.css\",\"style\"]\n"])</script><script>self.__next_f.push([1,"5:I[1013,[],\"\"]\n8:I[6102,[],\"\"]\na:I[2609,[],\"\"]\nb:I[6196,[\"196\",\"static/chunks/196-d9d7275cf071dc4b.js\",\"986\",\"static/chunks/986-aab1d30514616ab7.js\",\"308\",\"static/chunks/app/blog/%5Bslug%5D/page-1d51dd1d8a502245.js\"],\"\"]\nd:I[1626,[],\"\"]\n9:[\"slug\",\"how-to-transfer-files-between-computers-using-HDMI-Part-7-pagination\",\"d\"]\ne:[]\n"])</script><script>self.__next_f.push([1,"0:[\"$\",\"$L5\",null,{\"buildId\":\"ArioVwyB1ST-ujIrNnuuN\",\"assetPrefix\":\"\",\"urlParts\":[\"\",\"blog\",\"how-to-transfer-files-between-computers-using-HDMI-Part-7-pagination\"],\"initialTree\":[\"\",{\"children\":[\"blog\",{\"children\":[[\"slug\",\"how-to-transfer-files-between-computers-using-HDMI-Part-7-pagination\",\"d\"],{\"children\":[\"__PAGE__?{\\\"slug\\\":\\\"how-to-transfer-files-between-computers-using-HDMI-Part-7-pagination\\\"}\",{}]}]}]},\"$undefined\",\"$undefined\",true],\"initialSeedData\":[\"\",{\"children\":[\"blog\",{\"children\":[[\"slug\",\"how-to-transfer-files-between-computers-using-HDMI-Part-7-pagination\",\"d\"],{\"children\":[\"__PAGE__\",{},[[\"$L6\",\"$L7\",[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/fcb9e03867a4ea9e.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\"}],[\"$\",\"link\",\"1\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/5c2c40c02c39ca14.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\"}]]],null],null]},[null,[\"$\",\"$L8\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"blog\",\"children\",\"$9\",\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$La\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\"}]],null]},[[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/f810ef15b2c7fffa.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\"}]],[\"$\",\"div\",null,{\"className\":\"layout_blogbodystyle___Uc1w\",\"children\":[\"$\",\"$L8\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"blog\",\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$La\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\"}]}]],null],null]},[[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/78bcead87aa8ba1c.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\"}]],[\"$\",\"html\",null,{\"lang\":\"en\",\"className\":\"layout_htmlstyle__PseMz\",\"children\":[\"$\",\"body\",null,{\"className\":\"layout_bodystyle__4ncsS\",\"children\":[\"$\",\"$L8\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$La\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[\"$\",\"div\",null,{\"style\":{\"display\":\"flex\",\"alignItems\":\"center\",\"justifyContent\":\"center\",\"height\":\"100vh\"},\"children\":[\"$\",\"div\",null,{\"style\":{\"width\":\"50%\",\"height\":\"20%\",\"backgroundColor\":\"#ffeded\",\"borderRadius\":12,\"padding\":12,\"textAlign\":\"center\"},\"children\":[[\"$\",\"h1\",null,{\"children\":\"Not Found\"}],[\"$\",\"p\",null,{\"children\":\"Could not find requested resource\"}],[\"$\",\"$Lb\",null,{\"href\":\"/\",\"children\":\"Return Home\"}]]}]}],\"notFoundStyles\":[]}]}]}]],null],null],\"couldBeIntercepted\":false,\"initialHead\":[null,\"$Lc\"],\"globalErrorComponent\":\"$d\",\"missingSlots\":\"$We\"}]\n"])</script><script>self.__next_f.push([1,"f:I[8986,[\"196\",\"static/chunks/196-d9d7275cf071dc4b.js\",\"986\",\"static/chunks/986-aab1d30514616ab7.js\",\"308\",\"static/chunks/app/blog/%5Bslug%5D/page-1d51dd1d8a502245.js\"],\"Image\"]\n"])</script><script>self.__next_f.push([1,"7:[\"$\",\"div\",null,{\"className\":\"BlogBody_BlogBody__600mT\",\"children\":[[\"$\",\"header\",null,{\"className\":\"BlogBody_siteTitle__f7uyb\",\"children\":\"Patrick Desjardins Blog\"}],[\"$\",\"nav\",null,{\"children\":[\"$\",\"ul\",null,{\"className\":\"BlogBody_navLinks__ZV12t\",\"children\":[\"$\",\"li\",null,{\"className\":\"BlogBody_navLinkItem__Pml2e\",\"children\":[[\"$\",\"$Lb\",null,{\"className\":\"BlogBody_navLinkText__ZtH2y\",\"href\":\"/\",\"children\":\"Main Page\"}],[\"$\",\"$Lb\",null,{\"className\":\"BlogBody_navLinkText__ZtH2y\",\"href\":\"/blog\",\"children\":\"Blog\"}],[[\"$\",\"$Lb\",\"2025\",{\"className\":\"BlogBody_navLinkText__ZtH2y\",\"href\":\"/blog/for/2025\",\"children\":2025}],[\"$\",\"$Lb\",\"2024\",{\"className\":\"BlogBody_navLinkText__ZtH2y\",\"href\":\"/blog/for/2024\",\"children\":2024}],[\"$\",\"$Lb\",\"2023\",{\"className\":\"BlogBody_navLinkText__ZtH2y\",\"href\":\"/blog/for/2023\",\"children\":2023}],[\"$\",\"$Lb\",\"2022\",{\"className\":\"BlogBody_navLinkText__ZtH2y\",\"href\":\"/blog/for/2022\",\"children\":2022}],[\"$\",\"$Lb\",\"2021\",{\"className\":\"BlogBody_navLinkText__ZtH2y\",\"href\":\"/blog/for/2021\",\"children\":2021}],[\"$\",\"$Lb\",\"2020\",{\"className\":\"BlogBody_navLinkText__ZtH2y\",\"href\":\"/blog/for/2020\",\"children\":2020}],[\"$\",\"$Lb\",\"2019\",{\"className\":\"BlogBody_navLinkText__ZtH2y\",\"href\":\"/blog/for/2019\",\"children\":2019}],[\"$\",\"$Lb\",\"2018\",{\"className\":\"BlogBody_navLinkText__ZtH2y\",\"href\":\"/blog/for/2018\",\"children\":2018}],[\"$\",\"$Lb\",\"2017\",{\"className\":\"BlogBody_navLinkText__ZtH2y\",\"href\":\"/blog/for/2017\",\"children\":2017}],[\"$\",\"$Lb\",\"2016\",{\"className\":\"BlogBody_navLinkText__ZtH2y\",\"href\":\"/blog/for/2016\",\"children\":2016}],[\"$\",\"$Lb\",\"2015\",{\"className\":\"BlogBody_navLinkText__ZtH2y\",\"href\":\"/blog/for/2015\",\"children\":2015}],[\"$\",\"$Lb\",\"2014\",{\"className\":\"BlogBody_navLinkText__ZtH2y\",\"href\":\"/blog/for/2014\",\"children\":2014}],[\"$\",\"$Lb\",\"2013\",{\"className\":\"BlogBody_navLinkText__ZtH2y\",\"href\":\"/blog/for/2013\",\"children\":2013}],[\"$\",\"$Lb\",\"2012\",{\"className\":\"BlogBody_navLinkText__ZtH2y\",\"href\":\"/blog/for/2012\",\"children\":2012}],[\"$\",\"$Lb\",\"2011\",{\"className\":\"BlogBody_navLinkText__ZtH2y\",\"href\":\"/blog/for/2011\",\"children\":2011}]]]}]}]}],[\"$\",\"div\",null,{\"className\":\"BlogBody_blogPictureContainer__IAbPL\",\"children\":[\"$\",\"$Lf\",null,{\"className\":\"BlogBody_blogTopPicture__L6lao\",\"alt\":\"Patrick Desjardins picture from a conference\",\"src\":\"/images/backgrounds/patrickdesjardins_conference_bw.webp\",\"width\":800,\"height\":260}]}],[\"$\",\"main\",null,{\"className\":\"BlogBody_main__XrdKY\",\"children\":[[\"$\",\"h1\",null,{\"className\":\"BlogBody_heading__bYRBe\",\"children\":\"How to Transfer Files Between Computers Using HDMI (Part 7: Pagination)\"}],[\"$\",\"div\",null,{\"className\":\"Page_blogPostContainer__AUIcf\",\"children\":[[\"$\",\"p\",null,{\"className\":\"Page_blogPostDate__wVWWB\",\"children\":[\"Posted on: \",\"2023-07-08\"]}],[[\"$\",\"p\",null,{\"children\":\"Transferring data using the HDMI cable and the capture card continues to demonstrate how easily corruption can cause the file to be unusable.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Let's review a few points that demonstrate that we have some inconsistancy around frames.\"}],\"\\n\",[\"$\",\"pre\",null,{\"className\":\"language-sh\",\"children\":[\"$\",\"code\",null,{\"className\":\"language-sh code-highlight\",\"children\":[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"ffmpeg \",[\"$\",\"span\",null,{\"className\":\"token parameter variable\",\"children\":\"-f\"}],\" dshow \",[\"$\",\"span\",null,{\"className\":\"token parameter variable\",\"children\":\"-list_options\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token boolean\",\"children\":\"true\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token parameter variable\",\"children\":\"-i\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token assign-left variable\",\"children\":\"video\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"USB Video\\\"\"}],\"\\n\"]}]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Shows \",[\"$\",\"code\",null,{\"children\":\"vcodec=mjpeg\"}],\". The codec is a compressed one, and we have tackled the issue using a less space efficient way, using black and white with more than a single pixel to hold the information.\"]}],\"\\n\",[\"$\",\"pre\",null,{\"className\":\"language-sh\",\"children\":[\"$\",\"code\",null,{\"className\":\"language-sh code-highlight\",\"children\":[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"ffmpeg  \",[\"$\",\"span\",null,{\"className\":\"token parameter variable\",\"children\":\"-r\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"15\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token parameter variable\",\"children\":\"-f\"}],\" dshow \",[\"$\",\"span\",null,{\"className\":\"token parameter variable\",\"children\":\"-s\"}],\" 1920x1080 \",[\"$\",\"span\",null,{\"className\":\"token parameter variable\",\"children\":\"-vcodec\"}],\" mjpeg \",[\"$\",\"span\",null,{\"className\":\"token parameter variable\",\"children\":\"-rtbufsize\"}],\" 200M \",[\"$\",\"span\",null,{\"className\":\"token parameter variable\",\"children\":\"-i\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token assign-left variable\",\"children\":\"video\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"USB Video\\\"\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token parameter variable\",\"children\":\"-r\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"15\"}],\" out_fps15_size10px.mp4\\n\"]}]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"The command above uses a lower speed of 15 frames per second (fps) to ensure we give some pace to the whole process. Encoding the file in 15 fps was also required, but it still needs to be fixed. During the command, additional information like the following gives a hint that the fps is inconsistent on reading.\"}],\"\\n\",[\"$\",\"pre\",null,{\"className\":\"language-sh\",\"children\":[\"$\",\"code\",null,{\"className\":\"language-sh code-highlight\",\"children\":[[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"Input \",[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"#0, dshow, from 'video=USB Video':\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"  Duration: N/A, start: \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"613320.254228\"}],\", bitrate: N/A\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"  Stream \",[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"#0:0: Video: mjpeg (Baseline) (MJPG / 0x47504A4D), yuvj422p(pc, bt470bg/bt709/unknown), 1920x1080, 15 fps, 15 tbr, 10000k tbn\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"Stream mapping:\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"  Stream \",[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"#0:0 -\u003e #0:0 (mjpeg (native) -\u003e h264 (libx264))\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"[\"}],\"libx264 @ 000001cd3023be80\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"]\"}],\" using cpu capabilities: MMX2 SSE2Fast SSSE3 SSE4.2 AVX FMA3 BMI2 AVX2 AVX512\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"[\"}],\"libx264 @ 000001cd3023be80\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"]\"}],\" profile High \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"4\"}],\":2:2, level \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"4.0\"}],\", \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"4\"}],\":2:2, \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"8\"}],\"-bit\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"[\"}],\"libx264 @ 000001cd3023be80\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"]\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"264\"}],\" - core \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"164\"}],\" r3106 eaa68fa - H.264/MPEG-4 AVC codec - Copyleft \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"2003\"}],\"-2023 - http://www.videolan.org/x264.html - options: \",[\"$\",\"span\",null,{\"className\":\"token assign-left variable\",\"children\":\"cabac\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"1\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token assign-left variable\",\"children\":\"ref\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"3\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token assign-left variable\",\"children\":\"deblock\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"1\"}],\":0:0 \",[\"$\",\"span\",null,{\"className\":\"token assign-left variable\",\"children\":\"analyse\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\"0x3:0x113 \",[\"$\",\"span\",null,{\"className\":\"token assign-left variable\",\"children\":\"me\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\"hex \",[\"$\",\"span\",null,{\"className\":\"token assign-left variable\",\"children\":\"subme\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"7\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token assign-left variable\",\"children\":\"psy\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"1\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token assign-left variable\",\"children\":\"psy_rd\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"1.00\"}],\":0.00 \",[\"$\",\"span\",null,{\"className\":\"token assign-left variable\",\"children\":\"mixed_ref\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"1\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token assign-left variable\",\"children\":\"me_range\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"16\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token assign-left variable\",\"children\":\"chroma_me\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"1\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token assign-left variable\",\"children\":\"trellis\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"1\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token assign-left variable\",\"children\":\"8x8dct\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"1\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token assign-left variable\",\"children\":\"cqm\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"0\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token assign-left variable\",\"children\":\"deadzone\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"21,11\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token assign-left variable\",\"children\":\"fast_pskip\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"1\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token assign-left variable\",\"children\":\"chroma_qp_offset\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\"-2 \",[\"$\",\"span\",null,{\"className\":\"token assign-left variable\",\"children\":\"threads\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"24\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token assign-left variable\",\"children\":\"lookahead_threads\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"4\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token assign-left variable\",\"children\":\"sliced_threads\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"0\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token assign-left variable\",\"children\":\"nr\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"0\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token assign-left variable\",\"children\":\"decimate\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"1\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token assign-left variable\",\"children\":\"interlaced\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"0\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token assign-left variable\",\"children\":\"bluray_compat\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"0\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token assign-left variable\",\"children\":\"constrained_intra\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"0\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token assign-left variable\",\"children\":\"bframes\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"3\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token assign-left variable\",\"children\":\"b_pyramid\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"2\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token assign-left variable\",\"children\":\"b_adapt\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"1\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token assign-left variable\",\"children\":\"b_bias\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"0\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token assign-left variable\",\"children\":\"direct\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"1\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token assign-left variable\",\"children\":\"weightb\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"1\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token assign-left variable\",\"children\":\"open_gop\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"0\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token assign-left variable\",\"children\":\"weightp\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"2\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token assign-left variable\",\"children\":\"keyint\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"250\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token assign-left variable\",\"children\":\"keyint_min\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"15\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token assign-left variable\",\"children\":\"scenecut\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"40\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token assign-left variable\",\"children\":\"intra_refresh\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"0\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token assign-left variable\",\"children\":\"rc_lookahead\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"40\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token assign-left variable\",\"children\":\"rc\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\"crf \",[\"$\",\"span\",null,{\"className\":\"token assign-left variable\",\"children\":\"mbtree\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"1\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token assign-left variable\",\"children\":\"crf\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"23.0\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token assign-left variable\",\"children\":\"qcomp\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"0.60\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token assign-left variable\",\"children\":\"qpmin\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"0\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token assign-left variable\",\"children\":\"qpmax\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"69\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token assign-left variable\",\"children\":\"qpstep\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"4\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token assign-left variable\",\"children\":\"ip_ratio\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"1.40\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token assign-left variable\",\"children\":\"aq\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"1\"}],\":1.00\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"Output \",[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"#0, mp4, to 'out_fps15_size10px.mp4':\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"  Metadata:\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    encoder         \",[\"$\",\"span\",null,{\"className\":\"token builtin class-name\",\"children\":\":\"}],\" Lavf60.3.100\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"  Stream \",[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"#0:0: Video: h264 (avc1 / 0x31637661), yuvj422p(pc, bt470bg/bt709/unknown, progressive), 1920x1080, q=2-31, 15 fps, 15360 tbn\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"    Metadata:\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"      encoder         \",[\"$\",\"span\",null,{\"className\":\"token builtin class-name\",\"children\":\":\"}],\" Lavc60.3.100 libx264\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"    Side data:\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"      cpb: bitrate max/min/avg: \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"0\"}],\"/0/0 buffer size: \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"0\"}],\" vbv_delay: N/A\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token assign-left variable\",\"children\":\"frame\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\"  \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"674\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token assign-left variable\",\"children\":\"fps\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"15\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token assign-left variable\",\"children\":\"q\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"27.0\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token assign-left variable\",\"children\":\"size\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\"  221952kB \",[\"$\",\"span\",null,{\"className\":\"token assign-left variable\",\"children\":\"time\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\"00:00:44.80 \",[\"$\",\"span\",null,{\"className\":\"token assign-left variable\",\"children\":\"bitrate\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"40585\"}],\".5kbits/s \",[\"$\",\"span\",null,{\"className\":\"token assign-left variable\",\"children\":\"speed\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"0\"}],\".978x\\n\"]}]]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Zooming toward the encoding portion, we see that there is a mix of mjpeg and h264. At the moment, I only suspect there is more compression than anticipated but we should be cover.\"}],\"\\n\",[\"$\",\"pre\",null,{\"className\":\"language-sh\",\"children\":[\"$\",\"code\",null,{\"className\":\"language-sh code-highlight\",\"children\":[[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"Stream \",[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"#0:0: Video: mjpeg (Baseline) (MJPG / 0x47504A4D), yuvj422p(pc, bt470bg/bt709/unknown), 1920x1080, 15 fps, 15 tbr, 10000k tbn\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"Stream \",[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"#0:0 -\u003e #0:0 (mjpeg (native) -\u003e h264 (libx264))\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"Stream \",[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"#0:0: Video: h264 (avc1 / 0x31637661), yuvj422p(pc, bt470bg/bt709/unknown, progressive), 1920x1080, q=2-31, 15 fps, 15360 tbn\"}],\"\\n\"]}]]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"To this point, outside compression that might cause issue there might be another detail escaping us. One hint is the fps of the capture in ffmpg. An hypothesis might be that we are missing some frames. Even missing a single frame will cause the whole file not to be readable. We now rely on a single red frame to indicate the starting point. After the red frame, we assume the next frame is the first one with the instruction frame that gives the number of bytes for the actual content. However, what happens if the frame transfer after the red one fails to be transmitted or read? Also, there is no way to ensure we read all the frames.\"}],\"\\n\",[\"$\",\"h1\",null,{\"children\":\"Adaptation: Pagination\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"The next idea is to add a reserved 64 bits of space to every frame, similar to the instruction. Also, modifying the instruction to be the \",[\"$\",\"strong\",null,{\"children\":\"first\"}],\" 64 bits of the red frame. The reason is that once we figure out the structure to be the starting one (the red one) we do not need to rely on the next frame to be the instruction -- the red frame will always have the instruction. Thus, we can still know the total amount of bytes to recuperate, but now we can do it more reliably.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"img\",null,{\"src\":\"/images/blog/hdmi_article7_pagination.png\",\"alt\":\"\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"The central concept remains that we generate one starting (red) frame and then the frames for the data. However, With the addition of the pagination, we can read (watch) the whole video several times and use a dictionary (hash map) to accumulate the missing frames on each pass. If we notice missing frames after capturing the footage twice, we could continue to loop the video for longer and see if we can collect all frames.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"img\",null,{\"src\":\"/images/blog/hdmi_article7_pagination2.png\",\"alt\":\"\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"The illustration shows that the first time the system reads the video, it receives frame #2. It saves it into the map. Then, it captures frame #3. Because the map does not have frame #3, it adds it. Then the instruction is read, telling it needs x amount of bytes. Then, it continues to read and capture frame #1. The order does not matter. The program continues to read frames, but they are all already there, thus does not save anything until the capture is over. On completion, it knows that frame 1 is the first, and so on, until it cannot find the data. In that case, fetching frame #4 would return nothing, which signals to stop concatenating the frame's byte. Finally, the stop is to look at the instruction to know the number of relevant bytes to build the original file.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"This new solution should fix the current limitation of the algorithm.\"}],\"\\n\",[\"$\",\"h1\",null,{\"children\":\"Testing Locally\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"The modification worked perfectly locally. I added integration tests in Rust which is a matter of creating a folder called \",[\"$\",\"code\",null,{\"children\":\"tests\"}],\" at the project's root. To run only the integration test, we call \",[\"$\",\"code\",null,{\"children\":\"cargo test --test \\\"*\\\"\"}],\". Generating the video and reading it back using the Rust program works well. A small change visually in the video is that the frame does not use any character and thus is \",[\"$\",\"code\",null,{\"children\":\"null\"}],\" for a frame that is not full of data. Similarly, the starting red frame now contains some white and black in the first 64 pixels (if the size is set to 1). It is the data, including the number of bytes to extract.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"img\",null,{\"src\":\"/images/blog/hdmi_article7_framenotfull.png\",\"alt\":\"\"}]}],\"\\n\",[\"$\",\"h1\",null,{\"children\":\"Testing with Remote Computer\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"The ultimate test is to generate the video on a remote machine, play the video and extract using FFmpeg. The same steps as before are required with FFmpeg.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"The first test was with a size of 2 using a zip file encoded at 30fps. With the new pagination mechanism, if FFmpeg cannot read at 30fps all frames (some are skipped), the whole sequence would be there within a few loops. I let the FFmpeg loops about 5 times and the result was a video of about 80 megs. However, the code that is reading the video was breaking after two frames.\"}],\"\\n\",[\"$\",\"pre\",null,{\"className\":\"language-rust\",\"children\":[\"$\",\"code\",null,{\"className\":\"language-rust code-highlight\",\"children\":[[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"pub\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"fn\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token function-definition function\",\"children\":\"video_to_frames\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"extract_options\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\":\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u0026\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"ExtractOptions\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"-\u003e\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Vec\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"VideoFrame\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"let\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"mut\"}],\" video \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"VideoCapture\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"::\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"from_file\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u0026\"}],\"extract_options\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"video_file_path\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token constant\",\"children\":\"CAP_ANY\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"expect\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"Could not open video path\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"let\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"mut\"}],\" all_frames \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Vec\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"::\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"new\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"loop\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"let\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"mut\"}],\" frame \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Mat\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"::\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"default\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"        video\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"            \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"read\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u0026\"}],[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"mut\"}],\" frame\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"            \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"expect\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"Reading frame shouldn't crash\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"if\"}],\" frame\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"cols\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"==\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"0\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line highlight-line\",\"children\":[\"            \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"break\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token comment\",\"children\":\"// \u003c------------------- Here\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"let\"}],\" source \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"VideoFrame\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"::\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"from\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"frame\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" extract_options\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],\"size\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token keyword\",\"children\":\"match\"}],\" source \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"            \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Ok\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"frame\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\u003e\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"                all_frames\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\".\"}],[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"push\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"frame\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"            \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"            \",[\"$\",\"span\",null,{\"className\":\"token class-name\",\"children\":\"Err\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"err\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\u003e\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"{\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"                \",[\"$\",\"span\",null,{\"className\":\"token macro property\",\"children\":\"panic!\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"Reading from VideoFrame: {:?}\\\"\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\",\"}],\" err\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\";\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"            \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"        \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"    \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":\"    all_frames\\n\"}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"}\"}],\"\\n\"]}]]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"After trying several differen ways to open the video like using the ffmpeg wrapper for Rust I was unsuccessful. The video produced can be open with software like VLC but the Open CV couldn't. The ffmpeg (using the ffmpeg_next) was not compiling after 30 minutes of try so I gave up.\"}],\"\\n\",[\"$\",\"h1\",null,{\"children\":\"Codec\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"The command to read the video stream from the video card uses the \",[\"$\",\"code\",null,{\"children\":\"-vcodec mjpeg\"}],\". As discussed in a previous post, this is because the ffmpeg specify that this is what the device is providing.\"]}],\"\\n\",[\"$\",\"pre\",null,{\"className\":\"language-sh\",\"children\":[\"$\",\"code\",null,{\"className\":\"language-sh code-highlight\",\"children\":[[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"ffmpeg \",[\"$\",\"span\",null,{\"className\":\"token parameter variable\",\"children\":\"-f\"}],\" dshow \",[\"$\",\"span\",null,{\"className\":\"token parameter variable\",\"children\":\"-list_options\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token boolean\",\"children\":\"true\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token parameter variable\",\"children\":\"-i\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token assign-left variable\",\"children\":\"video\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"USB Video\\\"\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"[\"}],\"dshow @ 0000022277b00100\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"]\"}],\"   \",[\"$\",\"span\",null,{\"className\":\"token assign-left variable\",\"children\":\"vcodec\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\"mjpeg  min \",[\"$\",\"span\",null,{\"className\":\"token assign-left variable\",\"children\":\"s\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\"1920x1080 \",[\"$\",\"span\",null,{\"className\":\"token assign-left variable\",\"children\":\"fps\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"10\"}],\" max \",[\"$\",\"span\",null,{\"className\":\"token assign-left variable\",\"children\":\"s\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\"1920x1080 \",[\"$\",\"span\",null,{\"className\":\"token assign-left variable\",\"children\":\"fps\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"60.0002\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"[\"}],\"dshow @ 0000022277b00100\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"]\"}],\"   \",[\"$\",\"span\",null,{\"className\":\"token assign-left variable\",\"children\":\"vcodec\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\"mjpeg  min \",[\"$\",\"span\",null,{\"className\":\"token assign-left variable\",\"children\":\"s\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\"1920x1080 \",[\"$\",\"span\",null,{\"className\":\"token assign-left variable\",\"children\":\"fps\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"10\"}],\" max \",[\"$\",\"span\",null,{\"className\":\"token assign-left variable\",\"children\":\"s\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\"1920x1080 \",[\"$\",\"span\",null,{\"className\":\"token assign-left variable\",\"children\":\"fps\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"60.0002\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"pc, bt470bg/bt709/unknown, center\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"[\"}],\"dshow @ 0000022277b00100\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"]\"}],\"   \",[\"$\",\"span\",null,{\"className\":\"token assign-left variable\",\"children\":\"pixel_format\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\"yuyv422  min \",[\"$\",\"span\",null,{\"className\":\"token assign-left variable\",\"children\":\"s\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\"1920x1080 \",[\"$\",\"span\",null,{\"className\":\"token assign-left variable\",\"children\":\"fps\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"5\"}],\" max \",[\"$\",\"span\",null,{\"className\":\"token assign-left variable\",\"children\":\"s\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\"1920x1080 \",[\"$\",\"span\",null,{\"className\":\"token assign-left variable\",\"children\":\"fps\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"5\"}],\"\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"[\"}],\"dshow @ 0000022277b00100\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"]\"}],\"   \",[\"$\",\"span\",null,{\"className\":\"token assign-left variable\",\"children\":\"pixel_format\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\"yuyv422  min \",[\"$\",\"span\",null,{\"className\":\"token assign-left variable\",\"children\":\"s\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\"1920x1080 \",[\"$\",\"span\",null,{\"className\":\"token assign-left variable\",\"children\":\"fps\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"5\"}],\" max \",[\"$\",\"span\",null,{\"className\":\"token assign-left variable\",\"children\":\"s\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],\"1920x1080 \",[\"$\",\"span\",null,{\"className\":\"token assign-left variable\",\"children\":\"fps\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"5\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\"(\"}],\"tv, bt470bg/bt709/unknown, topleft\",[\"$\",\"span\",null,{\"className\":\"token punctuation\",\"children\":\")\"}],\"\\n\"]}]]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"However, we could convert into a different format when saving to the file which could be open by Open CV.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"While the codev and pixel format were good values compared to the Windows ffmpeg commands below:\"}],\"\\n\",[\"$\",\"pre\",null,{\"className\":\"language-sh\",\"children\":[\"$\",\"code\",null,{\"className\":\"language-sh code-highlight\",\"children\":[[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"ffmpeg \",[\"$\",\"span\",null,{\"className\":\"token parameter variable\",\"children\":\"-codecs\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\"}],\" codec.txt\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"ffmpeg \",[\"$\",\"span\",null,{\"className\":\"token parameter variable\",\"children\":\"-pix_fmts\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"\u003e\"}],\" pix.txt\\n\"]}]]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"The command to read the capture card kept giving me buffer size limit issue or setting issues. I decided to avoid codec with raw data. It does create a huge file but I was able to read the file using VLC!\"}],\"\\n\",[\"$\",\"pre\",null,{\"className\":\"language-sh\",\"children\":[\"$\",\"code\",null,{\"className\":\"language-sh code-highlight\",\"children\":[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"ffmpeg \",[\"$\",\"span\",null,{\"className\":\"token parameter variable\",\"children\":\"-f\"}],\" dshow \",[\"$\",\"span\",null,{\"className\":\"token parameter variable\",\"children\":\"-video_size\"}],\" 1920x1080 \",[\"$\",\"span\",null,{\"className\":\"token parameter variable\",\"children\":\"-i\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token assign-left variable\",\"children\":\"video\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"USB Video\\\"\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token parameter variable\",\"children\":\"-rtbufsize\"}],\" 200M \",[\"$\",\"span\",null,{\"className\":\"token parameter variable\",\"children\":\"-framerate\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"30\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token parameter variable\",\"children\":\"-c:v\"}],\" copy output.mp4\\n\"]}]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Using the Rust code on the raw output worked! The raw 167 megs of under 12 seconds generated a perfect 2 meg image in 3 minutes 49 seconds. The same as the source.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Let's use a codec and see how we can optimize the overall transformation time.\"}],\"\\n\",[\"$\",\"pre\",null,{\"className\":\"language-sh\",\"children\":[\"$\",\"code\",null,{\"className\":\"language-sh code-highlight\",\"children\":[[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"ffmpeg \",[\"$\",\"span\",null,{\"className\":\"token parameter variable\",\"children\":\"-f\"}],\" dshow \",[\"$\",\"span\",null,{\"className\":\"token parameter variable\",\"children\":\"-video_size\"}],\" 1920x1080 \",[\"$\",\"span\",null,{\"className\":\"token parameter variable\",\"children\":\"-i\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token assign-left variable\",\"children\":\"video\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"USB Video\\\"\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token parameter variable\",\"children\":\"-rtbufsize\"}],\" 200M \",[\"$\",\"span\",null,{\"className\":\"token parameter variable\",\"children\":\"-framerate\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"30\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token parameter variable\",\"children\":\"-c:v\"}],\" copy input.mp4\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"ffmpeg \",[\"$\",\"span\",null,{\"className\":\"token parameter variable\",\"children\":\"-i\"}],\" input.mp4 \",[\"$\",\"span\",null,{\"className\":\"token parameter variable\",\"children\":\"-c:v\"}],\" libx264 \",[\"$\",\"span\",null,{\"className\":\"token parameter variable\",\"children\":\"-crf\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"23\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token parameter variable\",\"children\":\"-preset\"}],\" medium \",[\"$\",\"span\",null,{\"className\":\"token parameter variable\",\"children\":\"-c:a\"}],\" aac \",[\"$\",\"span\",null,{\"className\":\"token parameter variable\",\"children\":\"-b:a\"}],\" 128k output.mp4\\n\"]}]]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"The time was not better (I stopped the Rust script after 5 minutes, it wasn't even at 25%) and actually added potential issue with the compression. Also, while running the second command, the console is flooded with the following error. Still, the file can be read by VLC and by the Rust program.\"}],\"\\n\",[\"$\",\"blockquote\",null,{\"children\":[\"\\n\",[\"$\",\"p\",null,{\"children\":\"[mjpeg @ 0000025116f78740] Found EOI before any SOF, ignoring\\n[mjpeg @ 0000025116f78740] No JPEG data found in image\\nError while decoding stream #0:0: Invalid data found when processing input\"}],\"\\n\"]}],\"\\n\",[\"$\",\"h1\",null,{\"children\":\"No Compression, 1 size pixel zip file\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"The ultimate test was to use a zip file with the most black and white information density of each bit using 1 pixel.\"}],\"\\n\",[\"$\",\"pre\",null,{\"className\":\"language-sh\",\"children\":[\"$\",\"code\",null,{\"className\":\"language-sh code-highlight\",\"children\":[[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[\"ffmpeg \",[\"$\",\"span\",null,{\"className\":\"token parameter variable\",\"children\":\"-f\"}],\" dshow \",[\"$\",\"span\",null,{\"className\":\"token parameter variable\",\"children\":\"-video_size\"}],\" 1920x1080 \",[\"$\",\"span\",null,{\"className\":\"token parameter variable\",\"children\":\"-i\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token assign-left variable\",\"children\":\"video\"}],[\"$\",\"span\",null,{\"className\":\"token operator\",\"children\":\"=\"}],[\"$\",\"span\",null,{\"className\":\"token string\",\"children\":\"\\\"USB Video\\\"\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token parameter variable\",\"children\":\"-rtbufsize\"}],\" 200M \",[\"$\",\"span\",null,{\"className\":\"token parameter variable\",\"children\":\"-framerate\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"30\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token parameter variable\",\"children\":\"-c:v\"}],\" copy input_zip.mp4\\n\"]}],[\"$\",\"span\",null,{\"className\":\"code-line\",\"children\":[[\"$\",\"span\",null,{\"className\":\"token function\",\"children\":\"cargo\"}],\" run \",[\"$\",\"span\",null,{\"className\":\"token parameter variable\",\"children\":\"--release\"}],\" -- \",[\"$\",\"span\",null,{\"className\":\"token parameter variable\",\"children\":\"-m\"}],\" extract \",[\"$\",\"span\",null,{\"className\":\"token parameter variable\",\"children\":\"-i\"}],\" outputs/input_zip.mp4 \",[\"$\",\"span\",null,{\"className\":\"token parameter variable\",\"children\":\"-o\"}],\" outputs/PictureFiles.zip \",[\"$\",\"span\",null,{\"className\":\"token parameter variable\",\"children\":\"--fps\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"30\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token parameter variable\",\"children\":\"--height\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"1080\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token parameter variable\",\"children\":\"--width\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"1920\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token parameter variable\",\"children\":\"--size\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token number\",\"children\":\"1\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token parameter variable\",\"children\":\"-p\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token boolean\",\"children\":\"true\"}],\" \",[\"$\",\"span\",null,{\"className\":\"token parameter variable\",\"children\":\"-a\"}],\" bw\\n\"]}]]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"I let the recording watch the video twice. It produced a file of 328 megs (16 seconds). The Rust script ran for 1 minute and 6 seconds an failed with missing frame:\"}],\"\\n\",[\"$\",\"blockquote\",null,{\"children\":[\"\\n\",[\"$\",\"p\",null,{\"children\":\"We have not receive all frames. We received 6 frames for a total of 1555152 bytes and we expected 54347552 bytes\"}],\"\\n\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"I captured again, this time let about 12 iterations of the movie to be recorded. I could see my personal laptop that was running the video being not smooth and the fan running super hard. I suspect frames are skipping as visually I can see some freeze. The generated file was about 850 megs. Unfortunately, the same 6 frames were missing.\"}]]]}]]}],[\"$\",\"div\",null,{\"className\":\"BlogBody_paginationBar__1gsMc\",\"children\":[[\"$\",\"div\",null,{\"className\":\"BlogBody_paginationTitle__H_eFX\",\"children\":\"Chronological Blog Articles by Page\"}],[\"$\",\"div\",null,{\"className\":\"BlogBody_paginationLinks__nk8zd\",\"children\":[[\"$\",\"$Lb\",\"1\",{\"className\":\"\",\"href\":\"/blog/page/1\",\"children\":1}],[\"$\",\"$Lb\",\"2\",{\"className\":\"\",\"href\":\"/blog/page/2\",\"children\":2}],[\"$\",\"$Lb\",\"3\",{\"className\":\"\",\"href\":\"/blog/page/3\",\"children\":3}],[\"$\",\"$Lb\",\"4\",{\"className\":\"\",\"href\":\"/blog/page/4\",\"children\":4}],[\"$\",\"$Lb\",\"5\",{\"className\":\"\",\"href\":\"/blog/page/5\",\"children\":5}],[\"$\",\"$Lb\",\"6\",{\"className\":\"\",\"href\":\"/blog/page/6\",\"children\":6}],[\"$\",\"$Lb\",\"7\",{\"className\":\"\",\"href\":\"/blog/page/7\",\"children\":7}],[\"$\",\"$Lb\",\"8\",{\"className\":\"\",\"href\":\"/blog/page/8\",\"children\":8}],[\"$\",\"$Lb\",\"9\",{\"className\":\"\",\"href\":\"/blog/page/9\",\"children\":9}],[\"$\",\"$Lb\",\"10\",{\"className\":\"\",\"href\":\"/blog/page/10\",\"children\":10}],[\"$\",\"$Lb\",\"11\",{\"className\":\"\",\"href\":\"/blog/page/11\",\"children\":11}],[\"$\",\"$Lb\",\"12\",{\"className\":\"\",\"href\":\"/blog/page/12\",\"children\":12}],[\"$\",\"$Lb\",\"13\",{\"className\":\"\",\"href\":\"/blog/page/13\",\"children\":13}],[\"$\",\"$Lb\",\"14\",{\"className\":\"\",\"href\":\"/blog/page/14\",\"children\":14}],[\"$\",\"$Lb\",\"15\",{\"className\":\"\",\"href\":\"/blog/page/15\",\"children\":15}],[\"$\",\"$Lb\",\"16\",{\"className\":\"\",\"href\":\"/blog/page/16\",\"children\":16}],[\"$\",\"$Lb\",\"17\",{\"className\":\"\",\"href\":\"/blog/page/17\",\"children\":17}],[\"$\",\"$Lb\",\"18\",{\"className\":\"\",\"href\":\"/blog/page/18\",\"children\":18}],[\"$\",\"$Lb\",\"19\",{\"className\":\"\",\"href\":\"/blog/page/19\",\"children\":19}],[\"$\",\"$Lb\",\"20\",{\"className\":\"\",\"href\":\"/blog/page/20\",\"children\":20}],[\"$\",\"$Lb\",\"21\",{\"className\":\"\",\"href\":\"/blog/page/21\",\"children\":21}],[\"$\",\"$Lb\",\"22\",{\"className\":\"\",\"href\":\"/blog/page/22\",\"children\":22}],[\"$\",\"$Lb\",\"23\",{\"className\":\"\",\"href\":\"/blog/page/23\",\"children\":23}],[\"$\",\"$Lb\",\"24\",{\"className\":\"\",\"href\":\"/blog/page/24\",\"children\":24}],[\"$\",\"$Lb\",\"25\",{\"className\":\"\",\"href\":\"/blog/page/25\",\"children\":25}],[\"$\",\"$Lb\",\"26\",{\"className\":\"\",\"href\":\"/blog/page/26\",\"children\":26}],[\"$\",\"$Lb\",\"27\",{\"className\":\"\",\"href\":\"/blog/page/27\",\"children\":27}],[\"$\",\"$Lb\",\"28\",{\"className\":\"\",\"href\":\"/blog/page/28\",\"children\":28}],[\"$\",\"$Lb\",\"29\",{\"className\":\"\",\"href\":\"/blog/page/29\",\"children\":29}],[\"$\",\"$Lb\",\"30\",{\"className\":\"\",\"href\":\"/blog/page/30\",\"children\":30}],[\"$\",\"$Lb\",\"31\",{\"className\":\"\",\"href\":\"/blog/page/31\",\"children\":31}],[\"$\",\"$Lb\",\"32\",{\"className\":\"\",\"href\":\"/blog/page/32\",\"children\":32}],[\"$\",\"$Lb\",\"33\",{\"className\":\"\",\"href\":\"/blog/page/33\",\"children\":33}],[\"$\",\"$Lb\",\"34\",{\"className\":\"\",\"href\":\"/blog/page/34\",\"children\":34}],[\"$\",\"$Lb\",\"35\",{\"className\":\"\",\"href\":\"/blog/page/35\",\"children\":35}],[\"$\",\"$Lb\",\"36\",{\"className\":\"\",\"href\":\"/blog/page/36\",\"children\":36}],[\"$\",\"$Lb\",\"37\",{\"className\":\"\",\"href\":\"/blog/page/37\",\"children\":37}],[\"$\",\"$Lb\",\"38\",{\"className\":\"\",\"href\":\"/blog/page/38\",\"children\":38}],[\"$\",\"$Lb\",\"39\",{\"className\":\"\",\"href\":\"/blog/page/39\",\"children\":39}],[\"$\",\"$Lb\",\"40\",{\"className\":\"\",\"href\":\"/blog/page/40\",\"children\":40}],[\"$\",\"$Lb\",\"41\",{\"className\":\"\",\"href\":\"/blog/page/41\",\"children\":41}],[\"$\",\"$Lb\",\"42\",{\"className\":\"\",\"href\":\"/blog/page/42\",\"children\":42}],[\"$\",\"$Lb\",\"43\",{\"className\":\"\",\"href\":\"/blog/page/43\",\"children\":43}],[\"$\",\"$Lb\",\"44\",{\"className\":\"\",\"href\":\"/blog/page/44\",\"children\":44}],[\"$\",\"$Lb\",\"45\",{\"className\":\"\",\"href\":\"/blog/page/45\",\"children\":45}],[\"$\",\"$Lb\",\"46\",{\"className\":\"\",\"href\":\"/blog/page/46\",\"children\":46}],[\"$\",\"$Lb\",\"47\",{\"className\":\"\",\"href\":\"/blog/page/47\",\"children\":47}],[\"$\",\"$Lb\",\"48\",{\"className\":\"\",\"href\":\"/blog/page/48\",\"children\":48}],[\"$\",\"$Lb\",\"49\",{\"className\":\"\",\"href\":\"/blog/page/49\",\"children\":49}],[\"$\",\"$Lb\",\"50\",{\"className\":\"\",\"href\":\"/blog/page/50\",\"children\":50}],[\"$\",\"$Lb\",\"51\",{\"className\":\"\",\"href\":\"/blog/page/51\",\"children\":51}],[\"$\",\"$Lb\",\"52\",{\"className\":\"\",\"href\":\"/blog/page/52\",\"children\":52}],[\"$\",\"$Lb\",\"53\",{\"className\":\"\",\"href\":\"/blog/page/53\",\"children\":53}],[\"$\",\"$Lb\",\"54\",{\"className\":\"\",\"href\":\"/blog/page/54\",\"children\":54}],[\"$\",\"$Lb\",\"55\",{\"className\":\"\",\"href\":\"/blog/page/55\",\"children\":55}],[\"$\",\"$Lb\",\"56\",{\"className\":\"\",\"href\":\"/blog/page/56\",\"children\":56}],[\"$\",\"$Lb\",\"57\",{\"className\":\"\",\"href\":\"/blog/page/57\",\"children\":57}],[\"$\",\"$Lb\",\"58\",{\"className\":\"\",\"href\":\"/blog/page/58\",\"children\":58}],[\"$\",\"$Lb\",\"59\",{\"className\":\"\",\"href\":\"/blog/page/59\",\"children\":59}],[\"$\",\"$Lb\",\"60\",{\"className\":\"\",\"href\":\"/blog/page/60\",\"children\":60}],[\"$\",\"$Lb\",\"61\",{\"className\":\"\",\"href\":\"/blog/page/61\",\"children\":61}],[\"$\",\"$Lb\",\"62\",{\"className\":\"\",\"href\":\"/blog/page/62\",\"children\":62}],[\"$\",\"$Lb\",\"63\",{\"className\":\"\",\"href\":\"/blog/page/63\",\"children\":63}],[\"$\",\"$Lb\",\"64\",{\"className\":\"\",\"href\":\"/blog/page/64\",\"children\":64}],[\"$\",\"$Lb\",\"65\",{\"className\":\"\",\"href\":\"/blog/page/65\",\"children\":65}],[\"$\",\"$Lb\",\"66\",{\"className\":\"\",\"href\":\"/blog/page/66\",\"children\":66}],[\"$\",\"$Lb\",\"67\",{\"className\":\"\",\"href\":\"/blog/page/67\",\"children\":67}],[\"$\",\"$Lb\",\"68\",{\"className\":\"\",\"href\":\"/blog/page/68\",\"children\":68}],[\"$\",\"$Lb\",\"69\",{\"className\":\"\",\"href\":\"/blog/page/69\",\"children\":69}],[\"$\",\"$Lb\",\"70\",{\"className\":\"\",\"href\":\"/blog/page/70\",\"children\":70}],[\"$\",\"$Lb\",\"71\",{\"className\":\"\",\"href\":\"/blog/page/71\",\"children\":71}],[\"$\",\"$Lb\",\"72\",{\"className\":\"\",\"href\":\"/blog/page/72\",\"children\":72}],[\"$\",\"$Lb\",\"73\",{\"className\":\"\",\"href\":\"/blog/page/73\",\"children\":73}],[\"$\",\"$Lb\",\"74\",{\"className\":\"\",\"href\":\"/blog/page/74\",\"children\":74}],[\"$\",\"$Lb\",\"75\",{\"className\":\"\",\"href\":\"/blog/page/75\",\"children\":75}],[\"$\",\"$Lb\",\"76\",{\"className\":\"\",\"href\":\"/blog/page/76\",\"children\":76}],[\"$\",\"$Lb\",\"77\",{\"className\":\"\",\"href\":\"/blog/page/77\",\"children\":77}],[\"$\",\"$Lb\",\"78\",{\"className\":\"\",\"href\":\"/blog/page/78\",\"children\":78}],[\"$\",\"$Lb\",\"79\",{\"className\":\"\",\"href\":\"/blog/page/79\",\"children\":79}]]}]]}]]}]\n"])</script><script>self.__next_f.push([1,"c:[[\"$\",\"meta\",\"0\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}],[\"$\",\"meta\",\"1\",{\"charSet\":\"utf-8\"}],[\"$\",\"title\",\"2\",{\"children\":\"Patrick Desjardins Blog - How to Transfer Files Between Computers Using HDMI (Part 7: Pagination)\"}],[\"$\",\"meta\",\"3\",{\"name\":\"description\",\"content\":\"How to Transfer Files Between Computers Using HDMI (Part 7: Pagination)\"}]]\n6:null\n"])</script></body></html>