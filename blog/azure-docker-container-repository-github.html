<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="preload" href="/_next/static/media/c9a5bc6a7c948fb0-s.p.woff2" as="font" crossorigin="" type="font/woff2"/><link rel="preload" as="image" href="/images/blog/azure_kbs_creation.png"/><link rel="preload" as="image" href="/images/blog/azure_k8s_workloads.png"/><link rel="preload" as="image" href="/images/blog/azure_kubernetes_deployement.png"/><link rel="stylesheet" href="/_next/static/css/4f3d065c9e2d01e0.css" crossorigin="" data-precedence="next"/><link rel="stylesheet" href="/_next/static/css/080eae226cfe3297.css" crossorigin="" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/_next/static/chunks/webpack-6ab3ff9fe6c6246d.js" crossorigin=""/><script src="/_next/static/chunks/fd9d1056-cc48c28d170fddc2.js" async="" crossorigin=""></script><script src="/_next/static/chunks/69-c7efea4b65083e7f.js" async="" crossorigin=""></script><script src="/_next/static/chunks/main-app-f550f103b66f998a.js" async="" crossorigin=""></script><script src="/_next/static/chunks/250-d7e0a94ebe194dac.js" async=""></script><script src="/_next/static/chunks/79-2d03397107aae3f1.js" async=""></script><script src="/_next/static/chunks/app/blog/%5Bslug%5D/page-6528fc8a86d3d7ed.js" async=""></script><title>Patrick Desjardins Blog - How to use Kubernetes with Microsoft Azure and GitHub and how to debug if it does not workout</title><meta name="description" content="How to use Kubernetes with Microsoft Azure and GitHub and how to debug if it does not workout"/><meta name="next-size-adjust"/><script src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js" crossorigin="" noModule=""></script></head><body class="layout_bodystyle__4ncsS"><div class="__className_aaf875"><div class="layout_container__Tovb9"><header class="layout_siteTitle__k5U8g">Patrick Desjardins Blog</header><nav><ul class="layout_navLinks__mf70r"><li class="layout_navLinkItem__1L8fB"><a class="layout_navLinkText__bt28R" href="/">Main Page</a><a class="layout_navLinkText__bt28R" href="/blog">Blog</a><a class="layout_navLinkText__bt28R" href="/blog/for/2024">2024</a><a class="layout_navLinkText__bt28R" href="/blog/for/2023">2023</a><a class="layout_navLinkText__bt28R" href="/blog/for/2022">2022</a><a class="layout_navLinkText__bt28R" href="/blog/for/2021">2021</a><a class="layout_navLinkText__bt28R" href="/blog/for/2020">2020</a><a class="layout_navLinkText__bt28R" href="/blog/for/2019">2019</a><a class="layout_navLinkText__bt28R" href="/blog/for/2018">2018</a><a class="layout_navLinkText__bt28R" href="/blog/for/2017">2017</a><a class="layout_navLinkText__bt28R" href="/blog/for/2016">2016</a><a class="layout_navLinkText__bt28R" href="/blog/for/2015">2015</a><a class="layout_navLinkText__bt28R" href="/blog/for/2014">2014</a><a class="layout_navLinkText__bt28R" href="/blog/for/2013">2013</a><a class="layout_navLinkText__bt28R" href="/blog/for/2012">2012</a><a class="layout_navLinkText__bt28R" href="/blog/for/2011">2011</a></li></ul></nav><div class="layout_blogPictureContainer__XC7nK"><img alt="Patrick Desjardins picture from a conference" loading="lazy" width="800" height="260" decoding="async" data-nimg="1" class="layout_blogTopPicture__RJHNN" style="color:transparent" src="/images/backgrounds/patrickdesjardins_conference_bw.jpeg"/></div><main class="layout_main__mXTwS"><h1>How to use Kubernetes with Microsoft Azure and GitHub and how to debug if it does not workout</h1><div class="layout_blogPostContainer__WYELx"><p class="layout_blogPostDate__LUvx5">Posted on: <!-- -->2022-07-28</p><p>Kubernetes is a convenient way to deploy an infrastructure of services in a central place. Once you have your service Docker images built and deployed you can use Kubernetes to deploy multiple instances across the cloud. In this article, we will see how Microsoft Azure can use a Kubernetes configuration generated with Helm and deploy many images from Azure Registry Container.</p>
<h1>Create an Azure Kubernetes Service (AKS)</h1>
<p>There are two ways to create a Azure Kubernetes Services: Azure Cli and Azure Portal.</p>
<h2>Azure Cli</h2>
<p>A few pieces of information is required that were built when we created our Azure Docker Image Repository.
You need to use the Azure resource group name after <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-light" style="background-color:#fff;color:#24292e"><span data-line=""><span>--resource-group</span></span></code></span>. The name of the Kubernetes service is after <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-light" style="background-color:#fff;color:#24292e"><span data-line=""><span>--name</span></span></code></span>. The <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-light" style="background-color:#fff;color:#24292e"><span data-line=""><span>--attach-acr</span></span></code></span> is the name of the Azure Container Registry (acr).</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#fff;color:#24292e" tabindex="0" data-language="plaintext" data-theme="github-light"><code data-language="plaintext" data-theme="github-light" style="display:grid"><span data-line=""><span>az aks create --resource-group realtimepixel_resourcegroup --name realpixelask --location eastus --attach-acr realtimepixel --generate-ssh-keys</span></span></code></pre></figure>
<p>There are a few things to know:</p>
<ol>
<li>The name cannot have an underscore. Even if you enclose with double quote, it does not work</li>
<li>The command takes a while to run. Expect at least 1 minute.</li>
</ol>
<h2>Azure Portal</h2>
<p>Many online tutorials show the Azure CLI (<span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-light" style="background-color:#fff;color:#24292e"><span data-line=""><span>az</span></span></code></span> command), but it is also possible to create the Kubernetes service on the Microsoft Azure Portal.</p>
<p><img src="/images/blog/azure_kbs_creation.png" alt=""/></p>
<p>I personally prefer to use a web interface. For creating a Kubernetes cluster, the Azure Portal guides you through several steps, which in my opinion worth doing that step that you will rarely do compared to operation Azure CLI command.</p>
<h1>Configure Github Workflow</h1>
<p>You can edit the existing Github workflow defined <a href="./azure-docker-container-repository-github">previously</a> that was building the image and pushing it into Azure Container Registry (ACR). However, I created a new workflow to manually decide when to push the image into production.</p>
<p>Here is the entire Github workflow that I store in the repository in <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-light" style="background-color:#fff;color:#24292e"><span data-line=""><span>.github/workflows/k8sdeploy.yml</span></span></code></span></p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#fff;color:#24292e" tabindex="0" data-language="plaintext" data-theme="github-light"><code data-language="plaintext" data-theme="github-light" style="display:grid"><span data-line=""><span>name: Kubernetes Prod Deployment</span></span>
<span data-line=""><span>on:</span></span>
<span data-line=""><span>  workflow_dispatch:</span></span>
<span data-line=""> </span>
<span data-line=""><span># Environment variables available to all jobs and steps in this workflow</span></span>
<span data-line=""><span>env:</span></span>
<span data-line=""><span>  REGISTRY_NAME: realtimepixel</span></span>
<span data-line=""><span>  CLUSTER_NAME: realpixelask2</span></span>
<span data-line=""><span>  CLUSTER_RESOURCE_GROUP: realtimepixel_resourcegroup</span></span>
<span data-line=""><span>  NAMESPACE: realtimepixel-prod</span></span>
<span data-line=""> </span>
<span data-line=""><span>jobs:</span></span>
<span data-line=""><span>  build:</span></span>
<span data-line=""><span>    runs-on: ubuntu-latest</span></span>
<span data-line=""><span>    steps:</span></span>
<span data-line=""><span>      - uses: actions/checkout@main</span></span>
<span data-line=""> </span>
<span data-line=""><span>      # Set the target Azure Kubernetes Service (AKS) cluster.</span></span>
<span data-line=""><span>      - uses: azure/aks-set-context@v1</span></span>
<span data-line=""><span>        with:</span></span>
<span data-line=""><span>          creds: ${{ secrets.AZURE_CREDENTIALS }}</span></span>
<span data-line=""><span>          cluster-name: ${{ env.CLUSTER_NAME }}</span></span>
<span data-line=""><span>          resource-group: ${{ env.CLUSTER_RESOURCE_GROUP }}</span></span>
<span data-line=""> </span>
<span data-line=""><span>      # Create namespace if doesn&#x27;t exist</span></span>
<span data-line=""><span>      - run: |</span></span>
<span data-line=""><span>          kubectl create namespace ${{ env.NAMESPACE }} --dry-run=client -o json | kubectl apply -f -</span></span>
<span data-line=""> </span>
<span data-line=""><span>      - name: Helm tool installer</span></span>
<span data-line=""><span>        uses: Azure/setup-helm@v1</span></span>
<span data-line=""> </span>
<span data-line=""><span>      - name: Azure Login</span></span>
<span data-line=""><span>        uses: Azure/login@v1.1</span></span>
<span data-line=""><span>        with:</span></span>
<span data-line=""><span>          creds: ${{ secrets.AZURE_CREDENTIALS }}</span></span>
<span data-line=""> </span>
<span data-line=""><span>      - name: Get Latest Tag Redis</span></span>
<span data-line=""><span>        id: latesttagredis</span></span>
<span data-line=""><span>        run: |</span></span>
<span data-line=""><span>          tag_redis=$(az acr repository show-tags --name ${{env.REGISTRY_NAME}} --repository realtimepixel_redis --top 1 --orderby time_desc -o tsv)</span></span>
<span data-line=""><span>          echo &quot;::set-output name=tag_redis::$tag_redis&quot;</span></span>
<span data-line=""><span>      </span></span>
<span data-line=""><span>      - name: Tag Redis</span></span>
<span data-line=""><span>        run: echo &quot;Tag Redis is ${{ steps.latesttagredis.outputs.tag_redis }}&quot;</span></span>
<span data-line=""> </span>
<span data-line=""><span>      - name: Get Latest Tag Backend</span></span>
<span data-line=""><span>        id: latesttagbackend</span></span>
<span data-line=""><span>        run: |</span></span>
<span data-line=""><span>          tag_backend=$(az acr repository show-tags --name ${{env.REGISTRY_NAME}} --repository realtimepixel_backend --top 1 --orderby time_desc -o tsv)</span></span>
<span data-line=""><span>          echo &quot;::set-output name=tag_backend::$tag_backend&quot;</span></span>
<span data-line=""> </span>
<span data-line=""><span>      - name: Tag Backend</span></span>
<span data-line=""><span>        run: echo &quot;Tag Backend is ${{ steps.latesttagbackend.outputs.tag_backend }}&quot;</span></span>
<span data-line=""><span>      </span></span>
<span data-line=""><span>      - name: Get Latest Tag Frontend</span></span>
<span data-line=""><span>        id: latesttagfrontend</span></span>
<span data-line=""><span>        run: |</span></span>
<span data-line=""><span>          tag_frontend=$(az acr repository show-tags --name ${{env.REGISTRY_NAME}} --repository realtimepixel_frontend --top 1 --orderby time_desc -o tsv)</span></span>
<span data-line=""><span>          echo &quot;::set-output name=tag_frontend::$tag_frontend&quot;</span></span>
<span data-line=""> </span>
<span data-line=""><span>      - name: Tag Frontend</span></span>
<span data-line=""><span>        run: echo &quot;Tag Frontend is ${{ steps.latesttagfrontend.outputs.tag_frontend }}&quot;</span></span>
<span data-line=""> </span>
<span data-line=""><span>      - name: Deploy</span></span>
<span data-line=""><span>        run: &gt;</span></span>
<span data-line=""><span>          helm upgrade realtimepixel ./kubernetes/realtimepixel </span></span>
<span data-line=""><span>          --install </span></span>
<span data-line=""><span>          --namespace=${{ env.NAMESPACE }} </span></span>
<span data-line=""><span>          --set namespace=${{env.NAMESPACE}}</span></span>
<span data-line=""><span>          --set image.pullPolicy=Always</span></span>
<span data-line=""><span>          --set image.redis.repository=${{env.REGISTRY_NAME}}.azurecr.io/realtimepixel_redis</span></span>
<span data-line=""><span>          --set image.redis.tag=${{ steps.latesttagredis.outputs.tag_redis }}</span></span>
<span data-line=""><span>          --set image.backend.repository=${{env.REGISTRY_NAME}}.azurecr.io/realtimepixel_backend</span></span>
<span data-line=""><span>          --set image.backend.tag=${{ steps.latesttagbackend.outputs.tag_backend }}</span></span>
<span data-line=""><span>          --set image.frontend.repository=${{env.REGISTRY_NAME}}.azurecr.io/realtimepixel_frontend</span></span>
<span data-line=""><span>          --set image.frontend.tag=${{ steps.latesttagfrontend.outputs.tag_frontend }}</span></span></code></pre></figure>
<p>Here is a description of what is going on:</p>
<ol>
<li>
<p>The first section, called <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-light" style="background-color:#fff;color:#24292e"><span data-line=""><span>env</span></span></code></span>, is variable that can be used across the workflow. It is a simple way to configure data in a central place for the script. It defined the registry (Azure Container Registry) name, the Kubernetes cluster name created in this blog post, the Azure resource group (previous article), and the Kubernetes namespace.</p>
</li>
<li>
<p>The second section connects to AKS: Azure Kubernetes Service</p>
</li>
<li>
<p>We create the namespace</p>
</li>
<li>
<p>We then connect with Helm and Azure Login. From now, we are ready to perform some commands</p>
</li>
<li>
<p>First, we get the latest image tag for each image</p>
</li>
<li>
<p>Finally, we use <strong>Helm</strong> to install or update the Kubernetes configuration. What is important is to override a lot of values from <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-light" style="background-color:#fff;color:#24292e"><span data-line=""><span>kubernetes\realtimepixel\values.yaml</span></span></code></span> (Helm values file)</p>
</li>
</ol>
<h1>Verification</h1>
<p>At this point, the Helm command pushes the instruction to Azure Kubernetes Service. Going in the portal you can see under <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-light" style="background-color:#fff;color:#24292e"><span data-line=""><span>Workloads</span></span></code></span> the deployment.</p>
<p><img src="/images/blog/azure_k8s_workloads.png" alt=""/></p>
<p>Everything should be running as expected! The screenshot shows three orange symbols next to my three deployments because there is an issue with the Kubernetes configuration, which is outside the goal of this post. However, it is still interesting to know that you can drill and see the error reason being: <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-light" style="background-color:#fff;color:#24292e"><span data-line=""><span>ErrImageNeverPull</span></span></code></span>.</p>
<h2>Debug Azure Kubernetes ErrImageNeverPull</h2>
<p>The first steps are to access the reason the image is not pulling. You need to get one of the pods under the deployment that is falling.</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#fff;color:#24292e" tabindex="0" data-language="plaintext" data-theme="github-light"><code data-language="plaintext" data-theme="github-light" style="display:grid"><span data-line=""><span>kubectl get pods -n realtimepixel-prod</span></span>
<span data-line=""><span>kubectl describe pod redis-deployment-6495cd48cc-fhzjg -n realtimepixel-prod</span></span></code></pre></figure>
<p>The last command gives more information saying the policy is to <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-light" style="background-color:#fff;color:#24292e"><span data-line=""><span>Never</span></span></code></span></p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#fff;color:#24292e" tabindex="0" data-language="plaintext" data-theme="github-light"><code data-language="plaintext" data-theme="github-light" style="display:grid"><span data-line=""><span>Events:</span></span>
<span data-line=""><span>Type     Reason             Age                    From               Message</span></span>
<span data-line=""><span>----     ------             ----                   ----               -------</span></span>
<span data-line=""><span>Normal   Scheduled          59m                    default-scheduler  Successfully assigned realtimepixel-prod/redis-deployment-6495cd48cc-fhzjg to aks-agentpool-28884595-vmss000002</span></span>
<span data-line=""><span>Warning  Failed             57m (x12 over 59m)     kubelet            Error: ErrImageNeverPull</span></span>
<span data-line=""><span>Warning  ErrImageNeverPull  4m36s (x260 over 59m)  kubelet            Container image &quot;realtimepixel.azurecr.io/realtimepixel_redis:67dfbf27b868bd0b9e7c77aefafb596f2adb3ca0&quot; is not present with pull policy of Never</span></span></code></pre></figure>
<p>So, once we know the problem is the <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-light" style="background-color:#fff;color:#24292e"><span data-line=""><span>Never</span></span></code></span>, we can see what is happening between Helm and Azure Kubernetes. Trying to see what is sent to Kubernetes is by using the <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-light" style="background-color:#fff;color:#24292e"><span data-line=""><span>template</span></span></code></span> command of Helm.</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#fff;color:#24292e" tabindex="0" data-language="plaintext" data-theme="github-light"><code data-language="plaintext" data-theme="github-light" style="display:grid"><span data-line=""><span>helm template realtimepixel ./kubernetes/realtimepixel --set namespace=realtimepixel-prod --set image.pullPolicy=Always --set image.redis.repository=realtimepixel.azurecr.io/realtimepixel_redis --set image.redis.tag=123123 --set image.backend.repository=realtimepixel.azurecr.io/realtimepixel_backend --set image.backend.tag=123123 --set image.frontend.repository=realtimepixel.azurecr.io/realtimepixel_frontend --set image.frontend.tag=123123 &gt; temp.yaml</span></span></code></pre></figure>
<p>I found a case-sensitive issue with the <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-light" style="background-color:#fff;color:#24292e"><span data-line=""><span>image.pullPolicy</span></span></code></span> where the <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-light" style="background-color:#fff;color:#24292e"><span data-line=""><span>p</span></span></code></span> was lowercase and needed to be uppercase.</p>
<h2>How to Debug with Azure Kubernetes Containers</h2>
<p>The first issue was out of the way, and a second appeared. This time, the Azure Kubernetes was showing the pods having a <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-light" style="background-color:#fff;color:#24292e"><span data-line=""><span>CrashLoopBackOff</span></span></code></span>.There is a command to get the health of all your pods. In my case, some of them were crashing:</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#fff;color:#24292e" tabindex="0" data-language="plaintext" data-theme="github-light"><code data-language="plaintext" data-theme="github-light" style="display:grid"><span data-line=""><span>kubectl get pods -n realtimepixel-prod</span></span></code></pre></figure>
<p>Resulted with:</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#fff;color:#24292e" tabindex="0" data-language="plaintext" data-theme="github-light"><code data-language="plaintext" data-theme="github-light" style="display:grid"><span data-line=""><span>NAME                                   READY   STATUS             RESTARTS         AGE</span></span>
<span data-line=""><span>backend-deployment-69c99548d9-g2w5d    0/1     CrashLoopBackOff   10 (3m28s ago)   30m</span></span>
<span data-line=""><span>backend-deployment-69c99548d9-wrhzp    0/1     CrashLoopBackOff   10 (3m42s ago)   30m</span></span>
<span data-line=""><span>backend-deployment-7dfbc4f7f8-m99kl    0/1     CrashLoopBackOff   10 (3m51s ago)   109m</span></span>
<span data-line=""><span>backend-deployment-7dfbc4f7f8-vbp24    0/1     CrashLoopBackOff   10 (4m4s ago)    109m</span></span>
<span data-line=""><span>frontend-deployment-6f88fdb587-2p2lk   1/1     Running            0                30m</span></span>
<span data-line=""><span>redis-deployment-5d48cc44bd-8w869      1/1     Running            0                30m</span></span></code></pre></figure>
<p>It is possible to see the logs of the deployment:</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#fff;color:#24292e" tabindex="0" data-language="plaintext" data-theme="github-light"><code data-language="plaintext" data-theme="github-light" style="display:grid"><span data-line=""><span>kubectl describe pod backend-deployment-69c99548d9-g2w5d -n realtimepixel-prod</span></span>
<span data-line=""><span>kubectl logs backend-deployment-69c99548d9-g2w5d -n realtimepixel-prod</span></span></code></pre></figure>
<p>The output:</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#fff;color:#24292e" tabindex="0" data-language="plaintext" data-theme="github-light"><code data-language="plaintext" data-theme="github-light" style="display:grid"><span data-line=""><span>&gt; start:production</span></span>
<span data-line=""><span>&gt; node -r ts-node/register/transpile-only -r tsconfig-paths/register build/backend/src/index.js</span></span>
<span data-line=""> </span>
<span data-line=""><span>Error: Cannot find module &#x27;/node/build/backend/src/index.js&#x27;</span></span>
<span data-line=""><span>    at Function.Module._resolveFilename (node:internal/modules/cjs/loader:933:15)</span></span>
<span data-line=""><span>    at Function.Module._resolveFilename.sharedData.moduleResolveFilenameHook.installedValue (/node/node_modules/@cspotcode/source-map-support/source-map-support.js:679:30)</span></span>
<span data-line=""><span>    at Function.Module._resolveFilename (/node/node_modules/tsconfig-paths/src/register.ts:90:36)</span></span>
<span data-line=""><span>    at Function.Module._load (node:internal/modules/cjs/loader:778:27)</span></span>
<span data-line=""><span>    at Function.executeUserEntryPoint [as runMain] (node:internal/modules/run_main:77:12)</span></span>
<span data-line=""><span>    at node:internal/main/run_main_module:17:47 {</span></span>
<span data-line=""><span>  code: &#x27;MODULE_NOT_FOUND&#x27;,</span></span>
<span data-line=""><span>  requireStack: []</span></span>
<span data-line=""><span>}</span></span></code></pre></figure>
<p>My instinct was to get into the container.</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#fff;color:#24292e" tabindex="0" data-language="plaintext" data-theme="github-light"><code data-language="plaintext" data-theme="github-light" style="display:grid"><span data-line=""><span>kubectl exec -it backend-deployment-69c99548d9-g2w5d -n realtimepixel-prod -- sh</span></span></code></pre></figure>
<p>But was producing:</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#fff;color:#24292e" tabindex="0" data-language="plaintext" data-theme="github-light"><code data-language="plaintext" data-theme="github-light" style="display:grid"><span data-line=""><span> error: unable to upgrade connection: container not found...</span></span></code></pre></figure>
<p>The problem is that the issue is on the <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-light" style="background-color:#fff;color:#24292e"><span data-line=""><span>run</span></span></code></span> command of the container that is failing because the starting file (index.js) is not present. However, because it cannot start the command, the container closes not letting me accessing the container to inspect the folder structures and files.</p>
<p>You can test it by creating a Pod for the problematic image that will not restart using the following commands:</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#fff;color:#24292e" tabindex="0" data-language="plaintext" data-theme="github-light"><code data-language="plaintext" data-theme="github-light" style="display:grid"><span data-line=""><span>kubectl run debug-demo -n realtimepixel-prod --image=realtimepixel.azurecr.io/realtimepixel_backend:67dfbf27b868bd0b9e7c77aefafb596f2adb3ca0 --restart=Never</span></span>
<span data-line=""><span>kubectl get pods -n realtimepixel-prod</span></span>
<span data-line=""><span>kubectl exec -it debug-demo -n realtimepixel-prod -- sh</span></span></code></pre></figure>
<p>However, the problem will remain that when the Kube Control runs the image that it will crash. However, the log above provides good information. In my case, I realized two things:</p>
<ol>
<li>When testing locally, I wasn&#x27;t testing correctly. The build was passing because I had a <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-light" style="background-color:#fff;color:#24292e"><span data-line=""><span>node_modules</span></span></code></span> with a dependency that was installed when performing <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-light" style="background-color:#fff;color:#24292e"><span data-line=""><span>npm run install</span></span></code></span> which was adding all the <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-light" style="background-color:#fff;color:#24292e"><span data-line=""><span>devDependencies</span></span></code></span>. On Github, performing the same command, with the <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-light" style="background-color:#fff;color:#24292e"><span data-line=""><span>NODE_ENV</span></span></code></span> to <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-light" style="background-color:#fff;color:#24292e"><span data-line=""><span>production</span></span></code></span> was causing <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-light" style="background-color:#fff;color:#24292e"><span data-line=""><span>npm install</span></span></code></span> to install only the <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-light" style="background-color:#fff;color:#24292e"><span data-line=""><span>dependencies</span></span></code></span> without the <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-light" style="background-color:#fff;color:#24292e"><span data-line=""><span>devDependencies</span></span></code></span>.</li>
<li>I added the <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-light" style="background-color:#fff;color:#24292e"><span data-line=""><span>--target</span></span></code></span> in the build for the multi-stage. I had the impression that it would start the build with the target, but it is saying that it will be the latest. Oddly, using <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-light" style="background-color:#fff;color:#24292e"><span data-line=""><span>docker-compose</span></span></code></span>, the build step is only the one in the target but using the docker command runs the developer portions and the production.</li>
</ol>
<h1>Still Not Working! What to do next?</h1>
<p>In my case, it was still not green. Same error about <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-light" style="background-color:#fff;color:#24292e"><span data-line=""><span>CrashLoopBackOff</span></span></code></span> on the startup of the container. Time to get back locally.</p>
<p>Instead of using <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-light" style="background-color:#fff;color:#24292e"><span data-line=""><span>docker-compose</span></span></code></span>, I decided to mimic what I was doing on the Github workflow.</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#fff;color:#24292e" tabindex="0" data-language="plaintext" data-theme="github-light"><code data-language="plaintext" data-theme="github-light" style="display:grid"><span data-line=""><span>docker build -f ./services/backend/Dockerfile --target production --build-arg NODE_ENV=production .</span></span></code></pre></figure>
<p>Then get the image built and run it.</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#fff;color:#24292e" tabindex="0" data-language="plaintext" data-theme="github-light"><code data-language="plaintext" data-theme="github-light" style="display:grid"><span data-line=""><span>docker images</span></span>
<span data-line=""><span>docker run 40d4941a9092</span></span>
<span data-line=""><span>docker ps</span></span></code></pre></figure>
<p>Take the <em>image id</em> from the ps command:</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#fff;color:#24292e" tabindex="0" data-language="plaintext" data-theme="github-light"><code data-language="plaintext" data-theme="github-light" style="display:grid"><span data-line=""><span>docker run -it 40d4941a9092 bash</span></span></code></pre></figure>
<p>I could see the error, but like Kubernetes, the container shut down. So now, time to make the container crash but to hang it there in an infinite loop:</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#fff;color:#24292e" tabindex="0" data-language="plaintext" data-theme="github-light"><code data-language="plaintext" data-theme="github-light" style="display:grid"><span data-line=""><span>docker run 40d4941a9092 /bin/sh -c &quot;while true; do sleep 2; df -h; done&quot;</span></span></code></pre></figure>
<p>In another terminal window, you can connect.</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#fff;color:#24292e" tabindex="0" data-language="plaintext" data-theme="github-light"><code data-language="plaintext" data-theme="github-light" style="display:grid"><span data-line=""><span>docker run -it 40d4941a9092 bash</span></span></code></pre></figure>
<p>At that point, I saw that the build was messing around with the folders of the output of TypeScript. So I modified the path and was good to go.</p>
<h1>Conclusion</h1>
<p>At this point, the image was created with a build that was successful.</p>
<p><img src="/images/blog/azure_kubernetes_deployement.png" alt=""/></p>
<p>I would say that the experience was enriching. However, one question kept getting in the back of my mind: why isn&#x27;t the Azure Portal guiding me with more than a single keyword for the failure. As we saw, by messing around with commands, we found the root cause, but some support would have been great. Nonetheless, if something happens to you, now you should be equipped to diagnose a little bit better.</p>
<div><h2>Azure Blog Posts: Docker Images &amp; Kubernetes</h2><ol><li><a href="azure-docker-container-repository">How to host Docker images on Microsoft Azure</a></li><li><a href="azure-docker-container-repository-github">How to use Kubernetes with Microsoft Azure and GitHub and how to debug if it does not workout</a></li><li><a href="azure-intro-kubernetes">An Introduction to Microsoft Azure and Kubernetes using Helm and Docker Images</a></li><li><a href="azure-kubernetes-public-access">How to Access your Web Application on Kubernetes Azure</a></li><li><a href="azure-kubernetes-pod-debug-crash">How to Debug a Kubernetes Pod that Crash at Startup (works on Microsoft Azure Kubernetes)?</a></li><li><a href="helpchart-introduction">How to use Helm Chart to configure dynamically your Kubernetes file for beginner?</a></li></ol></div></div></main><div class="layout_paginationBar__jnuuR"><div class="layout_paginationTitle__PsOw5">Chronological Blog Articles by Page</div><div class="layout_paginationLinks__LdBaH"><a class="" href="/blog/page/1">1</a><a class="" href="/blog/page/2">2</a><a class="" href="/blog/page/3">3</a><a class="" href="/blog/page/4">4</a><a class="" href="/blog/page/5">5</a><a class="" href="/blog/page/6">6</a><a class="" href="/blog/page/7">7</a><a class="" href="/blog/page/8">8</a><a class="" href="/blog/page/9">9</a><a class="" href="/blog/page/10">10</a><a class="" href="/blog/page/11">11</a><a class="" href="/blog/page/12">12</a><a class="" href="/blog/page/13">13</a><a class="" href="/blog/page/14">14</a><a class="" href="/blog/page/15">15</a><a class="" href="/blog/page/16">16</a><a class="" href="/blog/page/17">17</a><a class="" href="/blog/page/18">18</a><a class="" href="/blog/page/19">19</a><a class="" href="/blog/page/20">20</a><a class="" href="/blog/page/21">21</a><a class="" href="/blog/page/22">22</a><a class="" href="/blog/page/23">23</a><a class="" href="/blog/page/24">24</a><a class="" href="/blog/page/25">25</a><a class="" href="/blog/page/26">26</a><a class="" href="/blog/page/27">27</a><a class="" href="/blog/page/28">28</a><a class="" href="/blog/page/29">29</a><a class="" href="/blog/page/30">30</a><a class="" href="/blog/page/31">31</a><a class="" href="/blog/page/32">32</a><a class="" href="/blog/page/33">33</a><a class="" href="/blog/page/34">34</a><a class="" href="/blog/page/35">35</a><a class="" href="/blog/page/36">36</a><a class="" href="/blog/page/37">37</a><a class="" href="/blog/page/38">38</a><a class="" href="/blog/page/39">39</a><a class="" href="/blog/page/40">40</a><a class="" href="/blog/page/41">41</a><a class="" href="/blog/page/42">42</a><a class="" href="/blog/page/43">43</a><a class="" href="/blog/page/44">44</a><a class="" href="/blog/page/45">45</a><a class="" href="/blog/page/46">46</a><a class="" href="/blog/page/47">47</a><a class="" href="/blog/page/48">48</a><a class="" href="/blog/page/49">49</a><a class="" href="/blog/page/50">50</a><a class="" href="/blog/page/51">51</a><a class="" href="/blog/page/52">52</a><a class="" href="/blog/page/53">53</a><a class="" href="/blog/page/54">54</a><a class="" href="/blog/page/55">55</a><a class="" href="/blog/page/56">56</a><a class="" href="/blog/page/57">57</a><a class="" href="/blog/page/58">58</a><a class="" href="/blog/page/59">59</a><a class="" href="/blog/page/60">60</a><a class="" href="/blog/page/61">61</a><a class="" href="/blog/page/62">62</a><a class="" href="/blog/page/63">63</a><a class="" href="/blog/page/64">64</a><a class="" href="/blog/page/65">65</a><a class="" href="/blog/page/66">66</a><a class="" href="/blog/page/67">67</a><a class="" href="/blog/page/68">68</a><a class="" href="/blog/page/69">69</a><a class="" href="/blog/page/70">70</a><a class="" href="/blog/page/71">71</a><a class="" href="/blog/page/72">72</a><a class="" href="/blog/page/73">73</a><a class="" href="/blog/page/74">74</a><a class="" href="/blog/page/75">75</a><a class="" href="/blog/page/76">76</a><a class="" href="/blog/page/77">77</a></div></div></div></div><script src="/_next/static/chunks/webpack-6ab3ff9fe6c6246d.js" crossorigin="" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0]);self.__next_f.push([2,null])</script><script>self.__next_f.push([1,"1:HL[\"/_next/static/css/4f3d065c9e2d01e0.css\",\"style\",{\"crossOrigin\":\"\"}]\n0:\"$L2\"\n"])</script><script>self.__next_f.push([1,"3:HL[\"/_next/static/media/c9a5bc6a7c948fb0-s.p.woff2\",\"font\",{\"crossOrigin\":\"\",\"type\":\"font/woff2\"}]\n4:HL[\"/_next/static/css/080eae226cfe3297.css\",\"style\",{\"crossOrigin\":\"\"}]\n"])</script><script>self.__next_f.push([1,"5:I[7690,[],\"\"]\n8:I[5613,[],\"\"]\na:I[1778,[],\"\"]\nb:I[5250,[\"250\",\"static/chunks/250-d7e0a94ebe194dac.js\",\"79\",\"static/chunks/79-2d03397107aae3f1.js\",\"308\",\"static/chunks/app/blog/%5Bslug%5D/page-6528fc8a86d3d7ed.js\"],\"\"]\nd:I[8955,[],\"\"]\n9:[\"slug\",\"azure-docker-container-repository-github\",\"d\"]\ne:[]\n"])</script><script>self.__next_f.push([1,"2:[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/4f3d065c9e2d01e0.css\",\"precedence\":\"next\",\"crossOrigin\":\"\"}]],[\"$\",\"$L5\",null,{\"buildId\":\"fl8cLkdN8pxFlogTNEdin\",\"assetPrefix\":\"\",\"initialCanonicalUrl\":\"/blog/azure-docker-container-repository-github\",\"initialTree\":[\"\",{\"children\":[\"blog\",{\"children\":[[\"slug\",\"azure-docker-container-repository-github\",\"d\"],{\"children\":[\"__PAGE__?{\\\"slug\\\":\\\"azure-docker-container-repository-github\\\"}\",{}]}]}]},\"$undefined\",\"$undefined\",true],\"initialSeedData\":[\"\",{\"children\":[\"blog\",{\"children\":[[\"slug\",\"azure-docker-container-repository-github\",\"d\"],{\"children\":[\"__PAGE__\",{},[\"$L6\",\"$L7\",null]]},[\"$\",\"$L8\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"blog\",\"children\",\"$9\",\"children\"],\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"loadingScripts\":\"$undefined\",\"hasLoading\":false,\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$La\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\",\"styles\":[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/080eae226cfe3297.css\",\"precedence\":\"next\",\"crossOrigin\":\"\"}]]}]]},[\"$\",\"$L8\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"blog\",\"children\"],\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"loadingScripts\":\"$undefined\",\"hasLoading\":false,\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$La\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\",\"styles\":null}]]},[null,[\"$\",\"html\",null,{\"lang\":\"en\",\"children\":[\"$\",\"body\",null,{\"className\":\"layout_bodystyle__4ncsS\",\"children\":[\"$\",\"$L8\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\"],\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"loadingScripts\":\"$undefined\",\"hasLoading\":false,\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$La\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[\"$\",\"div\",null,{\"style\":{\"display\":\"flex\",\"alignItems\":\"center\",\"justifyContent\":\"center\",\"height\":\"100vh\"},\"children\":[\"$\",\"div\",null,{\"style\":{\"width\":\"50%\",\"height\":\"20%\",\"backgroundColor\":\"#ffeded\",\"borderRadius\":12,\"padding\":12,\"textAlign\":\"center\"},\"children\":[[\"$\",\"h1\",null,{\"children\":\"Not Found\"}],[\"$\",\"p\",null,{\"children\":\"Could not find requested resource\"}],[\"$\",\"$Lb\",null,{\"href\":\"/\",\"children\":\"Return Home\"}]]}]}],\"notFoundStyles\":[],\"styles\":null}]}]}],null]],\"initialHead\":[false,\"$Lc\"],\"globalErrorComponent\":\"$d\",\"missingSlots\":\"$We\"}]]\n"])</script><script>self.__next_f.push([1,"f:I[1749,[\"250\",\"static/chunks/250-d7e0a94ebe194dac.js\",\"79\",\"static/chunks/79-2d03397107aae3f1.js\",\"308\",\"static/chunks/app/blog/%5Bslug%5D/page-6528fc8a86d3d7ed.js\"],\"Image\"]\n"])</script><script>self.__next_f.push([1,"7:[\"$\",\"div\",null,{\"className\":\"__className_aaf875\",\"children\":[\"$\",\"div\",null,{\"className\":\"layout_container__Tovb9\",\"children\":[[\"$\",\"header\",null,{\"className\":\"layout_siteTitle__k5U8g\",\"children\":\"Patrick Desjardins Blog\"}],[\"$\",\"nav\",null,{\"children\":[\"$\",\"ul\",null,{\"className\":\"layout_navLinks__mf70r\",\"children\":[\"$\",\"li\",null,{\"className\":\"layout_navLinkItem__1L8fB\",\"children\":[[\"$\",\"$Lb\",null,{\"className\":\"layout_navLinkText__bt28R\",\"href\":\"/\",\"children\":\"Main Page\"}],[\"$\",\"$Lb\",null,{\"className\":\"layout_navLinkText__bt28R\",\"href\":\"/blog\",\"children\":\"Blog\"}],[[\"$\",\"$Lb\",\"2024\",{\"className\":\"layout_navLinkText__bt28R\",\"href\":\"/blog/for/2024\",\"children\":2024}],[\"$\",\"$Lb\",\"2023\",{\"className\":\"layout_navLinkText__bt28R\",\"href\":\"/blog/for/2023\",\"children\":2023}],[\"$\",\"$Lb\",\"2022\",{\"className\":\"layout_navLinkText__bt28R\",\"href\":\"/blog/for/2022\",\"children\":2022}],[\"$\",\"$Lb\",\"2021\",{\"className\":\"layout_navLinkText__bt28R\",\"href\":\"/blog/for/2021\",\"children\":2021}],[\"$\",\"$Lb\",\"2020\",{\"className\":\"layout_navLinkText__bt28R\",\"href\":\"/blog/for/2020\",\"children\":2020}],[\"$\",\"$Lb\",\"2019\",{\"className\":\"layout_navLinkText__bt28R\",\"href\":\"/blog/for/2019\",\"children\":2019}],[\"$\",\"$Lb\",\"2018\",{\"className\":\"layout_navLinkText__bt28R\",\"href\":\"/blog/for/2018\",\"children\":2018}],[\"$\",\"$Lb\",\"2017\",{\"className\":\"layout_navLinkText__bt28R\",\"href\":\"/blog/for/2017\",\"children\":2017}],[\"$\",\"$Lb\",\"2016\",{\"className\":\"layout_navLinkText__bt28R\",\"href\":\"/blog/for/2016\",\"children\":2016}],[\"$\",\"$Lb\",\"2015\",{\"className\":\"layout_navLinkText__bt28R\",\"href\":\"/blog/for/2015\",\"children\":2015}],[\"$\",\"$Lb\",\"2014\",{\"className\":\"layout_navLinkText__bt28R\",\"href\":\"/blog/for/2014\",\"children\":2014}],[\"$\",\"$Lb\",\"2013\",{\"className\":\"layout_navLinkText__bt28R\",\"href\":\"/blog/for/2013\",\"children\":2013}],[\"$\",\"$Lb\",\"2012\",{\"className\":\"layout_navLinkText__bt28R\",\"href\":\"/blog/for/2012\",\"children\":2012}],[\"$\",\"$Lb\",\"2011\",{\"className\":\"layout_navLinkText__bt28R\",\"href\":\"/blog/for/2011\",\"children\":2011}]]]}]}]}],[\"$\",\"div\",null,{\"className\":\"layout_blogPictureContainer__XC7nK\",\"children\":[\"$\",\"$Lf\",null,{\"className\":\"layout_blogTopPicture__RJHNN\",\"alt\":\"Patrick Desjardins picture from a conference\",\"src\":\"/images/backgrounds/patrickdesjardins_conference_bw.jpeg\",\"width\":800,\"height\":260}]}],[\"$\",\"main\",null,{\"className\":\"layout_main__mXTwS\",\"children\":[[\"$\",\"h1\",null,{\"children\":\"How to use Kubernetes with Microsoft Azure and GitHub and how to debug if it does not workout\"}],[\"$\",\"div\",null,{\"className\":\"layout_blogPostContainer__WYELx\",\"children\":[[\"$\",\"p\",null,{\"className\":\"layout_blogPostDate__LUvx5\",\"children\":[\"Posted on: \",\"2022-07-28\"]}],[[\"$\",\"p\",null,{\"children\":\"Kubernetes is a convenient way to deploy an infrastructure of services in a central place. Once you have your service Docker images built and deployed you can use Kubernetes to deploy multiple instances across the cloud. In this article, we will see how Microsoft Azure can use a Kubernetes configuration generated with Helm and deploy many images from Azure Registry Container.\"}],\"\\n\",[\"$\",\"h1\",null,{\"children\":\"Create an Azure Kubernetes Service (AKS)\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"There are two ways to create a Azure Kubernetes Services: Azure Cli and Azure Portal.\"}],\"\\n\",[\"$\",\"h2\",null,{\"children\":\"Azure Cli\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"A few pieces of information is required that were built when we created our Azure Docker Image Repository.\\nYou need to use the Azure resource group name after \",[\"$\",\"span\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"plaintext\",\"data-theme\":\"github-light\",\"style\":{\"backgroundColor\":\"#fff\",\"color\":\"#24292e\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"--resource-group\"}]}]}]}],\". The name of the Kubernetes service is after \",[\"$\",\"span\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"plaintext\",\"data-theme\":\"github-light\",\"style\":{\"backgroundColor\":\"#fff\",\"color\":\"#24292e\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"--name\"}]}]}]}],\". The \",[\"$\",\"span\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"plaintext\",\"data-theme\":\"github-light\",\"style\":{\"backgroundColor\":\"#fff\",\"color\":\"#24292e\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"--attach-acr\"}]}]}]}],\" is the name of the Azure Container Registry (acr).\"]}],\"\\n\",[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"backgroundColor\":\"#fff\",\"color\":\"#24292e\"},\"tabIndex\":\"0\",\"data-language\":\"plaintext\",\"data-theme\":\"github-light\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"plaintext\",\"data-theme\":\"github-light\",\"style\":{\"display\":\"grid\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"az aks create --resource-group realtimepixel_resourcegroup --name realpixelask --location eastus --attach-acr realtimepixel --generate-ssh-keys\"}]}]}]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"There are a few things to know:\"}],\"\\n\",[\"$\",\"ol\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":\"The name cannot have an underscore. Even if you enclose with double quote, it does not work\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"The command takes a while to run. Expect at least 1 minute.\"}],\"\\n\"]}],\"\\n\",[\"$\",\"h2\",null,{\"children\":\"Azure Portal\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Many online tutorials show the Azure CLI (\",[\"$\",\"span\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"plaintext\",\"data-theme\":\"github-light\",\"style\":{\"backgroundColor\":\"#fff\",\"color\":\"#24292e\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"az\"}]}]}]}],\" command), but it is also possible to create the Kubernetes service on the Microsoft Azure Portal.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"img\",null,{\"src\":\"/images/blog/azure_kbs_creation.png\",\"alt\":\"\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"I personally prefer to use a web interface. For creating a Kubernetes cluster, the Azure Portal guides you through several steps, which in my opinion worth doing that step that you will rarely do compared to operation Azure CLI command.\"}],\"\\n\",[\"$\",\"h1\",null,{\"children\":\"Configure Github Workflow\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"You can edit the existing Github workflow defined \",[\"$\",\"a\",null,{\"href\":\"./azure-docker-container-repository-github\",\"children\":\"previously\"}],\" that was building the image and pushing it into Azure Container Registry (ACR). However, I created a new workflow to manually decide when to push the image into production.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Here is the entire Github workflow that I store in the repository in \",[\"$\",\"span\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"plaintext\",\"data-theme\":\"github-light\",\"style\":{\"backgroundColor\":\"#fff\",\"color\":\"#24292e\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\".github/workflows/k8sdeploy.yml\"}]}]}]}]]}],\"\\n\",[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"backgroundColor\":\"#fff\",\"color\":\"#24292e\"},\"tabIndex\":\"0\",\"data-language\":\"plaintext\",\"data-theme\":\"github-light\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"plaintext\",\"data-theme\":\"github-light\",\"style\":{\"display\":\"grid\"},\"children\":[[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"name: Kubernetes Prod Deployment\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"on:\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"  workflow_dispatch:\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":\" \"}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"# Environment variables available to all jobs and steps in this workflow\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"env:\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"  REGISTRY_NAME: realtimepixel\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"  CLUSTER_NAME: realpixelask2\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"  CLUSTER_RESOURCE_GROUP: realtimepixel_resourcegroup\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"  NAMESPACE: realtimepixel-prod\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":\" \"}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"jobs:\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"  build:\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"    runs-on: ubuntu-latest\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"    steps:\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"      - uses: actions/checkout@main\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":\" \"}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"      # Set the target Azure Kubernetes Service (AKS) cluster.\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"      - uses: azure/aks-set-context@v1\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"        with:\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"          creds: ${{ secrets.AZURE_CREDENTIALS }}\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"          cluster-name: ${{ env.CLUSTER_NAME }}\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"          resource-group: ${{ env.CLUSTER_RESOURCE_GROUP }}\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":\" \"}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"      # Create namespace if doesn't exist\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"      - run: |\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"          kubectl create namespace ${{ env.NAMESPACE }} --dry-run=client -o json | kubectl apply -f -\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":\" \"}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"      - name: Helm tool installer\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"        uses: Azure/setup-helm@v1\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":\" \"}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"      - name: Azure Login\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"        uses: Azure/login@v1.1\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"        with:\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"          creds: ${{ secrets.AZURE_CREDENTIALS }}\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":\" \"}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"      - name: Get Latest Tag Redis\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"        id: latesttagredis\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"        run: |\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"          tag_redis=$(az acr repository show-tags --name ${{env.REGISTRY_NAME}} --repository realtimepixel_redis --top 1 --orderby time_desc -o tsv)\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"          echo \\\"::set-output name=tag_redis::$tag_redis\\\"\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"      \"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"      - name: Tag Redis\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"        run: echo \\\"Tag Redis is ${{ steps.latesttagredis.outputs.tag_redis }}\\\"\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":\" \"}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"      - name: Get Latest Tag Backend\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"        id: latesttagbackend\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"        run: |\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"          tag_backend=$(az acr repository show-tags --name ${{env.REGISTRY_NAME}} --repository realtimepixel_backend --top 1 --orderby time_desc -o tsv)\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"          echo \\\"::set-output name=tag_backend::$tag_backend\\\"\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":\" \"}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"      - name: Tag Backend\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"        run: echo \\\"Tag Backend is ${{ steps.latesttagbackend.outputs.tag_backend }}\\\"\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"      \"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"      - name: Get Latest Tag Frontend\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"        id: latesttagfrontend\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"        run: |\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"          tag_frontend=$(az acr repository show-tags --name ${{env.REGISTRY_NAME}} --repository realtimepixel_frontend --top 1 --orderby time_desc -o tsv)\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"          echo \\\"::set-output name=tag_frontend::$tag_frontend\\\"\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":\" \"}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"      - name: Tag Frontend\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"        run: echo \\\"Tag Frontend is ${{ steps.latesttagfrontend.outputs.tag_frontend }}\\\"\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":\" \"}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"      - name: Deploy\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"        run: \u003e\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"          helm upgrade realtimepixel ./kubernetes/realtimepixel \"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"          --install \"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"          --namespace=${{ env.NAMESPACE }} \"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"          --set namespace=${{env.NAMESPACE}}\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"          --set image.pullPolicy=Always\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"          --set image.redis.repository=${{env.REGISTRY_NAME}}.azurecr.io/realtimepixel_redis\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"          --set image.redis.tag=${{ steps.latesttagredis.outputs.tag_redis }}\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"          --set image.backend.repository=${{env.REGISTRY_NAME}}.azurecr.io/realtimepixel_backend\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"          --set image.backend.tag=${{ steps.latesttagbackend.outputs.tag_backend }}\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"          --set image.frontend.repository=${{env.REGISTRY_NAME}}.azurecr.io/realtimepixel_frontend\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"          --set image.frontend.tag=${{ steps.latesttagfrontend.outputs.tag_frontend }}\"}]}]]}]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Here is a description of what is going on:\"}],\"\\n\",[\"$\",\"ol\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[\"\\n\",[\"$\",\"p\",null,{\"children\":[\"The first section, called \",[\"$\",\"span\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"plaintext\",\"data-theme\":\"github-light\",\"style\":{\"backgroundColor\":\"#fff\",\"color\":\"#24292e\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"env\"}]}]}]}],\", is variable that can be used across the workflow. It is a simple way to configure data in a central place for the script. It defined the registry (Azure Container Registry) name, the Kubernetes cluster name created in this blog post, the Azure resource group (previous article), and the Kubernetes namespace.\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"\\n\",[\"$\",\"p\",null,{\"children\":\"The second section connects to AKS: Azure Kubernetes Service\"}],\"\\n\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"\\n\",[\"$\",\"p\",null,{\"children\":\"We create the namespace\"}],\"\\n\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"\\n\",[\"$\",\"p\",null,{\"children\":\"We then connect with Helm and Azure Login. From now, we are ready to perform some commands\"}],\"\\n\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"\\n\",[\"$\",\"p\",null,{\"children\":\"First, we get the latest image tag for each image\"}],\"\\n\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Finally, we use \",[\"$\",\"strong\",null,{\"children\":\"Helm\"}],\" to install or update the Kubernetes configuration. What is important is to override a lot of values from \",[\"$\",\"span\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"plaintext\",\"data-theme\":\"github-light\",\"style\":{\"backgroundColor\":\"#fff\",\"color\":\"#24292e\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"kubernetes\\\\realtimepixel\\\\values.yaml\"}]}]}]}],\" (Helm values file)\"]}],\"\\n\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"h1\",null,{\"children\":\"Verification\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"At this point, the Helm command pushes the instruction to Azure Kubernetes Service. Going in the portal you can see under \",[\"$\",\"span\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"plaintext\",\"data-theme\":\"github-light\",\"style\":{\"backgroundColor\":\"#fff\",\"color\":\"#24292e\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"Workloads\"}]}]}]}],\" the deployment.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"img\",null,{\"src\":\"/images/blog/azure_k8s_workloads.png\",\"alt\":\"\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Everything should be running as expected! The screenshot shows three orange symbols next to my three deployments because there is an issue with the Kubernetes configuration, which is outside the goal of this post. However, it is still interesting to know that you can drill and see the error reason being: \",[\"$\",\"span\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"plaintext\",\"data-theme\":\"github-light\",\"style\":{\"backgroundColor\":\"#fff\",\"color\":\"#24292e\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"ErrImageNeverPull\"}]}]}]}],\".\"]}],\"\\n\",[\"$\",\"h2\",null,{\"children\":\"Debug Azure Kubernetes ErrImageNeverPull\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"The first steps are to access the reason the image is not pulling. You need to get one of the pods under the deployment that is falling.\"}],\"\\n\",[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"backgroundColor\":\"#fff\",\"color\":\"#24292e\"},\"tabIndex\":\"0\",\"data-language\":\"plaintext\",\"data-theme\":\"github-light\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"plaintext\",\"data-theme\":\"github-light\",\"style\":{\"display\":\"grid\"},\"children\":[[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"kubectl get pods -n realtimepixel-prod\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"kubectl describe pod redis-deployment-6495cd48cc-fhzjg -n realtimepixel-prod\"}]}]]}]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"The last command gives more information saying the policy is to \",[\"$\",\"span\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"plaintext\",\"data-theme\":\"github-light\",\"style\":{\"backgroundColor\":\"#fff\",\"color\":\"#24292e\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"Never\"}]}]}]}]]}],\"\\n\",[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"backgroundColor\":\"#fff\",\"color\":\"#24292e\"},\"tabIndex\":\"0\",\"data-language\":\"plaintext\",\"data-theme\":\"github-light\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"plaintext\",\"data-theme\":\"github-light\",\"style\":{\"display\":\"grid\"},\"children\":[[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"Events:\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"Type     Reason             Age                    From               Message\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"----     ------             ----                   ----               -------\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"Normal   Scheduled          59m                    default-scheduler  Successfully assigned realtimepixel-prod/redis-deployment-6495cd48cc-fhzjg to aks-agentpool-28884595-vmss000002\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"Warning  Failed             57m (x12 over 59m)     kubelet            Error: ErrImageNeverPull\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"Warning  ErrImageNeverPull  4m36s (x260 over 59m)  kubelet            Container image \\\"realtimepixel.azurecr.io/realtimepixel_redis:67dfbf27b868bd0b9e7c77aefafb596f2adb3ca0\\\" is not present with pull policy of Never\"}]}]]}]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"So, once we know the problem is the \",[\"$\",\"span\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"plaintext\",\"data-theme\":\"github-light\",\"style\":{\"backgroundColor\":\"#fff\",\"color\":\"#24292e\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"Never\"}]}]}]}],\", we can see what is happening between Helm and Azure Kubernetes. Trying to see what is sent to Kubernetes is by using the \",[\"$\",\"span\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"plaintext\",\"data-theme\":\"github-light\",\"style\":{\"backgroundColor\":\"#fff\",\"color\":\"#24292e\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"template\"}]}]}]}],\" command of Helm.\"]}],\"\\n\",[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"backgroundColor\":\"#fff\",\"color\":\"#24292e\"},\"tabIndex\":\"0\",\"data-language\":\"plaintext\",\"data-theme\":\"github-light\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"plaintext\",\"data-theme\":\"github-light\",\"style\":{\"display\":\"grid\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"helm template realtimepixel ./kubernetes/realtimepixel --set namespace=realtimepixel-prod --set image.pullPolicy=Always --set image.redis.repository=realtimepixel.azurecr.io/realtimepixel_redis --set image.redis.tag=123123 --set image.backend.repository=realtimepixel.azurecr.io/realtimepixel_backend --set image.backend.tag=123123 --set image.frontend.repository=realtimepixel.azurecr.io/realtimepixel_frontend --set image.frontend.tag=123123 \u003e temp.yaml\"}]}]}]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"I found a case-sensitive issue with the \",[\"$\",\"span\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"plaintext\",\"data-theme\":\"github-light\",\"style\":{\"backgroundColor\":\"#fff\",\"color\":\"#24292e\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"image.pullPolicy\"}]}]}]}],\" where the \",[\"$\",\"span\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"plaintext\",\"data-theme\":\"github-light\",\"style\":{\"backgroundColor\":\"#fff\",\"color\":\"#24292e\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"p\"}]}]}]}],\" was lowercase and needed to be uppercase.\"]}],\"\\n\",[\"$\",\"h2\",null,{\"children\":\"How to Debug with Azure Kubernetes Containers\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"The first issue was out of the way, and a second appeared. This time, the Azure Kubernetes was showing the pods having a \",[\"$\",\"span\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"plaintext\",\"data-theme\":\"github-light\",\"style\":{\"backgroundColor\":\"#fff\",\"color\":\"#24292e\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"CrashLoopBackOff\"}]}]}]}],\".There is a command to get the health of all your pods. In my case, some of them were crashing:\"]}],\"\\n\",[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"backgroundColor\":\"#fff\",\"color\":\"#24292e\"},\"tabIndex\":\"0\",\"data-language\":\"plaintext\",\"data-theme\":\"github-light\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"plaintext\",\"data-theme\":\"github-light\",\"style\":{\"display\":\"grid\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"kubectl get pods -n realtimepixel-prod\"}]}]}]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Resulted with:\"}],\"\\n\",[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"backgroundColor\":\"#fff\",\"color\":\"#24292e\"},\"tabIndex\":\"0\",\"data-language\":\"plaintext\",\"data-theme\":\"github-light\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"plaintext\",\"data-theme\":\"github-light\",\"style\":{\"display\":\"grid\"},\"children\":[[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"NAME                                   READY   STATUS             RESTARTS         AGE\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"backend-deployment-69c99548d9-g2w5d    0/1     CrashLoopBackOff   10 (3m28s ago)   30m\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"backend-deployment-69c99548d9-wrhzp    0/1     CrashLoopBackOff   10 (3m42s ago)   30m\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"backend-deployment-7dfbc4f7f8-m99kl    0/1     CrashLoopBackOff   10 (3m51s ago)   109m\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"backend-deployment-7dfbc4f7f8-vbp24    0/1     CrashLoopBackOff   10 (4m4s ago)    109m\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"frontend-deployment-6f88fdb587-2p2lk   1/1     Running            0                30m\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"redis-deployment-5d48cc44bd-8w869      1/1     Running            0                30m\"}]}]]}]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"It is possible to see the logs of the deployment:\"}],\"\\n\",[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"backgroundColor\":\"#fff\",\"color\":\"#24292e\"},\"tabIndex\":\"0\",\"data-language\":\"plaintext\",\"data-theme\":\"github-light\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"plaintext\",\"data-theme\":\"github-light\",\"style\":{\"display\":\"grid\"},\"children\":[[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"kubectl describe pod backend-deployment-69c99548d9-g2w5d -n realtimepixel-prod\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"kubectl logs backend-deployment-69c99548d9-g2w5d -n realtimepixel-prod\"}]}]]}]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"The output:\"}],\"\\n\",[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"backgroundColor\":\"#fff\",\"color\":\"#24292e\"},\"tabIndex\":\"0\",\"data-language\":\"plaintext\",\"data-theme\":\"github-light\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"plaintext\",\"data-theme\":\"github-light\",\"style\":{\"display\":\"grid\"},\"children\":[[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"\u003e start:production\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"\u003e node -r ts-node/register/transpile-only -r tsconfig-paths/register build/backend/src/index.js\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":\" \"}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"Error: Cannot find module '/node/build/backend/src/index.js'\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"    at Function.Module._resolveFilename (node:internal/modules/cjs/loader:933:15)\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"    at Function.Module._resolveFilename.sharedData.moduleResolveFilenameHook.installedValue (/node/node_modules/@cspotcode/source-map-support/source-map-support.js:679:30)\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"    at Function.Module._resolveFilename (/node/node_modules/tsconfig-paths/src/register.ts:90:36)\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"    at Function.Module._load (node:internal/modules/cjs/loader:778:27)\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"    at Function.executeUserEntryPoint [as runMain] (node:internal/modules/run_main:77:12)\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"    at node:internal/main/run_main_module:17:47 {\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"  code: 'MODULE_NOT_FOUND',\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"  requireStack: []\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"}\"}]}]]}]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"My instinct was to get into the container.\"}],\"\\n\",[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"backgroundColor\":\"#fff\",\"color\":\"#24292e\"},\"tabIndex\":\"0\",\"data-language\":\"plaintext\",\"data-theme\":\"github-light\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"plaintext\",\"data-theme\":\"github-light\",\"style\":{\"display\":\"grid\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"kubectl exec -it backend-deployment-69c99548d9-g2w5d -n realtimepixel-prod -- sh\"}]}]}]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"But was producing:\"}],\"\\n\",[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"backgroundColor\":\"#fff\",\"color\":\"#24292e\"},\"tabIndex\":\"0\",\"data-language\":\"plaintext\",\"data-theme\":\"github-light\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"plaintext\",\"data-theme\":\"github-light\",\"style\":{\"display\":\"grid\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\" error: unable to upgrade connection: container not found...\"}]}]}]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"The problem is that the issue is on the \",[\"$\",\"span\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"plaintext\",\"data-theme\":\"github-light\",\"style\":{\"backgroundColor\":\"#fff\",\"color\":\"#24292e\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"run\"}]}]}]}],\" command of the container that is failing because the starting file (index.js) is not present. However, because it cannot start the command, the container closes not letting me accessing the container to inspect the folder structures and files.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"You can test it by creating a Pod for the problematic image that will not restart using the following commands:\"}],\"\\n\",[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"backgroundColor\":\"#fff\",\"color\":\"#24292e\"},\"tabIndex\":\"0\",\"data-language\":\"plaintext\",\"data-theme\":\"github-light\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"plaintext\",\"data-theme\":\"github-light\",\"style\":{\"display\":\"grid\"},\"children\":[[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"kubectl run debug-demo -n realtimepixel-prod --image=realtimepixel.azurecr.io/realtimepixel_backend:67dfbf27b868bd0b9e7c77aefafb596f2adb3ca0 --restart=Never\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"kubectl get pods -n realtimepixel-prod\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"kubectl exec -it debug-demo -n realtimepixel-prod -- sh\"}]}]]}]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"However, the problem will remain that when the Kube Control runs the image that it will crash. However, the log above provides good information. In my case, I realized two things:\"}],\"\\n\",[\"$\",\"ol\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[\"When testing locally, I wasn't testing correctly. The build was passing because I had a \",[\"$\",\"span\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"plaintext\",\"data-theme\":\"github-light\",\"style\":{\"backgroundColor\":\"#fff\",\"color\":\"#24292e\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"node_modules\"}]}]}]}],\" with a dependency that was installed when performing \",[\"$\",\"span\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"plaintext\",\"data-theme\":\"github-light\",\"style\":{\"backgroundColor\":\"#fff\",\"color\":\"#24292e\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"npm run install\"}]}]}]}],\" which was adding all the \",[\"$\",\"span\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"plaintext\",\"data-theme\":\"github-light\",\"style\":{\"backgroundColor\":\"#fff\",\"color\":\"#24292e\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"devDependencies\"}]}]}]}],\". On Github, performing the same command, with the \",[\"$\",\"span\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"plaintext\",\"data-theme\":\"github-light\",\"style\":{\"backgroundColor\":\"#fff\",\"color\":\"#24292e\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"NODE_ENV\"}]}]}]}],\" to \",[\"$\",\"span\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"plaintext\",\"data-theme\":\"github-light\",\"style\":{\"backgroundColor\":\"#fff\",\"color\":\"#24292e\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"production\"}]}]}]}],\" was causing \",[\"$\",\"span\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"plaintext\",\"data-theme\":\"github-light\",\"style\":{\"backgroundColor\":\"#fff\",\"color\":\"#24292e\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"npm install\"}]}]}]}],\" to install only the \",[\"$\",\"span\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"plaintext\",\"data-theme\":\"github-light\",\"style\":{\"backgroundColor\":\"#fff\",\"color\":\"#24292e\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"dependencies\"}]}]}]}],\" without the \",[\"$\",\"span\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"plaintext\",\"data-theme\":\"github-light\",\"style\":{\"backgroundColor\":\"#fff\",\"color\":\"#24292e\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"devDependencies\"}]}]}]}],\".\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"I added the \",[\"$\",\"span\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"plaintext\",\"data-theme\":\"github-light\",\"style\":{\"backgroundColor\":\"#fff\",\"color\":\"#24292e\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"--target\"}]}]}]}],\" in the build for the multi-stage. I had the impression that it would start the build with the target, but it is saying that it will be the latest. Oddly, using \",[\"$\",\"span\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"plaintext\",\"data-theme\":\"github-light\",\"style\":{\"backgroundColor\":\"#fff\",\"color\":\"#24292e\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"docker-compose\"}]}]}]}],\", the build step is only the one in the target but using the docker command runs the developer portions and the production.\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"h1\",null,{\"children\":\"Still Not Working! What to do next?\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"In my case, it was still not green. Same error about \",[\"$\",\"span\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"plaintext\",\"data-theme\":\"github-light\",\"style\":{\"backgroundColor\":\"#fff\",\"color\":\"#24292e\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"CrashLoopBackOff\"}]}]}]}],\" on the startup of the container. Time to get back locally.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Instead of using \",[\"$\",\"span\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"plaintext\",\"data-theme\":\"github-light\",\"style\":{\"backgroundColor\":\"#fff\",\"color\":\"#24292e\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"docker-compose\"}]}]}]}],\", I decided to mimic what I was doing on the Github workflow.\"]}],\"\\n\",[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"backgroundColor\":\"#fff\",\"color\":\"#24292e\"},\"tabIndex\":\"0\",\"data-language\":\"plaintext\",\"data-theme\":\"github-light\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"plaintext\",\"data-theme\":\"github-light\",\"style\":{\"display\":\"grid\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"docker build -f ./services/backend/Dockerfile --target production --build-arg NODE_ENV=production .\"}]}]}]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Then get the image built and run it.\"}],\"\\n\",[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"backgroundColor\":\"#fff\",\"color\":\"#24292e\"},\"tabIndex\":\"0\",\"data-language\":\"plaintext\",\"data-theme\":\"github-light\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"plaintext\",\"data-theme\":\"github-light\",\"style\":{\"display\":\"grid\"},\"children\":[[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"docker images\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"docker run 40d4941a9092\"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"docker ps\"}]}]]}]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Take the \",[\"$\",\"em\",null,{\"children\":\"image id\"}],\" from the ps command:\"]}],\"\\n\",[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"backgroundColor\":\"#fff\",\"color\":\"#24292e\"},\"tabIndex\":\"0\",\"data-language\":\"plaintext\",\"data-theme\":\"github-light\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"plaintext\",\"data-theme\":\"github-light\",\"style\":{\"display\":\"grid\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"docker run -it 40d4941a9092 bash\"}]}]}]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"I could see the error, but like Kubernetes, the container shut down. So now, time to make the container crash but to hang it there in an infinite loop:\"}],\"\\n\",[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"backgroundColor\":\"#fff\",\"color\":\"#24292e\"},\"tabIndex\":\"0\",\"data-language\":\"plaintext\",\"data-theme\":\"github-light\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"plaintext\",\"data-theme\":\"github-light\",\"style\":{\"display\":\"grid\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"docker run 40d4941a9092 /bin/sh -c \\\"while true; do sleep 2; df -h; done\\\"\"}]}]}]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"In another terminal window, you can connect.\"}],\"\\n\",[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"backgroundColor\":\"#fff\",\"color\":\"#24292e\"},\"tabIndex\":\"0\",\"data-language\":\"plaintext\",\"data-theme\":\"github-light\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"plaintext\",\"data-theme\":\"github-light\",\"style\":{\"display\":\"grid\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"docker run -it 40d4941a9092 bash\"}]}]}]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"At that point, I saw that the build was messing around with the folders of the output of TypeScript. So I modified the path and was good to go.\"}],\"\\n\",[\"$\",\"h1\",null,{\"children\":\"Conclusion\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"At this point, the image was created with a build that was successful.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"img\",null,{\"src\":\"/images/blog/azure_kubernetes_deployement.png\",\"alt\":\"\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"I would say that the experience was enriching. However, one question kept getting in the back of my mind: why isn't the Azure Portal guiding me with more than a single keyword for the failure. As we saw, by messing around with commands, we found the root cause, but some support would have been great. Nonetheless, if something happens to you, now you should be equipped to diagnose a little bit better.\"}],\"\\n\",[\"$\",\"div\",null,{\"children\":[[\"$\",\"h2\",null,{\"children\":\"Azure Blog Posts: Docker Images \u0026 Kubernetes\"}],[\"$\",\"ol\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":[\"$\",\"a\",null,{\"href\":\"azure-docker-container-repository\",\"children\":\"How to host Docker images on Microsoft Azure\"}]}],[\"$\",\"li\",null,{\"children\":[\"$\",\"a\",null,{\"href\":\"azure-docker-container-repository-github\",\"children\":\"How to use Kubernetes with Microsoft Azure and GitHub and how to debug if it does not workout\"}]}],[\"$\",\"li\",null,{\"children\":[\"$\",\"a\",null,{\"href\":\"azure-intro-kubernetes\",\"children\":\"An Introduction to Microsoft Azure and Kubernetes using Helm and Docker Images\"}]}],[\"$\",\"li\",null,{\"children\":[\"$\",\"a\",null,{\"href\":\"azure-kubernetes-public-access\",\"children\":\"How to Access your Web Application on Kubernetes Azure\"}]}],[\"$\",\"li\",null,{\"children\":[\"$\",\"a\",null,{\"href\":\"azure-kubernetes-pod-debug-crash\",\"children\":\"How to Debug a Kubernetes Pod that Crash at Startup (works on Microsoft Azure Kubernetes)?\"}]}],[\"$\",\"li\",null,{\"children\":[\"$\",\"a\",null,{\"href\":\"helpchart-introduction\",\"children\":\"How to use Helm Chart to configure dynamically your Kubernetes file for beginner?\"}]}]]}]]}]]]}]]}],[\"$\",\"div\",null,{\"className\":\"layout_paginationBar__jnuuR\",\"children\":[[\"$\",\"div\",null,{\"className\":\"layout_paginationTitle__PsOw5\",\"children\":\"Chronological Blog Articles by Page\"}],[\"$\",\"div\",null,{\"className\":\"layout_paginationLinks__LdBaH\",\"children\":[[\"$\",\"$Lb\",\"1\",{\"className\":\"\",\"href\":\"/blog/page/1\",\"children\":1}],[\"$\",\"$Lb\",\"2\",{\"className\":\"\",\"href\":\"/blog/page/2\",\"children\":2}],[\"$\",\"$Lb\",\"3\",{\"className\":\"\",\"href\":\"/blog/page/3\",\"children\":3}],[\"$\",\"$Lb\",\"4\",{\"className\":\"\",\"href\":\"/blog/page/4\",\"children\":4}],[\"$\",\"$Lb\",\"5\",{\"className\":\"\",\"href\":\"/blog/page/5\",\"children\":5}],[\"$\",\"$Lb\",\"6\",{\"className\":\"\",\"href\":\"/blog/page/6\",\"children\":6}],[\"$\",\"$Lb\",\"7\",{\"className\":\"\",\"href\":\"/blog/page/7\",\"children\":7}],[\"$\",\"$Lb\",\"8\",{\"className\":\"\",\"href\":\"/blog/page/8\",\"children\":8}],[\"$\",\"$Lb\",\"9\",{\"className\":\"\",\"href\":\"/blog/page/9\",\"children\":9}],[\"$\",\"$Lb\",\"10\",{\"className\":\"\",\"href\":\"/blog/page/10\",\"children\":10}],[\"$\",\"$Lb\",\"11\",{\"className\":\"\",\"href\":\"/blog/page/11\",\"children\":11}],[\"$\",\"$Lb\",\"12\",{\"className\":\"\",\"href\":\"/blog/page/12\",\"children\":12}],[\"$\",\"$Lb\",\"13\",{\"className\":\"\",\"href\":\"/blog/page/13\",\"children\":13}],[\"$\",\"$Lb\",\"14\",{\"className\":\"\",\"href\":\"/blog/page/14\",\"children\":14}],[\"$\",\"$Lb\",\"15\",{\"className\":\"\",\"href\":\"/blog/page/15\",\"children\":15}],[\"$\",\"$Lb\",\"16\",{\"className\":\"\",\"href\":\"/blog/page/16\",\"children\":16}],[\"$\",\"$Lb\",\"17\",{\"className\":\"\",\"href\":\"/blog/page/17\",\"children\":17}],[\"$\",\"$Lb\",\"18\",{\"className\":\"\",\"href\":\"/blog/page/18\",\"children\":18}],[\"$\",\"$Lb\",\"19\",{\"className\":\"\",\"href\":\"/blog/page/19\",\"children\":19}],[\"$\",\"$Lb\",\"20\",{\"className\":\"\",\"href\":\"/blog/page/20\",\"children\":20}],[\"$\",\"$Lb\",\"21\",{\"className\":\"\",\"href\":\"/blog/page/21\",\"children\":21}],[\"$\",\"$Lb\",\"22\",{\"className\":\"\",\"href\":\"/blog/page/22\",\"children\":22}],[\"$\",\"$Lb\",\"23\",{\"className\":\"\",\"href\":\"/blog/page/23\",\"children\":23}],[\"$\",\"$Lb\",\"24\",{\"className\":\"\",\"href\":\"/blog/page/24\",\"children\":24}],[\"$\",\"$Lb\",\"25\",{\"className\":\"\",\"href\":\"/blog/page/25\",\"children\":25}],[\"$\",\"$Lb\",\"26\",{\"className\":\"\",\"href\":\"/blog/page/26\",\"children\":26}],[\"$\",\"$Lb\",\"27\",{\"className\":\"\",\"href\":\"/blog/page/27\",\"children\":27}],[\"$\",\"$Lb\",\"28\",{\"className\":\"\",\"href\":\"/blog/page/28\",\"children\":28}],[\"$\",\"$Lb\",\"29\",{\"className\":\"\",\"href\":\"/blog/page/29\",\"children\":29}],[\"$\",\"$Lb\",\"30\",{\"className\":\"\",\"href\":\"/blog/page/30\",\"children\":30}],[\"$\",\"$Lb\",\"31\",{\"className\":\"\",\"href\":\"/blog/page/31\",\"children\":31}],[\"$\",\"$Lb\",\"32\",{\"className\":\"\",\"href\":\"/blog/page/32\",\"children\":32}],[\"$\",\"$Lb\",\"33\",{\"className\":\"\",\"href\":\"/blog/page/33\",\"children\":33}],[\"$\",\"$Lb\",\"34\",{\"className\":\"\",\"href\":\"/blog/page/34\",\"children\":34}],[\"$\",\"$Lb\",\"35\",{\"className\":\"\",\"href\":\"/blog/page/35\",\"children\":35}],[\"$\",\"$Lb\",\"36\",{\"className\":\"\",\"href\":\"/blog/page/36\",\"children\":36}],[\"$\",\"$Lb\",\"37\",{\"className\":\"\",\"href\":\"/blog/page/37\",\"children\":37}],[\"$\",\"$Lb\",\"38\",{\"className\":\"\",\"href\":\"/blog/page/38\",\"children\":38}],[\"$\",\"$Lb\",\"39\",{\"className\":\"\",\"href\":\"/blog/page/39\",\"children\":39}],[\"$\",\"$Lb\",\"40\",{\"className\":\"\",\"href\":\"/blog/page/40\",\"children\":40}],[\"$\",\"$Lb\",\"41\",{\"className\":\"\",\"href\":\"/blog/page/41\",\"children\":41}],[\"$\",\"$Lb\",\"42\",{\"className\":\"\",\"href\":\"/blog/page/42\",\"children\":42}],[\"$\",\"$Lb\",\"43\",{\"className\":\"\",\"href\":\"/blog/page/43\",\"children\":43}],[\"$\",\"$Lb\",\"44\",{\"className\":\"\",\"href\":\"/blog/page/44\",\"children\":44}],[\"$\",\"$Lb\",\"45\",{\"className\":\"\",\"href\":\"/blog/page/45\",\"children\":45}],[\"$\",\"$Lb\",\"46\",{\"className\":\"\",\"href\":\"/blog/page/46\",\"children\":46}],[\"$\",\"$Lb\",\"47\",{\"className\":\"\",\"href\":\"/blog/page/47\",\"children\":47}],[\"$\",\"$Lb\",\"48\",{\"className\":\"\",\"href\":\"/blog/page/48\",\"children\":48}],[\"$\",\"$Lb\",\"49\",{\"className\":\"\",\"href\":\"/blog/page/49\",\"children\":49}],[\"$\",\"$Lb\",\"50\",{\"className\":\"\",\"href\":\"/blog/page/50\",\"children\":50}],[\"$\",\"$Lb\",\"51\",{\"className\":\"\",\"href\":\"/blog/page/51\",\"children\":51}],[\"$\",\"$Lb\",\"52\",{\"className\":\"\",\"href\":\"/blog/page/52\",\"children\":52}],[\"$\",\"$Lb\",\"53\",{\"className\":\"\",\"href\":\"/blog/page/53\",\"children\":53}],[\"$\",\"$Lb\",\"54\",{\"className\":\"\",\"href\":\"/blog/page/54\",\"children\":54}],[\"$\",\"$Lb\",\"55\",{\"className\":\"\",\"href\":\"/blog/page/55\",\"children\":55}],[\"$\",\"$Lb\",\"56\",{\"className\":\"\",\"href\":\"/blog/page/56\",\"children\":56}],[\"$\",\"$Lb\",\"57\",{\"className\":\"\",\"href\":\"/blog/page/57\",\"children\":57}],[\"$\",\"$Lb\",\"58\",{\"className\":\"\",\"href\":\"/blog/page/58\",\"children\":58}],[\"$\",\"$Lb\",\"59\",{\"className\":\"\",\"href\":\"/blog/page/59\",\"children\":59}],[\"$\",\"$Lb\",\"60\",{\"className\":\"\",\"href\":\"/blog/page/60\",\"children\":60}],[\"$\",\"$Lb\",\"61\",{\"className\":\"\",\"href\":\"/blog/page/61\",\"children\":61}],[\"$\",\"$Lb\",\"62\",{\"className\":\"\",\"href\":\"/blog/page/62\",\"children\":62}],[\"$\",\"$Lb\",\"63\",{\"className\":\"\",\"href\":\"/blog/page/63\",\"children\":63}],[\"$\",\"$Lb\",\"64\",{\"className\":\"\",\"href\":\"/blog/page/64\",\"children\":64}],[\"$\",\"$Lb\",\"65\",{\"className\":\"\",\"href\":\"/blog/page/65\",\"children\":65}],[\"$\",\"$Lb\",\"66\",{\"className\":\"\",\"href\":\"/blog/page/66\",\"children\":66}],[\"$\",\"$Lb\",\"67\",{\"className\":\"\",\"href\":\"/blog/page/67\",\"children\":67}],[\"$\",\"$Lb\",\"68\",{\"className\":\"\",\"href\":\"/blog/page/68\",\"children\":68}],[\"$\",\"$Lb\",\"69\",{\"className\":\"\",\"href\":\"/blog/page/69\",\"children\":69}],[\"$\",\"$Lb\",\"70\",{\"className\":\"\",\"href\":\"/blog/page/70\",\"children\":70}],[\"$\",\"$Lb\",\"71\",{\"className\":\"\",\"href\":\"/blog/page/71\",\"children\":71}],[\"$\",\"$Lb\",\"72\",{\"className\":\"\",\"href\":\"/blog/page/72\",\"children\":72}],[\"$\",\"$Lb\",\"73\",{\"className\":\"\",\"href\":\"/blog/page/73\",\"children\":73}],[\"$\",\"$Lb\",\"74\",{\"className\":\"\",\"href\":\"/blog/page/74\",\"children\":74}],[\"$\",\"$Lb\",\"75\",{\"className\":\"\",\"href\":\"/blog/page/75\",\"children\":75}],[\"$\",\"$Lb\",\"76\",{\"className\":\"\",\"href\":\"/blog/page/76\",\"children\":76}],[\"$\",\"$Lb\",\"77\",{\"className\":\"\",\"href\":\"/blog/page/77\",\"children\":77}]]}]]}]]}]}]\n"])</script><script>self.__next_f.push([1,"c:[[\"$\",\"meta\",\"0\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}],[\"$\",\"meta\",\"1\",{\"charSet\":\"utf-8\"}],[\"$\",\"title\",\"2\",{\"children\":\"Patrick Desjardins Blog - How to use Kubernetes with Microsoft Azure and GitHub and how to debug if it does not workout\"}],[\"$\",\"meta\",\"3\",{\"name\":\"description\",\"content\":\"How to use Kubernetes with Microsoft Azure and GitHub and how to debug if it does not workout\"}],[\"$\",\"meta\",\"4\",{\"name\":\"next-size-adjust\"}]]\n6:null\n"])</script><script>self.__next_f.push([1,""])</script></body></html>