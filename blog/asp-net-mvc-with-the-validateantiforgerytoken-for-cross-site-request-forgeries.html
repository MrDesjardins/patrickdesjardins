<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="preload" href="/_next/static/media/c9a5bc6a7c948fb0-s.p.woff2" as="font" crossorigin="" type="font/woff2"/><link rel="preload" as="image" href="/images/blog/ValidateAntiforgerytoken.png"/><link rel="stylesheet" href="/_next/static/css/4f3d065c9e2d01e0.css" crossorigin="" data-precedence="next"/><link rel="stylesheet" href="/_next/static/css/8ea1dcbe6e4b9929.css" crossorigin="" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/_next/static/chunks/webpack-c94468cbefcc94b8.js" crossorigin=""/><script src="/_next/static/chunks/fd9d1056-cc48c28d170fddc2.js" async="" crossorigin=""></script><script src="/_next/static/chunks/69-c7efea4b65083e7f.js" async="" crossorigin=""></script><script src="/_next/static/chunks/main-app-f550f103b66f998a.js" async="" crossorigin=""></script><script src="/_next/static/chunks/250-d7e0a94ebe194dac.js" async=""></script><script src="/_next/static/chunks/79-2d03397107aae3f1.js" async=""></script><script src="/_next/static/chunks/app/blog/%5Bslug%5D/page-6ef1cad01f05dc10.js" async=""></script><title>Patrick Desjardins Blog - Asp.Net MVC With the ValidateAntiForgeryToken For Cross Site Request Forgeries</title><meta name="description" content="Asp.Net MVC With the ValidateAntiForgeryToken For Cross Site Request Forgeries"/><meta name="next-size-adjust"/><script src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js" crossorigin="" noModule=""></script></head><body class="layout_bodystyle__4ncsS"><div class="__className_aaf875"><div class="layout_container__Tovb9"><header class="layout_siteTitle__k5U8g">Patrick Desjardins Blog</header><nav><ul class="layout_navLinks__mf70r"><li class="layout_navLinkItem__1L8fB"><a class="layout_navLinkText__bt28R" href="/">Main Page</a><a class="layout_navLinkText__bt28R" href="/blog">Blog</a><a class="layout_navLinkText__bt28R" href="/blog/for/2024">2024</a><a class="layout_navLinkText__bt28R" href="/blog/for/2023">2023</a><a class="layout_navLinkText__bt28R" href="/blog/for/2022">2022</a><a class="layout_navLinkText__bt28R" href="/blog/for/2021">2021</a><a class="layout_navLinkText__bt28R" href="/blog/for/2020">2020</a><a class="layout_navLinkText__bt28R" href="/blog/for/2019">2019</a><a class="layout_navLinkText__bt28R" href="/blog/for/2018">2018</a><a class="layout_navLinkText__bt28R" href="/blog/for/2017">2017</a><a class="layout_navLinkText__bt28R" href="/blog/for/2016">2016</a><a class="layout_navLinkText__bt28R" href="/blog/for/2015">2015</a><a class="layout_navLinkText__bt28R" href="/blog/for/2014">2014</a><a class="layout_navLinkText__bt28R" href="/blog/for/2013">2013</a><a class="layout_navLinkText__bt28R" href="/blog/for/2012">2012</a><a class="layout_navLinkText__bt28R" href="/blog/for/2011">2011</a></li></ul></nav><div class="layout_blogPictureContainer__XC7nK"><img alt="Patrick Desjardins picture from a conference" loading="lazy" width="800" height="260" decoding="async" data-nimg="1" class="layout_blogTopPicture__RJHNN" style="color:transparent" src="/images/backgrounds/patrickdesjardins_conference_bw.jpeg"/></div><main class="layout_main__mXTwS"><h1>Asp.Net MVC With the ValidateAntiForgeryToken For Cross Site Request Forgeries</h1><div class="layout_blogPostContainer__WYELx"><p class="layout_blogPostDate__LUvx5">Posted on: <!-- -->2014-01-02</p><p>Cross Site Request Forgeries is also know as CSRF. It is a type of malicious exploit that send commands from a user without his consent to another website. CSRF exploits the trust that a site has in a user&#x27;s browser.
For example, a website could try to execute a form to add something in your Amazon basket! This can be limited by adding an hidden field to a form and a cookie. Both will contain the same value and when the form is submitted the hidden field is compared to the cookie value. If it&#x27;s the same value, we know that the user has sent the form. If it&#x27;s not, we know it&#x27;s a malicious attack.</p>
<p>In Asp.Net MVC, <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-dark-dimmed" style="background-color:#22272e;color:#adbac7"><span data-line=""><span>ValidateAntiForgeryToken</span></span></code></span> is a combination of an html helper (hidden field) and attribute(cookie) that allows to verify if the form as been created and sent by the same user.</p>
<p>The first step is to add the HtmlHelper method <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-dark-dimmed" style="background-color:#22272e;color:#adbac7"><span data-line=""><span>@Html.AntiForgeryToken()</span></span></code></span> inside the form in your view.</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#22272e;color:#adbac7" tabindex="0" data-language="csharp" data-theme="github-dark-dimmed"><code data-language="csharp" data-theme="github-dark-dimmed" style="display:grid"><span data-line=""><span style="color:#DCBDFB">@using</span><span style="color:#ADBAC7"> (Html.</span><span style="color:#DCBDFB">BeginForm</span><span style="color:#ADBAC7">()) { @Html.</span><span style="color:#DCBDFB">AntiForgeryToken</span><span style="color:#ADBAC7">() </span><span style="color:#768390">//... </span></span></code></pre></figure>
<p>This generate an hidden field with the name <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-dark-dimmed" style="background-color:#22272e;color:#adbac7"><span data-line=""><span>__RequestVerificationToken</span></span></code></span> and an unique value. This is an example of the output generated:</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#22272e;color:#adbac7" tabindex="0" data-language="html" data-theme="github-dark-dimmed"><code data-language="html" data-theme="github-dark-dimmed" style="display:grid"><span data-line=""><span style="color:#ADBAC7">&lt;</span><span style="color:#8DDB8C">form</span><span style="color:#6CB6FF"> action</span><span style="color:#ADBAC7">=</span><span style="color:#96D0FF">&quot;/House/Create&quot;</span><span style="color:#6CB6FF"> method</span><span style="color:#ADBAC7">=</span><span style="color:#96D0FF">&quot;post&quot;</span><span style="color:#6CB6FF"> novalidate</span><span style="color:#ADBAC7">=</span><span style="color:#96D0FF">&quot;novalidate&quot;</span><span style="color:#ADBAC7">&gt; </span></span>
<span data-line=""><span style="color:#ADBAC7">  &lt;</span><span style="color:#8DDB8C">input</span><span style="color:#6CB6FF"> name</span><span style="color:#ADBAC7">=</span><span style="color:#96D0FF">&quot;__RequestVerificationToken&quot;</span><span style="color:#6CB6FF"> type</span><span style="color:#ADBAC7">=</span><span style="color:#96D0FF">&quot;hidden&quot;</span><span style="color:#6CB6FF"> value</span><span style="color:#ADBAC7">=</span><span style="color:#96D0FF">&quot;KPyzBk0KGpjStJR96AVI38AbBujBInJNB-1XH-RwsbuifwgmxnGiF-0R2cMHjcYBiz7yOBUnv0fZwoE2oBwiuKXalBDvsRr2RRG7nmkOsq41&quot;</span><span style="color:#ADBAC7">&gt; </span></span></code></pre></figure>
<p>The code behind the html helper is simple. It creates a MvcHtmlString from the AntiForgery class.</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#22272e;color:#adbac7" tabindex="0" data-language="csharp" data-theme="github-dark-dimmed"><code data-language="csharp" data-theme="github-dark-dimmed" style="display:grid"><span data-line=""><span style="color:#F47067">public</span><span style="color:#F69D50"> MvcHtmlString</span><span style="color:#DCBDFB"> AntiForgeryToken</span><span style="color:#ADBAC7">() { </span></span>
<span data-line=""><span style="color:#F47067">  return</span><span style="color:#F47067"> new</span><span style="color:#F69D50"> MvcHtmlString</span><span style="color:#ADBAC7">(AntiForgery.</span><span style="color:#DCBDFB">GetHtml</span><span style="color:#ADBAC7">().</span><span style="color:#DCBDFB">ToString</span><span style="color:#ADBAC7">()); </span></span>
<span data-line=""><span style="color:#ADBAC7">} </span></span></code></pre></figure>
<p>The <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-dark-dimmed" style="background-color:#22272e;color:#adbac7"><span data-line=""><span>AntiForgery</span></span></code></span> class contains the <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-dark-dimmed" style="background-color:#22272e;color:#adbac7"><span data-line=""><span>GetHtml()</span></span></code></span> used in the html helper but also some validation of the forgery. Both use the class <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-dark-dimmed" style="background-color:#22272e;color:#adbac7"><span data-line=""><span>AntiForgeryWorker</span></span></code></span>.</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#22272e;color:#adbac7" tabindex="0" data-language="csharp" data-theme="github-dark-dimmed"><code data-language="csharp" data-theme="github-dark-dimmed" style="display:grid"><span data-line=""><span style="color:#F47067">public</span><span style="color:#F47067"> static</span><span style="color:#F69D50"> HtmlString</span><span style="color:#DCBDFB"> GetHtml</span><span style="color:#ADBAC7">() { </span></span>
<span data-line=""><span style="color:#F47067">  if</span><span style="color:#ADBAC7"> (HttpContext.Current </span><span style="color:#F47067">==</span><span style="color:#6CB6FF"> null</span><span style="color:#ADBAC7">) </span></span>
<span data-line=""><span style="color:#F47067">    throw</span><span style="color:#F47067"> new</span><span style="color:#F69D50"> ArgumentException</span><span style="color:#ADBAC7">(WebPageResources.HttpContextUnavailable); </span></span>
<span data-line=""><span style="color:#F47067">  else</span><span style="color:#ADBAC7"> </span></span>
<span data-line=""><span style="color:#F47067">    return</span><span style="color:#ADBAC7"> AntiForgery._worker.</span><span style="color:#DCBDFB">GetFormInputElement</span><span style="color:#ADBAC7">((</span><span style="color:#F69D50">HttpContextBase</span><span style="color:#ADBAC7">) </span><span style="color:#F47067">new</span><span style="color:#F69D50"> HttpContextWrapper</span><span style="color:#ADBAC7">(HttpContext.Current)).</span><span style="color:#DCBDFB">ToHtmlString</span><span style="color:#ADBAC7">(TagRenderMode.SelfClosing); </span></span>
<span data-line=""><span style="color:#ADBAC7">} </span></span></code></pre></figure>
<p>The worker that we see in the code above is of type <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-dark-dimmed" style="background-color:#22272e;color:#adbac7"><span data-line=""><span>AntiForgeryWorker</span></span></code></span>. This class is about 139 lines and the core of it is the <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-dark-dimmed" style="background-color:#22272e;color:#adbac7"><span data-line=""><span>GetFormInputElement</span></span></code></span> used by the <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-dark-dimmed" style="background-color:#22272e;color:#adbac7"><span data-line=""><span>GetHtml</span></span></code></span>.</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#22272e;color:#adbac7" tabindex="0" data-language="csharp" data-theme="github-dark-dimmed"><code data-language="csharp" data-theme="github-dark-dimmed" style="display:grid"><span data-line=""><span style="color:#F47067"> public</span><span style="color:#F69D50"> TagBuilder</span><span style="color:#DCBDFB"> GetFormInputElement</span><span style="color:#ADBAC7">(</span><span style="color:#F69D50">HttpContextBase</span><span style="color:#F69D50"> httpContext</span><span style="color:#ADBAC7">) { </span></span>
<span data-line=""><span style="color:#6CB6FF">  this</span><span style="color:#ADBAC7">.</span><span style="color:#DCBDFB">CheckSSLConfig</span><span style="color:#ADBAC7">(httpContext); </span></span>
<span data-line=""><span style="color:#F69D50">  AntiForgeryToken</span><span style="color:#F69D50"> cookieTokenNoThrow</span><span style="color:#F47067"> =</span><span style="color:#6CB6FF"> this</span><span style="color:#ADBAC7">.</span><span style="color:#DCBDFB">GetCookieTokenNoThrow</span><span style="color:#ADBAC7">(httpContext); </span></span>
<span data-line=""><span style="color:#F69D50">  AntiForgeryToken</span><span style="color:#F69D50"> newCookieToken</span><span style="color:#ADBAC7">; </span></span>
<span data-line=""><span style="color:#F69D50">  AntiForgeryToken</span><span style="color:#F69D50"> formToken</span><span style="color:#ADBAC7">; </span></span>
<span data-line=""><span style="color:#6CB6FF">  this</span><span style="color:#ADBAC7">.</span><span style="color:#DCBDFB">GetTokens</span><span style="color:#ADBAC7">(httpContext, cookieTokenNoThrow, </span><span style="color:#F47067">out</span><span style="color:#ADBAC7"> newCookieToken, </span><span style="color:#F47067">out</span><span style="color:#ADBAC7"> formToken); </span></span>
<span data-line=""><span style="color:#F47067">  if</span><span style="color:#ADBAC7"> (newCookieToken </span><span style="color:#F47067">!=</span><span style="color:#6CB6FF"> null</span><span style="color:#ADBAC7">) </span></span>
<span data-line=""><span style="color:#6CB6FF">    this</span><span style="color:#ADBAC7">._tokenStore.</span><span style="color:#DCBDFB">SaveCookieToken</span><span style="color:#ADBAC7">(httpContext, newCookieToken); </span></span>
<span data-line=""><span style="color:#F47067">  if</span><span style="color:#ADBAC7"> (</span><span style="color:#F47067">!</span><span style="color:#6CB6FF">this</span><span style="color:#ADBAC7">._config.SuppressXFrameOptionsHeader) </span></span>
<span data-line=""><span style="color:#ADBAC7">    httpContext.Response.</span><span style="color:#DCBDFB">AddHeader</span><span style="color:#ADBAC7">(</span><span style="color:#96D0FF">&quot;X-Frame-Options&quot;</span><span style="color:#ADBAC7">, </span><span style="color:#96D0FF">&quot;SAMEORIGIN&quot;</span><span style="color:#ADBAC7">); </span></span>
<span data-line=""><span style="color:#F69D50">  TagBuilder</span><span style="color:#F69D50"> tagBuilder</span><span style="color:#F47067"> =</span><span style="color:#F47067"> new</span><span style="color:#F69D50"> TagBuilder</span><span style="color:#ADBAC7">(</span><span style="color:#96D0FF">&quot;input&quot;</span><span style="color:#ADBAC7">); </span></span>
<span data-line=""><span style="color:#ADBAC7">  tagBuilder.Attributes[</span><span style="color:#96D0FF">&quot;type&quot;</span><span style="color:#ADBAC7">] </span><span style="color:#F47067">=</span><span style="color:#96D0FF"> &quot;hidden&quot;</span><span style="color:#ADBAC7">; </span></span>
<span data-line=""><span style="color:#ADBAC7">  tagBuilder.Attributes[</span><span style="color:#96D0FF">&quot;name&quot;</span><span style="color:#ADBAC7">] </span><span style="color:#F47067">=</span><span style="color:#6CB6FF"> this</span><span style="color:#ADBAC7">._config.FormFieldName; </span></span>
<span data-line=""><span style="color:#ADBAC7">  tagBuilder.Attributes[</span><span style="color:#96D0FF">&quot;value&quot;</span><span style="color:#ADBAC7">] </span><span style="color:#F47067">=</span><span style="color:#6CB6FF"> this</span><span style="color:#ADBAC7">._serializer.</span><span style="color:#DCBDFB">Serialize</span><span style="color:#ADBAC7">(formToken); </span></span>
<span data-line=""><span style="color:#F47067">  return</span><span style="color:#ADBAC7"> tagBuilder; } </span></span></code></pre></figure>
<p>This is interesting to see how the value is generated. As we can see, it&#x27;s using the serializer to serialize the form token. The form token is build inside the class TokenValidator that take some property of the Identity. I won&#x27;t go deeper because it goes a little beyond the scope of the article. Just remember that the token is unique for the user. However, the GetFormInputElement code above is also important for something else. The token store role is to create the cookie which set also the token.</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#22272e;color:#adbac7" tabindex="0" data-language="csharp" data-theme="github-dark-dimmed"><code data-language="csharp" data-theme="github-dark-dimmed" style="display:grid"><span data-line=""><span style="color:#F47067">public</span><span style="color:#F47067"> void</span><span style="color:#DCBDFB"> SaveCookieToken</span><span style="color:#ADBAC7">(</span><span style="color:#F69D50">HttpContextBase</span><span style="color:#F69D50"> httpContext</span><span style="color:#ADBAC7">, </span><span style="color:#F69D50">AntiForgeryToken</span><span style="color:#F69D50"> token</span><span style="color:#ADBAC7">) { </span></span>
<span data-line=""><span style="color:#F69D50">  HttpCookie</span><span style="color:#F69D50"> cookie</span><span style="color:#F47067"> =</span><span style="color:#F47067"> new</span><span style="color:#F69D50"> HttpCookie</span><span style="color:#ADBAC7">(</span><span style="color:#6CB6FF">this</span><span style="color:#ADBAC7">._config.CookieName, </span><span style="color:#6CB6FF">this</span><span style="color:#ADBAC7">._serializer.</span><span style="color:#DCBDFB">Serialize</span><span style="color:#ADBAC7">(token)) { </span></span>
<span data-line=""><span style="color:#ADBAC7">    HttpOnly </span><span style="color:#F47067">=</span><span style="color:#6CB6FF"> true</span><span style="color:#ADBAC7"> </span></span>
<span data-line=""><span style="color:#ADBAC7">  }; </span></span>
<span data-line=""><span style="color:#F47067">  if</span><span style="color:#ADBAC7"> (</span><span style="color:#6CB6FF">this</span><span style="color:#ADBAC7">._config.RequireSSL) </span></span>
<span data-line=""><span style="color:#ADBAC7">    cookie.Secure </span><span style="color:#F47067">=</span><span style="color:#6CB6FF"> true</span><span style="color:#ADBAC7">;</span></span>
<span data-line=""><span style="color:#ADBAC7">  httpContext.Response.Cookies.</span><span style="color:#DCBDFB">Set</span><span style="color:#ADBAC7">(cookie); </span></span>
<span data-line=""><span style="color:#ADBAC7">} </span></span></code></pre></figure>
<p>The way the <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-dark-dimmed" style="background-color:#22272e;color:#adbac7"><span data-line=""><span>ValidateAntiForgeryToken</span></span></code></span> attribute works is by checking to see that the cookie and hidden form field left by the <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-dark-dimmed" style="background-color:#22272e;color:#adbac7"><span data-line=""><span>Html.AntiForgeryToken()</span></span></code></span> Html Helper essentially exists and match. If they do not exist or match, it throws an <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-dark-dimmed" style="background-color:#22272e;color:#adbac7"><span data-line=""><span>HttpAntiForgeryException</span></span></code></span>.</p>
<p><img src="/images/blog/ValidateAntiforgerytoken.png" alt=""/></p>
<p>The attribute does have a <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-dark-dimmed" style="background-color:#22272e;color:#adbac7"><span data-line=""><span>ValidateAntiForgeryTokenAttribute</span></span></code></span> method that call the <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-dark-dimmed" style="background-color:#22272e;color:#adbac7"><span data-line=""><span>AntiForgery</span></span></code></span> class. I have previously mentioned that it has not only the method to get the input but also for validation. Here is where it&#x27;s used.</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#22272e;color:#adbac7" tabindex="0" data-language="csharp" data-theme="github-dark-dimmed"><code data-language="csharp" data-theme="github-dark-dimmed" style="display:grid"><span data-line=""><span style="color:#F47067"> public</span><span style="color:#DCBDFB"> ValidateAntiForgeryTokenAttribute</span><span style="color:#ADBAC7">() </span><span style="color:#F47067">:</span><span style="color:#6CB6FF"> this</span><span style="color:#ADBAC7">(</span><span style="color:#F47067">new</span><span style="color:#F69D50"> Action</span><span style="color:#ADBAC7">(AntiForgery.Validate)) { } </span></span></code></pre></figure>
<p>This method go through several method of the framework to end to the <span data-rehype-pretty-code-figure=""><code data-language="plaintext" data-theme="github-dark-dimmed" style="background-color:#22272e;color:#adbac7"><span data-line=""><span>ValidateTokens(...)</span></span></code></span> methods that look like the code below.</p>
<figure data-rehype-pretty-code-figure=""><pre style="background-color:#22272e;color:#adbac7" tabindex="0" data-language="csharp" data-theme="github-dark-dimmed"><code data-language="csharp" data-theme="github-dark-dimmed" style="display:grid"><span data-line=""><span style="color:#F47067">public</span><span style="color:#F47067"> void</span><span style="color:#DCBDFB"> ValidateTokens</span><span style="color:#ADBAC7">(</span><span style="color:#F69D50">HttpContextBase</span><span style="color:#F69D50"> httpContext</span><span style="color:#ADBAC7">, </span><span style="color:#F69D50">IIdentity</span><span style="color:#F69D50"> identity</span><span style="color:#ADBAC7">, </span><span style="color:#F69D50">AntiForgeryToken</span><span style="color:#F69D50"> sessionToken</span><span style="color:#ADBAC7">, </span><span style="color:#F69D50">AntiForgeryToken</span><span style="color:#F69D50"> fieldToken</span><span style="color:#ADBAC7">) { </span></span>
<span data-line=""><span style="color:#F47067">  if</span><span style="color:#ADBAC7"> (sessionToken </span><span style="color:#F47067">==</span><span style="color:#6CB6FF"> null</span><span style="color:#ADBAC7">) </span></span>
<span data-line=""><span style="color:#F47067">    throw</span><span style="color:#ADBAC7"> HttpAntiForgeryException.</span><span style="color:#DCBDFB">CreateCookieMissingException</span><span style="color:#ADBAC7">(</span><span style="color:#6CB6FF">this</span><span style="color:#ADBAC7">._config.CookieName); </span></span>
<span data-line=""><span style="color:#F47067">  if</span><span style="color:#ADBAC7"> (fieldToken </span><span style="color:#F47067">==</span><span style="color:#6CB6FF"> null</span><span style="color:#ADBAC7">) </span><span style="color:#F47067">throw</span><span style="color:#ADBAC7"> HttpAntiForgeryException.</span><span style="color:#DCBDFB">CreateFormFieldMissingException</span><span style="color:#ADBAC7">(</span><span style="color:#6CB6FF">this</span><span style="color:#ADBAC7">._config.FormFieldName); </span></span>
<span data-line=""><span style="color:#F47067">  if</span><span style="color:#ADBAC7"> (</span><span style="color:#F47067">!</span><span style="color:#ADBAC7">sessionToken.IsSessionToken </span><span style="color:#F47067">||</span><span style="color:#ADBAC7"> fieldToken.IsSessionToken) </span></span>
<span data-line=""><span style="color:#F47067">    throw</span><span style="color:#ADBAC7"> HttpAntiForgeryException.</span><span style="color:#DCBDFB">CreateTokensSwappedException</span><span style="color:#ADBAC7">(</span><span style="color:#6CB6FF">this</span><span style="color:#ADBAC7">._config.CookieName, </span><span style="color:#6CB6FF">this</span><span style="color:#ADBAC7">._config.FormFieldName); </span></span>
<span data-line=""><span style="color:#F47067">  if</span><span style="color:#ADBAC7"> (</span><span style="color:#F47067">!object</span><span style="color:#ADBAC7">.</span><span style="color:#DCBDFB">Equals</span><span style="color:#ADBAC7">((</span><span style="color:#F47067">object</span><span style="color:#ADBAC7">) sessionToken.SecurityToken, (</span><span style="color:#F47067">object</span><span style="color:#ADBAC7">) fieldToken.SecurityToken)) </span></span>
<span data-line=""><span style="color:#F47067">    throw</span><span style="color:#ADBAC7"> HttpAntiForgeryException.</span><span style="color:#DCBDFB">CreateSecurityTokenMismatchException</span><span style="color:#ADBAC7">(); </span></span>
<span data-line=""><span style="color:#F47067">    string</span><span style="color:#F69D50"> str</span><span style="color:#F47067"> =</span><span style="color:#F47067"> string</span><span style="color:#ADBAC7">.Empty; </span></span>
<span data-line=""><span style="color:#F69D50">    BinaryBlob</span><span style="color:#F69D50"> binaryBlob</span><span style="color:#F47067"> =</span><span style="color:#ADBAC7"> (</span><span style="color:#F69D50">BinaryBlob</span><span style="color:#ADBAC7">) </span><span style="color:#6CB6FF">null</span><span style="color:#ADBAC7">; </span></span>
<span data-line=""><span style="color:#F47067">    if</span><span style="color:#ADBAC7"> (identity </span><span style="color:#F47067">!=</span><span style="color:#6CB6FF"> null</span><span style="color:#F47067"> &amp;&amp;</span><span style="color:#ADBAC7"> identity.IsAuthenticated) { </span></span>
<span data-line=""><span style="color:#ADBAC7">      binaryBlob </span><span style="color:#F47067">=</span><span style="color:#6CB6FF"> this</span><span style="color:#ADBAC7">._claimUidExtractor.</span><span style="color:#DCBDFB">ExtractClaimUid</span><span style="color:#ADBAC7">(identity); </span></span>
<span data-line=""><span style="color:#F47067">      if</span><span style="color:#ADBAC7"> (binaryBlob </span><span style="color:#F47067">==</span><span style="color:#6CB6FF"> null</span><span style="color:#ADBAC7">) </span></span>
<span data-line=""><span style="color:#ADBAC7">        str </span><span style="color:#F47067">=</span><span style="color:#ADBAC7"> identity.Name </span><span style="color:#F47067">??</span><span style="color:#F47067"> string</span><span style="color:#ADBAC7">.Empty; </span></span>
<span data-line=""><span style="color:#ADBAC7">    } </span></span>
<span data-line=""><span style="color:#F47067">    bool</span><span style="color:#F69D50"> flag</span><span style="color:#F47067"> =</span><span style="color:#ADBAC7"> str.</span><span style="color:#DCBDFB">StartsWith</span><span style="color:#ADBAC7">(</span><span style="color:#96D0FF">&quot;http://&quot;</span><span style="color:#ADBAC7">, StringComparison.OrdinalIgnoreCase) </span><span style="color:#F47067">||</span><span style="color:#ADBAC7"> str.</span><span style="color:#DCBDFB">StartsWith</span><span style="color:#ADBAC7">(</span><span style="color:#96D0FF">&quot;https://&quot;</span><span style="color:#ADBAC7">, StringComparison.OrdinalIgnoreCase); </span></span>
<span data-line=""><span style="color:#ADBAC7">    </span></span>
<span data-line=""><span style="color:#F47067">    if</span><span style="color:#ADBAC7"> (</span><span style="color:#F47067">!</span><span style="color:#F47067">string</span><span style="color:#ADBAC7">.</span><span style="color:#DCBDFB">Equals</span><span style="color:#ADBAC7">(fieldToken.Username, str, flag </span><span style="color:#F47067">?</span><span style="color:#ADBAC7"> StringComparison.Ordinal </span><span style="color:#F47067">:</span><span style="color:#ADBAC7"> StringComparison.OrdinalIgnoreCase)) </span></span>
<span data-line=""><span style="color:#F47067">      throw</span><span style="color:#ADBAC7"> HttpAntiForgeryException.</span><span style="color:#DCBDFB">CreateUsernameMismatchException</span><span style="color:#ADBAC7">(fieldToken.Username, str); </span></span>
<span data-line=""><span style="color:#F47067">    if</span><span style="color:#ADBAC7"> (</span><span style="color:#F47067">!object</span><span style="color:#ADBAC7">.</span><span style="color:#DCBDFB">Equals</span><span style="color:#ADBAC7">((</span><span style="color:#F47067">object</span><span style="color:#ADBAC7">) fieldToken.ClaimUid, (</span><span style="color:#F47067">object</span><span style="color:#ADBAC7">) binaryBlob)) </span></span>
<span data-line=""><span style="color:#F47067">      throw</span><span style="color:#ADBAC7"> HttpAntiForgeryException.</span><span style="color:#DCBDFB">CreateClaimUidMismatchException</span><span style="color:#ADBAC7">(); </span></span>
<span data-line=""><span style="color:#F47067">    if</span><span style="color:#ADBAC7"> (</span><span style="color:#6CB6FF">this</span><span style="color:#ADBAC7">._config.AdditionalDataProvider </span><span style="color:#F47067">!=</span><span style="color:#6CB6FF"> null</span><span style="color:#F47067"> &amp;&amp;</span><span style="color:#F47067"> !</span><span style="color:#6CB6FF">this</span><span style="color:#ADBAC7">._config.AdditionalDataProvider.</span><span style="color:#DCBDFB">ValidateAdditionalData</span><span style="color:#ADBAC7">(httpContext, fieldToken.AdditionalData)) </span></span>
<span data-line=""><span style="color:#F47067">      throw</span><span style="color:#ADBAC7"> HttpAntiForgeryException.</span><span style="color:#DCBDFB">CreateAdditionalDataCheckFailedException</span><span style="color:#ADBAC7">(); </span></span>
<span data-line=""><span style="color:#ADBAC7">} </span></span></code></pre></figure>
<p>What interest us is all possible exception that are throws. You can see that is can raise HttpAntiForgeryException for several case like if the cookie is missing, which is the case for Cross Site Request Forgeries or if the form doesn&#x27;t have the hidden field, or if the token mismatch between the cookie and the form.</p>
<p>All the complexity of the mechanism is hidden by the Asp.Net MVC framework. At the end, you only need to remember to add the html helper to your form and to add the attribute to the action of your controller that receive the form inputs.</p></div></main><div class="layout_paginationBar__jnuuR"><div class="layout_paginationTitle__PsOw5">Chronological Blog Articles by Page</div><div class="layout_paginationLinks__LdBaH"><a class="" href="/blog/page/1">1</a><a class="" href="/blog/page/2">2</a><a class="" href="/blog/page/3">3</a><a class="" href="/blog/page/4">4</a><a class="" href="/blog/page/5">5</a><a class="" href="/blog/page/6">6</a><a class="" href="/blog/page/7">7</a><a class="" href="/blog/page/8">8</a><a class="" href="/blog/page/9">9</a><a class="" href="/blog/page/10">10</a><a class="" href="/blog/page/11">11</a><a class="" href="/blog/page/12">12</a><a class="" href="/blog/page/13">13</a><a class="" href="/blog/page/14">14</a><a class="" href="/blog/page/15">15</a><a class="" href="/blog/page/16">16</a><a class="" href="/blog/page/17">17</a><a class="" href="/blog/page/18">18</a><a class="" href="/blog/page/19">19</a><a class="" href="/blog/page/20">20</a><a class="" href="/blog/page/21">21</a><a class="" href="/blog/page/22">22</a><a class="" href="/blog/page/23">23</a><a class="" href="/blog/page/24">24</a><a class="" href="/blog/page/25">25</a><a class="" href="/blog/page/26">26</a><a class="" href="/blog/page/27">27</a><a class="" href="/blog/page/28">28</a><a class="" href="/blog/page/29">29</a><a class="" href="/blog/page/30">30</a><a class="" href="/blog/page/31">31</a><a class="" href="/blog/page/32">32</a><a class="" href="/blog/page/33">33</a><a class="" href="/blog/page/34">34</a><a class="" href="/blog/page/35">35</a><a class="" href="/blog/page/36">36</a><a class="" href="/blog/page/37">37</a><a class="" href="/blog/page/38">38</a><a class="" href="/blog/page/39">39</a><a class="" href="/blog/page/40">40</a><a class="" href="/blog/page/41">41</a><a class="" href="/blog/page/42">42</a><a class="" href="/blog/page/43">43</a><a class="" href="/blog/page/44">44</a><a class="" href="/blog/page/45">45</a><a class="" href="/blog/page/46">46</a><a class="" href="/blog/page/47">47</a><a class="" href="/blog/page/48">48</a><a class="" href="/blog/page/49">49</a><a class="" href="/blog/page/50">50</a><a class="" href="/blog/page/51">51</a><a class="" href="/blog/page/52">52</a><a class="" href="/blog/page/53">53</a><a class="" href="/blog/page/54">54</a><a class="" href="/blog/page/55">55</a><a class="" href="/blog/page/56">56</a><a class="" href="/blog/page/57">57</a><a class="" href="/blog/page/58">58</a><a class="" href="/blog/page/59">59</a><a class="" href="/blog/page/60">60</a><a class="" href="/blog/page/61">61</a><a class="" href="/blog/page/62">62</a><a class="" href="/blog/page/63">63</a><a class="" href="/blog/page/64">64</a><a class="" href="/blog/page/65">65</a><a class="" href="/blog/page/66">66</a><a class="" href="/blog/page/67">67</a><a class="" href="/blog/page/68">68</a><a class="" href="/blog/page/69">69</a><a class="" href="/blog/page/70">70</a><a class="" href="/blog/page/71">71</a><a class="" href="/blog/page/72">72</a><a class="" href="/blog/page/73">73</a><a class="" href="/blog/page/74">74</a><a class="" href="/blog/page/75">75</a><a class="" href="/blog/page/76">76</a><a class="" href="/blog/page/77">77</a></div></div></div></div><script src="/_next/static/chunks/webpack-c94468cbefcc94b8.js" crossorigin="" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0]);self.__next_f.push([2,null])</script><script>self.__next_f.push([1,"1:HL[\"/_next/static/css/4f3d065c9e2d01e0.css\",\"style\",{\"crossOrigin\":\"\"}]\n0:\"$L2\"\n"])</script><script>self.__next_f.push([1,"3:HL[\"/_next/static/media/c9a5bc6a7c948fb0-s.p.woff2\",\"font\",{\"crossOrigin\":\"\",\"type\":\"font/woff2\"}]\n4:HL[\"/_next/static/css/8ea1dcbe6e4b9929.css\",\"style\",{\"crossOrigin\":\"\"}]\n"])</script><script>self.__next_f.push([1,"5:I[7690,[],\"\"]\n8:I[5613,[],\"\"]\na:I[1778,[],\"\"]\nb:I[5250,[\"250\",\"static/chunks/250-d7e0a94ebe194dac.js\",\"79\",\"static/chunks/79-2d03397107aae3f1.js\",\"308\",\"static/chunks/app/blog/%5Bslug%5D/page-6ef1cad01f05dc10.js\"],\"\"]\nd:I[8955,[],\"\"]\n9:[\"slug\",\"asp-net-mvc-with-the-validateantiforgerytoken-for-cross-site-request-forgeries\",\"d\"]\ne:[]\n"])</script><script>self.__next_f.push([1,"2:[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/4f3d065c9e2d01e0.css\",\"precedence\":\"next\",\"crossOrigin\":\"\"}]],[\"$\",\"$L5\",null,{\"buildId\":\"pQvqCOvKm2LGzk0s7VKrc\",\"assetPrefix\":\"\",\"initialCanonicalUrl\":\"/blog/asp-net-mvc-with-the-validateantiforgerytoken-for-cross-site-request-forgeries\",\"initialTree\":[\"\",{\"children\":[\"blog\",{\"children\":[[\"slug\",\"asp-net-mvc-with-the-validateantiforgerytoken-for-cross-site-request-forgeries\",\"d\"],{\"children\":[\"__PAGE__?{\\\"slug\\\":\\\"asp-net-mvc-with-the-validateantiforgerytoken-for-cross-site-request-forgeries\\\"}\",{}]}]}]},\"$undefined\",\"$undefined\",true],\"initialSeedData\":[\"\",{\"children\":[\"blog\",{\"children\":[[\"slug\",\"asp-net-mvc-with-the-validateantiforgerytoken-for-cross-site-request-forgeries\",\"d\"],{\"children\":[\"__PAGE__\",{},[\"$L6\",\"$L7\",null]]},[\"$\",\"$L8\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"blog\",\"children\",\"$9\",\"children\"],\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"loadingScripts\":\"$undefined\",\"hasLoading\":false,\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$La\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\",\"styles\":[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/8ea1dcbe6e4b9929.css\",\"precedence\":\"next\",\"crossOrigin\":\"\"}]]}]]},[\"$\",\"$L8\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"blog\",\"children\"],\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"loadingScripts\":\"$undefined\",\"hasLoading\":false,\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$La\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\",\"styles\":null}]]},[null,[\"$\",\"html\",null,{\"lang\":\"en\",\"children\":[\"$\",\"body\",null,{\"className\":\"layout_bodystyle__4ncsS\",\"children\":[\"$\",\"$L8\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\"],\"loading\":\"$undefined\",\"loadingStyles\":\"$undefined\",\"loadingScripts\":\"$undefined\",\"hasLoading\":false,\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$La\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[\"$\",\"div\",null,{\"style\":{\"display\":\"flex\",\"alignItems\":\"center\",\"justifyContent\":\"center\",\"height\":\"100vh\"},\"children\":[\"$\",\"div\",null,{\"style\":{\"width\":\"50%\",\"height\":\"20%\",\"backgroundColor\":\"#ffeded\",\"borderRadius\":12,\"padding\":12,\"textAlign\":\"center\"},\"children\":[[\"$\",\"h1\",null,{\"children\":\"Not Found\"}],[\"$\",\"p\",null,{\"children\":\"Could not find requested resource\"}],[\"$\",\"$Lb\",null,{\"href\":\"/\",\"children\":\"Return Home\"}]]}]}],\"notFoundStyles\":[],\"styles\":null}]}]}],null]],\"initialHead\":[false,\"$Lc\"],\"globalErrorComponent\":\"$d\",\"missingSlots\":\"$We\"}]]\n"])</script><script>self.__next_f.push([1,"f:I[1749,[\"250\",\"static/chunks/250-d7e0a94ebe194dac.js\",\"79\",\"static/chunks/79-2d03397107aae3f1.js\",\"308\",\"static/chunks/app/blog/%5Bslug%5D/page-6ef1cad01f05dc10.js\"],\"Image\"]\nc:[[\"$\",\"meta\",\"0\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}],[\"$\",\"meta\",\"1\",{\"charSet\":\"utf-8\"}],[\"$\",\"title\",\"2\",{\"children\":\"Patrick Desjardins Blog - Asp.Net MVC With the ValidateAntiForgeryToken For Cross Site Request Forgeries\"}],[\"$\",\"meta\",\"3\",{\"name\":\"description\",\"content\":\"Asp.Net MVC With the Va"])</script><script>self.__next_f.push([1,"lidateAntiForgeryToken For Cross Site Request Forgeries\"}],[\"$\",\"meta\",\"4\",{\"name\":\"next-size-adjust\"}]]\n6:null\n"])</script><script>self.__next_f.push([1,"7:[\"$\",\"div\",null,{\"className\":\"__className_aaf875\",\"children\":[\"$\",\"div\",null,{\"className\":\"layout_container__Tovb9\",\"children\":[[\"$\",\"header\",null,{\"className\":\"layout_siteTitle__k5U8g\",\"children\":\"Patrick Desjardins Blog\"}],[\"$\",\"nav\",null,{\"children\":[\"$\",\"ul\",null,{\"className\":\"layout_navLinks__mf70r\",\"children\":[\"$\",\"li\",null,{\"className\":\"layout_navLinkItem__1L8fB\",\"children\":[[\"$\",\"$Lb\",null,{\"className\":\"layout_navLinkText__bt28R\",\"href\":\"/\",\"children\":\"Main Page\"}],[\"$\",\"$Lb\",null,{\"className\":\"layout_navLinkText__bt28R\",\"href\":\"/blog\",\"children\":\"Blog\"}],[[\"$\",\"$Lb\",\"2024\",{\"className\":\"layout_navLinkText__bt28R\",\"href\":\"/blog/for/2024\",\"children\":2024}],[\"$\",\"$Lb\",\"2023\",{\"className\":\"layout_navLinkText__bt28R\",\"href\":\"/blog/for/2023\",\"children\":2023}],[\"$\",\"$Lb\",\"2022\",{\"className\":\"layout_navLinkText__bt28R\",\"href\":\"/blog/for/2022\",\"children\":2022}],[\"$\",\"$Lb\",\"2021\",{\"className\":\"layout_navLinkText__bt28R\",\"href\":\"/blog/for/2021\",\"children\":2021}],[\"$\",\"$Lb\",\"2020\",{\"className\":\"layout_navLinkText__bt28R\",\"href\":\"/blog/for/2020\",\"children\":2020}],[\"$\",\"$Lb\",\"2019\",{\"className\":\"layout_navLinkText__bt28R\",\"href\":\"/blog/for/2019\",\"children\":2019}],[\"$\",\"$Lb\",\"2018\",{\"className\":\"layout_navLinkText__bt28R\",\"href\":\"/blog/for/2018\",\"children\":2018}],[\"$\",\"$Lb\",\"2017\",{\"className\":\"layout_navLinkText__bt28R\",\"href\":\"/blog/for/2017\",\"children\":2017}],[\"$\",\"$Lb\",\"2016\",{\"className\":\"layout_navLinkText__bt28R\",\"href\":\"/blog/for/2016\",\"children\":2016}],[\"$\",\"$Lb\",\"2015\",{\"className\":\"layout_navLinkText__bt28R\",\"href\":\"/blog/for/2015\",\"children\":2015}],[\"$\",\"$Lb\",\"2014\",{\"className\":\"layout_navLinkText__bt28R\",\"href\":\"/blog/for/2014\",\"children\":2014}],[\"$\",\"$Lb\",\"2013\",{\"className\":\"layout_navLinkText__bt28R\",\"href\":\"/blog/for/2013\",\"children\":2013}],[\"$\",\"$Lb\",\"2012\",{\"className\":\"layout_navLinkText__bt28R\",\"href\":\"/blog/for/2012\",\"children\":2012}],[\"$\",\"$Lb\",\"2011\",{\"className\":\"layout_navLinkText__bt28R\",\"href\":\"/blog/for/2011\",\"children\":2011}]]]}]}]}],[\"$\",\"div\",null,{\"className\":\"layout_blogPictureContainer__XC7nK\",\"children\":[\"$\",\"$Lf\",null,{\"className\":\"layout_blogTopPicture__RJHNN\",\"alt\":\"Patrick Desjardins picture from a conference\",\"src\":\"/images/backgrounds/patrickdesjardins_conference_bw.jpeg\",\"width\":800,\"height\":260}]}],[\"$\",\"main\",null,{\"className\":\"layout_main__mXTwS\",\"children\":[[\"$\",\"h1\",null,{\"children\":\"Asp.Net MVC With the ValidateAntiForgeryToken For Cross Site Request Forgeries\"}],[\"$\",\"div\",null,{\"className\":\"layout_blogPostContainer__WYELx\",\"children\":[[\"$\",\"p\",null,{\"className\":\"layout_blogPostDate__LUvx5\",\"children\":[\"Posted on: \",\"2014-01-02\"]}],[[\"$\",\"p\",null,{\"children\":\"Cross Site Request Forgeries is also know as CSRF. It is a type of malicious exploit that send commands from a user without his consent to another website. CSRF exploits the trust that a site has in a user's browser.\\nFor example, a website could try to execute a form to add something in your Amazon basket! This can be limited by adding an hidden field to a form and a cookie. Both will contain the same value and when the form is submitted the hidden field is compared to the cookie value. If it's the same value, we know that the user has sent the form. If it's not, we know it's a malicious attack.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"In Asp.Net MVC, \",[\"$\",\"span\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"plaintext\",\"data-theme\":\"github-dark-dimmed\",\"style\":{\"backgroundColor\":\"#22272e\",\"color\":\"#adbac7\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"ValidateAntiForgeryToken\"}]}]}]}],\" is a combination of an html helper (hidden field) and attribute(cookie) that allows to verify if the form as been created and sent by the same user.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"The first step is to add the HtmlHelper method \",[\"$\",\"span\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"plaintext\",\"data-theme\":\"github-dark-dimmed\",\"style\":{\"backgroundColor\":\"#22272e\",\"color\":\"#adbac7\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"@Html.AntiForgeryToken()\"}]}]}]}],\" inside the form in your view.\"]}],\"\\n\",[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"backgroundColor\":\"#22272e\",\"color\":\"#adbac7\"},\"tabIndex\":\"0\",\"data-language\":\"csharp\",\"data-theme\":\"github-dark-dimmed\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"csharp\",\"data-theme\":\"github-dark-dimmed\",\"style\":{\"display\":\"grid\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#DCBDFB\"},\"children\":\"@using\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\" (Html.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#DCBDFB\"},\"children\":\"BeginForm\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\"()) { @Html.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#DCBDFB\"},\"children\":\"AntiForgeryToken\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\"() \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#768390\"},\"children\":\"//... \"}]]}]}]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"This generate an hidden field with the name \",[\"$\",\"span\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"plaintext\",\"data-theme\":\"github-dark-dimmed\",\"style\":{\"backgroundColor\":\"#22272e\",\"color\":\"#adbac7\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"__RequestVerificationToken\"}]}]}]}],\" and an unique value. This is an example of the output generated:\"]}],\"\\n\",[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"backgroundColor\":\"#22272e\",\"color\":\"#adbac7\"},\"tabIndex\":\"0\",\"data-language\":\"html\",\"data-theme\":\"github-dark-dimmed\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"html\",\"data-theme\":\"github-dark-dimmed\",\"style\":{\"display\":\"grid\"},\"children\":[[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\"\u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#8DDB8C\"},\"children\":\"form\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6CB6FF\"},\"children\":\" action\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#96D0FF\"},\"children\":\"\\\"/House/Create\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6CB6FF\"},\"children\":\" method\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#96D0FF\"},\"children\":\"\\\"post\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6CB6FF\"},\"children\":\" novalidate\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#96D0FF\"},\"children\":\"\\\"novalidate\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\"\u003e \"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\"  \u003c\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#8DDB8C\"},\"children\":\"input\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6CB6FF\"},\"children\":\" name\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#96D0FF\"},\"children\":\"\\\"__RequestVerificationToken\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6CB6FF\"},\"children\":\" type\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#96D0FF\"},\"children\":\"\\\"hidden\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6CB6FF\"},\"children\":\" value\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#96D0FF\"},\"children\":\"\\\"KPyzBk0KGpjStJR96AVI38AbBujBInJNB-1XH-RwsbuifwgmxnGiF-0R2cMHjcYBiz7yOBUnv0fZwoE2oBwiuKXalBDvsRr2RRG7nmkOsq41\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\"\u003e \"}]]}]]}]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"The code behind the html helper is simple. It creates a MvcHtmlString from the AntiForgery class.\"}],\"\\n\",[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"backgroundColor\":\"#22272e\",\"color\":\"#adbac7\"},\"tabIndex\":\"0\",\"data-language\":\"csharp\",\"data-theme\":\"github-dark-dimmed\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"csharp\",\"data-theme\":\"github-dark-dimmed\",\"style\":{\"display\":\"grid\"},\"children\":[[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#F47067\"},\"children\":\"public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#F69D50\"},\"children\":\" MvcHtmlString\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#DCBDFB\"},\"children\":\" AntiForgeryToken\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\"() { \"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#F47067\"},\"children\":\"  return\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#F47067\"},\"children\":\" new\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#F69D50\"},\"children\":\" MvcHtmlString\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\"(AntiForgery.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#DCBDFB\"},\"children\":\"GetHtml\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\"().\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#DCBDFB\"},\"children\":\"ToString\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\"()); \"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\"} \"}]}]]}]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"The \",[\"$\",\"span\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"plaintext\",\"data-theme\":\"github-dark-dimmed\",\"style\":{\"backgroundColor\":\"#22272e\",\"color\":\"#adbac7\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"AntiForgery\"}]}]}]}],\" class contains the \",[\"$\",\"span\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"plaintext\",\"data-theme\":\"github-dark-dimmed\",\"style\":{\"backgroundColor\":\"#22272e\",\"color\":\"#adbac7\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"GetHtml()\"}]}]}]}],\" used in the html helper but also some validation of the forgery. Both use the class \",[\"$\",\"span\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"plaintext\",\"data-theme\":\"github-dark-dimmed\",\"style\":{\"backgroundColor\":\"#22272e\",\"color\":\"#adbac7\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"AntiForgeryWorker\"}]}]}]}],\".\"]}],\"\\n\",[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"backgroundColor\":\"#22272e\",\"color\":\"#adbac7\"},\"tabIndex\":\"0\",\"data-language\":\"csharp\",\"data-theme\":\"github-dark-dimmed\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"csharp\",\"data-theme\":\"github-dark-dimmed\",\"style\":{\"display\":\"grid\"},\"children\":[[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#F47067\"},\"children\":\"public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#F47067\"},\"children\":\" static\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#F69D50\"},\"children\":\" HtmlString\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#DCBDFB\"},\"children\":\" GetHtml\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\"() { \"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#F47067\"},\"children\":\"  if\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\" (HttpContext.Current \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#F47067\"},\"children\":\"==\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6CB6FF\"},\"children\":\" null\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\") \"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#F47067\"},\"children\":\"    throw\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#F47067\"},\"children\":\" new\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#F69D50\"},\"children\":\" ArgumentException\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\"(WebPageResources.HttpContextUnavailable); \"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#F47067\"},\"children\":\"  else\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\" \"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#F47067\"},\"children\":\"    return\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\" AntiForgery._worker.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#DCBDFB\"},\"children\":\"GetFormInputElement\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\"((\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#F69D50\"},\"children\":\"HttpContextBase\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\") \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#F47067\"},\"children\":\"new\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#F69D50\"},\"children\":\" HttpContextWrapper\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\"(HttpContext.Current)).\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#DCBDFB\"},\"children\":\"ToHtmlString\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\"(TagRenderMode.SelfClosing); \"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\"} \"}]}]]}]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"The worker that we see in the code above is of type \",[\"$\",\"span\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"plaintext\",\"data-theme\":\"github-dark-dimmed\",\"style\":{\"backgroundColor\":\"#22272e\",\"color\":\"#adbac7\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"AntiForgeryWorker\"}]}]}]}],\". This class is about 139 lines and the core of it is the \",[\"$\",\"span\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"plaintext\",\"data-theme\":\"github-dark-dimmed\",\"style\":{\"backgroundColor\":\"#22272e\",\"color\":\"#adbac7\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"GetFormInputElement\"}]}]}]}],\" used by the \",[\"$\",\"span\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"plaintext\",\"data-theme\":\"github-dark-dimmed\",\"style\":{\"backgroundColor\":\"#22272e\",\"color\":\"#adbac7\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"GetHtml\"}]}]}]}],\".\"]}],\"\\n\",[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"backgroundColor\":\"#22272e\",\"color\":\"#adbac7\"},\"tabIndex\":\"0\",\"data-language\":\"csharp\",\"data-theme\":\"github-dark-dimmed\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"csharp\",\"data-theme\":\"github-dark-dimmed\",\"style\":{\"display\":\"grid\"},\"children\":[[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#F47067\"},\"children\":\" public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#F69D50\"},\"children\":\" TagBuilder\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#DCBDFB\"},\"children\":\" GetFormInputElement\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#F69D50\"},\"children\":\"HttpContextBase\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#F69D50\"},\"children\":\" httpContext\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\") { \"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6CB6FF\"},\"children\":\"  this\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#DCBDFB\"},\"children\":\"CheckSSLConfig\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\"(httpContext); \"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#F69D50\"},\"children\":\"  AntiForgeryToken\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#F69D50\"},\"children\":\" cookieTokenNoThrow\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#F47067\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6CB6FF\"},\"children\":\" this\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#DCBDFB\"},\"children\":\"GetCookieTokenNoThrow\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\"(httpContext); \"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#F69D50\"},\"children\":\"  AntiForgeryToken\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#F69D50\"},\"children\":\" newCookieToken\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\"; \"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#F69D50\"},\"children\":\"  AntiForgeryToken\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#F69D50\"},\"children\":\" formToken\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\"; \"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6CB6FF\"},\"children\":\"  this\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#DCBDFB\"},\"children\":\"GetTokens\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\"(httpContext, cookieTokenNoThrow, \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#F47067\"},\"children\":\"out\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\" newCookieToken, \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#F47067\"},\"children\":\"out\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\" formToken); \"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#F47067\"},\"children\":\"  if\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\" (newCookieToken \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#F47067\"},\"children\":\"!=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6CB6FF\"},\"children\":\" null\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\") \"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#6CB6FF\"},\"children\":\"    this\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\"._tokenStore.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#DCBDFB\"},\"children\":\"SaveCookieToken\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\"(httpContext, newCookieToken); \"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#F47067\"},\"children\":\"  if\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\" (\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#F47067\"},\"children\":\"!\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6CB6FF\"},\"children\":\"this\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\"._config.SuppressXFrameOptionsHeader) \"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\"    httpContext.Response.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#DCBDFB\"},\"children\":\"AddHeader\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#96D0FF\"},\"children\":\"\\\"X-Frame-Options\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\", \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#96D0FF\"},\"children\":\"\\\"SAMEORIGIN\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\"); \"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#F69D50\"},\"children\":\"  TagBuilder\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#F69D50\"},\"children\":\" tagBuilder\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#F47067\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#F47067\"},\"children\":\" new\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#F69D50\"},\"children\":\" TagBuilder\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#96D0FF\"},\"children\":\"\\\"input\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\"); \"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\"  tagBuilder.Attributes[\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#96D0FF\"},\"children\":\"\\\"type\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\"] \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#F47067\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#96D0FF\"},\"children\":\" \\\"hidden\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\"; \"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\"  tagBuilder.Attributes[\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#96D0FF\"},\"children\":\"\\\"name\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\"] \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#F47067\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6CB6FF\"},\"children\":\" this\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\"._config.FormFieldName; \"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\"  tagBuilder.Attributes[\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#96D0FF\"},\"children\":\"\\\"value\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\"] \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#F47067\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6CB6FF\"},\"children\":\" this\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\"._serializer.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#DCBDFB\"},\"children\":\"Serialize\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\"(formToken); \"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#F47067\"},\"children\":\"  return\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\" tagBuilder; } \"}]]}]]}]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"This is interesting to see how the value is generated. As we can see, it's using the serializer to serialize the form token. The form token is build inside the class TokenValidator that take some property of the Identity. I won't go deeper because it goes a little beyond the scope of the article. Just remember that the token is unique for the user. However, the GetFormInputElement code above is also important for something else. The token store role is to create the cookie which set also the token.\"}],\"\\n\",[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"backgroundColor\":\"#22272e\",\"color\":\"#adbac7\"},\"tabIndex\":\"0\",\"data-language\":\"csharp\",\"data-theme\":\"github-dark-dimmed\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"csharp\",\"data-theme\":\"github-dark-dimmed\",\"style\":{\"display\":\"grid\"},\"children\":[[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#F47067\"},\"children\":\"public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#F47067\"},\"children\":\" void\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#DCBDFB\"},\"children\":\" SaveCookieToken\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#F69D50\"},\"children\":\"HttpContextBase\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#F69D50\"},\"children\":\" httpContext\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\", \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#F69D50\"},\"children\":\"AntiForgeryToken\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#F69D50\"},\"children\":\" token\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\") { \"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#F69D50\"},\"children\":\"  HttpCookie\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#F69D50\"},\"children\":\" cookie\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#F47067\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#F47067\"},\"children\":\" new\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#F69D50\"},\"children\":\" HttpCookie\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6CB6FF\"},\"children\":\"this\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\"._config.CookieName, \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6CB6FF\"},\"children\":\"this\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\"._serializer.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#DCBDFB\"},\"children\":\"Serialize\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\"(token)) { \"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\"    HttpOnly \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#F47067\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6CB6FF\"},\"children\":\" true\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\" \"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\"  }; \"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#F47067\"},\"children\":\"  if\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\" (\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6CB6FF\"},\"children\":\"this\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\"._config.RequireSSL) \"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\"    cookie.Secure \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#F47067\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6CB6FF\"},\"children\":\" true\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\";\"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\"  httpContext.Response.Cookies.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#DCBDFB\"},\"children\":\"Set\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\"(cookie); \"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\"} \"}]}]]}]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"The way the \",[\"$\",\"span\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"plaintext\",\"data-theme\":\"github-dark-dimmed\",\"style\":{\"backgroundColor\":\"#22272e\",\"color\":\"#adbac7\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"ValidateAntiForgeryToken\"}]}]}]}],\" attribute works is by checking to see that the cookie and hidden form field left by the \",[\"$\",\"span\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"plaintext\",\"data-theme\":\"github-dark-dimmed\",\"style\":{\"backgroundColor\":\"#22272e\",\"color\":\"#adbac7\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"Html.AntiForgeryToken()\"}]}]}]}],\" Html Helper essentially exists and match. If they do not exist or match, it throws an \",[\"$\",\"span\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"plaintext\",\"data-theme\":\"github-dark-dimmed\",\"style\":{\"backgroundColor\":\"#22272e\",\"color\":\"#adbac7\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"HttpAntiForgeryException\"}]}]}]}],\".\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"img\",null,{\"src\":\"/images/blog/ValidateAntiforgerytoken.png\",\"alt\":\"\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"The attribute does have a \",[\"$\",\"span\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"plaintext\",\"data-theme\":\"github-dark-dimmed\",\"style\":{\"backgroundColor\":\"#22272e\",\"color\":\"#adbac7\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"ValidateAntiForgeryTokenAttribute\"}]}]}]}],\" method that call the \",[\"$\",\"span\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"plaintext\",\"data-theme\":\"github-dark-dimmed\",\"style\":{\"backgroundColor\":\"#22272e\",\"color\":\"#adbac7\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"AntiForgery\"}]}]}]}],\" class. I have previously mentioned that it has not only the method to get the input but also for validation. Here is where it's used.\"]}],\"\\n\",[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"backgroundColor\":\"#22272e\",\"color\":\"#adbac7\"},\"tabIndex\":\"0\",\"data-language\":\"csharp\",\"data-theme\":\"github-dark-dimmed\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"csharp\",\"data-theme\":\"github-dark-dimmed\",\"style\":{\"display\":\"grid\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#F47067\"},\"children\":\" public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#DCBDFB\"},\"children\":\" ValidateAntiForgeryTokenAttribute\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\"() \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#F47067\"},\"children\":\":\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6CB6FF\"},\"children\":\" this\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#F47067\"},\"children\":\"new\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#F69D50\"},\"children\":\" Action\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\"(AntiForgery.Validate)) { } \"}]]}]}]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"This method go through several method of the framework to end to the \",[\"$\",\"span\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"plaintext\",\"data-theme\":\"github-dark-dimmed\",\"style\":{\"backgroundColor\":\"#22272e\",\"color\":\"#adbac7\"},\"children\":[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"children\":\"ValidateTokens(...)\"}]}]}]}],\" methods that look like the code below.\"]}],\"\\n\",[\"$\",\"figure\",null,{\"data-rehype-pretty-code-figure\":\"\",\"children\":[\"$\",\"pre\",null,{\"style\":{\"backgroundColor\":\"#22272e\",\"color\":\"#adbac7\"},\"tabIndex\":\"0\",\"data-language\":\"csharp\",\"data-theme\":\"github-dark-dimmed\",\"children\":[\"$\",\"code\",null,{\"data-language\":\"csharp\",\"data-theme\":\"github-dark-dimmed\",\"style\":{\"display\":\"grid\"},\"children\":[[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#F47067\"},\"children\":\"public\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#F47067\"},\"children\":\" void\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#DCBDFB\"},\"children\":\" ValidateTokens\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#F69D50\"},\"children\":\"HttpContextBase\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#F69D50\"},\"children\":\" httpContext\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\", \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#F69D50\"},\"children\":\"IIdentity\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#F69D50\"},\"children\":\" identity\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\", \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#F69D50\"},\"children\":\"AntiForgeryToken\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#F69D50\"},\"children\":\" sessionToken\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\", \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#F69D50\"},\"children\":\"AntiForgeryToken\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#F69D50\"},\"children\":\" fieldToken\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\") { \"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#F47067\"},\"children\":\"  if\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\" (sessionToken \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#F47067\"},\"children\":\"==\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6CB6FF\"},\"children\":\" null\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\") \"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#F47067\"},\"children\":\"    throw\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\" HttpAntiForgeryException.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#DCBDFB\"},\"children\":\"CreateCookieMissingException\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6CB6FF\"},\"children\":\"this\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\"._config.CookieName); \"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#F47067\"},\"children\":\"  if\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\" (fieldToken \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#F47067\"},\"children\":\"==\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6CB6FF\"},\"children\":\" null\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\") \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#F47067\"},\"children\":\"throw\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\" HttpAntiForgeryException.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#DCBDFB\"},\"children\":\"CreateFormFieldMissingException\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6CB6FF\"},\"children\":\"this\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\"._config.FormFieldName); \"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#F47067\"},\"children\":\"  if\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\" (\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#F47067\"},\"children\":\"!\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\"sessionToken.IsSessionToken \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#F47067\"},\"children\":\"||\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\" fieldToken.IsSessionToken) \"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#F47067\"},\"children\":\"    throw\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\" HttpAntiForgeryException.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#DCBDFB\"},\"children\":\"CreateTokensSwappedException\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6CB6FF\"},\"children\":\"this\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\"._config.CookieName, \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6CB6FF\"},\"children\":\"this\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\"._config.FormFieldName); \"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#F47067\"},\"children\":\"  if\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\" (\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#F47067\"},\"children\":\"!object\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#DCBDFB\"},\"children\":\"Equals\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\"((\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#F47067\"},\"children\":\"object\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\") sessionToken.SecurityToken, (\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#F47067\"},\"children\":\"object\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\") fieldToken.SecurityToken)) \"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#F47067\"},\"children\":\"    throw\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\" HttpAntiForgeryException.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#DCBDFB\"},\"children\":\"CreateSecurityTokenMismatchException\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\"(); \"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#F47067\"},\"children\":\"    string\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#F69D50\"},\"children\":\" str\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#F47067\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#F47067\"},\"children\":\" string\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\".Empty; \"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#F69D50\"},\"children\":\"    BinaryBlob\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#F69D50\"},\"children\":\" binaryBlob\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#F47067\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\" (\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#F69D50\"},\"children\":\"BinaryBlob\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\") \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6CB6FF\"},\"children\":\"null\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\"; \"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#F47067\"},\"children\":\"    if\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\" (identity \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#F47067\"},\"children\":\"!=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6CB6FF\"},\"children\":\" null\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#F47067\"},\"children\":\" \u0026\u0026\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\" identity.IsAuthenticated) { \"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\"      binaryBlob \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#F47067\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6CB6FF\"},\"children\":\" this\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\"._claimUidExtractor.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#DCBDFB\"},\"children\":\"ExtractClaimUid\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\"(identity); \"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#F47067\"},\"children\":\"      if\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\" (binaryBlob \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#F47067\"},\"children\":\"==\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6CB6FF\"},\"children\":\" null\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\") \"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\"        str \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#F47067\"},\"children\":\"=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\" identity.Name \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#F47067\"},\"children\":\"??\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#F47067\"},\"children\":\" string\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\".Empty; \"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\"    } \"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#F47067\"},\"children\":\"    bool\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#F69D50\"},\"children\":\" flag\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#F47067\"},\"children\":\" =\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\" str.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#DCBDFB\"},\"children\":\"StartsWith\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#96D0FF\"},\"children\":\"\\\"http://\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\", StringComparison.OrdinalIgnoreCase) \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#F47067\"},\"children\":\"||\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\" str.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#DCBDFB\"},\"children\":\"StartsWith\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\"(\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#96D0FF\"},\"children\":\"\\\"https://\\\"\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\", StringComparison.OrdinalIgnoreCase); \"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\"    \"}]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#F47067\"},\"children\":\"    if\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\" (\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#F47067\"},\"children\":\"!\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#F47067\"},\"children\":\"string\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#DCBDFB\"},\"children\":\"Equals\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\"(fieldToken.Username, str, flag \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#F47067\"},\"children\":\"?\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\" StringComparison.Ordinal \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#F47067\"},\"children\":\":\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\" StringComparison.OrdinalIgnoreCase)) \"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#F47067\"},\"children\":\"      throw\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\" HttpAntiForgeryException.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#DCBDFB\"},\"children\":\"CreateUsernameMismatchException\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\"(fieldToken.Username, str); \"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#F47067\"},\"children\":\"    if\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\" (\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#F47067\"},\"children\":\"!object\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\".\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#DCBDFB\"},\"children\":\"Equals\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\"((\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#F47067\"},\"children\":\"object\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\") fieldToken.ClaimUid, (\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#F47067\"},\"children\":\"object\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\") binaryBlob)) \"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#F47067\"},\"children\":\"      throw\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\" HttpAntiForgeryException.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#DCBDFB\"},\"children\":\"CreateClaimUidMismatchException\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\"(); \"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#F47067\"},\"children\":\"    if\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\" (\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6CB6FF\"},\"children\":\"this\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\"._config.AdditionalDataProvider \"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#F47067\"},\"children\":\"!=\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6CB6FF\"},\"children\":\" null\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#F47067\"},\"children\":\" \u0026\u0026\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#F47067\"},\"children\":\" !\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#6CB6FF\"},\"children\":\"this\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\"._config.AdditionalDataProvider.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#DCBDFB\"},\"children\":\"ValidateAdditionalData\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\"(httpContext, fieldToken.AdditionalData)) \"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[[\"$\",\"span\",null,{\"style\":{\"color\":\"#F47067\"},\"children\":\"      throw\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\" HttpAntiForgeryException.\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#DCBDFB\"},\"children\":\"CreateAdditionalDataCheckFailedException\"}],[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\"(); \"}]]}],\"\\n\",[\"$\",\"span\",null,{\"data-line\":\"\",\"children\":[\"$\",\"span\",null,{\"style\":{\"color\":\"#ADBAC7\"},\"children\":\"} \"}]}]]}]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"What interest us is all possible exception that are throws. You can see that is can raise HttpAntiForgeryException for several case like if the cookie is missing, which is the case for Cross Site Request Forgeries or if the form doesn't have the hidden field, or if the token mismatch between the cookie and the form.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"All the complexity of the mechanism is hidden by the Asp.Net MVC framework. At the end, you only need to remember to add the html helper to your form and to add the attribute to the action of your controller that receive the form inputs.\"}]]]}]]}],[\"$\",\"div\",null,{\"className\":\"layout_paginationBar__jnuuR\",\"children\":[[\"$\",\"div\",null,{\"className\":\"layout_paginationTitle__PsOw5\",\"children\":\"Chronological Blog Articles by Page\"}],[\"$\",\"div\",null,{\"className\":\"layout_paginationLinks__LdBaH\",\"children\":[[\"$\",\"$Lb\",\"1\",{\"className\":\"\",\"href\":\"/blog/page/1\",\"children\":1}],[\"$\",\"$Lb\",\"2\",{\"className\":\"\",\"href\":\"/blog/page/2\",\"children\":2}],[\"$\",\"$Lb\",\"3\",{\"className\":\"\",\"href\":\"/blog/page/3\",\"children\":3}],[\"$\",\"$Lb\",\"4\",{\"className\":\"\",\"href\":\"/blog/page/4\",\"children\":4}],[\"$\",\"$Lb\",\"5\",{\"className\":\"\",\"href\":\"/blog/page/5\",\"children\":5}],[\"$\",\"$Lb\",\"6\",{\"className\":\"\",\"href\":\"/blog/page/6\",\"children\":6}],[\"$\",\"$Lb\",\"7\",{\"className\":\"\",\"href\":\"/blog/page/7\",\"children\":7}],[\"$\",\"$Lb\",\"8\",{\"className\":\"\",\"href\":\"/blog/page/8\",\"children\":8}],[\"$\",\"$Lb\",\"9\",{\"className\":\"\",\"href\":\"/blog/page/9\",\"children\":9}],[\"$\",\"$Lb\",\"10\",{\"className\":\"\",\"href\":\"/blog/page/10\",\"children\":10}],[\"$\",\"$Lb\",\"11\",{\"className\":\"\",\"href\":\"/blog/page/11\",\"children\":11}],[\"$\",\"$Lb\",\"12\",{\"className\":\"\",\"href\":\"/blog/page/12\",\"children\":12}],[\"$\",\"$Lb\",\"13\",{\"className\":\"\",\"href\":\"/blog/page/13\",\"children\":13}],[\"$\",\"$Lb\",\"14\",{\"className\":\"\",\"href\":\"/blog/page/14\",\"children\":14}],[\"$\",\"$Lb\",\"15\",{\"className\":\"\",\"href\":\"/blog/page/15\",\"children\":15}],[\"$\",\"$Lb\",\"16\",{\"className\":\"\",\"href\":\"/blog/page/16\",\"children\":16}],[\"$\",\"$Lb\",\"17\",{\"className\":\"\",\"href\":\"/blog/page/17\",\"children\":17}],[\"$\",\"$Lb\",\"18\",{\"className\":\"\",\"href\":\"/blog/page/18\",\"children\":18}],[\"$\",\"$Lb\",\"19\",{\"className\":\"\",\"href\":\"/blog/page/19\",\"children\":19}],[\"$\",\"$Lb\",\"20\",{\"className\":\"\",\"href\":\"/blog/page/20\",\"children\":20}],[\"$\",\"$Lb\",\"21\",{\"className\":\"\",\"href\":\"/blog/page/21\",\"children\":21}],[\"$\",\"$Lb\",\"22\",{\"className\":\"\",\"href\":\"/blog/page/22\",\"children\":22}],[\"$\",\"$Lb\",\"23\",{\"className\":\"\",\"href\":\"/blog/page/23\",\"children\":23}],[\"$\",\"$Lb\",\"24\",{\"className\":\"\",\"href\":\"/blog/page/24\",\"children\":24}],[\"$\",\"$Lb\",\"25\",{\"className\":\"\",\"href\":\"/blog/page/25\",\"children\":25}],[\"$\",\"$Lb\",\"26\",{\"className\":\"\",\"href\":\"/blog/page/26\",\"children\":26}],[\"$\",\"$Lb\",\"27\",{\"className\":\"\",\"href\":\"/blog/page/27\",\"children\":27}],[\"$\",\"$Lb\",\"28\",{\"className\":\"\",\"href\":\"/blog/page/28\",\"children\":28}],[\"$\",\"$Lb\",\"29\",{\"className\":\"\",\"href\":\"/blog/page/29\",\"children\":29}],[\"$\",\"$Lb\",\"30\",{\"className\":\"\",\"href\":\"/blog/page/30\",\"children\":30}],[\"$\",\"$Lb\",\"31\",{\"className\":\"\",\"href\":\"/blog/page/31\",\"children\":31}],[\"$\",\"$Lb\",\"32\",{\"className\":\"\",\"href\":\"/blog/page/32\",\"children\":32}],[\"$\",\"$Lb\",\"33\",{\"className\":\"\",\"href\":\"/blog/page/33\",\"children\":33}],[\"$\",\"$Lb\",\"34\",{\"className\":\"\",\"href\":\"/blog/page/34\",\"children\":34}],[\"$\",\"$Lb\",\"35\",{\"className\":\"\",\"href\":\"/blog/page/35\",\"children\":35}],[\"$\",\"$Lb\",\"36\",{\"className\":\"\",\"href\":\"/blog/page/36\",\"children\":36}],[\"$\",\"$Lb\",\"37\",{\"className\":\"\",\"href\":\"/blog/page/37\",\"children\":37}],[\"$\",\"$Lb\",\"38\",{\"className\":\"\",\"href\":\"/blog/page/38\",\"children\":38}],[\"$\",\"$Lb\",\"39\",{\"className\":\"\",\"href\":\"/blog/page/39\",\"children\":39}],[\"$\",\"$Lb\",\"40\",{\"className\":\"\",\"href\":\"/blog/page/40\",\"children\":40}],[\"$\",\"$Lb\",\"41\",{\"className\":\"\",\"href\":\"/blog/page/41\",\"children\":41}],[\"$\",\"$Lb\",\"42\",{\"className\":\"\",\"href\":\"/blog/page/42\",\"children\":42}],[\"$\",\"$Lb\",\"43\",{\"className\":\"\",\"href\":\"/blog/page/43\",\"children\":43}],[\"$\",\"$Lb\",\"44\",{\"className\":\"\",\"href\":\"/blog/page/44\",\"children\":44}],[\"$\",\"$Lb\",\"45\",{\"className\":\"\",\"href\":\"/blog/page/45\",\"children\":45}],[\"$\",\"$Lb\",\"46\",{\"className\":\"\",\"href\":\"/blog/page/46\",\"children\":46}],[\"$\",\"$Lb\",\"47\",{\"className\":\"\",\"href\":\"/blog/page/47\",\"children\":47}],[\"$\",\"$Lb\",\"48\",{\"className\":\"\",\"href\":\"/blog/page/48\",\"children\":48}],[\"$\",\"$Lb\",\"49\",{\"className\":\"\",\"href\":\"/blog/page/49\",\"children\":49}],[\"$\",\"$Lb\",\"50\",{\"className\":\"\",\"href\":\"/blog/page/50\",\"children\":50}],[\"$\",\"$Lb\",\"51\",{\"className\":\"\",\"href\":\"/blog/page/51\",\"children\":51}],[\"$\",\"$Lb\",\"52\",{\"className\":\"\",\"href\":\"/blog/page/52\",\"children\":52}],[\"$\",\"$Lb\",\"53\",{\"className\":\"\",\"href\":\"/blog/page/53\",\"children\":53}],[\"$\",\"$Lb\",\"54\",{\"className\":\"\",\"href\":\"/blog/page/54\",\"children\":54}],[\"$\",\"$Lb\",\"55\",{\"className\":\"\",\"href\":\"/blog/page/55\",\"children\":55}],[\"$\",\"$Lb\",\"56\",{\"className\":\"\",\"href\":\"/blog/page/56\",\"children\":56}],[\"$\",\"$Lb\",\"57\",{\"className\":\"\",\"href\":\"/blog/page/57\",\"children\":57}],[\"$\",\"$Lb\",\"58\",{\"className\":\"\",\"href\":\"/blog/page/58\",\"children\":58}],[\"$\",\"$Lb\",\"59\",{\"className\":\"\",\"href\":\"/blog/page/59\",\"children\":59}],[\"$\",\"$Lb\",\"60\",{\"className\":\"\",\"href\":\"/blog/page/60\",\"children\":60}],[\"$\",\"$Lb\",\"61\",{\"className\":\"\",\"href\":\"/blog/page/61\",\"children\":61}],[\"$\",\"$Lb\",\"62\",{\"className\":\"\",\"href\":\"/blog/page/62\",\"children\":62}],[\"$\",\"$Lb\",\"63\",{\"className\":\"\",\"href\":\"/blog/page/63\",\"children\":63}],[\"$\",\"$Lb\",\"64\",{\"className\":\"\",\"href\":\"/blog/page/64\",\"children\":64}],[\"$\",\"$Lb\",\"65\",{\"className\":\"\",\"href\":\"/blog/page/65\",\"children\":65}],[\"$\",\"$Lb\",\"66\",{\"className\":\"\",\"href\":\"/blog/page/66\",\"children\":66}],[\"$\",\"$Lb\",\"67\",{\"className\":\"\",\"href\":\"/blog/page/67\",\"children\":67}],[\"$\",\"$Lb\",\"68\",{\"className\":\"\",\"href\":\"/blog/page/68\",\"children\":68}],[\"$\",\"$Lb\",\"69\",{\"className\":\"\",\"href\":\"/blog/page/69\",\"children\":69}],[\"$\",\"$Lb\",\"70\",{\"className\":\"\",\"href\":\"/blog/page/70\",\"children\":70}],[\"$\",\"$Lb\",\"71\",{\"className\":\"\",\"href\":\"/blog/page/71\",\"children\":71}],[\"$\",\"$Lb\",\"72\",{\"className\":\"\",\"href\":\"/blog/page/72\",\"children\":72}],[\"$\",\"$Lb\",\"73\",{\"className\":\"\",\"href\":\"/blog/page/73\",\"children\":73}],[\"$\",\"$Lb\",\"74\",{\"className\":\"\",\"href\":\"/blog/page/74\",\"children\":74}],[\"$\",\"$Lb\",\"75\",{\"className\":\"\",\"href\":\"/blog/page/75\",\"children\":75}],[\"$\",\"$Lb\",\"76\",{\"className\":\"\",\"href\":\"/blog/page/76\",\"children\":76}],[\"$\",\"$Lb\",\"77\",{\"className\":\"\",\"href\":\"/blog/page/77\",\"children\":77}]]}]]}]]}]}]\n"])</script><script>self.__next_f.push([1,""])</script></body></html>