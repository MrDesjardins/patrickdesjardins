3:I[6405,[],""]
5:I[5337,[],""]
6:I[156,["156","static/chunks/156-2b9f703633e98ef7.js","836","static/chunks/836-7e37630a3372363c.js","308","static/chunks/app/blog/%5Bslug%5D/page-2829e3c199d313ca.js"],""]
4:["slug","trilium-note-taking-with-mini-pc-server-host","d"]
0:["a4Bos24SjnPQDQXQ6bE0n",[[["",{"children":["blog",{"children":[["slug","trilium-note-taking-with-mini-pc-server-host","d"],{"children":["__PAGE__?{\"slug\":\"trilium-note-taking-with-mini-pc-server-host\"}",{}]}]}]},"$undefined","$undefined",true],["",{"children":["blog",{"children":[["slug","trilium-note-taking-with-mini-pc-server-host","d"],{"children":["__PAGE__",{},[["$L1","$L2",[["$","link","0",{"rel":"stylesheet","href":"/_next/static/css/be8a59717d6d5849.css","precedence":"next","crossOrigin":"$undefined"}],["$","link","1",{"rel":"stylesheet","href":"/_next/static/css/97e0a79122e618e4.css","precedence":"next","crossOrigin":"$undefined"}]]],null],null]},[null,["$","$L3",null,{"parallelRouterKey":"children","segmentPath":["children","blog","children","$4","children"],"error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L5",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":"$undefined","notFoundStyles":"$undefined"}]],null]},[[[["$","link","0",{"rel":"stylesheet","href":"/_next/static/css/dabd5e64a469b0e1.css","precedence":"next","crossOrigin":"$undefined"}]],["$","div",null,{"className":"layout_blogbodystyle___Uc1w","children":["$","$L3",null,{"parallelRouterKey":"children","segmentPath":["children","blog","children"],"error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L5",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":"$undefined","notFoundStyles":"$undefined"}]}]],null],null]},[[[["$","link","0",{"rel":"stylesheet","href":"/_next/static/css/4cb872a2a77e328a.css","precedence":"next","crossOrigin":"$undefined"}]],["$","html",null,{"lang":"en","className":"layout_htmlstyle__PseMz","children":["$","body",null,{"className":"layout_bodystyle__4ncsS","children":["$","$L3",null,{"parallelRouterKey":"children","segmentPath":["children"],"error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L5",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":["$","div",null,{"style":{"display":"flex","alignItems":"center","justifyContent":"center","height":"100vh"},"children":["$","div",null,{"style":{"width":"50%","height":"20%","backgroundColor":"#ffeded","borderRadius":12,"padding":12,"textAlign":"center"},"children":[["$","h1",null,{"children":"Not Found"}],["$","p",null,{"children":"Could not find requested resource"}],["$","$L6",null,{"href":"/","children":"Return Home"}]]}]}],"notFoundStyles":[]}]}]}]],null],null],["$L7",null]]]]
8:I[836,["156","static/chunks/156-2b9f703633e98ef7.js","836","static/chunks/836-7e37630a3372363c.js","308","static/chunks/app/blog/%5Bslug%5D/page-2829e3c199d313ca.js"],"Image"]
2:["$","div",null,{"className":"BlogBody_BlogBody__600mT","children":[["$","header",null,{"className":"BlogBody_siteTitle__f7uyb","children":"Patrick Desjardins Blog"}],["$","nav",null,{"children":["$","ul",null,{"className":"BlogBody_navLinks__ZV12t","children":["$","li",null,{"className":"BlogBody_navLinkItem__Pml2e","children":[["$","$L6",null,{"className":"BlogBody_navLinkText__ZtH2y","href":"/","children":"Main Page"}],["$","$L6",null,{"className":"BlogBody_navLinkText__ZtH2y","href":"/blog","children":"Blog"}],["$","$L6",null,{"className":"BlogBody_navLinkText__ZtH2y","href":"/blog/search","children":"Search"}],[["$","$L6","2026",{"className":"BlogBody_navLinkText__ZtH2y","href":"/blog/for/2026","children":2026}],["$","$L6","2025",{"className":"BlogBody_navLinkText__ZtH2y","href":"/blog/for/2025","children":2025}],["$","$L6","2024",{"className":"BlogBody_navLinkText__ZtH2y","href":"/blog/for/2024","children":2024}],["$","$L6","2023",{"className":"BlogBody_navLinkText__ZtH2y","href":"/blog/for/2023","children":2023}],["$","$L6","2022",{"className":"BlogBody_navLinkText__ZtH2y","href":"/blog/for/2022","children":2022}],["$","$L6","2021",{"className":"BlogBody_navLinkText__ZtH2y","href":"/blog/for/2021","children":2021}],["$","$L6","2020",{"className":"BlogBody_navLinkText__ZtH2y","href":"/blog/for/2020","children":2020}],["$","$L6","2019",{"className":"BlogBody_navLinkText__ZtH2y","href":"/blog/for/2019","children":2019}],["$","$L6","2018",{"className":"BlogBody_navLinkText__ZtH2y","href":"/blog/for/2018","children":2018}],["$","$L6","2017",{"className":"BlogBody_navLinkText__ZtH2y","href":"/blog/for/2017","children":2017}],["$","$L6","2016",{"className":"BlogBody_navLinkText__ZtH2y","href":"/blog/for/2016","children":2016}],["$","$L6","2015",{"className":"BlogBody_navLinkText__ZtH2y","href":"/blog/for/2015","children":2015}],["$","$L6","2014",{"className":"BlogBody_navLinkText__ZtH2y","href":"/blog/for/2014","children":2014}],["$","$L6","2013",{"className":"BlogBody_navLinkText__ZtH2y","href":"/blog/for/2013","children":2013}],["$","$L6","2012",{"className":"BlogBody_navLinkText__ZtH2y","href":"/blog/for/2012","children":2012}],["$","$L6","2011",{"className":"BlogBody_navLinkText__ZtH2y","href":"/blog/for/2011","children":2011}]]]}]}]}],["$","div",null,{"className":"BlogBody_blogPictureContainer__IAbPL","children":["$","$L8",null,{"className":"BlogBody_blogTopPicture__L6lao","alt":"Patrick Desjardins picture from a conference","src":"/images/backgrounds/patrickdesjardins_conference_bw.webp","width":800,"height":260}]}],["$","main",null,{"className":"BlogBody_main__XrdKY","children":[["$","h1",null,{"className":"BlogBody_heading__bYRBe","children":"Trilium Note Taking with Mini-PC server host"}],["$","div",null,{"className":"Page_blogPostContainer__AUIcf","children":[["$","p",null,{"className":"Page_blogPostDate__wVWWB","children":["Posted on: ","2025-12-12"]}],[["$","h1",null,{"children":"Why moving to Trilium Note"}],"\n",["$","p",null,{"children":"I have been using Microsoft OneNote since I joined Microsoft as a software engineer in 2014. I am paying Microsoft for storage as my notes increased largely when I did my Master's degree. I was uploading PDFs, annotating with a pen and taking note with a pen as well.\nHowever, I am slowly taking only notes by text as it becomes more efficient to use on my PC (not laptop). Once I completed my Master's, I was not uploading PDF anymore. But, I still continued taking daily note, personal note, general project notes, etc in Microsoft One Note. Until I joined Roblox few weeks ago."}],"\n",["$","p",null,{"children":"For a while, I was looking to move to Obsidian, but the ecosystem seemed quite large, and the hosting solution wasn’t what I wanted. I also wanted something that has not too many features, with a focus on quickly taking note and not tweaking indefinitely. Then, I found a middle ground: easy to install, easy to host if needed, and usable on my mobile phone."}],"\n",["$","h1",null,{"children":"Trilium Note"}],"\n",["$","p",null,{"children":"Trilium is a simple install and focuses on daily notes. You can save folders and notes in HTML. The syntax is quite easy, there is a small toolbar and it saves everything in a SQLite database. I have one instance that I back up weekly backup to a private Git Repository; otherwise, it stays local. At my house, I started migrating the relevant information slowly to a local version as well. I started with a backup to one of my external hard drive but then I realised that I could host on my Mini-PC that I use as a server for a Discord bot to host a server which synchronises my note between my computer and the server. This solution brings my note to my mobile phone. However, it requires some network configuration to access the Mini-PC from my local network at home, everywhere around the world, for my mobile. To do it securely, there are many ways and in this post, I will explain how I use a private VPN."}],"\n",["$","h1",null,{"children":"Network Architecture"}],"\n",["$","p",null,{"children":"The network architecture, before doing anything, looks like the following:"}],"\n",["$","p",null,{"children":["$","img",null,{"src":"/images/blog/minipctrilium1.png","alt":""}]}],"\n",["$","p",null,{"children":"The computer uses a binary version of SQLite in the hard drive of the desktop. The computer has a conventional connection to the Internet using a normal router. In my case, I have an Xfinity router. The Mini-PC runs Ubuntu Server with a direct Ethernet connection to the same router. My phone can connect to a 5G network, but also to any Wi-Fi networks from any place (private or public)."}],"\n",["$","p",null,{"children":["$","img",null,{"src":"/images/blog/minipctrilium2.png","alt":""}]}],"\n",["$","p",null,{"children":"The final architecture diagram contains the Trilium Docker server, which hosts the synchronisation server and the web interface. The architecture contains a large yellow band that is a private VPN. All the notes will only be accessible once authenticated via an encrypted tunnel. That tunnel requires authentication using WireGuard VPN (free). The new architecture allows synchronising local Trilium to the server, allowing the phone to connect to the data."}],"\n",["$","h1",null,{"children":"Configuration Steps"}],"\n",["$","p",null,{"children":"The first step is setting up with Duck DNS (or any DNS server) a way to keep my home IP available from my phone. The IP change once in a while and a trick is having a cron job sending the IP from the Mini-PC. The setup is straightforward:"}],"\n",["$","ol",null,{"children":["\n",["$","li",null,{"children":["Create a free account on ",["$","a",null,{"href":"https://www.duckdns.org/","children":"https://www.duckdns.org/"}]]}],"\n",["$","li",null,{"children":"Copy the unique secret key that allows sending an HTTP request to update the IP"}],"\n",["$","li",null,{"children":"Install a cron job that sends the IP periodically."}],"\n"]}],"\n",["$","pre",null,{"className":"language-sh","children":["$","code",null,{"className":"language-sh code-highlight","children":[["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token shebang important","children":"#!/bin/bash"}],"\n"]}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token builtin class-name","children":"echo"}]," ",["$","span",null,{"className":"token assign-left variable","children":"url"}],["$","span",null,{"className":"token operator","children":"="}],["$","span",null,{"className":"token string","children":"\"https://www.duckdns.org/update?domains=<REVOKED>&token=<REVOKED>&ip=\""}]," ",["$","span",null,{"className":"token operator","children":"|"}]," ",["$","span",null,{"className":"token function","children":"curl"}]," ",["$","span",null,{"className":"token parameter variable","children":"-k"}]," ",["$","span",null,{"className":"token parameter variable","children":"-o"}]," ~/duckdns/duck.log ",["$","span",null,{"className":"token parameter variable","children":"-K"}]," -\n"]}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token function","children":"chmod"}]," +x duck.sh\n"]}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token punctuation","children":"("}],"crontab ",["$","span",null,{"className":"token parameter variable","children":"-l"}]," ",["$","span",null,{"className":"token punctuation","children":";"}]," ",["$","span",null,{"className":"token builtin class-name","children":"echo"}]," ",["$","span",null,{"className":"token string","children":"\"*/5 * * * * ~/duckdns/duck.sh >/dev/null 2>&1\""}],["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token operator","children":"|"}]," ",["$","span",null,{"className":"token function","children":"crontab"}]," -\n"]}]]}]}],"\n",["$","p",null,{"children":"The second phase is setting up the Trilium server with Docker."}],"\n",["$","pre",null,{"className":"language-sh","children":["$","code",null,{"className":"language-sh code-highlight","children":[["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token function","children":"sudo"}]," ",["$","span",null,{"className":"token function","children":"apt"}]," update\n"]}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token function","children":"sudo"}]," ",["$","span",null,{"className":"token function","children":"apt"}]," ",["$","span",null,{"className":"token function","children":"install"}]," ",["$","span",null,{"className":"token parameter variable","children":"-y"}]," ca-certificates ",["$","span",null,{"className":"token function","children":"curl"}]," gnupg lsb-release\n"]}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token function","children":"sudo"}]," ",["$","span",null,{"className":"token function","children":"mkdir"}]," ",["$","span",null,{"className":"token parameter variable","children":"-p"}]," /etc/apt/keyrings\n"]}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token function","children":"curl"}]," ",["$","span",null,{"className":"token parameter variable","children":"-fsSL"}]," https://download.docker.com/linux/ubuntu/gpg ",["$","span",null,{"className":"token operator","children":"|"}]," ",["$","span",null,{"className":"token function","children":"sudo"}]," gpg ",["$","span",null,{"className":"token parameter variable","children":"--dearmor"}]," ",["$","span",null,{"className":"token parameter variable","children":"-o"}]," /etc/apt/keyrings/docker.gpg\n"]}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token builtin class-name","children":"echo"}]," ",["$","span",null,{"className":"token string","children":["\"deb [arch=",["$","span",null,{"className":"token variable","children":[["$","span",null,{"className":"token variable","children":"$$("}],"dpkg --print-architecture",["$","span",null,{"className":"token variable","children":")"}]]}]," signed-by=/etc/apt/keyrings/docker.gpg] \\\n"]}]]}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token string","children":["https://download.docker.com/linux/ubuntu ",["$","span",null,{"className":"token variable","children":[["$","span",null,{"className":"token variable","children":"$$("}],"lsb_release ",["$","span",null,{"className":"token parameter variable","children":"-cs"}],["$","span",null,{"className":"token variable","children":")"}]]}]," stable\""]}]," ",["$","span",null,{"className":"token punctuation","children":"\\"}],"\n"]}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token operator","children":"|"}]," ",["$","span",null,{"className":"token function","children":"sudo"}]," ",["$","span",null,{"className":"token function","children":"tee"}]," /etc/apt/sources.list.d/docker.list\n"]}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token function","children":"sudo"}]," ",["$","span",null,{"className":"token function","children":"apt"}]," update\n"]}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token function","children":"sudo"}]," ",["$","span",null,{"className":"token function","children":"apt"}]," ",["$","span",null,{"className":"token function","children":"install"}]," ",["$","span",null,{"className":"token parameter variable","children":"-y"}]," docker-ce docker-compose-plugin\n"]}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token function","children":"mkdir"}]," ",["$","span",null,{"className":"token parameter variable","children":"-p"}]," ~/trilium/data\n"]}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token builtin class-name","children":"cd"}]," ~/trilium\n"]}]]}]}],"\n",["$","p",null,{"children":"Docker configuration:"}],"\n",["$","pre",null,{"className":"language-sh","children":["$","code",null,{"className":"language-sh code-highlight","children":[["$","span",null,{"className":"code-line","children":["version: ",["$","span",null,{"className":"token string","children":"\"3.8\""}],"\n"]}],["$","span",null,{"className":"code-line","children":"services:\n"}],["$","span",null,{"className":"code-line","children":"  trilium:\n"}],["$","span",null,{"className":"code-line","children":"    image: zadam/trilium:latest\n"}],["$","span",null,{"className":"code-line","children":"    restart: unless-stopped\n"}],["$","span",null,{"className":"code-line","children":"    ports:\n"}],["$","span",null,{"className":"code-line","children":["      - ",["$","span",null,{"className":"token string","children":"\"0.0.0.0:8080:8080\""}],"   ",["$","span",null,{"className":"token comment","children":"# accessible only inside LAN (not exposed to Internet)"}],"\n"]}],["$","span",null,{"className":"code-line","children":"    volumes:\n"}],["$","span",null,{"className":"code-line","children":"      - ./data:/root/trilium-data\n"}]]}]}],"\n",["$","p",null,{"children":"Start the Docker:"}],"\n",["$","pre",null,{"className":"language-sh","children":["$","code",null,{"className":"language-sh code-highlight","children":["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token function","children":"docker"}]," compose up ",["$","span",null,{"className":"token parameter variable","children":"-d"}],"\n"]}]}]}],"\n",["$","p",null,{"children":"The third phase is setting the secure virtual private network (VPN). It requires installing on the Mini-PC WireGuard, which open a new network interface that allows a specific peer to connect. In our case, the WireGuard client will have a secure key that the server can decrypt using a private and public key pair."}],"\n",["$","p",null,{"children":"On the server:"}],"\n",["$","pre",null,{"className":"language-sh","children":["$","code",null,{"className":"language-sh code-highlight","children":[["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token function","children":"sudo"}]," ",["$","span",null,{"className":"token function","children":"apt"}]," update\n"]}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token function","children":"sudo"}]," ",["$","span",null,{"className":"token function","children":"apt"}]," ",["$","span",null,{"className":"token function","children":"install"}]," ",["$","span",null,{"className":"token parameter variable","children":"-y"}]," wireguard qrencode\n"]}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token builtin class-name","children":"cd"}]," /etc/wireguard\n"]}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token function","children":"sudo"}]," wg genkey ",["$","span",null,{"className":"token operator","children":"|"}]," ",["$","span",null,{"className":"token function","children":"sudo"}]," ",["$","span",null,{"className":"token function","children":"tee"}]," server_private.key ",["$","span",null,{"className":"token operator","children":"|"}]," ",["$","span",null,{"className":"token function","children":"sudo"}]," wg pubkey ",["$","span",null,{"className":"token operator","children":"|"}]," ",["$","span",null,{"className":"token function","children":"sudo"}]," ",["$","span",null,{"className":"token function","children":"tee"}]," server_public.key\n"]}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token comment","children":"# Keep these in mind to copy in the conf file"}],"\n"]}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token function","children":"sudo"}]," ",["$","span",null,{"className":"token function","children":"cat"}]," server_private.key\n"]}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token function","children":"sudo"}]," ",["$","span",null,{"className":"token function","children":"cat"}]," server_public.key\n"]}],["$","span",null,{"className":"code-line","children":"\n"}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token function","children":"sudo"}]," ",["$","span",null,{"className":"token function","children":"mkdir"}]," ",["$","span",null,{"className":"token parameter variable","children":"-p"}]," /etc/wireguard\n"]}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token function","children":"sudo"}]," ",["$","span",null,{"className":"token function","children":"nano"}]," /etc/wireguard/wg0.conf\n"]}]]}]}],"\n",["$","p",null,{"children":"Then client keys:"}],"\n",["$","pre",null,{"className":"language-sh","children":["$","code",null,{"className":"language-sh code-highlight","children":["$","span",null,{"className":"code-line","children":["wg genkey ",["$","span",null,{"className":"token operator","children":"|"}]," ",["$","span",null,{"className":"token function","children":"tee"}]," ~/client_private.key ",["$","span",null,{"className":"token operator","children":"|"}]," wg pubkey ",["$","span",null,{"className":"token operator","children":">"}]," ~/client_public.key\n"]}]}]}],"\n",["$","p",null,{"children":"The configuration will depend on your setup, but it should be roughly similar to this. Use the private and public key from the previous step."}],"\n",["$","pre",null,{"className":"language-yaml","children":["$","code",null,{"className":"language-yaml code-highlight","children":[["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token punctuation","children":"["}],"Interface",["$","span",null,{"className":"token punctuation","children":"]"}],"\n"]}],["$","span",null,{"className":"code-line","children":"Address = 10.66.66.1/24\n"}],["$","span",null,{"className":"code-line","children":"ListenPort = 51820\n"}],["$","span",null,{"className":"code-line","children":["PrivateKey = <REDACTED",["$","span",null,{"className":"token punctuation","children":">"}],"\n"]}],["$","span",null,{"className":"code-line","children":"\n"}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token comment","children":"# NAT + forwarding"}],"\n"]}],["$","span",null,{"className":"code-line","children":["PostUp = sysctl ",["$","span",null,{"className":"token punctuation","children":"-"}],"w net.ipv4.ip_forward=1; iptables ",["$","span",null,{"className":"token punctuation","children":"-"}],"A INPUT ",["$","span",null,{"className":"token punctuation","children":"-"}],"i wg0 ",["$","span",null,{"className":"token punctuation","children":"-"}],"j ACCEPT; iptables ",["$","span",null,{"className":"token punctuation","children":"-"}],"A FORWARD ",["$","span",null,{"className":"token punctuation","children":"-"}],"i wg0 ",["$","span",null,{"className":"token punctuation","children":"-"}],"j ACCEPT; iptables ",["$","span",null,{"className":"token punctuation","children":"-"}],"A FORWARD ",["$","span",null,{"className":"token punctuation","children":"-"}],"o wg0 ",["$","span",null,{"className":"token punctuation","children":"-"}],"j ACCEPT; iptables ",["$","span",null,{"className":"token punctuation","children":"-"}],"t nat ",["$","span",null,{"className":"token punctuation","children":"-"}],"A POSTROUTING ",["$","span",null,{"className":"token punctuation","children":"-"}],"o enp1",["$","span",null,{"className":"token punctuation","children":">"}],"\n"]}],["$","span",null,{"className":"code-line","children":["PostDown = iptables ",["$","span",null,{"className":"token punctuation","children":"-"}],"D INPUT ",["$","span",null,{"className":"token punctuation","children":"-"}],"i wg0 ",["$","span",null,{"className":"token punctuation","children":"-"}],"j ACCEPT; iptables ",["$","span",null,{"className":"token punctuation","children":"-"}],"D FORWARD ",["$","span",null,{"className":"token punctuation","children":"-"}],"i wg0 ",["$","span",null,{"className":"token punctuation","children":"-"}],"j ACCEPT; iptables ",["$","span",null,{"className":"token punctuation","children":"-"}],"D FORWARD ",["$","span",null,{"className":"token punctuation","children":"-"}],"o wg0 ",["$","span",null,{"className":"token punctuation","children":"-"}],"j ACCEPT; iptables ",["$","span",null,{"className":"token punctuation","children":"-"}],"t nat ",["$","span",null,{"className":"token punctuation","children":"-"}],"D POSTROUTING ",["$","span",null,{"className":"token punctuation","children":"-"}],"o enp1s0 ",["$","span",null,{"className":"token punctuation","children":"-"}],"j MASQUERADE\n"]}],["$","span",null,{"className":"code-line","children":"\n"}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token punctuation","children":"["}],"Peer",["$","span",null,{"className":"token punctuation","children":"]"}],"\n"]}],["$","span",null,{"className":"code-line","children":["PublicKey = <REDACTED",["$","span",null,{"className":"token punctuation","children":">"}],"\n"]}],["$","span",null,{"className":"code-line","children":["AllowedIPs = 10.66.66.2/32",["$","span",null,{"className":"token punctuation","children":","}],"10.66.66.1/32\n"]}]]}]}],"\n",["$","p",null,{"children":"Enable IP forwarding and UFW firewall access to the UDP protocol on port 51820. The port is chosen for WireGuard to communicate."}],"\n",["$","pre",null,{"className":"language-sh","children":["$","code",null,{"className":"language-sh code-highlight","children":[["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token function","children":"sudo"}]," ",["$","span",null,{"className":"token function","children":"sysctl"}]," ",["$","span",null,{"className":"token parameter variable","children":"-w"}]," ",["$","span",null,{"className":"token assign-left variable","children":"net.ipv4.ip_forward"}],["$","span",null,{"className":"token operator","children":"="}],["$","span",null,{"className":"token number","children":"1"}],"\n"]}],["$","span",null,{"className":"code-line","children":"\n"}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token function","children":"sudo"}]," ufw allow ",["$","span",null,{"className":"token number","children":"51820"}],"/udp\n"]}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token function","children":"sudo"}]," ufw allow ",["$","span",null,{"className":"token keyword","children":"in"}]," on wg0\n"]}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token function","children":"sudo"}]," ufw reload\n"]}]]}]}],"\n",["$","p",null,{"children":"Add the peer section in the WireGuard server. The peer configuration is the secure way to allow a specific client, like my phone."}],"\n",["$","pre",null,{"className":"language-sh","children":["$","code",null,{"className":"language-sh code-highlight","children":["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token function","children":"nano"}]," /etc/wireguard/wg0.conf\n"]}]}]}],"\n",["$","p",null,{"children":["The interface part remains the same, but the peer is new and contains the PublicKey that is from the ",["$","code",null,{"children":"wg genkey"}],"."]}],"\n",["$","pre",null,{"className":"language-yaml","children":["$","code",null,{"className":"language-yaml code-highlight","children":[["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token punctuation","children":"["}],"Interface",["$","span",null,{"className":"token punctuation","children":"]"}],"\n"]}],["$","span",null,{"className":"code-line","children":"Address = 10.66.66.1/24\n"}],["$","span",null,{"className":"code-line","children":"ListenPort = 51820\n"}],["$","span",null,{"className":"code-line","children":["PrivateKey = <REDACTED",["$","span",null,{"className":"token punctuation","children":">"}],"\n"]}],["$","span",null,{"className":"code-line","children":"\n"}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token comment","children":"# NAT + forwarding"}],"\n"]}],["$","span",null,{"className":"code-line","children":["PostUp = sysctl ",["$","span",null,{"className":"token punctuation","children":"-"}],"w net.ipv4.ip_forward=1; iptables ",["$","span",null,{"className":"token punctuation","children":"-"}],"A INPUT ",["$","span",null,{"className":"token punctuation","children":"-"}],"i wg0 ",["$","span",null,{"className":"token punctuation","children":"-"}],"j ACCEPT; iptables ",["$","span",null,{"className":"token punctuation","children":"-"}],"A FORWARD ",["$","span",null,{"className":"token punctuation","children":"-"}],"i wg0 ",["$","span",null,{"className":"token punctuation","children":"-"}],"j ACCEPT; iptables ",["$","span",null,{"className":"token punctuation","children":"-"}],"A FORWARD ",["$","span",null,{"className":"token punctuation","children":"-"}],"o wg0 ",["$","span",null,{"className":"token punctuation","children":"-"}],"j ACCEPT; iptables ",["$","span",null,{"className":"token punctuation","children":"-"}],"t nat ",["$","span",null,{"className":"token punctuation","children":"-"}],"A POSTROUTING ",["$","span",null,{"className":"token punctuation","children":"-"}],"o enp1",["$","span",null,{"className":"token punctuation","children":">"}],"\n"]}],["$","span",null,{"className":"code-line","children":["PostDown = iptables ",["$","span",null,{"className":"token punctuation","children":"-"}],"D INPUT ",["$","span",null,{"className":"token punctuation","children":"-"}],"i wg0 ",["$","span",null,{"className":"token punctuation","children":"-"}],"j ACCEPT; iptables ",["$","span",null,{"className":"token punctuation","children":"-"}],"D FORWARD ",["$","span",null,{"className":"token punctuation","children":"-"}],"i wg0 ",["$","span",null,{"className":"token punctuation","children":"-"}],"j ACCEPT; iptables ",["$","span",null,{"className":"token punctuation","children":"-"}],"D FORWARD ",["$","span",null,{"className":"token punctuation","children":"-"}],"o wg0 ",["$","span",null,{"className":"token punctuation","children":"-"}],"j ACCEPT; iptables ",["$","span",null,{"className":"token punctuation","children":"-"}],"t nat ",["$","span",null,{"className":"token punctuation","children":"-"}],"D POSTROUTING ",["$","span",null,{"className":"token punctuation","children":"-"}],"o enp1s0 ",["$","span",null,{"className":"token punctuation","children":"-"}],"j MASQUERADE\n"]}],["$","span",null,{"className":"code-line","children":"\n"}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token punctuation","children":"["}],"Peer",["$","span",null,{"className":"token punctuation","children":"]"}],"\n"]}],["$","span",null,{"className":"code-line","children":["PublicKey = <REDACTED",["$","span",null,{"className":"token punctuation","children":">"}],"\n"]}],["$","span",null,{"className":"code-line","children":"AllowedIPs = 10.66.66.2/32\n"}]]}]}],"\n",["$","p",null,{"children":[["$","code",null,{"children":"AllowedIPs = 10.66.66.2/32"}]," means only the peer (client, the mobile) needs routing."]}],"\n",["$","p",null,{"children":"The next step is to configure the WireGuard mobile app. There is an easy way to generate a QR code that will move all the configuration to the phone:"}],"\n",["$","p",null,{"children":"Phone:"}],"\n",["$","pre",null,{"className":"language-yaml","children":["$","code",null,{"className":"language-yaml code-highlight","children":[["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token punctuation","children":"["}],"Interface",["$","span",null,{"className":"token punctuation","children":"]"}],"\n"]}],["$","span",null,{"className":"code-line","children":["PrivateKey = <client_private_key",["$","span",null,{"className":"token punctuation","children":">"}],"\n"]}],["$","span",null,{"className":"code-line","children":"Address = 10.66.66.2/32\n"}],["$","span",null,{"className":"code-line","children":"DNS = 1.1.1.1\n"}],["$","span",null,{"className":"code-line","children":"\n"}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token punctuation","children":"["}],"Peer",["$","span",null,{"className":"token punctuation","children":"]"}],"\n"]}],["$","span",null,{"className":"code-line","children":["PublicKey = <server_public_key",["$","span",null,{"className":"token punctuation","children":">"}],"\n"]}],["$","span",null,{"className":"code-line","children":["Endpoint = <REDACTED",["$","span",null,{"className":"token punctuation","children":">"}],".duckdns.org",["$","span",null,{"className":"token punctuation","children":":"}],["$","span",null,{"className":"token number","children":"51820"}],"\n"]}],["$","span",null,{"className":"code-line","children":"AllowedIPs = 0.0.0.0/0\n"}],["$","span",null,{"className":"code-line","children":"PersistentKeepalive = 25\n"}]]}]}],"\n",["$","p",null,{"children":["The ",["$","code",null,{"children":"10.66.66.1"}]," is the IP we will use in the phone browser to access the Trilium web interface via the VPN. In Chrome, going to ",["$","a",null,{"href":"http://10.66.66.1:8080","children":"http://10.66.66.1:8080"}]," goes to the Trilium web interface hosted by the Mini-PC. Port 8080 is the one open in the Mini-PC via Docker."]}],"\n",["$","h1",null,{"children":"Internet Router"}],"\n",["$","p",null,{"children":"The last step is critical: You must go to the router, most likely in the advanced setting and open for the Mini-PC the port 51820 for UDP connection."}],"\n",["$","p",null,{"children":"Understanding the Configuration"}],"\n",["$","p",null,{"children":["The ip ",["$","code",null,{"children":"10.66.66.1"}]," is the Mini-PC IP in the virtual private network (VPN). The ",["$","code",null,{"children":"10.66.66.2"}]," is the IP of the client (phone) in the VPN.\nHere is a visual:"]}],"\n",["$","pre",null,{"className":"language-plaintext","children":["$","code",null,{"className":"language-plaintext code-highlight","children":["$","span",null,{"className":"code-line","children":"[Phone wg0: 10.66.66.2] <--encrypted--> [wg0 on Mini-PC: 10.66.66.1] --> [Docker: 10.0.0.181:8080]\n"}]}]}],"\n",["$","p",null,{"children":["The client configuration of ",["$","code",null,{"children":"1.1.1.1"}]," means the phone uses the Cloudflare DNS for any DNS resolving URL."]}],"\n",["$","p",null,{"children":["The endpoint ",["$","code",null,{"children":"<REDACTED>.duckdns.org:51820"}]," is to find the IP to establish a connection with WireGuard to the Mini-PC."]}],"\n",["$","p",null,{"children":["The ",["$","code",null,{"children":"AllowedIPs = 0.0.0.0/0"}]," means that once the VPN is on, all the traffic goes to the VPN."]}],"\n",["$","p",null,{"children":"In short, it means the traffic goes from the mobile to outside:"}],"\n",["$","pre",null,{"className":"language-plaintext","children":["$","code",null,{"className":"language-plaintext code-highlight","children":["$","span",null,{"className":"code-line","children":"Phone → WireGuard Tunnel → Mini-PC → Trilium (if port 8080)\n"}]}]}],"\n",["$","p",null,{"children":"Internet traffic (not Trilium)"}],"\n",["$","pre",null,{"className":"language-plaintext","children":["$","code",null,{"className":"language-plaintext code-highlight","children":[["$","span",null,{"className":"code-line","children":"Phone → WireGuard tunnel → Mini-PC → Internet → Cloudflare\n"}],["$","span",null,{"className":"code-line","children":"Cloudflare → Internet → Mini-PC → WireGuard tunnel → Phone\n"}]]}]}],"\n",["$","p",null,{"children":["Using ",["$","code",null,{"children":"AllowedIPs = 10.66.66.1/32"}]," tunnels only traffic destined to the Trilium server’s VPN IP. WireGuard routes by IP address, not by application or port, so this works because Trilium is accessed exclusively via 10.66.66.1.  Also, if we do so, we might want to remove the DNS entry, avoiding DNS resolution to go through the tunnel."]}],"\n",["$","h1",null,{"children":"Conclusion"}],"\n",["$","p",null,{"children":"Once WireGuard is enabled on the phone, all traffic is encrypted and sent through a tunnel to the Mini-PC. The Mini-PC acts as the VPN endpoint and routes traffic either to the Trilium server locally or out to the Internet."}],"\n",["$","p",null,{"children":"The Internet is only used as a transport layer for encrypted packets; trafficdoes not exit the tunnel until it reaches the Mini-PC. Trilium is not reachable from the Internet without the VPN. We have now safe notes, that have backup on the Mini-PC and fast access on the desktop!"}]]]}]]}],["$","div",null,{"className":"BlogBody_paginationBar__1gsMc","children":[["$","div",null,{"className":"BlogBody_paginationTitle__H_eFX","children":"Chronological Blog Articles by Page"}],["$","div",null,{"className":"BlogBody_paginationLinks__nk8zd","children":[["$","$L6","1",{"className":"","href":"/blog/page/1","children":1}],["$","$L6","2",{"className":"","href":"/blog/page/2","children":2}],["$","$L6","3",{"className":"","href":"/blog/page/3","children":3}],["$","$L6","4",{"className":"","href":"/blog/page/4","children":4}],["$","$L6","5",{"className":"","href":"/blog/page/5","children":5}],["$","$L6","6",{"className":"","href":"/blog/page/6","children":6}],["$","$L6","7",{"className":"","href":"/blog/page/7","children":7}],["$","$L6","8",{"className":"","href":"/blog/page/8","children":8}],["$","$L6","9",{"className":"","href":"/blog/page/9","children":9}],["$","$L6","10",{"className":"","href":"/blog/page/10","children":10}],["$","$L6","11",{"className":"","href":"/blog/page/11","children":11}],["$","$L6","12",{"className":"","href":"/blog/page/12","children":12}],["$","$L6","13",{"className":"","href":"/blog/page/13","children":13}],["$","$L6","14",{"className":"","href":"/blog/page/14","children":14}],["$","$L6","15",{"className":"","href":"/blog/page/15","children":15}],["$","$L6","16",{"className":"","href":"/blog/page/16","children":16}],["$","$L6","17",{"className":"","href":"/blog/page/17","children":17}],["$","$L6","18",{"className":"","href":"/blog/page/18","children":18}],["$","$L6","19",{"className":"","href":"/blog/page/19","children":19}],["$","$L6","20",{"className":"","href":"/blog/page/20","children":20}],["$","$L6","21",{"className":"","href":"/blog/page/21","children":21}],["$","$L6","22",{"className":"","href":"/blog/page/22","children":22}],["$","$L6","23",{"className":"","href":"/blog/page/23","children":23}],["$","$L6","24",{"className":"","href":"/blog/page/24","children":24}],["$","$L6","25",{"className":"","href":"/blog/page/25","children":25}],["$","$L6","26",{"className":"","href":"/blog/page/26","children":26}],["$","$L6","27",{"className":"","href":"/blog/page/27","children":27}],["$","$L6","28",{"className":"","href":"/blog/page/28","children":28}],["$","$L6","29",{"className":"","href":"/blog/page/29","children":29}],["$","$L6","30",{"className":"","href":"/blog/page/30","children":30}],["$","$L6","31",{"className":"","href":"/blog/page/31","children":31}],["$","$L6","32",{"className":"","href":"/blog/page/32","children":32}],["$","$L6","33",{"className":"","href":"/blog/page/33","children":33}],["$","$L6","34",{"className":"","href":"/blog/page/34","children":34}],["$","$L6","35",{"className":"","href":"/blog/page/35","children":35}],["$","$L6","36",{"className":"","href":"/blog/page/36","children":36}],["$","$L6","37",{"className":"","href":"/blog/page/37","children":37}],["$","$L6","38",{"className":"","href":"/blog/page/38","children":38}],["$","$L6","39",{"className":"","href":"/blog/page/39","children":39}],["$","$L6","40",{"className":"","href":"/blog/page/40","children":40}],["$","$L6","41",{"className":"","href":"/blog/page/41","children":41}],["$","$L6","42",{"className":"","href":"/blog/page/42","children":42}],["$","$L6","43",{"className":"","href":"/blog/page/43","children":43}],["$","$L6","44",{"className":"","href":"/blog/page/44","children":44}],["$","$L6","45",{"className":"","href":"/blog/page/45","children":45}],["$","$L6","46",{"className":"","href":"/blog/page/46","children":46}],["$","$L6","47",{"className":"","href":"/blog/page/47","children":47}],["$","$L6","48",{"className":"","href":"/blog/page/48","children":48}],["$","$L6","49",{"className":"","href":"/blog/page/49","children":49}],["$","$L6","50",{"className":"","href":"/blog/page/50","children":50}],["$","$L6","51",{"className":"","href":"/blog/page/51","children":51}],["$","$L6","52",{"className":"","href":"/blog/page/52","children":52}],["$","$L6","53",{"className":"","href":"/blog/page/53","children":53}],["$","$L6","54",{"className":"","href":"/blog/page/54","children":54}],["$","$L6","55",{"className":"","href":"/blog/page/55","children":55}],["$","$L6","56",{"className":"","href":"/blog/page/56","children":56}],["$","$L6","57",{"className":"","href":"/blog/page/57","children":57}],["$","$L6","58",{"className":"","href":"/blog/page/58","children":58}],["$","$L6","59",{"className":"","href":"/blog/page/59","children":59}],["$","$L6","60",{"className":"","href":"/blog/page/60","children":60}],["$","$L6","61",{"className":"","href":"/blog/page/61","children":61}],["$","$L6","62",{"className":"","href":"/blog/page/62","children":62}],["$","$L6","63",{"className":"","href":"/blog/page/63","children":63}],["$","$L6","64",{"className":"","href":"/blog/page/64","children":64}],["$","$L6","65",{"className":"","href":"/blog/page/65","children":65}],["$","$L6","66",{"className":"","href":"/blog/page/66","children":66}],["$","$L6","67",{"className":"","href":"/blog/page/67","children":67}],["$","$L6","68",{"className":"","href":"/blog/page/68","children":68}],["$","$L6","69",{"className":"","href":"/blog/page/69","children":69}],["$","$L6","70",{"className":"","href":"/blog/page/70","children":70}],["$","$L6","71",{"className":"","href":"/blog/page/71","children":71}],["$","$L6","72",{"className":"","href":"/blog/page/72","children":72}],["$","$L6","73",{"className":"","href":"/blog/page/73","children":73}],["$","$L6","74",{"className":"","href":"/blog/page/74","children":74}],["$","$L6","75",{"className":"","href":"/blog/page/75","children":75}],["$","$L6","76",{"className":"","href":"/blog/page/76","children":76}],["$","$L6","77",{"className":"","href":"/blog/page/77","children":77}],["$","$L6","78",{"className":"","href":"/blog/page/78","children":78}],["$","$L6","79",{"className":"","href":"/blog/page/79","children":79}],["$","$L6","80",{"className":"","href":"/blog/page/80","children":80}],["$","$L6","81",{"className":"","href":"/blog/page/81","children":81}]]}]]}],null]}]
7:[["$","meta","0",{"name":"viewport","content":"width=device-width, initial-scale=1"}],["$","meta","1",{"charSet":"utf-8"}],["$","title","2",{"children":"Patrick Desjardins Blog - Trilium Note Taking with Mini-PC server host"}],["$","meta","3",{"name":"description","content":"Trilium Note Taking with Mini-PC server host"}]]
1:null
