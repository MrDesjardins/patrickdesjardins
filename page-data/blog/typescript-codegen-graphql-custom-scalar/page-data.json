{
    "componentChunkName": "component---src-templates-blog-article-tsx",
    "path": "/blog/typescript-codegen-graphql-custom-scalar",
    "result": {"data":{"mdx":{"frontmatter":{"title":"Typescript and GraphQL: Custom Scalar with Apollo Client","date":"April 19, 2022"},"body":"var _excluded = [\"components\"];\n\nfunction _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\n/* @jsxRuntime classic */\n\n/* @jsx mdx */\nvar _frontmatter = {\n  \"title\": \"Typescript and GraphQL: Custom Scalar with Apollo Client\",\n  \"date\": \"2022-04-19\",\n  \"categories\": [\"typescript\", \"graphql\"]\n};\nvar layoutProps = {\n  _frontmatter: _frontmatter\n};\nvar MDXLayout = \"wrapper\";\nreturn function MDXContent(_ref) {\n  var components = _ref.components,\n      props = _objectWithoutProperties(_ref, _excluded);\n\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(\"p\", null, \"Imagine you must interact with a system that provides 64 bits type, like a \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"long\"), \" in \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://docs.oracle.com/javase/tutorial/java/nutsandbolts/datatypes.html\"\n  }, \"Java\"), \" by GraphQL. The \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://graphql.org/graphql-js/basic-types/\"\n  }, \"GraphQL standard does not have a number\"), \" for 64 bits. \"), mdx(\"p\", null, mdx(\"span\", {\n    parentName: \"p\",\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"461px\"\n    }\n  }, \"\\n      \", mdx(\"a\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-link\",\n    \"href\": \"/static/0fd023d0ca295754a92ca1e6bbc20db5/f816d/CustomScalar-NumberNotNumber.png\",\n    \"style\": {\n      \"display\": \"block\"\n    },\n    \"target\": \"_blank\",\n    \"rel\": \"noopener\"\n  }, \"\\n    \", mdx(\"span\", {\n    parentName: \"a\",\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"21.999999999999996%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA90lEQVQY0x2KC26CQAAFubjHaNLDmLQ1qXarKH6Qogar8hMLCwrICjqNTDJ5meRp8Vkh85qsvJPmNc9uHkADO9ul/ybQBwaiN8IQc2SY8qR+3JBFTFYlrek14XQJ0BZrj/5wxvvnCKHPmdt7zkXF0T8yHZosDZvITUiCjDjIiOKSQinCk4cTOHR7XXpfH4ixYJ/8orl/FW6UYywdDsczfqyQl5IkCNnqBtZAEJo/eOYSuXHYvbxyms6ILjG+PDC1J4wW36xdm0O6RSurmlI1VDXtPrtFKQrXxbMsfNNko49JViusTgc5mbSXq8q53RW3h0I1FaUq+AcVtCYzAUm1SAAAAABJRU5ErkJggg==')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  }), \"\\n  \", mdx(\"img\", {\n    parentName: \"a\",\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"CustomScalar NumberNotNumber\",\n    \"title\": \"CustomScalar NumberNotNumber\",\n    \"src\": \"/static/0fd023d0ca295754a92ca1e6bbc20db5/f816d/CustomScalar-NumberNotNumber.png\",\n    \"srcSet\": [\"/static/0fd023d0ca295754a92ca1e6bbc20db5/5a46d/CustomScalar-NumberNotNumber.png 300w\", \"/static/0fd023d0ca295754a92ca1e6bbc20db5/f816d/CustomScalar-NumberNotNumber.png 461w\"],\n    \"sizes\": \"(max-width: 461px) 100vw, 461px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\",\n    \"decoding\": \"async\"\n  }), \"\\n  \"), \"\\n    \")), mdx(\"p\", null, \"Relying on number cause issue with a number above \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Number/MAX_SAFE_INTEGER\"\n  }, \"2^53 because of how JavaScript handles number\"), \". Hence, above that size, in JavaScript you must create a wrapped type called \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"BigInt\"), \". While this article focuses on \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"Long\"), \" to \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"BigInt\"), \", it is the same issue with many other types like \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"Date\"), \", \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"Time\"), \" or more complex scalar.\"), mdx(\"h1\", null, \"Server Configuration\"), mdx(\"p\", null, \"There is a part that you will need to communicate with the GraphQL server owner. The server cannot send the GraphQL \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"Int\"), \" type, so the server must send the data as a \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"string\"), \". Sending the value as a Java \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"Long\"), \" would create an accuracy issue. The transmission of the data will be a \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"number\"), \" and causes an issue if the value is above 2^53 bit. The best is to have the server marshaling the value into a \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"string\"), \". Hence, inside the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"string\"), \", the value can be above 2^53. It means the value would be in the format: \"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-javascript\"\n  }, \"data : {\\n  YourEntityName: {\\n    myField: \\\"192381290381209381290839012830918209510257182759817287128371298738928\\\"\\n  }\\n}\\n\")), mdx(\"p\", null, \"To specify to the client that the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"string\"), \" is actually not a GraphQL \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"string\"), \", the best is to rely on a \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://graphql.org/learn/schema/\"\n  }, \"custom scalar\"), \". For example, the GraphQL server can create a GraphQL \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"Long\"), \" time. \"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\"\n  }, \"scalar Long\\n\")), mdx(\"p\", null, mdx(\"span\", {\n    parentName: \"p\",\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"461px\"\n    }\n  }, \"\\n      \", mdx(\"a\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-link\",\n    \"href\": \"/static/21596e375df43f9b7d5ba94e089bf567/f816d/CustomScalar-ScalarLong.png\",\n    \"style\": {\n      \"display\": \"block\"\n    },\n    \"target\": \"_blank\",\n    \"rel\": \"noopener\"\n  }, \"\\n    \", mdx(\"span\", {\n    parentName: \"a\",\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"26.333333333333336%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAAAsTAAALEwEAmpwYAAABE0lEQVQY01XPbU+CYBjFcb7/d3KtXBZqhKAVqWk8P3oDeisg8W/i5uq3nV1vzs52KbuyIZdnimNHIVt2+4a2g66Fb8tldDdGe5qhDqfoY5M8Lrk4dw3imFHU4ppKkOxDlPnSYzQxuB+9oL7MMS2bUlZEfoQxWfCmW8RORuoJEndH5KZIKYmygK9gzWA4YKg+oGoqdrZBcdMKJ97zulhjhyVeViNKSRKmWMYaY7rAXnr4mwgRlYR2wuEgCVMfP3fRPzTGpsqnY+HkWxRZnTlWLVVDf+Xp3L/U1i3BNsYyV7zPlljGiiwo+tGrjlMjaX6qPnV7QtYHFG46/jrJmslQY/qooz/PcZYBiSMQcUl36f6v3/wC5ON11vm8gawAAAAASUVORK5CYII=')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  }), \"\\n  \", mdx(\"img\", {\n    parentName: \"a\",\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"CustomScalar ScalarLong\",\n    \"title\": \"CustomScalar ScalarLong\",\n    \"src\": \"/static/21596e375df43f9b7d5ba94e089bf567/f816d/CustomScalar-ScalarLong.png\",\n    \"srcSet\": [\"/static/21596e375df43f9b7d5ba94e089bf567/5a46d/CustomScalar-ScalarLong.png 300w\", \"/static/21596e375df43f9b7d5ba94e089bf567/f816d/CustomScalar-ScalarLong.png 461w\"],\n    \"sizes\": \"(max-width: 461px) 100vw, 461px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\",\n    \"decoding\": \"async\"\n  }), \"\\n  \"), \"\\n    \")), mdx(\"p\", null, \"Therefore, the client knows that type is a \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"Long\"), \", the data is transmitted as a string, and we can tackle the next step with these two pieces of information.\"), mdx(\"h1\", null, \"Client Configuration\"), mdx(\"p\", null, \"On the client-side, there is some work to do. First, I assume you are using TypeScript and \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://www.graphql-code-generator.com/\"\n  }, \"Codegen\"), \" to generate your TypeScript from the GraphQL files. \"), mdx(\"p\", null, mdx(\"span\", {\n    parentName: \"p\",\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"421px\"\n    }\n  }, \"\\n      \", mdx(\"a\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-link\",\n    \"href\": \"/static/351736193a8c82178a35059f817caeab/092ed/CustomScalar-GenTs.png\",\n    \"style\": {\n      \"display\": \"block\"\n    },\n    \"target\": \"_blank\",\n    \"rel\": \"noopener\"\n  }, \"\\n    \", mdx(\"span\", {\n    parentName: \"a\",\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"82.33333333333334%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAAAsTAAALEwEAmpwYAAACgUlEQVQ4y32TiW7jNhRF/f9fVAwCFIOiLTpA0nG9O5YiWSslW4u1L9QpyFTuTMbtAy5EUuTF4zuPi9PphJJt21qGYRCGIW3b0nUdpmlyOB4wTAPP8zifbfzA53q9omKaJq05FkEQEEURz8/PHA4H8jzXhmrN931++/V3Vss1YSCQw0Rbt1RlzeVyeWzoui5JkmBZFo7jkKap3jwMg96QBDnG3sLYvbF+2eJbIXlUcgmTx4bqWk3T0Pc983g2G8cRY2uz/LJm++eR/fKEawSI84X8Wjw25D9Cb5QT+79e+fplxW55ZPOyJ4sKUnGjLprvDGdpQ+Uvp3dN/8w/xjhIXMdj6EeGfmCaHiey6Csf2cYgUxhThkYgu4S6qnQtk+SqiapxlqX3g4PsGaaeXnb0stXqhpbFUBxpchvH/Ip/3jDWDt3tjTgSCBFp2oq6CAV1Xb9fU05cCsHJO2L4r1qmfyLIPRb9bU97O+NZS4S7RdY2/e2ECH0cx73TVz2q2ki1le/52OKNnbHj08+fePr8xPPqhagULLrSRXYxYxtR5S5t4VEXIcPQz3ge1upSRgSZx9ZcY/qveIlDVAT/Ui7KitV6g2laJEmqAWVFy63q6PrxB6LD2NOPHUl2xXYtiirXdV3MPdTUNVVV3TMom5G4mEiqCVuUDOPjTNM0I89yxlG+U74bNo2mqZq67zouacne9Nm+2rxs3rCDlLZtqJtGw1FS713Rl1Leb3A3VK8iyzKKouB2yzl7EUdL8NPTZ/aGi+nECCGI41iTV1+VQFmW3xvOg4/RDVC0kNcjVQdFM/F/MXvcM5yLLeX7PEwq/tjFbKycX1aCg5PpdfX/43P71uNvhGrKKXoJrvAAAAAASUVORK5CYII=')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  }), \"\\n  \", mdx(\"img\", {\n    parentName: \"a\",\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"CustomScalar GenTs\",\n    \"title\": \"CustomScalar GenTs\",\n    \"src\": \"/static/351736193a8c82178a35059f817caeab/092ed/CustomScalar-GenTs.png\",\n    \"srcSet\": [\"/static/351736193a8c82178a35059f817caeab/5a46d/CustomScalar-GenTs.png 300w\", \"/static/351736193a8c82178a35059f817caeab/092ed/CustomScalar-GenTs.png 421w\"],\n    \"sizes\": \"(max-width: 421px) 100vw, 421px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\",\n    \"decoding\": \"async\"\n  }), \"\\n  \"), \"\\n    \")), mdx(\"p\", null, \"I assume you have somehow the whole Graphql Schema and several files in your client repository that have queries, mutations, inputs, and types. Something like:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-yml\"\n  }, \"schema: \\\"output/introspectionResult.json\\\"\\ndocuments: \\\"./src/**/*.graphql\\\"\\noverwrite: true\\ngenerates:\\n    ./src/autogenerated/allTypes.ts:\\n        config:\\n            maybeValue: T | undefined\\n            preResolveTypes: true\\n            avoidOptionals: true\\n        plugins:\\n            - typescript\\n            - typescript-operations\\n\")), mdx(\"p\", null, \"So, you need to add a couple of details to tell Codegen how to generate the proper type for the custom scalar \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"Long\"), \" and to tell Codegen how to convert the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"string\"), \" into a BigInt`.\"), mdx(\"h2\", null, \"TypeScript: Converting the Custom Scalar to Your Type\"), mdx(\"p\", null, \"Inside your codegen.yml you can define a \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"scalars\"), \" option. For a \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"Long\"), \" to a \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"BigInt\"), \" you can have:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\"\n  }, \"scalars:\\n    Long: BigInt\\n\")), mdx(\"p\", null, \"If you execute the generation, you will see that anywhere in your queries that you are fetching a type of \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"Long\"), \" that the TypeScript generated will have the type \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"BigInt\"), \". So, the codegen.yml file looks like this:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-yml\",\n    \"metastring\": \"{10}\",\n    \"{10}\": true\n  }, \"schema: \\\"output/introspectionResult.json\\\"\\ndocuments: \\\"./src/**/*.graphql\\\"\\noverwrite: true\\ngenerates:\\n    ./src/autogenerated/allTypes.ts:\\n        config:\\n            maybeValue: T | undefined\\n            preResolveTypes: true\\n            avoidOptionals: true\\n            scalar Long\\n        plugins:\\n            - typescript\\n            - typescript-operations\\n\\n\")), mdx(\"p\", null, \"However, the work is only for \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"design\"), \" time so far. At \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"runtime\"), \", the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"typeof\"), \" is still a \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"string\"), \".\"), mdx(\"h2\", null, \"Apollo Client: Converting Value to the Proper Type\"), mdx(\"p\", null, \"The second part is the trickiest. It requires having a custom plugin for Codegen. The plugin's goal is to generate a type policy for the Apollo Client. On every GraphQL request, Apollo will inject the response into the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"InMemoryCache\"), \". There is a way with the Apollo Client to have custom logic when data enters the cache. The plugin's goal is to automatically generate these functions for all the fields from your custom scalar. Codegen is the best to know since it analyzes the schema and knows which field is being used in your GraphQL files. Thus, know which field to create the custom policy.\"), mdx(\"p\", null, \"Before diving into the plugin, let's see the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"typePolicies\"), \" property of Apollo Client (version 3).\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-typescript\",\n    \"metastring\": \"{2}\",\n    \"{2}\": true\n  }, \"const cache = new InMemoryCache({\\n    typePolicies: {\\n        YourEntityName: {\\n            fields: {\\n                myField: longBigIntPolicy\\n            },\\n        },\\n    },\\n});\\n\")), mdx(\"p\", null, \"The example shows that add manually a function called \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"longBigIntPolicy\"), \" for the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"YourEntityName.field\"), \" that is of type \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"Long\"), \". While you can do that case by case, a plugin would allow you to handle it for you systematically and have the following code instead.\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-typescript\",\n    \"metastring\": \"{2,3}\",\n    \"{2,3}\": true\n  }, \"const cache = new InMemoryCache({\\n    typePolicies: {\\n      ...scalarTypePolicies,\\n      // You can still define here custom policies\\n    }\\n});\\n\")), mdx(\"h2\", null, \"Codegen: Plugin to Generate the Type Policies\"), mdx(\"p\", null, \"The codegen.yml needs the last modification to call a plugin to generate the type policies for Apollo to consume. \"), mdx(\"p\", null, mdx(\"span\", {\n    parentName: \"p\",\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"421px\"\n    }\n  }, \"\\n      \", mdx(\"a\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-link\",\n    \"href\": \"/static/a11a11d67c3662386489128f9e7ab305/092ed/CustomScalar-Plugin.png\",\n    \"style\": {\n      \"display\": \"block\"\n    },\n    \"target\": \"_blank\",\n    \"rel\": \"noopener\"\n  }, \"\\n    \", mdx(\"span\", {\n    parentName: \"a\",\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"66.66666666666666%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsTAAALEwEAmpwYAAACaElEQVQ4y4WSy27bQAxF9f9/00U36aarpk7SOk5iO3as2pL1fo+kkWS9TjGTxkCBAiVAcETduUPy0ujFlktlUaUmsrAYpMVQW/zP8iYlLH2SOiJrYlIZE1cBxljtaYTNfr3A3P1glDZ9aZLEIZ7n47ru1dM0pWkbsjTjnJxYbpbcfL3hy9cvfHu4xRceRl+ZDNJlbDzG1oeLR187lKVASokQBVVVaS/LUufqqiYQHk5qs3z9yWq/xI5PpG2M0bYNu92WOArZvW6xrCN5num2xmlm/ke70zQRRB6pjHg8/GC5e+Bhs+DV3mDMMwRBQCEEcRzTti1D31M1A37eExU9fiqZ51m7MlWtdbLphhbT3bM7bjHPb/iZi6EAQggNUu18WCl7zlFFkEo2vyKivLn+U8RFUbyfmTFNUxel7Ep4uVx0bJpGz89yQlbbI58+33D/+MrBDomiSAuTZZnGfZjKq7tXQs/z9AtKSXVWc5XdSFZPOGFB0cx4cUn5pwt1WYtT13RdRxxHOl4JkyTRLSjC9XpNFIWIuiUuB8oORAuHk4/jOPpBhf9wVbFS/2O+xvuQ67/UlLIhjGIsxydKMuqmox9Guq7V2DwvcBwXy7Z1tG1bz1GJqgld98xwUYIMMPdqMd59uui2sixHFAV1LWGeGIdWLRVJ7COK9xWbZuUzxiTeSOwnUntF7j6TO0+k5yedK4Mdl2TD1FcMIwTuUX936UFjnf13vMM9ZbhDhk9MfY0xlyfa1MZ8WfDrZYH5fMtpc89xvcDa3FG5jzTBA8wjTJJZmJThkf3qG+bLHc7biuN2SW7/pIuW/AaS9Nb0U8UcuAAAAABJRU5ErkJggg==')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  }), \"\\n  \", mdx(\"img\", {\n    parentName: \"a\",\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"CustomScalar Plugin\",\n    \"title\": \"CustomScalar Plugin\",\n    \"src\": \"/static/a11a11d67c3662386489128f9e7ab305/092ed/CustomScalar-Plugin.png\",\n    \"srcSet\": [\"/static/a11a11d67c3662386489128f9e7ab305/5a46d/CustomScalar-Plugin.png 300w\", \"/static/a11a11d67c3662386489128f9e7ab305/092ed/CustomScalar-Plugin.png 421w\"],\n    \"sizes\": \"(max-width: 421px) 100vw, 421px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\",\n    \"decoding\": \"async\"\n  }), \"\\n  \"), \"\\n    \")), mdx(\"p\", null, \"First, a configuration for the plugin that maps the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"scalarTypePolicies\"), \" types. In that example, there is one type: \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"Long\"), \" and it is mapped to \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"longBigIntPolicy#longBigIntPolicy\"), \" which mean  check in the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"longBigIntPolicy\"), \" file for the function \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"longBigIntPolicy\"), \". \"), mdx(\"p\", null, \"Second, there is the plugin that must be a \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \".js\"), \" file. Here it points to \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"generateScalarPolicies.js\")), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-yml\",\n    \"metastring\": \"{11,12,14}\",\n    \"{11,12,14}\": true\n  }, \"schema: \\\"output/introspectionResult.json\\\"\\ndocuments: \\\"./src/**/*.graphql\\\"\\noverwrite: true\\ngenerates:\\n    ./src/autogenerated/allTypes.ts:\\n        config:\\n            maybeValue: T | undefined\\n            preResolveTypes: true\\n            avoidOptionals: true\\n            scalar Long\\n            scalarTypePolicies:\\n                Long: \\\"../scalarPolicies/longBigIntPolicy#longBigIntPolicy\\\"\\n        plugins:\\n            - ./plugins/output/generateScalarPolicies.js\\n            - typescript\\n            - typescript-operations\\n\")), mdx(\"p\", null, \"The tricky part is the plugin. We need something that scans all your types against the server's GraphQL schema and identifies where to create an entry for each field. The good news is that there is an \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://github.com/homebound-team/graphql-typescript-scalar-type-policies/blob/main/src/index.ts\"\n  }, \"unsupported repository with the plugin\"), \", and it is written in TypeScript! The bad news is that the NPM is not usable, and the project is not supported. So, we need to copy the code and have a script to run the TypeScript into a JavaScript file before executing the Codegen. You can create a bash script that runs TypeScript and use it before one NPM command you have for your project.\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-sh\"\n  }, \"#Content of ./plugins/generate.sh \\nnpx tsc plugins/generateScalarPolicies.ts --target es2018 --module commonjs --moduleResolution node --lib esnext --skipLibCheck true --outDir \\\"./plugings/output/\\\"\\n\")), mdx(\"p\", null, \"Inside your package.json:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-javascript\"\n  }, \"\\\"scripts\\\": {\\n  \\\"gen\\\": \\\"./plugins/generate.sh && graphql-codegen --config codegen.yml\\\"\\n}\\n\")), mdx(\"p\", null, \"The result is that along with your typical generated types, inside \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"allTypes.ts\"), \" (as defined in the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"codegen.yml\"), \" file), you will have a \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"const\"), \" variable.\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-typescript\"\n  }, \"export const scalarTypePolicies = {\\n  // ...\\n}\\n\")), mdx(\"p\", null, \"The constant is the one you need to refer to with Apollo.\"), mdx(\"h1\", null, \"Execution\"), mdx(\"p\", null, \"At that point, you can execute your code and see that the type defined as \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"BigInt\"), \" is also the one at runtime. If you are using \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"typeof\"), \" on the field that was defined to be \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"Long\"), \" in the GraphQL schema, it is \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"not\"), \" a \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"number\"), \", nor a \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"string\"), \" -- it is a \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"BigInt\"), \". Exactly what we desire.\"), mdx(\"h1\", null, \"Conclusion\"), mdx(\"p\", null, \"Using custom scalar in Apollo Client is very cumbersome. The documentation is scarce, and few solutions are wrong. For example, going with the \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://github.com/eturino/apollo-link-scalars#usage\"\n  }, \"Apollo Link\"), \" route will cause your serialization issue once the data gets into the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"InMemoryCache\"), \". Furthermore, that solution requires having the whole schema on the client (browser), which could be impractical for a vast schema. The Codegen solution is elegant because it generates a tailored version of the conversion for your usage and executes once at design time. However, because it requires an unsupported plugin, it raises the question of how well scalar types are supported. A fundamental issue for a system that is based on type. If you look at the problem from the perspective of Apollo, we can see that they are pushed toward a wall: they are in the business of the runtime while the solution must be performed at design time to be efficient. Hence, it must be why \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://github.com/apollographql/apollo-client/issues/8857\"\n  }, \"issues have risen for years in their Github\"), \" without any concrete explanation. On the other side, Codegen has a few Apollo official plugins, but none that perform a type-to-type conversion. Codegen has a \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://www.graphql-code-generator.com/plugins/typescript-apollo-client-helpers\"\n  }, \"Apollo Client type policies helper\"), \", but it is limited to typing the whole policy instead of working on type conversion.\"), mdx(\"p\", null, \"After years of GraphQL standard supporting custom scalar, my final words are that we must still rely on custom code to handle the browser (with Apollo) custom scalar type. That is the reality.\"));\n}\n;\nMDXContent.isMDXComponent = true;"}},"pageContext":{"id":"f0e04a13-539c-5288-be63-9d01200d9e28","totalPages":77}},
    "staticQueryHashes": ["3159585216"]}