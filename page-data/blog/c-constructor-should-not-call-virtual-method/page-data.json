{
    "componentChunkName": "component---src-templates-blog-article-tsx",
    "path": "/blog/c-constructor-should-not-call-virtual-method",
    "result": {"data":{"mdx":{"frontmatter":{"title":"C# Constructor Should not Call Virtual Method","date":"September 28, 2014"},"body":"var _excluded = [\"components\"];\n\nfunction _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\n/* @jsxRuntime classic */\n\n/* @jsx mdx */\nvar _frontmatter = {\n  \"title\": \"C# Constructor Should not Call Virtual Method\",\n  \"date\": \"2014-09-28\",\n  \"categories\": [\"c-sharp\"]\n};\nvar layoutProps = {\n  _frontmatter: _frontmatter\n};\nvar MDXLayout = \"wrapper\";\nreturn function MDXContent(_ref) {\n  var components = _ref.components,\n      props = _objectWithoutProperties(_ref, _excluded);\n\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(\"p\", null, \"Instantiating an object calls obviously the controller of the class. In the case that the class inherit from a second class, the base constructor is called before the code inside the derived class. This can be shown very easily by printing to the console every times the constructor is called. \"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-csharp\"\n  }, \" class Program { static void Main(string[] args) { var classA = new ClassA(); Console.ReadLine(); } }\\n\\npublic class ClassA:ClassB { public ClassA() { Console.WriteLine(\\\"ClassA Constructor\\\"); } } public class ClassB { public ClassB() { Console.WriteLine(\\\"ClassB Constructor\\\"); } } \\n\")), mdx(\"p\", null, mdx(\"span\", {\n    parentName: \"p\",\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"400px\"\n    }\n  }, \"\\n      \", mdx(\"a\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-link\",\n    \"href\": \"/static/41efc5226eeaa6ca9272c4f7fd65df35/e17e5/ConstructorOrderCalls-400x345.png\",\n    \"style\": {\n      \"display\": \"block\"\n    },\n    \"target\": \"_blank\",\n    \"rel\": \"noopener\"\n  }, \"\\n    \", mdx(\"span\", {\n    parentName: \"a\",\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"86.33333333333334%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAYAAADdRIy+AAAACXBIWXMAAAsTAAALEwEAmpwYAAACOElEQVQ4y62Ty07bUBCGzUVizQYJ8qR01YoVhTcAxMPQTQIsWBRKQCpUARLfj+1jn5v9VXYJJSQgVepIvyxZo2/+OTPjJbGlqAzjLCarJH+j4XU0TTOjuq4XyoOaMNTEoSITDUlSkCQZIoUkrtCqQms9A/0ovJaa5wYhIM8sIstI05I4aQhERSwEWqkuuc1tIwhDfgyH3N7cMBwOub6+5vLyO1dXl3h/qjqCVDMRBY/jJ+7vRoxGAaKsKCqFc3YGeHN7y9f9fXZ3d9nb22NnZ4cvXz7zaXsbzxiDc+65panqrgiv2msLT/MuLi7obW2xvr7O5uYmGxsb9Ho91tbW8NTzG7XJsw8/P4gp8Pz8nOWVFTzPm9eve8VkovH9BlE4IlkRFSVBUWFc3U17EXB1dbUDLC0tzQKNtVjrkLLCWvMy/rfuXgPPzs5Yec9hUzc8jDRBYAgCHz8I0Nos3L0p8PT09H1g66YdTK4toVREScpkPMaf+MgoovR9VBxThSHSD3BK0R8M3gc6p2lq+3wZzcuVfNTyhw6fHgvCsCJNa0pVkyk9N4x/ArZnV+SOONIUpaXQBjO3QrPAwWDA8vLyYmB7yw+PEj+QpFFAEicvF/E2pn/7/X63Nu3KtE5b+FSeMY40k8R5RZRJwjghCiOSOEWmgjJOqETWScYpjXWcnHxb7K7bQ2OwxqCsI1eGoiwRQiBEhpYS1X6LAp3lqCzDGcPPuzsODg44PDzsdHR0xPHxcSfPGM3/jN+Kj1217GjubwAAAABJRU5ErkJggg==')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  }), \"\\n  \", mdx(\"img\", {\n    parentName: \"a\",\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"ConstructorOrderCalls 400x345\",\n    \"title\": \"ConstructorOrderCalls 400x345\",\n    \"src\": \"/static/41efc5226eeaa6ca9272c4f7fd65df35/e17e5/ConstructorOrderCalls-400x345.png\",\n    \"srcSet\": [\"/static/41efc5226eeaa6ca9272c4f7fd65df35/5a46d/ConstructorOrderCalls-400x345.png 300w\", \"/static/41efc5226eeaa6ca9272c4f7fd65df35/e17e5/ConstructorOrderCalls-400x345.png 400w\"],\n    \"sizes\": \"(max-width: 400px) 100vw, 400px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\",\n    \"decoding\": \"async\"\n  }), \"\\n  \"), \"\\n    \")), mdx(\"p\", null, \"Having a method virtual allow the derived class to override the method. If the base class call the method, this one call, if overrided, call the one in the derived class. This mean that if you are instantiating value in the derived class that this one will not have the data instantiated yet. This can produce unexpected error like having null reference or working with a set of data that is not initialized with the desired value. The problem is that in the life time of the class, this one could be inherited which create new unexpected scenarios of where the virtual method is defined.\"), mdx(\"p\", null, \"We can transform the previous code into this scenario. For example, let's create a new virtual method where we return a string. In the derived class, we will return the name of the current process. In the base class, we return a simple string. The derived class must instantiated the Process object to get information about the current process. This has been instantiated in the constructor. Since it will be called after that the base constructor is done with its initialization and since the base constructor call the virtual method, this one will crash. The error occurs because the base class call the method that is overrided. The override is executed. It uses a variable that is not yet instanciated.\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-csharp\"\n  }, \" public class ClassA:ClassB { private Process currentProcess; public ClassA() { Console.WriteLine(\\\"ClassA Constructor\\\"); currentProcess = Process.GetCurrentProcess(); }\\n\\npublic override string TestMethod() { return currentProcess.ProcessName; } } public class ClassB { public ClassB() { Console.WriteLine(\\\"ClassB Constructor\\\"); TestMethod(); }\\n\\npublic virtual string TestMethod() { return \\\"Test\\\"; } } \\n\")), mdx(\"p\", null, \"The result is that the TestMethod() from the base class call the TestMethod() of the derived class and crash at the currentProcess line.\"), mdx(\"p\", null, mdx(\"span\", {\n    parentName: \"p\",\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"400px\"\n    }\n  }, \"\\n      \", mdx(\"a\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-link\",\n    \"href\": \"/static/03c4fdf1093a9e48bcf88809328b271a/e17e5/CallingVirtualMethodInConstructorError-400x240.png\",\n    \"style\": {\n      \"display\": \"block\"\n    },\n    \"target\": \"_blank\",\n    \"rel\": \"noopener\"\n  }, \"\\n    \", mdx(\"span\", {\n    parentName: \"a\",\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"60%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsTAAALEwEAmpwYAAACPUlEQVQoz22TaW8USQyG+///nv2AxArQItAiAsvmYCFkJjOTvu+jjq6j+0FdE6IgraVHLlVZr+yyHdWVomkMk/aUfUszdFhr8d4/sSwr63qGZ6zrwrosZ/9INM8LWWZphxGpFcPUM8mJ5+a9Rc8GPVuUNuGs9MxsHNb5J4x1RItfEGqmqCrapkZMAjWMjHVFX9chaH/Y8cfL97x4fcHLvz7z59t/ePHmglfvLnn/6fsTH77cnQWVdgjpEGLLwCOEQkuNkop51jykFX9/vObL1S3X/+25+rrj5tvZX369C37jxz4mMmalqUeGrmboOvq2oK0PjEMWSt2s6QZuvu0CP/YPnJKCwyljf8y43Sd838Xc7h7YHVIi7xeMLpD9v4j+iqm7RvQ39NUlzuggOIiZU6UCaWdIe0cxnBn1gjJLiMuLkqhtNWJaGbXHeP7HVgZpiJs5cF9IklowCc0wScZJMowT3TDxkORESjnKSpEXKbPWeGfx1uCtZXGOFRBSkWRlKDOvOuq2pygbsqIhTisOccHumHJ3nxKFVPuOi9srjtkRIxVOSqyUGCmD4JbB7hBTlg1V1ZAXNUlaBsG87IizmmNShj+NvPNMUjIqhd2GeF2xzgV/rnhFKEvcaJrR0oyavJVUraBpB/KyJclrTknJ/Snbuuwoa0tXe+bJoNRM33UYYx71VtRsKfuZuBKk9UTVTlTNQFX3ZJtg9kswJ3LOhk1athVa3O/teFy3LdttGvyynOO2u8fzxnYf3v3CT81BkjPjyVRgAAAAAElFTkSuQmCC')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  }), \"\\n  \", mdx(\"img\", {\n    parentName: \"a\",\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"CallingVirtualMethodInConstructorError 400x240\",\n    \"title\": \"CallingVirtualMethodInConstructorError 400x240\",\n    \"src\": \"/static/03c4fdf1093a9e48bcf88809328b271a/e17e5/CallingVirtualMethodInConstructorError-400x240.png\",\n    \"srcSet\": [\"/static/03c4fdf1093a9e48bcf88809328b271a/5a46d/CallingVirtualMethodInConstructorError-400x240.png 300w\", \"/static/03c4fdf1093a9e48bcf88809328b271a/e17e5/CallingVirtualMethodInConstructorError-400x240.png 400w\"],\n    \"sizes\": \"(max-width: 400px) 100vw, 400px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\",\n    \"decoding\": \"async\"\n  }), \"\\n  \"), \"\\n    \")), mdx(\"p\", null, \"A simple way to solve this issue is to seal the class, but on the other hand, limit the possibility of expending your class and force you to not have virtual method on this sealed class. Or, you can limit the calls of virtual method inside constructor.\"));\n}\n;\nMDXContent.isMDXComponent = true;"}},"pageContext":{"id":"f4ca530e-c6b2-5ed0-988c-6d695408199e","totalPages":74}},
    "staticQueryHashes": ["3159585216"]}