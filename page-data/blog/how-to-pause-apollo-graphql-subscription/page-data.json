{
    "componentChunkName": "component---src-templates-blog-article-tsx",
    "path": "/blog/how-to-pause-apollo-graphql-subscription",
    "result": {"data":{"mdx":{"frontmatter":{"title":"How to Pause and Resume Apollo GraphQL Subscription using The Guild GraphQL CodeGen","date":"January 2, 2023"},"body":"var _excluded = [\"components\"];\n\nfunction _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\n/* @jsxRuntime classic */\n\n/* @jsx mdx */\nvar _frontmatter = {\n  \"title\": \"How to Pause and Resume Apollo GraphQL Subscription using The Guild GraphQL CodeGen\",\n  \"date\": \"2023-01-02\",\n  \"categories\": [\"apollo\", \"graphql\", \"typescript\"]\n};\nvar layoutProps = {\n  _frontmatter: _frontmatter\n};\nvar MDXLayout = \"wrapper\";\nreturn function MDXContent(_ref) {\n  var components = _ref.components,\n      props = _objectWithoutProperties(_ref, _excluded);\n\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(\"h1\", null, \"Context and Benefits of Autogeneration\"), mdx(\"p\", null, \"Using \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://the-guild.dev/graphql/codegen\"\n  }, \"The Guild GraphQL CodeGen\"), \" is my first instinct when consuming a GraphQL on the front end. It works flawlessly by producing strongly typed TypeScript code to perform your custom GraphQL queries. There is a plugin to generate the operation called \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"typescript-operation\"), \". In the past, I decided to avoid but recently been a fan since it creates your React Hook from your \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \".graphql\"), \" files. It gives you the advantage of not having to \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"import\"), \" the file on each component but instead import the generated code file, which is a \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \".ts\"), \" file. The two benefits are avoiding needing to import a file extension that is not native with \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://create-react-app.dev/\"\n  }, \"React CRA\"), \". Second, it creates for your a hook that is strongly typed.\"), mdx(\"p\", null, \"Here is a snippet of the configuration of the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"codegen.yml\"), \".\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-yaml\"\n  }, \"generates:\\n  Autogenerated.tsx:\\n    plugins:\\n      - typescript\\n      - typescript-operations\\n      - typescript-react-apollo\\n\")), mdx(\"h1\", null, \"Why Pausing?\"), mdx(\"p\", null, \"There are many reasons surrounding the viability of pausing a subscription. The WebSocket might be pushing a lot of messages, and the user may want to \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"freeze\"), \" the user interface of changes. Or, maybe you want to keep the application operational but do not want to receive any further notice of new data. You may want to do it when the user is not active on the tab of your application. Regardless of the reason, being able to pause the stream of data and unpause it is a scenario that occurs.\"), mdx(\"h1\", null, \"How to Pause?\"), mdx(\"p\", null, \"Results on the Internet on the topic of pausing a subscription are very scarce. I stumbled upon the following solution by avoiding requests on the query using the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"skip\"), \" option on the query. It happens that the subscription has the same property. The generated hook opens access to the choice and next to the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"variables\"), \" property, you will see a \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"skip\"), \" option.\"), mdx(\"p\", null, \"When the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"skip\"), \" option is \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"true\"), \", the WebSocket closes its connection. When the value is \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"false\"), \", a new connection is established. Hence, we can toggle between pause and unpause by having a React state that is a boolean.\"), mdx(\"h1\", null, \"Pseudo-Code\"), mdx(\"p\", null, \"In a nutshell, your component looks like this:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-tsx\"\n  }, \"export const YourComponent = (props: YourComponentProps) => {\\n  const [isPaused, setIsPaused] = useState<boolean>(false); // By default, we have the connection pushing data\\n  // ...\\n  useYourGeneratedFunctionSubscription({\\n    onData(options) {\\n      // Do something with the data in options.data\\n    },\\n    skip: isPaused\\n  });\\n  //\\n  return <div>...</div>;\\n};\\n\")), mdx(\"h1\", null, \"Considerations of Missing Data\"), mdx(\"p\", null, \"Going further on the path of pausing, you will get into the situation where the user un-pause. The pattern described works by switching the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"isPaused\"), \" to \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"false\"), \", a new WebSocket connection is created, and the data starts to flow again. However, there needs to be more data. For example, if you are fetching data that is pushed into a grid and you pause for 1 minute, on resume, you will have the data from the time before the pause and after the minute. Where is the data from the paused minute? Hence, when the user resumes the subscription, it is wise to perform a GraphQL Query to fetch the data. \"), mdx(\"p\", null, \"In my cases, I fetch all the data as if the user were to start the application again and start with a fresh data slate. However, keep in mind that there is still a case of missing or duplicate data. For example, if you are fetching the data and then opening the WebSocket connection, there might be missing data. If it takes 5 seconds for the response to come back, then new data was created but not in the response nor the WebSocket. The reason is that the connection opened once the response was received, leaving a window where new data was never transmitted.\"), mdx(\"p\", null, mdx(\"span\", {\n    parentName: \"p\",\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"966px\"\n    }\n  }, \"\\n      \", mdx(\"a\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-link\",\n    \"href\": \"/static/41e532833c7ee45292c83da93d5779d3/5bf79/graphql_subscription_pause1.png\",\n    \"style\": {\n      \"display\": \"block\"\n    },\n    \"target\": \"_blank\",\n    \"rel\": \"noopener\"\n  }, \"\\n    \", mdx(\"span\", {\n    parentName: \"a\",\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"61%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsTAAALEwEAmpwYAAABgUlEQVQoz42TW4+iQBCF/f//ax7nYZ8ENhGNGUQXhW4uDaKezVduE+Zpp5JKV9flcKqq2UjS6/Xi0P1+V1mWGsdRj8fD7lGnabJz/mfP8/wt9nw+zbeJYAiOpmnUdZ3atjWNtvfeYs571U1jd9+25rvdbur7XnVdawPQ+XzWMAwLK04SrGiloet0HwbNaAga+159133rxgAvl4sBRCctn04nOeeU57nZ3jm1xZcuu51+fXzo63emtijkrpXWsjCkNVhCH+pZlilJEtM0TZWlqcp8pzLPtf381DFJ9OewV129ARkduoHu4XAwEFgCzJCZG+A2N+esZeLTGDRPkx7zrBAG860Xawzj1kIItq2fCmSoiWIMMWAIC4BJ+qnwcTqBDLowpC3AUFrgq8yTkxHERXFfx8g9Ho/vpXn/BqRgv9/bppljVVXLeb1eVRSFLY0HTyF5xJgvcV7Bdru1GgMkGB8nNl+GPoxQWEdm0YdG1hAixn1peT3k9Z/zPyF3PXOW8hcV8aDTu/1bVAAAAABJRU5ErkJggg==')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  }), \"\\n  \", mdx(\"img\", {\n    parentName: \"a\",\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"graphql subscription pause1\",\n    \"title\": \"graphql subscription pause1\",\n    \"src\": \"/static/41e532833c7ee45292c83da93d5779d3/5bf79/graphql_subscription_pause1.png\",\n    \"srcSet\": [\"/static/41e532833c7ee45292c83da93d5779d3/5a46d/graphql_subscription_pause1.png 300w\", \"/static/41e532833c7ee45292c83da93d5779d3/0a47e/graphql_subscription_pause1.png 600w\", \"/static/41e532833c7ee45292c83da93d5779d3/5bf79/graphql_subscription_pause1.png 966w\"],\n    \"sizes\": \"(max-width: 966px) 100vw, 966px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\",\n    \"decoding\": \"async\"\n  }), \"\\n  \"), \"\\n    \")), mdx(\"p\", null, \"There might be duplicate data if you are starting the WebSocket at the same time you start the request to fetch the data, as the WebSocket may push some data that will be present in the query response. In the example below, the server pushes data twice while building the response. Hence, the query response will contain the data already pushed. However, on the third push, the data is not from the initial response. So, upon reception of the initial query, filtering out the information already received from the WebSocket is desired. In many scenarios, the amount of data filtered out is small as most of the data comes from prior to the WebSocket connection and is unavailable in the few seconds of the GraphQL query request and response.\"), mdx(\"p\", null, mdx(\"span\", {\n    parentName: \"p\",\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"966px\"\n    }\n  }, \"\\n      \", mdx(\"a\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-link\",\n    \"href\": \"/static/6f9950729d422fae9a119afcda0ac43a/5bf79/graphql_subscription_pause2.png\",\n    \"style\": {\n      \"display\": \"block\"\n    },\n    \"target\": \"_blank\",\n    \"rel\": \"noopener\"\n  }, \"\\n    \", mdx(\"span\", {\n    parentName: \"a\",\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"61%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsTAAALEwEAmpwYAAAB2ElEQVQoz2WRi7KjIAyG+/4P2GO7x1pvKHIREVSs+u+EWTvtLDOZQBI+/pALABzHQQ7ruqJtW4QQsO87Xq9XNIpTjDydaX/mzvxZfzlhtChgjME4jrDWYhiGt6d43/fRa62jP/dSSjjnYv5CIMZYvEQvLcsSwVRAMYJ776NRbtu2t7J5nuODnx1EIL0wTVMsoAQZ5zzCiqKIeQKSGuroE0g1n+sLSKroEhWlaYokSd52vV4jnBSdrSulYhfnHMgu1MLz+YxFznk477FtO0JY/7U6xbi1I6Zpfg9kjzUBk5/wOdjLOV2CzH7AsWoEz6G7DM4wWF3B9hWwjXitPcTAUbY5mKzQKgZt5bdCOpRlEVs49hVDzzH5AZLn4CyFURW85cDusUwcahBggoFrjk53EKYjHEjgG0h/RyrnecL9fkOa/qIqn1BKwOgO66yxeIXRVnDBYtkXhCPABQc5iG+FBKM/7Dq63KKXBVRX4H67IrndUZUZ6ioHbzmEyOCDhVsc9KChjEIj6m8gTZgG0vcGvMnBihu6JkPLHmjrR9xnjz/IsgxS5hFovMFP8hOnn9fZ/394rrB4DH2Lnj5blDCqhlENpKgheQnRFWgkQyNrFFUO1tRQ5nsofwHYJJg49KvC6QAAAABJRU5ErkJggg==')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  }), \"\\n  \", mdx(\"img\", {\n    parentName: \"a\",\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"graphql subscription pause2\",\n    \"title\": \"graphql subscription pause2\",\n    \"src\": \"/static/6f9950729d422fae9a119afcda0ac43a/5bf79/graphql_subscription_pause2.png\",\n    \"srcSet\": [\"/static/6f9950729d422fae9a119afcda0ac43a/5a46d/graphql_subscription_pause2.png 300w\", \"/static/6f9950729d422fae9a119afcda0ac43a/0a47e/graphql_subscription_pause2.png 600w\", \"/static/6f9950729d422fae9a119afcda0ac43a/5bf79/graphql_subscription_pause2.png 966w\"],\n    \"sizes\": \"(max-width: 966px) 100vw, 966px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\",\n    \"decoding\": \"async\"\n  }), \"\\n  \"), \"\\n    \")), mdx(\"p\", null, \"A native solution does not exist using Apollo Client. However, leaning toward duplication is reasonable if your data has a unique identifier (or is timestamped), as it is easy to filter out. On the contrary, it is only possible to substitute present information. Thus, opening the WebSocket upon receiving the initial data is suboptimal for your user because it cannot guarantee that all the data is available.\"), mdx(\"h1\", null, \"Optimization\"), mdx(\"p\", null, \"Depending on how your data is structured, you may resume the data by fetching only the missing delta. Data with a sequential number or based on time can persist the last receive data in memory. When the action of resuming streaming the data starts, a GraphQL Query is performed with the last data id (or timestamp) and the response containt only the information since this last piece of information. The optimization adds complexity to support querying from a specific point in time but is suitable for an architecture based on cursor like \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://relay.dev/graphql/connections.htm#sec-undefined.PageInfo\"\n  }, \"GraphQL Relay\"), \".  For example, in the illustration below, the user pauses at \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"T2\"), \" and resumes at \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"T6\"), \". At \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"T6\"), \", the subscription turns \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"skip: false\"), \", creating a new WebSocket connection and getting the latest data. At the same time, a GraphQL Query fetching data from \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"T2 to T6\"), \" is triggered. \"), mdx(\"p\", null, mdx(\"span\", {\n    parentName: \"p\",\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"573px\"\n    }\n  }, \"\\n      \", mdx(\"a\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-link\",\n    \"href\": \"/static/2dbc8472f878849d63ce2bf255142722/3c024/graphql_subscription_pause3.png\",\n    \"style\": {\n      \"display\": \"block\"\n    },\n    \"target\": \"_blank\",\n    \"rel\": \"noopener\"\n  }, \"\\n    \", mdx(\"span\", {\n    parentName: \"a\",\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"87.00000000000001%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAYAAADdRIy+AAAACXBIWXMAAAsTAAALEwEAmpwYAAACiElEQVQ4y32U2W7bMBBF/f9/VLRAgT41bdrmIY1jedNia99s7dRyiqGX2EBSATQFWjycuXeGM4BpmvR4e9evqGEiSEqWG4vX5Za5sWZj7fn7umJj7ciODXU7yC4uz+wCkmccRw2UWT6qW0Ve9fQT+FHG3NhomOl4qBGKZqBs+ru9syRJWCwWBEFAHMeUZUmWZUzTSBAmOH5Gkpfs/VhH5LghedGwNnckeYWxthj6Ht/3GYaBmfwIpK5r0jTVf3ieRxD4bC2HF8PC3vmstg6Wnm02lqtTl/l5vsL3Pb0vz3Nml3QFLAtN01CUJarr2LkBS9PTEUmUcVboqOKs1LMf5cyNLW3TUFWV3nvVsG1biqK46tkrheeHeGFK10M3gOjf9qe50xr2LFY2t88d8HA4nJwG6rrCNC2M1YayUdQKqnak7iaqbtQHHOuBF8M8m3KqlHeBJ5dhY9qY+0hvvoU1CtK8JEoynL1P09TXsnsXKFpYlsV2u8VxHJzdnjg96lQFLJUSJTnL1RpjucK27WsQ7wLFcSmjKIpwXZcwjE5ajugI63PKIoPtxtw2x7tAcUxAUpdpmhAEIW6QnIDn1MWcou4xd+EV+GGEUkJZmuJ6AfY+wAtijpWi7iTCSY+iVoRJwdPzQhe2YD6M8LLWj1C2k26z6mxIrU6wIIx5/PWb7w8PWp6u6/5TNnptolUDh6o/uduOGioOH6uOrWnpbpJmkC4R3e+AcoK04G2EnRr05SCgsh31EO3CtNDO++cWFfOkMu6ASqnrKW/AURevpC43znAeTTfgej7rjcnCWGnzRPc7oCwI9Bao+pFdVPFjHvDpweLzT4cvjw5f/+z59uSydo9U+vp6u0v/AZDjHMJTHAEjAAAAAElFTkSuQmCC')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  }), \"\\n  \", mdx(\"img\", {\n    parentName: \"a\",\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"graphql subscription pause3\",\n    \"title\": \"graphql subscription pause3\",\n    \"src\": \"/static/2dbc8472f878849d63ce2bf255142722/3c024/graphql_subscription_pause3.png\",\n    \"srcSet\": [\"/static/2dbc8472f878849d63ce2bf255142722/5a46d/graphql_subscription_pause3.png 300w\", \"/static/2dbc8472f878849d63ce2bf255142722/3c024/graphql_subscription_pause3.png 573w\"],\n    \"sizes\": \"(max-width: 573px) 100vw, 573px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\",\n    \"decoding\": \"async\"\n  }), \"\\n  \"), \"\\n    \")), mdx(\"p\", null, \"Thus, my recommendation is that if you are \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"not\"), \" using a cursor your data can be fetched affordly from without delta to fetch everything. That should be many scenarios. However, if you have infinite data, like a news feed, and that this data is already provided using cursor that getting delta might be the best solution. The main issue with delta fetching during resuming is that it might fetch from a long time ago. For example, if someone goes out to vacation for one week and unpause, the data sent will be dated from a week ago. Fetching everything does not prevent over fetching but rely on the same logic that you have when the user enter the application meaning that it must already have a logic in place. As long as the delta logic on the backend has similar limit on data being fetched, it will work fine.\"), mdx(\"h1\", null, \"Conclusion\"), mdx(\"p\", null, \"Whether you are autogenerating or not, the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"skip\"), \" value is available if you use the \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://www.apollographql.com/docs/react/data/queries/\"\n  }, \"Apollo Client\"), \". The surprising news is that it works well with the \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://www.apollographql.com/docs/react/data/subscriptions\"\n  }, \"Apollo Client Subscription\"), \" and behaves as a way to pause the data pushed into your application from the WebSocket beneath the GraphQL Subscription mechanism.\"));\n}\n;\nMDXContent.isMDXComponent = true;"}},"pageContext":{"id":"0eb2d11e-d58b-5853-8177-4981d840f984","totalPages":74}},
    "staticQueryHashes": ["3159585216"]}