{
    "componentChunkName": "component---src-templates-blog-article-tsx",
    "path": "/blog/enterprise-asp-net-mvc-part-2-building-the-model",
    "result": {"data":{"mdx":{"frontmatter":{"title":"Enterprise Asp.Net MVC Part 2: Building The Model","date":"October 26, 2012"},"body":"var _excluded = [\"components\"];\n\nfunction _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\n/* @jsxRuntime classic */\n\n/* @jsx mdx */\nvar _frontmatter = {\n  \"title\": \"Enterprise Asp.Net MVC Part 2: Building The Model\",\n  \"date\": \"2012-10-26\",\n  \"categories\": [\"asp-mvc\", \"c-sharp\", \"enterprise\", \"web\"]\n};\nvar layoutProps = {\n  _frontmatter: _frontmatter\n};\nvar MDXLayout = \"wrapper\";\nreturn function MDXContent(_ref) {\n  var components = _ref.components,\n      props = _objectWithoutProperties(_ref, _excluded);\n\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(\"p\", null, \"This is part 2 of the enterprise Asp.Net MVC web application creation. We have before discussed about the project that we will develop and now we will work on the model. We will create all classes first.\"), mdx(\"p\", null, \"If we remember the UML class diagram, we will have to create 5 classes. One for the Workout, one the for WorkoutSession, one for the Exercise, one for the Muscle and one for the MuscleGroup.\"), mdx(\"p\", null, mdx(\"span\", {\n    parentName: \"p\",\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"399px\"\n    }\n  }, \"\\n      \", mdx(\"a\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-link\",\n    \"href\": \"/static/c7c4eb1c2f4f284145ace382d586dc69/a307d/modelClassDiagram.png\",\n    \"style\": {\n      \"display\": \"block\"\n    },\n    \"target\": \"_blank\",\n    \"rel\": \"noopener\"\n  }, \"\\n    \", mdx(\"span\", {\n    parentName: \"a\",\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"77.33333333333333%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAIAAABr+ngCAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABpUlEQVQoz42S646jMAyFef/X6iNQppVKKwTkAiFOQm6NwmU0WB3tqqPZ/f7FznGcYxd93xtjLpcLAEgp27YFAMZYCGHf93Vd9303xjjntNbDMJRlWVXVOI4AUDweD6WUlFIpRQg5nU7OOe+9fYMQMgyDc85ayxgTQhScc621epFSWpZl/5tt2/B9Y8zHx8f1erXWGmOKH+/9CKY454wxY0xKqcDQdvBP8bqu8cB7H2Ms/pT9rsTs8/m01gIA57wYhoFSej6f0Xbv/XsJVGqtq6oqD2632zzPRdd1AEAImaYJACil2JV74b0PIVhrm6bpuo4QQintuk5K+SXGGTrnjDHWWrRkOcg5M8aaptFaA4BSCivCQRFjDCEQQoQQlNJ5ntGY757XdV2WZdu2nHOM8XkQY8w5F5jGNQAAa+3+33yJc87YsxDifUN+E+Ni1XUtpcTR46++b6SUtNYppRgj5xw9G8cxhFC0bSuEKMuScw4Afd9LKYUQ+DdUEkLmeZ6m6X6/V1V1uVzqulZKFX3f4zCcc0opzjlq4gs8hhDGcTTGYBDN/wS9qFjSXOpk+QAAAABJRU5ErkJggg==')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  }), \"\\n  \", mdx(\"img\", {\n    parentName: \"a\",\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"modelClassDiagram\",\n    \"title\": \"modelClassDiagram\",\n    \"src\": \"/static/c7c4eb1c2f4f284145ace382d586dc69/a307d/modelClassDiagram.png\",\n    \"srcSet\": [\"/static/c7c4eb1c2f4f284145ace382d586dc69/5a46d/modelClassDiagram.png 300w\", \"/static/c7c4eb1c2f4f284145ace382d586dc69/a307d/modelClassDiagram.png 399w\"],\n    \"sizes\": \"(max-width: 399px) 100vw, 399px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\",\n    \"decoding\": \"async\"\n  }), \"\\n  \"), \"\\n    \")), mdx(\"p\", null, \"All these classes will be used to contain the business logic but also to contains the Entity from Entity Framework 5. Since we are building in \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"Code First\"), \" mode with Entity Framework, we have to develop all business logic (model) classes first then the database will be generated by Entity Framework ORM.\"), mdx(\"p\", null, \"So far, if I translate the Model diagram into classes I have :\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-csharp\"\n  }, \" public class BaseModel { public int Id { get; set; } }\\n\\npublic class Workout:BaseModel { public DateTime StartTime { get; set; } public DateTime EndTime { get; set; } public string Name { get; set; } public string Goal{ get; set; } public ICollection<WorkoutSession> Sessions { get; set; } }\\n\\npublic class WorkoutSession:BaseModel { public string Name { get; set; } public ICollection<Exercise> Exercises { get; set; } }\\n\\npublic class Exercise:BaseModel { public string Name { get; set; } public string Repetitions { get; set; } public string Weights { get; set; } public string Tempo { get; set; } public TimeSpan RestBetweenSet{ get; set; } public virtual Muscle Muscle { get; set; } public ICollection<WorkoutSession> WorkoutSessions { get; set; } }\\n\\npublic class Muscle : BaseModel { public string Name { get; set; } public virtual MuscleGroup Group { get; set; } public ICollection<Exercise> Exercises { get; set; } }\\n\\npublic class MuscleGroup:BaseModel { public string Name { get; set; } public ICollection<Muscle> Muscles { get; set; } } \\n\")), mdx(\"p\", null, \"Indeed, I separate all these classes into individual file. Few modeling problem raised on my mind while I was writing those classes. First, every exercise need to be sorted for the user because every exercise are always done in a specific order. We need to add an Order property but we cannot add it to the Exercise class because the order will change depending of the workout session. For example, I may have the \\\"Bicep Curl\\\" exercise done in first on Monday and last on Friday. Also, we will create a directory of Exercise later so we need to have the \\\"meta data\\\" of exercise somewhere else from the exercise of the workout session. In fact, if we put out database glasses, this information would be in a junction table. If we put back our developer glasses, we will simply have a WorkouttSessionExecise that will have 1-1 relationship to an Exercise. So, let's modify the model diagram and the class.\"), mdx(\"p\", null, \" \", mdx(\"span\", {\n    parentName: \"p\",\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"400px\"\n    }\n  }, \"\\n      \", mdx(\"a\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-link\",\n    \"href\": \"/static/646890f1a6e0969d43bd31732f7f4df4/e17e5/modelClassDiagramVersion3-400x302.png\",\n    \"style\": {\n      \"display\": \"block\"\n    },\n    \"target\": \"_blank\",\n    \"rel\": \"noopener\"\n  }, \"\\n    \", mdx(\"span\", {\n    parentName: \"a\",\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"75.33333333333333%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAAsTAAALEwEAmpwYAAABvklEQVQ4y3WU2a6CYAyE//d/MeOFXhj3uEXcN9wVFXry9WQIIdqk4QfamXZaCJPJxKIoskajYZvNxrhfr9c2nU5tuVza6/XK/fP52PV69bj9fm/z+dxqtZpVq1WP3+12Fki63W52Pp89qdVqWbfbtSzL7PF45H6/3x0MJ361Wlkcx37m/eFw8Puw3W4dDNbFYmGn0ymvggAC8ePxaO/322QQkEdlFMEZD2maeiswDgYDg2A0Glm9XncZ5O122yWgGqoCnC4gHY/H3i7vAmyAwogBDihVXS4XZ+WqSnkHOV1gACsX85YRGCYYsefzmWtVdJJxValiICQfmQIHplypVPJAAZdNzxke1QJALhLNZjPXOTAIhG02m74uuMQHoOgyZEFvHG3Zin6/7yQBMHRiujgSkFAGxJCBApBIW6BV0kYEbgAikJIJ/lahBoAsSZL4uagzZ577lDkACgsT1NR+tVzUs/wuFEcPKFWWE3+BfjOfMu32er18/zRFrkVjRaQbXTFAlprvn6WnqMDY+cg7nY6DcI/gBCuZPdOVRL4K/UCYMD4cDv+HQjJsOAtNMIn6JLXMctpWB5DoT8SZPfwDnuR8yPmAOIYAAAAASUVORK5CYII=')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  }), \"\\n  \", mdx(\"img\", {\n    parentName: \"a\",\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"modelClassDiagramVersion3 400x302\",\n    \"title\": \"modelClassDiagramVersion3 400x302\",\n    \"src\": \"/static/646890f1a6e0969d43bd31732f7f4df4/e17e5/modelClassDiagramVersion3-400x302.png\",\n    \"srcSet\": [\"/static/646890f1a6e0969d43bd31732f7f4df4/5a46d/modelClassDiagramVersion3-400x302.png 300w\", \"/static/646890f1a6e0969d43bd31732f7f4df4/e17e5/modelClassDiagramVersion3-400x302.png 400w\"],\n    \"sizes\": \"(max-width: 400px) 100vw, 400px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\",\n    \"decoding\": \"async\"\n  }), \"\\n  \"), \"\\n    \")), mdx(\"p\", null, \"The modification need to be reflected into the classes.\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-csharp\"\n  }, \" public class WorkoutSession:BaseModel { public string Name { get; set; } public ICollection<WorkoutSessionExercise> WorkoutSessionExercises { get; set; } public virtual Workout Workout { get; set; } }\\n\\npublic class WorkoutSessionExercise:BaseModel { public int Order { get; set; } public string Repetitions { get; set; } public string Weights { get; set; } public string Tempo { get; set; } public TimeSpan RestBetweenSet { get; set; } public virtual Exercise Exercise { get; set; } public virtual WorkoutSession WorkoutSession { get; set; } }\\n\\npublic class Exercise:BaseModel { public string Name { get; set; } public virtual Muscle Muscle { get; set; } public ICollection<WorkoutSessionExercise> WorkoutSessionExercices { get; set; } } \\n``` As you can see, if have also moved the repetition, weight, tempo and all specific user/workout session information into something that will let the user add his information while having the Exercise class having the static information like the name of the exercise and the muscle concerned.\\n\\nThe BaseModel class is used to have similar information like the primary key which is an Integer. Later, other information will be added.\\n\\n## Validating the model\\n\\nThe next step is to add validation to the model. We could set it up to the setter of every property where we want to have some validation but we can also use the **IValidateObject** interface to let the ModelBinding system of Asp.Net MVC handle validation of every model object. If you want more information concerning the IValidationObject, I suggest you to go read this [blog post about IValidationObject interface](./how-to-validate-model-object-with-asp-net-mvc-correctly). In short, the **ModelBinding** will verify every Validate method of the model when bound back to the controller and it will also Validate the object before saving it into Entity Framework. So, we have double validation automatically execute by .Net Framework. This is a big advantage because we cannot forget to validate the model since the framework do it for us. To make it mandatory we will inherit the interface from the **BaseModel** class and create an abstract method that will be defined on every model. This way, we are sure that we will have model with validation defined.\\n\\n\\n```csharp\\n public abstract class BaseModel : IValidatableObject { public int Id { get; set; }\\n\\n#region IValidatableObject Members\\n\\npublic IEnumerable<ValidationResult> Validate(ValidationContext validationContext) { return ValidateModel(validationContext); }\\n\\n#endregion\\n\\nprotected abstract IEnumerable<ValidationResult> ValidateModel(ValidationContext validationContext); } \\n\")), mdx(\"p\", null, \"All our model classes are modified to have the abstract method defined. Here is an example of a model class with validation and one that doesn't have (yet) any validation logic.\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-csharp\"\n  }, \"public class Workout : BaseModel { public DateTime StartTime { get; set; } public DateTime? EndTime { get; set; } public string Name { get; set; } public string Goal { get; set; } public ICollection<WorkoutSession> Sessions { get; set; }\\n\\nprotected override IEnumerable<ValidationResult> ValidateModel(ValidationContext validationContext) { if (string.IsNullOrEmpty(Name)) { yield return new ValidationResult(\\\"Name is mandatory\\\", new[] {\\\"Name\\\"}); } if (EndTime.HasValue) { if (StartTime > EndTime.Value) { yield return new ValidationResult(\\\"EndTime must be after the StartTime\\\", new[] {\\\"StartTime\\\", \\\"EndTime\\\"}); } } } }\\n\\npublic class WorkoutSessionExercise : BaseModel { public int Order { get; set; } public string Repetitions { get; set; } public string Weights { get; set; } public string Tempo { get; set; } public TimeSpan RestBetweenSet { get; set; } public virtual Exercise Exercise { get; set; } public virtual WorkoutSession WorkoutSession { get; set; }\\n\\nprotected override IEnumerable<ValidationResult> ValidateModel(ValidationContext validationContext) { return new Collection<ValidationResult>(); } } \\n\")), mdx(\"p\", null, \"The first example show you some validation on the Name that need to be defined. It also validate the StartTime that must be before the EndTime. As you can see, the error will be displayed on both property if the error occur.\"), mdx(\"p\", null, \"I also defined the EndTime as \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"Nullable\"), \". This will let the user not enter a ending date to the workout, and for us, give us some scenario to test with nullable type.\"), mdx(\"p\", null, \"The second example show you an example where we do not have any validation defined. It returns a simple empty collection (that must be inherit from IEnumerable).\"), mdx(\"h2\", null, \"Localized string\"), mdx(\"p\", null, \"The last thing that bother me with this model is that for the moment, we take for grant that everything is in English all the time. In fact, the workout goal could be in the user language but the exercise name must be translated into the language of the user. In a \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"./how-to-have-localized-string-with-mvc-and-entity-framework\"\n  }, \"previous blog post\"), \", we have discussed about a technique that can be used to have with Entity Framework multiple language handled automatically. It also doesn't brake any object oriented theory. So, let's apply now the modification to the model by changing some string into \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"./how-to-have-localized-string-with-mvc-and-entity-framework\"\n  }, \"LocalizedString\"), \" class.\"), mdx(\"p\", null, \"To do, we will add this class : \"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-csharp\"\n  }, \" [ComplexType] public class LocalizedString { public string French { get; set; } public string English { get; set; }\\n\\n[NotMapped] public string Current { get { return (string) LanguageProperty().GetValue(this); } set { LanguageProperty().SetValue(this, value); } }\\n\\npublic override string ToString() { return Current; }\\n\\nprivate PropertyInfo LanguageProperty() { string currentLanguage = Thread.CurrentThread.CurrentUICulture.DisplayName; return GetType().GetProperty(currentLanguage); } } \\n\")), mdx(\"p\", null, \"This class lets you have French and English for every \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"LocalizedString\"), \" defined. It will add a column in the database for French and one for English.\"), mdx(\"p\", null, \"As you can see, the \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"LocalizedString\"), \" does have a ComplexType attribute which will tel Entity Framework to merge the property into the owner and not to create a relationship to a table called \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"LocalizedString\"), \". For example, we will use \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"LocalizedString\"), \" with the name of Exercise. So the Exercise will have in its table \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"Name_French\"), \" and \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"Name_English\"), \".\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-csharp\"\n  }, \" public class Exercise : BaseModel { public LocalizedString Name { get; set; } public virtual Muscle Muscle { get; set; } public ICollection<WorkoutSessionExercise> WorkoutSessionExercices { get; set; }\\n\\nprotected override IEnumerable<ValidationResult> ValidateModel(ValidationContext validationContext) { if (Name==null) { yield return new ValidationResult(\\\"Name is mandatory\\\", new[] {\\\"Name\\\"}); } } } \\n\")), mdx(\"p\", null, \"As you can see, the Name property is now of type \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"LocalizedString\"), \" and we have modified the validation that now check if the name is defined.\"), mdx(\"h3\", null, \"Series Articles\"), mdx(\"p\", null, mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"./enterprise-asp-net-part-1-mvc-the-planification\"\n  }, \"Article #1: Asp.Net MVC Enterprise Quality Web Application\"), \" \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"./enterprise-asp-net-mvc-part-2-building-the-model\"\n  }, \"Article #2: Asp.Net MVC Enterprise Quality Web Application Model\"), \" \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"./enterprise-asp-net-mvc-part-3-controller\"\n  }, \"Article #3: Asp.Net MVC Enterprise Quality Web Application Controller\"), \" \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"./enterprise-asp-net-mvc-part-4-repository\"\n  }, \"Article #4: Asp.Net MVC Enterprise Quality Web Repository Layer\"), \" \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"./enterprise-asp-net-mvc-part-5-database-context-and-impersonate-data\"\n  }, \"Article #5: Asp.Net MVC Enterprise Quality Web with Entity Framework\"), \" \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"./enterprise-asp-net-mvc-part-6-the-three-layers-of-validation\"\n  }, \"Article #6: Asp.Net MVC Enterprise Quality Layers\"), \" \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"./enterprise-asp-net-mvc-part-7-securing-action-with-role-authorization\"\n  }, \"Article #7: Asp.Net MVC Enterprise Quality Web Security\")));\n}\n;\nMDXContent.isMDXComponent = true;"}},"pageContext":{"id":"1501c275-b8ce-5f20-b041-7c71734366e7","totalPages":70}},
    "staticQueryHashes": ["3159585216"]}