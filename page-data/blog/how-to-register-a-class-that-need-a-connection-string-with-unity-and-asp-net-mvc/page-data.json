{
    "componentChunkName": "component---src-templates-blog-article-tsx",
    "path": "/blog/how-to-register-a-class-that-need-a-connection-string-with-unity-and-asp-net-mvc",
    "result": {"data":{"mdx":{"frontmatter":{"title":"How to register a class that need a connection string with Unity and Asp.Net MVC","date":"October 5, 2012"},"body":"var _excluded = [\"components\"];\n\nfunction _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\n/* @jsxRuntime classic */\n\n/* @jsx mdx */\nvar _frontmatter = {\n  \"title\": \"How to register a class that need a connection string with Unity and Asp.Net MVC\",\n  \"date\": \"2012-10-05\",\n  \"categories\": [\"asp-mvc\", \"unity\"]\n};\nvar layoutProps = {\n  _frontmatter: _frontmatter\n};\nvar MDXLayout = \"wrapper\";\nreturn function MDXContent(_ref) {\n  var components = _ref.components,\n      props = _objectWithoutProperties(_ref, _excluded);\n\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(\"p\", null, mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"http://unity.codeplex.com/\"\n  }, \"Microsoft Unity\"), \" is an the inside Microsoft patterns and practices library (since 2009) as a \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"dependency injection container\"), \". It can be used with configuration file or with a fluent API directly inside your .Net project. It supports constructor injection, property injection and also method injection.\"), mdx(\"p\", null, \"With the help of \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"http://unitymvc3.codeplex.com/\"\n  }, \"UnityMVC3 library\"), \", it can be really easy to setup your dependency injection container to be unique for each http request and to automate the injection of all your controllers automatically without having to map every controller interface to your concrete implementation.\"), mdx(\"blockquote\", null, mdx(\"p\", {\n    parentName: \"blockquote\"\n  }, \"Unity Mvc 3 includes a bespoke DependencyResolver that creates a child container per HTTP request and disposes of all registered IDisposable instances at the end of the request.\")), mdx(\"p\", null, mdx(\"span\", {\n    parentName: \"p\",\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"320px\"\n    }\n  }, \"\\n      \", mdx(\"a\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-link\",\n    \"href\": \"/static/8cede4f1c28f8149d4b11fda1c072364/72799/pnp_logo.png\",\n    \"style\": {\n      \"display\": \"block\"\n    },\n    \"target\": \"_blank\",\n    \"rel\": \"noopener\"\n  }, \"\\n    \", mdx(\"span\", {\n    parentName: \"a\",\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"27.999999999999996%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABIUlEQVQY042RO0sDQRSFv53ZXTC4xYJIBFF0FYkPNOIriEg2WvhAA8YHVu4/0K2CpTbaCIoIq4XY2gkasdIuP8BWO8HO2oiyErjF2nnhcOccLt/McDkPe1ujvYXu1EkMuNptxEo3OyRKAw2AkciMhP5mW1Hla+P0Pt6Pjg+ATrTtGwYeMAT0A9NAO/+t8PE9DipvcXBZ/QlWMpvAjKnVGrAOFIEpICfQJaAJGJNsBJgEhoFxIMvVay2+ePmOt2+fP2dzLTvAqmXpPOAD80AfMAcMAIsCKQHL4ieAglxWoHzz9LF7V60dXp+VgTZlp7IC6QAGBZSR73vymlGgR2D12S7JPY6KuGHJSecf6kvxlWNjAgqwRKZ0JWctMkVKfH1G/wL/ezoNNZfLBwAAAABJRU5ErkJggg==')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  }), \"\\n  \", mdx(\"img\", {\n    parentName: \"a\",\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"pnp logo\",\n    \"title\": \"pnp logo\",\n    \"src\": \"/static/8cede4f1c28f8149d4b11fda1c072364/72799/pnp_logo.png\",\n    \"srcSet\": [\"/static/8cede4f1c28f8149d4b11fda1c072364/5a46d/pnp_logo.png 300w\", \"/static/8cede4f1c28f8149d4b11fda1c072364/72799/pnp_logo.png 320w\"],\n    \"sizes\": \"(max-width: 320px) 100vw, 320px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\",\n    \"decoding\": \"async\"\n  }), \"\\n  \"), \"\\n    \")), mdx(\"p\", null, \"First of all, you need to get both library, the Unity and Unity MVC3 (which work perfectly with MVC4).\"), mdx(\"p\", null, \"Then, you need to configure the dependency to your container. This need to be done in the application start of the application which is inside Global.ascx.cs.\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-csharp\"\n  }, \"protected void Application_Start() { \\n  AreaRegistration.RegisterAllAreas();\\n\\n  WebApiConfig.Register(GlobalConfiguration.Configuration); \\n  FilterConfig.RegisterGlobalFilters(GlobalFilters.Filters); \\n  RouteConfig.RegisterRoutes(RouteTable.Routes); \\n  BundleConfig.RegisterBundles(BundleTable.Bundles); \\n  AuthConfig.RegisterAuth();\\n\\n  var connectionString = System.Configuration.ConfigurationManager.ConnectionStrings[\\\"DefaultConnection\\\"].ConnectionString; \\n  UnityConfiguration.Initialize(connectionString); \\n} \\n\")), mdx(\"p\", null, \"The line 13 initialize Unity. This class is a custom one that take the connection string that will be injected for the database. If we go inside the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"UnityConfiguration\"), \" class we will see that all my interface are mapped to concrete type.\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-csharp\"\n  }, \"public static class UnityConfiguration { \\n  public static void Initialize(string connectionString) { \\n    IUnityContainer container = new UnityContainer() \\n    .RegisterType<IDatabaseContext, DatabaseContext>(new InjectionConstructor(connectionString)) \\n    .RegisterType<IRepositoryFactory, RepositoryFactory>() \\n    .RegisterType<IWorkoutService, WorkoutService>() \\n    .RegisterType<IWorkoutRepository, WorkoutRepository>();\\n\\n    DependencyResolver.SetResolver(new UnityDependencyResolver(container)); \\n  } \\n} \\n\")), mdx(\"p\", null, \"You can notice that the DatabaseContext has a parameter. To pass the connection string to my DatabaseContext I used the \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"InjectionConstructor\"), \" object and pass the connection string. The latest version stable version of Unity, version 2.1, doesn't require you to write anything more to have all you controller injected. In fact, I have a \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"IWorkoutController\"), \" and you do not see it inside this configuration.\"), mdx(\"p\", null, \"The last step is to register the resolver to be used for the http request of each user. This is done by using the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"DependencyResolver.SetResolver\"), \" method.\"));\n}\n;\nMDXContent.isMDXComponent = true;"}},"pageContext":{"id":"3ad4aba9-9b1e-53cc-b0c6-63b373c4ca59","totalPages":76}},
    "staticQueryHashes": ["3159585216"]}