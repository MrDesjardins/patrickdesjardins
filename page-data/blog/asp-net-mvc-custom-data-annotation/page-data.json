{
    "componentChunkName": "component---src-templates-blog-article-tsx",
    "path": "/blog/asp-net-mvc-custom-data-annotation",
    "result": {"data":{"mdx":{"frontmatter":{"title":"Asp.Net MVC Custom Data Annotation","date":"February 25, 2014"},"body":"var _excluded = [\"components\"];\n\nfunction _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\n/* @jsxRuntime classic */\n\n/* @jsx mdx */\nvar _frontmatter = {\n  \"title\": \"Asp.Net MVC Custom Data Annotation\",\n  \"date\": \"2014-02-25\",\n  \"categories\": [\"asp-mvc\"]\n};\nvar layoutProps = {\n  _frontmatter: _frontmatter\n};\nvar MDXLayout = \"wrapper\";\nreturn function MDXContent(_ref) {\n  var components = _ref.components,\n      props = _objectWithoutProperties(_ref, _excluded);\n\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(\"p\", null, \"Asp.Net MVC Data Annotation is a powerful way to have business logic reusable over all your project. Some exist by default in the \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"System.ComponentModel.DataAnnotations\"), \" namespace. Among the most used Data Annotation is the Required and StringLength attribute.\"), mdx(\"p\", null, \"Data Annotation is used by Asp.Net MVC \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"Data Binder\"), \" that convert Html input value back into your model. During this process, it calls every validations from Data Annotation. In fact, it use the \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"IValidatableObject\"), \" interface that you can even have your model inherit to have validation inside a method if you want.\"), mdx(\"p\", null, \"At some point, you may have some validation that are repeated across multiple classes. This is the case for required field. Instead of validating with a IF statement in the Validate method provided by IValidatableObject or to have your setter check of the value of the property, an alternative is the Data Annotation. It has the advantage to be productive for you because you just need to add the attribute over the property and the validation is done. It can also be unit tested once and you can be sure that for every properties that use it that it is executed. Another point for Data Annotation is the possibility to have easily the Javascript doing the same thing for you. This mean that with a single Data Annotation you can have client side and server side validation.\"), mdx(\"p\", null, \"Before going any further in the theory, let's create a small project with a simple model class the custom Data Annotation is used.\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-csharp\"\n  }, \" public class MyClass { [PrimeNumberOnly] [Display(Name = \\\"Prime Number\\\")] public int PrimeNumber { get; set; } public DateTime StartDate { get; set; } public DateTime EndDate { get; set; } } \\n\")), mdx(\"p\", null, \"This is the model class. I have created the PrimeNumberOnly attribut which is my custom Data Annotation. I used the Display attribute because will use this instead of the property name in the custom Data Annotation for error. But, this is not required. If it is not declared, the property name is used.\"), mdx(\"p\", null, \"The controller is very simple. It checks for the ModelState to see if it has error, if yes, it displays back the form otherwise it redirects to the list of my class. \"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-csharp\"\n  }, \" [HttpPost] public ActionResult Create(MyClass myClass) { if (ModelState.IsValid) { return RedirectToAction(\\\"Index\\\"); } else { return View(); } } \\n\")), mdx(\"p\", null, \"Here come what is interesting, the custom Data Annotation.\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-csharp\"\n  }, \" public class PrimeNumberOnly : ValidationAttribute { protected override ValidationResult IsValid(object value, ValidationContext validationContext) { if (value != null) { int valueInteger; if (int.TryParse(value.ToString(), out valueInteger)) { if (IsPrime(valueInteger)) { return ValidationResult.Success; } else { return new ValidationResult(string.Concat(validationContext.DisplayName, \\\" is not a prime number\\\")); } } else { return new ValidationResult(string.Concat(validationContext.DisplayName, \\\" must be an integer\\\")); } } return ValidationResult.Success; }\\n\\nprivate bool IsPrime(int number) { //... } } \\n\")), mdx(\"p\", null, \"The first thing we can notice is the inheritance of the class. It inherits from ValidationAttribute. This is the base class for Data Annotation attribute. It is totally perfect to inherit from an existing Data Annotation like the Required attribute if what you are doing enhance an existing Data Annotation. Therefore, it is not our case since we want to block non-prime number.\"), mdx(\"p\", null, \"This interface lets override a method named \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"IsValid\"), \" that take two parameters. The first one is the value non-typed. The second is information about the context. The property name, the instance of the the class being validated is also available and the pretty name too (the one that use the display attribute). The IsValid must return Validation.Success if everything is fine. However, if something is wrong, it must return a \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"ValidationResult\"), \" object. The ValidationResult accepts a message that will be used by Asp.Net MVC to acknowledge. It is also possible to mark not only the property that is being tested but to mark other properties of the class with ValidationResult with the same error.\"), mdx(\"p\", null, mdx(\"span\", {\n    parentName: \"p\",\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"400px\"\n    }\n  }, \"\\n      \", mdx(\"a\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-link\",\n    \"href\": \"/static/dd20333b730b98e3528b1a76912b1908/e17e5/DataAnnotationError-400x101.png\",\n    \"style\": {\n      \"display\": \"block\"\n    },\n    \"target\": \"_blank\",\n    \"rel\": \"noopener\"\n  }, \"\\n    \", mdx(\"span\", {\n    parentName: \"a\",\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"25.333333333333336%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAlklEQVQY062OywqDMBBF/f/fy8KuLNZiKphJopB3cosJxeKy9MJhmDtwmE6sKzjnuA8D9n3HkVLKz3R8ntH3NzDG/iNUUtYPtd5OGVrKhWuuXRV+FznnWqYY4Y1BCh7Jn0Tn2jz2EBqfm/fIKTUhEWGanniMI17LgmAtNiGQnEM0BtGaOi0JWKlgieC0rliScErBCKriN/Euhx7Ngj8bAAAAAElFTkSuQmCC')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  }), \"\\n  \", mdx(\"img\", {\n    parentName: \"a\",\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"DataAnnotationError 400x101\",\n    \"title\": \"DataAnnotationError 400x101\",\n    \"src\": \"/static/dd20333b730b98e3528b1a76912b1908/e17e5/DataAnnotationError-400x101.png\",\n    \"srcSet\": [\"/static/dd20333b730b98e3528b1a76912b1908/5a46d/DataAnnotationError-400x101.png 300w\", \"/static/dd20333b730b98e3528b1a76912b1908/e17e5/DataAnnotationError-400x101.png 400w\"],\n    \"sizes\": \"(max-width: 400px) 100vw, 400px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\",\n    \"decoding\": \"async\"\n  }), \"\\n  \"), \"\\n    \")), mdx(\"p\", null, \"If you want to pass the ErrorMessage to the attribute, you can. By default, it use the the FormatErrorMessage method that takes the property name. So, if you pass a custom error with a {0} the parameter is substitute. In the code above, the property display name is used and replaced in the error message. \"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-csharp\"\n  }, \" return new ValidationResult(base.FormatErrorMessage(validationContext.DisplayName)) \\n\")), mdx(\"p\", null, \"If you want to add the member name you have to supply a second parameter. \"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-csharp\"\n  }, \" return new ValidationResultbase.FormatErrorMessage(validationContext.DisplayName,new []{ validationContext.MemberName})) \\n\")), mdx(\"p\", null, \"In the case you want to have multiple parameters like having numbers or property names to shows, it is possible to combine resource files and formatting. To do, do not use FormatErrorMessage but use the ErrorMessageString and do by yourself the formatting.\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-csharp\"\n  }, \" return new ValidationResult(string.Format(this.ErrorMessageString,\\\"One\\\", \\\"Two\\\", DateToBeAfter), new[] { validationContext.MemberName); \\n\")), mdx(\"p\", null, \"So far, half of the job is done because if we erase the number and type a valid entry, the error will not go away before the form is submitted again. This is normal, we have coded only the server side aspect of the Data Annotation. A second interface is required to be inherited to have client side validation. This time, it is named \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"IClientValidatable\"), \". This interface come from the System.Web.Mvc interface. This mean that if you are using View Model, do not inherit the model from this attribute but the view model. Otherwise, you are mixing back end classes and front end classes. For the purpose of this exercise, I am mapping directly the model class to the view, which mean that it is acceptable to have my model class inherit of System.Web.Mvc.IClientValidatable. Please, do not copy and paste that if you are developing serious application.\"), mdx(\"p\", null, \"The IClientValidatable interface comes with the \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"GetClientValidationRules\"), \" method. This give us the possibility to extend the html generated for property. When Asp.Net MVC generates the input, it can add additional data- tag. These tag are required for the client side. They are called unobtrusive since it adds information to the Html input without attaching the Javascript. This mean that we have a third step to do which will be to tell Javascript to use those added attribute. But first, why adding data- to our Html input that has the custom Data Annotation? It is required for several reasons. First, if the logic is in error, we need an error message. It cannot be hard coded into the Javascript because this message can be localized. Adding a data- tag with the error message gives you the possibility to get the message and to expose it to your user if the error occurs. Second, you can add additional information to the Html input by attribute like value to be used in the Javascript validation. Here is an example.\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-csharp\"\n  }, \" public class PrimeNumberOnly : ValidationAttribute, IClientValidatable { protected override ValidationResult IsValid(object value, ValidationContext validationContext) { //... }\\n\\nprivate bool IsPrime(int number) {\\n\\n//... }\\n\\npublic IEnumerable<ModelClientValidationRule> GetClientValidationRules(ModelMetadata metadata, ControllerContext context) { var rule = new ModelClientValidationRule { ValidationType = \\\"primenumber\\\", ErrorMessage = FormatErrorMessage(metadata.GetDisplayName()), };\\n\\n//This is not required. For the purpose of showing how to pass information to the Javascript I will set two values. rule.ValidationParameters.Add(\\\"primenumberparam1\\\", \\\"Value1\\\"); rule.ValidationParameters.Add(\\\"primenumberparam2\\\", \\\"Value2\\\");\\n\\nyield return rule; } } \\n\")), mdx(\"p\", null, \"In the example above, we are setting a single rule with a validation message (the ErrorMessage) that is set to the \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"data-val-primenumber\"), \". I also added two lines that add validation parameters. In a real situation, this can be dynamic value to be checked during the Javascript method that will validate the input. For checking if a number is a prime number, no parameter is required.\"), mdx(\"p\", null, \"Keep in mind that you cannot use capital letter in the ValidationType or you will have a yellow screen of the death with this message:\"), mdx(\"blockquote\", null, mdx(\"p\", {\n    parentName: \"blockquote\"\n  }, \"Validation type names in unobtrusive client validation rules must consist of only lowercase letters. Invalid name: \\\"primeNumber\\\", client rule type: System.Web.Mvc.ModelClientValidationRule This generate this Html output:\")), mdx(\"p\", null, \"The result of the Html is :\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-html\"\n  }, \"<div class=\\\"col-md-10\\\"> <input class=\\\"text-box single-line\\\" data-val=\\\"true\\\" data-val-number=\\\"The field Prime Number must be a number.\\\" data-val-primenumber=\\\"The field Prime Number is invalid.\\\" data-val-primenumber-primenumberparam1=\\\"Value1\\\" data-val-primenumber-primenumberparam2=\\\"Value2\\\" data-val-required=\\\"The Prime Number field is required.\\\" id=\\\"PrimeNumber\\\" name=\\\"PrimeNumber\\\" type=\\\"number\\\" value=\\\"\\\"> <span class=\\\"field-validation-valid\\\" data-valmsg-for=\\\"PrimeNumber\\\" data-valmsg-replace=\\\"true\\\"> </span> </div> \\n\")), mdx(\"p\", null, \"This need also to have some libraries installed and referenced in your Html page.\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-html\"\n  }, \"<script src=\\\"~/Scripts/jquery.validate.js\\\"></script> <script src=\\\"~/Scripts/jquery.validate.unobtrusive.js\\\"></script> <script src=\\\"~/Scripts/PrimeNumberOnlyValidation.js\\\"></script> \\n\")), mdx(\"p\", null, \"You may need to add with NuGet the unobstructive.js. \", mdx(\"span\", {\n    parentName: \"p\",\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"400px\"\n    }\n  }, \"\\n      \", mdx(\"a\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-link\",\n    \"href\": \"/static/25d6971613d93a9b3dbac34e275e1dd3/e17e5/UnobstructiveJQuery-400x99.png\",\n    \"style\": {\n      \"display\": \"block\"\n    },\n    \"target\": \"_blank\",\n    \"rel\": \"noopener\"\n  }, \"\\n    \", mdx(\"span\", {\n    parentName: \"a\",\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"24.666666666666664%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAAAsTAAALEwEAmpwYAAABGklEQVQY02XKS3KCQABFUfa/D7MOP4moaCz8oBaI0LY02GijIMjoprTKUQan7uA9axcIFqsday9AJjm36om519zKhljmeL5kt1d42xBvsycSCnNvyE1JbiquRYVMrxyzkkTXWFJpDrEkPAg2W5/4mBBGR6JYEoSClee/eduA1XqLu9wQiRMXcye/FOhLQXq+kuqCJDVY2Tmn0/nCdV2GP99MHIdut8ug32c2mzGyh4xGNo7jMB6PGQwG+L5PURTEcczItun1euz3AVF0xDrrC2EYIqVkNp2yWCxxxhPmv3OEECiVopR6SxJFlmYYU2CMQWtNlmVvea6JxQmrrGratuXxeFCW5bsvVVVR1zVN0/zz+bz2j7Z9Ik8pf2irbXQ+y4j6AAAAAElFTkSuQmCC')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  }), \"\\n  \", mdx(\"img\", {\n    parentName: \"a\",\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"UnobstructiveJQuery 400x99\",\n    \"title\": \"UnobstructiveJQuery 400x99\",\n    \"src\": \"/static/25d6971613d93a9b3dbac34e275e1dd3/e17e5/UnobstructiveJQuery-400x99.png\",\n    \"srcSet\": [\"/static/25d6971613d93a9b3dbac34e275e1dd3/5a46d/UnobstructiveJQuery-400x99.png 300w\", \"/static/25d6971613d93a9b3dbac34e275e1dd3/e17e5/UnobstructiveJQuery-400x99.png 400w\"],\n    \"sizes\": \"(max-width: 400px) 100vw, 400px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\",\n    \"decoding\": \"async\"\n  }), \"\\n  \"), \"\\n    \")), mdx(\"p\", null, \"The validate.js must be before the unobstructive.js file.\"), mdx(\"p\", null, \"The PrimeNumberOnlyValidation.js file contains the validation in Javascript. It is required to be configured once than you just need to have the script added to your file. Here is the complete file:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-typescript\"\n  }, \"$.validator.addMethod(\\\"primenumber\\\", function (value, element, params) { if (value) { if (value == 1) return false; if (value == 2) return false;\\n\\nfor (var i = 3; i < value; i = i + 2) { if (value % i == 0) return false; } } return true; });\\n\\n$.validator.unobtrusive.adapters.add('primenumber' , ['primenumberparam1', 'primenumberparam2'] , function (options) { options.rules[\\\"primenumber\\\"] = { primenumberparam1: options.params.primenumberparam1, primenumberparam2: options.params.primenumberparam2 }; options.messages[\\\"primenumber\\\"] = options.message; } ); \\n\")), mdx(\"p\", null, \"The first statement register the method to be called when the validation is trigged. It is the same algorithm to check prime number in Javascript than in C#. If it return false, then the error message specified in the C# code is shown. This is possible because the error message is inside the data tag of the input. The tag is \\\"data-val-primenumber\\\". The second adds an adapter to JQuery validator. The first parameter is the name of the validator. It is the same name than the method. Then, you specify the parameter set in C#. Finally, a anonymous function let you transfert the value of each parameters from C# to the JQuery validation plugin. It does the hook between the html attribute data- generated from C# to Javascript.\"), mdx(\"h3\", null, \"Conclusion\"), mdx(\"p\", null, \"If you are getting problem with the plugin, verify that you have all Javascript loaded in the good sequence. To test the plugin, you have to hit the button save. By default, JQuery Validator does not validate on blur but when the form is submitted. Finally, you can get the whole project code in \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://github.com/MrDesjardins/TestingDataAnnotationProject\"\n  }, \"GitHub\"), \".\"));\n}\n;\nMDXContent.isMDXComponent = true;"}},"pageContext":{"id":"8ee7ca7a-8361-5f17-bdd1-71a1b53d286b","totalPages":69}},
    "staticQueryHashes": ["3159585216"]}