{
    "componentChunkName": "component---src-pages-blog-mdx-slug-tsx",
    "path": "/blog/entity-sql-query-esql",
    "result": {"data":{"mdx":{"frontmatter":{"title":"Entity SQL Query (ESQL)","date":"October 2, 2011"},"body":"var _excluded = [\"components\"];\n\nfunction _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\n/* @jsxRuntime classic */\n\n/* @jsx mdx */\nvar _frontmatter = {\n  \"title\": \"Entity SQL Query (ESQL)\",\n  \"date\": \"2011-10-02\",\n  \"categories\": [\"ado-net\", \"entity-framework\"]\n};\nvar layoutProps = {\n  _frontmatter: _frontmatter\n};\nvar MDXLayout = \"wrapper\";\nreturn function MDXContent(_ref) {\n  var components = _ref.components,\n      props = _objectWithoutProperties(_ref, _excluded);\n\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(\"p\", null, \"Entity SQL Query (ESQL) is not like Linq to Entity. The latest use the Linq query while the first one do not. However, they serve the same purpose and they are both in the Entity Framework.\"), mdx(\"p\", null, \"ESQL looks more like SQL query. Even if ESQL is not SQL, it will let developer use SQL query to the database. So, they are 2 ways to use ESQL : using \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"EntityCommand\"), \" or using the generic \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"ObjectQuery\"), \" class.\"), mdx(\"p\", null, \"The first thing to do is to create a EDMX file like we would do with Linq to Entity. The generated connection string that it will provides in the web.config (or app.config) will be used after that with the \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"EntityConnection\"), \". For that, you will need to use the \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"System.Data.EntityClient\"), \" namespace (Add System.Data.Entity).\"), mdx(\"p\", null, \"The connection string will look like this: \"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-xml\"\n  }, \" <add name=\\\"NorthwindEntities1\\\" connectionString=\\\"metadata=res://*/NorthwindModel.csdl|res://*/NorthwindModel.ssdl|res://*/NorthwindModel.msl;provider=System.Data.SqlClient;provider connection string=&quot;Data Source=PATRICK-PC\\\\\\\\SQLEXPRESS;Initial Catalog=Northwind;Integrated Security=True;MultipleActiveResultSets=True&quot;\\\" providerName=\\\"System.Data.EntityClient\\\" /></connectionStrings> \\n\")), mdx(\"p\", null, \"You need to have this syntax with the metadata and provider connection. Traditional ADO.NET connection string won't work.\"), mdx(\"p\", null, \"To try your connection string for ESQL you can use this kind of code:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-csharp\"\n  }, \" string connectionString = ConfigurationManager.ConnectionStrings[\\\"NorthwindEntities1\\\"].ConnectionString; using (EntityConnection conn = new EntityConnection(connectionString)) { conn.Open(); System.Diagnostics.Debug.WriteLine(\\\"Connected\\\"); conn.Close(); } \\n\")), mdx(\"p\", null, \"In the code above, we can see the use of EntityConnection. This derive from DbConnection like SqlConnection do it with ADO.NET. It will also use a EntityCommand that also inherit from an ADO.NET object, the DbCommand.\"), mdx(\"p\", null, \"ESQL is more error prone than Linq to Entity because the query is in a string. You do not have Intellisense, neither the compiler to tell you that you have error. Here is an example of showing with ESQL all regions of the Northwind database.\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-csharp\"\n  }, \" string connectionString = ConfigurationManager.ConnectionStrings[\\\"NorthwindEntities1\\\"].ConnectionString; using (EntityConnection conn = new EntityConnection(connectionString)) { conn.Open(); string sqlQuery = @\\\"SELECT reg.RegionId , reg.RegionDescription FROM NorthwindEntities1.Region as reg\\\"; using (EntityCommand command = new EntityCommand(sqlQuery, conn)) { var reader = command.ExecuteReader(System.Data.CommandBehavior.SequentialAccess); while (reader.Read()) { System.Diagnostics.Debug.WriteLine(reader[\\\"RegionId\\\"] + \\\" : \\\" + reader[\\\"RegionDescription\\\"]); } } conn.Close(); } \\n\")), mdx(\"p\", null, \"This code use an \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"EntityDataReader\"), \" that derive from \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"DbDataReader\"), \". Like its inherited class, it can only be used to read forward. The major change is in the sqlQuery variable. As you can see, it does not do it's query against the table but against the Entity Model. You have to use the Entity Container Name.\"), mdx(\"p\", null, mdx(\"span\", {\n    parentName: \"p\",\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"383px\"\n    }\n  }, \"\\n      \", mdx(\"a\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-link\",\n    \"href\": \"/static/3cf571fa3bc3b44316856bfb78963f0e/d0c94/entitycontainername.png\",\n    \"style\": {\n      \"display\": \"block\"\n    },\n    \"target\": \"_blank\",\n    \"rel\": \"noopener\"\n  }, \"\\n    \", mdx(\"span\", {\n    parentName: \"a\",\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"82.33333333333334%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAIAAACZeshMAAAACXBIWXMAAA7EAAAOxAGVKw4bAAADAElEQVQoz13R2Y7jRBQGYD8pT8ENCDFCmivEA3ABCBQQ0rDPDEw6nU48cRa7He8dr1XlLXbixJPFjh3biV3IPVIzovTp6JdK/805xJu/vufGL/jprxtnuPNHW3cYu2TsPXLJ7WOO7MGTjTMMQQ8pL5HyiiBJ0kUqMBRJYHRVWAf2u8gLfRi6wEdG4Fm+bV6qDOMK4/JDpyQmbgeDhareUtL4Xh6z2lxx54rNiJARIC0AVrZpAUh6oJir/+EWLnHTf6Mq3M2Qa8tzjZobo3uNYnVagrQEKVZjJESLcCYAWoRTAUx46z2K1QlR0bbReqGoAADLMBBElmlZhpGmp/p6MTQtOSZFUZRFcc7zqqowbjBu6rqO45jgJW0TRRDZCNnIdsIw9P2lZYFwtS7KwrGh67iWZSAIEQSrVXi9VpdLWVXF8Xgkpgyf7PZRuDnE+3OSFumpSE/lKcNlecnPu116OGR5dsnzKs+vWVamaZGmRZKc9/sDISqGiMDL+8mtzL1mJq/nTFe4/5tjZktfDBC0KNdhL5WbZXaeo7J0MPYw9prGTZIdIcvWt/zo4+43n/Y7z4adz4c/fkH+9Mlt56M/Op91v1s8fMULX7Lz59T42f38+TL4GuNOXf/QNB3T5AhB1g5x7FgA6ma83uAGN3XTLgXjsihkSREkRZIXPC8+LPTLtWkaXNftN8+L7cL277aGbkIAIYQAQFlW1lFUlEWapA+KvN7EGOO21M76Cc/zBC+px8Ne03RoWY5tK/LD0l9G0TYMgsDzwiA8ZflT+cOnqhohKnqaHBBCnrdchaHvBVmW13V9reuqLH3P3x+SsqweL/2f87lYLgPi519ejcb0ZMbekRRJ0YN2zgBaArvl+GvoBO8Be9kGuw0W9AzgEi9+/2dITnv90d2QuumNuj1yQE6ZuTyhOV7UZjNuLqpTmqdZieWU8ZRnWImZy7rlOX5E/PZnjySnJEVPphz5dtbvU8O30/4d1b0hZ4xoAk+3XM2wNdPRLVdtg62bDrRD5K7+BX9bO61tJ3XHAAAAAElFTkSuQmCC')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  }), \"\\n  \", mdx(\"img\", {\n    parentName: \"a\",\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"entitycontainername\",\n    \"title\": \"entitycontainername\",\n    \"src\": \"/static/3cf571fa3bc3b44316856bfb78963f0e/d0c94/entitycontainername.png\",\n    \"srcSet\": [\"/static/3cf571fa3bc3b44316856bfb78963f0e/5a46d/entitycontainername.png 300w\", \"/static/3cf571fa3bc3b44316856bfb78963f0e/d0c94/entitycontainername.png 383w\"],\n    \"sizes\": \"(max-width: 383px) 100vw, 383px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\",\n    \"decoding\": \"async\"\n  }), \"\\n  \"), \"\\n    \")), mdx(\"p\", null, \"Also, in SELECT, it's not the name of the column of the table that you have to use but the name of the property of the entity. So, people with a SQL background may feel comfortable with the syntax.\"), mdx(\"h2\", null, \"Object Context\"), mdx(\"p\", null, \"The previous section show that ESQL let you have a very tight control over the query by using a SQL type of statement. But, on the other hand, it's not very interesting because we could just use ADO.NET object to almost do the same. Wherefore, that is why ESQL has more under the hood.\"), mdx(\"p\", null, \"ESQL can use Object Context to retrieve Entity Object without having to build them like with the ADO.NET. This start to be interesting. Let check an example.\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-csharp\"\n  }, \"using System.Data.Objects; //... string connectionString = ConfigurationManager.ConnectionStrings[\\\"NorthwindEntities1\\\"].ConnectionString; using (EntityConnection conn = new EntityConnection(connectionString)) { using (ObjectContext objectContext = new ObjectContext(connectionString)) { objectContext.Connection.Open(); string sqlQuery = @\\\"SELECT reg.RegionId , reg.RegionDescription FROM NorthwindEntities1.Region as reg\\\"; var allRegions = new ObjectQuery<DbDataRecord>(sqlQuery, objectContext).ToList(); foreach (var region in allRegions) { System.Diagnostics.Debug.WriteLine(region.GetInt32(0) + \\\" : \\\" + region.GetString(1)); } objectContext.Connection.Close(); } } \\n\")), mdx(\"p\", null, \"The line 12 and line 15 contains new code. The line 12 execute the query and return a DbDataRecord. A DbDataRecord is inherit IDataRecord and can only access elements by index. This is not very convenient and from my personal perspective does not give an interesting way to get data from the database. However, some extension let you handle ObjectQuery easier but at the end you will still need to non typed object.\"));\n}\n;\nMDXContent.isMDXComponent = true;"}},"pageContext":{"id":"8d8ed26c-9a68-5657-b5f7-54878e6deb02"}},
    "staticQueryHashes": ["3159585216"]}