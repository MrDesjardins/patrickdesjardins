{
    "componentChunkName": "component---src-templates-blog-article-tsx",
    "path": "/blog/understand-basic-navigation-with-entity-framework-code-first-4-3-with-1-to-0-1-relationship",
    "result": {"data":{"mdx":{"frontmatter":{"title":"Understand basic navigation with Entity Framework Code First (4.3) with 1 to 0..1 relationship","date":"August 16, 2012"},"body":"var _excluded = [\"components\"];\n\nfunction _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\n/* @jsxRuntime classic */\n\n/* @jsx mdx */\nvar _frontmatter = {\n  \"title\": \"Understand basic navigation with Entity Framework Code First (4.3) with 1 to 0..1 relationship\",\n  \"date\": \"2012-08-16\",\n  \"categories\": [\"entity-framework\"]\n};\nvar layoutProps = {\n  _frontmatter: _frontmatter\n};\nvar MDXLayout = \"wrapper\";\nreturn function MDXContent(_ref) {\n  var components = _ref.components,\n      props = _objectWithoutProperties(_ref, _excluded);\n\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(\"p\", null, \"Most of the work is done in your \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"DbContext\"), \" when we talk about configuration of your entities. This is also true for navigation properties that can be set via the fluent interface of Entity Framework.\"), mdx(\"p\", null, \"The first step is to override the method \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"OnModelCreating\"), \".\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-csharp\"\n  }, \"protected override void OnModelCreating(DbModelBuilder modelBuilder) { \\n  //... \\n} \\n\")), mdx(\"p\", null, \"From there you can work in two different ways, the first one is to create class for each entity's configuration. The second one is to work directly into the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"OnModelCreation\"), \" method. I prefer the first one because it's cleaner with bigger project. \"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-csharp\"\n  }, \"protected override void OnModelCreating(DbModelBuilder modelBuilder) { \\n  modelBuilder.Configurations.Add(new MyEntityConfiguration()); \\n} \\n//... \\npublic class MyEntityConfiguration: EntityTypeConfiguration<MyEntity> { \\n  public MyEntityConfiguration() { \\n    //Configurations here \\n  } \\n} \\n\")), mdx(\"p\", null, \"As you can see, the type inherited by the configuration class is EntityTypeConfiguration but could be ComplexTypeConfiguration for complex type instead of entity type.\"), mdx(\"p\", null, \"To make it shorter, for the purpose of this blog post, I won't use the classes approach but in real life, I would suggest your to use it.\"), mdx(\"h1\", null, \"HasRequired and HasOptional\"), mdx(\"p\", null, \"This two keywords work in conjunction of the use of virtual object inside your classes. They will specify the type of relationship between entities.\"), mdx(\"p\", null, \"HasRequired is implicit if you declare a virtual property for your class. For example, the code below display 2 classes and both of them refer to each of them. This is a 1 to 1 implicit relationship.\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-csharp\"\n  }, \"public class User { \\n  public int Id { get; set; } \\n  public string Username { get; set; } \\n  public virtual Profile Profile { get; set; } \\n}\\n\\npublic class Profile { \\n  public int Id { get; set; } \\n  public string PostalCode { get; set; }\\n   public virtual User User { get; set; } \\n} \\n\")), mdx(\"p\", null, \"No configuration is required, nevertheless, you could have wrote in the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"DbContext\"), \" some code that explicit the navigation type.\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-csharp\"\n  }, \"protected override void OnModelCreating(DbModelBuilder modelBuilder) { \\n  modelBuilder.Entity<User>().HasRequired(t => t.Profile); \\n} \\n\")), mdx(\"p\", null, \"This scenario is good for the case that a \\\"User\\\" require to have a \\\"Profile\\\" but \\\"Profile\\\" class can be created without being linked to a \\\"User\\\". If you want to specify if it's the class \\\"Profile\\\" or user \\\"User\\\" that will contain the relationship than you need to use the clause \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"WithRequiredPrincipal\"), \" or \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"WithOptionalPrincipal\"), \".\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-csharp\"\n  }, \"protected override void OnModelCreating(DbModelBuilder modelBuilder) { \\n  modelBuilder.Entity<User>() \\n  .HasRequired(t => t.Profile) \\n  .WithRequiredPrincipal(t => t.User); \\n} \\n\")), mdx(\"p\", null, \"The first code that were using HasRequired only was in fact using implicitly \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"WithOptional(t=>t.User)\"), \". The User would have the relation inside the table and not profile. The second code also specify with \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"WithRequiredPrincipal\"), \" that the User will hold the foreign key.\"), mdx(\"h1\", null, \"Has or With\"), mdx(\"p\", null, \"You have HasRequired, HasOptional, HasMany and HasForeignKey. In the same time you have WithRequired, WithOptional, WithMany. What is the main difference between those method with \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"Has\"), \" and \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"With\"), \". The first one, the \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"Has\"), \", represent the navigation property. The second one, the \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"With\"), \" represent the reverse property configuration. Let say you have class A and class B. If you configure the entity A every call with the keywork \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"Has\"), \" will be on the class A property (you can see this within the lambda expression that will be of type A with the return of type B. However, if you use property with \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"With\"), \" in prefix, you will configure B to A relationship. For example : \"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-csharp\"\n  }, \" modelBuilder.Entity<A>().HasRequired(a => a.B).WithOptional(b => b.A); \\n\")), mdx(\"p\", null, \"To clarify even more the Has and With, here is a more complex scenario that involve many classes. \"), mdx(\"p\", null, mdx(\"span\", {\n    parentName: \"p\",\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"283px\"\n    }\n  }, \"\\n      \", mdx(\"a\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-link\",\n    \"href\": \"/static/29228b43545cdb47cc177cacee8cd337/bde6a/CarCustomer-283x400.png\",\n    \"style\": {\n      \"display\": \"block\"\n    },\n    \"target\": \"_blank\",\n    \"rel\": \"noopener\"\n  }, \"\\n    \", mdx(\"span\", {\n    parentName: \"a\",\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"141.3427561837456%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAcCAYAAABh2p9gAAAACXBIWXMAAAsTAAALEwEAmpwYAAADMklEQVRIx52VaW/bSAyG/f9/TD8tsECLAosmCPzBm2DjpEljObXu0zrm1P0uOLICd1PX7hIgZFHjZ0gOyVn0fY+8qJBmOfKihJQaSmlwIdF1PUjGcbxYF1xo/Pl5hY9/rXC7fkVSaAjVIc05yqr6faCQNZZ3Wzy8RHAjhjBlKCoFziWq/wMchhFCUogacZIiy/YmZCEp5O4AxJv8CMA7WUgpoJVE02iUZQ7OGepaQ2sFpSSUlOZJ66QQaJoGTVMbrevarD3WxTAMoIMhT2lB27Yg22ynd4LQNyGE8Zps07p+8nQYJqWQZ/dJ2qZB33dv7q+fdvh7bSNIFfx4ym9WSDCuUTKJIM5MPn7I4TGQPJnzRrL65xWfvtzj/jnAd69EnNfIqwZcdmi7EUVRmiiOc3sSSLbnbYzVvY27Rxuvzh5xrrAvNSreoG56lOVvAoNoj43l4NvGhh/mqESLktVGK94iTvLzwDmHdChUPrvdM1zHRhyncGwHnhtAUBf1w2Ue9t0M7M3Jep4F33Nh2w621hZxFCPNMmRZZgr/4pDJQykl4jhAmiQGEAYh8jw3a2izosgvA862uQbnYqZvXHCs12sopYxtPFc2846nhDy7ubl5+88Z4NRKUyc0RmcPyUZCni2Xy5NDY3H8QnkzLWVa8aB9dzggbSAU9vX1FaztlpDvwIv/7kAiFdWZAuMKNN6UblAxYYavrhukaYYkSaA1DYTmPPBq+YgPf1zhevUNllNg55eHWcmR5hIVp006MKHhh4nJ+3jwdPGzPCxvt/h8/YjbBxcbu4AXSwSZQlrWKFgDJlsDHEZACG5yjVNAyuNXK8Ldg4v7J9cMhTBTiPcKyaGXC1aDkZd1Z+6h+cBOAtOswMvLCyzLRhjnqJhGWSmouofUkyrdQ8gOSZr/GkhK09m0nO/D2mzhex7SJENVVKjKSff73Gw+hXwGSIts+wmeS/37iiiKEAWRgbKKGZ2AIzi/EOg4G/ieg83GQhhFsL/v0Lbdu865GBgGNkLfh+f5iMIIju2+3TdUJqZUxtFMnLNAuuXo9qNpM6kwT/KG7NNz+s0YM5ucLOzxZ5ftGTnulH8B2lR9yy2r/g8AAAAASUVORK5CYII=')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  }), \"\\n  \", mdx(\"img\", {\n    parentName: \"a\",\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"CarCustomer 283x400\",\n    \"title\": \"CarCustomer 283x400\",\n    \"src\": \"/static/29228b43545cdb47cc177cacee8cd337/bde6a/CarCustomer-283x400.png\",\n    \"srcSet\": [\"/static/29228b43545cdb47cc177cacee8cd337/bde6a/CarCustomer-283x400.png 283w\"],\n    \"sizes\": \"(max-width: 283px) 100vw, 283px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\",\n    \"decoding\": \"async\"\n  }), \"\\n  \"), \"\\n    \")), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-csharp\"\n  }, \"public class CarConfiguration : EntityTypeConfiguration<Car> { \\n  public CarConfiguration() { \\n    HasOptional(x => x.CurrentOwner).WithOptionalPrincipal(t => t.CurrentCar); //User contain the Customer FK \\n  } \\n}\\n\\npublic class CustomerConfiguration : EntityTypeConfiguration<Customer> {\\n   public CustomerConfiguration() { \\n    HasKey(x => x.Id); \\n    HasOptional(x => x.CurrentCar).WithOptionalDependent(t => t.CurrentOwner);//Defined inside the CarConfiguration (up-side-down), may not be required \\n  } \\n} \\n\")), mdx(\"p\", null, \"In the first scenario, we would have only the HasOptional statement on the CarConfiguration class without having anything in the CustomerConfiguration. It's the reverse for the second way. The last one is exactly the whole code you see above, with both navigation defined.\"), mdx(\"p\", null, \"In the case you think you can only setup the HasOptional on both without setuping up the WithOptionalPrincipal or WithOptionalDependent you are wrong. This will lead to an error :\"), mdx(\"blockquote\", null, mdx(\"p\", {\n    parentName: \"blockquote\"\n  }, \"Unable to determine the principal end of an association between the types 'EFCodeFirst.Models.Car' and 'EFCodeFirst.Models.Customer'. The principal end of this association must be explicitly configured using either the relationship fluent API or data annotations.\")), mdx(\"p\", null, \"How come? Because it's impossible for Entity Framework to know who's between the Customer or the Car contain the reference of the object. This is because if one of the object require to have the reference and the other one not, Entity Framework will create the table with the reference on the table with the required FK required. This is why having the code below won't work and raise the error described. \"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-csharp\"\n  }, \"public class CarConfiguration : EntityTypeConfiguration<Car> { \\n  public CarConfiguration() { \\n    HasKey(x => x.Id); \\n    HasOptional(x => x.CurrentOwner); //Error!!! \\n  } \\n} \\n\\npublic class CustomerConfiguration : EntityTypeConfiguration<Customer> { \\n  public CustomerConfiguration() { \\n    HasKey(x => x.Id); \\n    HasOptional(x => x.CurrentCar);// Error!!! \\n  } \\n} \\n\")), mdx(\"p\", null, \"The only time you can write HasOptional or HasRequired without defining the other side of the navigation is when you have the class having the reference to the other object and that the other one doesn't. If we want to do it with our class Car and Customer we just need to remove from Customer the Car property like the following code.\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-csharp\"\n  }, \"public class Car:BaseEntity { public Customer CurrentOwner { get; set; } //Relationship : One to (zero or one) } \\npublic class Customer:BaseEntity { //public Car CurrentCar { get; set; } //Relationship: One to (zero or one) \\npublic License License { get; set; } //Relationship: One to (zero or one) }\\n\\npublic class CarConfiguration : EntityTypeConfiguration<Car> { \\n  public CarConfiguration() { \\n    HasKey(x => x.Id); \\n    HasOptional(x => x.CurrentOwner); \\n  } \\n} \\n\\npublic class CustomerConfiguration : EntityTypeConfiguration<Customer> { \\n  public CustomerConfiguration() { \\n    //Nothing \\n  } \\n} \\n\")), mdx(\"p\", null, \"This will work.\"));\n}\n;\nMDXContent.isMDXComponent = true;"}},"pageContext":{"id":"f2f5e214-f70e-5ab1-b39c-459763b86b5b","totalPages":77}},
    "staticQueryHashes": ["3159585216"]}