{
    "componentChunkName": "component---src-templates-blog-article-tsx",
    "path": "/blog/service-worker-push-notification-and-asp-net-mvc-part-2-of-3-server-side",
    "result": {"data":{"mdx":{"frontmatter":{"title":"Service Worker, Push Notification and Asp.Net MVC - Part 2 of 3 Server Side","date":"January 10, 2017"},"body":"var _excluded = [\"components\"];\n\nfunction _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\n/* @jsxRuntime classic */\n\n/* @jsx mdx */\nvar _frontmatter = {\n  \"title\": \"Service Worker, Push Notification and Asp.Net MVC - Part 2 of 3 Server Side\",\n  \"date\": \"2017-01-10\",\n  \"categories\": [\"asp-mvc\", \"azure\"]\n};\nvar layoutProps = {\n  _frontmatter: _frontmatter\n};\nvar MDXLayout = \"wrapper\";\nreturn function MDXContent(_ref) {\n  var components = _ref.components,\n      props = _objectWithoutProperties(_ref, _excluded);\n\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(\"p\", null, \"In the part one, we saw how to register a service worker and how to handle incoming messages if the user is actively on the website. However, we didn't touch how to send a message through Google Firebase to receive the message. In this article, I'll show how to send a message from an Azure Webjob, written in C#. This is a common scenario where you have a backend job running and executing some logics that needs to have the user to an action. Since the user may or may not be on the website (or the wrong page), the push notification is great to indicate that something must be done. The other big advantage is that the push notification with Google Firebase offers an almost instant messaging service. Within few milliseconds, the message goes from the server to Google Firebase server to the service worker that will use the push notification API of the browser to display the message.\"), mdx(\"p\", null, \"The first thing, is to define a generic contract with an interface. I decided to create a simple one that return a simple boolean to indicate if the message sent is a success or a failure. The method signature allows to pass the \\\"to\\\" token, which is the unique identifier of the user for Firebase (the token saved from the Ajax call in the part 1). The remaining parameters are self explanatory with the title, message and url when the user click the notification.\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-csharp\"\n  }, \"public interface IPushNotification {\\n  bool QueueMessage(string to, string title, string message, string urlNotificationClick);\\n}\\n\")), mdx(\"p\", null, \"The implementation is also very simple. It relies on the REST endpoint of Google Firebase.\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-csharp\"\n  }, \" public class GoogleFirebaseNotification:IPushNotification {\\n   public bool QueueMessage(string to, string title, string message, string urlNotificationClick) {\\n     if (string.IsNullOrEmpty(to)) {\\n       return false;\\n    }\\n     var serverApiKey = \\\"SuperLongKeyHere\\\";\\n     var firebaseGoogleUrl = \\\"https://fcm.googleapis.com/fcm/send\\\";\\n\\n    var httpClient = new WebClient();\\n    httpClient.Headers.Add(\\\"Content-Type\\\", \\\"application/json\\\");\\n    httpClient.Headers.Add(HttpRequestHeader.Authorization, \\\"key=\\\" + serverApiKey);\\n    var timeToLiveInSecond = 24 * 60; // 1 day\\n    var data = new {\\n       to = to,\\n      data = new { notification = new {\\n        body = message,\\n        title = title,\\n        icon = \\\"/Content/Images/Logos/BourseVirtuelle.png\\\",\\n        url = urlNotificationClick\\n        }\\n      },\\n      time_to_live = timeToLiveInSecond };\\n\\n    var json = JsonConvert.SerializeObject(data);\\n    Byte[] byteArray = Encoding.UTF8.GetBytes(json);\\n    var responsebytes = httpClient.UploadData(firebaseGoogleUrl, \\\"POST\\\", byteArray);\\n    string responsebody = Encoding.UTF8.GetString(responsebytes);\\n    dynamic responseObject = JsonConvert.DeserializeObject(responsebody);\\n    return responseObject.success == \\\"1\\\";\\n  }\\n}\\n\")), mdx(\"p\", null, \"The first piece of puzzle is to use the right server api key. It's under the Firebase console, under the setting's cog and under the \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"Cloud Messaging\"), \".\"), mdx(\"p\", null, mdx(\"span\", {\n    parentName: \"p\",\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"1024px\"\n    }\n  }, \"\\n      \", mdx(\"a\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-link\",\n    \"href\": \"/static/edbd9f0b26558f40b82e8dac3669d2f5/2bef9/ServerKeyFirebase-1024x415.png\",\n    \"style\": {\n      \"display\": \"block\"\n    },\n    \"target\": \"_blank\",\n    \"rel\": \"noopener\"\n  }, \"\\n    \", mdx(\"span\", {\n    parentName: \"a\",\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"40.666666666666664%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAABwklEQVQoz22QS2sUQRSFS+NGRFz4D/TXuRPHEBxIDLpRoxECghiR2bkRx4kx3THkDwgyJnHseSQhwjwSSFf39PtV/Ul1iHHhgcM9dc+tw60SD9a+UV/fY9boUTMH1M0+C5t96kaPxa19Hm0fsmh2mW3ucL+1y1xrj7sffnDvY5tac4eFtTbzhsXjL7usbHxHzJttHm7vM7f1m9rmEXeMI26+6jKzbCGedRBPfiKedhBLvy743EIsWWd6uYt4YXH1ZYdbK20EWUIR+aBSoOTwJOL2+2OuNSbMvB1zvTHhRmOCeDO64OsRl1dHXFrVelj19OyVd8eIKI7RzAuFxslpgjmQNLs25oHkq2VXNA4k632bzz2bVs/GGEg2BjafujYbA1mddV+kaUoURSRJQlmWpGlO6Dr48pTAtfGcKVPpkoU+qe9VtdKBrkGlE98jCbzKF47jIKVEB2sUSjENQsI4xnEzbJki3ZQwzsgKRZRkREmKF4TYjksYJ1U/VyVeGCN838fzPJRSfwPdqUfg+yhVUhRFxXN/PB4zHA6rF+m754toRHGCiOO4MvI8PwssFH4QkmUZ/0J/R1mCHwSk//E09LZ/APujKGvIMjttAAAAAElFTkSuQmCC')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  }), \"\\n  \", mdx(\"img\", {\n    parentName: \"a\",\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"ServerKeyFirebase 1024x415\",\n    \"title\": \"ServerKeyFirebase 1024x415\",\n    \"src\": \"/static/edbd9f0b26558f40b82e8dac3669d2f5/2bef9/ServerKeyFirebase-1024x415.png\",\n    \"srcSet\": [\"/static/edbd9f0b26558f40b82e8dac3669d2f5/5a46d/ServerKeyFirebase-1024x415.png 300w\", \"/static/edbd9f0b26558f40b82e8dac3669d2f5/0a47e/ServerKeyFirebase-1024x415.png 600w\", \"/static/edbd9f0b26558f40b82e8dac3669d2f5/2bef9/ServerKeyFirebase-1024x415.png 1024w\"],\n    \"sizes\": \"(max-width: 1024px) 100vw, 1024px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\",\n    \"decoding\": \"async\"\n  }), \"\\n  \"), \"\\n    \")), mdx(\"p\", null, \"When using with a webjob, you just need to use this implementation and pass the desired parameters. You can get from the token from a new column create in the AspNetUsers table and define a specific title and description depending of what the user must do.\"));\n}\n;\nMDXContent.isMDXComponent = true;"}},"pageContext":{"id":"b15b0631-6061-5b72-bca5-382fdc34caf4","totalPages":74}},
    "staticQueryHashes": ["3159585216"]}