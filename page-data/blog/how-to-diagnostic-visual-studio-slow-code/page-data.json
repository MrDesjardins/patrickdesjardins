{
    "componentChunkName": "component---src-pages-blog-mdx-slug-tsx",
    "path": "/blog/how-to-diagnostic-visual-studio-slow-code",
    "result": {"data":{"mdx":{"frontmatter":{"title":"How to diagnostic slow code with Visual Studio","date":"March 23, 2016"},"body":"var _excluded = [\"components\"];\n\nfunction _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\n/* @jsxRuntime classic */\n\n/* @jsx mdx */\nvar _frontmatter = {\n  \"title\": \"How to diagnostic slow code with Visual Studio\",\n  \"date\": \"2016-03-23\",\n  \"categories\": [\"c-sharp\", \"entity-framework\", \"visual-studio\"]\n};\nvar layoutProps = {\n  _frontmatter: _frontmatter\n};\nvar MDXLayout = \"wrapper\";\nreturn function MDXContent(_ref) {\n  var components = _ref.components,\n      props = _objectWithoutProperties(_ref, _excluded);\n\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(\"p\", null, \"During the development of one feature, I noticed the performance to be very slow in some scenario. It was not obvious at first because the task was to simply update a user profile. The user profile in question is stored in a single table. It's a pretty straight forward task. Before persisting the data, some validations are done but that is it.\"), mdx(\"p\", null, \"This is where Visual Studio can be very useful with the integrated \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"Diagnostic Tools\"), \". The diagnostic tools provide information about event and on any of them, you can come back in time and replay the call stacks which is pretty useful. It also gives some timing information, cpu usage and memory usage. To start diagnosing, simply attach Visual Studio to the process you want to diagnostic. After, open Visual Studio's diagnostic tools that is located in the top menu under Debug > Profiler > Performance Explorer > \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"Show Performance Explorer\"), \".\"), mdx(\"p\", null, \"Here is an example of the output that I got from my performance problem.\"), mdx(\"p\", null, mdx(\"span\", {\n    parentName: \"p\",\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"782px\"\n    }\n  }, \"\\n      \", mdx(\"a\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-link\",\n    \"href\": \"/patrickdesjardins/static/0b53413b49ccc3237770e5361ca53495/2e195/DiagnosticTool-782x1024.png\",\n    \"style\": {\n      \"display\": \"block\"\n    },\n    \"target\": \"_blank\",\n    \"rel\": \"noopener\"\n  }, \"\\n    \", mdx(\"span\", {\n    parentName: \"a\",\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"130.99999999999997%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAaCAYAAAC3g3x9AAAACXBIWXMAAAsTAAALEwEAmpwYAAAEKUlEQVRIx42U229UVRTGz18kIlQukmBEfTHeNfHFB/1nfNAYqGLplCIglxYUJKiAfcEHIVDQ4rSdG9M5M+d+71w6nZ7OnJ/Z+5wO01YSJ/nyrfXtPd9ee62do/xx9yr37v3M/fs3GZ++wvGpK3w5cYkvxs/x1ckLHM/NcnxSYCbDznyGE7lZTkzNMj41i6JqLrW6hWZ4uK6H47jYtkOns0ZvI6a73qPd7tDrbaR5N83XexsZejhuE92IMK1VlJpap1BYplqtUq5UKJfLlMsVSqUyxWKJYrGYcmkkLpYolVIul0s8/muJalWlUtFQVmoNCsUSS8sFqisqmmGi6Qa64JE4zQ2p6aMwTSpPG2iaTXXFQjGcgLn5f7jz8Alz83nmHi0y9yi/HfNb8WIazz9b+31+kRt3F/jxzzy/PVhEaegWD54sMZ8v8jBfkLy8oqWoZbzSeKaNxAVVY6FY51FepWA4cr/iBxGNep1qrUZNVWWsaxqGrqPrOpqmDXOpZblYs0ydwnIdtdbA8kMMw0DxgiZBGOEFAZ4fEIQhURRJhFG0K5cIUxbF1FSPMAox/Ej6KI/zNcpVk6pqU63b1DQP3V6VsLw2ttcZshN0h/CiLqreQdXbeNE6bqYrDcOlrjtYboTphBkC3KBJ2FwjXO1kWCNqdolaXcmrrS6q1iKI1oaagBJ3W0SeReiaEr5tsOrbsNnlv39JxgMG6/EODZRbiy2uLbS4/neTG0+a/JJv8etim1ulTW5X4HYl2YU7Vbi+EHNzqc+dp9vXlMOTG7x5AV4/D4en4cAU7MvB3lMJeyYSXjqV8OJEir1b+XcJL3y9MVzb0gUrh3Mxr51NOHZ2wNEzCUfPDHj1+4Qj0wkv57bjgMBUwtjJPvu/iTlwmqG2BWXPtzFvnIe3LiYcOwdHpuGVaTh0Gg5OCSQyln/IJRw8nTA2HjM20eeQiCcT9k0mjOUS9k8mKO/80OPTnwZ8fr3PZ9f6fHKlz3uX+nxwuc+HAjNZPDPg46vw0Qy8fzZO49mEdy8nvH3xGRTHEw86xPUDHNfHclxMx8NyPEzbw3EDDNvDdnxa7Q6u1ySI2mz2+wySRCIZgWI7njQSbFgOumFhWDZmBtt2MTPdsl0amoHn+8Rx+mSECSNQTMtFN20M00Y3bNSGIaEZlmShiQ+IiE3bpa6ZsoA43kxf484KxaLj+cMqpbnlyGoE2/Lq6aGuF0hNtGjLMNlp6GY9FB8GYSyMRtsg1mVvbRc/CCUH4Srx5nMMxWY5FC8YViMGYmeD2TIWutgn+im+Ms81tDIDK7uWpluyb7rsqZUOROhiKI5HQzPl4aND2WUo+mJkf6xrhoQwE2xkh4ihpFPePpT/vLLsk+dju+nTMbM+CnbctHrDdGSf0yv/j6EMH/auoYiDUl3sS4fy/B7+C5TlOrDpX6PSAAAAAElFTkSuQmCC')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  }), \"\\n  \", mdx(\"img\", {\n    parentName: \"a\",\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"DiagnosticTool 782x1024\",\n    \"title\": \"DiagnosticTool 782x1024\",\n    \"src\": \"/patrickdesjardins/static/0b53413b49ccc3237770e5361ca53495/2e195/DiagnosticTool-782x1024.png\",\n    \"srcSet\": [\"/patrickdesjardins/static/0b53413b49ccc3237770e5361ca53495/5a46d/DiagnosticTool-782x1024.png 300w\", \"/patrickdesjardins/static/0b53413b49ccc3237770e5361ca53495/0a47e/DiagnosticTool-782x1024.png 600w\", \"/patrickdesjardins/static/0b53413b49ccc3237770e5361ca53495/2e195/DiagnosticTool-782x1024.png 782w\"],\n    \"sizes\": \"(max-width: 782px) 100vw, 782px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\",\n    \"decoding\": \"async\"\n  }), \"\\n  \"), \"\\n    \")), mdx(\"p\", null, \"Visual Studio Diagnostic tools events include Entity Framework SQL statements. This is where I realized that the user's table was updated but also hundred of others which looks to be a table linked to this one. Here was the performance bottleneck, the culprit! I never expected to update anything related to that table -- just the main user's table.\"), mdx(\"p\", null, \"Entity Framework code was like this:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-csharp\"\n  }, \" public void Update(ApplicationUser applicationModel) { //Update the password IF necessary var local = UnitOfWork.Set<ApplicationUser>().Local.FirstOrDefault(f => f.Id == applicationModel.Id); if (local != null) { UnitOfWork.Entry(local).State = EntityState.Detached; } UnitOfWork.Entry(applicationModel).State = EntityState.Modified; if (string.IsNullOrEmpty(applicationModel.PasswordHash)) { UnitOfWork.Entry(applicationModel).Property(f => f.PasswordHash).IsModified = false; } UnitOfWork.Entry(applicationModel).Property(f => f.UserName).IsModified = false; UnitOfWork.Entry(applicationModel).Property(f => f.CreationDateTime).IsModified = false; UnitOfWork.Entry(applicationModel).Property(f => f.ValidationDateTime).IsModified = false; UnitOfWork.Entry(applicationModel).Property(f => f.LastLogin).IsModified = false; UnitOfWork.Entry(applicationModel).Property(f => f.SecurityStamp).IsModified = false; UnitOfWork.Entry(applicationModel).Property(f => f.Language).IsModified = false; } \\n\")), mdx(\"p\", null, \"As you can notice, nothing is done directly on the property that has the collection of \\\"reputation\\\". The problem is that if the user as in that collection 250 objects, that for an unknown reason, Entity Framework does 250 updates. Since we want just to update first name, last name and few other basic properties than we need to be sure to remove those unwanted updates. After some modification with Entity Framework, like nulling every collection before updating, The SQL provided was only a single SQL, whence the performance at full speed.\"));\n}\n;\nMDXContent.isMDXComponent = true;"}},"pageContext":{"id":"260d4ea4-3632-5a17-bd55-34c91cab81fa"}},
    "staticQueryHashes": ["3159585216"]}