{
    "componentChunkName": "component---src-templates-blog-article-tsx",
    "path": "/blog/azure-kubernetes-public-access",
    "result": {"data":{"mdx":{"frontmatter":{"title":"How to Access your Web Application on Kubernetes Azure","date":"September 7, 2022"},"body":"var _excluded = [\"components\"];\n\nfunction _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\n/* @jsxRuntime classic */\n\n/* @jsx mdx */\nvar _frontmatter = {\n  \"title\": \"How to Access your Web Application on Kubernetes Azure\",\n  \"date\": \"2022-09-07\",\n  \"categories\": [\"azure\", \"docker\", \"container\", \"kubernetes\"]\n};\n\nvar makeShortcode = function makeShortcode(name) {\n  return function MDXDefaultShortcode(props) {\n    console.warn(\"Component \" + name + \" was not imported, exported, or provided by MDXProvider as global scope\");\n    return mdx(\"div\", props);\n  };\n};\n\nvar TocAzureContainerSeries = makeShortcode(\"TocAzureContainerSeries\");\nvar layoutProps = {\n  _frontmatter: _frontmatter\n};\nvar MDXLayout = \"wrapper\";\nreturn function MDXContent(_ref) {\n  var components = _ref.components,\n      props = _objectWithoutProperties(_ref, _excluded);\n\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(\"p\", null, \"The article's goal is to expose your web application on the Internet. We already \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"./azure-intro-kubernetes\"\n  }, \"explained how to publish with Azure and Kubernetes\"), \" our three Docker images. However, while having the deployment and service up and running, the load-balancer was still not accessible when performing an HTTP request.\"), mdx(\"h1\", null, \"Pre-Requisite\"), mdx(\"h2\", null, \"Reverse Proxy\"), mdx(\"p\", null, \"Between the article where I \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"./azure-intro-kubernetes\"\n  }, \"explained how to publish with Azure and Kubernetes\"), \" and now, I decided to perform a change: using a \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"./docker-image-reverse-proxy-node\"\n  }, \"reverse proxy using a single container for the frontend\"), \" to redirect API calls to a second docker container that has the backend API logics. It is not a required step but it allows us to have in Kubernetes only the frontend with a service exposed publicly. It also has many other advantages, but for our goal to deploy on Microsoft Azure Kubernetes, we want to simplify our infrastructure. The reverse proxy works for all the HTTP requests that the web application performs and for the WebSocket connections.\"), mdx(\"h2\", null, \"New Docker Images\"), mdx(\"p\", null, \"The reverse proxy required many changes. For once, we are using NGINX to reverse proxy. So, there was a need to build and publish frontend images. The backend also changed with a different endpoint for the WebSocket that is now served under the path \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"/ws/\"), \" to differentiate from the GET/POST of HTTP which are directly under the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"/\"), \". That is true for the backend. From the perspective of the frontend, GET/POST is performed toward the frontend server with the path \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"/api/\"), \".\"), mdx(\"p\", null, \"The new images are created automatically since we created an \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"./azure-docker-container-repository-github\"\n  }, \"Github Action that builds and push to the Microsoft Azure Registry Container service\"), \".\"), mdx(\"h1\", null, \"The Service Load-Balancer\"), mdx(\"p\", null, \"The backend and Redis services are of type \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"NodePort\"), \", and the frontend service is of type \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"LoadBalancer\"), \". That is one key point in allowing the frontend server to be accessible outside your controlled Kubernetes environment. In the Azure portal, you can see the IP if you go under your Kubernetes Service, and click \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"Services and ingresses\"), \".\"), mdx(\"p\", null, mdx(\"span\", {\n    parentName: \"p\",\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"1200px\"\n    }\n  }, \"\\n      \", mdx(\"a\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-link\",\n    \"href\": \"/static/8bf3e661c3efc7fd1343f118fdd29906/67a79/azure_services_external_ip.png\",\n    \"style\": {\n      \"display\": \"block\"\n    },\n    \"target\": \"_blank\",\n    \"rel\": \"noopener\"\n  }, \"\\n    \", mdx(\"span\", {\n    parentName: \"a\",\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"37%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAA7EAAAOxAGVKw4bAAABLUlEQVQoz42RSW4UURBE6/5n4C4cgAWy2HkBtozkru7qPw/5x2fVN8gCNqQUymEREZm5xSBc9oP96QveXAkxY50jZ2FOGGP+H+ak98EWfMKHhKhHSrZkqYgIpVZqbe9ojVIKHzH/yh+xaZuRnFYTYuJ6O7DWUWtljIH3npTSqk/M+S/Jn4TGorXGOYO1hpQiRYTeO601YoyL/KxPzLVaZ4xO+yV6zn7nzRiHVnekdJyPhBiJ0pbaSZxzZsxOSBaRslY/Z31A75Pa+urPM52Cm7pZTpc9XnD3Z7x3mNhovVOK4JyjVMEntR4lkkkxkOxPmlhyUITgF2Ethe24GazzZPPE8f0zLz8e2FVct/POsl9esVZxNxeM1mitUMfO/vCJ/fkr15dv3K6vWGOWmTfQ9x9piu7u9gAAAABJRU5ErkJggg==')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  }), \"\\n  \", mdx(\"img\", {\n    parentName: \"a\",\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"azure services external ip\",\n    \"title\": \"azure services external ip\",\n    \"src\": \"/static/8bf3e661c3efc7fd1343f118fdd29906/c1b63/azure_services_external_ip.png\",\n    \"srcSet\": [\"/static/8bf3e661c3efc7fd1343f118fdd29906/5a46d/azure_services_external_ip.png 300w\", \"/static/8bf3e661c3efc7fd1343f118fdd29906/0a47e/azure_services_external_ip.png 600w\", \"/static/8bf3e661c3efc7fd1343f118fdd29906/c1b63/azure_services_external_ip.png 1200w\", \"/static/8bf3e661c3efc7fd1343f118fdd29906/67a79/azure_services_external_ip.png 1408w\"],\n    \"sizes\": \"(max-width: 1200px) 100vw, 1200px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\",\n    \"decoding\": \"async\"\n  }), \"\\n  \"), \"\\n    \")), mdx(\"p\", null, \"It is also possible to get the same information with the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"kubectrl\"), \":\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\"\n  }, \"kubectl get services -n realtimepixel-prod\\n\")), mdx(\"p\", null, \"Which should give something in this format:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\"\n  }, \"NAME               TYPE           CLUSTER-IP     EXTERNAL-IP     PORT(S)          AGE\\nbackend-service    NodePort       10.0.232.135   <none>          80:30606/TCP     10d\\nfrontend-service   LoadBalancer   10.0.208.65    20........ .6   80:30194/TCP     10d\\nredis-service      NodePort       10.0.172.49    <none>          6379:30408/TCP   10d\\n\")), mdx(\"p\", null, \"If your code is working well on all your pods under all these services, the IP will provide your web application. Same thing if you use the frontend to perform an API call using the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"/api\"), \"; it will work. However, if one pod is in a bad state, it will not work but still provide you with an IP. I was stubborn, and though I had a Kubernetes issue while I had a code issue. In my case, environment variables were not properly passed. If the link (ip and port) is not providing your the expected result, it is important to not assume that the code is executing properly. Maybe the pod is not crashing but the actual code is not executing the server as expected.\"), mdx(\"h1\", null, \"Static IP for the frontend service\"), mdx(\"p\", null, \"In this step, we will assign a static IP to the frontend. The IP is still not using an ingress but shows how to have permanent access to the frontend.\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-sh\"\n  }, \"az aks show \\\\\\n  --resource-group realtimepixel_resourcegroup \\\\\\n  --name realpixelask2 \\\\\\n  --query nodeResourceGroup \\\\\\n  -o tsv\\n\\naz network public-ip create \\\\\\n  --resource-group MC_realtimepixel_resourcegroup_realpixelask2_eastus \\\\\\n  --name realtimepixel_public_ip \\\\\\n  --sku Standard \\\\\\n  --allocation-method static \\\\\\n  --query publicIp.ipAddress \\\\\\n  -o tsv\\n\")), mdx(\"p\", null, \"The result was for me \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"20.121.6.121\")), mdx(\"p\", null, \"On the Microsoft Azure Portal, we can see the new entry under the \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"Public IP addresses\"), \" service.\"), mdx(\"p\", null, mdx(\"span\", {\n    parentName: \"p\",\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"1200px\"\n    }\n  }, \"\\n      \", mdx(\"a\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-link\",\n    \"href\": \"/static/924db3262a5dfd835ca76fe0e2d2bafc/b0aa6/azure_publicip.png\",\n    \"style\": {\n      \"display\": \"block\"\n    },\n    \"target\": \"_blank\",\n    \"rel\": \"noopener\"\n  }, \"\\n    \", mdx(\"span\", {\n    parentName: \"a\",\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"31.666666666666664%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAA7EAAAOxAGVKw4bAAABGElEQVQY06WQXUvDMBSG+///gpeiV+KFMvDCi4Giq+LAy01lOvBjK7Np0yRNTtJH2sr8AQYe8nJOzseb7OBiweHlyORuxWypuFmM3C4r8ud6z/2LZjLfcXS14TQvOL7eDpzMCs4evjnP38nUOudzOWXzNKVc50DHf07mWkFpS2M92nh2SqO0QdVm0GXdYFxLWWm0cWgbMC6QUkeMidjfexJZCB7fOlIUfOgfe5yXgb6RdR4vcdBtEOxvvGkaQgiIBKw1eO+JImSNbbGtIAkkQogdXfdn2zpHVTdI7JCYhuKUIiklYowoVWNsiw8RkUi22b6xXs35eH2k+FpRGRkGjE27wWKhWna1p6zHzdJvrrdd6jDkevqv+AE2JcnTWewnwgAAAABJRU5ErkJggg==')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  }), \"\\n  \", mdx(\"img\", {\n    parentName: \"a\",\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"azure publicip\",\n    \"title\": \"azure publicip\",\n    \"src\": \"/static/924db3262a5dfd835ca76fe0e2d2bafc/c1b63/azure_publicip.png\",\n    \"srcSet\": [\"/static/924db3262a5dfd835ca76fe0e2d2bafc/5a46d/azure_publicip.png 300w\", \"/static/924db3262a5dfd835ca76fe0e2d2bafc/0a47e/azure_publicip.png 600w\", \"/static/924db3262a5dfd835ca76fe0e2d2bafc/c1b63/azure_publicip.png 1200w\", \"/static/924db3262a5dfd835ca76fe0e2d2bafc/b0aa6/azure_publicip.png 1233w\"],\n    \"sizes\": \"(max-width: 1200px) 100vw, 1200px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\",\n    \"decoding\": \"async\"\n  }), \"\\n  \"), \"\\n    \")), mdx(\"p\", null, \"Update the frontend service Helm chart to receive a new annotation and the new IP.\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-yml\",\n    \"metastring\": \"{4-6}\",\n    \"{4-6}\": true\n  }, \"apiVersion: v1\\nkind: Service\\nmetadata:\\n  {{- with .Values.frontend.annotations }}\\n  annotations:\\n    {{- toYaml . | nindent 4 }}\\n  {{- end }}\\n  name: {{ .Values.frontendServiceName }}\\n  namespace: {{ .Values.namespace }}\\n  labels:\\n    app: {{ .Values.frontendServiceName }}\\nspec:\\n  loadBalancerIP: {{ .Values.azureLoadBalancerIP }}\\n  type: {{ .Values.frontendService.type }}\\n  ports:\\n    - port: {{ .Values.frontendService.port }}\\n      targetPort: {{ .Values.frontendContainerPort }}\\n  selector:\\n    app: {{ .Values.frontendContainerName }}\\n\")), mdx(\"p\", null, \"and inside the value.yml file:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-yml\"\n  }, \"frontend:\\n  annotations: {\\n    \\\"service.beta.kubernetes.io/azure-load-balancer-resource-group\\\": \\\"MC_realtimepixel_resourcegroup_realpixelask2_eastus\\\"\\n  }\\nazureLoadBalancerIP: \\\"20.121.6.121\\\"\\n\")), mdx(\"p\", null, \"The change will make the frontend service IP remain static regardless of any other new deployment that would have changed the service IP. Still, at this point, who still does not have a domain (DNS) attached to the service? Nor do we have an HTTPS certificate (TLS/SSL).\"), mdx(\"h1\", null, \"Set an Azure DNS address to the static IP\"), mdx(\"p\", null, \"Let's find the unique id of the public IP created in the previous step.\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\"\n  }, \"az network public-ip list \\\\\\n  --query \\\"[?ipAddress!=null]|[?contains(ipAddress, '20.121.6.121')].[id]\\\" \\\\\\n  --output tsv\\n\")), mdx(\"p\", null, \"The result:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\"\n  }, \"/subscriptions/972d99d7-1ce0-4e2a-881b-43969768a358/resourceGroups/mc_realtimepixel_resourcegroup_realpixelask2_eastus/providers/Microsoft.Network/publicIPAddresses/realtimepixel_public_ip_ingress\\n\")), mdx(\"p\", null, \"Apply the DNS \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"realtimepixel\"), \" for the ip:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\"\n  }, \"az network public-ip update \\\\\\n  --ids /subscriptions/972d99d7-1ce0-4e2a-881b-43969768a358/resourceGroups/mc_realtimepixel_resourcegroup_realpixelask2_eastus/providers/Microsoft.Network/publicIPAddresses/realtimepixel_public_ip_ingress \\\\\\n  --dns-name realtimepixel\\n\")), mdx(\"p\", null, \"At this point, the service has a public DNS name: \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"realtimepixel.eastus.cloudapp.azure.com\"), \" pointing to \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"20.121.6.121\"), \" that point to our frontend web server.\"), mdx(TocAzureContainerSeries, {\n    mdxType: \"TocAzureContainerSeries\"\n  }));\n}\n;\nMDXContent.isMDXComponent = true;"}},"pageContext":{"id":"c91c6bf7-b846-5e30-b9ae-66e7c9617f0a","totalPages":77}},
    "staticQueryHashes": ["3159585216"]}