{
    "componentChunkName": "component---src-templates-blog-article-tsx",
    "path": "/blog/apollo-graphql-resolvers-and-data-source-separation",
    "result": {"data":{"mdx":{"frontmatter":{"title":"Apollo GraphQL Resolvers and Data Source separation","date":"February 13, 2019"},"body":"var _excluded = [\"components\"];\n\nfunction _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\n/* @jsxRuntime classic */\n\n/* @jsx mdx */\nvar _frontmatter = {\n  \"title\": \"Apollo GraphQL Resolvers and Data Source separation\",\n  \"date\": \"2019-02-13\",\n  \"categories\": [\"graphql\", \"typescript\"]\n};\nvar layoutProps = {\n  _frontmatter: _frontmatter\n};\nvar MDXLayout = \"wrapper\";\nreturn function MDXContent(_ref) {\n  var components = _ref.components,\n      props = _objectWithoutProperties(_ref, _excluded);\n\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(\"p\", null, \"Resolvers can perform asynchronous call to fetch data. Using the specific implementation to perform the fetch in the resolver cause the resolver to have high-coupling into the technology to access the data but also increase the complexity of the resolver by boosting the size of each function with the request's details. Apollo's resolver allows to pass from the Apollo server's configuration a set of data sources that can be used down the line by every resolver.\"), mdx(\"p\", null, mdx(\"span\", {\n    parentName: \"p\",\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"562px\"\n    }\n  }, \"\\n      \", mdx(\"a\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-link\",\n    \"href\": \"/static/8d03cf2ec7b1d702021a358e7a8a0209/6e88f/GraphQLServers-DataSource.png\",\n    \"style\": {\n      \"display\": \"block\"\n    },\n    \"target\": \"_blank\",\n    \"rel\": \"noopener\"\n  }, \"\\n    \", mdx(\"span\", {\n    parentName: \"a\",\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"50.33333333333333%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAABEUlEQVQoz32SB4rEMAxFff/75QIJCem9Nw1PoCHjnR2BsKz6v2UnD7nvWxW5rkvyPJeqqqRpGsmyTO22bdUmZnZZllLXtXRdJ048sYYIRXEcS1EUWpQkifooxk7TVGOc3BngDNUT3XEcWoSCdNs2WZZF/dM0KRJO7vj3fVebvD8IEZLmeZZhGNQ2XddV0QRBIFEUvX3PHMckoPZ9r8o0GoEMxOd5fihCHjY5ftwRtHdBWQAo7An8ApqQB72vDb9RhgaUx3F8U+JEYROGoW7cp6uUfy2FIlDYABBwwgBmthTQYpPn/O/y/DbQ5zk4eVf+HDbvzndhIBtnODFF+N/HBg2UQUIDkmmKD5T4se1OY1C+AE1QCGXntCsEAAAAAElFTkSuQmCC')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  }), \"\\n  \", mdx(\"img\", {\n    parentName: \"a\",\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"GraphQLServers DataSource\",\n    \"title\": \"GraphQLServers DataSource\",\n    \"src\": \"/static/8d03cf2ec7b1d702021a358e7a8a0209/6e88f/GraphQLServers-DataSource.png\",\n    \"srcSet\": [\"/static/8d03cf2ec7b1d702021a358e7a8a0209/5a46d/GraphQLServers-DataSource.png 300w\", \"/static/8d03cf2ec7b1d702021a358e7a8a0209/6e88f/GraphQLServers-DataSource.png 562w\"],\n    \"sizes\": \"(max-width: 562px) 100vw, 562px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\",\n    \"decoding\": \"async\"\n  }), \"\\n  \"), \"\\n    \")), mdx(\"p\", null, \"Resolvers and DataSource Relationship\"), mdx(\"p\", null, \"Similar to \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"resolvers\"), \", \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"datasources\"), \" is a member is defined in the \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"ApolloServerConfig\"), \". The member is a function that returns a map (dictionary) of data sources. The \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"datasources\"), \"\\xA0is strongly typed as \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"DataSrouces<T>\"), \" where T is your custom context.\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-typescript\"\n  }, \"dataSources: () => {\\n    const dataSources: DataSources<GraphQLCustomContext> = {\\n        dataSourceName1: new MyDataSource1()\\n    };\\n    return dataSources;\\n},\\n\")), mdx(\"p\", null, \"I create one data source per domain because all Rest and gRPC service are already divided by business domain. However, there is no conscribed way to split the data sources. Each data source is class that eventually must inherit\\xA0extends \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"DataSource<T>\"), \" where T is the custom context you have defined for your GraphQL server.\\xA0\"), mdx(\"p\", null, \"In the Netflix Open Connect GraphQL, I decided to have all my REST data source inherit a generic base class that handles all Axios code. The REST class inherits the DataSource from \\\"apollo-datasource\\\" package. The REST encapsulate the Axios package which can be changed later for something else without having to touch resolvers.\"), mdx(\"p\", null, mdx(\"span\", {\n    parentName: \"p\",\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"341px\"\n    }\n  }, \"\\n      \", mdx(\"a\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-link\",\n    \"href\": \"/static/2833f5dc1992b2e659822ad7fc9741c8/4c0ad/GraphQLServers-DataSourceAxios.png\",\n    \"style\": {\n      \"display\": \"block\"\n    },\n    \"target\": \"_blank\",\n    \"rel\": \"noopener\"\n  }, \"\\n    \", mdx(\"span\", {\n    parentName: \"a\",\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"74%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB0ElEQVQ4y22ThwoCQQxE8/+/ZgErtrMrds/ejbzAHAouhC3JTiazWVutVn46nfxwOPwYZ5fLJex8PmfG/ng8/sTu93u/3+9er9fdbreb/xvz+dwrlYp3u13v9/sxDwYDbzabAfhvDIdDN5gwXq9XZu/3Oxiu12vfbrcZo91u52ma+vV6jRjFP5/PwEiSxG25XEYQwd8GAECUOBqNfDKZRMkqUeCaOaMCE10YyQAigMuwAXA8HsdabJlJQNy3bIYDEBiQabPZRDAiUy5ni8UiNGWNDAADxBrfbDaLMx7YEFLB0CeImcGMj0Cds0czlQ4BfJBqt9turVbLG42GV6vVsF6vlwHXajXHzwuz7nQ6ITyAVIFxViqVfDqdRjcYr4WhEZow9FDMGo/HI9MaOWCn12XPgIxBmctkJqNKB5zLrMkOS/wwp1XwSV+q0DsYF7kEul5OonORPYBUoJ/DgB0+qqBU/SJTo5KBGbFhTQA+9aISwZDySYjpK5KAKozM5XI5RKdsLsAI1iQhqFAoZI8jQBLQIfh4VJoajNAQwFwuF4ewQBe1Bj3GpXw+Hw3OGY0MIC1ULBbDuEtSo3kBkQb6dgzYUM63n54kmb6o5II1f/kDRKhzQQa1MkMAAAAASUVORK5CYII=')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  }), \"\\n  \", mdx(\"img\", {\n    parentName: \"a\",\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"GraphQLServers DataSourceAxios\",\n    \"title\": \"GraphQLServers DataSourceAxios\",\n    \"src\": \"/static/2833f5dc1992b2e659822ad7fc9741c8/4c0ad/GraphQLServers-DataSourceAxios.png\",\n    \"srcSet\": [\"/static/2833f5dc1992b2e659822ad7fc9741c8/5a46d/GraphQLServers-DataSourceAxios.png 300w\", \"/static/2833f5dc1992b2e659822ad7fc9741c8/4c0ad/GraphQLServers-DataSourceAxios.png 341w\"],\n    \"sizes\": \"(max-width: 341px) 100vw, 341px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\",\n    \"decoding\": \"async\"\n  }), \"\\n  \"), \"\\n    \")), mdx(\"p\", null, \"Data Sources and Services\"), mdx(\"p\", null, \"It worth pointing that a single data source can use more than a single service. A data source class has many functions for different requests and each of the function can request to one or many services.\"), mdx(\"p\", null, \"Resolvers are now getting access to the data sources by reaching the context which is the third parameters.\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-typescript\"\n  }, \"export const bookResolversMap = {\\n    Query: {\\n        book: async (source: null, args: { bookId: number }, context: GraphQLCustomResolversContext, graphQLResolveInfo: GraphQLResolveInfo) => {\\n            try {\\n                return await context.dataSources.bookService.getBook(args.bookId);\\n            } catch (e) {\\n                console.error(e);\\n            }\\n        }\\n    }\\n};\\n\")), mdx(\"p\", null, \"One question might rises. How is the context having the data source? A keen observer might have spotted that resolvers\\xA0are not using the type\\xA0\", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"GraphQLCustomResolversContext\"), \" for the context instead of the\\xA0GraphQLCustomContext has in all the previous article of this series. The type remains like the original context for everywhere in the application, except for the resolvers. The data sources are injected into the context by Apollo. The TypeScript types for GraphQL context is now in three interfaces.\\xA0 A first one that contains all the data source, one that contain the actual context which we previously defined to contain user's information. Finally, a third one that has the data source and extends the custom context.\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-typescript\"\n  }, \"export interface GraphQLCustomDataSources {\\n    dataSource1: MyDataSource1;\\n}\\n\\nexport interface GraphQLCustomContext {\\n    userRequest: IUserRequest;\\n}\\n\\nexport interface GraphQLCustomResolversContext extends GraphQLCustomContext {\\n    dataSources: GraphQLCustomDataSources;\\n}\\n\")), mdx(\"h2\", null, \"Summary\"), mdx(\"p\", null, \"In this article, we saw how to move a piece around to have a cleaner architecture. The separation of concern allows changing piece without potentially breaking other pieces of code. The division of the task increases the easiness to create unit tests. The little job that each part must conduct simplify the understanding of the code and increase the reusability. In the next article, I'll present how to debug the NodeJS server, Apollo and all the part we already have a setup which will simplify diagnostic when something is going south.\"), mdx(\"h2\", null, \"My Other GraphQL Posts\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"a\", {\n    parentName: \"li\",\n    \"href\": \"getting-started-with-graphql-for-netflix-open-connect\"\n  }, \"Getting Started with GraphQL for Netflix Open Connect\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"a\", {\n    parentName: \"li\",\n    \"href\": \"install-apollo-server-to-host-a-graphql-service\"\n  }, \"Install Apollo Server to host a GraphQL service\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"a\", {\n    parentName: \"li\",\n    \"href\": \"apollo-server-and-secured-playground\"\n  }, \"Apollo Server and Secured Playground\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"a\", {\n    parentName: \"li\",\n    \"href\": \"graphql-context\"\n  }, \"GraphQL Context\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"a\", {\n    parentName: \"li\",\n    \"href\": \"graphql-query-with-argument\"\n  }, \"GraphQL Query with Argument\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"a\", {\n    parentName: \"li\",\n    \"href\": \"apollo-graphql-resolvers-and-data-source-separation\"\n  }, \"Apollo GraphQL Resolvers and Data Source separation\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"a\", {\n    parentName: \"li\",\n    \"href\": \"how-to-setup-a-typescript-nodejs-express-apollo-server-to-easy-debugging-with-vscode\"\n  }, \"How to setup a TypeScript, NodeJS, Express Apollo Server to easy debugging with VsCode\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"a\", {\n    parentName: \"li\",\n    \"href\": \"graphql-resolvers-with-apollo\"\n  }, \"GraphQL Resolvers with Apollo\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"a\", {\n    parentName: \"li\",\n    \"href\": \"configuring-apollo-playground-and-api-on-two-different-url\"\n  }, \"Configuring Apollo Playground and API on two different URL\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"a\", {\n    parentName: \"li\",\n    \"href\": \"how-to-automatically-generate-typescript-for-consumer-of-your-graphql\"\n  }, \"How to automatically generate TypeScript for consumers of your GraphQL\"))));\n}\n;\nMDXContent.isMDXComponent = true;"}},"pageContext":{"id":"5513e34b-f0cf-5f84-8ad1-c3b6db2089c4","totalPages":68}},
    "staticQueryHashes": ["3159585216"]}