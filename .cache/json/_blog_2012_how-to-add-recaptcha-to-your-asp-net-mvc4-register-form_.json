{"data":{"mdx":{"frontmatter":{"title":"How to add ReCaptcha to your Asp.Net MVC4 register form.","date":"October 19, 2012"},"body":"var _excluded = [\"components\"];\n\nfunction _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\n/* @jsxRuntime classic */\n\n/* @jsx mdx */\nvar _frontmatter = {\n  \"title\": \"How to add ReCaptcha to your Asp.Net MVC4 register form.\",\n  \"date\": \"2012-10-19\",\n  \"categories\": [\"asp-mvc\"]\n};\nvar layoutProps = {\n  _frontmatter: _frontmatter\n};\nvar MDXLayout = \"wrapper\";\nreturn function MDXContent(_ref) {\n  var components = _ref.components,\n      props = _objectWithoutProperties(_ref, _excluded);\n\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(\"p\", null, \"To prevent bot (automatic program that act like a human without being a real one) to register account to your website, you can use what we can captcha. Captcha is image that only human can read. They have letters that need to be input in a text box when the form is filled up. Today, I'll show you how to implement ReCaptcha, a popular Captcha service that is totally free and owned by Google.\"), mdx(\"p\", null, mdx(\"span\", {\n    parentName: \"p\",\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"331px\"\n    }\n  }, \"\\n      \", mdx(\"a\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-link\",\n    \"href\": \"/static/815b03ffd021958928f39d0c2550190e/62452/recaptchaMVCScreen-331x400.png\",\n    \"style\": {\n      \"display\": \"block\"\n    },\n    \"target\": \"_blank\",\n    \"rel\": \"noopener\"\n  }, \"\\n    \", mdx(\"span\", {\n    parentName: \"a\",\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"121%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAYCAYAAAD6S912AAAACXBIWXMAAAsTAAALEwEAmpwYAAAD+0lEQVQ4y52V2W9bVRDG/b9URVTipVIfECJCIPoAiJY3kHgq9KVS80JfAIkHShGgsrQQ0SRCkGZr06apmiYEZSnNntqJl9wsJon3tfZd7OubaydefuiexE7iJqLiSJ/neM7cOTOfZubYNFWjuvJmnoyWIZvJYukzqoamaGKvKuozqOr329isH7/fRzKZIh6NEQ6FiYSjpJ6mSCaSyGmZdCqNIivig6q0YJ1VpWVjObVlNY2O9j9obWnh6jff0tHWwfVrTcxMzSAtLjE6PMLg4ACzc3N4XB4eP3rE9NQMjidPmJyYZHJ8kvGxcZZXVkVmIkJV1UgmEvg2fKiKJm4Tt8uKiNT6X9VV9ztI1c6rkdusMJckiYUFJ16vl+mpaULBsLjNMrL4OYy//Tzu51hEmDdNisUiW1tbbG9vi32pWBKyWJN7uposlTByxgFedx3mqZQrlMtlYVTIF54PhQK6rqPK6kGHq8sruJwu3C63gMWLxdfzYH90NYepVIp4LE4sFiOZTGJumpjmHqwMDkU+j57Vn3Vo8XHUqlQqgobDYFFkGDscHijsaCQqSsbn84vCDgVDhEMh/L4AiXhCGNendhSEw4A/wLIk4fX+w+rKiigjaXGRRY9EIhYnp+fI7rZkPerb0mbdXCyX+b/LzBfqUrY28Tiyb51cLIIRiwrkohHUgB/Zv4Hi9wl5ED4U3wZqLCo6bS9lVSM68ifxiTE6vv6S0d+ame5ux373FtGpx2jueYGsZwFdcpKTXOiSi9ySG8UxQ2SoH9Vq02qEsjVV7DNUgLsDA3T29nKz5zb3BgfQTHNnrFHB2C6iGpuksjppPcdTLSPOkvZZ0rE4mpapcigTGB0lF0tTMbYoZU3Kep5ixpIF4uthvrj0Ob9eu853V65w9avLfHbpE240/UIpbxKe+Jt0IrHnUNUMpM7vWe8+z0Lbx3hufoSr7RxLXedZ+P0ca70X8LS+z/33Xqfv9Gv0f/gB3W+dpvmlE7SeOM7QxQvoxqaYTDsRKibe+5fZXG0kHbxFJtyFEuwUMuVrZ0vtYzvYzMibL/LXG6/QfuZdut55m59fOM6nNhudZ89gFLZQdoetTcuYLN/5geCDiyiuPlKO26Tne0g7epDne5Cdfaw//ImBsw3caXiZllcbuHHqFE0nT/LjsWP0NzaSM/P75qGWIRWMEHF5CDkdhJ0O/I45/PYqZgnM2wl4JAKeRUJuNyHPImFJIuT2kAwEa/zVBuzy2gZ2aZmFlTUcS14SsophFshumuibeXRLGobgKltFzhAyUz8crFfO7nRzb2CIB0PDPBweIxiKiBfPqgBBtqzspFSHmq6+l2VLKQpTQ9l92Y56Ov9rOPwLdgrC0mvCn1MAAAAASUVORK5CYII=')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  }), \"\\n  \", mdx(\"img\", {\n    parentName: \"a\",\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"recaptchaMVCScreen 331x400\",\n    \"title\": \"recaptchaMVCScreen 331x400\",\n    \"src\": \"/static/815b03ffd021958928f39d0c2550190e/62452/recaptchaMVCScreen-331x400.png\",\n    \"srcSet\": [\"/static/815b03ffd021958928f39d0c2550190e/5a46d/recaptchaMVCScreen-331x400.png 300w\", \"/static/815b03ffd021958928f39d0c2550190e/62452/recaptchaMVCScreen-331x400.png 331w\"],\n    \"sizes\": \"(max-width: 331px) 100vw, 331px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\",\n    \"decoding\": \"async\"\n  }), \"\\n  \"), \"\\n    \")), mdx(\"p\", null, \"The first step is to register a API key for your website. You can go to \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"http://www.google.com/recaptcha\"\n  }, \"http://www.google.com/recaptcha\"), \" and create a new one. I suggest you to not check the check box of \\\"Enable this key on all domains\\\" to be able to debug with localhost. So, after this step, you will have a private and public key that will be required to use the ReCaptcha service.\"), mdx(\"p\", null, \"The second step is to have library to access ReCaptcha. Inside your project, add the two following NuGet Package. One is the Recaptcha API service and the other one will give you \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"Html helper\"), \". \", mdx(\"span\", {\n    parentName: \"p\",\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"400px\"\n    }\n  }, \"\\n      \", mdx(\"a\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-link\",\n    \"href\": \"/static/ecfb4e61e8059f56b114e9130f78f7e0/e17e5/recaptchaMVC1-400x131.png\",\n    \"style\": {\n      \"display\": \"block\"\n    },\n    \"target\": \"_blank\",\n    \"rel\": \"noopener\"\n  }, \"\\n    \", mdx(\"span\", {\n    parentName: \"a\",\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"32.666666666666664%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsTAAALEwEAmpwYAAABYElEQVQoz5WR3ZKaQBSEef9H2VxtnmFTZkFgBRZNxQXREWFAEQb8AfXbYja5yV26qqf79MWZOWcM23FJ0y2TyYSfr684to01tXFcl3A+5+XlB0my5nq9cjqd6boTXdfRti1t29EoRX8esJIpwfYd4/n5O6kQmKaF73m8uS5+EDA1LTzPx7VtfM8nDEOC4F37+R+/Xics5gvCICQtUypVYQzDQJ5nJEmClBKx2RBFEWIjEGKr6ziKWa1WLH8viaKYOI6pqiNtq1BKUTc1w2WgP/cY4/OVaiiKQlMIoRuXZUkuJYeq4l88Rj4e3O93bvebzpJ9QnpMMZ6evlHIHNM0cRwHyzR5m820jtnM88nzXF8gRy1KDocDeZZRFCVlUbCXexZygagFxm63Q+aZ3sXH8oNfYcg2zWjV1zhN01BVFXVd60b1sdaZ9vWXH/UvjPHo+17/2uVy4dR1uv5f3G43zU/tmwg84aTKoAAAAABJRU5ErkJggg==')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  }), \"\\n  \", mdx(\"img\", {\n    parentName: \"a\",\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"recaptchaMVC1 400x131\",\n    \"title\": \"recaptchaMVC1 400x131\",\n    \"src\": \"/static/ecfb4e61e8059f56b114e9130f78f7e0/e17e5/recaptchaMVC1-400x131.png\",\n    \"srcSet\": [\"/static/ecfb4e61e8059f56b114e9130f78f7e0/5a46d/recaptchaMVC1-400x131.png 300w\", \"/static/ecfb4e61e8059f56b114e9130f78f7e0/e17e5/recaptchaMVC1-400x131.png 400w\"],\n    \"sizes\": \"(max-width: 400px) 100vw, 400px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\",\n    \"decoding\": \"async\"\n  }), \"\\n  \"), \"\\n    \")), mdx(\"p\", null, \"The third step is to configure your project with the public and private key. This can be done by adding 2 appsettings in the web.config.\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-xml\"\n  }, \"<appSettings> <add key=\\\"webpages:Version\\\" value=\\\"2.0.0.0\\\" /> <add key=\\\"webpages:Enabled\\\" value=\\\"false\\\" /> <add key=\\\"PreserveLoginUrl\\\" value=\\\"true\\\" /> <add key=\\\"ClientValidationEnabled\\\" value=\\\"true\\\" /> <add key=\\\"UnobtrusiveJavaScriptEnabled\\\" value=\\\"true\\\" />\\n\\n<add key=\\\"RecaptchaPrivateKey\\\" value=\\\"123nI9cSAAAAALtUefffnLRn2pWb7IpNrtOGQjzz\\\" /> <add key=\\\"RecaptchaPublicKey\\\" value=\\\"123nI9cSAAAAAOH3eee3t1ZaZ6rRUwHQK4KMimfu\\\" /> </appSettings> \\n\")), mdx(\"p\", null, \"The forth step is to let know every page about the new library by adding the name space into the system.web configuration of the web.config.\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-xml\"\n  }, \"<system.web> <pages> <namespaces> <add namespace=\\\"System.Web.Helpers\\\" /> <add namespace=\\\"System.Web.Mvc\\\" /> <add namespace=\\\"System.Web.Mvc.Ajax\\\" /> <add namespace=\\\"System.Web.Mvc.Html\\\" /> <add namespace=\\\"System.Web.Optimization\\\" /> <add namespace=\\\"System.Web.Routing\\\" /> <add namespace=\\\"System.Web.WebPages\\\" /> <add namespace=\\\"Recaptcha\\\" /> </namespaces> </pages> \\n\")), mdx(\"p\", null, \"The fifth step is to add the control to the register form.\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-csharp\"\n  }, \" <li> @Html.Raw(Html.GenerateCaptcha()) @Html.ValidationMessage(\\\"recaptcha\\\") </li> \\n\")), mdx(\"p\", null, \"The last step is to check if everything is fine from the controller side. This will be validated when the user will submit the form to the server.\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-csharp\"\n  }, \" [RecaptchaControlMvc.CaptchaValidator] public ActionResult Register(RegisterModel model, bool captchaValid, string captchaErrorMessage) { if (ModelState.IsValid) { if (!captchaValid) { ModelState.AddModelError(\\\"recaptcha\\\", captchaErrorMessage); return View(model); } //... \\n\")), mdx(\"p\", null, \"You need first to add the attribute that will call the server and do the validation. Second, you need to add 2 variables to the action that will tell you if the captcha is valid and the message. You can then check the value and display the form again if it's wrong.\"), mdx(\"p\", null, \"Nothing has to be done when developing into localhost (or 127.0.0.1) because ReCaptcha service allow developer to use for any key the localhost domain.\"), mdx(\"h2\", null, \"Behind the library\"), mdx(\"p\", null, \"The first section was enough to let you implement ReCaptcha with your Asp.Net MVC 4 website. Now, let check a little bit the code behind the library. First, the html helper. This helper, create an instance of RecaptchaControl with the id \\\"recaptcha\\\".\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-csharp\"\n  }, \"public static string GenerateCaptcha(this HtmlHelper helper) { return RecaptchaControlMvc.GenerateCaptcha(helper, \\\"recaptcha\\\", \\\"default\\\"); }\\n\\npublic static string GenerateCaptcha(this HtmlHelper helper, string id, string theme) { if (string.IsNullOrEmpty(RecaptchaControlMvc.publicKey) || string.IsNullOrEmpty(RecaptchaControlMvc.privateKey)) throw new ApplicationException(\\\"reCAPTCHA needs to be configured with a public & private key.\\\"); RecaptchaControl recaptchaControl1 = new RecaptchaControl(); recaptchaControl1.ID = id; recaptchaControl1.Theme = theme; recaptchaControl1.PublicKey = RecaptchaControlMvc.publicKey; recaptchaControl1.PrivateKey = RecaptchaControlMvc.privateKey; RecaptchaControl recaptchaControl2 = recaptchaControl1; HtmlTextWriter writer = new HtmlTextWriter((TextWriter) new StringWriter()); recaptchaControl2.RenderControl(writer); return writer.InnerWriter.ToString(); } \\n\")), mdx(\"p\", null, \"This is quite interesting because when you validate your recaptcha you may want to add the error message next to it.\"), mdx(\"p\", null, \"From the same code, we can see that the public and private key come from RecaptchaControlMvc... Those are two static string that get their value from the application setting of the web config file. \"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-csharp\"\n  }, \" public static class RecaptchaControlMvc { private static string publicKey = ConfigurationManager.AppSettings[\\\"RecaptchaPublicKey\\\"]; private static string privateKey = ConfigurationManager.AppSettings[\\\"RecaptchaPrivateKey\\\"]; \\n\")), mdx(\"p\", null, \"So far, nothing very hard to understand and we have two answers concerning the name of the control generated and the name of the setting used for the web.config.\"), mdx(\"p\", null, \"The last interesting part is concerning the filter that we had to add to the action to validate the input of the user. This one is straight forward. It uses the RecaptchaValidator class to access the service and get a response from the ReCaptcha service. It then add the validation answer to the parameter. We have now our third answer concerning what are the parameter to add to the action.\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-csharp\"\n  }, \"public override void OnActionExecuting(ActionExecutingContext filterContext) { RecaptchaValidator recaptchaValidator = new RecaptchaValidator(); recaptchaValidator.PrivateKey = RecaptchaControlMvc.PrivateKey; recaptchaValidator.RemoteIP = filterContext.HttpContext.Request.UserHostAddress; recaptchaValidator.Challenge = filterContext.HttpContext.Request.Form[\\\"recaptcha_challenge_field\\\"]; recaptchaValidator.Response = filterContext.HttpContext.Request.Form[\\\"recaptcha_response_field\\\"]; this.recaptchaResponse = !string.IsNullOrEmpty(recaptchaValidator.Challenge) ? (!string.IsNullOrEmpty(recaptchaValidator.Response) ? recaptchaValidator.Validate() : RecaptchaResponse.InvalidResponse) : RecaptchaResponse.InvalidChallenge; filterContext.ActionParameters[\\\"captchaValid\\\"] = (object) (bool) (this.recaptchaResponse.IsValid ? 1 : 0); filterContext.ActionParameters[\\\"captchaErrorMessage\\\"] = (object) this.recaptchaResponse.ErrorMessage; base.OnActionExecuting(filterContext); } \\n\")), mdx(\"p\", null, \"So that's it for using a captcha to the register form of an Asp.Net MVC 4 application.\"));\n}\n;\nMDXContent.isMDXComponent = true;"}},"pageContext":{"id":"8b3297b1-bdbf-5ef7-9a1c-89f36e739752","slug":"2012/how-to-add-recaptcha-to-your-asp-net-mvc4-register-form","__params":{"slug":"2012"}}}