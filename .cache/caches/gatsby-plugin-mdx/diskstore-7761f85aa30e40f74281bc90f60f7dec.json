{"expireTime":9007200886478394000,"key":"gatsby-plugin-mdx-entire-payload-f645346abf3c58dda93dbdba83f7bcc0--undefined","val":{"mdast":{"type":"root","children":[{"type":"blockquote","children":[{"type":"paragraph","children":[{"type":"text","value":"HTTP Error 401.0 - Unauthorized You do not have permission to view this directory or page.","position":{"start":{"line":2,"column":3,"offset":3},"end":{"line":2,"column":93,"offset":93},"indent":[]}}],"position":{"start":{"line":2,"column":3,"offset":3},"end":{"line":2,"column":93,"offset":93},"indent":[]}}],"position":{"start":{"line":2,"column":1,"offset":1},"end":{"line":2,"column":93,"offset":93},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"When an unauthorized action is trigged, the HttpUnauthorizedResult result called. It produces a 401 error. By default, a 401 error can be handled only by IIS and not directly like a 404 error with Asp. This would be easy if we could set a 401 error page in the web.config, but it's not the case.","position":{"start":{"line":4,"column":1,"offset":95},"end":{"line":4,"column":296,"offset":390},"indent":[]}}],"position":{"start":{"line":4,"column":1,"offset":95},"end":{"line":4,"column":296,"offset":390},"indent":[]}},{"type":"paragraph","children":[{"type":"image","title":null,"url":"images/http401error-400x243.png","alt":null,"position":{"start":{"line":6,"column":1,"offset":392},"end":{"line":6,"column":37,"offset":428},"indent":[]}}],"position":{"start":{"line":6,"column":1,"offset":392},"end":{"line":6,"column":37,"offset":428},"indent":[]}},{"type":"code","lang":"csharp","meta":null,"value":" namespace System.Web.Mvc {\n\n  public class HttpUnauthorizedResult : HttpStatusCodeResult {\n      // HTTP 401 is the status code for unauthorized access. Other code might \n      // intercept this and perform some special logic. For example, the \n      // FormsAuthenticationModule looks for 401 responses and instead redirects \n      // the user to the login page. \n      private const int UnauthorizedCode = 401; \n      public HttpUnauthorizedResult() : this(null) { } \n      public HttpUnauthorizedResult(string statusDescription) : base(UnauthorizedCode, statusDescription) { } \n  } \n} \n// File provided for Reference Use Only by Microsoft Corporation (c) 2007. \n// Copyright (c) Microsoft Corporation. All rights reserved. ","position":{"start":{"line":9,"column":1,"offset":431},"end":{"line":24,"column":4,"offset":1172},"indent":[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"What can be done is to transform the 401 error code into a standard code, like the 200 code. This response header code indicate that the webpage has been found. This will let us counter the 401 behaviors and redirect to a specific actions.","position":{"start":{"line":26,"column":1,"offset":1174},"end":{"line":26,"column":240,"offset":1413},"indent":[]}}],"position":{"start":{"line":26,"column":1,"offset":1174},"end":{"line":26,"column":240,"offset":1413},"indent":[]}},{"type":"code","lang":"csharp","meta":null,"value":"public abstract class HttpUnauthorizedWithRedirectToResultBase : HttpUnauthorizedResult { \n  protected ActionResult_result;\n  public override void ExecuteResult(System.Web.Mvc.ControllerContext context) { \n    if (context == null) \n    throw new ArgumentNullException(\"context\");\n\n    if (context.HttpContext.Request.IsAuthenticated) { \n      context.HttpContext.Response.StatusCode = 200; \n      InitializeResult(context);_result.ExecuteResult(context); \n    } \n    else \n      base.ExecuteResult(context); \n}\n\nprotected abstract void InitializeResult(ControllerContext context); } ","position":{"start":{"line":29,"column":1,"offset":1416},"end":{"line":45,"column":4,"offset":2013},"indent":[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"We will create a new http unauthorized that will set area and view name. This will let us set the default page if we do not want to specify every time which action to use. \nIf nothing will be defined, we will be able to simply put in the shared folder a view with the error.","position":{"start":{"line":47,"column":1,"offset":2015},"end":{"line":48,"column":102,"offset":2289},"indent":[1]}}],"position":{"start":{"line":47,"column":1,"offset":2015},"end":{"line":48,"column":102,"offset":2289},"indent":[1]}},{"type":"code","lang":"csharp","meta":null,"value":"public class HttpUnauthorizedWithRedirectToViewResult : HttpUnauthorizedWithRedirectToResultBase { \n  private readonly string_area; private readonly string_viewName; \n  public HttpUnauthorizedWithRedirectToViewResult(string viewName, string area) {\n    _viewName = viewName;\n    _area = area; \n  }\n\nprotected override void InitializeResult(ControllerContext context) { \n  if (!string.IsNullOrWhiteSpace(_area)) { \n    context.RequestContext.RouteData.DataTokens[\"area\"] =_area; \n  }\n  _result = new ViewResult{ViewName =_viewName}; \n  } \n} ","position":{"start":{"line":51,"column":1,"offset":2292},"end":{"line":66,"column":4,"offset":2846},"indent":[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]}},{"type":"code","lang":"csharp","meta":null,"value":"[AttributeUsage(AttributeTargets.Class | AttributeTargets.Method, Inherited = true, AllowMultiple = false)] \npublic class AuthorizeWith401Support : AuthorizeAttribute { \n  private const string VIEW_NAME = \"NoAccess401\"; \n  private string_actionName;\n\n  public string ActionName { \n    get {\n      return string.IsNullOrWhiteSpace(_actionName)? VIEW_NAME :_actionName;\n    } \n    set {\n      _actionName = value;\n    } \n  }\n\n  public string Controller { get; set; } \n  public string Area { get; set; }\n\n  protected override void HandleUnauthorizedRequest(AuthorizationContext filterContext) { \n    if (filterContext.IsChildAction) { \n      base.HandleUnauthorizedRequest(filterContext); \n    } else { \n      if (string.IsNullOrWhiteSpace(ActionName)) \n        throw new ArgumentException(\"You must set an ActionName\");\n\n      if (string.IsNullOrWhiteSpace(controller)) \n        filterContext.Result = new HttpUnauthorizedWithRedirectToViewResult(ActionName, area); \n    } \n  } \n} ","position":{"start":{"line":69,"column":1,"offset":2849},"end":{"line":99,"column":4,"offset":3842},"indent":[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"Now, you need to use it as you would use the AuthorizeAttribute. It's the same behavior because the ","position":{"start":{"line":101,"column":1,"offset":3844},"end":{"line":101,"column":101,"offset":3944},"indent":[]}},{"type":"inlineCode","value":"AuthorizeWith401Support","position":{"start":{"line":101,"column":101,"offset":3944},"end":{"line":101,"column":126,"offset":3969},"indent":[]}},{"type":"text","value":" inherit from ","position":{"start":{"line":101,"column":126,"offset":3969},"end":{"line":101,"column":140,"offset":3983},"indent":[]}},{"type":"inlineCode","value":"AuthorizeAttribute","position":{"start":{"line":101,"column":140,"offset":3983},"end":{"line":101,"column":160,"offset":4003},"indent":[]}},{"type":"text","value":". However, you have the additionnal ","position":{"start":{"line":101,"column":160,"offset":4003},"end":{"line":101,"column":196,"offset":4039},"indent":[]}},{"type":"inlineCode","value":"ActionName","position":{"start":{"line":101,"column":196,"offset":4039},"end":{"line":101,"column":208,"offset":4051},"indent":[]}},{"type":"text","value":", ","position":{"start":{"line":101,"column":208,"offset":4051},"end":{"line":101,"column":210,"offset":4053},"indent":[]}},{"type":"inlineCode","value":"Area","position":{"start":{"line":101,"column":210,"offset":4053},"end":{"line":101,"column":216,"offset":4059},"indent":[]}},{"type":"text","value":" and ","position":{"start":{"line":101,"column":216,"offset":4059},"end":{"line":101,"column":221,"offset":4064},"indent":[]}},{"type":"inlineCode","value":"Controller","position":{"start":{"line":101,"column":221,"offset":4064},"end":{"line":101,"column":233,"offset":4076},"indent":[]}},{"type":"text","value":" property that let you specify the error action. Of course, if nothing is specifie, the action ","position":{"start":{"line":101,"column":233,"offset":4076},"end":{"line":101,"column":328,"offset":4171},"indent":[]}},{"type":"inlineCode","value":"NoAccess401","position":{"start":{"line":101,"column":328,"offset":4171},"end":{"line":101,"column":341,"offset":4184},"indent":[]}},{"type":"text","value":" will be used.","position":{"start":{"line":101,"column":341,"offset":4184},"end":{"line":101,"column":355,"offset":4198},"indent":[]}}],"position":{"start":{"line":101,"column":1,"offset":3844},"end":{"line":101,"column":355,"offset":4198},"indent":[]}},{"type":"code","lang":"csharp","meta":null,"value":"[AuthorizeWith401Support(Roles = \"admin\")] \npublic ActionResult Index() { \n   //... \n} ","position":{"start":{"line":104,"column":1,"offset":4201},"end":{"line":109,"column":4,"offset":4302},"indent":[1,1,1,1,1]}},{"type":"export","value":"export const _frontmatter = {\"title\":\"Asp.Net MVC HTTP Error 401.0 - Unauthorized\",\"date\":\"2012-11-16\",\"categories\":[\"general\"]}","position":{"start":{"line":112,"column":1,"offset":4305},"end":{"line":112,"column":129,"offset":4433},"indent":[]}}],"position":{"start":{"line":1,"column":1,"offset":0},"end":{"line":112,"column":129,"offset":4433}}},"scopeImports":["import * as React from 'react'"],"scopeIdentifiers":["React"],"body":"var _excluded = [\"components\"];\n\nfunction _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\n/* @jsxRuntime classic */\n\n/* @jsx mdx */\nvar _frontmatter = {\n  \"title\": \"Asp.Net MVC HTTP Error 401.0 - Unauthorized\",\n  \"date\": \"2012-11-16\",\n  \"categories\": [\"general\"]\n};\nvar layoutProps = {\n  _frontmatter: _frontmatter\n};\nvar MDXLayout = \"wrapper\";\nreturn function MDXContent(_ref) {\n  var components = _ref.components,\n      props = _objectWithoutProperties(_ref, _excluded);\n\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(\"blockquote\", null, mdx(\"p\", {\n    parentName: \"blockquote\"\n  }, \"HTTP Error 401.0 - Unauthorized You do not have permission to view this directory or page.\")), mdx(\"p\", null, \"When an unauthorized action is trigged, the HttpUnauthorizedResult result called. It produces a 401 error. By default, a 401 error can be handled only by IIS and not directly like a 404 error with Asp. This would be easy if we could set a 401 error page in the web.config, but it's not the case.\"), mdx(\"p\", null, mdx(\"span\", {\n    parentName: \"p\",\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"400px\"\n    }\n  }, \"\\n      \", mdx(\"a\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-link\",\n    \"href\": \"/static/cb5398ac8336588ef3d6c9d99383cfa5/e17e5/http401error-400x243.png\",\n    \"style\": {\n      \"display\": \"block\"\n    },\n    \"target\": \"_blank\",\n    \"rel\": \"noopener\"\n  }, \"\\n    \", mdx(\"span\", {\n    parentName: \"a\",\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"60.66666666666667%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsTAAALEwEAmpwYAAABtUlEQVQoz5VT2W7jMAz0//9c+xAgadMk9d3Eum3Jh2TPgkq88TZPS2BA8TA5lOhkth0CaxAYwywFAuOYtcbStQi3G/ytwcwYYC1+y7IsL0g6zlDu9/g5HpHvdqj2B5SHA4qPD5Tv76h2O2Rvbyg/v3BtGjDG0NwaNA3Dsim8SuJDQOd6uHFE6xxaS7BQ2sCQ7Rx010EbA6VU1FJICCEwz/MLkuA9OOe4/lwhuICUEsYY6kut7903DLayLRTmcC/ovYdUEmVe4Pv8jfPXGefTBUpqaEVQMNpAShUZtm0b/Yps+YiJOwnSsSCxoOp+8vDThHEc0bv+ib6Hcw7ucV795Ftjq04C3WHXwVr7DA49yP8/8MFHnYTgca1rXM4XpGmKPMuRZTmGfohMn5gwDCOmcXrxTxPBx1gcmcZ11sZH0VKDMwHBBDg9kpARdF+8uceVUP/4jdZo2w5G6fvIhO2ibheXGhJi3vxrzEeM2K3nyLCuShyPJ1RVhbIokaUZsjRFXdeYH03WD7bYCjX4uzbD0MN2FqfPE4q8ALsxpJcUZVaCNzyOSsnbv4LsIstjfp7mcLaP6/QHBV2ec9TKxW0AAAAASUVORK5CYII=')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  }), \"\\n  \", mdx(\"img\", {\n    parentName: \"a\",\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"http401error 400x243\",\n    \"title\": \"http401error 400x243\",\n    \"src\": \"/static/cb5398ac8336588ef3d6c9d99383cfa5/e17e5/http401error-400x243.png\",\n    \"srcSet\": [\"/static/cb5398ac8336588ef3d6c9d99383cfa5/5a46d/http401error-400x243.png 300w\", \"/static/cb5398ac8336588ef3d6c9d99383cfa5/e17e5/http401error-400x243.png 400w\"],\n    \"sizes\": \"(max-width: 400px) 100vw, 400px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\",\n    \"decoding\": \"async\"\n  }), \"\\n  \"), \"\\n    \")), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-csharp\"\n  }, \" namespace System.Web.Mvc {\\n\\n  public class HttpUnauthorizedResult : HttpStatusCodeResult {\\n      // HTTP 401 is the status code for unauthorized access. Other code might \\n      // intercept this and perform some special logic. For example, the \\n      // FormsAuthenticationModule looks for 401 responses and instead redirects \\n      // the user to the login page. \\n      private const int UnauthorizedCode = 401; \\n      public HttpUnauthorizedResult() : this(null) { } \\n      public HttpUnauthorizedResult(string statusDescription) : base(UnauthorizedCode, statusDescription) { } \\n  } \\n} \\n// File provided for Reference Use Only by Microsoft Corporation (c) 2007. \\n// Copyright (c) Microsoft Corporation. All rights reserved. \\n\")), mdx(\"p\", null, \"What can be done is to transform the 401 error code into a standard code, like the 200 code. This response header code indicate that the webpage has been found. This will let us counter the 401 behaviors and redirect to a specific actions.\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-csharp\"\n  }, \"public abstract class HttpUnauthorizedWithRedirectToResultBase : HttpUnauthorizedResult { \\n  protected ActionResult_result;\\n  public override void ExecuteResult(System.Web.Mvc.ControllerContext context) { \\n    if (context == null) \\n    throw new ArgumentNullException(\\\"context\\\");\\n\\n    if (context.HttpContext.Request.IsAuthenticated) { \\n      context.HttpContext.Response.StatusCode = 200; \\n      InitializeResult(context);_result.ExecuteResult(context); \\n    } \\n    else \\n      base.ExecuteResult(context); \\n}\\n\\nprotected abstract void InitializeResult(ControllerContext context); } \\n\")), mdx(\"p\", null, \"We will create a new http unauthorized that will set area and view name. This will let us set the default page if we do not want to specify every time which action to use.\\nIf nothing will be defined, we will be able to simply put in the shared folder a view with the error.\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-csharp\"\n  }, \"public class HttpUnauthorizedWithRedirectToViewResult : HttpUnauthorizedWithRedirectToResultBase { \\n  private readonly string_area; private readonly string_viewName; \\n  public HttpUnauthorizedWithRedirectToViewResult(string viewName, string area) {\\n    _viewName = viewName;\\n    _area = area; \\n  }\\n\\nprotected override void InitializeResult(ControllerContext context) { \\n  if (!string.IsNullOrWhiteSpace(_area)) { \\n    context.RequestContext.RouteData.DataTokens[\\\"area\\\"] =_area; \\n  }\\n  _result = new ViewResult{ViewName =_viewName}; \\n  } \\n} \\n\")), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-csharp\"\n  }, \"[AttributeUsage(AttributeTargets.Class | AttributeTargets.Method, Inherited = true, AllowMultiple = false)] \\npublic class AuthorizeWith401Support : AuthorizeAttribute { \\n  private const string VIEW_NAME = \\\"NoAccess401\\\"; \\n  private string_actionName;\\n\\n  public string ActionName { \\n    get {\\n      return string.IsNullOrWhiteSpace(_actionName)? VIEW_NAME :_actionName;\\n    } \\n    set {\\n      _actionName = value;\\n    } \\n  }\\n\\n  public string Controller { get; set; } \\n  public string Area { get; set; }\\n\\n  protected override void HandleUnauthorizedRequest(AuthorizationContext filterContext) { \\n    if (filterContext.IsChildAction) { \\n      base.HandleUnauthorizedRequest(filterContext); \\n    } else { \\n      if (string.IsNullOrWhiteSpace(ActionName)) \\n        throw new ArgumentException(\\\"You must set an ActionName\\\");\\n\\n      if (string.IsNullOrWhiteSpace(controller)) \\n        filterContext.Result = new HttpUnauthorizedWithRedirectToViewResult(ActionName, area); \\n    } \\n  } \\n} \\n\")), mdx(\"p\", null, \"Now, you need to use it as you would use the AuthorizeAttribute. It's the same behavior because the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"AuthorizeWith401Support\"), \" inherit from \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"AuthorizeAttribute\"), \". However, you have the additionnal \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"ActionName\"), \", \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"Area\"), \" and \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"Controller\"), \" property that let you specify the error action. Of course, if nothing is specifie, the action \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"NoAccess401\"), \" will be used.\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-csharp\"\n  }, \"[AuthorizeWith401Support(Roles = \\\"admin\\\")] \\npublic ActionResult Index() { \\n   //... \\n} \\n\")));\n}\n;\nMDXContent.isMDXComponent = true;","rawMDXOutput":"/* @jsx mdx */\nimport { mdx } from '@mdx-js/react';\n/* @jsxRuntime classic */\n/* @jsx mdx */\n\nexport const _frontmatter = {\n  \"title\": \"Asp.Net MVC HTTP Error 401.0 - Unauthorized\",\n  \"date\": \"2012-11-16\",\n  \"categories\": [\"general\"]\n};\n\nconst layoutProps = {\n  _frontmatter\n};\nconst MDXLayout = \"wrapper\"\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n    <blockquote>\n      <p parentName=\"blockquote\">{`HTTP Error 401.0 - Unauthorized You do not have permission to view this directory or page.`}</p>\n    </blockquote>\n    <p>{`When an unauthorized action is trigged, the HttpUnauthorizedResult result called. It produces a 401 error. By default, a 401 error can be handled only by IIS and not directly like a 404 error with Asp. This would be easy if we could set a 401 error page in the web.config, but it's not the case.`}</p>\n    <p><span parentName=\"p\" {...{\n        \"className\": \"gatsby-resp-image-wrapper\",\n        \"style\": {\n          \"position\": \"relative\",\n          \"display\": \"block\",\n          \"marginLeft\": \"auto\",\n          \"marginRight\": \"auto\",\n          \"maxWidth\": \"400px\"\n        }\n      }}>{`\n      `}<a parentName=\"span\" {...{\n          \"className\": \"gatsby-resp-image-link\",\n          \"href\": \"/static/cb5398ac8336588ef3d6c9d99383cfa5/e17e5/http401error-400x243.png\",\n          \"style\": {\n            \"display\": \"block\"\n          },\n          \"target\": \"_blank\",\n          \"rel\": \"noopener\"\n        }}>{`\n    `}<span parentName=\"a\" {...{\n            \"className\": \"gatsby-resp-image-background-image\",\n            \"style\": {\n              \"paddingBottom\": \"60.66666666666667%\",\n              \"position\": \"relative\",\n              \"bottom\": \"0\",\n              \"left\": \"0\",\n              \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsTAAALEwEAmpwYAAABtUlEQVQoz5VT2W7jMAz0//9c+xAgadMk9d3Eum3Jh2TPgkq88TZPS2BA8TA5lOhkth0CaxAYwywFAuOYtcbStQi3G/ytwcwYYC1+y7IsL0g6zlDu9/g5HpHvdqj2B5SHA4qPD5Tv76h2O2Rvbyg/v3BtGjDG0NwaNA3Dsim8SuJDQOd6uHFE6xxaS7BQ2sCQ7Rx010EbA6VU1FJICCEwz/MLkuA9OOe4/lwhuICUEsYY6kut7903DLayLRTmcC/ovYdUEmVe4Pv8jfPXGefTBUpqaEVQMNpAShUZtm0b/Yps+YiJOwnSsSCxoOp+8vDThHEc0bv+ib6Hcw7ucV795Ftjq04C3WHXwVr7DA49yP8/8MFHnYTgca1rXM4XpGmKPMuRZTmGfohMn5gwDCOmcXrxTxPBx1gcmcZ11sZH0VKDMwHBBDg9kpARdF+8uceVUP/4jdZo2w5G6fvIhO2ibheXGhJi3vxrzEeM2K3nyLCuShyPJ1RVhbIokaUZsjRFXdeYH03WD7bYCjX4uzbD0MN2FqfPE4q8ALsxpJcUZVaCNzyOSsnbv4LsIstjfp7mcLaP6/QHBV2ec9TKxW0AAAAASUVORK5CYII=')\",\n              \"backgroundSize\": \"cover\",\n              \"display\": \"block\"\n            }\n          }}></span>{`\n  `}<img parentName=\"a\" {...{\n            \"className\": \"gatsby-resp-image-image\",\n            \"alt\": \"http401error 400x243\",\n            \"title\": \"http401error 400x243\",\n            \"src\": \"/static/cb5398ac8336588ef3d6c9d99383cfa5/e17e5/http401error-400x243.png\",\n            \"srcSet\": [\"/static/cb5398ac8336588ef3d6c9d99383cfa5/5a46d/http401error-400x243.png 300w\", \"/static/cb5398ac8336588ef3d6c9d99383cfa5/e17e5/http401error-400x243.png 400w\"],\n            \"sizes\": \"(max-width: 400px) 100vw, 400px\",\n            \"style\": {\n              \"width\": \"100%\",\n              \"height\": \"100%\",\n              \"margin\": \"0\",\n              \"verticalAlign\": \"middle\",\n              \"position\": \"absolute\",\n              \"top\": \"0\",\n              \"left\": \"0\"\n            },\n            \"loading\": \"lazy\",\n            \"decoding\": \"async\"\n          }}></img>{`\n  `}</a>{`\n    `}</span></p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-csharp\"\n      }}>{` namespace System.Web.Mvc {\n\n  public class HttpUnauthorizedResult : HttpStatusCodeResult {\n      // HTTP 401 is the status code for unauthorized access. Other code might \n      // intercept this and perform some special logic. For example, the \n      // FormsAuthenticationModule looks for 401 responses and instead redirects \n      // the user to the login page. \n      private const int UnauthorizedCode = 401; \n      public HttpUnauthorizedResult() : this(null) { } \n      public HttpUnauthorizedResult(string statusDescription) : base(UnauthorizedCode, statusDescription) { } \n  } \n} \n// File provided for Reference Use Only by Microsoft Corporation (c) 2007. \n// Copyright (c) Microsoft Corporation. All rights reserved. \n`}</code></pre>\n    <p>{`What can be done is to transform the 401 error code into a standard code, like the 200 code. This response header code indicate that the webpage has been found. This will let us counter the 401 behaviors and redirect to a specific actions.`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-csharp\"\n      }}>{`public abstract class HttpUnauthorizedWithRedirectToResultBase : HttpUnauthorizedResult { \n  protected ActionResult_result;\n  public override void ExecuteResult(System.Web.Mvc.ControllerContext context) { \n    if (context == null) \n    throw new ArgumentNullException(\"context\");\n\n    if (context.HttpContext.Request.IsAuthenticated) { \n      context.HttpContext.Response.StatusCode = 200; \n      InitializeResult(context);_result.ExecuteResult(context); \n    } \n    else \n      base.ExecuteResult(context); \n}\n\nprotected abstract void InitializeResult(ControllerContext context); } \n`}</code></pre>\n    <p>{`We will create a new http unauthorized that will set area and view name. This will let us set the default page if we do not want to specify every time which action to use.\nIf nothing will be defined, we will be able to simply put in the shared folder a view with the error.`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-csharp\"\n      }}>{`public class HttpUnauthorizedWithRedirectToViewResult : HttpUnauthorizedWithRedirectToResultBase { \n  private readonly string_area; private readonly string_viewName; \n  public HttpUnauthorizedWithRedirectToViewResult(string viewName, string area) {\n    _viewName = viewName;\n    _area = area; \n  }\n\nprotected override void InitializeResult(ControllerContext context) { \n  if (!string.IsNullOrWhiteSpace(_area)) { \n    context.RequestContext.RouteData.DataTokens[\"area\"] =_area; \n  }\n  _result = new ViewResult{ViewName =_viewName}; \n  } \n} \n`}</code></pre>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-csharp\"\n      }}>{`[AttributeUsage(AttributeTargets.Class | AttributeTargets.Method, Inherited = true, AllowMultiple = false)] \npublic class AuthorizeWith401Support : AuthorizeAttribute { \n  private const string VIEW_NAME = \"NoAccess401\"; \n  private string_actionName;\n\n  public string ActionName { \n    get {\n      return string.IsNullOrWhiteSpace(_actionName)? VIEW_NAME :_actionName;\n    } \n    set {\n      _actionName = value;\n    } \n  }\n\n  public string Controller { get; set; } \n  public string Area { get; set; }\n\n  protected override void HandleUnauthorizedRequest(AuthorizationContext filterContext) { \n    if (filterContext.IsChildAction) { \n      base.HandleUnauthorizedRequest(filterContext); \n    } else { \n      if (string.IsNullOrWhiteSpace(ActionName)) \n        throw new ArgumentException(\"You must set an ActionName\");\n\n      if (string.IsNullOrWhiteSpace(controller)) \n        filterContext.Result = new HttpUnauthorizedWithRedirectToViewResult(ActionName, area); \n    } \n  } \n} \n`}</code></pre>\n    <p>{`Now, you need to use it as you would use the AuthorizeAttribute. It's the same behavior because the `}<inlineCode parentName=\"p\">{`AuthorizeWith401Support`}</inlineCode>{` inherit from `}<inlineCode parentName=\"p\">{`AuthorizeAttribute`}</inlineCode>{`. However, you have the additionnal `}<inlineCode parentName=\"p\">{`ActionName`}</inlineCode>{`, `}<inlineCode parentName=\"p\">{`Area`}</inlineCode>{` and `}<inlineCode parentName=\"p\">{`Controller`}</inlineCode>{` property that let you specify the error action. Of course, if nothing is specifie, the action `}<inlineCode parentName=\"p\">{`NoAccess401`}</inlineCode>{` will be used.`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-csharp\"\n      }}>{`[AuthorizeWith401Support(Roles = \"admin\")] \npublic ActionResult Index() { \n   //... \n} \n`}</code></pre>\n\n    </MDXLayout>;\n}\n\n;\nMDXContent.isMDXComponent = true;"}}