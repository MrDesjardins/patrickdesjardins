{"expireTime":9007200886478392000,"key":"gatsby-plugin-mdx-entire-payload-08fd0c858f6e1f80e1353c98a9ed6b17--undefined","val":{"mdast":{"type":"root","children":[{"type":"paragraph","children":[{"type":"text","value":"It's rare that I wrote something in PHP but since I have worked with Paypal with PHP in 2009, it will be simpler for me to show you how it works with this language. The same process can be apply for your .Net website. In fact, most steps are within Paypal website and interact with plain Html.","position":{"start":{"line":2,"column":1,"offset":1},"end":{"line":2,"column":294,"offset":294},"indent":[]}}],"position":{"start":{"line":2,"column":1,"offset":1},"end":{"line":2,"column":294,"offset":294},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"Paypal offers many ways to use their system for transaction. By memory, at least since 2009 x.com has become the reference website for Paypal. By then, they have developed rich API and documentation. Nevertheless, the IPN method, the one that I'll show you is simple and works since many years. From what I know, it's been over 6 years that this method is working (and could be more).","position":{"start":{"line":4,"column":1,"offset":296},"end":{"line":4,"column":385,"offset":680},"indent":[]}}],"position":{"start":{"line":4,"column":1,"offset":296},"end":{"line":4,"column":385,"offset":680},"indent":[]}},{"type":"heading","depth":2,"children":[{"type":"text","value":"Coding the button to send the Paypal's request","position":{"start":{"line":6,"column":4,"offset":685},"end":{"line":6,"column":50,"offset":731},"indent":[]}}],"position":{"start":{"line":6,"column":1,"offset":682},"end":{"line":6,"column":50,"offset":731},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"First of all, you need to have a Paypal account and create a ","position":{"start":{"line":8,"column":1,"offset":733},"end":{"line":8,"column":62,"offset":794},"indent":[]}},{"type":"strong","children":[{"type":"text","value":"Merchant account","position":{"start":{"line":8,"column":64,"offset":796},"end":{"line":8,"column":80,"offset":812},"indent":[]}}],"position":{"start":{"line":8,"column":62,"offset":794},"end":{"line":8,"column":82,"offset":814},"indent":[]}},{"type":"text","value":". You can get one for free, no need to have the \"Premium Merchant\" account. The Paypal account is required to receive the fund and the merchant account to be able to charge your customer. Second, you need to create a button that will redirect your user to Paypal with an amount to pay. You need to go to \"Merchant Services\" and create your button.","position":{"start":{"line":8,"column":82,"offset":814},"end":{"line":8,"column":429,"offset":1161},"indent":[]}}],"position":{"start":{"line":8,"column":1,"offset":733},"end":{"line":8,"column":429,"offset":1161},"indent":[]}},{"type":"paragraph","children":[{"type":"image","title":null,"url":"images/buyNowButton-400x179.png","alt":null,"position":{"start":{"line":10,"column":1,"offset":1163},"end":{"line":10,"column":37,"offset":1199},"indent":[]}}],"position":{"start":{"line":10,"column":1,"offset":1163},"end":{"line":10,"column":37,"offset":1199},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"The method I am showing you has the limitation of having few hardcoded values like the price charged. You won't be able to change the amount directly via the Html Form. When creating the button, you'll have to set a fixed price. If you have, let say, three differents account, you may want to have 3 buttons generated with 3 hard coded amount. However, you can charge your customer which should be your main goal. Once the button is created, save the generated Html by Paypal to your webpage. Second, the button needs to be inside a form. This form will send the request to Paypal where the user will enter his Paypal's credential and to complete the order. Once the order is done, Paypal will send you back a message indicating that the transaction is a success or not. From here, you need to tell to Paypal what is the web page it needs to call. You have to go to \"My Account\" and then \"Profile\". You will see \"Instant Payment Notification\", click on it and write your \"callback\" webpage.","position":{"start":{"line":12,"column":1,"offset":1201},"end":{"line":12,"column":991,"offset":2191},"indent":[]}}],"position":{"start":{"line":12,"column":1,"offset":1201},"end":{"line":12,"column":991,"offset":2191},"indent":[]}},{"type":"paragraph","children":[{"type":"image","title":null,"url":"images/ipnconfig-400x302.png","alt":null,"position":{"start":{"line":14,"column":1,"offset":2193},"end":{"line":14,"column":34,"offset":2226},"indent":[]}}],"position":{"start":{"line":14,"column":1,"offset":2193},"end":{"line":14,"column":34,"offset":2226},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"Third, you need to associate the user to the transaction because you want that in the call back to save into your database that you have a new transactions executed for a specific user. This can be done by adding hidden fields to the form where the Paypal's button has been inserted. In fact, you can go to the ","position":{"start":{"line":16,"column":1,"offset":2228},"end":{"line":16,"column":312,"offset":2539},"indent":[]}},{"type":"link","title":null,"url":"https://www.x.com/sites/default/files/ipnguide.pdf","children":[{"type":"text","value":"IPN Guide","position":{"start":{"line":16,"column":313,"offset":2540},"end":{"line":16,"column":322,"offset":2549},"indent":[]}}],"position":{"start":{"line":16,"column":312,"offset":2539},"end":{"line":16,"column":375,"offset":2602},"indent":[]}},{"type":"text","value":" or the ","position":{"start":{"line":16,"column":375,"offset":2602},"end":{"line":16,"column":383,"offset":2610},"indent":[]}},{"type":"link","title":null,"url":"https://www.x.com/developers/paypal/documentation-tools/paypal-payments-standard/integration-guide/Appx_websitestandard_htmlvariables#id08A6HF080O3","children":[{"type":"text","value":"online documentation","position":{"start":{"line":16,"column":384,"offset":2611},"end":{"line":16,"column":404,"offset":2631},"indent":[]}}],"position":{"start":{"line":16,"column":383,"offset":2610},"end":{"line":16,"column":554,"offset":2781},"indent":[]}},{"type":"text","value":" and see all possibles parameters (hidden fields) that can be sent to Paypal with a button. I use the \"custom\" field where I concatenate multiple information like the user id, the goods id, etc.","position":{"start":{"line":16,"column":554,"offset":2781},"end":{"line":16,"column":748,"offset":2975},"indent":[]}}],"position":{"start":{"line":16,"column":1,"offset":2228},"end":{"line":16,"column":748,"offset":2975},"indent":[]}},{"type":"paragraph","children":[{"type":"linkReference","identifier":"php","label":"php","referenceType":"shortcut","children":[{"type":"text","value":"php","position":{"start":{"line":18,"column":2,"offset":2978},"end":{"line":18,"column":5,"offset":2981},"indent":[]}}],"position":{"start":{"line":18,"column":1,"offset":2977},"end":{"line":18,"column":6,"offset":2982},"indent":[]}},{"type":"text","value":" <input type=\"hidden\" name=\"custom\" value=\"<?php echo(urlencode(base64_encode($usagerCourant->getIdUsager().\"+1\")));?>\"> ","position":{"start":{"line":18,"column":6,"offset":2982},"end":{"line":18,"column":127,"offset":3103},"indent":[]}},{"type":"jsx","value":"<input type=\"hidden\" name=\"lc\" value=\"fr\"/>","position":{"start":{"line":18,"column":127,"offset":3103},"end":{"line":18,"column":170,"offset":3146},"indent":[]}},{"type":"text","value":" ","position":{"start":{"line":18,"column":170,"offset":3146},"end":{"line":18,"column":171,"offset":3147},"indent":[]}},{"type":"linkReference","identifier":"/php","label":"/php","referenceType":"shortcut","children":[{"type":"text","value":"/php","position":{"start":{"line":18,"column":172,"offset":3148},"end":{"line":18,"column":176,"offset":3152},"indent":[]}}],"position":{"start":{"line":18,"column":171,"offset":3147},"end":{"line":18,"column":177,"offset":3153},"indent":[]}}],"position":{"start":{"line":18,"column":1,"offset":2977},"end":{"line":18,"column":177,"offset":3153},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"Has you can see in the example above, I am encoding the user id and I concatenate the item id. When Paypal will call back my webpage, I'll be able to get from the http header the field custom and decode the field to get back both information. You can also see that I am using the hidden field name \"lc\". This field tells Paypal to display itself in French. This can be useful if you have multiple languages to support.","position":{"start":{"line":20,"column":1,"offset":3155},"end":{"line":20,"column":419,"offset":3573},"indent":[]}}],"position":{"start":{"line":20,"column":1,"offset":3155},"end":{"line":20,"column":419,"offset":3573},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"Last thing concerning the button and the form: you need to send the request somewhere. You have two places where you can send the transction. The first is the real web site where real money is involved. The second is called \"SandBox\" where is a place to mess around. Everything inside the sandbox is fake, and won't be charged. You can do you test with the sandbox environment without having to refund real transaction. The two url are:","position":{"start":{"line":22,"column":1,"offset":3575},"end":{"line":22,"column":437,"offset":4011},"indent":[]}}],"position":{"start":{"line":22,"column":1,"offset":3575},"end":{"line":22,"column":437,"offset":4011},"indent":[]}},{"type":"paragraph","children":[{"type":"link","title":null,"url":"https://www.paypal.com/cgi-bin/webscr","children":[{"type":"text","value":"https://www.paypal.com/cgi-bin/webscr","position":{"start":{"line":24,"column":1,"offset":4013},"end":{"line":24,"column":38,"offset":4050},"indent":[]}}],"position":{"start":{"line":24,"column":1,"offset":4013},"end":{"line":24,"column":38,"offset":4050},"indent":[]}}],"position":{"start":{"line":24,"column":1,"offset":4013},"end":{"line":24,"column":38,"offset":4050},"indent":[]}},{"type":"paragraph","children":[{"type":"link","title":null,"url":"https://www.sandbox.paypal.com/cgi-bin/webscr","children":[{"type":"text","value":"https://www.sandbox.paypal.com/cgi-bin/webscr","position":{"start":{"line":26,"column":1,"offset":4052},"end":{"line":26,"column":46,"offset":4097},"indent":[]}}],"position":{"start":{"line":26,"column":1,"offset":4052},"end":{"line":26,"column":46,"offset":4097},"indent":[]}}],"position":{"start":{"line":26,"column":1,"offset":4052},"end":{"line":26,"column":46,"offset":4097},"indent":[]}},{"type":"heading","depth":2,"children":[{"type":"text","value":"Creating the IPN's callback","position":{"start":{"line":28,"column":4,"offset":4102},"end":{"line":28,"column":31,"offset":4129},"indent":[]}}],"position":{"start":{"line":28,"column":1,"offset":4099},"end":{"line":28,"column":31,"offset":4129},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"From here, you need to write the call back page. This is where all the hard work is required.","position":{"start":{"line":30,"column":1,"offset":4131},"end":{"line":30,"column":94,"offset":4224},"indent":[]}}],"position":{"start":{"line":30,"column":1,"offset":4131},"end":{"line":30,"column":94,"offset":4224},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"The call back page is harder because the testing process is longuer even with Paypal callback. You'll also need to use to debug log file because you do not have any direct feedback of what is going on.","position":{"start":{"line":32,"column":1,"offset":4226},"end":{"line":32,"column":202,"offset":4427},"indent":[]}}],"position":{"start":{"line":32,"column":1,"offset":4226},"end":{"line":32,"column":202,"offset":4427},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"The first step is to send back to Paypal every parameters with the additionnal command called \"cmd\" and indicating that you are validating that is a real request from Paypal. This is a secure protection that assure that the request is not forged by a malicious user. Since Paypal should have create the request, this one will validate that all parameters that he just sent are valid.","position":{"start":{"line":34,"column":1,"offset":4429},"end":{"line":34,"column":384,"offset":4812},"indent":[]}}],"position":{"start":{"line":34,"column":1,"offset":4429},"end":{"line":34,"column":384,"offset":4812},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"So, your code should look like this one :","position":{"start":{"line":36,"column":1,"offset":4814},"end":{"line":36,"column":42,"offset":4855},"indent":[]}}],"position":{"start":{"line":36,"column":1,"offset":4814},"end":{"line":36,"column":42,"offset":4855},"indent":[]}},{"type":"paragraph","children":[{"type":"linkReference","identifier":"php","label":"php","referenceType":"shortcut","children":[{"type":"text","value":"php","position":{"start":{"line":38,"column":2,"offset":4858},"end":{"line":38,"column":5,"offset":4861},"indent":[]}}],"position":{"start":{"line":38,"column":1,"offset":4857},"end":{"line":38,"column":6,"offset":4862},"indent":[]}},{"type":"text","value":" $req = 'cmd=_notify-validate'; foreach ($_POST as $key => $value) { $value = urlencode(stripslashes($value)); $req .= \"&$key=$value\"; } ","position":{"start":{"line":38,"column":6,"offset":4862},"end":{"line":38,"column":143,"offset":4999},"indent":[]}},{"type":"linkReference","identifier":"/php","label":"/php","referenceType":"shortcut","children":[{"type":"text","value":"/php","position":{"start":{"line":38,"column":144,"offset":5000},"end":{"line":38,"column":148,"offset":5004},"indent":[]}}],"position":{"start":{"line":38,"column":143,"offset":4999},"end":{"line":38,"column":149,"offset":5005},"indent":[]}}],"position":{"start":{"line":38,"column":1,"offset":4857},"end":{"line":38,"column":149,"offset":5005},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"Then, we need to send the request. I use a socket connection to send a Http request. Many other ways could be used of course. ","position":{"start":{"line":40,"column":1,"offset":5007},"end":{"line":40,"column":127,"offset":5133},"indent":[]}},{"type":"linkReference","identifier":"php","label":"php","referenceType":"shortcut","children":[{"type":"text","value":"php","position":{"start":{"line":40,"column":128,"offset":5134},"end":{"line":40,"column":131,"offset":5137},"indent":[]}}],"position":{"start":{"line":40,"column":127,"offset":5133},"end":{"line":40,"column":132,"offset":5138},"indent":[]}},{"type":"text","value":" $header = \"POST /cgi-bin/webscr HTTP/1.0","position":{"start":{"line":40,"column":132,"offset":5138},"end":{"line":40,"column":173,"offset":5179},"indent":[]}},{"type":"text","value":"\\","position":{"start":{"line":40,"column":173,"offset":5179},"end":{"line":40,"column":175,"offset":5181},"indent":[]}},{"type":"text","value":"r","position":{"start":{"line":40,"column":175,"offset":5181},"end":{"line":40,"column":176,"offset":5182},"indent":[]}},{"type":"text","value":"\\","position":{"start":{"line":40,"column":176,"offset":5182},"end":{"line":40,"column":178,"offset":5184},"indent":[]}},{"type":"text","value":"n\"; $header .= \"Content-Type: application/x-www-form-urlencoded","position":{"start":{"line":40,"column":178,"offset":5184},"end":{"line":40,"column":241,"offset":5247},"indent":[]}},{"type":"text","value":"\\","position":{"start":{"line":40,"column":241,"offset":5247},"end":{"line":40,"column":243,"offset":5249},"indent":[]}},{"type":"text","value":"r","position":{"start":{"line":40,"column":243,"offset":5249},"end":{"line":40,"column":244,"offset":5250},"indent":[]}},{"type":"text","value":"\\","position":{"start":{"line":40,"column":244,"offset":5250},"end":{"line":40,"column":246,"offset":5252},"indent":[]}},{"type":"text","value":"n\"; $header .= \"Content-Length: \" . strlen($req) . \"","position":{"start":{"line":40,"column":246,"offset":5252},"end":{"line":40,"column":298,"offset":5304},"indent":[]}},{"type":"text","value":"\\","position":{"start":{"line":40,"column":298,"offset":5304},"end":{"line":40,"column":300,"offset":5306},"indent":[]}},{"type":"text","value":"r","position":{"start":{"line":40,"column":300,"offset":5306},"end":{"line":40,"column":301,"offset":5307},"indent":[]}},{"type":"text","value":"\\","position":{"start":{"line":40,"column":301,"offset":5307},"end":{"line":40,"column":303,"offset":5309},"indent":[]}},{"type":"text","value":"n","position":{"start":{"line":40,"column":303,"offset":5309},"end":{"line":40,"column":304,"offset":5310},"indent":[]}},{"type":"text","value":"\\","position":{"start":{"line":40,"column":304,"offset":5310},"end":{"line":40,"column":306,"offset":5312},"indent":[]}},{"type":"text","value":"r","position":{"start":{"line":40,"column":306,"offset":5312},"end":{"line":40,"column":307,"offset":5313},"indent":[]}},{"type":"text","value":"\\","position":{"start":{"line":40,"column":307,"offset":5313},"end":{"line":40,"column":309,"offset":5315},"indent":[]}},{"type":"text","value":"n\"; if($isDebugging) $fp = fsockopen('","position":{"start":{"line":40,"column":309,"offset":5315},"end":{"line":40,"column":347,"offset":5353},"indent":[]}},{"type":"link","title":null,"url":"http://www.sandbox.paypal.com'","children":[{"type":"text","value":"www.sandbox.paypal.com'","position":{"start":{"line":40,"column":347,"offset":5353},"end":{"line":40,"column":370,"offset":5376},"indent":[]}}],"position":{"start":{"line":40,"column":347,"offset":5353},"end":{"line":40,"column":370,"offset":5376},"indent":[]}},{"type":"text","value":", 80, $errno, $errstr, 30); else $fp = fsockopen('ssl://","position":{"start":{"line":40,"column":370,"offset":5376},"end":{"line":40,"column":426,"offset":5432},"indent":[]}},{"type":"link","title":null,"url":"http://www.paypal.com'","children":[{"type":"text","value":"www.paypal.com'","position":{"start":{"line":40,"column":426,"offset":5432},"end":{"line":40,"column":441,"offset":5447},"indent":[]}}],"position":{"start":{"line":40,"column":426,"offset":5432},"end":{"line":40,"column":441,"offset":5447},"indent":[]}},{"type":"text","value":", 443, $errno, $errstr, 30); ","position":{"start":{"line":40,"column":441,"offset":5447},"end":{"line":40,"column":470,"offset":5476},"indent":[]}},{"type":"linkReference","identifier":"/php","label":"/php","referenceType":"shortcut","children":[{"type":"text","value":"/php","position":{"start":{"line":40,"column":471,"offset":5477},"end":{"line":40,"column":475,"offset":5481},"indent":[]}}],"position":{"start":{"line":40,"column":470,"offset":5476},"end":{"line":40,"column":476,"offset":5482},"indent":[]}}],"position":{"start":{"line":40,"column":1,"offset":5007},"end":{"line":40,"column":476,"offset":5482},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"Before sending back the request to Paypal, I personalty insert some information to my database concerning the transaction id, the item name, the user who bought the item/service the real name of the user and real email, etc. As you can see, I am not yet sending the request but preparing the socket to open an url (that change depending if I am testing or not). Since we are using at different place different url, I suggest that you have a mechanism to switch between dev/debug mode and prod/real mode. For more information concerning which url to use, please refer yourself to ","position":{"start":{"line":42,"column":1,"offset":5484},"end":{"line":42,"column":580,"offset":6063},"indent":[]}},{"type":"link","title":null,"url":"https://www.paypal.com/cgi-bin/webscr?cmd=p/sell/ipn-test-outside","children":[{"type":"text","value":"this documentation","position":{"start":{"line":42,"column":581,"offset":6064},"end":{"line":42,"column":599,"offset":6082},"indent":[]}}],"position":{"start":{"line":42,"column":580,"offset":6063},"end":{"line":42,"column":667,"offset":6150},"indent":[]}},{"type":"text","value":".","position":{"start":{"line":42,"column":667,"offset":6150},"end":{"line":42,"column":668,"offset":6151},"indent":[]}}],"position":{"start":{"line":42,"column":1,"offset":5484},"end":{"line":42,"column":668,"offset":6151},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"The next step is to send the request and wait the response.","position":{"start":{"line":44,"column":1,"offset":6153},"end":{"line":44,"column":60,"offset":6212},"indent":[]}}],"position":{"start":{"line":44,"column":1,"offset":6153},"end":{"line":44,"column":60,"offset":6212},"indent":[]}},{"type":"paragraph","children":[{"type":"linkReference","identifier":"php","label":"php","referenceType":"shortcut","children":[{"type":"text","value":"php","position":{"start":{"line":46,"column":2,"offset":6215},"end":{"line":46,"column":5,"offset":6218},"indent":[]}}],"position":{"start":{"line":46,"column":1,"offset":6214},"end":{"line":46,"column":6,"offset":6219},"indent":[]}},{"type":"text","value":" fputs ($fp, $header . $req); while (!feof($fp)) { $res = fgets ($fp, 1024); if (strcmp ($res, \"VERIFIED\") == 0) { //... //... } fclose ($fp); ","position":{"start":{"line":46,"column":6,"offset":6219},"end":{"line":46,"column":149,"offset":6362},"indent":[]}},{"type":"linkReference","identifier":"/php","label":"/php","referenceType":"shortcut","children":[{"type":"text","value":"/php","position":{"start":{"line":46,"column":150,"offset":6363},"end":{"line":46,"column":154,"offset":6367},"indent":[]}}],"position":{"start":{"line":46,"column":149,"offset":6362},"end":{"line":46,"column":155,"offset":6368},"indent":[]}}],"position":{"start":{"line":46,"column":1,"offset":6214},"end":{"line":46,"column":155,"offset":6368},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"If the answer is the string \"VERIFIED\" then everything is fine. From here, I do some other validation concerning if the price is right with the product/service bought and I can grand the user of his goods. For me, it's simply adding his id to a junction table with special privileges with an expiration date.","position":{"start":{"line":48,"column":1,"offset":6370},"end":{"line":48,"column":309,"offset":6678},"indent":[]}}],"position":{"start":{"line":48,"column":1,"offset":6370},"end":{"line":48,"column":309,"offset":6678},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"Paypal IPN service is fast and your user can be granted of what he bought immediately when you receive the request from the post back. This is a huge advantage because no manual intervention is required and the user can access everything right after he sent you the money.","position":{"start":{"line":50,"column":1,"offset":6680},"end":{"line":50,"column":273,"offset":6952},"indent":[]}}],"position":{"start":{"line":50,"column":1,"offset":6680},"end":{"line":50,"column":273,"offset":6952},"indent":[]}},{"type":"heading","depth":2,"children":[{"type":"text","value":"Testing with the sandbox","position":{"start":{"line":52,"column":4,"offset":6957},"end":{"line":52,"column":28,"offset":6981},"indent":[]}}],"position":{"start":{"line":52,"column":1,"offset":6954},"end":{"line":52,"column":28,"offset":6981},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"You can create fake customer with Paypal's Sandbox. Go to : ","position":{"start":{"line":54,"column":1,"offset":6983},"end":{"line":54,"column":61,"offset":7043},"indent":[]}},{"type":"link","title":null,"url":"https://developer.paypal.com","children":[{"type":"text","value":"https://developer.paypal.com","position":{"start":{"line":54,"column":62,"offset":7044},"end":{"line":54,"column":90,"offset":7072},"indent":[]}}],"position":{"start":{"line":54,"column":61,"offset":7043},"end":{"line":54,"column":121,"offset":7103},"indent":[]}},{"type":"text","value":". Once you have your developer account, which doesn't require you more than having a valid Paypal's account, you'll be able to create fake customer with fake email. This will allow you to use these fake Paypal account to do fake payment in the sandbox. It will also let you do fake refund. This is ideal to practice and to test your button, your post back page and how save into your database information about a transaction.","position":{"start":{"line":54,"column":121,"offset":7103},"end":{"line":54,"column":546,"offset":7528},"indent":[]}}],"position":{"start":{"line":54,"column":1,"offset":6983},"end":{"line":54,"column":546,"offset":7528},"indent":[]}},{"type":"paragraph","children":[{"type":"image","title":null,"url":"images/paypalsandbox-400x349.png","alt":null,"position":{"start":{"line":56,"column":1,"offset":7530},"end":{"line":56,"column":38,"offset":7567},"indent":[]}}],"position":{"start":{"line":56,"column":1,"offset":7530},"end":{"line":56,"column":38,"offset":7567},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"To test with the sandbox you absolytely need to create the button from the fake merchant account you have created in the sandbox. So once you have created a merchant account, log to ","position":{"start":{"line":58,"column":1,"offset":7569},"end":{"line":58,"column":183,"offset":7751},"indent":[]}},{"type":"link","title":null,"url":"https://www.sandbox.paypal.com/","children":[{"type":"text","value":"https://www.sandbox.paypal.com/","position":{"start":{"line":58,"column":183,"offset":7751},"end":{"line":58,"column":214,"offset":7782},"indent":[]}}],"position":{"start":{"line":58,"column":183,"offset":7751},"end":{"line":58,"column":214,"offset":7782},"indent":[]}},{"type":"text","value":" and recreate the button.","position":{"start":{"line":58,"column":214,"offset":7782},"end":{"line":58,"column":239,"offset":7807},"indent":[]}}],"position":{"start":{"line":58,"column":1,"offset":7569},"end":{"line":58,"column":239,"offset":7807},"indent":[]}},{"type":"heading","depth":2,"children":[{"type":"text","value":"Watch out about fraud","position":{"start":{"line":60,"column":4,"offset":7812},"end":{"line":60,"column":25,"offset":7833},"indent":[]}}],"position":{"start":{"line":60,"column":1,"offset":7809},"end":{"line":60,"column":25,"offset":7833},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"Paypal is well know to protect the buyer more than the seller. Once, I have live a situation that he user pay and within the 30 days of refund, the user requested a refund. Even more, the user called his credit card company which created a fee of few dollar on me. In that case, if you provide premium service, it will be very hard to prove that you really provided this service. Trust me, Paypal won't fight for you. This is really sad because if you have downloadable content, and the user download everything and then request for refund, you will lose. The best way to organize your premium service is something that require to user to access only from your website and never more then few months (ideally recurrent payment every month).","position":{"start":{"line":62,"column":1,"offset":7835},"end":{"line":62,"column":741,"offset":8575},"indent":[]}}],"position":{"start":{"line":62,"column":1,"offset":7835},"end":{"line":62,"column":741,"offset":8575},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"Here is a ","position":{"start":{"line":64,"column":1,"offset":8577},"end":{"line":64,"column":11,"offset":8587},"indent":[]}},{"type":"link","title":null,"url":"https://www.x.com/developers/paypal/documentation-tools/ipn/gs_IPN","children":[{"type":"text","value":"great source for Paypal and PHP","position":{"start":{"line":64,"column":12,"offset":8588},"end":{"line":64,"column":43,"offset":8619},"indent":[]}}],"position":{"start":{"line":64,"column":11,"offset":8587},"end":{"line":64,"column":112,"offset":8688},"indent":[]}},{"type":"text","value":".","position":{"start":{"line":64,"column":112,"offset":8688},"end":{"line":64,"column":113,"offset":8689},"indent":[]}}],"position":{"start":{"line":64,"column":1,"offset":8577},"end":{"line":64,"column":113,"offset":8689},"indent":[]}},{"type":"paragraph","children":[{"type":"link","title":null,"url":"https://www.x.com/developers/paypal/documentation-tools/ipn/integration-guide/IPNIntro","children":[{"type":"text","value":"https://www.x.com/developers/paypal/documentation-tools/ipn/integration-guide/IPNIntro","position":{"start":{"line":66,"column":1,"offset":8691},"end":{"line":66,"column":87,"offset":8777},"indent":[]}}],"position":{"start":{"line":66,"column":1,"offset":8691},"end":{"line":66,"column":87,"offset":8777},"indent":[]}},{"type":"text","value":" ","position":{"start":{"line":66,"column":87,"offset":8777},"end":{"line":66,"column":88,"offset":8778},"indent":[]}},{"type":"link","title":null,"url":"http://demos.ipn-easy.com/Howto/TestEnvironment.aspx","children":[{"type":"text","value":"http://demos.ipn-easy.com/Howto/TestEnvironment.aspx","position":{"start":{"line":66,"column":88,"offset":8778},"end":{"line":66,"column":140,"offset":8830},"indent":[]}}],"position":{"start":{"line":66,"column":88,"offset":8778},"end":{"line":66,"column":140,"offset":8830},"indent":[]}}],"position":{"start":{"line":66,"column":1,"offset":8691},"end":{"line":66,"column":140,"offset":8830},"indent":[]}},{"type":"export","value":"export const _frontmatter = {\"title\":\"How to use Paypal's payment for your website and associate the payment to one of your user with PHP\",\"date\":\"2013-04-22\",\"categories\":[\"php\"]}","position":{"start":{"line":69,"column":1,"offset":8833},"end":{"line":69,"column":181,"offset":9013},"indent":[]}}],"position":{"start":{"line":1,"column":1,"offset":0},"end":{"line":69,"column":181,"offset":9013}}},"scopeImports":["import * as React from 'react'"],"scopeIdentifiers":["React"],"body":"var _excluded = [\"components\"];\n\nfunction _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\n/* @jsxRuntime classic */\n\n/* @jsx mdx */\nvar _frontmatter = {\n  \"title\": \"How to use Paypal's payment for your website and associate the payment to one of your user with PHP\",\n  \"date\": \"2013-04-22\",\n  \"categories\": [\"php\"]\n};\nvar layoutProps = {\n  _frontmatter: _frontmatter\n};\nvar MDXLayout = \"wrapper\";\nreturn function MDXContent(_ref) {\n  var components = _ref.components,\n      props = _objectWithoutProperties(_ref, _excluded);\n\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(\"p\", null, \"It's rare that I wrote something in PHP but since I have worked with Paypal with PHP in 2009, it will be simpler for me to show you how it works with this language. The same process can be apply for your .Net website. In fact, most steps are within Paypal website and interact with plain Html.\"), mdx(\"p\", null, \"Paypal offers many ways to use their system for transaction. By memory, at least since 2009 x.com has become the reference website for Paypal. By then, they have developed rich API and documentation. Nevertheless, the IPN method, the one that I'll show you is simple and works since many years. From what I know, it's been over 6 years that this method is working (and could be more).\"), mdx(\"h2\", null, \"Coding the button to send the Paypal's request\"), mdx(\"p\", null, \"First of all, you need to have a Paypal account and create a \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"Merchant account\"), \". You can get one for free, no need to have the \\\"Premium Merchant\\\" account. The Paypal account is required to receive the fund and the merchant account to be able to charge your customer. Second, you need to create a button that will redirect your user to Paypal with an amount to pay. You need to go to \\\"Merchant Services\\\" and create your button.\"), mdx(\"p\", null, mdx(\"span\", {\n    parentName: \"p\",\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"400px\"\n    }\n  }, \"\\n      \", mdx(\"a\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-link\",\n    \"href\": \"/static/748a98f824eeb3f06e2b2e1adb9f107a/e17e5/buyNowButton-400x179.png\",\n    \"style\": {\n      \"display\": \"block\"\n    },\n    \"target\": \"_blank\",\n    \"rel\": \"noopener\"\n  }, \"\\n    \", mdx(\"span\", {\n    parentName: \"a\",\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"44.66666666666667%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAABxklEQVQoz52RYWvUQBCG8/9/gygKRQWhKFoKIlSsvSIoVFu59tre3d5dbtNLNpvs3m6SS/JI9vxQvzrw7gzszsPMvlGmSk7OrxhdCra+4X+i6zrywtJ3HZH1NWKdsd5oHlTJZlBekmQFMivYWou3Jc7sa5kWyFSHu+HN0FdYR9f19H1PdH5xw5M3n3h2eMLLoxEv3n7m6eEJB+9Pef7uC6Pvv1jOZ2QyYTyZcvDhK6+Pz4IOjk55dXzGx9FPrqcrSuuIVL5hKX4g4wvyfIx3Cqs26DTG5glmk5CnkpW8parc3yV76IeJupDbdkdVN2H1aOssv28Es0VCXqT0fYO2GRstKYziOrnix/Ib61wEQD+wdk34r1APx6OIBvKtcMi0pTQ9rqrITIZZX6PVksRmGKOR88keAIjJJYVKA0CrlPu7CV0A90Rm6xnfKeYrh9I1bbcjVpKlTLiPF7jKUZSO+CHDV02ABiPMfn2lDSuZUje7/YTWeW5mmunCo4oG+g6ztcSpJNUZ3lf4qgrZOYdznrquH6mhaZpQB5cHZy7GKbczx0p62rZFqxyxiJkuHrgTaybzNffzJWIuEGKB1gXGWIwx/2gw5Q/E+qcAlPg3kgAAAABJRU5ErkJggg==')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  }), \"\\n  \", mdx(\"img\", {\n    parentName: \"a\",\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"buyNowButton 400x179\",\n    \"title\": \"buyNowButton 400x179\",\n    \"src\": \"/static/748a98f824eeb3f06e2b2e1adb9f107a/e17e5/buyNowButton-400x179.png\",\n    \"srcSet\": [\"/static/748a98f824eeb3f06e2b2e1adb9f107a/5a46d/buyNowButton-400x179.png 300w\", \"/static/748a98f824eeb3f06e2b2e1adb9f107a/e17e5/buyNowButton-400x179.png 400w\"],\n    \"sizes\": \"(max-width: 400px) 100vw, 400px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\",\n    \"decoding\": \"async\"\n  }), \"\\n  \"), \"\\n    \")), mdx(\"p\", null, \"The method I am showing you has the limitation of having few hardcoded values like the price charged. You won't be able to change the amount directly via the Html Form. When creating the button, you'll have to set a fixed price. If you have, let say, three differents account, you may want to have 3 buttons generated with 3 hard coded amount. However, you can charge your customer which should be your main goal. Once the button is created, save the generated Html by Paypal to your webpage. Second, the button needs to be inside a form. This form will send the request to Paypal where the user will enter his Paypal's credential and to complete the order. Once the order is done, Paypal will send you back a message indicating that the transaction is a success or not. From here, you need to tell to Paypal what is the web page it needs to call. You have to go to \\\"My Account\\\" and then \\\"Profile\\\". You will see \\\"Instant Payment Notification\\\", click on it and write your \\\"callback\\\" webpage.\"), mdx(\"p\", null, mdx(\"span\", {\n    parentName: \"p\",\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"400px\"\n    }\n  }, \"\\n      \", mdx(\"a\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-link\",\n    \"href\": \"/static/3b9ef0935cbf09607d4f5edf06a73db2/e17e5/ipnconfig-400x302.png\",\n    \"style\": {\n      \"display\": \"block\"\n    },\n    \"target\": \"_blank\",\n    \"rel\": \"noopener\"\n  }, \"\\n    \", mdx(\"span\", {\n    parentName: \"a\",\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"75.33333333333333%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAAsTAAALEwEAmpwYAAACgUlEQVQ4y6WT62obSRCF5/3fZGGzu2wICwET4yXE2LFsy7ZkWRpZGo3mfr+PZrq/0CP5lpD8ScOhq7vowzlV1VqcFnz6csfJ9Yq0bPndpbVNQxr4pFHExgnZuPvdOECdTTfax07I2g5+gB0kVHXLruvR/CBC13VWxpa/js55/+mcP/77zN9HZwNU/O7jKf8cnfHnx1PeH4/48P8lH05G/Hv8dYiPz++YLk3CJEer84TYMcj8LV2ZgJQgepACkPvz85I/tSr6HikEWlWWeI6Da9nYlkMYp8RpTpYVBEFEnGSUVTOg7cSAutmRlxVZUZKXNW3Xs+sFQkg0J0i5nq2Zr21mj1ucqMTPd0R5y9VkycWNzuVkycJw8dKWuOrRDYeL2wWzR5P5ysZLG7yspW57tCgt0A0PN0gpq3ZQomwKIYb7iW7hRfkby1svZm541E1H14lXOYmmxuZqusawAoqqGSwIKel7wWRhMn7YMNUtoqRg13XDU8dLubhbcXazwIuyfQ2lREqJlmQll9M1ayukaXfPRVaEU33L7YPJ7dxksthSHOb09lHn5OqG0f2C0WzGWJ/Ti73SQeFoamAHKU3bvXRNCLwww/aTAXnZUDQlp+YXTu/HHJ1fs3Zt1q6FGVoIeSBUCpWC+6XF1o0J45yuFz+OhexZRkvqvsIL8r1qfcPd3MRy030V5aGG49mGh5WD6nhZt0Pie4hX82h5MeMHVQZrqG+Q5C+ESuHNbMPjNqDddb/8p/JA6kcZ06U9kKlGPuUGQjWM/TCU4jmh/qSCsq7wOlao293QQNUI9f61E00+W3m5zIoKVQrHj3D9CMsNcIMIP4zxw2SwWFb1G+VPhN8AxHlztYr9+GEAAAAASUVORK5CYII=')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  }), \"\\n  \", mdx(\"img\", {\n    parentName: \"a\",\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"ipnconfig 400x302\",\n    \"title\": \"ipnconfig 400x302\",\n    \"src\": \"/static/3b9ef0935cbf09607d4f5edf06a73db2/e17e5/ipnconfig-400x302.png\",\n    \"srcSet\": [\"/static/3b9ef0935cbf09607d4f5edf06a73db2/5a46d/ipnconfig-400x302.png 300w\", \"/static/3b9ef0935cbf09607d4f5edf06a73db2/e17e5/ipnconfig-400x302.png 400w\"],\n    \"sizes\": \"(max-width: 400px) 100vw, 400px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\",\n    \"decoding\": \"async\"\n  }), \"\\n  \"), \"\\n    \")), mdx(\"p\", null, \"Third, you need to associate the user to the transaction because you want that in the call back to save into your database that you have a new transactions executed for a specific user. This can be done by adding hidden fields to the form where the Paypal's button has been inserted. In fact, you can go to the \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://www.x.com/sites/default/files/ipnguide.pdf\"\n  }, \"IPN Guide\"), \" or the \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://www.x.com/developers/paypal/documentation-tools/paypal-payments-standard/integration-guide/Appx_websitestandard_htmlvariables#id08A6HF080O3\"\n  }, \"online documentation\"), \" and see all possibles parameters (hidden fields) that can be sent to Paypal with a button. I use the \\\"custom\\\" field where I concatenate multiple information like the user id, the goods id, etc.\"), mdx(\"p\", null, \"[php]\", \" <input type=\\\"hidden\\\" name=\\\"custom\\\" value=\\\"<?php echo(urlencode(base64_encode($usagerCourant->getIdUsager().\\\"+1\\\")));?>\\\"> \", mdx(\"input\", {\n    type: \"hidden\",\n    name: \"lc\",\n    value: \"fr\"\n  }), \" \", \"[/php]\"), mdx(\"p\", null, \"Has you can see in the example above, I am encoding the user id and I concatenate the item id. When Paypal will call back my webpage, I'll be able to get from the http header the field custom and decode the field to get back both information. You can also see that I am using the hidden field name \\\"lc\\\". This field tells Paypal to display itself in French. This can be useful if you have multiple languages to support.\"), mdx(\"p\", null, \"Last thing concerning the button and the form: you need to send the request somewhere. You have two places where you can send the transction. The first is the real web site where real money is involved. The second is called \\\"SandBox\\\" where is a place to mess around. Everything inside the sandbox is fake, and won't be charged. You can do you test with the sandbox environment without having to refund real transaction. The two url are:\"), mdx(\"p\", null, mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://www.paypal.com/cgi-bin/webscr\"\n  }, \"https://www.paypal.com/cgi-bin/webscr\")), mdx(\"p\", null, mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://www.sandbox.paypal.com/cgi-bin/webscr\"\n  }, \"https://www.sandbox.paypal.com/cgi-bin/webscr\")), mdx(\"h2\", null, \"Creating the IPN's callback\"), mdx(\"p\", null, \"From here, you need to write the call back page. This is where all the hard work is required.\"), mdx(\"p\", null, \"The call back page is harder because the testing process is longuer even with Paypal callback. You'll also need to use to debug log file because you do not have any direct feedback of what is going on.\"), mdx(\"p\", null, \"The first step is to send back to Paypal every parameters with the additionnal command called \\\"cmd\\\" and indicating that you are validating that is a real request from Paypal. This is a secure protection that assure that the request is not forged by a malicious user. Since Paypal should have create the request, this one will validate that all parameters that he just sent are valid.\"), mdx(\"p\", null, \"So, your code should look like this one :\"), mdx(\"p\", null, \"[php]\", \" $req = 'cmd=_notify-validate'; foreach ($_POST as $key => $value) { $value = urlencode(stripslashes($value)); $req .= \\\"&$key=$value\\\"; } \", \"[/php]\"), mdx(\"p\", null, \"Then, we need to send the request. I use a socket connection to send a Http request. Many other ways could be used of course. \", \"[php]\", \" $header = \\\"POST /cgi-bin/webscr HTTP/1.0\", \"\\\\\", \"r\", \"\\\\\", \"n\\\"; $header .= \\\"Content-Type: application/x-www-form-urlencoded\", \"\\\\\", \"r\", \"\\\\\", \"n\\\"; $header .= \\\"Content-Length: \\\" . strlen($req) . \\\"\", \"\\\\\", \"r\", \"\\\\\", \"n\", \"\\\\\", \"r\", \"\\\\\", \"n\\\"; if($isDebugging) $fp = fsockopen('\", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"http://www.sandbox.paypal.com'\"\n  }, \"www.sandbox.paypal.com'\"), \", 80, $errno, $errstr, 30); else $fp = fsockopen('ssl://\", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"http://www.paypal.com'\"\n  }, \"www.paypal.com'\"), \", 443, $errno, $errstr, 30); \", \"[/php]\"), mdx(\"p\", null, \"Before sending back the request to Paypal, I personalty insert some information to my database concerning the transaction id, the item name, the user who bought the item/service the real name of the user and real email, etc. As you can see, I am not yet sending the request but preparing the socket to open an url (that change depending if I am testing or not). Since we are using at different place different url, I suggest that you have a mechanism to switch between dev/debug mode and prod/real mode. For more information concerning which url to use, please refer yourself to \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://www.paypal.com/cgi-bin/webscr?cmd=p/sell/ipn-test-outside\"\n  }, \"this documentation\"), \".\"), mdx(\"p\", null, \"The next step is to send the request and wait the response.\"), mdx(\"p\", null, \"[php]\", \" fputs ($fp, $header . $req); while (!feof($fp)) { $res = fgets ($fp, 1024); if (strcmp ($res, \\\"VERIFIED\\\") == 0) { //... //... } fclose ($fp); \", \"[/php]\"), mdx(\"p\", null, \"If the answer is the string \\\"VERIFIED\\\" then everything is fine. From here, I do some other validation concerning if the price is right with the product/service bought and I can grand the user of his goods. For me, it's simply adding his id to a junction table with special privileges with an expiration date.\"), mdx(\"p\", null, \"Paypal IPN service is fast and your user can be granted of what he bought immediately when you receive the request from the post back. This is a huge advantage because no manual intervention is required and the user can access everything right after he sent you the money.\"), mdx(\"h2\", null, \"Testing with the sandbox\"), mdx(\"p\", null, \"You can create fake customer with Paypal's Sandbox. Go to : \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://developer.paypal.com\"\n  }, \"https://developer.paypal.com\"), \". Once you have your developer account, which doesn't require you more than having a valid Paypal's account, you'll be able to create fake customer with fake email. This will allow you to use these fake Paypal account to do fake payment in the sandbox. It will also let you do fake refund. This is ideal to practice and to test your button, your post back page and how save into your database information about a transaction.\"), mdx(\"p\", null, mdx(\"span\", {\n    parentName: \"p\",\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"400px\"\n    }\n  }, \"\\n      \", mdx(\"a\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-link\",\n    \"href\": \"/static/0eb80c905b1e6733eab0dfbed5bc652b/e17e5/paypalsandbox-400x349.png\",\n    \"style\": {\n      \"display\": \"block\"\n    },\n    \"target\": \"_blank\",\n    \"rel\": \"noopener\"\n  }, \"\\n    \", mdx(\"span\", {\n    parentName: \"a\",\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"87.33333333333334%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAYAAADdRIy+AAAACXBIWXMAAAsTAAALEwEAmpwYAAADFElEQVQ4y5WU0W/bVBSH+//BGw99GAwkeEB9GK2AIiHBgD4MCqhUMEa1B9hWoRXYAwKxDgkeWFXQFLWlTdvQNHYSmqSxc32v7WvHdhx/yE66ZhpM4ko/Xfvenz+fc8+xp4yaQbNRZ+P3Eqvf3uX2T/fZLO1SPqhwXDNpNBqFzLpJvV6n0Wximia1Wg3DNDk6NjisHHFYqVL564gp13PxfR+hNBWzy6nq4/ZTvDCm3engyx6OI9F+iKc8bKtLGGiyLCMMA5TsEccRSRITBAFTQgik43D7130WVjdZ/OYBn/2wx517G8zMXGJ29g1evjTL2vJH3Fm+wsrleZYW3ufH+3+y/ssGny++x9drt/h58w/29stMOY6DlJJ90+K33SYPKm3KDcF22eCLazf5cPkGr7+1wFcfvM3ia/PMvfIOFy/M8fSLn3Dzu7vMv/om088+z9UbtyhtbY2ASkrqHcXOsUXD0nRURLvjUN4/YXfXYHXte1auf8nVT1dYXFrh3csfM/3SFZauXeeFmTmeeuYC089dZP3e+nmEp7ak0bJpW4Ke0rieoGnu8Xf9ALO2Q61awjwqYVZLHB6UqFZ3MI0tjNo2xvE2Rm2LrtU6B1qWjWE2abU6RRHCvo8QTZQ8QalWISlPcN02vtfBc1vooEscC+JEkKYKz5djYJ62p+n2FLZw8fwAz/MLsJQuSrkIIYv7XMr10TrA93Xh83yNr4PCVwBzJUlCMhiQJAMgb4k+Vs/BErIwx1FElKsfMUgSsmxINhwW7ZPP+QjDcAQUwmE4Xjwb6XCIZQtObQchffwgIk1HnixXNoaN9RgwTdNHNuM44aRjYfeccXTxw5eNfE8A5sqBZ+Z8RHGC7eRnmksipIt0NcoPimwmYf8Z4SPAKKZri5HyVnIU7VObTrdXfGJa6+LcJ595MjBOaLbzvpT0pEcySP9/yuebWVFxR2mUFxRznq4OownIRJX/LcLJKg+HGf04KaLUQUgQRg/l6RBfh/SjmCCMicdt9liEQRDS7/eLxVz5dX5W+a9tUlqP5jPfpN/zPP4BlxvksWN5fIcAAAAASUVORK5CYII=')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  }), \"\\n  \", mdx(\"img\", {\n    parentName: \"a\",\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"paypalsandbox 400x349\",\n    \"title\": \"paypalsandbox 400x349\",\n    \"src\": \"/static/0eb80c905b1e6733eab0dfbed5bc652b/e17e5/paypalsandbox-400x349.png\",\n    \"srcSet\": [\"/static/0eb80c905b1e6733eab0dfbed5bc652b/5a46d/paypalsandbox-400x349.png 300w\", \"/static/0eb80c905b1e6733eab0dfbed5bc652b/e17e5/paypalsandbox-400x349.png 400w\"],\n    \"sizes\": \"(max-width: 400px) 100vw, 400px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\",\n    \"decoding\": \"async\"\n  }), \"\\n  \"), \"\\n    \")), mdx(\"p\", null, \"To test with the sandbox you absolytely need to create the button from the fake merchant account you have created in the sandbox. So once you have created a merchant account, log to \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://www.sandbox.paypal.com/\"\n  }, \"https://www.sandbox.paypal.com/\"), \" and recreate the button.\"), mdx(\"h2\", null, \"Watch out about fraud\"), mdx(\"p\", null, \"Paypal is well know to protect the buyer more than the seller. Once, I have live a situation that he user pay and within the 30 days of refund, the user requested a refund. Even more, the user called his credit card company which created a fee of few dollar on me. In that case, if you provide premium service, it will be very hard to prove that you really provided this service. Trust me, Paypal won't fight for you. This is really sad because if you have downloadable content, and the user download everything and then request for refund, you will lose. The best way to organize your premium service is something that require to user to access only from your website and never more then few months (ideally recurrent payment every month).\"), mdx(\"p\", null, \"Here is a \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://www.x.com/developers/paypal/documentation-tools/ipn/gs_IPN\"\n  }, \"great source for Paypal and PHP\"), \".\"), mdx(\"p\", null, mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://www.x.com/developers/paypal/documentation-tools/ipn/integration-guide/IPNIntro\"\n  }, \"https://www.x.com/developers/paypal/documentation-tools/ipn/integration-guide/IPNIntro\"), \" \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"http://demos.ipn-easy.com/Howto/TestEnvironment.aspx\"\n  }, \"http://demos.ipn-easy.com/Howto/TestEnvironment.aspx\")));\n}\n;\nMDXContent.isMDXComponent = true;","rawMDXOutput":"/* @jsx mdx */\nimport { mdx } from '@mdx-js/react';\n/* @jsxRuntime classic */\n/* @jsx mdx */\n\nexport const _frontmatter = {\n  \"title\": \"How to use Paypal's payment for your website and associate the payment to one of your user with PHP\",\n  \"date\": \"2013-04-22\",\n  \"categories\": [\"php\"]\n};\n\nconst layoutProps = {\n  _frontmatter\n};\nconst MDXLayout = \"wrapper\"\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n    <p>{`It's rare that I wrote something in PHP but since I have worked with Paypal with PHP in 2009, it will be simpler for me to show you how it works with this language. The same process can be apply for your .Net website. In fact, most steps are within Paypal website and interact with plain Html.`}</p>\n    <p>{`Paypal offers many ways to use their system for transaction. By memory, at least since 2009 x.com has become the reference website for Paypal. By then, they have developed rich API and documentation. Nevertheless, the IPN method, the one that I'll show you is simple and works since many years. From what I know, it's been over 6 years that this method is working (and could be more).`}</p>\n    <h2>{`Coding the button to send the Paypal's request`}</h2>\n    <p>{`First of all, you need to have a Paypal account and create a `}<strong parentName=\"p\">{`Merchant account`}</strong>{`. You can get one for free, no need to have the \"Premium Merchant\" account. The Paypal account is required to receive the fund and the merchant account to be able to charge your customer. Second, you need to create a button that will redirect your user to Paypal with an amount to pay. You need to go to \"Merchant Services\" and create your button.`}</p>\n    <p><span parentName=\"p\" {...{\n        \"className\": \"gatsby-resp-image-wrapper\",\n        \"style\": {\n          \"position\": \"relative\",\n          \"display\": \"block\",\n          \"marginLeft\": \"auto\",\n          \"marginRight\": \"auto\",\n          \"maxWidth\": \"400px\"\n        }\n      }}>{`\n      `}<a parentName=\"span\" {...{\n          \"className\": \"gatsby-resp-image-link\",\n          \"href\": \"/static/748a98f824eeb3f06e2b2e1adb9f107a/e17e5/buyNowButton-400x179.png\",\n          \"style\": {\n            \"display\": \"block\"\n          },\n          \"target\": \"_blank\",\n          \"rel\": \"noopener\"\n        }}>{`\n    `}<span parentName=\"a\" {...{\n            \"className\": \"gatsby-resp-image-background-image\",\n            \"style\": {\n              \"paddingBottom\": \"44.66666666666667%\",\n              \"position\": \"relative\",\n              \"bottom\": \"0\",\n              \"left\": \"0\",\n              \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAABxklEQVQoz52RYWvUQBCG8/9/gygKRQWhKFoKIlSsvSIoVFu59tre3d5dbtNLNpvs3m6SS/JI9vxQvzrw7gzszsPMvlGmSk7OrxhdCra+4X+i6zrywtJ3HZH1NWKdsd5oHlTJZlBekmQFMivYWou3Jc7sa5kWyFSHu+HN0FdYR9f19H1PdH5xw5M3n3h2eMLLoxEv3n7m6eEJB+9Pef7uC6Pvv1jOZ2QyYTyZcvDhK6+Pz4IOjk55dXzGx9FPrqcrSuuIVL5hKX4g4wvyfIx3Cqs26DTG5glmk5CnkpW8parc3yV76IeJupDbdkdVN2H1aOssv28Es0VCXqT0fYO2GRstKYziOrnix/Ib61wEQD+wdk34r1APx6OIBvKtcMi0pTQ9rqrITIZZX6PVksRmGKOR88keAIjJJYVKA0CrlPu7CV0A90Rm6xnfKeYrh9I1bbcjVpKlTLiPF7jKUZSO+CHDV02ABiPMfn2lDSuZUje7/YTWeW5mmunCo4oG+g6ztcSpJNUZ3lf4qgrZOYdznrquH6mhaZpQB5cHZy7GKbczx0p62rZFqxyxiJkuHrgTaybzNffzJWIuEGKB1gXGWIwx/2gw5Q/E+qcAlPg3kgAAAABJRU5ErkJggg==')\",\n              \"backgroundSize\": \"cover\",\n              \"display\": \"block\"\n            }\n          }}></span>{`\n  `}<img parentName=\"a\" {...{\n            \"className\": \"gatsby-resp-image-image\",\n            \"alt\": \"buyNowButton 400x179\",\n            \"title\": \"buyNowButton 400x179\",\n            \"src\": \"/static/748a98f824eeb3f06e2b2e1adb9f107a/e17e5/buyNowButton-400x179.png\",\n            \"srcSet\": [\"/static/748a98f824eeb3f06e2b2e1adb9f107a/5a46d/buyNowButton-400x179.png 300w\", \"/static/748a98f824eeb3f06e2b2e1adb9f107a/e17e5/buyNowButton-400x179.png 400w\"],\n            \"sizes\": \"(max-width: 400px) 100vw, 400px\",\n            \"style\": {\n              \"width\": \"100%\",\n              \"height\": \"100%\",\n              \"margin\": \"0\",\n              \"verticalAlign\": \"middle\",\n              \"position\": \"absolute\",\n              \"top\": \"0\",\n              \"left\": \"0\"\n            },\n            \"loading\": \"lazy\",\n            \"decoding\": \"async\"\n          }}></img>{`\n  `}</a>{`\n    `}</span></p>\n    <p>{`The method I am showing you has the limitation of having few hardcoded values like the price charged. You won't be able to change the amount directly via the Html Form. When creating the button, you'll have to set a fixed price. If you have, let say, three differents account, you may want to have 3 buttons generated with 3 hard coded amount. However, you can charge your customer which should be your main goal. Once the button is created, save the generated Html by Paypal to your webpage. Second, the button needs to be inside a form. This form will send the request to Paypal where the user will enter his Paypal's credential and to complete the order. Once the order is done, Paypal will send you back a message indicating that the transaction is a success or not. From here, you need to tell to Paypal what is the web page it needs to call. You have to go to \"My Account\" and then \"Profile\". You will see \"Instant Payment Notification\", click on it and write your \"callback\" webpage.`}</p>\n    <p><span parentName=\"p\" {...{\n        \"className\": \"gatsby-resp-image-wrapper\",\n        \"style\": {\n          \"position\": \"relative\",\n          \"display\": \"block\",\n          \"marginLeft\": \"auto\",\n          \"marginRight\": \"auto\",\n          \"maxWidth\": \"400px\"\n        }\n      }}>{`\n      `}<a parentName=\"span\" {...{\n          \"className\": \"gatsby-resp-image-link\",\n          \"href\": \"/static/3b9ef0935cbf09607d4f5edf06a73db2/e17e5/ipnconfig-400x302.png\",\n          \"style\": {\n            \"display\": \"block\"\n          },\n          \"target\": \"_blank\",\n          \"rel\": \"noopener\"\n        }}>{`\n    `}<span parentName=\"a\" {...{\n            \"className\": \"gatsby-resp-image-background-image\",\n            \"style\": {\n              \"paddingBottom\": \"75.33333333333333%\",\n              \"position\": \"relative\",\n              \"bottom\": \"0\",\n              \"left\": \"0\",\n              \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAAsTAAALEwEAmpwYAAACgUlEQVQ4y6WT62obSRCF5/3fZGGzu2wICwET4yXE2LFsy7ZkWRpZGo3mfr+PZrq/0CP5lpD8ScOhq7vowzlV1VqcFnz6csfJ9Yq0bPndpbVNQxr4pFHExgnZuPvdOECdTTfax07I2g5+gB0kVHXLruvR/CBC13VWxpa/js55/+mcP/77zN9HZwNU/O7jKf8cnfHnx1PeH4/48P8lH05G/Hv8dYiPz++YLk3CJEer84TYMcj8LV2ZgJQgepACkPvz85I/tSr6HikEWlWWeI6Da9nYlkMYp8RpTpYVBEFEnGSUVTOg7cSAutmRlxVZUZKXNW3Xs+sFQkg0J0i5nq2Zr21mj1ucqMTPd0R5y9VkycWNzuVkycJw8dKWuOrRDYeL2wWzR5P5ysZLG7yspW57tCgt0A0PN0gpq3ZQomwKIYb7iW7hRfkby1svZm541E1H14lXOYmmxuZqusawAoqqGSwIKel7wWRhMn7YMNUtoqRg13XDU8dLubhbcXazwIuyfQ2lREqJlmQll9M1ayukaXfPRVaEU33L7YPJ7dxksthSHOb09lHn5OqG0f2C0WzGWJ/Ti73SQeFoamAHKU3bvXRNCLwww/aTAXnZUDQlp+YXTu/HHJ1fs3Zt1q6FGVoIeSBUCpWC+6XF1o0J45yuFz+OhexZRkvqvsIL8r1qfcPd3MRy030V5aGG49mGh5WD6nhZt0Pie4hX82h5MeMHVQZrqG+Q5C+ESuHNbMPjNqDddb/8p/JA6kcZ06U9kKlGPuUGQjWM/TCU4jmh/qSCsq7wOlao293QQNUI9f61E00+W3m5zIoKVQrHj3D9CMsNcIMIP4zxw2SwWFb1G+VPhN8AxHlztYr9+GEAAAAASUVORK5CYII=')\",\n              \"backgroundSize\": \"cover\",\n              \"display\": \"block\"\n            }\n          }}></span>{`\n  `}<img parentName=\"a\" {...{\n            \"className\": \"gatsby-resp-image-image\",\n            \"alt\": \"ipnconfig 400x302\",\n            \"title\": \"ipnconfig 400x302\",\n            \"src\": \"/static/3b9ef0935cbf09607d4f5edf06a73db2/e17e5/ipnconfig-400x302.png\",\n            \"srcSet\": [\"/static/3b9ef0935cbf09607d4f5edf06a73db2/5a46d/ipnconfig-400x302.png 300w\", \"/static/3b9ef0935cbf09607d4f5edf06a73db2/e17e5/ipnconfig-400x302.png 400w\"],\n            \"sizes\": \"(max-width: 400px) 100vw, 400px\",\n            \"style\": {\n              \"width\": \"100%\",\n              \"height\": \"100%\",\n              \"margin\": \"0\",\n              \"verticalAlign\": \"middle\",\n              \"position\": \"absolute\",\n              \"top\": \"0\",\n              \"left\": \"0\"\n            },\n            \"loading\": \"lazy\",\n            \"decoding\": \"async\"\n          }}></img>{`\n  `}</a>{`\n    `}</span></p>\n    <p>{`Third, you need to associate the user to the transaction because you want that in the call back to save into your database that you have a new transactions executed for a specific user. This can be done by adding hidden fields to the form where the Paypal's button has been inserted. In fact, you can go to the `}<a parentName=\"p\" {...{\n        \"href\": \"https://www.x.com/sites/default/files/ipnguide.pdf\"\n      }}>{`IPN Guide`}</a>{` or the `}<a parentName=\"p\" {...{\n        \"href\": \"https://www.x.com/developers/paypal/documentation-tools/paypal-payments-standard/integration-guide/Appx_websitestandard_htmlvariables#id08A6HF080O3\"\n      }}>{`online documentation`}</a>{` and see all possibles parameters (hidden fields) that can be sent to Paypal with a button. I use the \"custom\" field where I concatenate multiple information like the user id, the goods id, etc.`}</p>\n    <p>{`[php]`}{` <input type=\"hidden\" name=\"custom\" value=\"<?php echo(urlencode(base64_encode($usagerCourant->getIdUsager().\"+1\")));?>\"> `}<input type=\"hidden\" name=\"lc\" value=\"fr\" />{` `}{`[/php]`}</p>\n    <p>{`Has you can see in the example above, I am encoding the user id and I concatenate the item id. When Paypal will call back my webpage, I'll be able to get from the http header the field custom and decode the field to get back both information. You can also see that I am using the hidden field name \"lc\". This field tells Paypal to display itself in French. This can be useful if you have multiple languages to support.`}</p>\n    <p>{`Last thing concerning the button and the form: you need to send the request somewhere. You have two places where you can send the transction. The first is the real web site where real money is involved. The second is called \"SandBox\" where is a place to mess around. Everything inside the sandbox is fake, and won't be charged. You can do you test with the sandbox environment without having to refund real transaction. The two url are:`}</p>\n    <p><a parentName=\"p\" {...{\n        \"href\": \"https://www.paypal.com/cgi-bin/webscr\"\n      }}>{`https://www.paypal.com/cgi-bin/webscr`}</a></p>\n    <p><a parentName=\"p\" {...{\n        \"href\": \"https://www.sandbox.paypal.com/cgi-bin/webscr\"\n      }}>{`https://www.sandbox.paypal.com/cgi-bin/webscr`}</a></p>\n    <h2>{`Creating the IPN's callback`}</h2>\n    <p>{`From here, you need to write the call back page. This is where all the hard work is required.`}</p>\n    <p>{`The call back page is harder because the testing process is longuer even with Paypal callback. You'll also need to use to debug log file because you do not have any direct feedback of what is going on.`}</p>\n    <p>{`The first step is to send back to Paypal every parameters with the additionnal command called \"cmd\" and indicating that you are validating that is a real request from Paypal. This is a secure protection that assure that the request is not forged by a malicious user. Since Paypal should have create the request, this one will validate that all parameters that he just sent are valid.`}</p>\n    <p>{`So, your code should look like this one :`}</p>\n    <p>{`[php]`}{` $req = 'cmd=_notify-validate'; foreach ($_POST as $key => $value) { $value = urlencode(stripslashes($value)); $req .= \"&$key=$value\"; } `}{`[/php]`}</p>\n    <p>{`Then, we need to send the request. I use a socket connection to send a Http request. Many other ways could be used of course. `}{`[php]`}{` $header = \"POST /cgi-bin/webscr HTTP/1.0`}{`\\\\`}{`r`}{`\\\\`}{`n\"; $header .= \"Content-Type: application/x-www-form-urlencoded`}{`\\\\`}{`r`}{`\\\\`}{`n\"; $header .= \"Content-Length: \" . strlen($req) . \"`}{`\\\\`}{`r`}{`\\\\`}{`n`}{`\\\\`}{`r`}{`\\\\`}{`n\"; if($isDebugging) $fp = fsockopen('`}<a parentName=\"p\" {...{\n        \"href\": \"http://www.sandbox.paypal.com'\"\n      }}>{`www.sandbox.paypal.com'`}</a>{`, 80, $errno, $errstr, 30); else $fp = fsockopen('ssl://`}<a parentName=\"p\" {...{\n        \"href\": \"http://www.paypal.com'\"\n      }}>{`www.paypal.com'`}</a>{`, 443, $errno, $errstr, 30); `}{`[/php]`}</p>\n    <p>{`Before sending back the request to Paypal, I personalty insert some information to my database concerning the transaction id, the item name, the user who bought the item/service the real name of the user and real email, etc. As you can see, I am not yet sending the request but preparing the socket to open an url (that change depending if I am testing or not). Since we are using at different place different url, I suggest that you have a mechanism to switch between dev/debug mode and prod/real mode. For more information concerning which url to use, please refer yourself to `}<a parentName=\"p\" {...{\n        \"href\": \"https://www.paypal.com/cgi-bin/webscr?cmd=p/sell/ipn-test-outside\"\n      }}>{`this documentation`}</a>{`.`}</p>\n    <p>{`The next step is to send the request and wait the response.`}</p>\n    <p>{`[php]`}{` fputs ($fp, $header . $req); while (!feof($fp)) { $res = fgets ($fp, 1024); if (strcmp ($res, \"VERIFIED\") == 0) { //... //... } fclose ($fp); `}{`[/php]`}</p>\n    <p>{`If the answer is the string \"VERIFIED\" then everything is fine. From here, I do some other validation concerning if the price is right with the product/service bought and I can grand the user of his goods. For me, it's simply adding his id to a junction table with special privileges with an expiration date.`}</p>\n    <p>{`Paypal IPN service is fast and your user can be granted of what he bought immediately when you receive the request from the post back. This is a huge advantage because no manual intervention is required and the user can access everything right after he sent you the money.`}</p>\n    <h2>{`Testing with the sandbox`}</h2>\n    <p>{`You can create fake customer with Paypal's Sandbox. Go to : `}<a parentName=\"p\" {...{\n        \"href\": \"https://developer.paypal.com\"\n      }}>{`https://developer.paypal.com`}</a>{`. Once you have your developer account, which doesn't require you more than having a valid Paypal's account, you'll be able to create fake customer with fake email. This will allow you to use these fake Paypal account to do fake payment in the sandbox. It will also let you do fake refund. This is ideal to practice and to test your button, your post back page and how save into your database information about a transaction.`}</p>\n    <p><span parentName=\"p\" {...{\n        \"className\": \"gatsby-resp-image-wrapper\",\n        \"style\": {\n          \"position\": \"relative\",\n          \"display\": \"block\",\n          \"marginLeft\": \"auto\",\n          \"marginRight\": \"auto\",\n          \"maxWidth\": \"400px\"\n        }\n      }}>{`\n      `}<a parentName=\"span\" {...{\n          \"className\": \"gatsby-resp-image-link\",\n          \"href\": \"/static/0eb80c905b1e6733eab0dfbed5bc652b/e17e5/paypalsandbox-400x349.png\",\n          \"style\": {\n            \"display\": \"block\"\n          },\n          \"target\": \"_blank\",\n          \"rel\": \"noopener\"\n        }}>{`\n    `}<span parentName=\"a\" {...{\n            \"className\": \"gatsby-resp-image-background-image\",\n            \"style\": {\n              \"paddingBottom\": \"87.33333333333334%\",\n              \"position\": \"relative\",\n              \"bottom\": \"0\",\n              \"left\": \"0\",\n              \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAYAAADdRIy+AAAACXBIWXMAAAsTAAALEwEAmpwYAAADFElEQVQ4y5WU0W/bVBSH+//BGw99GAwkeEB9GK2AIiHBgD4MCqhUMEa1B9hWoRXYAwKxDgkeWFXQFLWlTdvQNHYSmqSxc32v7WvHdhx/yE66ZhpM4ko/Xfvenz+fc8+xp4yaQbNRZ+P3Eqvf3uX2T/fZLO1SPqhwXDNpNBqFzLpJvV6n0Wximia1Wg3DNDk6NjisHHFYqVL564gp13PxfR+hNBWzy6nq4/ZTvDCm3engyx6OI9F+iKc8bKtLGGiyLCMMA5TsEccRSRITBAFTQgik43D7130WVjdZ/OYBn/2wx517G8zMXGJ29g1evjTL2vJH3Fm+wsrleZYW3ufH+3+y/ssGny++x9drt/h58w/29stMOY6DlJJ90+K33SYPKm3KDcF22eCLazf5cPkGr7+1wFcfvM3ia/PMvfIOFy/M8fSLn3Dzu7vMv/om088+z9UbtyhtbY2ASkrqHcXOsUXD0nRURLvjUN4/YXfXYHXte1auf8nVT1dYXFrh3csfM/3SFZauXeeFmTmeeuYC089dZP3e+nmEp7ak0bJpW4Ke0rieoGnu8Xf9ALO2Q61awjwqYVZLHB6UqFZ3MI0tjNo2xvE2Rm2LrtU6B1qWjWE2abU6RRHCvo8QTZQ8QalWISlPcN02vtfBc1vooEscC+JEkKYKz5djYJ62p+n2FLZw8fwAz/MLsJQuSrkIIYv7XMr10TrA93Xh83yNr4PCVwBzJUlCMhiQJAMgb4k+Vs/BErIwx1FElKsfMUgSsmxINhwW7ZPP+QjDcAQUwmE4Xjwb6XCIZQtObQchffwgIk1HnixXNoaN9RgwTdNHNuM44aRjYfeccXTxw5eNfE8A5sqBZ+Z8RHGC7eRnmksipIt0NcoPimwmYf8Z4SPAKKZri5HyVnIU7VObTrdXfGJa6+LcJ595MjBOaLbzvpT0pEcySP9/yuebWVFxR2mUFxRznq4OownIRJX/LcLJKg+HGf04KaLUQUgQRg/l6RBfh/SjmCCMicdt9liEQRDS7/eLxVz5dX5W+a9tUlqP5jPfpN/zPP4BlxvksWN5fIcAAAAASUVORK5CYII=')\",\n              \"backgroundSize\": \"cover\",\n              \"display\": \"block\"\n            }\n          }}></span>{`\n  `}<img parentName=\"a\" {...{\n            \"className\": \"gatsby-resp-image-image\",\n            \"alt\": \"paypalsandbox 400x349\",\n            \"title\": \"paypalsandbox 400x349\",\n            \"src\": \"/static/0eb80c905b1e6733eab0dfbed5bc652b/e17e5/paypalsandbox-400x349.png\",\n            \"srcSet\": [\"/static/0eb80c905b1e6733eab0dfbed5bc652b/5a46d/paypalsandbox-400x349.png 300w\", \"/static/0eb80c905b1e6733eab0dfbed5bc652b/e17e5/paypalsandbox-400x349.png 400w\"],\n            \"sizes\": \"(max-width: 400px) 100vw, 400px\",\n            \"style\": {\n              \"width\": \"100%\",\n              \"height\": \"100%\",\n              \"margin\": \"0\",\n              \"verticalAlign\": \"middle\",\n              \"position\": \"absolute\",\n              \"top\": \"0\",\n              \"left\": \"0\"\n            },\n            \"loading\": \"lazy\",\n            \"decoding\": \"async\"\n          }}></img>{`\n  `}</a>{`\n    `}</span></p>\n    <p>{`To test with the sandbox you absolytely need to create the button from the fake merchant account you have created in the sandbox. So once you have created a merchant account, log to `}<a parentName=\"p\" {...{\n        \"href\": \"https://www.sandbox.paypal.com/\"\n      }}>{`https://www.sandbox.paypal.com/`}</a>{` and recreate the button.`}</p>\n    <h2>{`Watch out about fraud`}</h2>\n    <p>{`Paypal is well know to protect the buyer more than the seller. Once, I have live a situation that he user pay and within the 30 days of refund, the user requested a refund. Even more, the user called his credit card company which created a fee of few dollar on me. In that case, if you provide premium service, it will be very hard to prove that you really provided this service. Trust me, Paypal won't fight for you. This is really sad because if you have downloadable content, and the user download everything and then request for refund, you will lose. The best way to organize your premium service is something that require to user to access only from your website and never more then few months (ideally recurrent payment every month).`}</p>\n    <p>{`Here is a `}<a parentName=\"p\" {...{\n        \"href\": \"https://www.x.com/developers/paypal/documentation-tools/ipn/gs_IPN\"\n      }}>{`great source for Paypal and PHP`}</a>{`.`}</p>\n    <p><a parentName=\"p\" {...{\n        \"href\": \"https://www.x.com/developers/paypal/documentation-tools/ipn/integration-guide/IPNIntro\"\n      }}>{`https://www.x.com/developers/paypal/documentation-tools/ipn/integration-guide/IPNIntro`}</a>{` `}<a parentName=\"p\" {...{\n        \"href\": \"http://demos.ipn-easy.com/Howto/TestEnvironment.aspx\"\n      }}>{`http://demos.ipn-easy.com/Howto/TestEnvironment.aspx`}</a></p>\n\n    </MDXLayout>;\n}\n\n;\nMDXContent.isMDXComponent = true;"}}