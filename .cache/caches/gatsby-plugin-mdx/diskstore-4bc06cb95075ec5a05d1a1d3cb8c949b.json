{"expireTime":9007200886478394000,"key":"gatsby-plugin-mdx-entire-payload-5b500313608919562c5a154a7492f76a--undefined","val":{"mdast":{"type":"root","children":[{"type":"paragraph","children":[{"type":"text","value":"MVC4 doesn't use the same tables and infrastructure of MemberShip that Asp.Net or Asp.NET MVC3 used. You can see that just by creating a new MVC4 projet. You will notice that inside the ","position":{"start":{"line":2,"column":1,"offset":1},"end":{"line":2,"column":187,"offset":187},"indent":[]}},{"type":"strong","children":[{"type":"text","value":"Model","position":{"start":{"line":2,"column":189,"offset":189},"end":{"line":2,"column":194,"offset":194},"indent":[]}}],"position":{"start":{"line":2,"column":187,"offset":187},"end":{"line":2,"column":196,"offset":196},"indent":[]}},{"type":"text","value":" folder that you have a class \"AccountModel.cs\". Also, inside the AccountController.cs you will see the use of WebSecurity that come from ","position":{"start":{"line":2,"column":196,"offset":196},"end":{"line":2,"column":334,"offset":334},"indent":[]}},{"type":"strong","children":[{"type":"text","value":"WebMatrix","position":{"start":{"line":2,"column":336,"offset":336},"end":{"line":2,"column":345,"offset":345},"indent":[]}}],"position":{"start":{"line":2,"column":334,"offset":334},"end":{"line":2,"column":347,"offset":347},"indent":[]}},{"type":"text","value":" namespace.","position":{"start":{"line":2,"column":347,"offset":347},"end":{"line":2,"column":358,"offset":358},"indent":[]}}],"position":{"start":{"line":2,"column":1,"offset":1},"end":{"line":2,"column":358,"offset":358},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"The default configuration ain't a problem until you want to remove the DbContext from the Model folder (which shouldn't be there but inside the DAL layer). Also, it's ain't a problem until you you like to auto generate the table inside the database with some data into it. Creating a user is pretty easy with WebSecurity but it's not when you try to seed the database with it. In fact, you will get error message saying that WebSecurity need to be initialized before use and if you initialize it, the database might not be created by Entity Framework and then it crashes.","position":{"start":{"line":4,"column":1,"offset":360},"end":{"line":4,"column":572,"offset":931},"indent":[]}}],"position":{"start":{"line":4,"column":1,"offset":360},"end":{"line":4,"column":572,"offset":931},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"The solution is to use the Package Manager Console and to generate the database with some commands line. This processes is called \"Migration\".","position":{"start":{"line":6,"column":1,"offset":933},"end":{"line":6,"column":143,"offset":1075},"indent":[]}}],"position":{"start":{"line":6,"column":1,"offset":933},"end":{"line":6,"column":143,"offset":1075},"indent":[]}},{"type":"heading","depth":2,"children":[{"type":"text","value":"Removing default code","position":{"start":{"line":8,"column":4,"offset":1080},"end":{"line":8,"column":25,"offset":1101},"indent":[]}}],"position":{"start":{"line":8,"column":1,"offset":1077},"end":{"line":8,"column":25,"offset":1101},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"The first step is to clean up some code that doesn't have its place. The first code to delete is inside ","position":{"start":{"line":10,"column":1,"offset":1103},"end":{"line":10,"column":105,"offset":1207},"indent":[]}},{"type":"inlineCode","value":"AccountModels.cs","position":{"start":{"line":10,"column":105,"offset":1207},"end":{"line":10,"column":123,"offset":1225},"indent":[]}},{"type":"text","value":" inside the ","position":{"start":{"line":10,"column":123,"offset":1225},"end":{"line":10,"column":135,"offset":1237},"indent":[]}},{"type":"inlineCode","value":"Models","position":{"start":{"line":10,"column":135,"offset":1237},"end":{"line":10,"column":143,"offset":1245},"indent":[]}},{"type":"text","value":" folder. You will see at the top of the file a class called ","position":{"start":{"line":10,"column":143,"offset":1245},"end":{"line":10,"column":203,"offset":1305},"indent":[]}},{"type":"emphasis","children":[{"type":"text","value":"UsersContext","position":{"start":{"line":10,"column":204,"offset":1306},"end":{"line":10,"column":216,"offset":1318},"indent":[]}}],"position":{"start":{"line":10,"column":203,"offset":1305},"end":{"line":10,"column":217,"offset":1319},"indent":[]}},{"type":"text","value":". This need to be removed.","position":{"start":{"line":10,"column":217,"offset":1319},"end":{"line":10,"column":243,"offset":1345},"indent":[]}}],"position":{"start":{"line":10,"column":1,"offset":1103},"end":{"line":10,"column":243,"offset":1345},"indent":[]}},{"type":"paragraph","children":[{"type":"image","title":null,"url":"images/UsersContext-400x213.png","alt":null,"position":{"start":{"line":12,"column":1,"offset":1347},"end":{"line":12,"column":37,"offset":1383},"indent":[]}}],"position":{"start":{"line":12,"column":1,"offset":1347},"end":{"line":12,"column":37,"offset":1383},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"The second code that need to be deleted is the filter ","position":{"start":{"line":14,"column":1,"offset":1385},"end":{"line":14,"column":55,"offset":1439},"indent":[]}},{"type":"inlineCode","value":"InitializeSimpleMembershipAttribute","position":{"start":{"line":14,"column":55,"offset":1439},"end":{"line":14,"column":92,"offset":1476},"indent":[]}},{"type":"text","value":". This filter create the tables for MemberShip if not created. Since we do not want to create on the fly but when the application start (or with commands line) we can delete this filter. It's a good idea because it uses the UsersContext that we just deleted. This file is located inside the ","position":{"start":{"line":14,"column":92,"offset":1476},"end":{"line":14,"column":383,"offset":1767},"indent":[]}},{"type":"emphasis","children":[{"type":"text","value":"Filters","position":{"start":{"line":14,"column":384,"offset":1768},"end":{"line":14,"column":391,"offset":1775},"indent":[]}}],"position":{"start":{"line":14,"column":383,"offset":1767},"end":{"line":14,"column":392,"offset":1776},"indent":[]}},{"type":"text","value":" folder.","position":{"start":{"line":14,"column":392,"offset":1776},"end":{"line":14,"column":400,"offset":1784},"indent":[]}}],"position":{"start":{"line":14,"column":1,"offset":1385},"end":{"line":14,"column":400,"offset":1784},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"The third code to remove is the filter use that is above the ","position":{"start":{"line":16,"column":1,"offset":1786},"end":{"line":16,"column":62,"offset":1847},"indent":[]}},{"type":"inlineCode","value":"AccountController","position":{"start":{"line":16,"column":62,"offset":1847},"end":{"line":16,"column":81,"offset":1866},"indent":[]}},{"type":"text","value":" class inside AccountController.cs file.","position":{"start":{"line":16,"column":81,"offset":1866},"end":{"line":16,"column":121,"offset":1906},"indent":[]}}],"position":{"start":{"line":16,"column":1,"offset":1786},"end":{"line":16,"column":121,"offset":1906},"indent":[]}},{"type":"paragraph","children":[{"type":"image","title":null,"url":"images/filtertoremove-400x94.png","alt":null,"position":{"start":{"line":18,"column":1,"offset":1908},"end":{"line":18,"column":38,"offset":1945},"indent":[]}}],"position":{"start":{"line":18,"column":1,"offset":1908},"end":{"line":18,"column":38,"offset":1945},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"Of course, now you have to setup your DbContext to be able to do what UsersContext was doing. If you compile now, it won't compile because we have deleted the UsersContext. But, 2 lines of code is required inside AccountController.cs to be able to compile. The first one is to create in your DbContext a methbod to get the user by name and one to create a new user. Here is an example that use a \"Service layer\" to access the repository that will use a DbContext later.","position":{"start":{"line":20,"column":1,"offset":1947},"end":{"line":20,"column":470,"offset":2416},"indent":[]}}],"position":{"start":{"line":20,"column":1,"offset":1947},"end":{"line":20,"column":470,"offset":2416},"indent":[]}},{"type":"paragraph","children":[{"type":"image","title":null,"url":"images/useYourDbContext-400x131.png","alt":null,"position":{"start":{"line":22,"column":1,"offset":2418},"end":{"line":22,"column":41,"offset":2458},"indent":[]}}],"position":{"start":{"line":22,"column":1,"offset":2418},"end":{"line":22,"column":41,"offset":2458},"indent":[]}},{"type":"heading","depth":2,"children":[{"type":"text","value":"Configure Entity Framework Migration","position":{"start":{"line":24,"column":4,"offset":2463},"end":{"line":24,"column":40,"offset":2499},"indent":[]}}],"position":{"start":{"line":24,"column":1,"offset":2460},"end":{"line":24,"column":40,"offset":2499},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"The next step is to make sure the the web.config contain the right provider for the role and membership. Inside web.config, in the system.web section be sure that you have the code below. If not, add it.","position":{"start":{"line":26,"column":1,"offset":2501},"end":{"line":26,"column":204,"offset":2704},"indent":[]}}],"position":{"start":{"line":26,"column":1,"offset":2501},"end":{"line":26,"column":204,"offset":2704},"indent":[]}},{"type":"code","lang":"xml","meta":null,"value":" <roleManager enabled=\"true\" defaultProvider=\"SimpleRoleProvider\">\n  <providers>\n    <clear/>\n      <add name=\"SimpleRoleProvider\" type=\"WebMatrix.WebData.SimpleRoleProvider, WebMatrix.WebData\"/>\n      </providers> </roleManager> <membership defaultProvider=\"SimpleMembershipProvider\">\n    <providers>\n    <clear/>\n    <add name=\"SimpleMembershipProvider\" type=\"WebMatrix.WebData.SimpleMembershipProvider, WebMatrix.WebData\"/>\n  </providers>\n </membership>","position":{"start":{"line":28,"column":1,"offset":2706},"end":{"line":39,"column":4,"offset":3173},"indent":[1,1,1,1,1,1,1,1,1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"This will specify that we are using the ","position":{"start":{"line":41,"column":1,"offset":3175},"end":{"line":41,"column":41,"offset":3215},"indent":[]}},{"type":"strong","children":[{"type":"text","value":"SimpleRoleProvider","position":{"start":{"line":41,"column":43,"offset":3217},"end":{"line":41,"column":61,"offset":3235},"indent":[]}}],"position":{"start":{"line":41,"column":41,"offset":3215},"end":{"line":41,"column":63,"offset":3237},"indent":[]}},{"type":"text","value":" and the ","position":{"start":{"line":41,"column":63,"offset":3237},"end":{"line":41,"column":72,"offset":3246},"indent":[]}},{"type":"strong","children":[{"type":"text","value":"SimpleMembershipProvider","position":{"start":{"line":41,"column":74,"offset":3248},"end":{"line":41,"column":98,"offset":3272},"indent":[]}}],"position":{"start":{"line":41,"column":72,"offset":3246},"end":{"line":41,"column":100,"offset":3274},"indent":[]}},{"type":"text","value":". To be honest, I think with MVC4 it's the default configuration so you do not required to do this but ","position":{"start":{"line":41,"column":100,"offset":3274},"end":{"line":41,"column":203,"offset":3377},"indent":[]}},{"type":"link","title":null,"url":"http://blog.longle.net/2012/09/25/seeding-users-and-roles-with-mvc4-simplemembershipprovider-simpleroleprovider-ef5-codefirst-and-custom-user-properties/","children":[{"type":"text","value":"this website","position":{"start":{"line":41,"column":204,"offset":3378},"end":{"line":41,"column":216,"offset":3390},"indent":[]}}],"position":{"start":{"line":41,"column":203,"offset":3377},"end":{"line":41,"column":372,"offset":3546},"indent":[]}},{"type":"text","value":" suggest to have it.","position":{"start":{"line":41,"column":372,"offset":3546},"end":{"line":41,"column":392,"offset":3566},"indent":[]}}],"position":{"start":{"line":41,"column":1,"offset":3175},"end":{"line":41,"column":392,"offset":3566},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"Once done, you need to build the Migration Configuration. This is automatically done if you are using the ","position":{"start":{"line":43,"column":1,"offset":3568},"end":{"line":43,"column":107,"offset":3674},"indent":[]}},{"type":"strong","children":[{"type":"text","value":"Package Manager Console","position":{"start":{"line":43,"column":109,"offset":3676},"end":{"line":43,"column":132,"offset":3699},"indent":[]}}],"position":{"start":{"line":43,"column":107,"offset":3674},"end":{"line":43,"column":134,"offset":3701},"indent":[]}},{"type":"text","value":". This tool can be open by going inside VIEW>Other Windows>Package Manager Console.","position":{"start":{"line":43,"column":134,"offset":3701},"end":{"line":43,"column":217,"offset":3784},"indent":[]}}],"position":{"start":{"line":43,"column":1,"offset":3568},"end":{"line":43,"column":217,"offset":3784},"indent":[]}},{"type":"paragraph","children":[{"type":"image","title":null,"url":"images/packageConsoleManager-329x400.png","alt":null,"position":{"start":{"line":45,"column":1,"offset":3786},"end":{"line":45,"column":46,"offset":3831},"indent":[]}}],"position":{"start":{"line":45,"column":1,"offset":3786},"end":{"line":45,"column":46,"offset":3831},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"The next step is to use this command below that will force the creation of the configuration file. This will be required only once. Do not forget to use ","position":{"start":{"line":47,"column":1,"offset":3833},"end":{"line":47,"column":154,"offset":3986},"indent":[]}},{"type":"inlineCode","value":"EnableAutomaticMigration","position":{"start":{"line":47,"column":154,"offset":3986},"end":{"line":47,"column":180,"offset":4012},"indent":[]}},{"type":"text","value":". This will let you update the database later accordingly to changes you made to your model and entity configuration. ```\nEnable-Migrations –EnableAutomaticMigrations -Force","position":{"start":{"line":47,"column":180,"offset":4012},"end":{"line":48,"column":52,"offset":4185},"indent":[1]}}],"position":{"start":{"line":47,"column":1,"offset":3833},"end":{"line":48,"column":52,"offset":4185},"indent":[1]}},{"type":"code","lang":null,"meta":null,"value":"\nSince we have removed the _UsersContext_ we won't have any conflict doing the command above. Otherwise, we would have need to specify which DbContext we want the migration to occur. Also, if you already had a database initializer (IDatabaseInitializer) like a `DropCreateDatabaseIfModelChanges`, this won't work with the `DbMigrationsConfiguration`. \nIn fact, you need to remove any initializer because we are switching to the Migration configuration. Nevertheless, this will give us additionnal control, more manual control but at least the possibility to generate the database automatically and also seed the database with Membership and custom tables.\n\nThe command creates a folder called _Migrations_ with a _Configuration.cs_. Inside the Seed method, you will be able to create all data you want inside the database. Here is a small snippet of code that create a role, a user and some entities.\n\n\n```csharp\n internal sealed class Configuration : DbMigrationsConfiguration<WorkoutPlanner.Database.DatabaseContext> { \n   public Configuration() { AutomaticMigrationsEnabled = true; }\n\nprotected override void Seed(WorkoutPlanner.Database.DatabaseContext context) { \n  base.Seed(context);\n\n  WebSecurity.InitializeDatabaseConnection( \"DefaultConnection\", \"UserProfile\", \"UserId\", \"UserName\", autoCreateTables: true);\n\n  if (!Roles.RoleExists(\"Administrator\")) \n  Roles.CreateRole(\"Administrator\");\n\n  if (!WebSecurity.UserExists(\"123123\")) \n  WebSecurity.CreateUserAndAccount(\"123123\", \"123123\");\n\n  if (!((IList<string>)Roles.GetRolesForUser(\"123123\")).Contains(\"Administrator\")) \n    Roles.AddUsersToRoles(new[] { \"123123\" }, new[] { \"Administrator\" });\n\n  context.Database.Initialize(true); \n  context.Set<UserProfile>().Add(new UserProfile { UserId = 1, UserName = \"123123\" }); \n  context.Set<Workout>().Add(new Workout { Id = 1, Name = \"My First workout user1\", StartTime = DateTime.Now.Add(TimeSpan.FromDays(-10)), Goal = \"Increase body mass\" }); \n  context.Set<Workout>().Add(new Workout { Id = 2, Name = \"My Second workout user1\", StartTime = DateTime.Now, Goal = \"Increase chest muscle, lower fat around abs\" }); \n  } \n}\n```\n\nThe last step is to create table schema and insert those values from the seed configuration. This is done by this command : \n\n```\nupdate-database -verbose -force\n```\n\nThe verbose will show you the SQL statement executed and the force will regenerate the table even if data already exist in those tables.\n\n## Conclusion\n\nAny time you change your model or the configuration of your entities, you need to run _update-database_ command. This will drop tables, create them again, create FK and insert seed data.\n\n\n\nexport const _frontmatter = {\"title\":\"Asp.Net MemberShip with MVC4\",\"date\":\"2012-10-10\",\"categories\":[\"asp-mvc\",\"entity-framework\"]}","position":{"start":{"line":50,"column":1,"offset":4187},"end":{"line":98,"column":133,"offset":6971},"indent":[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]}}],"position":{"start":{"line":1,"column":1,"offset":0},"end":{"line":98,"column":133,"offset":6971}}},"scopeImports":["import * as React from 'react'"],"scopeIdentifiers":["React"],"body":"var _excluded = [\"components\"];\n\nfunction _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\n/* @jsxRuntime classic */\n\n/* @jsx mdx */\nvar layoutProps = {};\nvar MDXLayout = \"wrapper\";\nreturn function MDXContent(_ref) {\n  var components = _ref.components,\n      props = _objectWithoutProperties(_ref, _excluded);\n\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(\"p\", null, \"MVC4 doesn't use the same tables and infrastructure of MemberShip that Asp.Net or Asp.NET MVC3 used. You can see that just by creating a new MVC4 projet. You will notice that inside the \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"Model\"), \" folder that you have a class \\\"AccountModel.cs\\\". Also, inside the AccountController.cs you will see the use of WebSecurity that come from \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"WebMatrix\"), \" namespace.\"), mdx(\"p\", null, \"The default configuration ain't a problem until you want to remove the DbContext from the Model folder (which shouldn't be there but inside the DAL layer). Also, it's ain't a problem until you you like to auto generate the table inside the database with some data into it. Creating a user is pretty easy with WebSecurity but it's not when you try to seed the database with it. In fact, you will get error message saying that WebSecurity need to be initialized before use and if you initialize it, the database might not be created by Entity Framework and then it crashes.\"), mdx(\"p\", null, \"The solution is to use the Package Manager Console and to generate the database with some commands line. This processes is called \\\"Migration\\\".\"), mdx(\"h2\", null, \"Removing default code\"), mdx(\"p\", null, \"The first step is to clean up some code that doesn't have its place. The first code to delete is inside \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"AccountModels.cs\"), \" inside the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"Models\"), \" folder. You will see at the top of the file a class called \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"UsersContext\"), \". This need to be removed.\"), mdx(\"p\", null, mdx(\"span\", {\n    parentName: \"p\",\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"400px\"\n    }\n  }, \"\\n      \", mdx(\"a\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-link\",\n    \"href\": \"/static/68c58d681496261cbe3d5c47b987b321/e17e5/UsersContext-400x213.png\",\n    \"style\": {\n      \"display\": \"block\"\n    },\n    \"target\": \"_blank\",\n    \"rel\": \"noopener\"\n  }, \"\\n    \", mdx(\"span\", {\n    parentName: \"a\",\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"53.333333333333336%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAABb0lEQVQoz52SiY7bMAxE8/8f2WQT3zdl67TlV8gxsmhrFGgJDIYUhBHJ0U3E8LhHsif0HZRlSVmUFFlO/soZ+pHX80XbtPwe+77/gds4Tli7sljHqAXtNMooZjsjRhCrGJYBZWfC5hErKKcwwVyK3ozR6ZhOt9RzzexnJjsiThA3MZqR3vRH7VZLPTe0S3MIXwp6H4hnsfiZXHJ6PVCpgmquyKbsYLs6trgR9/j3kb33nws2WOxqKaTgOT25Dw/uww8e4xeZZBSqpFAFJthLsY9gSlJorznT/463IG8VvzpsMPjVo4M+uk3LT0jdJ1OOKU6ELZzwJ6/fHSah0QzvHZ7cLM1hQre0lKpE7EQ11/S6o5Ccycpxp13aw7yEj2Ay5Hvh+y/0TyNb65JdNIPm3mr6qkOeOVKWSJbRVRWizfGoXzfWGA/eYrw2RWtNjJGvh6dtYeh36hoG7em0o10M3WJwPtBrR79YKqURFy7/4U/dQFfjaJQP5QAAAABJRU5ErkJggg==')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  }), \"\\n  \", mdx(\"img\", {\n    parentName: \"a\",\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"UsersContext 400x213\",\n    \"title\": \"UsersContext 400x213\",\n    \"src\": \"/static/68c58d681496261cbe3d5c47b987b321/e17e5/UsersContext-400x213.png\",\n    \"srcSet\": [\"/static/68c58d681496261cbe3d5c47b987b321/5a46d/UsersContext-400x213.png 300w\", \"/static/68c58d681496261cbe3d5c47b987b321/e17e5/UsersContext-400x213.png 400w\"],\n    \"sizes\": \"(max-width: 400px) 100vw, 400px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\",\n    \"decoding\": \"async\"\n  }), \"\\n  \"), \"\\n    \")), mdx(\"p\", null, \"The second code that need to be deleted is the filter \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"InitializeSimpleMembershipAttribute\"), \". This filter create the tables for MemberShip if not created. Since we do not want to create on the fly but when the application start (or with commands line) we can delete this filter. It's a good idea because it uses the UsersContext that we just deleted. This file is located inside the \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"Filters\"), \" folder.\"), mdx(\"p\", null, \"The third code to remove is the filter use that is above the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"AccountController\"), \" class inside AccountController.cs file.\"), mdx(\"p\", null, mdx(\"span\", {\n    parentName: \"p\",\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"400px\"\n    }\n  }, \"\\n      \", mdx(\"a\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-link\",\n    \"href\": \"/static/13f037bd2449b240b47995de1f42fb4a/e17e5/filtertoremove-400x94.png\",\n    \"style\": {\n      \"display\": \"block\"\n    },\n    \"target\": \"_blank\",\n    \"rel\": \"noopener\"\n  }, \"\\n    \", mdx(\"span\", {\n    parentName: \"a\",\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"23.666666666666668%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAyElEQVQY05WQ3WqEMBhEff8XbNnCrlRjzPrTaqLJF2POoheF3YuFDhwG5mIYphAB7zMiGYlCCOGPGCMiB4L3npQSOee3FLdroK6gv8PYd7SNplENqlYM/YAxBtO26KZhtpZDbwtzjizi6NaZ0XtsWPmXXguPTPUjH7Xiy1R81t+UQ8Wlu3HprqeXo6Ica7aUWGRjjRthS6enfX9aXZBAtwGlEtPvhtaJH+cxs6WdLPfZnfR2wQdBT47OLgxuxcyOVSL7vp//HjwAgt6Dr68IwVgAAAAASUVORK5CYII=')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  }), \"\\n  \", mdx(\"img\", {\n    parentName: \"a\",\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"filtertoremove 400x94\",\n    \"title\": \"filtertoremove 400x94\",\n    \"src\": \"/static/13f037bd2449b240b47995de1f42fb4a/e17e5/filtertoremove-400x94.png\",\n    \"srcSet\": [\"/static/13f037bd2449b240b47995de1f42fb4a/5a46d/filtertoremove-400x94.png 300w\", \"/static/13f037bd2449b240b47995de1f42fb4a/e17e5/filtertoremove-400x94.png 400w\"],\n    \"sizes\": \"(max-width: 400px) 100vw, 400px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\",\n    \"decoding\": \"async\"\n  }), \"\\n  \"), \"\\n    \")), mdx(\"p\", null, \"Of course, now you have to setup your DbContext to be able to do what UsersContext was doing. If you compile now, it won't compile because we have deleted the UsersContext. But, 2 lines of code is required inside AccountController.cs to be able to compile. The first one is to create in your DbContext a methbod to get the user by name and one to create a new user. Here is an example that use a \\\"Service layer\\\" to access the repository that will use a DbContext later.\"), mdx(\"p\", null, mdx(\"span\", {\n    parentName: \"p\",\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"400px\"\n    }\n  }, \"\\n      \", mdx(\"a\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-link\",\n    \"href\": \"/static/4cc9abe1278567ed33a9f1b39ad216dd/e17e5/useYourDbContext-400x131.png\",\n    \"style\": {\n      \"display\": \"block\"\n    },\n    \"target\": \"_blank\",\n    \"rel\": \"noopener\"\n  }, \"\\n    \", mdx(\"span\", {\n    parentName: \"a\",\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"32.666666666666664%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsTAAALEwEAmpwYAAABQElEQVQoz5WPS27bQBBEdf8DZJUEOUKOYBgBFMCCF7E+USjrE1Eixf/0cESKnJlnkAEEZ5c0UKiqXjx0T6qyJM9SRAlDVkr43/He3zXpvKPz0FpH13U4d6NpnjFmisgUJYN/Q6klWhvqWqNFqM2Qa5qm+Rt4LirWpy1hHrM9RsTlmTCfckwfibLvaFki6gdluUFEIyJUVTXCRNQIdO+BxnSIrlGmppAedb3RWu66OU9r/T+/PoGWSn/llHzikn/hcP7IMfpMGH/gcH7glBuOVUxuDPrakOcZaZqitSZLM4qiIEmTsTvnmXhvcTYBd8G7BNf/cfwFZ2v8u+OG2Pc91tqxD9k5N3Zr+2EzAD1h1TKPhHVSE0nH7zBmtQxYLFas1z/Z73Ys5vNRURSxfd0we5oRBL8IgoDVasl+f+Ll5cIbKVAWx0UlFOQAAAAASUVORK5CYII=')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  }), \"\\n  \", mdx(\"img\", {\n    parentName: \"a\",\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"useYourDbContext 400x131\",\n    \"title\": \"useYourDbContext 400x131\",\n    \"src\": \"/static/4cc9abe1278567ed33a9f1b39ad216dd/e17e5/useYourDbContext-400x131.png\",\n    \"srcSet\": [\"/static/4cc9abe1278567ed33a9f1b39ad216dd/5a46d/useYourDbContext-400x131.png 300w\", \"/static/4cc9abe1278567ed33a9f1b39ad216dd/e17e5/useYourDbContext-400x131.png 400w\"],\n    \"sizes\": \"(max-width: 400px) 100vw, 400px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\",\n    \"decoding\": \"async\"\n  }), \"\\n  \"), \"\\n    \")), mdx(\"h2\", null, \"Configure Entity Framework Migration\"), mdx(\"p\", null, \"The next step is to make sure the the web.config contain the right provider for the role and membership. Inside web.config, in the system.web section be sure that you have the code below. If not, add it.\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-xml\"\n  }, \" <roleManager enabled=\\\"true\\\" defaultProvider=\\\"SimpleRoleProvider\\\">\\n  <providers>\\n    <clear/>\\n      <add name=\\\"SimpleRoleProvider\\\" type=\\\"WebMatrix.WebData.SimpleRoleProvider, WebMatrix.WebData\\\"/>\\n      </providers> </roleManager> <membership defaultProvider=\\\"SimpleMembershipProvider\\\">\\n    <providers>\\n    <clear/>\\n    <add name=\\\"SimpleMembershipProvider\\\" type=\\\"WebMatrix.WebData.SimpleMembershipProvider, WebMatrix.WebData\\\"/>\\n  </providers>\\n </membership>\\n\")), mdx(\"p\", null, \"This will specify that we are using the \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"SimpleRoleProvider\"), \" and the \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"SimpleMembershipProvider\"), \". To be honest, I think with MVC4 it's the default configuration so you do not required to do this but \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"http://blog.longle.net/2012/09/25/seeding-users-and-roles-with-mvc4-simplemembershipprovider-simpleroleprovider-ef5-codefirst-and-custom-user-properties/\"\n  }, \"this website\"), \" suggest to have it.\"), mdx(\"p\", null, \"Once done, you need to build the Migration Configuration. This is automatically done if you are using the \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"Package Manager Console\"), \". This tool can be open by going inside VIEW>Other Windows>Package Manager Console.\"), mdx(\"p\", null, mdx(\"span\", {\n    parentName: \"p\",\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"329px\"\n    }\n  }, \"\\n      \", mdx(\"a\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-link\",\n    \"href\": \"/static/38ff2151a24f8631d91d5d93926e276e/004a5/packageConsoleManager-329x400.png\",\n    \"style\": {\n      \"display\": \"block\"\n    },\n    \"target\": \"_blank\",\n    \"rel\": \"noopener\"\n  }, \"\\n    \", mdx(\"span\", {\n    parentName: \"a\",\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"121.66666666666669%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAYCAYAAAD6S912AAAACXBIWXMAAAsTAAALEwEAmpwYAAAEN0lEQVQ4y4VVyY7kRBD1j3NDgOaAOHKBC7/BBWmEhp6uLpf3fUkvmd7KtXTty0MR7mpmhBAphVxZcr588eJFWNMXvyEMP8G2I0RRgiQRyPMKcZwjCGLeF6VCmhUoSgmlWkjZwvdCVKWErBsUgt5PEQYxtM/PFoPNZgv4QYK2G9G0S6RZCdPy4HkRkrRAGGUTaFGjbQdI2cEPMoShQBgVWBgekiSH9unTExw3wPNsAc+LEScColDIshKG6SIIEmR5hapSb0ANluMa47iFbcXQFw4sK4DrJcxas2wPluUxm7luwXWjd0DHCXhPl+wPR9C6A7jd77heb7her29xweUyheYHMQhU121Oi9KlIMCF4cDzY6R5hWZcY304YdgdMB5OWK7W6PsOfd9jHEe0bYvVuIJmmA6z0xc260agVd0iy0vouoUwyrkou92eGd5ud9zv93e2/Hzs73dojuPDtn0YhoPFYmJZy451o4tyUTPgfn/Av9f9q98MaJoODMNl/Xw/QS17SNW/F4WARSGx3mxwPp9wOp1wut5wvl5xvt5wuV5xPB5ZS1ra80yHaThI0pItQ+kSYJoWWCwcloEAu77HahyxHEfWcrU/YnM843V/wHIYcDqdJ0BiaJouXC9ib1G6BFhWDbOjJwFut6/4v8Upk/8Mw0cYCaiGGA6QamBmthOwfkLUkFJxWnTov4J01OIkgWE8w7J11JJAC6im5dTjZKowMTy8+fBLNrfbjav+WLTXtlsHQfgBQfgTavUz1ptfsVpnWG+O2LzusH3do+1X7FXqGuoqkoeqT36tqgauGyCKMqhmgEZNbZoWgjCGVA1qqSBVx9pR2tlbUeZzg201mxnc82XVst6UgeOGiOKc99rLywKW5XNPTi9NtqEpQ/rOdZPZWJYLy/YxezGQZtXErp6KSMzoDO010ol61nw7QGwePiQr0YFKdniezTk1uiAIE+SiQlU3nM0UExEtjFKeMlEsGIwYUlBRaF/JqUC67sK0YsznPodtp6jqEWVFo07x5TRUNCEK5HkBIaYRJUSJqqz5v6IkH9IFLRznL9j2RxjGH5jNfoft/AmpXJSVhSwz3gawgvYoeRT68H0PXpQga3tEdYtUZHDtAml+wNPnH2Ba38C0voXrfQ/P+w5R/AGq+RFS/cJWI/9q5KfL9QaRr6HUDm2/xrjdQnakiUJZlCjKDoZpwrIcuC41AVWZ5Gm+iKlA2mP0XC4nlGWBLMuQ5wJqs0O/2UHVFfJ8DduOeViQbZ6eXpALCdkM75q/A1K7kMPH5QnDsEPXLTGOS/TjCv1yRNfSR2kA9TyNuQUPkoKtQto+gP4B5Ba6YzWe0HUbtE2PYejRjWsM42oCrAeYTsQGfnkxEfDM7N99+BXgI+Xz+YCyFMizDKIooLZ7TlnWFYTYwLBCOC4Zm4aJzd1S1y23HvnxEX8DEH7nXo0GsQIAAAAASUVORK5CYII=')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  }), \"\\n  \", mdx(\"img\", {\n    parentName: \"a\",\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"packageConsoleManager 329x400\",\n    \"title\": \"packageConsoleManager 329x400\",\n    \"src\": \"/static/38ff2151a24f8631d91d5d93926e276e/004a5/packageConsoleManager-329x400.png\",\n    \"srcSet\": [\"/static/38ff2151a24f8631d91d5d93926e276e/5a46d/packageConsoleManager-329x400.png 300w\", \"/static/38ff2151a24f8631d91d5d93926e276e/004a5/packageConsoleManager-329x400.png 329w\"],\n    \"sizes\": \"(max-width: 329px) 100vw, 329px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\",\n    \"decoding\": \"async\"\n  }), \"\\n  \"), \"\\n    \")), mdx(\"p\", null, \"The next step is to use this command below that will force the creation of the configuration file. This will be required only once. Do not forget to use \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"EnableAutomaticMigration\"), \". This will let you update the database later accordingly to changes you made to your model and entity configuration. ```\\nEnable-Migrations \\u2013EnableAutomaticMigrations -Force\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\"\n  }, \"\\nSince we have removed the _UsersContext_ we won't have any conflict doing the command above. Otherwise, we would have need to specify which DbContext we want the migration to occur. Also, if you already had a database initializer (IDatabaseInitializer) like a `DropCreateDatabaseIfModelChanges`, this won't work with the `DbMigrationsConfiguration`. \\nIn fact, you need to remove any initializer because we are switching to the Migration configuration. Nevertheless, this will give us additionnal control, more manual control but at least the possibility to generate the database automatically and also seed the database with Membership and custom tables.\\n\\nThe command creates a folder called _Migrations_ with a _Configuration.cs_. Inside the Seed method, you will be able to create all data you want inside the database. Here is a small snippet of code that create a role, a user and some entities.\\n\\n\\n```csharp\\n internal sealed class Configuration : DbMigrationsConfiguration<WorkoutPlanner.Database.DatabaseContext> { \\n   public Configuration() { AutomaticMigrationsEnabled = true; }\\n\\nprotected override void Seed(WorkoutPlanner.Database.DatabaseContext context) { \\n  base.Seed(context);\\n\\n  WebSecurity.InitializeDatabaseConnection( \\\"DefaultConnection\\\", \\\"UserProfile\\\", \\\"UserId\\\", \\\"UserName\\\", autoCreateTables: true);\\n\\n  if (!Roles.RoleExists(\\\"Administrator\\\")) \\n  Roles.CreateRole(\\\"Administrator\\\");\\n\\n  if (!WebSecurity.UserExists(\\\"123123\\\")) \\n  WebSecurity.CreateUserAndAccount(\\\"123123\\\", \\\"123123\\\");\\n\\n  if (!((IList<string>)Roles.GetRolesForUser(\\\"123123\\\")).Contains(\\\"Administrator\\\")) \\n    Roles.AddUsersToRoles(new[] { \\\"123123\\\" }, new[] { \\\"Administrator\\\" });\\n\\n  context.Database.Initialize(true); \\n  context.Set<UserProfile>().Add(new UserProfile { UserId = 1, UserName = \\\"123123\\\" }); \\n  context.Set<Workout>().Add(new Workout { Id = 1, Name = \\\"My First workout user1\\\", StartTime = DateTime.Now.Add(TimeSpan.FromDays(-10)), Goal = \\\"Increase body mass\\\" }); \\n  context.Set<Workout>().Add(new Workout { Id = 2, Name = \\\"My Second workout user1\\\", StartTime = DateTime.Now, Goal = \\\"Increase chest muscle, lower fat around abs\\\" }); \\n  } \\n}\\n```\\n\\nThe last step is to create table schema and insert those values from the seed configuration. This is done by this command : \\n\\n```\\nupdate-database -verbose -force\\n```\\n\\nThe verbose will show you the SQL statement executed and the force will regenerate the table even if data already exist in those tables.\\n\\n## Conclusion\\n\\nAny time you change your model or the configuration of your entities, you need to run _update-database_ command. This will drop tables, create them again, create FK and insert seed data.\\n\\n\\n\\nexport const _frontmatter = {\\\"title\\\":\\\"Asp.Net MemberShip with MVC4\\\",\\\"date\\\":\\\"2012-10-10\\\",\\\"categories\\\":[\\\"asp-mvc\\\",\\\"entity-framework\\\"]}\\n\")));\n}\n;\nMDXContent.isMDXComponent = true;","rawMDXOutput":"/* @jsx mdx */\nimport { mdx } from '@mdx-js/react';\n/* @jsxRuntime classic */\n/* @jsx mdx */\n\n\n\nconst layoutProps = {\n  \n};\nconst MDXLayout = \"wrapper\"\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n    <p>{`MVC4 doesn't use the same tables and infrastructure of MemberShip that Asp.Net or Asp.NET MVC3 used. You can see that just by creating a new MVC4 projet. You will notice that inside the `}<strong parentName=\"p\">{`Model`}</strong>{` folder that you have a class \"AccountModel.cs\". Also, inside the AccountController.cs you will see the use of WebSecurity that come from `}<strong parentName=\"p\">{`WebMatrix`}</strong>{` namespace.`}</p>\n    <p>{`The default configuration ain't a problem until you want to remove the DbContext from the Model folder (which shouldn't be there but inside the DAL layer). Also, it's ain't a problem until you you like to auto generate the table inside the database with some data into it. Creating a user is pretty easy with WebSecurity but it's not when you try to seed the database with it. In fact, you will get error message saying that WebSecurity need to be initialized before use and if you initialize it, the database might not be created by Entity Framework and then it crashes.`}</p>\n    <p>{`The solution is to use the Package Manager Console and to generate the database with some commands line. This processes is called \"Migration\".`}</p>\n    <h2>{`Removing default code`}</h2>\n    <p>{`The first step is to clean up some code that doesn't have its place. The first code to delete is inside `}<inlineCode parentName=\"p\">{`AccountModels.cs`}</inlineCode>{` inside the `}<inlineCode parentName=\"p\">{`Models`}</inlineCode>{` folder. You will see at the top of the file a class called `}<em parentName=\"p\">{`UsersContext`}</em>{`. This need to be removed.`}</p>\n    <p><span parentName=\"p\" {...{\n        \"className\": \"gatsby-resp-image-wrapper\",\n        \"style\": {\n          \"position\": \"relative\",\n          \"display\": \"block\",\n          \"marginLeft\": \"auto\",\n          \"marginRight\": \"auto\",\n          \"maxWidth\": \"400px\"\n        }\n      }}>{`\n      `}<a parentName=\"span\" {...{\n          \"className\": \"gatsby-resp-image-link\",\n          \"href\": \"/static/68c58d681496261cbe3d5c47b987b321/e17e5/UsersContext-400x213.png\",\n          \"style\": {\n            \"display\": \"block\"\n          },\n          \"target\": \"_blank\",\n          \"rel\": \"noopener\"\n        }}>{`\n    `}<span parentName=\"a\" {...{\n            \"className\": \"gatsby-resp-image-background-image\",\n            \"style\": {\n              \"paddingBottom\": \"53.333333333333336%\",\n              \"position\": \"relative\",\n              \"bottom\": \"0\",\n              \"left\": \"0\",\n              \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAABb0lEQVQoz52SiY7bMAxE8/8f2WQT3zdl67TlV8gxsmhrFGgJDIYUhBHJ0U3E8LhHsif0HZRlSVmUFFlO/soZ+pHX80XbtPwe+77/gds4Tli7sljHqAXtNMooZjsjRhCrGJYBZWfC5hErKKcwwVyK3ozR6ZhOt9RzzexnJjsiThA3MZqR3vRH7VZLPTe0S3MIXwp6H4hnsfiZXHJ6PVCpgmquyKbsYLs6trgR9/j3kb33nws2WOxqKaTgOT25Dw/uww8e4xeZZBSqpFAFJthLsY9gSlJorznT/463IG8VvzpsMPjVo4M+uk3LT0jdJ1OOKU6ELZzwJ6/fHSah0QzvHZ7cLM1hQre0lKpE7EQ11/S6o5Ccycpxp13aw7yEj2Ay5Hvh+y/0TyNb65JdNIPm3mr6qkOeOVKWSJbRVRWizfGoXzfWGA/eYrw2RWtNjJGvh6dtYeh36hoG7em0o10M3WJwPtBrR79YKqURFy7/4U/dQFfjaJQP5QAAAABJRU5ErkJggg==')\",\n              \"backgroundSize\": \"cover\",\n              \"display\": \"block\"\n            }\n          }}></span>{`\n  `}<img parentName=\"a\" {...{\n            \"className\": \"gatsby-resp-image-image\",\n            \"alt\": \"UsersContext 400x213\",\n            \"title\": \"UsersContext 400x213\",\n            \"src\": \"/static/68c58d681496261cbe3d5c47b987b321/e17e5/UsersContext-400x213.png\",\n            \"srcSet\": [\"/static/68c58d681496261cbe3d5c47b987b321/5a46d/UsersContext-400x213.png 300w\", \"/static/68c58d681496261cbe3d5c47b987b321/e17e5/UsersContext-400x213.png 400w\"],\n            \"sizes\": \"(max-width: 400px) 100vw, 400px\",\n            \"style\": {\n              \"width\": \"100%\",\n              \"height\": \"100%\",\n              \"margin\": \"0\",\n              \"verticalAlign\": \"middle\",\n              \"position\": \"absolute\",\n              \"top\": \"0\",\n              \"left\": \"0\"\n            },\n            \"loading\": \"lazy\",\n            \"decoding\": \"async\"\n          }}></img>{`\n  `}</a>{`\n    `}</span></p>\n    <p>{`The second code that need to be deleted is the filter `}<inlineCode parentName=\"p\">{`InitializeSimpleMembershipAttribute`}</inlineCode>{`. This filter create the tables for MemberShip if not created. Since we do not want to create on the fly but when the application start (or with commands line) we can delete this filter. It's a good idea because it uses the UsersContext that we just deleted. This file is located inside the `}<em parentName=\"p\">{`Filters`}</em>{` folder.`}</p>\n    <p>{`The third code to remove is the filter use that is above the `}<inlineCode parentName=\"p\">{`AccountController`}</inlineCode>{` class inside AccountController.cs file.`}</p>\n    <p><span parentName=\"p\" {...{\n        \"className\": \"gatsby-resp-image-wrapper\",\n        \"style\": {\n          \"position\": \"relative\",\n          \"display\": \"block\",\n          \"marginLeft\": \"auto\",\n          \"marginRight\": \"auto\",\n          \"maxWidth\": \"400px\"\n        }\n      }}>{`\n      `}<a parentName=\"span\" {...{\n          \"className\": \"gatsby-resp-image-link\",\n          \"href\": \"/static/13f037bd2449b240b47995de1f42fb4a/e17e5/filtertoremove-400x94.png\",\n          \"style\": {\n            \"display\": \"block\"\n          },\n          \"target\": \"_blank\",\n          \"rel\": \"noopener\"\n        }}>{`\n    `}<span parentName=\"a\" {...{\n            \"className\": \"gatsby-resp-image-background-image\",\n            \"style\": {\n              \"paddingBottom\": \"23.666666666666668%\",\n              \"position\": \"relative\",\n              \"bottom\": \"0\",\n              \"left\": \"0\",\n              \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAyElEQVQY05WQ3WqEMBhEff8XbNnCrlRjzPrTaqLJF2POoheF3YuFDhwG5mIYphAB7zMiGYlCCOGPGCMiB4L3npQSOee3FLdroK6gv8PYd7SNplENqlYM/YAxBtO26KZhtpZDbwtzjizi6NaZ0XtsWPmXXguPTPUjH7Xiy1R81t+UQ8Wlu3HprqeXo6Ica7aUWGRjjRthS6enfX9aXZBAtwGlEtPvhtaJH+cxs6WdLPfZnfR2wQdBT47OLgxuxcyOVSL7vp//HjwAgt6Dr68IwVgAAAAASUVORK5CYII=')\",\n              \"backgroundSize\": \"cover\",\n              \"display\": \"block\"\n            }\n          }}></span>{`\n  `}<img parentName=\"a\" {...{\n            \"className\": \"gatsby-resp-image-image\",\n            \"alt\": \"filtertoremove 400x94\",\n            \"title\": \"filtertoremove 400x94\",\n            \"src\": \"/static/13f037bd2449b240b47995de1f42fb4a/e17e5/filtertoremove-400x94.png\",\n            \"srcSet\": [\"/static/13f037bd2449b240b47995de1f42fb4a/5a46d/filtertoremove-400x94.png 300w\", \"/static/13f037bd2449b240b47995de1f42fb4a/e17e5/filtertoremove-400x94.png 400w\"],\n            \"sizes\": \"(max-width: 400px) 100vw, 400px\",\n            \"style\": {\n              \"width\": \"100%\",\n              \"height\": \"100%\",\n              \"margin\": \"0\",\n              \"verticalAlign\": \"middle\",\n              \"position\": \"absolute\",\n              \"top\": \"0\",\n              \"left\": \"0\"\n            },\n            \"loading\": \"lazy\",\n            \"decoding\": \"async\"\n          }}></img>{`\n  `}</a>{`\n    `}</span></p>\n    <p>{`Of course, now you have to setup your DbContext to be able to do what UsersContext was doing. If you compile now, it won't compile because we have deleted the UsersContext. But, 2 lines of code is required inside AccountController.cs to be able to compile. The first one is to create in your DbContext a methbod to get the user by name and one to create a new user. Here is an example that use a \"Service layer\" to access the repository that will use a DbContext later.`}</p>\n    <p><span parentName=\"p\" {...{\n        \"className\": \"gatsby-resp-image-wrapper\",\n        \"style\": {\n          \"position\": \"relative\",\n          \"display\": \"block\",\n          \"marginLeft\": \"auto\",\n          \"marginRight\": \"auto\",\n          \"maxWidth\": \"400px\"\n        }\n      }}>{`\n      `}<a parentName=\"span\" {...{\n          \"className\": \"gatsby-resp-image-link\",\n          \"href\": \"/static/4cc9abe1278567ed33a9f1b39ad216dd/e17e5/useYourDbContext-400x131.png\",\n          \"style\": {\n            \"display\": \"block\"\n          },\n          \"target\": \"_blank\",\n          \"rel\": \"noopener\"\n        }}>{`\n    `}<span parentName=\"a\" {...{\n            \"className\": \"gatsby-resp-image-background-image\",\n            \"style\": {\n              \"paddingBottom\": \"32.666666666666664%\",\n              \"position\": \"relative\",\n              \"bottom\": \"0\",\n              \"left\": \"0\",\n              \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsTAAALEwEAmpwYAAABQElEQVQoz5WPS27bQBBEdf8DZJUEOUKOYBgBFMCCF7E+USjrE1Eixf/0cESKnJlnkAEEZ5c0UKiqXjx0T6qyJM9SRAlDVkr43/He3zXpvKPz0FpH13U4d6NpnjFmisgUJYN/Q6klWhvqWqNFqM2Qa5qm+Rt4LirWpy1hHrM9RsTlmTCfckwfibLvaFki6gdluUFEIyJUVTXCRNQIdO+BxnSIrlGmppAedb3RWu66OU9r/T+/PoGWSn/llHzikn/hcP7IMfpMGH/gcH7glBuOVUxuDPrakOcZaZqitSZLM4qiIEmTsTvnmXhvcTYBd8G7BNf/cfwFZ2v8u+OG2Pc91tqxD9k5N3Zr+2EzAD1h1TKPhHVSE0nH7zBmtQxYLFas1z/Z73Ys5vNRURSxfd0we5oRBL8IgoDVasl+f+Ll5cIbKVAWx0UlFOQAAAAASUVORK5CYII=')\",\n              \"backgroundSize\": \"cover\",\n              \"display\": \"block\"\n            }\n          }}></span>{`\n  `}<img parentName=\"a\" {...{\n            \"className\": \"gatsby-resp-image-image\",\n            \"alt\": \"useYourDbContext 400x131\",\n            \"title\": \"useYourDbContext 400x131\",\n            \"src\": \"/static/4cc9abe1278567ed33a9f1b39ad216dd/e17e5/useYourDbContext-400x131.png\",\n            \"srcSet\": [\"/static/4cc9abe1278567ed33a9f1b39ad216dd/5a46d/useYourDbContext-400x131.png 300w\", \"/static/4cc9abe1278567ed33a9f1b39ad216dd/e17e5/useYourDbContext-400x131.png 400w\"],\n            \"sizes\": \"(max-width: 400px) 100vw, 400px\",\n            \"style\": {\n              \"width\": \"100%\",\n              \"height\": \"100%\",\n              \"margin\": \"0\",\n              \"verticalAlign\": \"middle\",\n              \"position\": \"absolute\",\n              \"top\": \"0\",\n              \"left\": \"0\"\n            },\n            \"loading\": \"lazy\",\n            \"decoding\": \"async\"\n          }}></img>{`\n  `}</a>{`\n    `}</span></p>\n    <h2>{`Configure Entity Framework Migration`}</h2>\n    <p>{`The next step is to make sure the the web.config contain the right provider for the role and membership. Inside web.config, in the system.web section be sure that you have the code below. If not, add it.`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-xml\"\n      }}>{` <roleManager enabled=\"true\" defaultProvider=\"SimpleRoleProvider\">\n  <providers>\n    <clear/>\n      <add name=\"SimpleRoleProvider\" type=\"WebMatrix.WebData.SimpleRoleProvider, WebMatrix.WebData\"/>\n      </providers> </roleManager> <membership defaultProvider=\"SimpleMembershipProvider\">\n    <providers>\n    <clear/>\n    <add name=\"SimpleMembershipProvider\" type=\"WebMatrix.WebData.SimpleMembershipProvider, WebMatrix.WebData\"/>\n  </providers>\n </membership>\n`}</code></pre>\n    <p>{`This will specify that we are using the `}<strong parentName=\"p\">{`SimpleRoleProvider`}</strong>{` and the `}<strong parentName=\"p\">{`SimpleMembershipProvider`}</strong>{`. To be honest, I think with MVC4 it's the default configuration so you do not required to do this but `}<a parentName=\"p\" {...{\n        \"href\": \"http://blog.longle.net/2012/09/25/seeding-users-and-roles-with-mvc4-simplemembershipprovider-simpleroleprovider-ef5-codefirst-and-custom-user-properties/\"\n      }}>{`this website`}</a>{` suggest to have it.`}</p>\n    <p>{`Once done, you need to build the Migration Configuration. This is automatically done if you are using the `}<strong parentName=\"p\">{`Package Manager Console`}</strong>{`. This tool can be open by going inside VIEW>Other Windows>Package Manager Console.`}</p>\n    <p><span parentName=\"p\" {...{\n        \"className\": \"gatsby-resp-image-wrapper\",\n        \"style\": {\n          \"position\": \"relative\",\n          \"display\": \"block\",\n          \"marginLeft\": \"auto\",\n          \"marginRight\": \"auto\",\n          \"maxWidth\": \"329px\"\n        }\n      }}>{`\n      `}<a parentName=\"span\" {...{\n          \"className\": \"gatsby-resp-image-link\",\n          \"href\": \"/static/38ff2151a24f8631d91d5d93926e276e/004a5/packageConsoleManager-329x400.png\",\n          \"style\": {\n            \"display\": \"block\"\n          },\n          \"target\": \"_blank\",\n          \"rel\": \"noopener\"\n        }}>{`\n    `}<span parentName=\"a\" {...{\n            \"className\": \"gatsby-resp-image-background-image\",\n            \"style\": {\n              \"paddingBottom\": \"121.66666666666669%\",\n              \"position\": \"relative\",\n              \"bottom\": \"0\",\n              \"left\": \"0\",\n              \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAYCAYAAAD6S912AAAACXBIWXMAAAsTAAALEwEAmpwYAAAEN0lEQVQ4y4VVyY7kRBD1j3NDgOaAOHKBC7/BBWmEhp6uLpf3fUkvmd7KtXTty0MR7mpmhBAphVxZcr588eJFWNMXvyEMP8G2I0RRgiQRyPMKcZwjCGLeF6VCmhUoSgmlWkjZwvdCVKWErBsUgt5PEQYxtM/PFoPNZgv4QYK2G9G0S6RZCdPy4HkRkrRAGGUTaFGjbQdI2cEPMoShQBgVWBgekiSH9unTExw3wPNsAc+LEScColDIshKG6SIIEmR5hapSb0ANluMa47iFbcXQFw4sK4DrJcxas2wPluUxm7luwXWjd0DHCXhPl+wPR9C6A7jd77heb7her29xweUyheYHMQhU121Oi9KlIMCF4cDzY6R5hWZcY304YdgdMB5OWK7W6PsOfd9jHEe0bYvVuIJmmA6z0xc260agVd0iy0vouoUwyrkou92eGd5ud9zv93e2/Hzs73dojuPDtn0YhoPFYmJZy451o4tyUTPgfn/Av9f9q98MaJoODMNl/Xw/QS17SNW/F4WARSGx3mxwPp9wOp1wut5wvl5xvt5wuV5xPB5ZS1ra80yHaThI0pItQ+kSYJoWWCwcloEAu77HahyxHEfWcrU/YnM843V/wHIYcDqdJ0BiaJouXC9ib1G6BFhWDbOjJwFut6/4v8Upk/8Mw0cYCaiGGA6QamBmthOwfkLUkFJxWnTov4J01OIkgWE8w7J11JJAC6im5dTjZKowMTy8+fBLNrfbjav+WLTXtlsHQfgBQfgTavUz1ptfsVpnWG+O2LzusH3do+1X7FXqGuoqkoeqT36tqgauGyCKMqhmgEZNbZoWgjCGVA1qqSBVx9pR2tlbUeZzg201mxnc82XVst6UgeOGiOKc99rLywKW5XNPTi9NtqEpQ/rOdZPZWJYLy/YxezGQZtXErp6KSMzoDO010ol61nw7QGwePiQr0YFKdniezTk1uiAIE+SiQlU3nM0UExEtjFKeMlEsGIwYUlBRaF/JqUC67sK0YsznPodtp6jqEWVFo07x5TRUNCEK5HkBIaYRJUSJqqz5v6IkH9IFLRznL9j2RxjGH5jNfoft/AmpXJSVhSwz3gawgvYoeRT68H0PXpQga3tEdYtUZHDtAml+wNPnH2Ba38C0voXrfQ/P+w5R/AGq+RFS/cJWI/9q5KfL9QaRr6HUDm2/xrjdQnakiUJZlCjKDoZpwrIcuC41AVWZ5Gm+iKlA2mP0XC4nlGWBLMuQ5wJqs0O/2UHVFfJ8DduOeViQbZ6eXpALCdkM75q/A1K7kMPH5QnDsEPXLTGOS/TjCv1yRNfSR2kA9TyNuQUPkoKtQto+gP4B5Ba6YzWe0HUbtE2PYejRjWsM42oCrAeYTsQGfnkxEfDM7N99+BXgI+Xz+YCyFMizDKIooLZ7TlnWFYTYwLBCOC4Zm4aJzd1S1y23HvnxEX8DEH7nXo0GsQIAAAAASUVORK5CYII=')\",\n              \"backgroundSize\": \"cover\",\n              \"display\": \"block\"\n            }\n          }}></span>{`\n  `}<img parentName=\"a\" {...{\n            \"className\": \"gatsby-resp-image-image\",\n            \"alt\": \"packageConsoleManager 329x400\",\n            \"title\": \"packageConsoleManager 329x400\",\n            \"src\": \"/static/38ff2151a24f8631d91d5d93926e276e/004a5/packageConsoleManager-329x400.png\",\n            \"srcSet\": [\"/static/38ff2151a24f8631d91d5d93926e276e/5a46d/packageConsoleManager-329x400.png 300w\", \"/static/38ff2151a24f8631d91d5d93926e276e/004a5/packageConsoleManager-329x400.png 329w\"],\n            \"sizes\": \"(max-width: 329px) 100vw, 329px\",\n            \"style\": {\n              \"width\": \"100%\",\n              \"height\": \"100%\",\n              \"margin\": \"0\",\n              \"verticalAlign\": \"middle\",\n              \"position\": \"absolute\",\n              \"top\": \"0\",\n              \"left\": \"0\"\n            },\n            \"loading\": \"lazy\",\n            \"decoding\": \"async\"\n          }}></img>{`\n  `}</a>{`\n    `}</span></p>\n    <p>{`The next step is to use this command below that will force the creation of the configuration file. This will be required only once. Do not forget to use `}<inlineCode parentName=\"p\">{`EnableAutomaticMigration`}</inlineCode>{`. This will let you update the database later accordingly to changes you made to your model and entity configuration. \\`\\`\\`\nEnable-Migrations –EnableAutomaticMigrations -Force`}</p>\n    <pre><code parentName=\"pre\" {...{}}>{`\nSince we have removed the _UsersContext_ we won't have any conflict doing the command above. Otherwise, we would have need to specify which DbContext we want the migration to occur. Also, if you already had a database initializer (IDatabaseInitializer) like a \\`DropCreateDatabaseIfModelChanges\\`, this won't work with the \\`DbMigrationsConfiguration\\`. \nIn fact, you need to remove any initializer because we are switching to the Migration configuration. Nevertheless, this will give us additionnal control, more manual control but at least the possibility to generate the database automatically and also seed the database with Membership and custom tables.\n\nThe command creates a folder called _Migrations_ with a _Configuration.cs_. Inside the Seed method, you will be able to create all data you want inside the database. Here is a small snippet of code that create a role, a user and some entities.\n\n\n\\`\\`\\`csharp\n internal sealed class Configuration : DbMigrationsConfiguration<WorkoutPlanner.Database.DatabaseContext> { \n   public Configuration() { AutomaticMigrationsEnabled = true; }\n\nprotected override void Seed(WorkoutPlanner.Database.DatabaseContext context) { \n  base.Seed(context);\n\n  WebSecurity.InitializeDatabaseConnection( \"DefaultConnection\", \"UserProfile\", \"UserId\", \"UserName\", autoCreateTables: true);\n\n  if (!Roles.RoleExists(\"Administrator\")) \n  Roles.CreateRole(\"Administrator\");\n\n  if (!WebSecurity.UserExists(\"123123\")) \n  WebSecurity.CreateUserAndAccount(\"123123\", \"123123\");\n\n  if (!((IList<string>)Roles.GetRolesForUser(\"123123\")).Contains(\"Administrator\")) \n    Roles.AddUsersToRoles(new[] { \"123123\" }, new[] { \"Administrator\" });\n\n  context.Database.Initialize(true); \n  context.Set<UserProfile>().Add(new UserProfile { UserId = 1, UserName = \"123123\" }); \n  context.Set<Workout>().Add(new Workout { Id = 1, Name = \"My First workout user1\", StartTime = DateTime.Now.Add(TimeSpan.FromDays(-10)), Goal = \"Increase body mass\" }); \n  context.Set<Workout>().Add(new Workout { Id = 2, Name = \"My Second workout user1\", StartTime = DateTime.Now, Goal = \"Increase chest muscle, lower fat around abs\" }); \n  } \n}\n\\`\\`\\`\n\nThe last step is to create table schema and insert those values from the seed configuration. This is done by this command : \n\n\\`\\`\\`\nupdate-database -verbose -force\n\\`\\`\\`\n\nThe verbose will show you the SQL statement executed and the force will regenerate the table even if data already exist in those tables.\n\n## Conclusion\n\nAny time you change your model or the configuration of your entities, you need to run _update-database_ command. This will drop tables, create them again, create FK and insert seed data.\n\n\n\nexport const _frontmatter = {\"title\":\"Asp.Net MemberShip with MVC4\",\"date\":\"2012-10-10\",\"categories\":[\"asp-mvc\",\"entity-framework\"]}\n`}</code></pre>\n    </MDXLayout>;\n}\n\n;\nMDXContent.isMDXComponent = true;"}}