{"expireTime":9007200886478386000,"key":"gatsby-plugin-mdx-entire-payload-2f8dde6f03be3eb8be2e8aa326aef561--undefined","val":{"mdast":{"type":"root","children":[{"type":"paragraph","children":[{"type":"text","value":"This caching idea is limited to some scenarios where you have defined html zones. For example, if you are working with dynamic charts or having a complex logic to render Html controls or even complex canvas. In all cases, the goal is to show to the user something relevant instead of just a loading spinner for the subsequent calls.","position":{"start":{"line":2,"column":1,"offset":1},"end":{"line":2,"column":333,"offset":333},"indent":[]}}],"position":{"start":{"line":2,"column":1,"offset":1},"end":{"line":2,"column":333,"offset":333},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"The concept is that once you have loaded the zone the first time, you take a snapshot and store it into the local storage as a visual copy -- an image. The idea behind using an image is that you do not have to wait for extra dependencies like JavaScript files, CSS stylesheets or Ajax calls to have something displayed to the user. Meanwhile, the normal flow of your application must continue to have the real html loading with fresh values from the backend. The major advantage of that solution is that you have no slowness because of the network, neither of the server or from complex rendering client side code -- you get it directly pre-rendered from the client side cache.","position":{"start":{"line":4,"column":1,"offset":335},"end":{"line":4,"column":678,"offset":1012},"indent":[]}}],"position":{"start":{"line":4,"column":1,"offset":335},"end":{"line":4,"column":678,"offset":1012},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"This article will show you how to take a screenshot,in JavaScript, with the library called ","position":{"start":{"line":6,"column":1,"offset":1014},"end":{"line":6,"column":92,"offset":1105},"indent":[]}},{"type":"link","title":null,"url":"http://html2canvas.hertzen.com/","children":[{"type":"text","value":"Html2Canvas","position":{"start":{"line":6,"column":93,"offset":1106},"end":{"line":6,"column":104,"offset":1117},"indent":[]}}],"position":{"start":{"line":6,"column":92,"offset":1105},"end":{"line":6,"column":138,"offset":1151},"indent":[]}},{"type":"text","value":", stores it into the local storage and how to do the swap between this fake cached view with the real Html one. First, let's create an example scenario with two zones. One zone, called ","position":{"start":{"line":6,"column":138,"offset":1151},"end":{"line":6,"column":323,"offset":1336},"indent":[]}},{"type":"emphasis","children":[{"type":"text","value":"box1","position":{"start":{"line":6,"column":324,"offset":1337},"end":{"line":6,"column":328,"offset":1341},"indent":[]}}],"position":{"start":{"line":6,"column":323,"offset":1336},"end":{"line":6,"column":329,"offset":1342},"indent":[]}},{"type":"text","value":" will take 3 seconds to load and the ","position":{"start":{"line":6,"column":329,"offset":1342},"end":{"line":6,"column":366,"offset":1379},"indent":[]}},{"type":"emphasis","children":[{"type":"text","value":"box2","position":{"start":{"line":6,"column":367,"offset":1380},"end":{"line":6,"column":371,"offset":1384},"indent":[]}}],"position":{"start":{"line":6,"column":366,"offset":1379},"end":{"line":6,"column":372,"offset":1385},"indent":[]}},{"type":"text","value":" will take 5 seconds. The goal is to display the fake cached view when loading the real data, and thus make it appearing to the user as it was already loaded.","position":{"start":{"line":6,"column":372,"offset":1385},"end":{"line":6,"column":530,"offset":1543},"indent":[]}}],"position":{"start":{"line":6,"column":1,"offset":1014},"end":{"line":6,"column":530,"offset":1543},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"This solution is having some caveats. First, if the time between the image and the real html takes too much time, than the user may be confused. Thus, this is a good solution for improving a solution that has good performance on the start. I would say that you can easily use that solution for zones that load without this trick under 3-5 seconds. You can always have a subtle loading visual hint somewhere if it's longer. Second, if the cached image is very different from the new visual, than it will flicker during the swap of the image to the real html. Third, the local storage is limited in size, between 5 to 10 megs. That mean that you are limited to what you can cache with that solution. Overall, this solution is not a silver bullet and should be used as a blazing fast boost experience to an experience that is reasonable to load. It's not a solution to apply to a menu for example, because user may interact very fast with it and would hit a wall or should I say an image. It's good for element in a page that has a high visual interest or with element that has basic interaction like linking to somewhere else because the image can fulfill that contract.","position":{"start":{"line":8,"column":1,"offset":1545},"end":{"line":8,"column":1169,"offset":2713},"indent":[]}}],"position":{"start":{"line":8,"column":1,"offset":1545},"end":{"line":8,"column":1169,"offset":2713},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"Let's dive in the code.","position":{"start":{"line":10,"column":1,"offset":2715},"end":{"line":10,"column":24,"offset":2738},"indent":[]}}],"position":{"start":{"line":10,"column":1,"offset":2715},"end":{"line":10,"column":24,"offset":2738},"indent":[]}},{"type":"code","lang":"html","meta":null,"value":"<div id=\"box1\" class=\"box\">\n  <i class=\"fa fa-spinner fa-spin\"></i>\n</div> \n<div id=\"box2\" class=\"box\">\n  <i class=\"fa fa-spinner fa-spin\"></i>\n</div> ","position":{"start":{"line":12,"column":1,"offset":2740},"end":{"line":19,"column":4,"offset":2905},"indent":[1,1,1,1,1,1,1]}},{"type":"code","lang":"css","meta":null,"value":".box{ \n  width:150px; \n  height:150px; \n  background-color:lightblue; \n  margin:10px; \n}\n\n.box i{ \n  font-size: 3em; \n} ","position":{"start":{"line":21,"column":1,"offset":2907},"end":{"line":32,"column":4,"offset":3038},"indent":[1,1,1,1,1,1,1,1,1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"This will produce the following html : ","position":{"start":{"line":34,"column":1,"offset":3040},"end":{"line":34,"column":40,"offset":3079},"indent":[]}},{"type":"image","title":null,"url":"images/2LoadingZonesBoxes.png","alt":null,"position":{"start":{"line":34,"column":40,"offset":3079},"end":{"line":34,"column":74,"offset":3113},"indent":[]}}],"position":{"start":{"line":34,"column":1,"offset":3040},"end":{"line":34,"column":74,"offset":3113},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"The normal loading experience is done by using JavaScript's timeout. Both box display a different text, one display also an image. ","position":{"start":{"line":36,"column":1,"offset":3115},"end":{"line":36,"column":132,"offset":3246},"indent":[]}}],"position":{"start":{"line":36,"column":1,"offset":3115},"end":{"line":36,"column":132,"offset":3246},"indent":[]}},{"type":"code","lang":"typescript","meta":null,"value":"setTimeout(renderBox1, 3000); \nsetTimeout(renderBox2, 5000); \nfunction renderBox1() { \n  var $box = $('#box1'); \n  $box.text('Loaded 1'); \n  var $icon = $('<i>').addClass('fa fa-hand-peace-o'); \n  $box.append($icon); \n}\n\nfunction renderBox2() { \n  var $box = $('#box2'); \n  $box.text('Loaded 2'); \n} ","position":{"start":{"line":38,"column":1,"offset":3248},"end":{"line":52,"column":5,"offset":3567},"indent":[1,1,1,1,1,1,1,1,1,1,1,1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"So far, it takes the amount of time defined to see the spinner being removed and replaced by the real content.","position":{"start":{"line":54,"column":1,"offset":3569},"end":{"line":54,"column":111,"offset":3679},"indent":[]}}],"position":{"start":{"line":54,"column":1,"offset":3569},"end":{"line":54,"column":111,"offset":3679},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"The next step is to have in those render box the code to set the cache with the image of the rendered result. Box 1 will have the text and the image, box 2 just the text. This require to change both render method to call a cache method. Since the experience is so seamless that we will also, for the purpose of this demo, add some text under the boxes once refreshed with real value. So, the visual will be on the first call that we display the spinner, we cache, we display the text under the box. On the second load, we do not display the spinner since this one is replaced by the cached version right away. The texts under the boxes are shown only after the delay with the real value.","position":{"start":{"line":56,"column":1,"offset":3681},"end":{"line":56,"column":688,"offset":4368},"indent":[]}}],"position":{"start":{"line":56,"column":1,"offset":3681},"end":{"line":56,"column":688,"offset":4368},"indent":[]}},{"type":"code","lang":"typescript","meta":null,"value":"function renderBox1() { \n  var $box = $('#box1'); \n  $box.text('Loaded 1'); \n  var $icon = $('<i>').addClass('fa fa-hand-peace-o'); \n  $box.append($icon); cache($box); \n  $box.after('<p>Not cached data box 1 in place</p>'); \n}\n\nfunction renderBox2() { \n  var $box = $('#box2'); \n  $box.text('Loaded 2'); \n  cache($box); \n  $box.after('<p>Not cached data box 2 in place</p>'); \n} ","position":{"start":{"line":58,"column":1,"offset":4370},"end":{"line":73,"column":5,"offset":4768},"indent":[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"We also need to change the loading code to go check in the cache. We try to read the cache, the local storage, and if nothing ","position":{"start":{"line":76,"column":1,"offset":4771},"end":{"line":76,"column":127,"offset":4897},"indent":[]}}],"position":{"start":{"line":76,"column":1,"offset":4771},"end":{"line":76,"column":127,"offset":4897},"indent":[]}},{"type":"code","lang":"typescript","meta":null,"value":"var box1Cached = unDataToCanvas(localStorage.getItem('box1')); \nvar box2Cached = unDataToCanvas(localStorage.getItem('box2'));\n\nif(box1Cached){ \n  $('#box1').html(box1Cached); \n} \nsetTimeout(renderBox1, 3000);\n\nif(box2Cached){ \n  $('#box2').html(box2Cached); \n} \nsetTimeout(renderBox2, 5000); ","position":{"start":{"line":78,"column":1,"offset":4899},"end":{"line":91,"column":5,"offset":5211},"indent":[1,1,1,1,1,1,1,1,1,1,1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"Finally, the load and save in the cache need to be coded. The save will create a canvas and we will store the data into a base64 representation. This is done by calling the method ","position":{"start":{"line":94,"column":1,"offset":5214},"end":{"line":94,"column":181,"offset":5394},"indent":[]}},{"type":"inlineCode","value":"toDataUrl()","position":{"start":{"line":94,"column":181,"offset":5394},"end":{"line":94,"column":194,"offset":5407},"indent":[]}},{"type":"text","value":" method.","position":{"start":{"line":94,"column":194,"offset":5407},"end":{"line":94,"column":202,"offset":5415},"indent":[]}}],"position":{"start":{"line":94,"column":1,"offset":5214},"end":{"line":94,"column":202,"offset":5415},"indent":[]}},{"type":"code","lang":"typescript","meta":null,"value":"function cache($elementToCache) { \n  var id = $elementToCache.attr('id'); \n  html2canvas($elementToCache, { onrendered: function(canvas) { \n      window.localStorage.setItem(id, canvas.toDataURL()); \n      } \n  }); \n} ","position":{"start":{"line":96,"column":1,"offset":5417},"end":{"line":104,"column":5,"offset":5654},"indent":[1,1,1,1,1,1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"The loading is more tricky. We need to load from the local storage the base64 image, create an image with the source to this base64 and return it. ","position":{"start":{"line":107,"column":1,"offset":5657},"end":{"line":107,"column":148,"offset":5804},"indent":[]}}],"position":{"start":{"line":107,"column":1,"offset":5657},"end":{"line":107,"column":148,"offset":5804},"indent":[]}},{"type":"code","lang":"javascript","meta":null,"value":"function unDataToCanvas(data) { \n  var img = new Image(); \n  var canvas = document.createElement('canvas'); \n  img.onload = function() { \n    canvas.width = 150; \n    canvas.height = 150; \n    canvas.getContext(\"2d\").drawImage(img, 0, 0); \n  }; \n  img.src = data; \n  if(data){ \n    return img; \n  } else{ \n    return null; \n  } \n} ","position":{"start":{"line":109,"column":1,"offset":5806},"end":{"line":125,"column":5,"offset":6156},"indent":[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"The whole code with a working demo is on ","position":{"start":{"line":128,"column":1,"offset":6159},"end":{"line":128,"column":42,"offset":6200},"indent":[]}},{"type":"link","title":null,"url":"http://jsfiddle.net/mrdesjardins/31qca6b0/","children":[{"type":"text","value":"JsFiddle.net : http://jsfiddle.net/mrdesjardins/31qca6b0/","position":{"start":{"line":128,"column":43,"offset":6201},"end":{"line":128,"column":100,"offset":6258},"indent":[]}}],"position":{"start":{"line":128,"column":42,"offset":6200},"end":{"line":128,"column":145,"offset":6303},"indent":[]}},{"type":"text","value":".","position":{"start":{"line":128,"column":145,"offset":6303},"end":{"line":128,"column":146,"offset":6304},"indent":[]}}],"position":{"start":{"line":128,"column":1,"offset":6159},"end":{"line":128,"column":146,"offset":6304},"indent":[]}},{"type":"export","value":"export const _frontmatter = {\"title\":\"How to cache Html element with Html5 Canvas and LocalStorage\",\"date\":\"2015-12-07\",\"categories\":[\"css\",\"javascript\"]}","position":{"start":{"line":131,"column":1,"offset":6307},"end":{"line":131,"column":155,"offset":6461},"indent":[]}}],"position":{"start":{"line":1,"column":1,"offset":0},"end":{"line":131,"column":155,"offset":6461}}},"scopeImports":["import * as React from 'react'"],"scopeIdentifiers":["React"],"body":"var _excluded = [\"components\"];\n\nfunction _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\n/* @jsxRuntime classic */\n\n/* @jsx mdx */\nvar _frontmatter = {\n  \"title\": \"How to cache Html element with Html5 Canvas and LocalStorage\",\n  \"date\": \"2015-12-07\",\n  \"categories\": [\"css\", \"javascript\"]\n};\nvar layoutProps = {\n  _frontmatter: _frontmatter\n};\nvar MDXLayout = \"wrapper\";\nreturn function MDXContent(_ref) {\n  var components = _ref.components,\n      props = _objectWithoutProperties(_ref, _excluded);\n\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(\"p\", null, \"This caching idea is limited to some scenarios where you have defined html zones. For example, if you are working with dynamic charts or having a complex logic to render Html controls or even complex canvas. In all cases, the goal is to show to the user something relevant instead of just a loading spinner for the subsequent calls.\"), mdx(\"p\", null, \"The concept is that once you have loaded the zone the first time, you take a snapshot and store it into the local storage as a visual copy -- an image. The idea behind using an image is that you do not have to wait for extra dependencies like JavaScript files, CSS stylesheets or Ajax calls to have something displayed to the user. Meanwhile, the normal flow of your application must continue to have the real html loading with fresh values from the backend. The major advantage of that solution is that you have no slowness because of the network, neither of the server or from complex rendering client side code -- you get it directly pre-rendered from the client side cache.\"), mdx(\"p\", null, \"This article will show you how to take a screenshot,in JavaScript, with the library called \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"http://html2canvas.hertzen.com/\"\n  }, \"Html2Canvas\"), \", stores it into the local storage and how to do the swap between this fake cached view with the real Html one. First, let's create an example scenario with two zones. One zone, called \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"box1\"), \" will take 3 seconds to load and the \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"box2\"), \" will take 5 seconds. The goal is to display the fake cached view when loading the real data, and thus make it appearing to the user as it was already loaded.\"), mdx(\"p\", null, \"This solution is having some caveats. First, if the time between the image and the real html takes too much time, than the user may be confused. Thus, this is a good solution for improving a solution that has good performance on the start. I would say that you can easily use that solution for zones that load without this trick under 3-5 seconds. You can always have a subtle loading visual hint somewhere if it's longer. Second, if the cached image is very different from the new visual, than it will flicker during the swap of the image to the real html. Third, the local storage is limited in size, between 5 to 10 megs. That mean that you are limited to what you can cache with that solution. Overall, this solution is not a silver bullet and should be used as a blazing fast boost experience to an experience that is reasonable to load. It's not a solution to apply to a menu for example, because user may interact very fast with it and would hit a wall or should I say an image. It's good for element in a page that has a high visual interest or with element that has basic interaction like linking to somewhere else because the image can fulfill that contract.\"), mdx(\"p\", null, \"Let's dive in the code.\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-html\"\n  }, \"<div id=\\\"box1\\\" class=\\\"box\\\">\\n  <i class=\\\"fa fa-spinner fa-spin\\\"></i>\\n</div> \\n<div id=\\\"box2\\\" class=\\\"box\\\">\\n  <i class=\\\"fa fa-spinner fa-spin\\\"></i>\\n</div> \\n\")), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-css\"\n  }, \".box{ \\n  width:150px; \\n  height:150px; \\n  background-color:lightblue; \\n  margin:10px; \\n}\\n\\n.box i{ \\n  font-size: 3em; \\n} \\n\")), mdx(\"p\", null, \"This will produce the following html : \", mdx(\"span\", {\n    parentName: \"p\",\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"174px\"\n    }\n  }, \"\\n      \", mdx(\"a\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-link\",\n    \"href\": \"/static/4c0413805f785f3f6b8f74faaef1ac6f/fe9c7/2LoadingZonesBoxes.png\",\n    \"style\": {\n      \"display\": \"block\"\n    },\n    \"target\": \"_blank\",\n    \"rel\": \"noopener\"\n  }, \"\\n    \", mdx(\"span\", {\n    parentName: \"a\",\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"182.75862068965517%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAlCAYAAABCr8kFAAAACXBIWXMAAA7DAAAOwwHHb6hkAAACqklEQVRIx+2Wy08TURjF+Xvcmbhwo4l/gBs3bo2JrnCjNQZNlGiomhgLUQuiRh5NW16lndLa2lQe4aEFwQBTC/Q9j3ZKh76AWgtzzFzQ1obSDrohYZIzmeTO/eV898493zRAkjAvZDDJZ9Ha2wdqwQfzHI2JqIjxSBIT0dr6FF7HqpiDfDXIt64xD25pu/HK7YHGPgHVy/cwh1IwLDMwelkY6erq83LoXWIwy6dKQOP0N7xwTsMWScEWTeOZyYlr99XkedDLYsjHV9Wwj0efl8V8LF0CtrztxZupRdiZLFxCAfc6dXg6YAcVFAlw8DtXFWjy8cTp11iZQ3dERNNrHdQGCo2PNTh/8RJa9BbYohkMeBnlwI8BAR3j81C1duLUmbMwLoYJ5LcOK/lgYFCAyb8Oiz8Bsz8B00qcvFwLdggwASPNYGgfUO7siA4TZPvLAfWUWwPI1px8AjzOQFcogX4vRwaVanjlgHCw++Mkggw0q1iyu57FKDzcRgm4lMjgMytiLp4hA19YER4+VZfkHJxhNxBKb+0BJUnC9s4utnaAZCaLzeIuCgAy+QJyhWJdyhaKyBd3Sg6tdBjvZmjc1HSgdWQMj3Sm/eiSs5D/K3kqJW+MoXJT9FMLuK3tIoHaM7uC5q5+dIzOwrQaPxRWFai1OIlD85pAUltjHcX1B08wEkkTl4o/m3bKhTbHJCyBdQK5fEOF55Qb1vDGHlBRYksSxmM53GnvRqNag9PnLuBKUzNZSyok7q+jwhbg8McwtCagzTaGq3cf4gObgyWQrFlu9ZMiHz2aBRVMwhnbwgDN/Gmf/5DYcmks+ulo3fFfVzgogZ3k4fEDcv+xBQRLLeBIwMoW4AgI0C8zBCqXrkTyHF3lH6yw+QNsdhtcLg8uq1C5PJmbyv8kwF9odAnYC7I7BgAAAABJRU5ErkJggg==')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  }), \"\\n  \", mdx(\"img\", {\n    parentName: \"a\",\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"2LoadingZonesBoxes\",\n    \"title\": \"2LoadingZonesBoxes\",\n    \"src\": \"/static/4c0413805f785f3f6b8f74faaef1ac6f/fe9c7/2LoadingZonesBoxes.png\",\n    \"srcSet\": [\"/static/4c0413805f785f3f6b8f74faaef1ac6f/fe9c7/2LoadingZonesBoxes.png 174w\"],\n    \"sizes\": \"(max-width: 174px) 100vw, 174px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\",\n    \"decoding\": \"async\"\n  }), \"\\n  \"), \"\\n    \")), mdx(\"p\", null, \"The normal loading experience is done by using JavaScript's timeout. Both box display a different text, one display also an image. \"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-typescript\"\n  }, \"setTimeout(renderBox1, 3000); \\nsetTimeout(renderBox2, 5000); \\nfunction renderBox1() { \\n  var $box = $('#box1'); \\n  $box.text('Loaded 1'); \\n  var $icon = $('<i>').addClass('fa fa-hand-peace-o'); \\n  $box.append($icon); \\n}\\n\\nfunction renderBox2() { \\n  var $box = $('#box2'); \\n  $box.text('Loaded 2'); \\n} \\n\")), mdx(\"p\", null, \"So far, it takes the amount of time defined to see the spinner being removed and replaced by the real content.\"), mdx(\"p\", null, \"The next step is to have in those render box the code to set the cache with the image of the rendered result. Box 1 will have the text and the image, box 2 just the text. This require to change both render method to call a cache method. Since the experience is so seamless that we will also, for the purpose of this demo, add some text under the boxes once refreshed with real value. So, the visual will be on the first call that we display the spinner, we cache, we display the text under the box. On the second load, we do not display the spinner since this one is replaced by the cached version right away. The texts under the boxes are shown only after the delay with the real value.\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-typescript\"\n  }, \"function renderBox1() { \\n  var $box = $('#box1'); \\n  $box.text('Loaded 1'); \\n  var $icon = $('<i>').addClass('fa fa-hand-peace-o'); \\n  $box.append($icon); cache($box); \\n  $box.after('<p>Not cached data box 1 in place</p>'); \\n}\\n\\nfunction renderBox2() { \\n  var $box = $('#box2'); \\n  $box.text('Loaded 2'); \\n  cache($box); \\n  $box.after('<p>Not cached data box 2 in place</p>'); \\n} \\n\")), mdx(\"p\", null, \"We also need to change the loading code to go check in the cache. We try to read the cache, the local storage, and if nothing \"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-typescript\"\n  }, \"var box1Cached = unDataToCanvas(localStorage.getItem('box1')); \\nvar box2Cached = unDataToCanvas(localStorage.getItem('box2'));\\n\\nif(box1Cached){ \\n  $('#box1').html(box1Cached); \\n} \\nsetTimeout(renderBox1, 3000);\\n\\nif(box2Cached){ \\n  $('#box2').html(box2Cached); \\n} \\nsetTimeout(renderBox2, 5000); \\n\")), mdx(\"p\", null, \"Finally, the load and save in the cache need to be coded. The save will create a canvas and we will store the data into a base64 representation. This is done by calling the method \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"toDataUrl()\"), \" method.\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-typescript\"\n  }, \"function cache($elementToCache) { \\n  var id = $elementToCache.attr('id'); \\n  html2canvas($elementToCache, { onrendered: function(canvas) { \\n      window.localStorage.setItem(id, canvas.toDataURL()); \\n      } \\n  }); \\n} \\n\")), mdx(\"p\", null, \"The loading is more tricky. We need to load from the local storage the base64 image, create an image with the source to this base64 and return it. \"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-javascript\"\n  }, \"function unDataToCanvas(data) { \\n  var img = new Image(); \\n  var canvas = document.createElement('canvas'); \\n  img.onload = function() { \\n    canvas.width = 150; \\n    canvas.height = 150; \\n    canvas.getContext(\\\"2d\\\").drawImage(img, 0, 0); \\n  }; \\n  img.src = data; \\n  if(data){ \\n    return img; \\n  } else{ \\n    return null; \\n  } \\n} \\n\")), mdx(\"p\", null, \"The whole code with a working demo is on \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"http://jsfiddle.net/mrdesjardins/31qca6b0/\"\n  }, \"JsFiddle.net : http://jsfiddle.net/mrdesjardins/31qca6b0/\"), \".\"));\n}\n;\nMDXContent.isMDXComponent = true;","rawMDXOutput":"/* @jsx mdx */\nimport { mdx } from '@mdx-js/react';\n/* @jsxRuntime classic */\n/* @jsx mdx */\n\nexport const _frontmatter = {\n  \"title\": \"How to cache Html element with Html5 Canvas and LocalStorage\",\n  \"date\": \"2015-12-07\",\n  \"categories\": [\"css\", \"javascript\"]\n};\n\nconst layoutProps = {\n  _frontmatter\n};\nconst MDXLayout = \"wrapper\"\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n    <p>{`This caching idea is limited to some scenarios where you have defined html zones. For example, if you are working with dynamic charts or having a complex logic to render Html controls or even complex canvas. In all cases, the goal is to show to the user something relevant instead of just a loading spinner for the subsequent calls.`}</p>\n    <p>{`The concept is that once you have loaded the zone the first time, you take a snapshot and store it into the local storage as a visual copy -- an image. The idea behind using an image is that you do not have to wait for extra dependencies like JavaScript files, CSS stylesheets or Ajax calls to have something displayed to the user. Meanwhile, the normal flow of your application must continue to have the real html loading with fresh values from the backend. The major advantage of that solution is that you have no slowness because of the network, neither of the server or from complex rendering client side code -- you get it directly pre-rendered from the client side cache.`}</p>\n    <p>{`This article will show you how to take a screenshot,in JavaScript, with the library called `}<a parentName=\"p\" {...{\n        \"href\": \"http://html2canvas.hertzen.com/\"\n      }}>{`Html2Canvas`}</a>{`, stores it into the local storage and how to do the swap between this fake cached view with the real Html one. First, let's create an example scenario with two zones. One zone, called `}<em parentName=\"p\">{`box1`}</em>{` will take 3 seconds to load and the `}<em parentName=\"p\">{`box2`}</em>{` will take 5 seconds. The goal is to display the fake cached view when loading the real data, and thus make it appearing to the user as it was already loaded.`}</p>\n    <p>{`This solution is having some caveats. First, if the time between the image and the real html takes too much time, than the user may be confused. Thus, this is a good solution for improving a solution that has good performance on the start. I would say that you can easily use that solution for zones that load without this trick under 3-5 seconds. You can always have a subtle loading visual hint somewhere if it's longer. Second, if the cached image is very different from the new visual, than it will flicker during the swap of the image to the real html. Third, the local storage is limited in size, between 5 to 10 megs. That mean that you are limited to what you can cache with that solution. Overall, this solution is not a silver bullet and should be used as a blazing fast boost experience to an experience that is reasonable to load. It's not a solution to apply to a menu for example, because user may interact very fast with it and would hit a wall or should I say an image. It's good for element in a page that has a high visual interest or with element that has basic interaction like linking to somewhere else because the image can fulfill that contract.`}</p>\n    <p>{`Let's dive in the code.`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-html\"\n      }}>{`<div id=\"box1\" class=\"box\">\n  <i class=\"fa fa-spinner fa-spin\"></i>\n</div> \n<div id=\"box2\" class=\"box\">\n  <i class=\"fa fa-spinner fa-spin\"></i>\n</div> \n`}</code></pre>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-css\"\n      }}>{`.box{ \n  width:150px; \n  height:150px; \n  background-color:lightblue; \n  margin:10px; \n}\n\n.box i{ \n  font-size: 3em; \n} \n`}</code></pre>\n    <p>{`This will produce the following html : `}<span parentName=\"p\" {...{\n        \"className\": \"gatsby-resp-image-wrapper\",\n        \"style\": {\n          \"position\": \"relative\",\n          \"display\": \"block\",\n          \"marginLeft\": \"auto\",\n          \"marginRight\": \"auto\",\n          \"maxWidth\": \"174px\"\n        }\n      }}>{`\n      `}<a parentName=\"span\" {...{\n          \"className\": \"gatsby-resp-image-link\",\n          \"href\": \"/static/4c0413805f785f3f6b8f74faaef1ac6f/fe9c7/2LoadingZonesBoxes.png\",\n          \"style\": {\n            \"display\": \"block\"\n          },\n          \"target\": \"_blank\",\n          \"rel\": \"noopener\"\n        }}>{`\n    `}<span parentName=\"a\" {...{\n            \"className\": \"gatsby-resp-image-background-image\",\n            \"style\": {\n              \"paddingBottom\": \"182.75862068965517%\",\n              \"position\": \"relative\",\n              \"bottom\": \"0\",\n              \"left\": \"0\",\n              \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAlCAYAAABCr8kFAAAACXBIWXMAAA7DAAAOwwHHb6hkAAACqklEQVRIx+2Wy08TURjF+Xvcmbhwo4l/gBs3bo2JrnCjNQZNlGiomhgLUQuiRh5NW16lndLa2lQe4aEFwQBTC/Q9j3ZKh76AWgtzzFzQ1obSDrohYZIzmeTO/eV898493zRAkjAvZDDJZ9Ha2wdqwQfzHI2JqIjxSBIT0dr6FF7HqpiDfDXIt64xD25pu/HK7YHGPgHVy/cwh1IwLDMwelkY6erq83LoXWIwy6dKQOP0N7xwTsMWScEWTeOZyYlr99XkedDLYsjHV9Wwj0efl8V8LF0CtrztxZupRdiZLFxCAfc6dXg6YAcVFAlw8DtXFWjy8cTp11iZQ3dERNNrHdQGCo2PNTh/8RJa9BbYohkMeBnlwI8BAR3j81C1duLUmbMwLoYJ5LcOK/lgYFCAyb8Oiz8Bsz8B00qcvFwLdggwASPNYGgfUO7siA4TZPvLAfWUWwPI1px8AjzOQFcogX4vRwaVanjlgHCw++Mkggw0q1iyu57FKDzcRgm4lMjgMytiLp4hA19YER4+VZfkHJxhNxBKb+0BJUnC9s4utnaAZCaLzeIuCgAy+QJyhWJdyhaKyBd3Sg6tdBjvZmjc1HSgdWQMj3Sm/eiSs5D/K3kqJW+MoXJT9FMLuK3tIoHaM7uC5q5+dIzOwrQaPxRWFai1OIlD85pAUltjHcX1B08wEkkTl4o/m3bKhTbHJCyBdQK5fEOF55Qb1vDGHlBRYksSxmM53GnvRqNag9PnLuBKUzNZSyok7q+jwhbg8McwtCagzTaGq3cf4gObgyWQrFlu9ZMiHz2aBRVMwhnbwgDN/Gmf/5DYcmks+ulo3fFfVzgogZ3k4fEDcv+xBQRLLeBIwMoW4AgI0C8zBCqXrkTyHF3lH6yw+QNsdhtcLg8uq1C5PJmbyv8kwF9odAnYC7I7BgAAAABJRU5ErkJggg==')\",\n              \"backgroundSize\": \"cover\",\n              \"display\": \"block\"\n            }\n          }}></span>{`\n  `}<img parentName=\"a\" {...{\n            \"className\": \"gatsby-resp-image-image\",\n            \"alt\": \"2LoadingZonesBoxes\",\n            \"title\": \"2LoadingZonesBoxes\",\n            \"src\": \"/static/4c0413805f785f3f6b8f74faaef1ac6f/fe9c7/2LoadingZonesBoxes.png\",\n            \"srcSet\": [\"/static/4c0413805f785f3f6b8f74faaef1ac6f/fe9c7/2LoadingZonesBoxes.png 174w\"],\n            \"sizes\": \"(max-width: 174px) 100vw, 174px\",\n            \"style\": {\n              \"width\": \"100%\",\n              \"height\": \"100%\",\n              \"margin\": \"0\",\n              \"verticalAlign\": \"middle\",\n              \"position\": \"absolute\",\n              \"top\": \"0\",\n              \"left\": \"0\"\n            },\n            \"loading\": \"lazy\",\n            \"decoding\": \"async\"\n          }}></img>{`\n  `}</a>{`\n    `}</span></p>\n    <p>{`The normal loading experience is done by using JavaScript's timeout. Both box display a different text, one display also an image. `}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-typescript\"\n      }}>{`setTimeout(renderBox1, 3000); \nsetTimeout(renderBox2, 5000); \nfunction renderBox1() { \n  var $box = $('#box1'); \n  $box.text('Loaded 1'); \n  var $icon = $('<i>').addClass('fa fa-hand-peace-o'); \n  $box.append($icon); \n}\n\nfunction renderBox2() { \n  var $box = $('#box2'); \n  $box.text('Loaded 2'); \n} \n`}</code></pre>\n    <p>{`So far, it takes the amount of time defined to see the spinner being removed and replaced by the real content.`}</p>\n    <p>{`The next step is to have in those render box the code to set the cache with the image of the rendered result. Box 1 will have the text and the image, box 2 just the text. This require to change both render method to call a cache method. Since the experience is so seamless that we will also, for the purpose of this demo, add some text under the boxes once refreshed with real value. So, the visual will be on the first call that we display the spinner, we cache, we display the text under the box. On the second load, we do not display the spinner since this one is replaced by the cached version right away. The texts under the boxes are shown only after the delay with the real value.`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-typescript\"\n      }}>{`function renderBox1() { \n  var $box = $('#box1'); \n  $box.text('Loaded 1'); \n  var $icon = $('<i>').addClass('fa fa-hand-peace-o'); \n  $box.append($icon); cache($box); \n  $box.after('<p>Not cached data box 1 in place</p>'); \n}\n\nfunction renderBox2() { \n  var $box = $('#box2'); \n  $box.text('Loaded 2'); \n  cache($box); \n  $box.after('<p>Not cached data box 2 in place</p>'); \n} \n`}</code></pre>\n    <p>{`We also need to change the loading code to go check in the cache. We try to read the cache, the local storage, and if nothing `}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-typescript\"\n      }}>{`var box1Cached = unDataToCanvas(localStorage.getItem('box1')); \nvar box2Cached = unDataToCanvas(localStorage.getItem('box2'));\n\nif(box1Cached){ \n  $('#box1').html(box1Cached); \n} \nsetTimeout(renderBox1, 3000);\n\nif(box2Cached){ \n  $('#box2').html(box2Cached); \n} \nsetTimeout(renderBox2, 5000); \n`}</code></pre>\n    <p>{`Finally, the load and save in the cache need to be coded. The save will create a canvas and we will store the data into a base64 representation. This is done by calling the method `}<inlineCode parentName=\"p\">{`toDataUrl()`}</inlineCode>{` method.`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-typescript\"\n      }}>{`function cache($elementToCache) { \n  var id = $elementToCache.attr('id'); \n  html2canvas($elementToCache, { onrendered: function(canvas) { \n      window.localStorage.setItem(id, canvas.toDataURL()); \n      } \n  }); \n} \n`}</code></pre>\n    <p>{`The loading is more tricky. We need to load from the local storage the base64 image, create an image with the source to this base64 and return it. `}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-javascript\"\n      }}>{`function unDataToCanvas(data) { \n  var img = new Image(); \n  var canvas = document.createElement('canvas'); \n  img.onload = function() { \n    canvas.width = 150; \n    canvas.height = 150; \n    canvas.getContext(\"2d\").drawImage(img, 0, 0); \n  }; \n  img.src = data; \n  if(data){ \n    return img; \n  } else{ \n    return null; \n  } \n} \n`}</code></pre>\n    <p>{`The whole code with a working demo is on `}<a parentName=\"p\" {...{\n        \"href\": \"http://jsfiddle.net/mrdesjardins/31qca6b0/\"\n      }}>{`JsFiddle.net : http://jsfiddle.net/mrdesjardins/31qca6b0/`}</a>{`.`}</p>\n\n    </MDXLayout>;\n}\n\n;\nMDXContent.isMDXComponent = true;"}}